var bW=Object.create;var y2=Object.defineProperty,wW=Object.defineProperties,CW=Object.getOwnPropertyDescriptor,EW=Object.getOwnPropertyDescriptors,TW=Object.getOwnPropertyNames,dC=Object.getOwnPropertySymbols,SW=Object.getPrototypeOf,x2=Object.prototype.hasOwnProperty,T3=Object.prototype.propertyIsEnumerable;var E3=(t,n,i)=>n in t?y2(t,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[n]=i,Jt=(t,n)=>{for(var i in n||={})x2.call(n,i)&&E3(t,i,n[i]);if(dC)for(var i of dC(n))T3.call(n,i)&&E3(t,i,n[i]);return t},Mi=(t,n)=>wW(t,EW(n));var mx=(t,n)=>{var i={};for(var l in t)x2.call(t,l)&&n.indexOf(l)<0&&(i[l]=t[l]);if(t!=null&&dC)for(var l of dC(t))n.indexOf(l)<0&&T3.call(t,l)&&(i[l]=t[l]);return i};var Gn=(t,n)=>()=>(n||t((n={exports:{}}).exports,n),n.exports);var DW=(t,n,i,l)=>{if(n&&typeof n=="object"||typeof n=="function")for(let h of TW(n))!x2.call(t,h)&&h!==i&&y2(t,h,{get:()=>n[h],enumerable:!(l=CW(n,h))||l.enumerable});return t};var ep=(t,n,i)=>(i=t!=null?bW(SW(t)):{},DW(n||!t||!t.__esModule?y2(i,"default",{value:t,enumerable:!0}):i,t));var Tc=(t,n,i)=>new Promise((l,h)=>{var o=L=>{try{A(i.next(L))}catch(Y){h(Y)}},E=L=>{try{A(i.throw(L))}catch(Y){h(Y)}},A=L=>L.done?l(L.value):Promise.resolve(L.value).then(o,E);A((i=i.apply(t,n)).next())});var _g=Gn((zd,yR)=>{"use strict";(function(t,n){typeof zd=="object"&&typeof yR<"u"?yR.exports=n():typeof define=="function"&&define.amd?define(n):(t=typeof globalThis<"u"?globalThis:t||self,t.Sweetalert2=n())})(zd,function(){"use strict";function t(N,j,oe){if(typeof N=="function"?N===j:N.has(j))return arguments.length<3?j:oe;throw new TypeError("Private element is not present on this object")}function n(N,j){if(j.has(N))throw new TypeError("Cannot initialize the same private elements twice on an object")}function i(N,j){return N.get(t(N,j))}function l(N,j,oe){n(N,j),j.set(N,oe)}function h(N,j,oe){return N.set(t(N,j),oe),oe}let o=100,E={},A=()=>{E.previousActiveElement instanceof HTMLElement?(E.previousActiveElement.focus(),E.previousActiveElement=null):document.body&&document.body.focus()},L=N=>new Promise(j=>{if(!N)return j();let oe=window.scrollX,Me=window.scrollY;E.restoreFocusTimeout=setTimeout(()=>{A(),j()},o),window.scrollTo(oe,Me)}),Y="swal2-",te=["container","shown","height-auto","iosfix","popup","modal","no-backdrop","no-transition","toast","toast-shown","show","hide","close","title","html-container","actions","confirm","deny","cancel","footer","icon","icon-content","image","input","file","range","select","radio","checkbox","label","textarea","inputerror","input-label","validation-message","progress-steps","active-progress-step","progress-step","progress-step-line","loader","loading","styled","top","top-start","top-end","top-left","top-right","center","center-start","center-end","center-left","center-right","bottom","bottom-start","bottom-end","bottom-left","bottom-right","grow-row","grow-column","grow-fullscreen","rtl","timer-progress-bar","timer-progress-bar-container","scrollbar-measure","icon-success","icon-warning","icon-info","icon-question","icon-error","draggable","dragging"].reduce((N,j)=>(N[j]=Y+j,N),{}),Ae=["success","warning","info","question","error"].reduce((N,j)=>(N[j]=Y+j,N),{}),Be="SweetAlert2:",Tt=N=>N.charAt(0).toUpperCase()+N.slice(1),ot=N=>{console.warn(`${Be} ${typeof N=="object"?N.join(" "):N}`)},kt=N=>{console.error(`${Be} ${N}`)},Cn=[],Xn=N=>{Cn.includes(N)||(Cn.push(N),ot(N))},On=(N,j=null)=>{Xn(`"${N}" is deprecated and will be removed in the next major release.${j?` Use "${j}" instead.`:""}`)},Vn=N=>typeof N=="function"?N():N,rr=N=>N&&typeof N.toPromise=="function",Vi=N=>rr(N)?N.toPromise():Promise.resolve(N),Er=N=>N&&Promise.resolve(N)===N,$n=()=>document.body.querySelector(`.${te.container}`),Qi=N=>{let j=$n();return j?j.querySelector(N):null},Rt=N=>Qi(`.${N}`),en=()=>Rt(te.popup),ai=()=>Rt(te.icon),Fi=()=>Rt(te["icon-content"]),Wi=()=>Rt(te.title),Pr=()=>Rt(te["html-container"]),Oo=()=>Rt(te.image),ks=()=>Rt(te["progress-steps"]),Fs=()=>Rt(te["validation-message"]),eo=()=>Qi(`.${te.actions} .${te.confirm}`),Ui=()=>Qi(`.${te.actions} .${te.cancel}`),Do=()=>Qi(`.${te.actions} .${te.deny}`),Nu=()=>Rt(te["input-label"]),$a=()=>Qi(`.${te.loader}`),Bl=()=>Rt(te.actions),Ga=()=>Rt(te.footer),Li=()=>Rt(te["timer-progress-bar"]),Vr=()=>Rt(te.close),Ro=`
  a[href],
  area[href],
  input:not([disabled]),
  select:not([disabled]),
  textarea:not([disabled]),
  button:not([disabled]),
  iframe,
  object,
  embed,
  [tabindex="0"],
  [contenteditable],
  audio[controls],
  video[controls],
  summary
`,hc=()=>{let N=en();if(!N)return[];let j=N.querySelectorAll('[tabindex]:not([tabindex="-1"]):not([tabindex="0"])'),oe=Array.from(j).sort((_n,Hi)=>{let Tr=parseInt(_n.getAttribute("tabindex")||"0"),no=parseInt(Hi.getAttribute("tabindex")||"0");return Tr>no?1:Tr<no?-1:0}),Me=N.querySelectorAll(Ro),Ct=Array.from(Me).filter(_n=>_n.getAttribute("tabindex")!=="-1");return[...new Set(oe.concat(Ct))].filter(_n=>No(_n))},pr=()=>Wo(document.body,te.shown)&&!Wo(document.body,te["toast-shown"])&&!Wo(document.body,te["no-backdrop"]),qa=()=>{let N=en();return N?Wo(N,te.toast):!1},ua=()=>{let N=en();return N?N.hasAttribute("data-loading"):!1},co=(N,j)=>{if(N.textContent="",j){let Me=new DOMParser().parseFromString(j,"text/html"),Ct=Me.querySelector("head");Ct&&Array.from(Ct.childNodes).forEach(Hi=>{N.appendChild(Hi)});let _n=Me.querySelector("body");_n&&Array.from(_n.childNodes).forEach(Hi=>{Hi instanceof HTMLVideoElement||Hi instanceof HTMLAudioElement?N.appendChild(Hi.cloneNode(!0)):N.appendChild(Hi)})}},Wo=(N,j)=>{if(!j)return!1;let oe=j.split(/\s+/);for(let Me=0;Me<oe.length;Me++)if(!N.classList.contains(oe[Me]))return!1;return!0},Ur=(N,j)=>{Array.from(N.classList).forEach(oe=>{!Object.values(te).includes(oe)&&!Object.values(Ae).includes(oe)&&!Object.values(j.showClass||{}).includes(oe)&&N.classList.remove(oe)})},os=(N,j,oe)=>{if(Ur(N,j),!j.customClass)return;let Me=j.customClass[oe];if(Me){if(typeof Me!="string"&&!Me.forEach){ot(`Invalid type of customClass.${oe}! Expected string or iterable object, got "${typeof Me}"`);return}lr(N,Me)}},_l=(N,j)=>{if(!j)return null;switch(j){case"select":case"textarea":case"file":return N.querySelector(`.${te.popup} > .${te[j]}`);case"checkbox":return N.querySelector(`.${te.popup} > .${te.checkbox} input`);case"radio":return N.querySelector(`.${te.popup} > .${te.radio} input:checked`)||N.querySelector(`.${te.popup} > .${te.radio} input:first-child`);case"range":return N.querySelector(`.${te.popup} > .${te.range} input`);default:return N.querySelector(`.${te.popup} > .${te.input}`)}},Ls=N=>{if(N.focus(),N.type!=="file"){let j=N.value;N.value="",N.value=j}},jl=(N,j,oe)=>{!N||!j||(typeof j=="string"&&(j=j.split(/\s+/).filter(Boolean)),j.forEach(Me=>{Array.isArray(N)?N.forEach(Ct=>{oe?Ct.classList.add(Me):Ct.classList.remove(Me)}):oe?N.classList.add(Me):N.classList.remove(Me)}))},lr=(N,j)=>{jl(N,j,!0)},Hr=(N,j)=>{jl(N,j,!1)},Ns=(N,j)=>{let oe=Array.from(N.children);for(let Me=0;Me<oe.length;Me++){let Ct=oe[Me];if(Ct instanceof HTMLElement&&Wo(Ct,j))return Ct}},vs=(N,j,oe)=>{oe===`${parseInt(`${oe}`)}`&&(oe=parseInt(oe)),oe||parseInt(`${oe}`)===0?N.style.setProperty(j,typeof oe=="number"?`${oe}px`:oe):N.style.removeProperty(j)},Zr=(N,j="flex")=>{N&&(N.style.display=j)},vo=N=>{N&&(N.style.display="none")},ss=(N,j="block")=>{N&&new MutationObserver(()=>{qs(N,N.innerHTML,j)}).observe(N,{childList:!0,subtree:!0})},fc=(N,j,oe,Me)=>{let Ct=N.querySelector(j);Ct&&Ct.style.setProperty(oe,Me)},qs=(N,j,oe="flex")=>{j?Zr(N,oe):vo(N)},No=N=>!!(N&&(N.offsetWidth||N.offsetHeight||N.getClientRects().length)),zu=()=>!No(eo())&&!No(Do())&&!No(Ui()),Xr=N=>N.scrollHeight>N.clientHeight,jc=(N,j)=>{let oe=N;for(;oe&&oe!==j;){if(Xr(oe))return!0;oe=oe.parentElement}return!1},Vc=N=>{let j=window.getComputedStyle(N),oe=parseFloat(j.getPropertyValue("animation-duration")||"0"),Me=parseFloat(j.getPropertyValue("transition-duration")||"0");return oe>0||Me>0},Wa=(N,j=!1)=>{let oe=Li();oe&&No(oe)&&(j&&(oe.style.transition="none",oe.style.width="100%"),setTimeout(()=>{oe.style.transition=`width ${N/1e3}s linear`,oe.style.width="0%"},10))},Za=()=>{let N=Li();if(!N)return;let j=parseInt(window.getComputedStyle(N).width);N.style.removeProperty("transition"),N.style.width="100%";let oe=parseInt(window.getComputedStyle(N).width),Me=j/oe*100;N.style.width=`${Me}%`},Sa=()=>typeof window>"u"||typeof document>"u",gr=`
 <div aria-labelledby="${te.title}" aria-describedby="${te["html-container"]}" class="${te.popup}" tabindex="-1">
   <button type="button" class="${te.close}"></button>
   <ul class="${te["progress-steps"]}"></ul>
   <div class="${te.icon}"></div>
   <img class="${te.image}" />
   <h2 class="${te.title}" id="${te.title}"></h2>
   <div class="${te["html-container"]}" id="${te["html-container"]}"></div>
   <input class="${te.input}" id="${te.input}" />
   <input type="file" class="${te.file}" />
   <div class="${te.range}">
     <input type="range" />
     <output></output>
   </div>
   <select class="${te.select}" id="${te.select}"></select>
   <div class="${te.radio}"></div>
   <label class="${te.checkbox}">
     <input type="checkbox" id="${te.checkbox}" />
     <span class="${te.label}"></span>
   </label>
   <textarea class="${te.textarea}" id="${te.textarea}"></textarea>
   <div class="${te["validation-message"]}" id="${te["validation-message"]}"></div>
   <div class="${te.actions}">
     <div class="${te.loader}"></div>
     <button type="button" class="${te.confirm}"></button>
     <button type="button" class="${te.deny}"></button>
     <button type="button" class="${te.cancel}"></button>
   </div>
   <div class="${te.footer}"></div>
   <div class="${te["timer-progress-bar-container"]}">
     <div class="${te["timer-progress-bar"]}"></div>
   </div>
 </div>
`.replace(/(^|\n)\s*/g,""),Zo=()=>{let N=$n();return N?(N.remove(),Hr([document.documentElement,document.body],[te["no-backdrop"],te["toast-shown"],te["has-column"]]),!0):!1},da=()=>{E.currentInstance.resetValidationMessage()},pc=()=>{let N=en(),j=Ns(N,te.input),oe=Ns(N,te.file),Me=N.querySelector(`.${te.range} input`),Ct=N.querySelector(`.${te.range} output`),_n=Ns(N,te.select),Hi=N.querySelector(`.${te.checkbox} input`),Tr=Ns(N,te.textarea);j.oninput=da,oe.onchange=da,_n.onchange=da,Hi.onchange=da,Tr.oninput=da,Me.oninput=()=>{da(),Ct.value=Me.value},Me.onchange=()=>{da(),Ct.value=Me.value}},ha=N=>typeof N=="string"?document.querySelector(N):N,lf=N=>{let j=en();j.setAttribute("role",N.toast?"alert":"dialog"),j.setAttribute("aria-live",N.toast?"polite":"assertive"),N.toast||j.setAttribute("aria-modal","true")},Gd=N=>{window.getComputedStyle(N).direction==="rtl"&&lr($n(),te.rtl)},jp=N=>{let j=Zo();if(Sa()){kt("SweetAlert2 requires document to initialize");return}let oe=document.createElement("div");oe.className=te.container,j&&lr(oe,te["no-transition"]),co(oe,gr),oe.dataset.swal2Theme=N.theme;let Me=ha(N.target);Me.appendChild(oe),N.topLayer&&(oe.setAttribute("popover",""),oe.showPopover()),lf(N),Gd(Me),pc()},mc=(N,j)=>{N instanceof HTMLElement?j.appendChild(N):typeof N=="object"?ct(N,j):N&&co(j,N)},ct=(N,j)=>{N.jquery?Vl(j,N):co(j,N.toString())},Vl=(N,j)=>{if(N.textContent="",0 in j)for(let oe=0;oe in j;oe++)N.appendChild(j[oe].cloneNode(!0));else N.appendChild(j.cloneNode(!0))},qd=(N,j)=>{let oe=Bl(),Me=$a();!oe||!Me||(!j.showConfirmButton&&!j.showDenyButton&&!j.showCancelButton?vo(oe):Zr(oe),os(oe,j,"actions"),Wd(oe,Me,j),co(Me,j.loaderHtml||""),os(Me,j,"loader"))};function Wd(N,j,oe){let Me=eo(),Ct=Do(),_n=Ui();!Me||!Ct||!_n||(Zd(Me,"confirm",oe),Zd(Ct,"deny",oe),Zd(_n,"cancel",oe),Wn(Me,Ct,_n,oe),oe.reverseButtons&&(oe.toast?(N.insertBefore(_n,Me),N.insertBefore(Ct,Me)):(N.insertBefore(_n,j),N.insertBefore(Ct,j),N.insertBefore(Me,j))))}function Wn(N,j,oe,Me){if(!Me.buttonsStyling){Hr([N,j,oe],te.styled);return}lr([N,j,oe],te.styled),Me.confirmButtonColor&&N.style.setProperty("--swal2-confirm-button-background-color",Me.confirmButtonColor),Me.denyButtonColor&&j.style.setProperty("--swal2-deny-button-background-color",Me.denyButtonColor),Me.cancelButtonColor&&oe.style.setProperty("--swal2-cancel-button-background-color",Me.cancelButtonColor),zo(N),zo(j),zo(oe)}function zo(N){let j=window.getComputedStyle(N);if(j.getPropertyValue("--swal2-action-button-focus-box-shadow"))return;let oe=j.backgroundColor.replace(/rgba?\((\d+), (\d+), (\d+).*/,"rgba($1, $2, $3, 0.5)");N.style.setProperty("--swal2-action-button-focus-box-shadow",j.getPropertyValue("--swal2-outline").replace(/ rgba\(.*/,` ${oe}`))}function Zd(N,j,oe){let Me=Tt(j);qs(N,oe[`show${Me}Button`],"inline-block"),co(N,oe[`${j}ButtonText`]||""),N.setAttribute("aria-label",oe[`${j}ButtonAriaLabel`]||""),N.className=te[j],os(N,oe,`${j}Button`)}let Xd=(N,j)=>{let oe=Vr();oe&&(co(oe,j.closeButtonHtml||""),os(oe,j,"closeButton"),qs(oe,j.showCloseButton),oe.setAttribute("aria-label",j.closeButtonAriaLabel||""))},Oe=(N,j)=>{let oe=$n();oe&&(q(oe,j.backdrop),X(oe,j.position),de(oe,j.grow),os(oe,j,"container"))};function q(N,j){typeof j=="string"?N.style.background=j:j||lr([document.documentElement,document.body],te["no-backdrop"])}function X(N,j){j&&(j in te?lr(N,te[j]):(ot('The "position" parameter is not valid, defaulting to "center"'),lr(N,te.center)))}function de(N,j){j&&lr(N,te[`grow-${j}`])}var ye={innerParams:new WeakMap,domCache:new WeakMap};let Ce=["input","file","range","select","radio","checkbox","textarea"],De=(N,j)=>{let oe=en();if(!oe)return;let Me=ye.innerParams.get(N),Ct=!Me||j.input!==Me.input;Ce.forEach(_n=>{let Hi=Ns(oe,te[_n]);Hi&&(Ve(_n,j.inputAttributes),Hi.className=te[_n],Ct&&vo(Hi))}),j.input&&(Ct&&He(j),ht(j))},He=N=>{if(!N.input)return;if(!Gt[N.input]){kt(`Unexpected type of input! Expected ${Object.keys(Gt).join(" | ")}, got "${N.input}"`);return}let j=fn(N.input);if(!j)return;let oe=Gt[N.input](j,N);Zr(j),N.inputAutoFocus&&setTimeout(()=>{Ls(oe)})},Pe=N=>{for(let j=0;j<N.attributes.length;j++){let oe=N.attributes[j].name;["id","type","value","style"].includes(oe)||N.removeAttribute(oe)}},Ve=(N,j)=>{let oe=en();if(!oe)return;let Me=_l(oe,N);if(Me){Pe(Me);for(let Ct in j)Me.setAttribute(Ct,j[Ct])}},ht=N=>{if(!N.input)return;let j=fn(N.input);j&&os(j,N,"input")},st=(N,j)=>{!N.placeholder&&j.inputPlaceholder&&(N.placeholder=j.inputPlaceholder)},Ht=(N,j,oe)=>{if(oe.inputLabel){let Me=document.createElement("label"),Ct=te["input-label"];Me.setAttribute("for",N.id),Me.className=Ct,typeof oe.customClass=="object"&&lr(Me,oe.customClass.inputLabel),Me.innerText=oe.inputLabel,j.insertAdjacentElement("beforebegin",Me)}},fn=N=>{let j=en();if(j)return Ns(j,te[N]||te.input)},an=(N,j)=>{["string","number"].includes(typeof j)?N.value=`${j}`:Er(j)||ot(`Unexpected type of inputValue! Expected "string", "number" or "Promise", got "${typeof j}"`)},Gt={};Gt.text=Gt.email=Gt.password=Gt.number=Gt.tel=Gt.url=Gt.search=Gt.date=Gt["datetime-local"]=Gt.time=Gt.week=Gt.month=(N,j)=>(an(N,j.inputValue),Ht(N,N,j),st(N,j),N.type=j.input,N),Gt.file=(N,j)=>(Ht(N,N,j),st(N,j),N),Gt.range=(N,j)=>{let oe=N.querySelector("input"),Me=N.querySelector("output");return an(oe,j.inputValue),oe.type=j.input,an(Me,j.inputValue),Ht(oe,N,j),N},Gt.select=(N,j)=>{if(N.textContent="",j.inputPlaceholder){let oe=document.createElement("option");co(oe,j.inputPlaceholder),oe.value="",oe.disabled=!0,oe.selected=!0,N.appendChild(oe)}return Ht(N,N,j),N},Gt.radio=N=>(N.textContent="",N),Gt.checkbox=(N,j)=>{let oe=_l(en(),"checkbox");oe.value="1",oe.checked=!!j.inputValue;let Me=N.querySelector("span");return co(Me,j.inputPlaceholder||j.inputLabel),oe},Gt.textarea=(N,j)=>{an(N,j.inputValue),st(N,j),Ht(N,N,j);let oe=Me=>parseInt(window.getComputedStyle(Me).marginLeft)+parseInt(window.getComputedStyle(Me).marginRight);return setTimeout(()=>{if("MutationObserver"in window){let Me=parseInt(window.getComputedStyle(en()).width),Ct=()=>{if(!document.body.contains(N))return;let _n=N.offsetWidth+oe(N);_n>Me?en().style.width=`${_n}px`:vs(en(),"width",j.width)};new MutationObserver(Ct).observe(N,{attributes:!0,attributeFilter:["style"]})}}),N};let Rn=(N,j)=>{let oe=Pr();oe&&(ss(oe),os(oe,j,"htmlContainer"),j.html?(mc(j.html,oe),Zr(oe,"block")):j.text?(oe.textContent=j.text,Zr(oe,"block")):vo(oe),De(N,j))},zn=(N,j)=>{let oe=Ga();oe&&(ss(oe),qs(oe,!!j.footer,"block"),j.footer&&mc(j.footer,oe),os(oe,j,"footer"))},Di=(N,j)=>{let oe=ye.innerParams.get(N),Me=ai();if(!Me)return;if(oe&&j.icon===oe.icon){bi(Me,j),_r(Me,j);return}if(!j.icon&&!j.iconHtml){vo(Me);return}if(j.icon&&Object.keys(Ae).indexOf(j.icon)===-1){kt(`Unknown icon! Expected "success", "error", "warning", "info" or "question", got "${j.icon}"`),vo(Me);return}Zr(Me),bi(Me,j),_r(Me,j),lr(Me,j.showClass&&j.showClass.icon),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",Yr)},_r=(N,j)=>{for(let[oe,Me]of Object.entries(Ae))j.icon!==oe&&Hr(N,Me);lr(N,j.icon&&Ae[j.icon]),Zn(N,j),Yr(),os(N,j,"icon")},Yr=()=>{let N=en();if(!N)return;let j=window.getComputedStyle(N).getPropertyValue("background-color"),oe=N.querySelectorAll("[class^=swal2-success-circular-line], .swal2-success-fix");for(let Me=0;Me<oe.length;Me++)oe[Me].style.backgroundColor=j},Fr=N=>`
  ${N.animation?'<div class="swal2-success-circular-line-left"></div>':""}
  <span class="swal2-success-line-tip"></span> <span class="swal2-success-line-long"></span>
  <div class="swal2-success-ring"></div>
  ${N.animation?'<div class="swal2-success-fix"></div>':""}
  ${N.animation?'<div class="swal2-success-circular-line-right"></div>':""}
`,Or=`
  <span class="swal2-x-mark">
    <span class="swal2-x-mark-line-left"></span>
    <span class="swal2-x-mark-line-right"></span>
  </span>
`,bi=(N,j)=>{if(!j.icon&&!j.iconHtml)return;let oe=N.innerHTML,Me="";j.iconHtml?Me=er(j.iconHtml):j.icon==="success"?(Me=Fr(j),oe=oe.replace(/ style=".*?"/g,"")):j.icon==="error"?Me=Or:j.icon&&(Me=er({question:"?",warning:"!",info:"i"}[j.icon])),oe.trim()!==Me.trim()&&co(N,Me)},Zn=(N,j)=>{if(j.iconColor){N.style.color=j.iconColor,N.style.borderColor=j.iconColor;for(let oe of[".swal2-success-line-tip",".swal2-success-line-long",".swal2-x-mark-line-left",".swal2-x-mark-line-right"])fc(N,oe,"background-color",j.iconColor);fc(N,".swal2-success-ring","border-color",j.iconColor)}},er=N=>`<div class="${te["icon-content"]}">${N}</div>`,vr=(N,j)=>{let oe=Oo();if(oe){if(!j.imageUrl){vo(oe);return}Zr(oe,""),oe.setAttribute("src",j.imageUrl),oe.setAttribute("alt",j.imageAlt||""),vs(oe,"width",j.imageWidth),vs(oe,"height",j.imageHeight),oe.className=te.image,os(oe,j,"image")}},Ei=!1,tr=0,oo=0,Xo=0,fa=0,Uc=N=>{N.addEventListener("mousedown",zs),document.body.addEventListener("mousemove",Bo),N.addEventListener("mouseup",Ws),N.addEventListener("touchstart",zs),document.body.addEventListener("touchmove",Bo),N.addEventListener("touchend",Ws)},yo=N=>{N.removeEventListener("mousedown",zs),document.body.removeEventListener("mousemove",Bo),N.removeEventListener("mouseup",Ws),N.removeEventListener("touchstart",zs),document.body.removeEventListener("touchmove",Bo),N.removeEventListener("touchend",Ws)},zs=N=>{let j=en();if(N.target===j||ai().contains(N.target)){Ei=!0;let oe=Bs(N);tr=oe.clientX,oo=oe.clientY,Xo=parseInt(j.style.insetInlineStart)||0,fa=parseInt(j.style.insetBlockStart)||0,lr(j,"swal2-dragging")}},Bo=N=>{let j=en();if(Ei){let{clientX:oe,clientY:Me}=Bs(N);j.style.insetInlineStart=`${Xo+(oe-tr)}px`,j.style.insetBlockStart=`${fa+(Me-oo)}px`}},Ws=()=>{let N=en();Ei=!1,Hr(N,"swal2-dragging")},Bs=N=>{let j=0,oe=0;return N.type.startsWith("mouse")?(j=N.clientX,oe=N.clientY):N.type.startsWith("touch")&&(j=N.touches[0].clientX,oe=N.touches[0].clientY),{clientX:j,clientY:oe}},Zs=(N,j)=>{let oe=$n(),Me=en();if(!(!oe||!Me)){if(j.toast){vs(oe,"width",j.width),Me.style.width="100%";let Ct=$a();Ct&&Me.insertBefore(Ct,ai())}else vs(Me,"width",j.width);vs(Me,"padding",j.padding),j.color&&(Me.style.color=j.color),j.background&&(Me.style.background=j.background),vo(Fs()),cf(Me,j),j.draggable&&!j.toast?(lr(Me,te.draggable),Uc(Me)):(Hr(Me,te.draggable),yo(Me))}},cf=(N,j)=>{let oe=j.showClass||{};N.className=`${te.popup} ${No(N)?oe.popup:""}`,j.toast?(lr([document.documentElement,document.body],te["toast-shown"]),lr(N,te.toast)):lr(N,te.modal),os(N,j,"popup"),typeof j.customClass=="string"&&lr(N,j.customClass),j.icon&&lr(N,te[`icon-${j.icon}`])},Yd=(N,j)=>{let oe=ks();if(!oe)return;let{progressSteps:Me,currentProgressStep:Ct}=j;if(!Me||Me.length===0||Ct===void 0){vo(oe);return}Zr(oe),oe.textContent="",Ct>=Me.length&&ot("Invalid currentProgressStep parameter, it should be less than progressSteps.length (currentProgressStep like JS arrays starts from 0)"),Me.forEach((_n,Hi)=>{let Tr=Kd(_n);if(oe.appendChild(Tr),Hi===Ct&&lr(Tr,te["active-progress-step"]),Hi!==Me.length-1){let no=Jd(j);oe.appendChild(no)}})},Kd=N=>{let j=document.createElement("li");return lr(j,te["progress-step"]),co(j,N),j},Jd=N=>{let j=document.createElement("li");return lr(j,te["progress-step-line"]),N.progressStepsDistance&&vs(j,"width",N.progressStepsDistance),j},js=(N,j)=>{let oe=Wi();oe&&(ss(oe),qs(oe,!!(j.title||j.titleText),"block"),j.title&&mc(j.title,oe),j.titleText&&(oe.innerText=j.titleText),os(oe,j,"title"))},Da=(N,j)=>{Zs(N,j),Oe(N,j),Yd(N,j),Di(N,j),vr(N,j),js(N,j),Xd(N,j),Rn(N,j),qd(N,j),zn(N,j);let oe=en();typeof j.didRender=="function"&&oe&&j.didRender(oe),E.eventEmitter.emit("didRender",oe)},ys=()=>No(en()),Xs=()=>{var N;return(N=eo())===null||N===void 0?void 0:N.click()},Ul=()=>{var N;return(N=Do())===null||N===void 0?void 0:N.click()},Hc=()=>{var N;return(N=Ui())===null||N===void 0?void 0:N.click()},Hl=Object.freeze({cancel:"cancel",backdrop:"backdrop",close:"close",esc:"esc",timer:"timer"}),Qd=N=>{N.keydownTarget&&N.keydownHandlerAdded&&(N.keydownTarget.removeEventListener("keydown",N.keydownHandler,{capture:N.keydownListenerCapture}),N.keydownHandlerAdded=!1)},vl=(N,j,oe)=>{Qd(N),j.toast||(N.keydownHandler=Me=>Ia(j,Me,oe),N.keydownTarget=j.keydownListenerCapture?window:en(),N.keydownListenerCapture=j.keydownListenerCapture,N.keydownTarget.addEventListener("keydown",N.keydownHandler,{capture:N.keydownListenerCapture}),N.keydownHandlerAdded=!0)},yl=(N,j)=>{var oe;let Me=hc();if(Me.length){N=N+j,N===-2&&(N=Me.length-1),N===Me.length?N=0:N===-1&&(N=Me.length-1),Me[N].focus();return}(oe=en())===null||oe===void 0||oe.focus()},uf=["ArrowRight","ArrowDown"],Mg=["ArrowLeft","ArrowUp"],Ia=(N,j,oe)=>{N&&(j.isComposing||j.keyCode===229||(N.stopKeydownPropagation&&j.stopPropagation(),j.key==="Enter"?Vp(j,N):j.key==="Tab"?$c(j):[...uf,...Mg].includes(j.key)?Gc(j.key):j.key==="Escape"&&Up(j,N,oe)))},Vp=(N,j)=>{if(!Vn(j.allowEnterKey))return;let oe=_l(en(),j.input);if(N.target&&oe&&N.target instanceof HTMLElement&&N.target.outerHTML===oe.outerHTML){if(["textarea","file"].includes(j.input))return;Xs(),N.preventDefault()}},$c=N=>{let j=N.target,oe=hc(),Me=-1;for(let Ct=0;Ct<oe.length;Ct++)if(j===oe[Ct]){Me=Ct;break}N.shiftKey?yl(Me,-1):yl(Me,1),N.stopPropagation(),N.preventDefault()},Gc=N=>{let j=Bl(),oe=eo(),Me=Do(),Ct=Ui();if(!j||!oe||!Me||!Ct)return;let _n=[oe,Me,Ct];if(document.activeElement instanceof HTMLElement&&!_n.includes(document.activeElement))return;let Hi=uf.includes(N)?"nextElementSibling":"previousElementSibling",Tr=document.activeElement;if(Tr){for(let no=0;no<j.children.length;no++){if(Tr=Tr[Hi],!Tr)return;if(Tr instanceof HTMLButtonElement&&No(Tr))break}Tr instanceof HTMLButtonElement&&Tr.focus()}},Up=(N,j,oe)=>{N.preventDefault(),Vn(j.allowEscapeKey)&&oe(Hl.esc)};var xl={swalPromiseResolve:new WeakMap,swalPromiseReject:new WeakMap};let Bu=()=>{let N=$n();Array.from(document.body.children).forEach(oe=>{oe.contains(N)||(oe.hasAttribute("aria-hidden")&&oe.setAttribute("data-previous-aria-hidden",oe.getAttribute("aria-hidden")||""),oe.setAttribute("aria-hidden","true"))})},si=()=>{Array.from(document.body.children).forEach(j=>{j.hasAttribute("data-previous-aria-hidden")?(j.setAttribute("aria-hidden",j.getAttribute("data-previous-aria-hidden")||""),j.removeAttribute("data-previous-aria-hidden")):j.removeAttribute("aria-hidden")})},df=typeof window<"u"&&!!window.GestureEvent,eh=()=>{if(df&&!Wo(document.body,te.iosfix)){let N=document.body.scrollTop;document.body.style.top=`${N*-1}px`,lr(document.body,te.iosfix),th()}},th=()=>{let N=$n();if(!N)return;let j;N.ontouchstart=oe=>{j=Hp(oe)},N.ontouchmove=oe=>{j&&(oe.preventDefault(),oe.stopPropagation())}},Hp=N=>{let j=N.target,oe=$n(),Me=Pr();return!oe||!Me||nh(N)||ih(N)?!1:j===oe||!Xr(oe)&&j instanceof HTMLElement&&!jc(j,Me)&&j.tagName!=="INPUT"&&j.tagName!=="TEXTAREA"&&!(Xr(Me)&&Me.contains(j))},nh=N=>N.touches&&N.touches.length&&N.touches[0].touchType==="stylus",ih=N=>N.touches&&N.touches.length>1,rh=()=>{if(Wo(document.body,te.iosfix)){let N=parseInt(document.body.style.top,10);Hr(document.body,te.iosfix),document.body.style.top="",document.body.scrollTop=N*-1}},qc=()=>{let N=document.createElement("div");N.className=te["scrollbar-measure"],document.body.appendChild(N);let j=N.getBoundingClientRect().width-N.clientWidth;return document.body.removeChild(N),j},Wc=null,hf=N=>{Wc===null&&(document.body.scrollHeight>window.innerHeight||N==="scroll")&&(Wc=parseInt(window.getComputedStyle(document.body).getPropertyValue("padding-right")),document.body.style.paddingRight=`${Wc+qc()}px`)},Cv=()=>{Wc!==null&&(document.body.style.paddingRight=`${Wc}px`,Wc=null)};function ju(N,j,oe,Me){qa()?ff(N,Me):(L(oe).then(()=>ff(N,Me)),Qd(E)),df?(j.setAttribute("style","display:none !important"),j.removeAttribute("class"),j.innerHTML=""):j.remove(),pr()&&(Cv(),rh(),si()),pa()}function pa(){Hr([document.documentElement,document.body],[te.shown,te["height-auto"],te["no-backdrop"],te["toast-shown"]])}function Ma(N){N=uo(N);let j=xl.swalPromiseResolve.get(this),oe=Vu(this);this.isAwaitingPromise?N.isDismissed||(ma(this),j(N)):oe&&j(N)}let Vu=N=>{let j=en();if(!j)return!1;let oe=ye.innerParams.get(N);if(!oe||Wo(j,oe.hideClass.popup))return!1;Hr(j,oe.showClass.popup),lr(j,oe.hideClass.popup);let Me=$n();return Hr(Me,oe.showClass.backdrop),lr(Me,oe.hideClass.backdrop),$p(N,j,oe),!0};function Uu(N){let j=xl.swalPromiseReject.get(this);ma(this),j&&j(N)}let ma=N=>{N.isAwaitingPromise&&(delete N.isAwaitingPromise,ye.innerParams.get(N)||N._destroy())},uo=N=>typeof N>"u"?{isConfirmed:!1,isDenied:!1,isDismissed:!0}:Object.assign({isConfirmed:!1,isDenied:!1,isDismissed:!1},N),$p=(N,j,oe)=>{var Me;let Ct=$n(),_n=Vc(j);typeof oe.willClose=="function"&&oe.willClose(j),(Me=E.eventEmitter)===null||Me===void 0||Me.emit("willClose",j),_n?Gp(N,j,Ct,oe.returnFocus,oe.didClose):ju(N,Ct,oe.returnFocus,oe.didClose)},Gp=(N,j,oe,Me,Ct)=>{E.swalCloseEventFinishedCallback=ju.bind(null,N,oe,Me,Ct);let _n=function(Hi){if(Hi.target===j){var Tr;(Tr=E.swalCloseEventFinishedCallback)===null||Tr===void 0||Tr.call(E),delete E.swalCloseEventFinishedCallback,j.removeEventListener("animationend",_n),j.removeEventListener("transitionend",_n)}};j.addEventListener("animationend",_n),j.addEventListener("transitionend",_n)},ff=(N,j)=>{setTimeout(()=>{var oe;typeof j=="function"&&j.bind(N.params)(),(oe=E.eventEmitter)===null||oe===void 0||oe.emit("didClose"),N._destroy&&N._destroy()})},Qn=N=>{let j=en();if(j||new fh,j=en(),!j)return;let oe=$a();qa()?vo(ai()):qp(j,N),Zr(oe),j.setAttribute("data-loading","true"),j.setAttribute("aria-busy","true"),j.focus()},qp=(N,j)=>{let oe=Bl(),Me=$a();!oe||!Me||(!j&&No(eo())&&(j=eo()),Zr(oe),j&&(vo(j),Me.setAttribute("data-button-to-replace",j.className),oe.insertBefore(Me,j)),lr([N,oe],te.loading))},Ag=(N,j)=>{j.input==="select"||j.input==="radio"?Aa(N,j):["text","email","number","tel","textarea"].some(oe=>oe===j.input)&&(rr(j.inputValue)||Er(j.inputValue))&&(Qn(eo()),Pa(N,j))},Pg=(N,j)=>{let oe=N.getInput();if(!oe)return null;switch(j.input){case"checkbox":return ln(oe);case"radio":return oh(oe);case"file":return $l(oe);default:return j.inputAutoTrim?oe.value.trim():oe.value}},ln=N=>N.checked?1:0,oh=N=>N.checked?N.value:null,$l=N=>N.files&&N.files.length?N.getAttribute("multiple")!==null?N.files:N.files[0]:null,Aa=(N,j)=>{let oe=en();if(!oe)return;let Me=Ct=>{j.input==="select"?Hu(oe,Yn(Ct),j):j.input==="radio"&&Kt(oe,Yn(Ct),j)};rr(j.inputOptions)||Er(j.inputOptions)?(Qn(eo()),Vi(j.inputOptions).then(Ct=>{N.hideLoading(),Me(Ct)})):typeof j.inputOptions=="object"?Me(j.inputOptions):kt(`Unexpected type of inputOptions! Expected object, Map or Promise, got ${typeof j.inputOptions}`)},Pa=(N,j)=>{let oe=N.getInput();oe&&(vo(oe),Vi(j.inputValue).then(Me=>{oe.value=j.input==="number"?`${parseFloat(Me)||0}`:`${Me}`,Zr(oe),oe.focus(),N.hideLoading()}).catch(Me=>{kt(`Error in inputValue promise: ${Me}`),oe.value="",Zr(oe),oe.focus(),N.hideLoading()}))};function Hu(N,j,oe){let Me=Ns(N,te.select);if(!Me)return;let Ct=(_n,Hi,Tr)=>{let no=document.createElement("option");no.value=Tr,co(no,Hi),no.selected=li(Tr,oe.inputValue),_n.appendChild(no)};j.forEach(_n=>{let Hi=_n[0],Tr=_n[1];if(Array.isArray(Tr)){let no=document.createElement("optgroup");no.label=Hi,no.disabled=!1,Me.appendChild(no),Tr.forEach(eu=>Ct(no,eu[1],eu[0]))}else Ct(Me,Tr,Hi)}),Me.focus()}function Kt(N,j,oe){let Me=Ns(N,te.radio);if(!Me)return;j.forEach(_n=>{let Hi=_n[0],Tr=_n[1],no=document.createElement("input"),eu=document.createElement("label");no.type="radio",no.name=te.radio,no.value=Hi,li(Hi,oe.inputValue)&&(no.checked=!0);let xc=document.createElement("span");co(xc,Tr),xc.className=te.label,eu.appendChild(no),eu.appendChild(xc),Me.appendChild(eu)});let Ct=Me.querySelectorAll("input");Ct.length&&Ct[0].focus()}let Yn=N=>{let j=[];return N instanceof Map?N.forEach((oe,Me)=>{let Ct=oe;typeof Ct=="object"&&(Ct=Yn(Ct)),j.push([Me,Ct])}):Object.keys(N).forEach(oe=>{let Me=N[oe];typeof Me=="object"&&(Me=Yn(Me)),j.push([oe,Me])}),j},li=(N,j)=>!!j&&j.toString()===N.toString(),Ys=N=>{let j=ye.innerParams.get(N);N.disableButtons(),j.input?Gu(N,"confirm"):Wp(N,!0)},$u=N=>{let j=ye.innerParams.get(N);N.disableButtons(),j.returnInputValueOnDeny?Gu(N,"deny"):Xc(N,!1)},wi=(N,j)=>{N.disableButtons(),j(Hl.cancel)},Gu=(N,j)=>{let oe=ye.innerParams.get(N);if(!oe.input){kt(`The "input" parameter is needed to be set when using returnInputValueOn${Tt(j)}`);return}let Me=N.getInput(),Ct=Pg(N,oe);oe.inputValidator?Zc(N,Ct,j):Me&&!Me.checkValidity()?(N.enableButtons(),N.showValidationMessage(oe.validationMessage||Me.validationMessage)):j==="deny"?Xc(N,Ct):Wp(N,Ct)},Zc=(N,j,oe)=>{let Me=ye.innerParams.get(N);N.disableInput(),Promise.resolve().then(()=>Vi(Me.inputValidator(j,Me.validationMessage))).then(_n=>{N.enableButtons(),N.enableInput(),_n?N.showValidationMessage(_n):oe==="deny"?Xc(N,j):Wp(N,j)})},Xc=(N,j)=>{let oe=ye.innerParams.get(N||void 0);oe.showLoaderOnDeny&&Qn(Do()),oe.preDeny?(N.isAwaitingPromise=!0,Promise.resolve().then(()=>Vi(oe.preDeny(j,oe.validationMessage))).then(Ct=>{Ct===!1?(N.hideLoading(),ma(N)):N.close({isDenied:!0,value:typeof Ct>"u"?j:Ct})}).catch(Ct=>to(N||void 0,Ct))):N.close({isDenied:!0,value:j})},Io=(N,j)=>{N.close({isConfirmed:!0,value:j})},to=(N,j)=>{N.rejectPromise(j)},Wp=(N,j)=>{let oe=ye.innerParams.get(N||void 0);oe.showLoaderOnConfirm&&Qn(),oe.preConfirm?(N.resetValidationMessage(),N.isAwaitingPromise=!0,Promise.resolve().then(()=>Vi(oe.preConfirm(j,oe.validationMessage))).then(Ct=>{No(Fs())||Ct===!1?(N.hideLoading(),ma(N)):Io(N,typeof Ct>"u"?j:Ct)}).catch(Ct=>to(N||void 0,Ct))):Io(N,j)};function gc(){let N=ye.innerParams.get(this);if(!N)return;let j=ye.domCache.get(this);vo(j.loader),qa()?N.icon&&Zr(ai()):Zp(j),Hr([j.popup,j.actions],te.loading),j.popup.removeAttribute("aria-busy"),j.popup.removeAttribute("data-loading"),j.confirmButton.disabled=!1,j.denyButton.disabled=!1,j.cancelButton.disabled=!1}let Zp=N=>{let j=N.popup.getElementsByClassName(N.loader.getAttribute("data-button-to-replace"));j.length?Zr(j[0],"inline-block"):zu()&&vo(N.actions)};function qu(){let N=ye.innerParams.get(this),j=ye.domCache.get(this);return j?_l(j.popup,N.input):null}function sh(N,j,oe){let Me=ye.domCache.get(N);j.forEach(Ct=>{Me[Ct].disabled=oe})}function pf(N,j){let oe=en();if(!(!oe||!N))if(N.type==="radio"){let Me=oe.querySelectorAll(`[name="${te.radio}"]`);for(let Ct=0;Ct<Me.length;Ct++)Me[Ct].disabled=j}else N.disabled=j}function Wu(){sh(this,["confirmButton","denyButton","cancelButton"],!1)}function xo(){sh(this,["confirmButton","denyButton","cancelButton"],!0)}function bl(){pf(this.getInput(),!1)}function xs(){pf(this.getInput(),!0)}function ah(N){let j=ye.domCache.get(this),oe=ye.innerParams.get(this);co(j.validationMessage,N),j.validationMessage.className=te["validation-message"],oe.customClass&&oe.customClass.validationMessage&&lr(j.validationMessage,oe.customClass.validationMessage),Zr(j.validationMessage);let Me=this.getInput();Me&&(Me.setAttribute("aria-invalid","true"),Me.setAttribute("aria-describedby",te["validation-message"]),Ls(Me),lr(Me,te.inputerror))}function Yc(){let N=ye.domCache.get(this);N.validationMessage&&vo(N.validationMessage);let j=this.getInput();j&&(j.removeAttribute("aria-invalid"),j.removeAttribute("aria-describedby"),Hr(j,te.inputerror))}let $r={title:"",titleText:"",text:"",html:"",footer:"",icon:void 0,iconColor:void 0,iconHtml:void 0,template:void 0,toast:!1,draggable:!1,animation:!0,theme:"light",showClass:{popup:"swal2-show",backdrop:"swal2-backdrop-show",icon:"swal2-icon-show"},hideClass:{popup:"swal2-hide",backdrop:"swal2-backdrop-hide",icon:"swal2-icon-hide"},customClass:{},target:"body",color:void 0,backdrop:!0,heightAuto:!0,allowOutsideClick:!0,allowEscapeKey:!0,allowEnterKey:!0,stopKeydownPropagation:!0,keydownListenerCapture:!1,showConfirmButton:!0,showDenyButton:!1,showCancelButton:!1,preConfirm:void 0,preDeny:void 0,confirmButtonText:"OK",confirmButtonAriaLabel:"",confirmButtonColor:void 0,denyButtonText:"No",denyButtonAriaLabel:"",denyButtonColor:void 0,cancelButtonText:"Cancel",cancelButtonAriaLabel:"",cancelButtonColor:void 0,buttonsStyling:!0,reverseButtons:!1,focusConfirm:!0,focusDeny:!1,focusCancel:!1,returnFocus:!0,showCloseButton:!1,closeButtonHtml:"&times;",closeButtonAriaLabel:"Close this dialog",loaderHtml:"",showLoaderOnConfirm:!1,showLoaderOnDeny:!1,imageUrl:void 0,imageWidth:void 0,imageHeight:void 0,imageAlt:"",timer:void 0,timerProgressBar:!1,width:void 0,padding:void 0,background:void 0,input:void 0,inputPlaceholder:"",inputLabel:"",inputValue:"",inputOptions:{},inputAutoFocus:!0,inputAutoTrim:!0,inputAttributes:{},inputValidator:void 0,returnInputValueOnDeny:!1,validationMessage:void 0,grow:!1,position:"center",progressSteps:[],currentProgressStep:void 0,progressStepsDistance:void 0,willOpen:void 0,didOpen:void 0,didRender:void 0,willClose:void 0,didClose:void 0,didDestroy:void 0,scrollbarPadding:!0,topLayer:!1},wl=["allowEscapeKey","allowOutsideClick","background","buttonsStyling","cancelButtonAriaLabel","cancelButtonColor","cancelButtonText","closeButtonAriaLabel","closeButtonHtml","color","confirmButtonAriaLabel","confirmButtonColor","confirmButtonText","currentProgressStep","customClass","denyButtonAriaLabel","denyButtonColor","denyButtonText","didClose","didDestroy","draggable","footer","hideClass","html","icon","iconColor","iconHtml","imageAlt","imageHeight","imageUrl","imageWidth","preConfirm","preDeny","progressSteps","returnFocus","reverseButtons","showCancelButton","showCloseButton","showConfirmButton","showDenyButton","text","title","titleText","theme","willClose"],Gl={allowEnterKey:void 0},Lr=["allowOutsideClick","allowEnterKey","backdrop","draggable","focusConfirm","focusDeny","focusCancel","returnFocus","heightAuto","keydownListenerCapture"],In=N=>Object.prototype.hasOwnProperty.call($r,N),Vt=N=>wl.indexOf(N)!==-1,_c=N=>Gl[N],mn=N=>{In(N)||ot(`Unknown parameter "${N}"`)},Zu=N=>{Lr.includes(N)&&ot(`The parameter "${N}" is incompatible with toasts`)},mf=N=>{let j=_c(N);j&&On(N,j)},dn=N=>{N.backdrop===!1&&N.allowOutsideClick&&ot('"allowOutsideClick" parameter requires `backdrop` parameter to be set to `true`'),N.theme&&!["light","dark","auto","minimal","borderless","bootstrap-4","bootstrap-4-light","bootstrap-4-dark","bootstrap-5","bootstrap-5-light","bootstrap-5-dark","material-ui","material-ui-light","material-ui-dark","embed-iframe","bulma","bulma-light","bulma-dark"].includes(N.theme)&&ot(`Invalid theme "${N.theme}"`);for(let j in N)mn(j),N.toast&&Zu(j),mf(j)};function Xu(N){let j=$n(),oe=en(),Me=ye.innerParams.get(this);if(!oe||Wo(oe,Me.hideClass.popup)){ot("You're trying to update the closed or closing popup, that won't work. Use the update() method in preConfirm parameter or show a new popup.");return}let Ct=gf(N),_n=Object.assign({},Me,Ct);dn(_n),j.dataset.swal2Theme=_n.theme,Da(this,_n),ye.innerParams.set(this,_n),Object.defineProperties(this,{params:{value:Object.assign({},this.params,N),writable:!1,enumerable:!0}})}let gf=N=>{let j={};return Object.keys(N).forEach(oe=>{Vt(oe)?j[oe]=N[oe]:ot(`Invalid parameter to update: ${oe}`)}),j};function Xp(){let N=ye.domCache.get(this),j=ye.innerParams.get(this);if(!j){lh(this);return}N.popup&&E.swalCloseEventFinishedCallback&&(E.swalCloseEventFinishedCallback(),delete E.swalCloseEventFinishedCallback),typeof j.didDestroy=="function"&&j.didDestroy(),E.eventEmitter.emit("didDestroy"),Cl(this)}let Cl=N=>{lh(N),delete N.params,delete E.keydownHandler,delete E.keydownTarget,delete E.currentInstance},lh=N=>{N.isAwaitingPromise?(bo(ye,N),N.isAwaitingPromise=!0):(bo(xl,N),bo(ye,N),delete N.isAwaitingPromise,delete N.disableButtons,delete N.enableButtons,delete N.getInput,delete N.disableInput,delete N.enableInput,delete N.hideLoading,delete N.disableLoading,delete N.showValidationMessage,delete N.resetValidationMessage,delete N.close,delete N.closePopup,delete N.closeModal,delete N.closeToast,delete N.rejectPromise,delete N.update,delete N._destroy)},bo=(N,j)=>{for(let oe in N)N[oe].delete(j)};var as=Object.freeze({__proto__:null,_destroy:Xp,close:Ma,closeModal:Ma,closePopup:Ma,closeToast:Ma,disableButtons:xo,disableInput:xs,disableLoading:gc,enableButtons:Wu,enableInput:bl,getInput:qu,handleAwaitingPromise:ma,hideLoading:gc,rejectPromise:Uu,resetValidationMessage:Yc,showValidationMessage:ah,update:Xu});let Kc=(N,j,oe)=>{N.toast?Yu(N,j,oe):(Ev(j),Tv(j),ch(N,j,oe))},Yu=(N,j,oe)=>{j.popup.onclick=()=>{N&&(ql(N)||N.timer||N.input)||oe(Hl.close)}},ql=N=>!!(N.showConfirmButton||N.showDenyButton||N.showCancelButton||N.showCloseButton),ho=!1,Ev=N=>{N.popup.onmousedown=()=>{N.container.onmouseup=function(j){N.container.onmouseup=()=>{},j.target===N.container&&(ho=!0)}}},Tv=N=>{N.container.onmousedown=j=>{j.target===N.container&&j.preventDefault(),N.popup.onmouseup=function(oe){N.popup.onmouseup=()=>{},(oe.target===N.popup||oe.target instanceof HTMLElement&&N.popup.contains(oe.target))&&(ho=!0)}}},ch=(N,j,oe)=>{j.container.onclick=Me=>{if(ho){ho=!1;return}Me.target===j.container&&Vn(N.allowOutsideClick)&&oe(Hl.backdrop)}},vc=N=>typeof N=="object"&&N.jquery,Yp=N=>N instanceof Element||vc(N),Oa=N=>{let j={};return typeof N[0]=="object"&&!Yp(N[0])?Object.assign(j,N[0]):["title","html","icon"].forEach((oe,Me)=>{let Ct=N[Me];typeof Ct=="string"||Yp(Ct)?j[oe]=Ct:Ct!==void 0&&kt(`Unexpected type of ${oe}! Expected "string" or "Element", got ${typeof Ct}`)}),j};function Og(...N){return new this(...N)}function _f(N){class j extends this{_main(Me,Ct){return super._main(Me,Object.assign({},N,Ct))}}return j}let uh=()=>E.timeout&&E.timeout.getTimerLeft(),Wl=()=>{if(E.timeout)return Za(),E.timeout.stop()},Rg=()=>{if(E.timeout){let N=E.timeout.start();return Wa(N),N}},kg=()=>{let N=E.timeout;return N&&(N.running?Wl():Rg())},Sv=N=>{if(E.timeout){let j=E.timeout.increase(N);return Wa(j,!0),j}},yc=()=>!!(E.timeout&&E.timeout.isRunning()),Fg=!1,dh={};function vf(N="data-swal-template"){dh[N]=this,Fg||(document.body.addEventListener("click",Kp),Fg=!0)}let Kp=N=>{for(let j=N.target;j&&j!==document;j=j.parentNode)for(let oe in dh){let Me=j.getAttribute(oe);if(Me){dh[oe].fire({template:Me});return}}};class Jp{constructor(){this.events={}}_getHandlersByEventName(j){return typeof this.events[j]>"u"&&(this.events[j]=[]),this.events[j]}on(j,oe){let Me=this._getHandlersByEventName(j);Me.includes(oe)||Me.push(oe)}once(j,oe){let Me=(...Ct)=>{this.removeListener(j,Me),oe.apply(this,Ct)};this.on(j,Me)}emit(j,...oe){this._getHandlersByEventName(j).forEach(Me=>{try{Me.apply(this,oe)}catch(Ct){console.error(Ct)}})}removeListener(j,oe){let Me=this._getHandlersByEventName(j),Ct=Me.indexOf(oe);Ct>-1&&Me.splice(Ct,1)}removeAllListeners(j){this.events[j]!==void 0&&(this.events[j].length=0)}reset(){this.events={}}}E.eventEmitter=new Jp;var Qp=Object.freeze({__proto__:null,argsToParams:Oa,bindClickHandler:vf,clickCancel:Hc,clickConfirm:Xs,clickDeny:Ul,enableLoading:Qn,fire:Og,getActions:Bl,getCancelButton:Ui,getCloseButton:Vr,getConfirmButton:eo,getContainer:$n,getDenyButton:Do,getFocusableElements:hc,getFooter:Ga,getHtmlContainer:Pr,getIcon:ai,getIconContent:Fi,getImage:Oo,getInputLabel:Nu,getLoader:$a,getPopup:en,getProgressSteps:ks,getTimerLeft:uh,getTimerProgressBar:Li,getTitle:Wi,getValidationMessage:Fs,increaseTimer:Sv,isDeprecatedParameter:_c,isLoading:ua,isTimerRunning:yc,isUpdatableParameter:Vt,isValidParameter:In,isVisible:ys,mixin:_f,off:(N,j)=>{if(!N){E.eventEmitter.reset();return}j?E.eventEmitter.removeListener(N,j):E.eventEmitter.removeAllListeners(N)},on:(N,j)=>{E.eventEmitter.on(N,j)},once:(N,j)=>{E.eventEmitter.once(N,j)},resumeTimer:Rg,showLoading:Qn,stopTimer:Wl,toggleTimer:kg});class em{constructor(j,oe){this.callback=j,this.remaining=oe,this.running=!1,this.start()}start(){return this.running||(this.running=!0,this.started=new Date,this.id=setTimeout(this.callback,this.remaining)),this.remaining}stop(){return this.started&&this.running&&(this.running=!1,clearTimeout(this.id),this.remaining-=new Date().getTime()-this.started.getTime()),this.remaining}increase(j){let oe=this.running;return oe&&this.stop(),this.remaining+=j,oe&&this.start(),this.remaining}getTimerLeft(){return this.running&&(this.stop(),this.start()),this.remaining}isRunning(){return this.running}}let Jc=["swal-title","swal-html","swal-footer"],Ju=N=>{let j=typeof N.template=="string"?document.querySelector(N.template):N.template;if(!j)return{};let oe=j.content;return ed(oe),Object.assign(tm(oe),xf(oe),ga(oe),bf(oe),yt(oe),nm(oe),Qu(oe,Jc))},tm=N=>{let j={};return Array.from(N.querySelectorAll("swal-param")).forEach(Me=>{Ya(Me,["name","value"]);let Ct=Me.getAttribute("name"),_n=Me.getAttribute("value");!Ct||!_n||(typeof $r[Ct]=="boolean"?j[Ct]=_n!=="false":typeof $r[Ct]=="object"?j[Ct]=JSON.parse(_n):j[Ct]=_n)}),j},xf=N=>{let j={};return Array.from(N.querySelectorAll("swal-function-param")).forEach(Me=>{let Ct=Me.getAttribute("name"),_n=Me.getAttribute("value");!Ct||!_n||(j[Ct]=new Function(`return ${_n}`)())}),j},ga=N=>{let j={};return Array.from(N.querySelectorAll("swal-button")).forEach(Me=>{Ya(Me,["type","color","aria-label"]);let Ct=Me.getAttribute("type");!Ct||!["confirm","cancel","deny"].includes(Ct)||(j[`${Ct}ButtonText`]=Me.innerHTML,j[`show${Tt(Ct)}Button`]=!0,Me.hasAttribute("color")&&(j[`${Ct}ButtonColor`]=Me.getAttribute("color")),Me.hasAttribute("aria-label")&&(j[`${Ct}ButtonAriaLabel`]=Me.getAttribute("aria-label")))}),j},bf=N=>{let j={},oe=N.querySelector("swal-image");return oe&&(Ya(oe,["src","width","height","alt"]),oe.hasAttribute("src")&&(j.imageUrl=oe.getAttribute("src")||void 0),oe.hasAttribute("width")&&(j.imageWidth=oe.getAttribute("width")||void 0),oe.hasAttribute("height")&&(j.imageHeight=oe.getAttribute("height")||void 0),oe.hasAttribute("alt")&&(j.imageAlt=oe.getAttribute("alt")||void 0)),j},yt=N=>{let j={},oe=N.querySelector("swal-icon");return oe&&(Ya(oe,["type","color"]),oe.hasAttribute("type")&&(j.icon=oe.getAttribute("type")),oe.hasAttribute("color")&&(j.iconColor=oe.getAttribute("color")),j.iconHtml=oe.innerHTML),j},nm=N=>{let j={},oe=N.querySelector("swal-input");oe&&(Ya(oe,["type","label","placeholder","value"]),j.input=oe.getAttribute("type")||"text",oe.hasAttribute("label")&&(j.inputLabel=oe.getAttribute("label")),oe.hasAttribute("placeholder")&&(j.inputPlaceholder=oe.getAttribute("placeholder")),oe.hasAttribute("value")&&(j.inputValue=oe.getAttribute("value")));let Me=Array.from(N.querySelectorAll("swal-input-option"));return Me.length&&(j.inputOptions={},Me.forEach(Ct=>{Ya(Ct,["value"]);let _n=Ct.getAttribute("value");if(!_n)return;let Hi=Ct.innerHTML;j.inputOptions[_n]=Hi})),j},Qu=(N,j)=>{let oe={};for(let Me in j){let Ct=j[Me],_n=N.querySelector(Ct);_n&&(Ya(_n,[]),oe[Ct.replace(/^swal-/,"")]=_n.innerHTML.trim())}return oe},ed=N=>{let j=Jc.concat(["swal-param","swal-function-param","swal-button","swal-image","swal-icon","swal-input","swal-input-option"]);Array.from(N.children).forEach(oe=>{let Me=oe.tagName.toLowerCase();j.includes(Me)||ot(`Unrecognized element <${Me}>`)})},Ya=(N,j)=>{Array.from(N.attributes).forEach(oe=>{j.indexOf(oe.name)===-1&&ot([`Unrecognized attribute "${oe.name}" on <${N.tagName.toLowerCase()}>.`,`${j.length?`Allowed attributes are: ${j.join(", ")}`:"To set the value, use HTML within the element."}`])})},td=10,El=N=>{let j=$n(),oe=en();typeof N.willOpen=="function"&&N.willOpen(oe),E.eventEmitter.emit("willOpen",oe);let Ct=window.getComputedStyle(document.body).overflowY;nd(j,oe,N),setTimeout(()=>{Ra(j,oe)},td),pr()&&(Un(j,N.scrollbarPadding,Ct),Bu()),!qa()&&!E.previousActiveElement&&(E.previousActiveElement=document.activeElement),typeof N.didOpen=="function"&&setTimeout(()=>N.didOpen(oe)),E.eventEmitter.emit("didOpen",oe)},Qc=N=>{let j=en();if(N.target!==j)return;let oe=$n();j.removeEventListener("animationend",Qc),j.removeEventListener("transitionend",Qc),oe.style.overflowY="auto",Hr(oe,te["no-transition"])},Ra=(N,j)=>{Vc(j)?(N.style.overflowY="hidden",j.addEventListener("animationend",Qc),j.addEventListener("transitionend",Qc)):N.style.overflowY="auto"},Un=(N,j,oe)=>{eh(),j&&oe!=="hidden"&&hf(oe),setTimeout(()=>{N.scrollTop=0})},nd=(N,j,oe)=>{lr(N,oe.showClass.backdrop),oe.animation?(j.style.setProperty("opacity","0","important"),Zr(j,"grid"),setTimeout(()=>{lr(j,oe.showClass.popup),j.style.removeProperty("opacity")},td)):Zr(j,"grid"),lr([document.documentElement,document.body],te.shown),oe.heightAuto&&oe.backdrop&&!oe.toast&&lr([document.documentElement,document.body],te["height-auto"])};var Lg={email:(N,j)=>/^[a-zA-Z0-9.+_'-]+@[a-zA-Z0-9.-]+\.[a-zA-Z0-9-]+$/.test(N)?Promise.resolve():Promise.resolve(j||"Invalid email address"),url:(N,j)=>/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-z]{2,63}\b([-a-zA-Z0-9@:%_+.~#?&/=]*)$/.test(N)?Promise.resolve():Promise.resolve(j||"Invalid URL")};function Dv(N){N.inputValidator||(N.input==="email"&&(N.inputValidator=Lg.email),N.input==="url"&&(N.inputValidator=Lg.url))}function wf(N){(!N.target||typeof N.target=="string"&&!document.querySelector(N.target)||typeof N.target!="string"&&!N.target.appendChild)&&(ot('Target parameter is not valid, defaulting to "body"'),N.target="body")}function Iv(N){Dv(N),N.showLoaderOnConfirm&&!N.preConfirm&&ot(`showLoaderOnConfirm is set to true, but preConfirm is not defined.
showLoaderOnConfirm should be used together with preConfirm, see usage example:
https://sweetalert2.github.io/#ajax-request`),wf(N),typeof N.title=="string"&&(N.title=N.title.split(`
`).join("<br />")),jp(N)}let Pi;var hh=new WeakMap;class fo{constructor(...j){if(l(this,hh,void 0),typeof window>"u")return;Pi=this;let oe=Object.freeze(this.constructor.argsToParams(j));this.params=oe,this.isAwaitingPromise=!1,h(hh,this,this._main(Pi.params))}_main(j,oe={}){if(dn(Object.assign({},oe,j)),E.currentInstance){let _n=xl.swalPromiseResolve.get(E.currentInstance),{isAwaitingPromise:Hi}=E.currentInstance;E.currentInstance._destroy(),Hi||_n({isDismissed:!0}),pr()&&si()}E.currentInstance=Pi;let Me=Av(j,oe);Iv(Me),Object.freeze(Me),E.timeout&&(E.timeout.stop(),delete E.timeout),clearTimeout(E.restoreFocusTimeout);let Ct=Pv(Pi);return Da(Pi,Me),ye.innerParams.set(Pi,Me),Mv(Pi,Ct,Me)}then(j){return i(hh,this).then(j)}finally(j){return i(hh,this).finally(j)}}let Mv=(N,j,oe)=>new Promise((Me,Ct)=>{let _n=Hi=>{N.close({isDismissed:!0,dismiss:Hi,isConfirmed:!1,isDenied:!1})};xl.swalPromiseResolve.set(N,Me),xl.swalPromiseReject.set(N,Ct),j.confirmButton.onclick=()=>{Ys(N)},j.denyButton.onclick=()=>{$u(N)},j.cancelButton.onclick=()=>{wi(N,_n)},j.closeButton.onclick=()=>{_n(Hl.close)},Kc(oe,j,_n),vl(E,oe,_n),Ag(N,oe),El(oe),Ov(E,oe,_n),Ng(j,oe),setTimeout(()=>{j.container.scrollTop=0})}),Av=(N,j)=>{let oe=Ju(N),Me=Object.assign({},$r,j,oe,N);return Me.showClass=Object.assign({},$r.showClass,Me.showClass),Me.hideClass=Object.assign({},$r.hideClass,Me.hideClass),Me.animation===!1&&(Me.showClass={backdrop:"swal2-noanimation"},Me.hideClass={}),Me},Pv=N=>{let j={popup:en(),container:$n(),actions:Bl(),confirmButton:eo(),denyButton:Do(),cancelButton:Ui(),loader:$a(),closeButton:Vr(),validationMessage:Fs(),progressSteps:ks()};return ye.domCache.set(N,j),j},Ov=(N,j,oe)=>{let Me=Li();vo(Me),j.timer&&(N.timeout=new em(()=>{oe("timer"),delete N.timeout},j.timer),j.timerProgressBar&&(Zr(Me),os(Me,j,"timerProgressBar"),setTimeout(()=>{N.timeout&&N.timeout.running&&Wa(j.timer)})))},Ng=(N,j)=>{if(!j.toast){if(!Vn(j.allowEnterKey)){On("allowEnterKey"),kv();return}Rv(N)||Cf(N,j)||yl(-1,1)}},Rv=N=>{let j=Array.from(N.popup.querySelectorAll("[autofocus]"));for(let oe of j)if(oe instanceof HTMLElement&&No(oe))return oe.focus(),!0;return!1},Cf=(N,j)=>j.focusDeny&&No(N.denyButton)?(N.denyButton.focus(),!0):j.focusCancel&&No(N.cancelButton)?(N.cancelButton.focus(),!0):j.focusConfirm&&No(N.confirmButton)?(N.confirmButton.focus(),!0):!1,kv=()=>{document.activeElement instanceof HTMLElement&&typeof document.activeElement.blur=="function"&&document.activeElement.blur()};fo.prototype.disableButtons=xo,fo.prototype.enableButtons=Wu,fo.prototype.getInput=qu,fo.prototype.disableInput=xs,fo.prototype.enableInput=bl,fo.prototype.hideLoading=gc,fo.prototype.disableLoading=gc,fo.prototype.showValidationMessage=ah,fo.prototype.resetValidationMessage=Yc,fo.prototype.close=Ma,fo.prototype.closePopup=Ma,fo.prototype.closeModal=Ma,fo.prototype.closeToast=Ma,fo.prototype.rejectPromise=Uu,fo.prototype.update=Xu,fo.prototype._destroy=Xp,Object.assign(fo,Qp),Object.keys(as).forEach(N=>{fo[N]=function(...j){return Pi&&Pi[N]?Pi[N](...j):null}}),fo.DismissReason=Hl,fo.version="11.26.3";let fh=fo;return fh.default=fh,fh});typeof zd<"u"&&zd.Sweetalert2&&(zd.swal=zd.sweetAlert=zd.Swal=zd.SweetAlert=zd.Sweetalert2);typeof document<"u"&&(function(t,n){var i=t.createElement("style");if(t.getElementsByTagName("head")[0].appendChild(i),i.styleSheet)i.styleSheet.disabled||(i.styleSheet.cssText=n);else try{i.innerHTML=n}catch{i.innerText=n}})(document,':root{--swal2-outline: 0 0 0 3px rgba(100, 150, 200, 0.5);--swal2-container-padding: 0.625em;--swal2-backdrop: rgba(0, 0, 0, 0.4);--swal2-backdrop-transition: background-color 0.15s;--swal2-width: 32em;--swal2-padding: 0 0 1.25em;--swal2-border: none;--swal2-border-radius: 0.3125rem;--swal2-background: white;--swal2-color: #545454;--swal2-show-animation: swal2-show 0.3s;--swal2-hide-animation: swal2-hide 0.15s forwards;--swal2-icon-zoom: 1;--swal2-icon-animations: true;--swal2-title-padding: 0.8em 1em 0;--swal2-html-container-padding: 1em 1.6em 0.3em;--swal2-input-border: 1px solid #d9d9d9;--swal2-input-border-radius: 0.1875em;--swal2-input-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.06), 0 0 0 3px transparent;--swal2-input-background: transparent;--swal2-input-transition: border-color 0.2s, box-shadow 0.2s;--swal2-input-hover-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.06), 0 0 0 3px transparent;--swal2-input-focus-border: 1px solid #b4dbed;--swal2-input-focus-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.06), 0 0 0 3px rgba(100, 150, 200, 0.5);--swal2-progress-step-background: #add8e6;--swal2-validation-message-background: #f0f0f0;--swal2-validation-message-color: #666;--swal2-footer-border-color: #eee;--swal2-footer-background: transparent;--swal2-footer-color: inherit;--swal2-timer-progress-bar-background: rgba(0, 0, 0, 0.3);--swal2-close-button-position: initial;--swal2-close-button-inset: auto;--swal2-close-button-font-size: 2.5em;--swal2-close-button-color: #ccc;--swal2-close-button-transition: color 0.2s, box-shadow 0.2s;--swal2-close-button-outline: initial;--swal2-close-button-box-shadow: inset 0 0 0 3px transparent;--swal2-close-button-focus-box-shadow: inset var(--swal2-outline);--swal2-close-button-hover-transform: none;--swal2-actions-justify-content: center;--swal2-actions-width: auto;--swal2-actions-margin: 1.25em auto 0;--swal2-actions-padding: 0;--swal2-actions-border-radius: 0;--swal2-actions-background: transparent;--swal2-action-button-transition: background-color 0.2s, box-shadow 0.2s;--swal2-action-button-hover: black 10%;--swal2-action-button-active: black 10%;--swal2-confirm-button-box-shadow: none;--swal2-confirm-button-border-radius: 0.25em;--swal2-confirm-button-background-color: #7066e0;--swal2-confirm-button-color: #fff;--swal2-deny-button-box-shadow: none;--swal2-deny-button-border-radius: 0.25em;--swal2-deny-button-background-color: #dc3741;--swal2-deny-button-color: #fff;--swal2-cancel-button-box-shadow: none;--swal2-cancel-button-border-radius: 0.25em;--swal2-cancel-button-background-color: #6e7881;--swal2-cancel-button-color: #fff;--swal2-toast-show-animation: swal2-toast-show 0.5s;--swal2-toast-hide-animation: swal2-toast-hide 0.1s forwards;--swal2-toast-border: none;--swal2-toast-box-shadow: 0 0 1px hsl(0deg 0% 0% / 0.075), 0 1px 2px hsl(0deg 0% 0% / 0.075), 1px 2px 4px hsl(0deg 0% 0% / 0.075), 1px 3px 8px hsl(0deg 0% 0% / 0.075), 2px 4px 16px hsl(0deg 0% 0% / 0.075)}[data-swal2-theme=dark]{--swal2-dark-theme-black: #19191a;--swal2-dark-theme-white: #e1e1e1;--swal2-background: var(--swal2-dark-theme-black);--swal2-color: var(--swal2-dark-theme-white);--swal2-footer-border-color: #555;--swal2-input-background: color-mix(in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10%);--swal2-validation-message-background: color-mix( in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10% );--swal2-validation-message-color: var(--swal2-dark-theme-white);--swal2-timer-progress-bar-background: rgba(255, 255, 255, 0.7)}@media(prefers-color-scheme: dark){[data-swal2-theme=auto]{--swal2-dark-theme-black: #19191a;--swal2-dark-theme-white: #e1e1e1;--swal2-background: var(--swal2-dark-theme-black);--swal2-color: var(--swal2-dark-theme-white);--swal2-footer-border-color: #555;--swal2-input-background: color-mix(in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10%);--swal2-validation-message-background: color-mix( in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10% );--swal2-validation-message-color: var(--swal2-dark-theme-white);--swal2-timer-progress-bar-background: rgba(255, 255, 255, 0.7)}}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown){overflow:hidden}body.swal2-height-auto{height:auto !important}body.swal2-no-backdrop .swal2-container{background-color:rgba(0,0,0,0) !important;pointer-events:none}body.swal2-no-backdrop .swal2-container .swal2-popup{pointer-events:all}body.swal2-no-backdrop .swal2-container .swal2-modal{box-shadow:0 0 10px var(--swal2-backdrop)}body.swal2-toast-shown .swal2-container{box-sizing:border-box;width:360px;max-width:100%;background-color:rgba(0,0,0,0);pointer-events:none}body.swal2-toast-shown .swal2-container.swal2-top{inset:0 auto auto 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-top-end,body.swal2-toast-shown .swal2-container.swal2-top-right{inset:0 0 auto auto}body.swal2-toast-shown .swal2-container.swal2-top-start,body.swal2-toast-shown .swal2-container.swal2-top-left{inset:0 auto auto 0}body.swal2-toast-shown .swal2-container.swal2-center-start,body.swal2-toast-shown .swal2-container.swal2-center-left{inset:50% auto auto 0;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-center{inset:50% auto auto 50%;transform:translate(-50%, -50%)}body.swal2-toast-shown .swal2-container.swal2-center-end,body.swal2-toast-shown .swal2-container.swal2-center-right{inset:50% 0 auto auto;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-start,body.swal2-toast-shown .swal2-container.swal2-bottom-left{inset:auto auto 0 0}body.swal2-toast-shown .swal2-container.swal2-bottom{inset:auto auto 0 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-end,body.swal2-toast-shown .swal2-container.swal2-bottom-right{inset:auto 0 0 auto}@media print{body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown){overflow-y:scroll !important}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown)>[aria-hidden=true]{display:none}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown) .swal2-container{position:static !important}}div:where(.swal2-container){display:grid;position:fixed;z-index:1060;inset:0;box-sizing:border-box;grid-template-areas:"top-start     top            top-end" "center-start  center         center-end" "bottom-start  bottom-center  bottom-end";grid-template-rows:minmax(min-content, auto) minmax(min-content, auto) minmax(min-content, auto);height:100%;padding:var(--swal2-container-padding);overflow-x:hidden;transition:var(--swal2-backdrop-transition);-webkit-overflow-scrolling:touch}div:where(.swal2-container).swal2-backdrop-show,div:where(.swal2-container).swal2-noanimation{background:var(--swal2-backdrop)}div:where(.swal2-container).swal2-backdrop-hide{background:rgba(0,0,0,0) !important}div:where(.swal2-container).swal2-top-start,div:where(.swal2-container).swal2-center-start,div:where(.swal2-container).swal2-bottom-start{grid-template-columns:minmax(0, 1fr) auto auto}div:where(.swal2-container).swal2-top,div:where(.swal2-container).swal2-center,div:where(.swal2-container).swal2-bottom{grid-template-columns:auto minmax(0, 1fr) auto}div:where(.swal2-container).swal2-top-end,div:where(.swal2-container).swal2-center-end,div:where(.swal2-container).swal2-bottom-end{grid-template-columns:auto auto minmax(0, 1fr)}div:where(.swal2-container).swal2-top-start>.swal2-popup{align-self:start}div:where(.swal2-container).swal2-top>.swal2-popup{grid-column:2;place-self:start center}div:where(.swal2-container).swal2-top-end>.swal2-popup,div:where(.swal2-container).swal2-top-right>.swal2-popup{grid-column:3;place-self:start end}div:where(.swal2-container).swal2-center-start>.swal2-popup,div:where(.swal2-container).swal2-center-left>.swal2-popup{grid-row:2;align-self:center}div:where(.swal2-container).swal2-center>.swal2-popup{grid-column:2;grid-row:2;place-self:center center}div:where(.swal2-container).swal2-center-end>.swal2-popup,div:where(.swal2-container).swal2-center-right>.swal2-popup{grid-column:3;grid-row:2;place-self:center end}div:where(.swal2-container).swal2-bottom-start>.swal2-popup,div:where(.swal2-container).swal2-bottom-left>.swal2-popup{grid-column:1;grid-row:3;align-self:end}div:where(.swal2-container).swal2-bottom>.swal2-popup{grid-column:2;grid-row:3;place-self:end center}div:where(.swal2-container).swal2-bottom-end>.swal2-popup,div:where(.swal2-container).swal2-bottom-right>.swal2-popup{grid-column:3;grid-row:3;place-self:end end}div:where(.swal2-container).swal2-grow-row>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-column:1/4;width:100%}div:where(.swal2-container).swal2-grow-column>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-row:1/4;align-self:stretch}div:where(.swal2-container).swal2-no-transition{transition:none !important}div:where(.swal2-container)[popover]{width:auto;border:0}div:where(.swal2-container) div:where(.swal2-popup){display:none;position:relative;box-sizing:border-box;grid-template-columns:minmax(0, 100%);width:var(--swal2-width);max-width:100%;padding:var(--swal2-padding);border:var(--swal2-border);border-radius:var(--swal2-border-radius);background:var(--swal2-background);color:var(--swal2-color);font-family:inherit;font-size:1rem;container-name:swal2-popup}div:where(.swal2-container) div:where(.swal2-popup):focus{outline:none}div:where(.swal2-container) div:where(.swal2-popup).swal2-loading{overflow-y:hidden}div:where(.swal2-container) div:where(.swal2-popup).swal2-draggable{cursor:grab}div:where(.swal2-container) div:where(.swal2-popup).swal2-draggable div:where(.swal2-icon){cursor:grab}div:where(.swal2-container) div:where(.swal2-popup).swal2-dragging{cursor:grabbing}div:where(.swal2-container) div:where(.swal2-popup).swal2-dragging div:where(.swal2-icon){cursor:grabbing}div:where(.swal2-container) h2:where(.swal2-title){position:relative;max-width:100%;margin:0;padding:var(--swal2-title-padding);color:inherit;font-size:1.875em;font-weight:600;text-align:center;text-transform:none;overflow-wrap:break-word;cursor:initial}div:where(.swal2-container) div:where(.swal2-actions){display:flex;z-index:1;box-sizing:border-box;flex-wrap:wrap;align-items:center;justify-content:var(--swal2-actions-justify-content);width:var(--swal2-actions-width);margin:var(--swal2-actions-margin);padding:var(--swal2-actions-padding);border-radius:var(--swal2-actions-border-radius);background:var(--swal2-actions-background)}div:where(.swal2-container) div:where(.swal2-loader){display:none;align-items:center;justify-content:center;width:2.2em;height:2.2em;margin:0 1.875em;animation:swal2-rotate-loading 1.5s linear 0s infinite normal;border-width:.25em;border-style:solid;border-radius:100%;border-color:#2778c4 rgba(0,0,0,0) #2778c4 rgba(0,0,0,0)}div:where(.swal2-container) button:where(.swal2-styled){margin:.3125em;padding:.625em 1.1em;transition:var(--swal2-action-button-transition);border:none;box-shadow:0 0 0 3px rgba(0,0,0,0);font-weight:500}div:where(.swal2-container) button:where(.swal2-styled):not([disabled]){cursor:pointer}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm){border-radius:var(--swal2-confirm-button-border-radius);background:initial;background-color:var(--swal2-confirm-button-background-color);box-shadow:var(--swal2-confirm-button-box-shadow);color:var(--swal2-confirm-button-color);font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm):hover{background-color:color-mix(in srgb, var(--swal2-confirm-button-background-color), var(--swal2-action-button-hover))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm):active{background-color:color-mix(in srgb, var(--swal2-confirm-button-background-color), var(--swal2-action-button-active))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny){border-radius:var(--swal2-deny-button-border-radius);background:initial;background-color:var(--swal2-deny-button-background-color);box-shadow:var(--swal2-deny-button-box-shadow);color:var(--swal2-deny-button-color);font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny):hover{background-color:color-mix(in srgb, var(--swal2-deny-button-background-color), var(--swal2-action-button-hover))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny):active{background-color:color-mix(in srgb, var(--swal2-deny-button-background-color), var(--swal2-action-button-active))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel){border-radius:var(--swal2-cancel-button-border-radius);background:initial;background-color:var(--swal2-cancel-button-background-color);box-shadow:var(--swal2-cancel-button-box-shadow);color:var(--swal2-cancel-button-color);font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel):hover{background-color:color-mix(in srgb, var(--swal2-cancel-button-background-color), var(--swal2-action-button-hover))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel):active{background-color:color-mix(in srgb, var(--swal2-cancel-button-background-color), var(--swal2-action-button-active))}div:where(.swal2-container) button:where(.swal2-styled):focus-visible{outline:none;box-shadow:var(--swal2-action-button-focus-box-shadow)}div:where(.swal2-container) button:where(.swal2-styled)[disabled]:not(.swal2-loading){opacity:.4}div:where(.swal2-container) button:where(.swal2-styled)::-moz-focus-inner{border:0}div:where(.swal2-container) div:where(.swal2-footer){margin:1em 0 0;padding:1em 1em 0;border-top:1px solid var(--swal2-footer-border-color);background:var(--swal2-footer-background);color:var(--swal2-footer-color);font-size:1em;text-align:center;cursor:initial}div:where(.swal2-container) .swal2-timer-progress-bar-container{position:absolute;right:0;bottom:0;left:0;grid-column:auto !important;overflow:hidden;border-bottom-right-radius:var(--swal2-border-radius);border-bottom-left-radius:var(--swal2-border-radius)}div:where(.swal2-container) div:where(.swal2-timer-progress-bar){width:100%;height:.25em;background:var(--swal2-timer-progress-bar-background)}div:where(.swal2-container) img:where(.swal2-image){max-width:100%;margin:2em auto 1em;cursor:initial}div:where(.swal2-container) button:where(.swal2-close){position:var(--swal2-close-button-position);inset:var(--swal2-close-button-inset);z-index:2;align-items:center;justify-content:center;width:1.2em;height:1.2em;margin-top:0;margin-right:0;margin-bottom:-1.2em;padding:0;overflow:hidden;transition:var(--swal2-close-button-transition);border:none;border-radius:var(--swal2-border-radius);outline:var(--swal2-close-button-outline);background:rgba(0,0,0,0);color:var(--swal2-close-button-color);font-family:monospace;font-size:var(--swal2-close-button-font-size);cursor:pointer;justify-self:end}div:where(.swal2-container) button:where(.swal2-close):hover{transform:var(--swal2-close-button-hover-transform);background:rgba(0,0,0,0);color:#f27474}div:where(.swal2-container) button:where(.swal2-close):focus-visible{outline:none;box-shadow:var(--swal2-close-button-focus-box-shadow)}div:where(.swal2-container) button:where(.swal2-close)::-moz-focus-inner{border:0}div:where(.swal2-container) div:where(.swal2-html-container){z-index:1;justify-content:center;margin:0;padding:var(--swal2-html-container-padding);overflow:auto;color:inherit;font-size:1.125em;font-weight:normal;line-height:normal;text-align:center;overflow-wrap:break-word;word-break:break-word;cursor:initial}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea),div:where(.swal2-container) select:where(.swal2-select),div:where(.swal2-container) div:where(.swal2-radio),div:where(.swal2-container) label:where(.swal2-checkbox){margin:1em 2em 3px}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea){box-sizing:border-box;width:auto;transition:var(--swal2-input-transition);border:var(--swal2-input-border);border-radius:var(--swal2-input-border-radius);background:var(--swal2-input-background);box-shadow:var(--swal2-input-box-shadow);color:inherit;font-size:1.125em}div:where(.swal2-container) input:where(.swal2-input).swal2-inputerror,div:where(.swal2-container) input:where(.swal2-file).swal2-inputerror,div:where(.swal2-container) textarea:where(.swal2-textarea).swal2-inputerror{border-color:#f27474 !important;box-shadow:0 0 2px #f27474 !important}div:where(.swal2-container) input:where(.swal2-input):hover,div:where(.swal2-container) input:where(.swal2-file):hover,div:where(.swal2-container) textarea:where(.swal2-textarea):hover{box-shadow:var(--swal2-input-hover-box-shadow)}div:where(.swal2-container) input:where(.swal2-input):focus,div:where(.swal2-container) input:where(.swal2-file):focus,div:where(.swal2-container) textarea:where(.swal2-textarea):focus{border:var(--swal2-input-focus-border);outline:none;box-shadow:var(--swal2-input-focus-box-shadow)}div:where(.swal2-container) input:where(.swal2-input)::placeholder,div:where(.swal2-container) input:where(.swal2-file)::placeholder,div:where(.swal2-container) textarea:where(.swal2-textarea)::placeholder{color:#ccc}div:where(.swal2-container) .swal2-range{margin:1em 2em 3px;background:var(--swal2-background)}div:where(.swal2-container) .swal2-range input{width:80%}div:where(.swal2-container) .swal2-range output{width:20%;color:inherit;font-weight:600;text-align:center}div:where(.swal2-container) .swal2-range input,div:where(.swal2-container) .swal2-range output{height:2.625em;padding:0;font-size:1.125em;line-height:2.625em}div:where(.swal2-container) .swal2-input{height:2.625em;padding:0 .75em}div:where(.swal2-container) .swal2-file{width:75%;margin-right:auto;margin-left:auto;background:var(--swal2-input-background);font-size:1.125em}div:where(.swal2-container) .swal2-textarea{height:6.75em;padding:.75em}div:where(.swal2-container) .swal2-select{min-width:50%;max-width:100%;padding:.375em .625em;background:var(--swal2-input-background);color:inherit;font-size:1.125em}div:where(.swal2-container) .swal2-radio,div:where(.swal2-container) .swal2-checkbox{align-items:center;justify-content:center;background:var(--swal2-background);color:inherit}div:where(.swal2-container) .swal2-radio label,div:where(.swal2-container) .swal2-checkbox label{margin:0 .6em;font-size:1.125em}div:where(.swal2-container) .swal2-radio input,div:where(.swal2-container) .swal2-checkbox input{flex-shrink:0;margin:0 .4em}div:where(.swal2-container) label:where(.swal2-input-label){display:flex;justify-content:center;margin:1em auto 0}div:where(.swal2-container) div:where(.swal2-validation-message){align-items:center;justify-content:center;margin:1em 0 0;padding:.625em;overflow:hidden;background:var(--swal2-validation-message-background);color:var(--swal2-validation-message-color);font-size:1em;font-weight:300}div:where(.swal2-container) div:where(.swal2-validation-message)::before{content:"!";display:inline-block;width:1.5em;min-width:1.5em;height:1.5em;margin:0 .625em;border-radius:50%;background-color:#f27474;color:#fff;font-weight:600;line-height:1.5em;text-align:center}div:where(.swal2-container) .swal2-progress-steps{flex-wrap:wrap;align-items:center;max-width:100%;margin:1.25em auto;padding:0;background:rgba(0,0,0,0);font-weight:600}div:where(.swal2-container) .swal2-progress-steps li{display:inline-block;position:relative}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step{z-index:20;flex-shrink:0;width:2em;height:2em;border-radius:2em;background:#2778c4;color:#fff;line-height:2em;text-align:center}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step{background:#2778c4}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step{background:var(--swal2-progress-step-background);color:#fff}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step-line{background:var(--swal2-progress-step-background)}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step-line{z-index:10;flex-shrink:0;width:2.5em;height:.4em;margin:0 -1px;background:#2778c4}div:where(.swal2-icon){position:relative;box-sizing:content-box;justify-content:center;width:5em;height:5em;margin:2.5em auto .6em;zoom:var(--swal2-icon-zoom);border:.25em solid rgba(0,0,0,0);border-radius:50%;border-color:#000;font-family:inherit;line-height:5em;cursor:default;user-select:none}div:where(.swal2-icon) .swal2-icon-content{display:flex;align-items:center;font-size:3.75em}div:where(.swal2-icon).swal2-error{border-color:#f27474;color:#f27474}div:where(.swal2-icon).swal2-error .swal2-x-mark{position:relative;flex-grow:1}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line]{display:block;position:absolute;top:2.3125em;width:2.9375em;height:.3125em;border-radius:.125em;background-color:#f27474}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=left]{left:1.0625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=right]{right:1em;transform:rotate(-45deg)}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-error.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-error.swal2-icon-show .swal2-x-mark{animation:swal2-animate-error-x-mark .5s}}div:where(.swal2-icon).swal2-warning{border-color:#f8bb86;color:#f8bb86}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-warning.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-warning.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .5s}}div:where(.swal2-icon).swal2-info{border-color:#3fc3ee;color:#3fc3ee}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-info.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-info.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .8s}}div:where(.swal2-icon).swal2-question{border-color:#87adbd;color:#87adbd}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-question.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-question.swal2-icon-show .swal2-icon-content{animation:swal2-animate-question-mark .8s}}div:where(.swal2-icon).swal2-success{border-color:#a5dc86;color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line]{position:absolute;width:3.75em;height:7.5em;border-radius:50%}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.4375em;left:-2.0635em;transform:rotate(-45deg);transform-origin:3.75em 3.75em;border-radius:7.5em 0 0 7.5em}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.6875em;left:1.875em;transform:rotate(-45deg);transform-origin:0 3.75em;border-radius:0 7.5em 7.5em 0}div:where(.swal2-icon).swal2-success .swal2-success-ring{position:absolute;z-index:2;top:-0.25em;left:-0.25em;box-sizing:content-box;width:100%;height:100%;border:.25em solid rgba(165,220,134,.3);border-radius:50%}div:where(.swal2-icon).swal2-success .swal2-success-fix{position:absolute;z-index:1;top:.5em;left:1.625em;width:.4375em;height:5.625em;transform:rotate(-45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line]{display:block;position:absolute;z-index:2;height:.3125em;border-radius:.125em;background-color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=tip]{top:2.875em;left:.8125em;width:1.5625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=long]{top:2.375em;right:.5em;width:2.9375em;transform:rotate(-45deg)}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-animate-success-line-tip .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-animate-success-line-long .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-circular-line-right{animation:swal2-rotate-success-circular-line 4.25s ease-in}}[class^=swal2]{-webkit-tap-highlight-color:rgba(0,0,0,0)}.swal2-show{animation:var(--swal2-show-animation)}.swal2-hide{animation:var(--swal2-hide-animation)}.swal2-noanimation{transition:none}.swal2-scrollbar-measure{position:absolute;top:-9999px;width:50px;height:50px;overflow:scroll}.swal2-rtl .swal2-close{margin-right:initial;margin-left:0}.swal2-rtl .swal2-timer-progress-bar{right:0;left:auto}.swal2-toast{box-sizing:border-box;grid-column:1/4 !important;grid-row:1/4 !important;grid-template-columns:min-content auto min-content;padding:1em;overflow-y:hidden;border:var(--swal2-toast-border);background:var(--swal2-background);box-shadow:var(--swal2-toast-box-shadow);pointer-events:all}.swal2-toast>*{grid-column:2}.swal2-toast h2:where(.swal2-title){margin:.5em 1em;padding:0;font-size:1em;text-align:initial}.swal2-toast .swal2-loading{justify-content:center}.swal2-toast input:where(.swal2-input){height:2em;margin:.5em;font-size:1em}.swal2-toast .swal2-validation-message{font-size:1em}.swal2-toast div:where(.swal2-footer){margin:.5em 0 0;padding:.5em 0 0;font-size:.8em}.swal2-toast button:where(.swal2-close){grid-column:3/3;grid-row:1/99;align-self:center;width:.8em;height:.8em;margin:0;font-size:2em}.swal2-toast div:where(.swal2-html-container){margin:.5em 1em;padding:0;overflow:initial;font-size:1em;text-align:initial}.swal2-toast div:where(.swal2-html-container):empty{padding:0}.swal2-toast .swal2-loader{grid-column:1;grid-row:1/99;align-self:center;width:2em;height:2em;margin:.25em}.swal2-toast .swal2-icon{grid-column:1;grid-row:1/99;align-self:center;width:2em;min-width:2em;height:2em;margin:0 .5em 0 0}.swal2-toast .swal2-icon .swal2-icon-content{display:flex;align-items:center;font-size:1.8em;font-weight:bold}.swal2-toast .swal2-icon.swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line]{top:.875em;width:1.375em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=left]{left:.3125em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=right]{right:.3125em}.swal2-toast div:where(.swal2-actions){justify-content:flex-start;height:auto;margin:0;margin-top:.5em;padding:0 .5em}.swal2-toast button:where(.swal2-styled){margin:.25em .5em;padding:.4em .6em;font-size:1em}.swal2-toast .swal2-success{border-color:#a5dc86}.swal2-toast .swal2-success [class^=swal2-success-circular-line]{position:absolute;width:1.6em;height:3em;border-radius:50%}.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.8em;left:-0.5em;transform:rotate(-45deg);transform-origin:2em 2em;border-radius:4em 0 0 4em}.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.25em;left:.9375em;transform-origin:0 1.5em;border-radius:0 4em 4em 0}.swal2-toast .swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-toast .swal2-success .swal2-success-fix{top:0;left:.4375em;width:.4375em;height:2.6875em}.swal2-toast .swal2-success [class^=swal2-success-line]{height:.3125em}.swal2-toast .swal2-success [class^=swal2-success-line][class$=tip]{top:1.125em;left:.1875em;width:.75em}.swal2-toast .swal2-success [class^=swal2-success-line][class$=long]{top:.9375em;right:.1875em;width:1.375em}@container swal2-popup style(--swal2-icon-animations:true){.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-toast-animate-success-line-tip .75s}.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-toast-animate-success-line-long .75s}}.swal2-toast.swal2-show{animation:var(--swal2-toast-show-animation)}.swal2-toast.swal2-hide{animation:var(--swal2-toast-hide-animation)}@keyframes swal2-show{0%{transform:translate3d(0, -50px, 0) scale(0.9);opacity:0}100%{transform:translate3d(0, 0, 0) scale(1);opacity:1}}@keyframes swal2-hide{0%{transform:translate3d(0, 0, 0) scale(1);opacity:1}100%{transform:translate3d(0, -50px, 0) scale(0.9);opacity:0}}@keyframes swal2-animate-success-line-tip{0%{top:1.1875em;left:.0625em;width:0}54%{top:1.0625em;left:.125em;width:0}70%{top:2.1875em;left:-0.375em;width:3.125em}84%{top:3em;left:1.3125em;width:1.0625em}100%{top:2.8125em;left:.8125em;width:1.5625em}}@keyframes swal2-animate-success-line-long{0%{top:3.375em;right:2.875em;width:0}65%{top:3.375em;right:2.875em;width:0}84%{top:2.1875em;right:0;width:3.4375em}100%{top:2.375em;right:.5em;width:2.9375em}}@keyframes swal2-rotate-success-circular-line{0%{transform:rotate(-45deg)}5%{transform:rotate(-45deg)}12%{transform:rotate(-405deg)}100%{transform:rotate(-405deg)}}@keyframes swal2-animate-error-x-mark{0%{margin-top:1.625em;transform:scale(0.4);opacity:0}50%{margin-top:1.625em;transform:scale(0.4);opacity:0}80%{margin-top:-0.375em;transform:scale(1.15)}100%{margin-top:0;transform:scale(1);opacity:1}}@keyframes swal2-animate-error-icon{0%{transform:rotateX(100deg);opacity:0}100%{transform:rotateX(0deg);opacity:1}}@keyframes swal2-rotate-loading{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}@keyframes swal2-animate-question-mark{0%{transform:rotateY(-360deg)}100%{transform:rotateY(0)}}@keyframes swal2-animate-i-mark{0%{transform:rotateZ(45deg);opacity:0}25%{transform:rotateZ(-25deg);opacity:.4}50%{transform:rotateZ(15deg);opacity:.8}75%{transform:rotateZ(-5deg);opacity:1}100%{transform:rotateX(0);opacity:1}}@keyframes swal2-toast-show{0%{transform:translateY(-0.625em) rotateZ(2deg)}33%{transform:translateY(0) rotateZ(-2deg)}66%{transform:translateY(0.3125em) rotateZ(2deg)}100%{transform:translateY(0) rotateZ(0deg)}}@keyframes swal2-toast-hide{100%{transform:rotateZ(1deg);opacity:0}}@keyframes swal2-toast-animate-success-line-tip{0%{top:.5625em;left:.0625em;width:0}54%{top:.125em;left:.125em;width:0}70%{top:.625em;left:-0.25em;width:1.625em}84%{top:1.0625em;left:.75em;width:.5em}100%{top:1.125em;left:.1875em;width:.75em}}@keyframes swal2-toast-animate-success-line-long{0%{top:1.625em;right:1.375em;width:0}65%{top:1.25em;right:.9375em;width:0}84%{top:.9375em;right:0;width:1.125em}100%{top:.9375em;right:.1875em;width:1.375em}}')});var L6=Gn((ER,TR)=>{"use strict";(function(t,n){typeof ER=="object"&&typeof TR<"u"?TR.exports=n():typeof define=="function"&&define.amd?define(n):(t=typeof globalThis<"u"?globalThis:t||self,t.mapboxgl=n())})(ER,function(){"use strict";var t,n,i;function l(o,E){if(!t)t=E;else if(!n)n=E;else{var A="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+t+")(sharedChunk); ("+n+")(sharedChunk); self.onerror = null;",L={};t(L),i=E(L),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(i.workerUrl=window.URL.createObjectURL(new Blob([A],{type:"text/javascript"})))}}l(["exports"],function(o){var E=1e-6,A=typeof Float32Array<"u"?Float32Array:Array;function L(a,e){var s=e[0],u=e[1],d=e[2],m=e[3],g=s*m-d*u;return g?(a[0]=m*(g=1/g),a[1]=-u*g,a[2]=-d*g,a[3]=s*g,a):null}function Y(){var a=new A(9);return A!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function le(a,e){var s=e[0],u=e[1],d=e[2],m=e[3],g=e[4],v=e[5],b=e[6],w=e[7],S=e[8];return a[0]=g*S-v*w,a[1]=d*w-u*S,a[2]=u*v-d*g,a[3]=v*b-m*S,a[4]=s*S-d*b,a[5]=d*m-s*v,a[6]=m*w-g*b,a[7]=u*b-s*w,a[8]=s*g-u*m,a}function te(a,e,s){var u=e[0],d=e[1],m=e[2],g=e[3],v=e[4],b=e[5],w=e[6],S=e[7],D=e[8],I=s[0],R=s[1],k=s[2],B=s[3],U=s[4],G=s[5],J=s[6],ee=s[7],se=s[8];return a[0]=I*u+R*g+k*w,a[1]=I*d+R*v+k*S,a[2]=I*m+R*b+k*D,a[3]=B*u+U*g+G*w,a[4]=B*d+U*v+G*S,a[5]=B*m+U*b+G*D,a[6]=J*u+ee*g+se*w,a[7]=J*d+ee*v+se*S,a[8]=J*m+ee*b+se*D,a}function ze(){var a=new A(16);return A!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a}function Ae(a){var e=new A(16);return e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3],e[4]=a[4],e[5]=a[5],e[6]=a[6],e[7]=a[7],e[8]=a[8],e[9]=a[9],e[10]=a[10],e[11]=a[11],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15],e}function Be(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Tt(a,e){var s=e[0],u=e[1],d=e[2],m=e[3],g=e[4],v=e[5],b=e[6],w=e[7],S=e[8],D=e[9],I=e[10],R=e[11],k=e[12],B=e[13],U=e[14],G=e[15],J=s*v-u*g,ee=s*b-d*g,se=s*w-m*g,_e=u*b-d*v,fe=u*w-m*v,we=d*w-m*b,Ee=S*B-D*k,Se=S*U-I*k,We=S*G-R*k,Fe=D*U-I*B,Ze=D*G-R*B,Qe=I*G-R*U,rt=J*Qe-ee*Ze+se*Fe+_e*We-fe*Se+we*Ee;return rt?(a[0]=(v*Qe-b*Ze+w*Fe)*(rt=1/rt),a[1]=(d*Ze-u*Qe-m*Fe)*rt,a[2]=(B*we-U*fe+G*_e)*rt,a[3]=(I*fe-D*we-R*_e)*rt,a[4]=(b*We-g*Qe-w*Se)*rt,a[5]=(s*Qe-d*We+m*Se)*rt,a[6]=(U*se-k*we-G*ee)*rt,a[7]=(S*we-I*se+R*ee)*rt,a[8]=(g*Ze-v*We+w*Ee)*rt,a[9]=(u*We-s*Ze-m*Ee)*rt,a[10]=(k*fe-B*se+G*J)*rt,a[11]=(D*se-S*fe-R*J)*rt,a[12]=(v*Se-g*Fe-b*Ee)*rt,a[13]=(s*Fe-u*Se+d*Ee)*rt,a[14]=(B*ee-k*_e-U*J)*rt,a[15]=(S*_e-D*ee+I*J)*rt,a):null}function ot(a,e,s){var u=e[0],d=e[1],m=e[2],g=e[3],v=e[4],b=e[5],w=e[6],S=e[7],D=e[8],I=e[9],R=e[10],k=e[11],B=e[12],U=e[13],G=e[14],J=e[15],ee=s[0],se=s[1],_e=s[2],fe=s[3];return a[0]=ee*u+se*v+_e*D+fe*B,a[1]=ee*d+se*b+_e*I+fe*U,a[2]=ee*m+se*w+_e*R+fe*G,a[3]=ee*g+se*S+_e*k+fe*J,a[4]=(ee=s[4])*u+(se=s[5])*v+(_e=s[6])*D+(fe=s[7])*B,a[5]=ee*d+se*b+_e*I+fe*U,a[6]=ee*m+se*w+_e*R+fe*G,a[7]=ee*g+se*S+_e*k+fe*J,a[8]=(ee=s[8])*u+(se=s[9])*v+(_e=s[10])*D+(fe=s[11])*B,a[9]=ee*d+se*b+_e*I+fe*U,a[10]=ee*m+se*w+_e*R+fe*G,a[11]=ee*g+se*S+_e*k+fe*J,a[12]=(ee=s[12])*u+(se=s[13])*v+(_e=s[14])*D+(fe=s[15])*B,a[13]=ee*d+se*b+_e*I+fe*U,a[14]=ee*m+se*w+_e*R+fe*G,a[15]=ee*g+se*S+_e*k+fe*J,a}function kt(a,e,s){var u,d,m,g,v,b,w,S,D,I,R,k,B=s[0],U=s[1],G=s[2];return e===a?(a[12]=e[0]*B+e[4]*U+e[8]*G+e[12],a[13]=e[1]*B+e[5]*U+e[9]*G+e[13],a[14]=e[2]*B+e[6]*U+e[10]*G+e[14],a[15]=e[3]*B+e[7]*U+e[11]*G+e[15]):(d=e[1],m=e[2],g=e[3],v=e[4],b=e[5],w=e[6],S=e[7],D=e[8],I=e[9],R=e[10],k=e[11],a[0]=u=e[0],a[1]=d,a[2]=m,a[3]=g,a[4]=v,a[5]=b,a[6]=w,a[7]=S,a[8]=D,a[9]=I,a[10]=R,a[11]=k,a[12]=u*B+v*U+D*G+e[12],a[13]=d*B+b*U+I*G+e[13],a[14]=m*B+w*U+R*G+e[14],a[15]=g*B+S*U+k*G+e[15]),a}function Cn(a,e,s){var u=s[0],d=s[1],m=s[2];return a[0]=e[0]*u,a[1]=e[1]*u,a[2]=e[2]*u,a[3]=e[3]*u,a[4]=e[4]*d,a[5]=e[5]*d,a[6]=e[6]*d,a[7]=e[7]*d,a[8]=e[8]*m,a[9]=e[9]*m,a[10]=e[10]*m,a[11]=e[11]*m,a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15],a}function Xn(a,e,s){var u=Math.sin(s),d=Math.cos(s),m=e[4],g=e[5],v=e[6],b=e[7],w=e[8],S=e[9],D=e[10],I=e[11];return e!==a&&(a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[3],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]),a[4]=m*d+w*u,a[5]=g*d+S*u,a[6]=v*d+D*u,a[7]=b*d+I*u,a[8]=w*d-m*u,a[9]=S*d-g*u,a[10]=D*d-v*u,a[11]=I*d-b*u,a}function On(a,e,s){var u=Math.sin(s),d=Math.cos(s),m=e[0],g=e[1],v=e[2],b=e[3],w=e[8],S=e[9],D=e[10],I=e[11];return e!==a&&(a[4]=e[4],a[5]=e[5],a[6]=e[6],a[7]=e[7],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]),a[0]=m*d-w*u,a[1]=g*d-S*u,a[2]=v*d-D*u,a[3]=b*d-I*u,a[8]=m*u+w*d,a[9]=g*u+S*d,a[10]=v*u+D*d,a[11]=b*u+I*d,a}function Vn(a,e,s){var u=Math.sin(s),d=Math.cos(s),m=e[0],g=e[1],v=e[2],b=e[3],w=e[4],S=e[5],D=e[6],I=e[7];return e!==a&&(a[8]=e[8],a[9]=e[9],a[10]=e[10],a[11]=e[11],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]),a[0]=m*d+w*u,a[1]=g*d+S*u,a[2]=v*d+D*u,a[3]=b*d+I*u,a[4]=w*d-m*u,a[5]=S*d-g*u,a[6]=D*d-v*u,a[7]=I*d-b*u,a}function rr(a,e){return a[0]=e[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=e[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=e[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Vi(a,e,s){var u,d,m,g=s[0],v=s[1],b=s[2],w=Math.sqrt(g*g+v*v+b*b);return w<E?null:(g*=w=1/w,v*=w,b*=w,u=Math.sin(e),d=Math.cos(e),a[0]=g*g*(m=1-d)+d,a[1]=v*g*m+b*u,a[2]=b*g*m-v*u,a[3]=0,a[4]=g*v*m-b*u,a[5]=v*v*m+d,a[6]=b*v*m+g*u,a[7]=0,a[8]=g*b*m+v*u,a[9]=v*b*m-g*u,a[10]=b*b*m+d,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a)}function Er(a,e){var s=e[0],u=e[1],d=e[2],m=e[4],g=e[5],v=e[6],b=e[8],w=e[9],S=e[10];return a[0]=Math.sqrt(s*s+u*u+d*d),a[1]=Math.sqrt(m*m+g*g+v*v),a[2]=Math.sqrt(b*b+w*w+S*S),a}function $n(a,e){var s=e[0],u=e[1],d=e[2],m=e[3],g=s+s,v=u+u,b=d+d,w=s*g,S=u*g,D=u*v,I=d*g,R=d*v,k=d*b,B=m*g,U=m*v,G=m*b;return a[0]=1-D-k,a[1]=S+G,a[2]=I-U,a[3]=0,a[4]=S-G,a[5]=1-w-k,a[6]=R+B,a[7]=0,a[8]=I+U,a[9]=R-B,a[10]=1-w-D,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}var Qi=ot;function Rt(){var a=new A(3);return A!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function en(a){var e=new A(3);return e[0]=a[0],e[1]=a[1],e[2]=a[2],e}function ai(a){var e=a[0],s=a[1],u=a[2];return Math.sqrt(e*e+s*s+u*u)}function Fi(a,e,s){var u=new A(3);return u[0]=a,u[1]=e,u[2]=s,u}function Wi(a,e,s,u){return a[0]=e,a[1]=s,a[2]=u,a}function Pr(a,e,s){return a[0]=e[0]+s[0],a[1]=e[1]+s[1],a[2]=e[2]+s[2],a}function Oo(a,e,s){return a[0]=e[0]-s[0],a[1]=e[1]-s[1],a[2]=e[2]-s[2],a}function ks(a,e,s){return a[0]=e[0]*s[0],a[1]=e[1]*s[1],a[2]=e[2]*s[2],a}function Fs(a,e,s){return a[0]=Math.min(e[0],s[0]),a[1]=Math.min(e[1],s[1]),a[2]=Math.min(e[2],s[2]),a}function eo(a,e,s){return a[0]=Math.max(e[0],s[0]),a[1]=Math.max(e[1],s[1]),a[2]=Math.max(e[2],s[2]),a}function Ui(a,e,s){return a[0]=e[0]*s,a[1]=e[1]*s,a[2]=e[2]*s,a}function Do(a,e,s,u){return a[0]=e[0]+s[0]*u,a[1]=e[1]+s[1]*u,a[2]=e[2]+s[2]*u,a}function Nu(a,e){var s=e[0]-a[0],u=e[1]-a[1],d=e[2]-a[2];return Math.sqrt(s*s+u*u+d*d)}function $a(a,e){var s=e[0]-a[0],u=e[1]-a[1],d=e[2]-a[2];return s*s+u*u+d*d}function Bl(a){var e=a[0],s=a[1],u=a[2];return e*e+s*s+u*u}function Ga(a,e){return a[0]=-e[0],a[1]=-e[1],a[2]=-e[2],a}function Li(a,e){var s=e[0],u=e[1],d=e[2],m=s*s+u*u+d*d;return m>0&&(m=1/Math.sqrt(m)),a[0]=e[0]*m,a[1]=e[1]*m,a[2]=e[2]*m,a}function Vr(a,e){return a[0]*e[0]+a[1]*e[1]+a[2]*e[2]}function Ro(a,e,s){var u=e[0],d=e[1],m=e[2],g=s[0],v=s[1],b=s[2];return a[0]=d*b-m*v,a[1]=m*g-u*b,a[2]=u*v-d*g,a}function hc(a,e,s,u){var d=e[0],m=e[1],g=e[2];return a[0]=d+u*(s[0]-d),a[1]=m+u*(s[1]-m),a[2]=g+u*(s[2]-g),a}function pr(a,e,s){var u=e[0],d=e[1],m=e[2],g=s[3]*u+s[7]*d+s[11]*m+s[15];return a[0]=(s[0]*u+s[4]*d+s[8]*m+s[12])/(g=g||1),a[1]=(s[1]*u+s[5]*d+s[9]*m+s[13])/g,a[2]=(s[2]*u+s[6]*d+s[10]*m+s[14])/g,a}function qa(a,e,s){var u=e[0],d=e[1],m=e[2];return a[0]=u*s[0]+d*s[3]+m*s[6],a[1]=u*s[1]+d*s[4]+m*s[7],a[2]=u*s[2]+d*s[5]+m*s[8],a}function ua(a,e,s){var u=s[0],d=s[1],m=s[2],g=s[3],v=e[0],b=e[1],w=e[2],S=d*w-m*b,D=m*v-u*w,I=u*b-d*v;return a[0]=v+g*(S+=S)+d*(I+=I)-m*(D+=D),a[1]=b+g*D+m*S-u*I,a[2]=w+g*I+u*D-d*S,a}function co(a){return a[0]=0,a[1]=0,a[2]=0,a}function Wo(a,e){return a[0]===e[0]&&a[1]===e[1]&&a[2]===e[2]}var Ur=Oo,os=ks,_l=ai;function Ls(){var a=new A(4);return A!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[3]=0),a}function jl(a,e,s){return a[0]=e[0]*s,a[1]=e[1]*s,a[2]=e[2]*s,a[3]=e[3]*s,a}function lr(a,e){var s=e[0],u=e[1],d=e[2],m=e[3],g=s*s+u*u+d*d+m*m;return g>0&&(g=1/Math.sqrt(g)),a[0]=s*g,a[1]=u*g,a[2]=d*g,a[3]=m*g,a}function Hr(a,e,s){var u=e[0],d=e[1],m=e[2],g=e[3];return a[0]=s[0]*u+s[4]*d+s[8]*m+s[12]*g,a[1]=s[1]*u+s[5]*d+s[9]*m+s[13]*g,a[2]=s[2]*u+s[6]*d+s[10]*m+s[14]*g,a[3]=s[3]*u+s[7]*d+s[11]*m+s[15]*g,a}function Ns(){var a=new A(4);return A!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function vs(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a}function Zr(a,e,s){s*=.5;var u=e[0],d=e[1],m=e[2],g=e[3],v=Math.sin(s),b=Math.cos(s);return a[0]=u*b+g*v,a[1]=d*b+m*v,a[2]=m*b-d*v,a[3]=g*b-u*v,a}function vo(a,e,s){s*=.5;var u=e[0],d=e[1],m=e[2],g=e[3],v=Math.sin(s),b=Math.cos(s);return a[0]=u*b-m*v,a[1]=d*b+g*v,a[2]=m*b+u*v,a[3]=g*b-d*v,a}Rt(),Ls();var ss,fc,qs,No=lr,zu=(ss=Rt(),fc=Fi(1,0,0),qs=Fi(0,1,0),function(a,e,s){var u=Vr(e,s);return u<-.999999?(Ro(ss,fc,e),_l(ss)<1e-6&&Ro(ss,qs,e),Li(ss,ss),(function(d,m,g){g*=.5;var v=Math.sin(g);d[0]=v*m[0],d[1]=v*m[1],d[2]=v*m[2],d[3]=Math.cos(g)})(a,ss,Math.PI),a):u>.999999?(a[0]=0,a[1]=0,a[2]=0,a[3]=1,a):(Ro(ss,e,s),a[0]=ss[0],a[1]=ss[1],a[2]=ss[2],a[3]=1+u,No(a,a))});function Xr(){var a=new A(2);return A!=Float32Array&&(a[0]=0,a[1]=0),a}function jc(a,e){var s=new A(2);return s[0]=a,s[1]=e,s}function Vc(a,e,s){return a[0]=e,a[1]=s,a}function Wa(a,e,s){return a[0]=e[0]+s[0],a[1]=e[1]+s[1],a}function Za(a,e,s){return a[0]=e[0]-s[0],a[1]=e[1]-s[1],a}function Sa(a,e,s){return a[0]=e[0]*s,a[1]=e[1]*s,a}function gr(a){var e=a[0],s=a[1];return Math.sqrt(e*e+s*s)}function Zo(a,e){var s=e[0],u=e[1],d=s*s+u*u;return d>0&&(d=1/Math.sqrt(d)),a[0]=e[0]*d,a[1]=e[1]*d,a}function da(a,e){return a[0]*e[0]+a[1]*e[1]}Ns(),Ns(),Y();var pc,ha,lf=Za;function Gd(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}Xr();var jp=(function(){if(ha)return pc;function a(e,s,u,d){this.cx=3*e,this.bx=3*(u-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(d-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=s,this.p2x=u,this.p2y=d}return ha=1,pc=a,a.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,s){if(s===void 0&&(s=1e-6),e<0)return 0;if(e>1)return 1;for(var u=e,d=0;d<8;d++){var m=this.sampleCurveX(u)-e;if(Math.abs(m)<s)return u;var g=this.sampleCurveDerivativeX(u);if(Math.abs(g)<1e-6)break;u-=m/g}var v=0,b=1;for(u=e,d=0;d<20&&(m=this.sampleCurveX(u),!(Math.abs(m-e)<s));d++)e>m?v=u:b=u,u=.5*(b-v)+v;return u},solve:function(e,s){return this.sampleCurveY(this.solveCurveX(e,s))}},pc})(),mc=Gd(jp);function ct(a,e){this.x=a,this.y=e}function Vl(a,e){if(Array.isArray(a)){if(!Array.isArray(e)||a.length!==e.length)return!1;for(let s=0;s<a.length;s++)if(!Vl(a[s],e[s]))return!1;return!0}if(typeof a=="object"&&a!==null&&e!==null){if(typeof e!="object"||Object.keys(a).length!==Object.keys(e).length)return!1;for(let s in a)if(!Vl(a[s],e[s]))return!1;return!0}return a===e}ct.prototype={clone(){return new ct(this.x,this.y)},add(a){return this.clone()._add(a)},sub(a){return this.clone()._sub(a)},multByPoint(a){return this.clone()._multByPoint(a)},divByPoint(a){return this.clone()._divByPoint(a)},mult(a){return this.clone()._mult(a)},div(a){return this.clone()._div(a)},rotate(a){return this.clone()._rotate(a)},rotateAround(a,e){return this.clone()._rotateAround(a,e)},matMult(a){return this.clone()._matMult(a)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(a){return this.x===a.x&&this.y===a.y},dist(a){return Math.sqrt(this.distSqr(a))},distSqr(a){let e=a.x-this.x,s=a.y-this.y;return e*e+s*s},angle(){return Math.atan2(this.y,this.x)},angleTo(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith(a){return this.angleWithSep(a.x,a.y)},angleWithSep(a,e){return Math.atan2(this.x*e-this.y*a,this.x*a+this.y*e)},_matMult(a){let e=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=e,this},_add(a){return this.x+=a.x,this.y+=a.y,this},_sub(a){return this.x-=a.x,this.y-=a.y,this},_mult(a){return this.x*=a,this.y*=a,this},_div(a){return this.x/=a,this.y/=a,this},_multByPoint(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint(a){return this.x/=a.x,this.y/=a.y,this},_unit(){return this._div(this.mag()),this},_perp(){let a=this.y;return this.y=this.x,this.x=-a,this},_rotate(a){let e=Math.cos(a),s=Math.sin(a),u=s*this.x+e*this.y;return this.x=e*this.x-s*this.y,this.y=u,this},_rotateAround(a,e){let s=Math.cos(a),u=Math.sin(a),d=e.y+u*(this.x-e.x)+s*(this.y-e.y);return this.x=e.x+s*(this.x-e.x)-u*(this.y-e.y),this.y=d,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:ct},ct.convert=function(a){if(a instanceof ct)return a;if(Array.isArray(a))return new ct(+a[0],+a[1]);if(a.x!==void 0&&a.y!==void 0)return new ct(+a.x,+a.y);throw new Error("Expected [x, y] or {x, y} point format")};let qd=Math.PI/180,Wd=180/Math.PI;function Wn(a){return a*qd}function zo(a){return a*Wd}let Zd=[[0,0],[1,0],[1,1],[0,1]];function Xd(a){if(a<=0)return 0;if(a>=1)return 1;let e=a*a,s=e*a;return 4*(a<.5?s:3*(a-e)+s-.75)}function Oe(a,e,s,u){let d=new mc(a,e,s,u);return function(m){return d.solve(m)}}let q=Oe(.25,.1,.25,1);function X(a,e,s){return Math.min(s,Math.max(e,a))}function de(a,e,s){return(s=X((s-a)/(e-a),0,1))*s*(3-2*s)}function ye(a,e,s){let u=s-e,d=((a-e)%u+u)%u+e;return d===e?s:d}function Ce(a,e,s){if(!a.length)return s(null,[]);let u=a.length,d=new Array(a.length),m=null;a.forEach((g,v)=>{e(g,(b,w)=>{b&&(m=b),d[v]=w,--u==0&&s(m,d)})})}let De=1;function He(){return De++}function Pe(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log2(a)))}function Ve(a,e){a.forEach(s=>{e[s]&&(e[s]=e[s].bind(e))})}function ht(a,e,s){let u={};for(let d in a)u[d]=e.call(this,a[d],d,a);return u}function st(a,e,s){let u={};for(let d in a)e.call(this,a[d],d,a)&&(u[d]=a[d]);return u}function Ht(a){return Array.isArray(a)?a.map(Ht):typeof a=="object"&&a?ht(a,Ht):a}function fn(a,e){for(let s=0;s<a.length;s++)if(e.indexOf(a[s])>=0)return!0;return!1}let an={};function Gt(a){an[a]||(typeof console<"u"&&console.warn(a),an[a]=!0)}function Rn(a,e,s){return(s.y-a.y)*(e.x-a.x)>(e.y-a.y)*(s.x-a.x)}function zn(a){let e=0;for(let s,u,d=0,m=a.length,g=m-1;d<m;g=d++)s=a[d],u=a[g],e+=(u.x-s.x)*(s.y+u.y);return e}function Di([a,e,s]){let u=Wn(e+90),d=Wn(s);return{x:a*Math.cos(u)*Math.sin(d),y:a*Math.sin(u)*Math.sin(d),z:a*Math.cos(d),azimuthal:e,polar:s}}function _r(a){return(typeof self<"u"||a!==void 0)&&typeof WorkerGlobalScope<"u"&&(a!==void 0?a:self)instanceof WorkerGlobalScope}function Yr(a){let e={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,u,d,m)=>{let g=d||m;return e[u]=!g||g.toLowerCase(),""}),e["max-age"]){let s=parseInt(e["max-age"],10);isNaN(s)?delete e["max-age"]:e["max-age"]=s}return e}let Fr=null;function Or(a,e){return[a[4*e],a[4*e+1],a[4*e+2],a[4*e+3]]}function bi(a,e,s,u){for(;e<s;){let d=e+s>>1;a[d]<u?e=d+1:s=d}return e}function Zn(a,e,s,u){for(;e<s;){let d=e+s>>1;a[d]<=u?e=d+1:s=d}return e}function er(a){return a>0?1/(1.001-a):1+a}function vr(a){return a>0?1-1/(1.001-a):-a}function Ei(a,e,s){return(a-e.min)*(s.max-s.min)/(e.max-e.min)+s.min}let tr={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!tr.API_URL)return null;try{let a=new URL(tr.API_URL);return a.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":a.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.3.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function oo(a){return tr.API_URL_REGEX.test(a)}function Xo(a){return tr.API_SPRITE_REGEX.test(a)}let fa,Uc,yo,zs,Bo,Ws;function Bs(){return fa==null&&(fa=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),fa}let Zs={now:()=>zs!==void 0?zs:performance.now(),setNow(a){zs=a},restoreNow(){zs=void 0},frame(a){let e=requestAnimationFrame(a);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(a,e=0){let{width:s,height:u}=a;Bo||(Bo=document.createElement("canvas"));let d=Bo.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return(s>Bo.width||u>Bo.height)&&(Bo.width=s,Bo.height=u),d.clearRect(-e,-e,s+2*e,u+2*e),d.drawImage(a,0,0,s,u),d.getImageData(-e,-e,s+2*e,u+2*e)},resolveURL:a=>(Uc||(Uc=document.createElement("a")),Uc.href=a,Uc.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(yo==null&&(yo=window.matchMedia("(prefers-reduced-motion: reduce)")),yo.matches)},hasCanvasFingerprintNoise(){if(Ws!==void 0)return Ws;if(!Bs())return Ws=!1,!1;let a=new OffscreenCanvas(85,1),e=a.getContext("2d",{willReadFrequently:!0}),s=0;for(let d=0;d<a.width;++d)e.fillStyle=`rgba(${s++},${s++},${s++}, 255)`,e.fillRect(d,0,1,1);let u=e.getImageData(0,0,a.width,a.height);s=0;for(let d=0;d<u.data.length;++d)if(d%4!=3&&s++!==u.data[d])return Ws=!0,!0;return Ws=!1,!1}};function cf(a,e){let s=a.indexOf("?");if(s<0)return`${a}?${new URLSearchParams(e).toString()}`;let u=new URLSearchParams(a.slice(s));for(let d in e)u.set(d,e[d]);return`${a.slice(0,s)}?${u.toString()}`}function Yd(a,e={persistentParams:[]}){let s=a.indexOf("?");if(s<0)return a;let u=new URLSearchParams,d=new URLSearchParams(a.slice(s));for(let g of e.persistentParams){let v=d.get(g);v&&u.set(g,v)}let m=u.toString();return`${a.slice(0,s)}${m.length>0?`?${m}`:""}`}let Kd="mapbox-tiles",Jd=500,js=50,Da=["language","worldview","jobid"],ys,Xs;function Ul(){try{return caches}catch{}}function Hc(){let a=Ul();a&&ys==null&&(ys=a.open(Kd))}let Hl=1/0,Qd={supported:!1,testSupport:function(a){!uf&&yl&&(Mg?Vp(a):vl=a)}},vl,yl,uf=!1,Mg=!1,Ia=typeof self<"u"?self:{};function Vp(a){let e=a.createTexture();a.bindTexture(a.TEXTURE_2D,e);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,yl),a.isContextLost())return;Qd.supported=!0}catch{}a.deleteTexture(e),uf=!0}Ia.document&&(yl=Ia.document.createElement("img"),yl.onload=function(){vl&&Vp(vl),vl=null,Mg=!0},yl.onerror=function(){uf=!0,vl=null},yl.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let $c={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze($c);class Gc extends Error{constructor(e,s,u){s===401&&oo(u)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=s,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let Up=_r()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,xl=function(a,e){if(!(/^file:/.test(s=a.url)||/^file:/.test(Up())&&!/^\w+:/.test(s))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return(function(u,d){let m=new AbortController,g=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:Up(),referrerPolicy:u.referrerPolicy,signal:m.signal}),v=!1,b=!1,w=(S=g.url).indexOf("sku=")>0&&oo(S);var S;u.type==="json"&&g.headers.set("Accept","application/json");let D=(R,k,B)=>{if(b)return;if(R&&R.message!=="SecurityError"&&Gt(R.toString()),k&&B)return I(k);let U=Date.now();fetch(g).then(G=>{if(G.ok){let J=w?G.clone():null;return I(G,J,U)}return d(new Gc(G.statusText,G.status,u.url))}).catch(G=>{G.name!=="AbortError"&&d(new Error(`${G.message} ${u.url}`))})},I=(R,k,B)=>{(u.type==="arrayBuffer"?R.arrayBuffer():u.type==="json"?R.json():R.text()).then(U=>{b||(k&&B&&(function(G,J,ee){if(Hc(),ys==null)return;let se=Yr(J.headers.get("Cache-Control")||"");if(se["no-store"])return;let _e={status:J.status,statusText:J.statusText,headers:new Headers};J.headers.forEach((Ee,Se)=>_e.headers.set(Se,Ee)),se["max-age"]&&_e.headers.set("Expires",new Date(ee+1e3*se["max-age"]).toUTCString());let fe=_e.headers.get("Expires");if(!fe||new Date(fe).getTime()-ee<42e4)return;let we=Yd(G.url,{persistentParams:Da});if(J.status===206){let Ee=G.headers.get("Range");if(!Ee)return;_e.status=200,we=cf(we,{range:Ee})}(function(Ee,Se){if(Xs===void 0)try{new Response(new ReadableStream),Xs=!0}catch{Xs=!1}Xs?Se(Ee.body):Ee.blob().then(Se).catch(We=>Gt(We.message))})(J,Ee=>{let Se=new Response((We=J.status)!==200&&We!==404&&[101,103,204,205,304].includes(We)?null:Ee,_e);var We;Hc(),ys?.then(Fe=>Fe.put(we,Se)).catch(Fe=>Gt(Fe.message))})})(g,k,B),v=!0,d(null,U,R.headers))}).catch(U=>{b||d(new Error(U.message))})};return w?(function(R,k){if(Hc(),ys==null)return k(null);ys.then(B=>{let U=Yd(R.url,{persistentParams:Da}),G=R.headers.get("Range");G&&(U=cf(U,{range:G})),B.match(U).then(J=>{let ee=(function(se){if(!se)return!1;let _e=new Date(se.headers.get("Expires")||0),fe=Yr(se.headers.get("Cache-Control")||"");return Number(_e)>Date.now()&&!fe["no-cache"]})(J);B.delete(U).catch(k),ee&&B.put(U,J.clone()).catch(k),k(null,J,ee)}).catch(k)}).catch(k)})(g,D):D(null,null),{cancel:()=>{b=!0,v||m.abort()}}})(a,e);if(_r(self)&&self.worker.actor)return self.worker.actor.send("getResource",a,e,void 0,!0)}var s;return(function(u,d){let m=new XMLHttpRequest;m.open(u.method||"GET",u.url,!0),u.type==="arrayBuffer"&&(m.responseType="arraybuffer");for(let g in u.headers)m.setRequestHeader(g,u.headers[g]);return u.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=u.credentials==="include",m.onerror=()=>{d(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){let g=m.response;if(u.type==="json")try{g=JSON.parse(m.response)}catch(b){return d(b)}let v=new Headers;m.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(b=>{let w=b.split(": "),S=w.shift(),D=w.join(": ");v.append(S,D)}),d(null,g,v)}else d(new Gc(m.statusText,m.status,u.url))},m.send(u.body),{cancel:()=>m.abort()}})(a,e)},Bu=function(a,e){return xl(Object.assign(a,{type:"arrayBuffer"}),e)};function si(a){let e=document.createElement("a");return e.href=a,e.protocol===location.protocol&&e.host===location.host}let df="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",eh,th;eh=[],th=0;let Hp=function(a,e){if(Qd.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),th>=tr.MAX_PARALLEL_IMAGE_REQUESTS){let m={requestParameters:a,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return eh.push(m),m}th++;let s=!1,u=()=>{if(!s)for(s=!0,th--;eh.length&&th<tr.MAX_PARALLEL_IMAGE_REQUESTS;){let m=eh.shift(),{requestParameters:g,callback:v,cancelled:b}=m;b||(m.cancel=Hp(g,v).cancel)}},d=Bu(a,(m,g,v)=>{u(),m?e(m):g&&(self.createImageBitmap?(function(b,w){let S=new Blob([new Uint8Array(b)],{type:"image/png"});createImageBitmap(S).then(D=>{w(null,D)}).catch(D=>{w(new Error(`Could not load image because of ${D.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})})(g,(b,w)=>e(b,w,v)):(function(b,w){let S=new Image;S.onload=()=>{w(null,S),URL.revokeObjectURL(S.src),S.onload=null,requestAnimationFrame(()=>{S.src=df})},S.onerror=()=>w(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let D=new Blob([new Uint8Array(b)],{type:"image/png"});S.src=b.byteLength?URL.createObjectURL(D):df})(g,(b,w)=>e(b,w,v)))});return{cancel:()=>{d.cancel(),u()}}};var nh,ih,rh,qc={exports:{}},Wc={exports:{}},hf={exports:{}},Cv=(function(){if(rh)return qc.exports;rh=1;var a=(nh||(nh=1,Wc.exports=function(s,u){var d,m,g,v,b,w,S,D;for(m=s.length-(d=3&s.length),g=u,b=3432918353,w=461845907,D=0;D<m;)S=255&s.charCodeAt(D)|(255&s.charCodeAt(++D))<<8|(255&s.charCodeAt(++D))<<16|(255&s.charCodeAt(++D))<<24,++D,g=27492+(65535&(v=5*(65535&(g=(g^=S=(65535&(S=(S=(65535&S)*b+(((S>>>16)*b&65535)<<16)&4294967295)<<15|S>>>17))*w+(((S>>>16)*w&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(S=0,d){case 3:S^=(255&s.charCodeAt(D+2))<<16;case 2:S^=(255&s.charCodeAt(D+1))<<8;case 1:g^=S=(65535&(S=(S=(65535&(S^=255&s.charCodeAt(D)))*b+(((S>>>16)*b&65535)<<16)&4294967295)<<15|S>>>17))*w+(((S>>>16)*w&65535)<<16)&4294967295}return g^=s.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}),Wc.exports),e=(ih||(ih=1,hf.exports=function(s,u){for(var d,m=s.length,g=u^m,v=0;m>=4;)d=1540483477*(65535&(d=255&s.charCodeAt(v)|(255&s.charCodeAt(++v))<<8|(255&s.charCodeAt(++v))<<16|(255&s.charCodeAt(++v))<<24))+((1540483477*(d>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),m-=4,++v;switch(m){case 3:g^=(255&s.charCodeAt(v+2))<<16;case 2:g^=(255&s.charCodeAt(v+1))<<8;case 1:g=1540483477*(65535&(g^=255&s.charCodeAt(v)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}),hf.exports);return qc.exports=a,qc.exports.murmur3=a,qc.exports.murmur2=e,qc.exports})(),ju=Gd(Cv);class pa{constructor(e,...s){Object.assign(this,s[0]||{}),this.type=e}}class Ma extends pa{constructor(e,s={}){super("error",Object.assign({error:e},s))}}function Vu(a,e,s){s[a]&&s[a].indexOf(e)!==-1||(s[a]=s[a]||[],s[a].push(e))}function Uu(a,e,s){if(s&&s[a]){let u=s[a].indexOf(e);u!==-1&&s[a].splice(u,1)}}class ma{on(e,s){return this._listeners=this._listeners||{},Vu(e,s,this._listeners),this}off(e,s){return Uu(e,s,this._listeners),Uu(e,s,this._oneTimeListeners),this}once(e,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},Vu(e,s,this._oneTimeListeners),this):new Promise(u=>{this.once(e,u)})}fire(e,s){let u=typeof e=="string"?new pa(e,s):e,d=u.type;if(this.listens(d)){u.target=this;let m=this._listeners&&this._listeners[d]?this._listeners[d].slice():[];for(let b of m)b.call(this,u);let g=this._oneTimeListeners&&this._oneTimeListeners[d]?this._oneTimeListeners[d].slice():[];for(let b of g)Uu(d,b,this._oneTimeListeners),b.call(this,u);let v=this._eventedParent;if(v){let b=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(u,b),v.fire(u)}}else u instanceof Ma&&console.error(u.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,s){return this._eventedParent=e,this._eventedParentData=s,this}}class uo{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new uo(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){let[s,u]=e.split("");return new uo({name:s,iconsetId:u})}static isEqual(e,s){return e.name===s.name&&e.iconsetId===s.iconsetId}toString(){return uo.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var $p,Gp={},ff=(function(){if($p)return Gp;$p=1;var a={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(m){return(m=Math.round(m))<0?0:m>255?255:m}function s(m){return e(m[m.length-1]==="%"?parseFloat(m)/100*255:parseInt(m))}function u(m){return(g=m[m.length-1]==="%"?parseFloat(m)/100:parseFloat(m))<0?0:g>1?1:g;var g}function d(m,g,v){return v<0?v+=1:v>1&&(v-=1),6*v<1?m+(g-m)*v*6:2*v<1?g:3*v<2?m+(g-m)*(2/3-v)*6:m}try{Gp.parseCSSColor=function(m){var g,v=m.replace(/ /g,"").toLowerCase();if(v in a)return a[v].slice();if(v[0]==="#")return v.length===4?(g=parseInt(v.substr(1),16))>=0&&g<=4095?[(3840&g)>>4|(3840&g)>>8,240&g|(240&g)>>4,15&g|(15&g)<<4,1]:null:v.length===7&&(g=parseInt(v.substr(1),16))>=0&&g<=16777215?[(16711680&g)>>16,(65280&g)>>8,255&g,1]:null;var b=v.indexOf("("),w=v.indexOf(")");if(b!==-1&&w+1===v.length){var S=v.substr(0,b),D=v.substr(b+1,w-(b+1)).split(","),I=1;switch(S){case"rgba":if(D.length!==4)return null;I=u(D.pop());case"rgb":return D.length!==3?null:[s(D[0]),s(D[1]),s(D[2]),I];case"hsla":if(D.length!==4)return null;I=u(D.pop());case"hsl":if(D.length!==3)return null;var R=(parseFloat(D[0])%360+360)%360/360,k=u(D[1]),B=u(D[2]),U=B<=.5?B*(k+1):B+k-B*k,G=2*B-U;return[e(255*d(G,U,R+1/3)),e(255*d(G,U,R)),e(255*d(G,U,R-1/3)),I];default:return null}}return null}}catch{}return Gp})();class Qn{constructor(e,s,u,d=1){this.r=e,this.g=s,this.b=u,this.a=d}static parse(e){if(!e)return;if(e instanceof Qn)return e;if(typeof e!="string")return;let s=ff.parseCSSColor(e);return s?new Qn(s[0]/255,s[1]/255,s[2]/255,s[3]):void 0}toString(){let[e,s,u,d]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*s)},${Math.round(255*u)},${d})`}toNonPremultipliedRenderColor(e){let{r:s,g:u,b:d,a:m}=this;return new Ag(e,s,u,d,m)}toPremultipliedRenderColor(e){let{r:s,g:u,b:d,a:m}=this;return new Pg(e,s*m,u*m,d*m,m)}clone(){return new Qn(this.r,this.g,this.b,this.a)}}class qp{constructor(e,s,u,d,m,g=!1){if(this.premultiplied=!1,this.premultiplied=g,e){let v=e.image.height,b=v*v;this.premultiplied?(s=m===0?0:s/m*(v-1),u=m===0?0:u/m*(v-1),d=m===0?0:d/m*(v-1)):(s*=v-1,u*=v-1,d*=v-1);let w=Math.floor(s),S=Math.floor(u),D=Math.floor(d),I=Math.ceil(s),R=Math.ceil(u),k=Math.ceil(d),B=s-w,U=u-S,G=d-D,J=e.image.data,ee=4*(w+S*b+D*v),se=4*(w+S*b+k*v),_e=4*(w+R*b+D*v),fe=4*(w+R*b+k*v),we=4*(I+S*b+D*v),Ee=4*(I+S*b+k*v),Se=4*(I+R*b+D*v),We=4*(I+R*b+k*v);if(ee<0||We>=J.length)throw new Error("out of range");this.r=ln(ln(ln(J[ee],J[se],G),ln(J[_e],J[fe],G),U),ln(ln(J[we],J[Ee],G),ln(J[Se],J[We],G),U),B)/255*(this.premultiplied?m:1),this.g=ln(ln(ln(J[ee+1],J[se+1],G),ln(J[_e+1],J[fe+1],G),U),ln(ln(J[we+1],J[Ee+1],G),ln(J[Se+1],J[We+1],G),U),B)/255*(this.premultiplied?m:1),this.b=ln(ln(ln(J[ee+2],J[se+2],G),ln(J[_e+2],J[fe+2],G),U),ln(ln(J[we+2],J[Ee+2],G),ln(J[Se+2],J[We+2],G),U),B)/255*(this.premultiplied?m:1),this.a=m}else this.r=s,this.g=u,this.b=d,this.a=m}toArray(){let{r:e,g:s,b:u,a:d}=this;return[255*e,255*s,255*u,d]}toHslaArray(){let{r:e,g:s,b:u,a:d}=this;if(this.premultiplied){if(d===0)return[0,0,0,0];let k=1/d;e*=k,s*=k,u*=k}let m=Math.min(Math.max(e,0),1),g=Math.min(Math.max(s,0),1),v=Math.min(Math.max(u,0),1),b=Math.min(m,g,v),w=Math.max(m,g,v),S=w-b,D=.5*(b+w);if(S===0)return[0,0,100*D,d];let I=D>.5?S/(2-w-b):S/(w+b),R;switch(w){case m:R=60*((g-v)/S+(g<v?6:0));break;case g:R=60*((v-m)/S+2);break;default:R=60*((m-g)/S+4)}return[R,100*I,100*D,d]}toArray01(){let{r:e,g:s,b:u,a:d}=this;return[e,s,u,d]}toArray01Scaled(e){let{r:s,g:u,b:d}=this;return[s*e,u*e,d*e]}toArray01Linear(){let{r:e,g:s,b:u,a:d}=this;return[Math.pow(e,2.2),Math.pow(s,2.2),Math.pow(u,2.2),d]}}class Ag extends qp{constructor(e,s,u,d,m){super(e,s,u,d,m,!1)}}class Pg extends qp{constructor(e,s,u,d,m){super(e,s,u,d,m,!0)}}function ln(a,e,s){return a*(1-s)+e*s}function oh(a,e,s){return a.map((u,d)=>ln(u,e[d],s))}Qn.black=new Qn(0,0,0,1),Qn.white=new Qn(1,1,1,1),Qn.transparent=new Qn(0,0,0,0),Qn.red=new Qn(1,0,0,1),Qn.blue=new Qn(0,0,1,1);var $l=Object.freeze({__proto__:null,array:oh,color:function(a,e,s){return new Qn(ln(a.r,e.r,s),ln(a.g,e.g,s),ln(a.b,e.b,s),ln(a.a,e.a,s))},number:ln});class Aa extends Error{constructor(e,s){super(s),this.message=s,this.key=e}}class Pa{constructor(e,s=[]){this.parent=e,this.bindings={};for(let[u,d]of s)this.bindings[u]=d}concat(e){return new Pa(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}let Hu={kind:"null"},Kt={kind:"number"},Yn={kind:"string"},li={kind:"boolean"},Ys={kind:"color"},$u={kind:"object"},wi={kind:"value"},Gu={kind:"collator"},Zc={kind:"formatted"},Xc={kind:"resolvedImage"};function Io(a,e){return{kind:"array",itemType:a,N:e}}function to(a){if(a.kind==="array"){let e=to(a.itemType);return typeof a.N=="number"?`array<${e}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${e}>`}return a.kind}let Wp=[Hu,Kt,Yn,li,Ys,Zc,$u,Io(wi),Xc];function gc(a,e){if(e.kind==="error")return null;if(a.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!gc(a.itemType,e.itemType))&&(typeof a.N!="number"||a.N===e.N))return null}else{if(a.kind===e.kind)return null;if(a.kind==="value"){for(let s of Wp)if(!gc(s,e))return null}}return`Expected ${to(a)} but found ${to(e)} instead.`}function Zp(a,e){return e.some(s=>s.kind===a.kind)}function qu(a,e){return e.some(s=>s==="null"?a===null:s==="array"?Array.isArray(a):s==="object"?a&&!Array.isArray(a)&&typeof a=="object":s===typeof a)}function sh(a,e){return a.kind==="array"&&e.kind==="array"?a.N===e.N&&sh(a.itemType,e.itemType):a.kind===e.kind}class pf{constructor(e,s,u){this.sensitivity=e?s?"variant":"case":s?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,s){return this.collator.compare(e,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Wu{constructor(e,s,u,d,m){this.text=e.normalize?e.normalize():e,this.image=s,this.scale=u,this.fontStack=d,this.textColor=m}}class xo{constructor(e){this.sections=e}static fromString(e){return new xo([new Wu(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof xo?e:xo.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){let e=["format"];for(let s of this.sections){if(s.image){let d=s.image.getPrimary().id.toString();e.push(["image",d]);continue}e.push(s.text);let u={};s.fontStack&&(u["text-font"]=["literal",s.fontStack.split(",")]),s.scale&&(u["font-scale"]=s.scale),s.textColor&&(u["text-color"]=["rgba"].concat(s.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(u)}return e}}class bl{constructor(e,s={}){if(this.id=uo.from(e),this.options=Object.assign({},s),s.transform){let{a:u,b:d,c:m,d:g,e:v,f:b}=s.transform;this.options.transform=new DOMMatrix([u,d,m,g,v,b])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){let{a:e,b:s,c:u,d,e:m,f:g}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:s,c:u,d,e:m,f:g}})}static parse(e){let s,u,d,m;try{({name:s,iconsetId:u,params:d,transform:m}=JSON.parse(e)||{})}catch{return null}if(!s)return null;let{a:g,b:v,c:b,d:w,e:S,f:D}=m||{};return new bl({name:s,iconsetId:u},{params:d,transform:new DOMMatrix([g,v,b,w,S,D])})}scaleSelf(e,s){return this.options.transform.scaleSelf(e,s),this}}class xs{constructor(e,s,u,d,m=!1){this.primaryId=uo.from(e),this.primaryOptions=s,u&&(this.secondaryId=uo.from(u)),this.secondaryOptions=d,this.available=m}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new bl(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new bl(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?xs.build({name:e}):e}static build(e,s,u,d){return!e||typeof e=="object"&&!("name"in e)?null:new xs(e,u,s,d)}}function ah(a,e,s,u){return typeof a=="number"&&a>=0&&a<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof s=="number"&&s>=0&&s<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[a,e,s,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[a,e,s,u]:[a,e,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Yc(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof Qn||a instanceof pf||a instanceof xo||a instanceof xs)return!0;if(Array.isArray(a)){for(let e of a)if(!Yc(e))return!1;return!0}if(typeof a=="object"){for(let e in a)if(!Yc(a[e]))return!1;return!0}return!1}function $r(a){if(a===null)return Hu;if(typeof a=="string")return Yn;if(typeof a=="boolean")return li;if(typeof a=="number")return Kt;if(a instanceof Qn)return Ys;if(a instanceof pf)return Gu;if(a instanceof xo)return Zc;if(a instanceof xs)return Xc;if(Array.isArray(a)){let e=a.length,s;for(let u of a){let d=$r(u);if(s){if(s===d)continue;s=wi;break}s=d}return Io(s||wi,e)}return $u}function wl(a){let e=typeof a;return a===null?"":e==="string"||e==="number"||e==="boolean"?String(a):a instanceof xo||a instanceof xs||a instanceof Qn?a.toString():JSON.stringify(a)}class Gl{constructor(e,s){this.type=e,this.value=s}static parse(e,s){if(e.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Yc(e[1]))return s.error("invalid value");let u=e[1],d=$r(u),m=s.expectedType;return d.kind!=="array"||d.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(d=m),new Gl(d,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Qn?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof xo?this.value.serialize():this.value}}class Lr{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}let In={string:Yn,number:Kt,boolean:li,object:$u};class Vt{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");let u,d=1,m=e[0];if(m==="array"){let v,b;if(e.length>2){let w=e[1];if(typeof w!="string"||!(w in In)||w==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);v=In[w],d++}else v=wi;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return s.error('The length argument to "array" must be a positive integer literal',2);b=e[2],d++}u=Io(v,b)}else u=In[m];let g=[];for(;d<e.length;d++){let v=s.parse(e[d],d,wi);if(!v)return null;g.push(v)}return new Vt(u,g)}evaluate(e){for(let s=0;s<this.args.length;s++){let u=this.args[s].evaluate(e);if(!gc(this.type,$r(u)))return u;if(s===this.args.length-1)throw new Lr(`The expression ${JSON.stringify(this.args[s].serialize())} evaluated to ${to($r(u))} but was expected to be of type ${to(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=this.type,s=[e.kind];if(e.kind==="array"){let u=e.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){s.push(u.kind);let d=e.N;(typeof d=="number"||this.args.length>1)&&s.push(d)}}return s.concat(this.args.map(u=>u.serialize()))}}class _c{constructor(e){this.type=Zc,this.sections=e}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");let u=e[1];if(!Array.isArray(u)&&typeof u=="object")return s.error("First argument must be an image or text section.");let d=[],m=!1;for(let g=1;g<=e.length-1;++g){let v=e[g];if(m&&typeof v=="object"&&!Array.isArray(v)){m=!1;let b=null;if(v["font-scale"]&&(b=s.parseObjectValue(v["font-scale"],g,"font-scale",Kt),!b))return null;let w=null;if(v["text-font"]&&(w=s.parseObjectValue(v["text-font"],g,"text-font",Io(Yn)),!w))return null;let S=null;if(v["text-color"]&&(S=s.parseObjectValue(v["text-color"],g,"text-color",Ys),!S))return null;let D=d[d.length-1];D.scale=b,D.font=w,D.textColor=S}else{let b=s.parse(e[g],g,wi);if(!b)return null;let w=b.type.kind;if(w!=="string"&&w!=="value"&&w!=="null"&&w!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,d.push({content:b,scale:null,font:null,textColor:null})}}return new _c(d)}evaluate(e){return new xo(this.sections.map(s=>{let u=s.content.evaluate(e);return sh($r(u),Xc)?new Wu("",u,null,null,null):new Wu(wl(u),null,s.scale?s.scale.evaluate(e):null,s.font?s.font.evaluate(e).join(","):null,s.textColor?s.textColor.evaluate(e):null)}))}eachChild(e){for(let s of this.sections)e(s.content),s.scale&&e(s.scale),s.font&&e(s.font),s.textColor&&e(s.textColor)}outputDefined(){return!1}serialize(){let e=["format"];for(let s of this.sections){e.push(s.content.serialize());let u={};s.scale&&(u["font-scale"]=s.scale.serialize()),s.font&&(u["text-font"]=s.font.serialize()),s.textColor&&(u["text-color"]=s.textColor.serialize()),e.push(u)}return e}}class mn{constructor(e,s,u,d){this._imageWarnHistory={},this.type=Xc,this.namePrimary=e,this.nameSecondary=s,u&&(this.paramsPrimary=u.params,this.iconsetIdPrimary=u.iconset?u.iconset.id:void 0),d&&(this.paramsSecondary=d.params,this.iconsetIdSecondary=d.iconset?d.iconset.id:void 0)}static parse(e,s){if(e.length<2)return s.error("Expected two or more arguments.");let u=1,d=[];function m(){if(u<e.length){let v=s.parse(e[u],u++,Yn);return v?(d.push({image:v,options:{}}),!0):(s.error(d.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function g(){if(u<e.length){let b=e[u];if((v=b)===null||typeof v!="object"||Array.isArray(v))return!0;let w=b.params,S=b.iconset,D=s.concat(u);if(!w&&!S)return u++,!0;if(w){if(typeof w!="object"||w.constructor!==Object)return D.error('Image options "params" should be an object'),!1;let I={},R=D.concat(void 0,"params");for(let k in w){if(!k)return R.error("Image parameter name should be non-empty"),!1;let B=R.concat(void 0,k).parse(w[k],void 0,Ys,void 0,{typeAnnotation:"coerce"});if(!B)return!1;I[k]=B}d[d.length-1].options.params=I}if(S){if(typeof S!="object"||S.constructor!==Object)return D.error('Image options "iconset" should be an object'),!1;if(!S.id)return D.error('Image options "iconset" should have an "id" property'),!1;d[d.length-1].options.iconset=S}return u++,!0}var v;return!0}for(let v=0;v<2;v++)if(!m()||!g())return;return new mn(d[0].image,d[1]?d[1].image:void 0,d[0].options,d[1]?d[1].options:void 0)}evaluateParams(e,s){let u={};if(s){for(let d in s)if(s[d])try{u[d]=s[d].evaluate(e)}catch{continue}if(Object.keys(u).length!==0)return{params:u}}}evaluate(e){let s={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},u=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,d=xs.build(s,u,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(d&&e.availableImages){let m=d.getPrimary().id;if(d.available=e.availableImages.some(g=>uo.isEqual(g,m)),d.available){let g=d.getSecondary()?d.getSecondary().id:null;g&&(d.available=e.availableImages.some(v=>uo.isEqual(v,g)))}}return d}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(let s in this.paramsPrimary)this.paramsPrimary[s]&&e(this.paramsPrimary[s]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(let s in this.paramsSecondary)this.paramsSecondary[s]&&e(this.paramsSecondary[s])}outputDefined(){return!1}serializeOptions(e,s){let u={};if(s&&(u.iconset={id:s}),e){u.params={};for(let d in e)e[d]&&(u.params[d]=e[d].serialize())}return Object.keys(u).length>0?u:void 0}serialize(){let e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){let s=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);s&&e.push(s)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){let s=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);s&&e.push(s)}return e}}function Zu(a){return dn(a)?"string":Xu(a)?"number":gf(a)?"boolean":Array.isArray(a)?"array":a===null?"null":mf(a)?"object":typeof a}function mf(a){return a!=null&&!Array.isArray(a)&&typeof a!="function"&&!(a instanceof String||a instanceof Number||a instanceof Boolean)&&typeof a=="object"}function dn(a){return typeof a=="string"||a instanceof String}function Xu(a){return typeof a=="number"||a instanceof Number}function gf(a){return typeof a=="boolean"||a instanceof Boolean}let Xp={"to-boolean":li,"to-color":Ys,"to-number":Kt,"to-string":Yn};class Cl{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");let u=e[0],d=[],m=Hu;if(u==="to-array"){if(!Array.isArray(e[1]))return null;let g=e[1].length;if(s.expectedType){if(s.expectedType.kind!=="array")return s.error(`Expected ${s.expectedType.kind} but found array.`);m=Io(s.expectedType.itemType,g)}else{if(!(g>0&&Yc(e[1][0])))return null;m=Io($r(e[1][0]),g)}for(let v=0;v<g;v++){let b=e[1][v],w;if(Array.isArray(b))w=s.parse(b,void 0,m.itemType);else{let S=Zu(b);if(S!==m.itemType.kind)return s.error(`Expected ${m.itemType.kind} but found ${S}.`);w=s.registry.literal.parse(["literal",b===void 0?null:b],s)}if(!w)return null;d.push(w)}}else{if((u==="to-boolean"||u==="to-string")&&e.length!==2)return s.error("Expected one argument.");m=Xp[u];for(let g=1;g<e.length;g++){let v=s.parse(e[g],g,wi);if(!v)return null;d.push(v)}}return new Cl(m,d)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let s,u;for(let d of this.args){if(s=d.evaluate(e),u=null,s instanceof Qn)return s;if(typeof s=="string"){let m=e.parseColor(s);if(m)return m}else if(Array.isArray(s)&&(u=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:ah(s[0],s[1],s[2],s[3]),!u))return new Qn(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new Lr(u||`Could not parse color from value '${typeof s=="string"?s:String(JSON.stringify(s))}'`)}if(this.type.kind==="number"){let s=null;for(let u of this.args){if(s=u.evaluate(e),s===null)return 0;let d=Number(s);if(!isNaN(d))return d}throw new Lr(`Could not convert ${JSON.stringify(s)} to number.`)}return this.type.kind==="formatted"?xo.fromString(wl(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?xs.build(wl(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(s=>s.evaluate(e)):wl(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new _c([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new mn(this.args[0]).serialize();let e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(s=>{e.push(s.serialize())}),e}}let lh=["Unknown","Point","LineString","Polygon"];class bo{constructor(e,s,u){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=s,this.iconImageUseTheme=u}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?lh[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let e=this.featureDistanceData.center,s=this.featureDistanceData.scale,{x:u,y:d}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*s-e[0])+this.featureDistanceData.bearing[1]*(d*s-e[1])}return 0}parseColor(e){let s=this._parseColorCache[e];return s||(s=this._parseColorCache[e]=Qn.parse(e)),s}getConfig(e){return this.options?this.options.get(e):null}}class as{constructor(e,s,u,d,m){this.name=e,this.type=s,this._evaluate=u,this.args=d,this._overloadIndex=m}evaluate(e){if(!this._evaluate){let s=as.definitions[this.name];this._evaluate=Array.isArray(s)?s[2]:s.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,s){let u=e[0],d=as.definitions[u];if(!d)return s.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);let m=Array.isArray(d)?d[0]:d.type,g=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,v=[],b=null,w=-1;for(let[S,D]of g){if(Array.isArray(S)&&S.length!==e.length-1)continue;v.push(S),w++,b=new Bg(s.registry,s.path,null,s.scope,void 0,s._scope,s.options,s.iconImageUseTheme);let I=[],R=!1;for(let k=1;k<e.length;k++){let B=e[k],U=Array.isArray(S)?S[k-1]:S.type,G=b.parse(B,1+I.length,U);if(!G){R=!0;break}I.push(G)}if(!R)if(Array.isArray(S)&&S.length!==I.length)b.error(`Expected ${S.length} arguments, but found ${I.length} instead.`);else{for(let k=0;k<I.length;k++){let B=Array.isArray(S)?S[k]:S.type,U=I[k];b.concat(k+1).checkSubtype(B,U.type)}if(b.errors.length===0)return new as(u,m,D,I,w)}}if(v.length===1)s.errors.push(...b.errors);else{let S=(v.length?v:g.map(([I])=>I)).map(Kc).join(" | "),D=[];for(let I=1;I<e.length;I++){let R=s.parse(e[I],1+D.length);if(!R)return null;D.push(to(R.type))}s.error(`Expected arguments of type ${S}, but found (${D.join(", ")}) instead.`)}return null}static register(e,s){as.definitions=s;for(let u in s)e[u]=as}}function Kc(a){return Array.isArray(a)?`(${a.map(to).join(", ")})`:`(${to(a.type)}...)`}class Yu{constructor(e,s,u){this.type=Gu,this.locale=u,this.caseSensitive=e,this.diacriticSensitive=s}static parse(e,s){if(e.length!==2)return s.error("Expected one argument.");let u=e[1];if(typeof u!="object"||Array.isArray(u))return s.error("Collator options argument must be an object.");let d=u["case-sensitive"]===void 0?s.parse(!1,1,li):s.parseObjectValue(u["case-sensitive"],1,"case-sensitive",li);if(!d)return null;let m=u["diacritic-sensitive"]===void 0?s.parse(!1,1,li):s.parseObjectValue(u["diacritic-sensitive"],1,"diacritic-sensitive",li);if(!m)return null;let g=null;return u.locale&&(g=s.parseObjectValue(u.locale,1,"locale",Yn),!g)?null:new Yu(d,m,g)}evaluate(e){return new pf(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){let e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function ql(a,e,s=0,u=a.length-1,d=Ev){for(;u>s;){if(u-s>600){let b=u-s+1,w=e-s+1,S=Math.log(b),D=.5*Math.exp(2*S/3),I=.5*Math.sqrt(S*D*(b-D)/b)*(w-b/2<0?-1:1);ql(a,e,Math.max(s,Math.floor(e-w*D/b+I)),Math.min(u,Math.floor(e+(b-w)*D/b+I)),d)}let m=a[e],g=s,v=u;for(ho(a,s,e),d(a[u],m)>0&&ho(a,s,u);g<v;){for(ho(a,g,v),g++,v--;d(a[g],m)<0;)g++;for(;d(a[v],m)>0;)v--}d(a[s],m)===0?ho(a,s,v):(v++,ho(a,v,u)),v<=e&&(s=v+1),e<=v&&(u=v-1)}}function ho(a,e,s){let u=a[e];a[e]=a[s],a[s]=u}function Ev(a,e){return a<e?-1:a>e?1:0}function Tv(a){let e=0;for(let s,u,d=0,m=a.length,g=m-1;d<m;g=d++)s=a[d],u=a[g],e+=(u.x-s.x)*(s.y+u.y);return e}function ch(a,e){a[0]=Math.min(a[0],e[0]),a[1]=Math.min(a[1],e[1]),a[2]=Math.max(a[2],e[0]),a[3]=Math.max(a[3],e[1])}function vc(a,e){return!(a[0]<=e[0]||a[2]>=e[2]||a[1]<=e[1]||a[3]>=e[3])}function Yp(a,e,s){let u=a[0]-e[0],d=a[1]-e[1],m=a[0]-s[0],g=a[1]-s[1];return u*g-m*d==0&&u*m<=0&&d*g<=0}function Oa(a,e,s=!1){let u=!1;for(let v=0,b=e.length;v<b;v++){let w=e[v];for(let S=0,D=w.length,I=D-1;S<D;I=S++){let R=w[I],k=w[S];if(Yp(a,R,k))return s;(m=R)[1]>(d=a)[1]!=(g=k)[1]>d[1]&&d[0]<(g[0]-m[0])*(d[1]-m[1])/(g[1]-m[1])+m[0]&&(u=!u)}}var d,m,g;return u}function Og(a,e,s,u){let d=u[0]-s[0],m=u[1]-s[1],g=(a[0]-s[0])*m-d*(a[1]-s[1]),v=(e[0]-s[0])*m-d*(e[1]-s[1]);return g>0&&v<0||g<0&&v>0}function _f(a,e,s,u){return(d=[u[0]-s[0],u[1]-s[1]])[0]*(m=[e[0]-a[0],e[1]-a[1]])[1]-d[1]*m[0]!=0&&!(!Og(a,e,s,u)||!Og(s,u,a,e));var d,m}function uh(a){let e=new ct(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),s=new ct(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let u of a[0])e.x>u.x&&(e.x=u.x),e.y>u.y&&(e.y=u.y),s.x<u.x&&(s.x=u.x),s.y<u.y&&(s.y=u.y);return{min:e,max:s}}let Wl=8192;function Rg(a,e){let s=(180+a[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,d=Math.pow(2,e.z);return[Math.round(s*d*Wl),Math.round(u*d*Wl)]}function kg(a,e){for(let s=0;s<e.length;s++)if(Oa(a,e[s]))return!0;return!1}function Sv(a,e,s){for(let u of s)for(let d=0,m=u.length,g=m-1;d<m;g=d++)if(_f(a,e,u[g],u[d]))return!0;return!1}function yc(a,e){for(let s=0;s<a.length;++s)if(!Oa(a[s],e))return!1;for(let s=0;s<a.length-1;++s)if(Sv(a[s],a[s+1],e))return!1;return!0}function Fg(a,e){for(let s=0;s<e.length;s++)if(yc(a,e[s]))return!0;return!1}function dh(a,e,s){let u=[];for(let d=0;d<a.length;d++){let m=[];for(let g=0;g<a[d].length;g++){let v=Rg(a[d][g],s);ch(e,v),m.push(v)}u.push(m)}return u}function vf(a,e,s){let u=[];for(let d=0;d<a.length;d++){let m=dh(a[d],e,s);u.push(m)}return u}function Kp(a,e,s,u){if(a[0]<s[0]||a[0]>s[2]){let d=.5*u,m=a[0]-s[0]>d?-u:s[0]-a[0]>d?u:0;m===0&&(m=a[0]-s[2]>d?-u:s[2]-a[0]>d?u:0),a[0]+=m}ch(e,a)}function Jp(a,e,s,u){let d=Math.pow(2,u.z)*Wl,m=[u.x*Wl,u.y*Wl],g=[];if(!a)return g;for(let v of a)for(let b of v){let w=[b.x+m[0],b.y+m[1]];Kp(w,e,s,d),g.push(w)}return g}function Xa(a,e,s,u){let d=Math.pow(2,u.z)*Wl,m=[u.x*Wl,u.y*Wl],g=[];if(!a)return g;for(let b of a){let w=[];for(let S of b){let D=[S.x+m[0],S.y+m[1]];ch(e,D),w.push(D)}g.push(w)}if(e[2]-e[0]<=d/2){(v=e)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(let b of g)for(let w of b)Kp(w,e,s,d)}var v;return g}class Ku{constructor(e,s){this.type=li,this.geojson=e,this.geometries=s}static parse(e,s){if(e.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Yc(e[1])){let u=e[1];if(u.type==="FeatureCollection")for(let d=0;d<u.features.length;++d){let m=u.features[d].geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new Ku(u,u.features[d].geometry)}else if(u.type==="Feature"){let d=u.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new Ku(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new Ku(u,u)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(s,u){let d=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=s.canonicalID();if(!g)return!1;if(u.type==="Polygon"){let v=dh(u.coordinates,m,g),b=Jp(s.geometry(),d,m,g);if(!vc(d,m))return!1;for(let w of b)if(!Oa(w,v))return!1}if(u.type==="MultiPolygon"){let v=vf(u.coordinates,m,g),b=Jp(s.geometry(),d,m,g);if(!vc(d,m))return!1;for(let w of b)if(!kg(w,v))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(s,u){let d=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=s.canonicalID();if(!g)return!1;if(u.type==="Polygon"){let v=dh(u.coordinates,m,g),b=Xa(s.geometry(),d,m,g);if(!vc(d,m))return!1;for(let w of b)if(!yc(w,v))return!1}if(u.type==="MultiPolygon"){let v=vf(u.coordinates,m,g),b=Xa(s.geometry(),d,m,g);if(!vc(d,m))return!1;for(let w of b)if(!Fg(w,v))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}let yf={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Qp=1/298.257223563,em=Qp*(2-Qp),Jc=Math.PI/180;class Ju{static fromTile(e,s,u){let d=Math.PI*(1-2*(e+.5)/Math.pow(2,s)),m=Math.atan(.5*(Math.exp(d)-Math.exp(-d)))/Jc;return new Ju(m,u)}static get units(){return yf}constructor(e,s){if(e===void 0)throw new Error("No latitude given.");if(s&&!yf[s])throw new Error(`Unknown unit ${s}. Use one of: ${Object.keys(yf).join(", ")}`);let u=6378.137*Jc*(s?yf[s]:1),d=Math.cos(e*Jc),m=1/(1-em*(1-d*d)),g=Math.sqrt(m);this.kx=u*g*d,this.ky=u*g*m*(1-em)}distance(e,s){let u=ga(e[0]-s[0])*this.kx,d=(e[1]-s[1])*this.ky;return Math.sqrt(u*u+d*d)}bearing(e,s){let u=ga(s[0]-e[0])*this.kx;return Math.atan2(u,(s[1]-e[1])*this.ky)/Jc}destination(e,s,u){let d=u*Jc;return this.offset(e,Math.sin(d)*s,Math.cos(d)*s)}offset(e,s,u){return[e[0]+s/this.kx,e[1]+u/this.ky]}lineDistance(e){let s=0;for(let u=0;u<e.length-1;u++)s+=this.distance(e[u],e[u+1]);return s}area(e){let s=0;for(let u=0;u<e.length;u++){let d=e[u];for(let m=0,g=d.length,v=g-1;m<g;v=m++)s+=ga(d[m][0]-d[v][0])*(d[m][1]+d[v][1])*(u?-1:1)}return Math.abs(s)/2*this.kx*this.ky}along(e,s){let u=0;if(s<=0)return e[0];for(let d=0;d<e.length-1;d++){let m=e[d],g=e[d+1],v=this.distance(m,g);if(u+=v,u>s)return xf(m,g,(s-(u-v))/v)}return e[e.length-1]}pointToSegmentDistance(e,s,u){let[d,m]=s,g=ga(u[0]-d)*this.kx,v=(u[1]-m)*this.ky;if(g!==0||v!==0){let b=(ga(e[0]-d)*this.kx*g+(e[1]-m)*this.ky*v)/(g*g+v*v);b>1?(d=u[0],m=u[1]):b>0&&(d+=g/this.kx*b,m+=v/this.ky*b)}return g=ga(e[0]-d)*this.kx,v=(e[1]-m)*this.ky,Math.sqrt(g*g+v*v)}pointOnLine(e,s){let u=1/0,d=e[0][0],m=e[0][1],g=0,v=0;for(let b=0;b<e.length-1;b++){let w=e[b][0],S=e[b][1],D=ga(e[b+1][0]-w)*this.kx,I=(e[b+1][1]-S)*this.ky,R=0;D===0&&I===0||(R=(ga(s[0]-w)*this.kx*D+(s[1]-S)*this.ky*I)/(D*D+I*I),R>1?(w=e[b+1][0],S=e[b+1][1]):R>0&&(w+=D/this.kx*R,S+=I/this.ky*R)),D=ga(s[0]-w)*this.kx,I=(s[1]-S)*this.ky;let k=D*D+I*I;k<u&&(u=k,d=w,m=S,g=b,v=R)}return{point:[d,m],index:g,t:Math.max(0,Math.min(1,v))}}lineSlice(e,s,u){let d=this.pointOnLine(u,e),m=this.pointOnLine(u,s);if(d.index>m.index||d.index===m.index&&d.t>m.t){let w=d;d=m,m=w}let g=[d.point],v=d.index+1,b=m.index;!tm(u[v],g[0])&&v<=b&&g.push(u[v]);for(let w=v+1;w<=b;w++)g.push(u[w]);return tm(u[b],m.point)||g.push(m.point),g}lineSliceAlong(e,s,u){let d=0,m=[];for(let g=0;g<u.length-1;g++){let v=u[g],b=u[g+1],w=this.distance(v,b);if(d+=w,d>e&&m.length===0&&m.push(xf(v,b,(e-(d-w))/w)),d>=s)return m.push(xf(v,b,(s-(d-w))/w)),m;d>e&&m.push(b)}return m}bufferPoint(e,s){let u=s/this.ky,d=s/this.kx;return[e[0]-d,e[1]-u,e[0]+d,e[1]+u]}bufferBBox(e,s){let u=s/this.ky,d=s/this.kx;return[e[0]-d,e[1]-u,e[2]+d,e[3]+u]}insideBBox(e,s){return ga(e[0]-s[0])>=0&&ga(e[0]-s[2])<=0&&e[1]>=s[1]&&e[1]<=s[3]}}function tm(a,e){return a[0]===e[0]&&a[1]===e[1]}function xf(a,e,s){let u=ga(e[0]-a[0]);return[a[0]+u*s,a[1]+(e[1]-a[1])*s]}function ga(a){for(;a<-180;)a+=360;for(;a>180;)a-=360;return a}class bf{constructor(e=[],s=(u,d)=>u<d?-1:u>d?1:0){if(this.data=e,this.length=this.data.length,this.compare=s,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;let e=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),e}peek(){return this.data[0]}_up(e){let{data:s,compare:u}=this,d=s[e];for(;e>0;){let m=e-1>>1,g=s[m];if(u(d,g)>=0)break;s[e]=g,e=m}s[e]=d}_down(e){let{data:s,compare:u}=this,d=this.length>>1,m=s[e];for(;e<d;){let g=1+(e<<1),v=g+1;if(v<this.length&&u(s[v],s[g])<0&&(g=v),u(s[g],m)>=0)break;s[e]=s[g],e=g}s[e]=m}}var yt=8192;function nm(a,e){return e.dist-a.dist}let Qu=100,ed=50;function Ya(a){let e=[1/0,1/0,-1/0,-1/0];if(e.length!==a.length)return!1;for(let s=0;s<e.length;s++)if(e[s]!==a[s])return!1;return!0}function td(a){return a[1]-a[0]+1}function El(a,e){let s=a[1]>=a[0]&&a[1]<e;return s||console.warn("Distance Expression: Index is out of range"),s}function Qc(a,e){if(a[0]>a[1])return[null,null];let s=td(a);if(e){if(s===2)return[a,null];let u=Math.floor(s/2);return[[a[0],a[0]+u],[a[0]+u,a[1]]]}{if(s===1)return[a,null];let u=Math.floor(s/2)-1;return[[a[0],a[0]+u],[a[0]+u+1,a[1]]]}}function Ra(a,e){let s=[1/0,1/0,-1/0,-1/0];if(!El(e,a.length))return s;for(let u=e[0];u<=e[1];++u)ch(s,a[u]);return s}function Un(a){let e=[1/0,1/0,-1/0,-1/0];for(let s=0;s<a.length;++s)for(let u=0;u<a[s].length;++u)ch(e,a[s][u]);return e}function nd(a,e,s){if(Ya(a)||Ya(e))return NaN;let u=0,d=0;return a[2]<e[0]&&(u=e[0]-a[2]),a[0]>e[2]&&(u=a[0]-e[2]),a[1]>e[3]&&(d=a[1]-e[3]),a[3]<e[1]&&(d=e[1]-a[3]),s.distance([0,0],[u,d])}function Lg(a){return 360*a-180}function Dv(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function wf(a,e){let s=Math.pow(2,e.z),u=(a.y/yt+e.y)/s;return[Lg((a.x/yt+e.x)/s),Dv(u)]}function Iv(a,e){let s=[];for(let u=0;u<a.length;++u)s.push(wf(a[u],e));return s}function Pi(a,e,s){let u=s.pointOnLine(e,a).point;return s.distance(a,u)}function hh(a,e,s,u,d){let m=s.slice(u[0],u[1]+1),g=1/0;for(let v=e[0];v<=e[1];++v)if((g=Math.min(g,Pi(a[v],m,d)))===0)return 0;return g}function fo(a,e,s,u,d){let m=Math.min(d.pointToSegmentDistance(a,s,u),d.pointToSegmentDistance(e,s,u)),g=Math.min(d.pointToSegmentDistance(s,a,e),d.pointToSegmentDistance(u,a,e));return Math.min(m,g)}function Mv(a,e,s,u,d){if(!El(e,a.length)||!El(u,s.length))return NaN;let m=1/0;for(let g=e[0];g<e[1];++g)for(let v=u[0];v<u[1];++v){if(_f(a[g],a[g+1],s[v],s[v+1]))return 0;m=Math.min(m,fo(a[g],a[g+1],s[v],s[v+1],d))}return m}function Av(a,e,s,u,d){if(!El(e,a.length)||!El(u,s.length))return NaN;let m=1/0;for(let g=e[0];g<=e[1];++g)for(let v=u[0];v<=u[1];++v)if((m=Math.min(m,d.distance(a[g],s[v])))===0)return m;return m}function Pv(a,e,s){if(Oa(a,e,!0))return 0;let u=1/0;for(let d of e){let m=d.length;if(m<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(d[0]!==d[m-1]&&(u=Math.min(u,s.pointToSegmentDistance(a,d[m-1],d[0])))===0||(u=Math.min(u,Pi(a,d,s)))===0)return u}return u}function Ov(a,e,s,u){if(!El(e,a.length))return NaN;for(let m=e[0];m<=e[1];++m)if(Oa(a[m],s,!0))return 0;let d=1/0;for(let m=e[0];m<e[1];++m)for(let g of s)for(let v=0,b=g.length,w=b-1;v<b;w=v++){if(_f(a[m],a[m+1],g[w],g[v]))return 0;d=Math.min(d,fo(a[m],a[m+1],g[w],g[v],u))}return d}function Ng(a,e){for(let s of a)for(let u=0;u<=s.length-1;++u)if(Oa(s[u],e,!0))return!0;return!1}function Rv(a,e,s,u=1/0){let d=Un(a),m=Un(e);if(u!==1/0&&nd(d,m,s)>=u)return u;if(vc(d,m)){if(Ng(a,e))return 0}else if(Ng(e,a))return 0;let g=u;for(let v of a)for(let b=0,w=v.length,S=w-1;b<w;S=b++)for(let D of e)for(let I=0,R=D.length,k=R-1;I<R;k=I++){if(_f(v[S],v[b],D[k],D[I]))return 0;g=Math.min(g,fo(v[S],v[b],D[k],D[I],s))}return g}function Cf(a,e,s,u,d,m,g){if(m===null||g===null)return;let v=nd(Ra(u,m),Ra(d,g),s);v<e&&a.push({dist:v,range1:m,range2:g})}function kv(a,e,s,u,d=1/0){let m=Math.min(u.distance(a[0],s[0][0]),d);if(m===0)return m;let g=new bf([{dist:0,range1:[0,a.length-1],range2:[0,0]}],nm),v=e?ed:Qu,b=Un(s);for(;g.length;){let w=g.pop();if(w.dist>=m)continue;let S=w.range1;if(td(S)<=v){if(!El(S,a.length))return NaN;if(e){let D=Ov(a,S,s,u);if((m=Math.min(m,D))===0)return m}else for(let D=S[0];D<=S[1];++D){let I=Pv(a[D],s,u);if((m=Math.min(m,I))===0)return m}}else{let D=Qc(S,e);if(D[0]!==null){let I=nd(Ra(a,D[0]),b,u);I<m&&g.push({dist:I,range1:D[0],range2:[0,0]})}if(D[1]!==null){let I=nd(Ra(a,D[1]),b,u);I<m&&g.push({dist:I,range1:D[1],range2:[0,0]})}}}return m}function fh(a,e,s,u,d,m=1/0){let g=Math.min(m,d.distance(a[0],s[0]));if(g===0)return g;let v=new bf([{dist:0,range1:[0,a.length-1],range2:[0,s.length-1]}],nm),b=e?ed:Qu,w=u?ed:Qu;for(;v.length;){let S=v.pop();if(S.dist>=g)continue;let D=S.range1,I=S.range2;if(td(D)<=b&&td(I)<=w){if(!El(D,a.length)||!El(I,s.length))return NaN;if(e&&u?g=Math.min(g,Mv(a,D,s,I,d)):e||u?e&&!u?g=Math.min(g,hh(s,I,a,D,d)):!e&&u&&(g=Math.min(g,hh(a,D,s,I,d))):g=Math.min(g,Av(a,D,s,I,d)),g===0)return g}else{let R=Qc(D,e),k=Qc(I,u);Cf(v,g,d,a,s,R[0],k[0]),Cf(v,g,d,a,s,R[0],k[1]),Cf(v,g,d,a,s,R[1],k[0]),Cf(v,g,d,a,s,R[1],k[1])}}return g}function N(a,e,s,u,d=1/0){let m=d,g=Ra(a,[0,a.length-1]);for(let v of s)if(!(m!==1/0&&nd(g,Ra(v,[0,v.length-1]),u)>=m)&&(m=Math.min(m,fh(a,e,v,!0,u,m)),m===0))return m;return m}function j(a,e,s,u,d=1/0){let m=d,g=Ra(a,[0,a.length-1]);for(let v of s){if(m!==1/0&&nd(g,Un(v),u)>=m)continue;let b=kv(a,e,v,u,m);if(isNaN(b))return b;if((m=Math.min(m,b))===0)return m}return m}function oe(a){return a==="Point"||a==="MultiPoint"||a==="LineString"||a==="MultiLineString"||a==="Polygon"||a==="MultiPolygon"}class Me{constructor(e,s){this.type=Kt,this.geojson=e,this.geometries=s}static parse(e,s){if(e.length!==2)return s.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Yc(e[1])){let u=e[1];if(u.type==="FeatureCollection"){for(let d=0;d<u.features.length;++d)if(oe(u.features[d].geometry.type))return new Me(u,u.features[d].geometry)}else if(u.type==="Feature"){if(oe(u.geometry.type))return new Me(u,u.geometry)}else if(oe(u.type))return new Me(u,u)}return s.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){let s=e.geometry(),u=e.canonicalID();if(s!=null&&u!=null){if(e.geometryType()==="Point")return(function(d,m,g){let v=[];for(let w of d)for(let S of w)v.push(wf(S,m));let b=new Ju(v[0][1],"meters");return g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString"?fh(v,!1,g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",b):g.type==="MultiLineString"?N(v,!1,g.coordinates,b):g.type==="Polygon"||g.type==="MultiPolygon"?j(v,!1,g.type==="Polygon"?[g.coordinates]:g.coordinates,b):null})(s,u,this.geometries);if(e.geometryType()==="LineString")return(function(d,m,g){let v=[];for(let w of d){let S=[];for(let D of w)S.push(wf(D,m));v.push(S)}let b=new Ju(v[0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return N(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",v,b);if(g.type==="MultiLineString"){let w=1/0;for(let S=0;S<g.coordinates.length;S++){let D=N(g.coordinates[S],!0,v,b,w);if(isNaN(D))return D;if((w=Math.min(w,D))===0)return w}return w}if(g.type==="Polygon"||g.type==="MultiPolygon"){let w=1/0;for(let S=0;S<v.length;S++){let D=j(v[S],!0,g.type==="Polygon"?[g.coordinates]:g.coordinates,b,w);if(isNaN(D))return D;if((w=Math.min(w,D))===0)return w}return w}return null})(s,u,this.geometries);if(e.geometryType()==="Polygon")return(function(d,m,g){let v=[];for(let w of(function(S,D){let I=S.length;if(I<=1)return[S];let R=[],k,B;for(let U=0;U<I;U++){let G=Tv(S[U]);G!==0&&(S[U].area=Math.abs(G),B===void 0&&(B=G<0),B===G<0?(k&&R.push(k),k=[S[U]]):k.push(S[U]))}return k&&R.push(k),R})(d)){let S=[];for(let D=0;D<w.length;++D)S.push(Iv(w[D],m));v.push(S)}let b=new Ju(v[0][0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return j(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",v,b);if(g.type==="MultiLineString"){let w=1/0;for(let S=0;S<g.coordinates.length;S++){let D=j(g.coordinates[S],!0,v,b,w);if(isNaN(D))return D;if((w=Math.min(w,D))===0)return w}return w}return g.type==="Polygon"||g.type==="MultiPolygon"?(function(w,S,D){let I=1/0;for(let R of w)for(let k of S){let B=Rv(R,k,D,I);if(isNaN(B))return B;if((I=Math.min(I,B))===0)return I}return I})(g.type==="Polygon"?[g.coordinates]:g.coordinates,v,b):null})(s,u,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Ct(a){if(a instanceof as&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof Ku||a instanceof Me)return!1;if(a instanceof xc)return a.featureConstant;let e=!0;return a.eachChild(s=>{e&&!Ct(s)&&(e=!1)}),e}function _n(a){if(a instanceof as&&a.name==="feature-state")return!1;let e=!0;return a.eachChild(s=>{e&&!_n(s)&&(e=!1)}),e}function Hi(a,e){if(a instanceof as&&e.indexOf(a.name)>=0)return!1;let s=!0;return a.eachChild(u=>{s&&!Hi(u,e)&&(s=!1)}),s}function Tr(a,e,s){return[a,e,s].filter(Boolean).join("")}function no(a,e){switch(a){case"string":return wl(e);case"number":return+e;case"boolean":return!!e;case"color":return Qn.parse(e);case"formatted":return xo.fromString(wl(e));case"resolvedImage":return xs.build(wl(e))}return e}function eu(a,e,s,u){return u!==void 0&&(a=u*Math.round(a/u)),e!==void 0&&a<e&&(a=e),s!==void 0&&a>s&&(a=s),a}class xc{constructor(e,s,u,d=!1){this.type=e,this.key=s,this.scope=u,this.featureConstant=d}static parse(e,s){let u=s.expectedType;if(u==null&&(u=wi),e.length<2||e.length>3)return s.error("Invalid number of arguments for 'config' expression.");let d=s.parse(e[1],1);if(!(d instanceof Gl))return s.error("Key name of 'config' expression must be a string literal.");let m,g=!0,v=wl(d.value);if(e.length>=3){let b=s.parse(e[2],2);if(!(b instanceof Gl))return s.error("Scope of 'config' expression must be a string literal.");m=wl(b.value)}if(s.options){let b=Tr(v,m,s._scope),w=s.options.get(b);w&&(g=Ct(w.value||w.default))}return new xc(u,v,m,g)}evaluate(e){let s=Tr(this.key,this.scope,e.scope),u=e.getConfig(s);if(!u)return null;let{type:d,value:m,values:g,minValue:v,maxValue:b,stepValue:w}=u,S=u.default.evaluate(e),D=S;if(m){let I=e.scope;e.scope=(I||"").split("").slice(1).join(""),D=m.evaluate(e),e.scope=I}return d&&(D=no(d,D)),D===void 0||v===void 0&&b===void 0&&w===void 0||(typeof D=="number"?D=eu(D,v,b,w):Array.isArray(D)&&(D=D.map(I=>typeof I=="number"?eu(I,v,b,w):I))),m!==void 0&&D!==void 0&&g&&!g.includes(D)&&(D=S,d&&(D=no(d,D))),(d&&d!==this.type||D!==void 0&&!sh($r(D),this.type))&&(D=no(this.type.kind,D)),D}eachChild(){}outputDefined(){return!1}serialize(){let e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class zg{constructor(e,s){this.type=s.type,this.name=e,this.boundExpression=s}static parse(e,s){if(e.length!==2||typeof e[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");let u=e[1];return s.scope.has(u)?new zg(u,s.scope.get(u)):s.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Bg{constructor(e,s=[],u,d=new Pa,m=[],g,v,b){this.registry=e,this.path=s,this.key=s.map(w=>typeof w=="string"?`['${w}']`:`[${w}]`).join(""),this.scope=d,this.errors=m,this.expectedType=u,this._scope=g,this.options=v,this.iconImageUseTheme=b}parse(e,s,u,d,m={}){return s||u?this.concat(s,null,u,d)._parse(e,m):this._parse(e,m)}parseObjectValue(e,s,u,d,m,g={}){return this.concat(s,u,d,m)._parse(e,g)}_parse(e,s){function u(d,m,g){return g==="assert"?new Vt(m,[d]):g==="coerce"?new Cl(m,[d]):d}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let d=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(d){let m=d.parse(e,this);if(!m)return null;if(this.expectedType){let g=this.expectedType,v=m.type;if(g.kind!=="string"&&g.kind!=="number"&&g.kind!=="boolean"&&g.kind!=="object"&&g.kind!=="array"||v.kind!=="value")if(g.kind!=="color"&&g.kind!=="formatted"&&g.kind!=="resolvedImage"||v.kind!=="value"&&v.kind!=="string"){if(this.checkSubtype(g,v))return null}else m=u(m,g,s.typeAnnotation||"coerce");else m=u(m,g,s.typeAnnotation||"assert")}if(!(m instanceof Gl)&&m.type.kind!=="resolvedImage"&&Fv(m)){let g=new bo(this._scope,this.options,this.iconImageUseTheme);try{m=new Gl(m.type,m.evaluate(g))}catch(v){return this.error(v.message),null}}return m}return Cl.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,s,u,d){let m=typeof e=="number"?this.path.concat(e):this.path;m=typeof s=="string"?m.concat(s):m;let g=d?this.scope.concat(d):this.scope;return new Bg(this.registry,m,u||null,g,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(e,...s){let u=`${this.key}${s.map(d=>`[${d}]`).join("")}`;this.errors.push(new Aa(u,e))}checkSubtype(e,s){let u=gc(e,s);return u&&this.error(u),u}}function Fv(a){if(a instanceof zg)return Fv(a.boundExpression);if(a instanceof as&&a.name==="error"||a instanceof Yu||a instanceof Ku||a instanceof Me||a instanceof xc)return!1;let e=a instanceof Cl||a instanceof Vt,s=!0;return a.eachChild(u=>{s=e?s&&Fv(u):s&&u instanceof Gl}),!!s&&Ct(a)&&Hi(a,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function jg(a,e){let s=a.length-1,u,d,m=0,g=s,v=0;for(;m<=g;)if(v=Math.floor((m+g)/2),u=a[v],d=a[v+1],u<=e){if(v===s||e<d)return v;m=v+1}else{if(!(u>e))throw new Lr("Input is not a number.");g=v-1}return 0}class im{constructor(e,s,u){this.type=e,this.input=s,this.labels=[],this.outputs=[];for(let[d,m]of u)this.labels.push(d),this.outputs.push(m)}static parse(e,s){if(e.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return s.error("Expected an even number of arguments.");let u=s.parse(e[1],1,Kt);if(!u)return null;let d=[],m=null;s.expectedType&&s.expectedType.kind!=="value"&&(m=s.expectedType);for(let g=1;g<e.length;g+=2){let v=g===1?-1/0:e[g],b=e[g+1],w=g,S=g+1;if(typeof v!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(d.length&&d[d.length-1][0]>=v)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',w);let D=s.parse(b,S,m);if(!D)return null;m=m||D.type,d.push([v,D])}return new im(m,u,d)}evaluate(e){let s=this.labels,u=this.outputs;if(s.length===1)return u[0].evaluate(e);let d=this.input.evaluate(e);if(d<=s[0])return u[0].evaluate(e);let m=s.length;return d>=s[m-1]?u[m-1].evaluate(e):u[jg(s,d)].evaluate(e)}eachChild(e){e(this.input);for(let s of this.outputs)e(s)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e=["step",this.input.serialize()];for(let s=0;s<this.labels.length;s++)s>0&&e.push(this.labels[s]),e.push(this.outputs[s].serialize());return e}}let P1=.95047,O1=1.08883,R1=4/29,Ef=6/29,Vg=3*Ef*Ef,OD=Ef*Ef*Ef,k1=Math.PI/180,RD=180/Math.PI;function Lv(a){return a>OD?Math.pow(a,1/3):a/Vg+R1}function Nv(a){return a>Ef?a*a*a:Vg*(a-R1)}function Ug(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function Hg(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function ph(a){let e=Hg(a.r),s=Hg(a.g),u=Hg(a.b),d=Lv((.4124564*e+.3575761*s+.1804375*u)/P1),m=Lv((.2126729*e+.7151522*s+.072175*u)/1);return{l:116*m-16,a:500*(d-m),b:200*(m-Lv((.0193339*e+.119192*s+.9503041*u)/O1)),alpha:a.a}}function zv(a){let e=(a.l+16)/116,s=isNaN(a.a)?e:e+a.a/500,u=isNaN(a.b)?e:e-a.b/200;return e=1*Nv(e),s=P1*Nv(s),u=O1*Nv(u),new Qn(Ug(3.2404542*s-1.5371385*e-.4985314*u),Ug(-.969266*s+1.8760108*e+.041556*u),Ug(.0556434*s-.2040259*e+1.0572252*u),a.alpha)}function F1(a,e,s){let u=e-a;return a+s*(u>180||u<-180?u-360*Math.round(u/360):u)}let rm={forward:ph,reverse:zv,interpolate:function(a,e,s){return{l:ln(a.l,e.l,s),a:ln(a.a,e.a,s),b:ln(a.b,e.b,s),alpha:ln(a.alpha,e.alpha,s)}}},mh={forward:function(a){let{l:e,a:s,b:u}=ph(a),d=Math.atan2(u,s)*RD;return{h:d<0?d+360:d,c:Math.sqrt(s*s+u*u),l:e,alpha:a.a}},reverse:function(a){let e=a.h*k1,s=a.c;return zv({l:a.l,a:Math.cos(e)*s,b:Math.sin(e)*s,alpha:a.alpha})},interpolate:function(a,e,s){return{h:F1(a.h,e.h,s),c:ln(a.c,e.c,s),l:ln(a.l,e.l,s),alpha:ln(a.alpha,e.alpha,s)}}};var $g=Object.freeze({__proto__:null,hcl:mh,lab:rm});class Ka{constructor(e,s,u,d,m){this.type=e,this.operator=s,this.interpolation=u,this.input=d,this.labels=[],this.outputs=[];for(let[g,v]of m)this.labels.push(g),this.outputs.push(v)}static interpolationFactor(e,s,u,d){let m=0;if(e.name==="exponential")m=Bv(s,e.base,u,d);else if(e.name==="linear")m=Bv(s,1,u,d);else if(e.name==="cubic-bezier"){let g=e.controlPoints;m=new mc(g[0],g[1],g[2],g[3]).solve(Bv(s,1,u,d))}return m}static parse(e,s){let[u,d,m,...g]=e;if(!Array.isArray(d)||d.length===0)return s.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){let w=d[1];if(typeof w!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:w}}else{if(d[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(d[0])}`,1,0);{let w=d.slice(1);if(w.length!==4||w.some(S=>typeof S!="number"||S<0||S>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:w}}}if(e.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(m=s.parse(m,2,Kt),!m)return null;let v=[],b=null;u==="interpolate-hcl"||u==="interpolate-lab"?b=Ys:s.expectedType&&s.expectedType.kind!=="value"&&(b=s.expectedType);for(let w=0;w<g.length;w+=2){let S=g[w],D=g[w+1],I=w+3,R=w+4;if(typeof S!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(v.length&&v[v.length-1][0]>=S)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',I);let k=s.parse(D,R,b);if(!k)return null;b=b||k.type,v.push([S,k])}return b.kind==="number"||b.kind==="color"||b.kind==="array"&&b.itemType.kind==="number"&&typeof b.N=="number"?new Ka(b,u,d,m,v):s.error(`Type ${to(b)} is not interpolatable.`)}evaluate(e){let s=this.labels,u=this.outputs;if(s.length===1)return u[0].evaluate(e);let d=this.input.evaluate(e);if(d<=s[0])return u[0].evaluate(e);let m=s.length;if(d>=s[m-1])return u[m-1].evaluate(e);let g=jg(s,d),v=Ka.interpolationFactor(this.interpolation,d,s[g],s[g+1]),b=u[g].evaluate(e),w=u[g+1].evaluate(e);return this.operator==="interpolate"?$l[this.type.kind.toLowerCase()](b,w,v):this.operator==="interpolate-hcl"?mh.reverse(mh.interpolate(mh.forward(b),mh.forward(w),v)):rm.reverse(rm.interpolate(rm.forward(b),rm.forward(w),v))}eachChild(e){e(this.input);for(let s of this.outputs)e(s)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];let s=[this.operator,e,this.input.serialize()];for(let u=0;u<this.labels.length;u++)s.push(this.labels[u],this.outputs[u].serialize());return s}}function Bv(a,e,s,u){let d=u-s,m=a-s;return d===0?0:e===1?m/d:(Math.pow(e,m)-1)/(Math.pow(e,d)-1)}class om{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expectected at least one argument.");let u=null,d=s.expectedType;d&&d.kind!=="value"&&(u=d);let m=[];for(let v of e.slice(1)){let b=s.parse(v,1+m.length,u,void 0,{typeAnnotation:"omit"});if(!b)return null;u=u||b.type,m.push(b)}let g=d&&m.some(v=>gc(d,v.type));return new om(g?wi:u,m)}evaluate(e){let s,u=null,d=0;for(let m of this.args){if(d++,u=m.evaluate(e),u&&u instanceof xs&&!u.available&&(s||(s=u),u=null,d===this.args.length))return s;if(u!==null)break}return u}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=["coalesce"];return this.eachChild(s=>{e.push(s.serialize())}),e}}class sm{constructor(e,s){this.type=s.type,this.bindings=[].concat(e),this.result=s}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(let s of this.bindings)e(s[1]);e(this.result)}static parse(e,s){if(e.length<4)return s.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);let u=[];for(let m=1;m<e.length-1;m+=2){let g=e[m];if(typeof g!="string")return s.error(`Expected string, but found ${typeof g} instead.`,m);if(/[^a-zA-Z0-9_]/.test(g))return s.error("Variable names must contain only alphanumeric characters or '_'.",m);let v=s.parse(e[m+1],m+1);if(!v)return null;u.push([g,v])}let d=s.parse(e[e.length-1],e.length-1,s.expectedType,u);return d?new sm(u,d):null}outputDefined(){return this.result.outputDefined()}serialize(){let e=["let"];for(let[s,u]of this.bindings)e.push(s,u.serialize());return e.push(this.result.serialize()),e}}class jv{constructor(e,s,u){this.type=e,this.index=s,this.input=u}static parse(e,s){if(e.length!==3)return s.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let u=s.parse(e[1],1,Kt),d=s.parse(e[2],2,Io(s.expectedType||wi));return u&&d?new jv(d.type.itemType,u,d):null}evaluate(e){let s=this.index.evaluate(e),u=this.input.evaluate(e);if(s<0)throw new Lr("Array index out of bounds: negative index");if(s>=u.length)throw new Lr("Array index out of bounds: index exceeds array size");if(s!==Math.floor(s))throw new Lr("Array index must be an integer. Use at-interpolated for fractional indices");return u[s]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Vv{constructor(e,s,u){this.type=e,this.index=s,this.input=u}static parse(e,s){if(e.length!==3)return s.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let u=s.parse(e[1],1,Kt),d=s.parse(e[2],2,Io(s.expectedType||wi));return u&&d?new Vv(d.type.itemType,u,d):null}evaluate(e){let s=this.index.evaluate(e),u=this.input.evaluate(e);if(s<0)throw new Lr(`Array index out of bounds: ${s} < 0.`);if(s>u.length-1)throw new Lr(`Array index out of bounds: ${s} > ${u.length-1}.`);if(s===Math.floor(s))return u[s];let d=Math.floor(s),m=Math.ceil(s),g=u[d],v=u[m];if(typeof g!="number"||typeof v!="number")throw new Lr(`Cannot interpolate between non-number values at index ${s}.`);let b=s-d;return g*(1-b)+v*b}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Uv{constructor(e,s){this.type=li,this.needle=e,this.haystack=s}static parse(e,s){if(e.length!==3)return s.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let u=s.parse(e[1],1,wi),d=s.parse(e[2],2,wi);return u&&d?Zp(u.type,[li,Yn,Kt,Hu,wi])?new Uv(u,d):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${to(u.type)} instead`):null}evaluate(e){let s=this.needle.evaluate(e),u=this.haystack.evaluate(e);if(u==null)return!1;if(!qu(s,["boolean","string","number","null"]))throw new Lr(`Expected first argument to be of type boolean, string, number or null, but found ${to($r(s))} instead.`);if(!qu(u,["string","array"]))throw new Lr(`Expected second argument to be of type array or string, but found ${to($r(u))} instead.`);return u.indexOf(s)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class am{constructor(e,s,u){this.type=Kt,this.needle=e,this.haystack=s,this.fromIndex=u}static parse(e,s){if(e.length<=2||e.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let u=s.parse(e[1],1,wi),d=s.parse(e[2],2,wi);if(!u||!d)return null;if(!Zp(u.type,[li,Yn,Kt,Hu,wi]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${to(u.type)} instead`);if(e.length===4){let m=s.parse(e[3],3,Kt);return m?new am(u,d,m):null}return new am(u,d)}evaluate(e){let s=this.needle.evaluate(e),u=this.haystack.evaluate(e);if(!qu(s,["boolean","string","number","null"]))throw new Lr(`Expected first argument to be of type boolean, string, number or null, but found ${to($r(s))} instead.`);if(!qu(u,["string","array"]))throw new Lr(`Expected second argument to be of type array or string, but found ${to($r(u))} instead.`);if(this.fromIndex){let d=this.fromIndex.evaluate(e);return u.indexOf(s,d)}return u.indexOf(s)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Gg{constructor(e,s,u,d,m,g){this.inputType=e,this.type=s,this.input=u,this.cases=d,this.outputs=m,this.otherwise=g}static parse(e,s){if(e.length<5)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return s.error("Expected an even number of arguments.");let u,d;s.expectedType&&s.expectedType.kind!=="value"&&(d=s.expectedType);let m={},g=[];for(let w=2;w<e.length-1;w+=2){let S=e[w],D=e[w+1];Array.isArray(S)||(S=[S]);let I=s.concat(w);if(S.length===0)return I.error("Expected at least one branch label.");for(let k of S){if(typeof k!="number"&&typeof k!="string")return I.error("Branch labels must be numbers or strings.");if(typeof k=="number"&&Math.abs(k)>Number.MAX_SAFE_INTEGER)return I.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof k=="number"&&Math.floor(k)!==k)return I.error("Numeric branch labels must be integer values.");if(u){if(I.checkSubtype(u,$r(k)))return null}else u=$r(k);if(m[String(k)]!==void 0)return I.error("Branch labels must be unique.");m[String(k)]=g.length}let R=s.parse(D,w,d);if(!R)return null;d=d||R.type,g.push(R)}let v=s.parse(e[1],1,wi);if(!v)return null;let b=s.parse(e[e.length-1],e.length-1,d);return b?v.type.kind!=="value"&&s.concat(1).checkSubtype(u,v.type)?null:new Gg(u,d,v,m,g,b):null}evaluate(e){let s=this.input.evaluate(e);return(sh($r(s),this.inputType)&&this.outputs[this.cases[s]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["match",this.input.serialize()],s=Object.keys(this.cases).sort(),u=[],d={};for(let g of s){let v=d[this.cases[g]];v===void 0?(d[this.cases[g]]=u.length,u.push([this.cases[g],[g]])):u[v][1].push(g)}let m=g=>this.inputType.kind==="number"?Number(g):g;for(let[g,v]of u)e.push(v.length===1?m(v[0]):v.map(m)),e.push(this.outputs[g].serialize());return e.push(this.otherwise.serialize()),e}}class Tf{constructor(e,s,u){this.type=e,this.branches=s,this.otherwise=u}static parse(e,s){if(e.length<4)return s.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return s.error("Expected an odd number of arguments.");let u;s.expectedType&&s.expectedType.kind!=="value"&&(u=s.expectedType);let d=[];for(let g=1;g<e.length-1;g+=2){let v=s.parse(e[g],g,li);if(!v)return null;let b=s.parse(e[g+1],g+1,u);if(!b)return null;d.push([v,b]),u=u||b.type}let m=s.parse(e[e.length-1],e.length-1,u);return m?new Tf(u,d,m):null}evaluate(e){for(let[s,u]of this.branches)if(s.evaluate(e))return u.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(let[s,u]of this.branches)e(s),e(u);e(this.otherwise)}outputDefined(){return this.branches.every(([e,s])=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["case"];return this.eachChild(s=>{e.push(s.serialize())}),e}}class qg{constructor(e,s,u,d){this.type=e,this.input=s,this.beginIndex=u,this.endIndex=d}static parse(e,s){if(e.length<=2||e.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let u=s.parse(e[1],1,wi),d=s.parse(e[2],2,Kt);if(!u||!d)return null;if(!Zp(u.type,[Io(wi),Yn,wi]))return s.error(`Expected first argument to be of type array or string, but found ${to(u.type)} instead`);if(e.length===4){let m=s.parse(e[3],3,Kt);return m?new qg(u.type,u,d,m):null}return new qg(u.type,u,d)}evaluate(e){let s=this.input.evaluate(e),u=this.beginIndex.evaluate(e);if(!qu(s,["string","array"]))throw new Lr(`Expected first argument to be of type array or string, but found ${to($r(s))} instead.`);if(this.endIndex){let d=this.endIndex.evaluate(e);return s.slice(u,d)}return s.slice(u)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class Wg{constructor(e,s){this.type=Io(Yn),this.str=e,this.delimiter=s}static parse(e,s){if(e.length!==3)return s.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let u=s.parse(e[1],1,Yn),d=s.parse(e[2],2,Yn);return u&&d?new Wg(u,d):void 0}evaluate(e){let s=this.str.evaluate(e),u=this.delimiter.evaluate(e);return s.split(u)}eachChild(e){e(this.str),e(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function L1(a,e){return a==="=="||a==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function N1(a,e,s,u){return u.compare(e,s)===0}function Sf(a,e,s){let u=a!=="=="&&a!=="!=";return class F6{constructor(m,g,v){this.type=li,this.lhs=m,this.rhs=g,this.collator=v,this.hasUntypedArgument=m.type.kind==="value"||g.type.kind==="value"}static parse(m,g){if(m.length!==3&&m.length!==4)return g.error("Expected two or three arguments.");let v=m[0],b=g.parse(m[1],1,wi);if(!b)return null;if(!L1(v,b.type))return g.concat(1).error(`"${v}" comparisons are not supported for type '${to(b.type)}'.`);let w=g.parse(m[2],2,wi);if(!w)return null;if(!L1(v,w.type))return g.concat(2).error(`"${v}" comparisons are not supported for type '${to(w.type)}'.`);if(b.type.kind!==w.type.kind&&b.type.kind!=="value"&&w.type.kind!=="value")return g.error(`Cannot compare types '${to(b.type)}' and '${to(w.type)}'.`);u&&(b.type.kind==="value"&&w.type.kind!=="value"?b=new Vt(w.type,[b]):b.type.kind!=="value"&&w.type.kind==="value"&&(w=new Vt(b.type,[w])));let S=null;if(m.length===4){if(b.type.kind!=="string"&&w.type.kind!=="string"&&b.type.kind!=="value"&&w.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(S=g.parse(m[3],3,Gu),!S)return null}return new F6(b,w,S)}evaluate(m){let g=this.lhs.evaluate(m),v=this.rhs.evaluate(m);if(u&&this.hasUntypedArgument){let b=$r(g),w=$r(v);if(b.kind!==w.kind||b.kind!=="string"&&b.kind!=="number")throw new Lr(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${b.kind}, ${w.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){let b=$r(g),w=$r(v);if(b.kind!=="string"||w.kind!=="string")return e(m,g,v)}return this.collator?s(m,g,v,this.collator.evaluate(m)):e(m,g,v)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}serialize(){let m=[a];return this.eachChild(g=>{m.push(g.serialize())}),m}}}let z1=Sf("==",function(a,e,s){return e===s},N1),B1=Sf("!=",function(a,e,s){return e!==s},function(a,e,s,u){return!N1(0,e,s,u)}),kD=Sf("<",function(a,e,s){return e<s},function(a,e,s,u){return u.compare(e,s)<0}),FD=Sf(">",function(a,e,s){return e>s},function(a,e,s,u){return u.compare(e,s)>0}),LD=Sf("<=",function(a,e,s){return e<=s},function(a,e,s,u){return u.compare(e,s)<=0}),Zg=Sf(">=",function(a,e,s){return e>=s},function(a,e,s,u){return u.compare(e,s)>=0});class Hv{constructor(e,s,u,d,m,g){this.type=Yn,this.number=e,this.locale=s,this.currency=u,this.unit=d,this.minFractionDigits=m,this.maxFractionDigits=g}static parse(e,s){if(e.length!==3)return s.error("Expected two arguments.");let u=s.parse(e[1],1,Kt);if(!u)return null;let d=e[2];if(typeof d!="object"||Array.isArray(d))return s.error("NumberFormat options argument must be an object.");let m=null;if(d.locale&&(m=s.parseObjectValue(d.locale,2,"locale",Yn),!m))return null;let g=null;if(d.currency&&(g=s.parseObjectValue(d.currency,2,"currency",Yn),!g))return null;let v=null;if(d.unit&&(v=s.parseObjectValue(d.unit,2,"unit",Yn),!v))return null;let b=null;if(d["min-fraction-digits"]&&(b=s.parseObjectValue(d["min-fraction-digits"],2,"min-fraction-digits",Kt),!b))return null;let w=null;return d["max-fraction-digits"]&&(w=s.parseObjectValue(d["max-fraction-digits"],2,"max-fraction-digits",Kt),!w)?null:new Hv(u,m,g,v,b,w)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class $v{constructor(e){this.type=Kt,this.input=e}static parse(e,s){if(e.length!==2)return s.error(`Expected 1 argument, but found ${e.length-1} instead.`);let u=s.parse(e[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${to(u.type)} instead.`):new $v(u):null}evaluate(e){let s=this.input.evaluate(e);if(typeof s=="string"||Array.isArray(s))return s.length;throw new Lr(`Expected value to be of type string or array, but found ${to($r(s))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){let e=["length"];return this.eachChild(s=>{e.push(s.serialize())}),e}}function j1(a){return function(){a=1831565813+(a|=0)|0;let e=Math.imul(a^a>>>15,1|a);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}let Df={"==":z1,"!=":B1,">":FD,"<":kD,">=":Zg,"<=":LD,array:Vt,at:jv,"at-interpolated":Vv,boolean:Vt,case:Tf,coalesce:om,collator:Yu,format:_c,image:mn,in:Uv,"index-of":am,interpolate:Ka,"interpolate-hcl":Ka,"interpolate-lab":Ka,length:$v,let:sm,literal:Gl,match:Gg,number:Vt,"number-format":Hv,object:Vt,slice:qg,step:im,string:Vt,"to-boolean":Cl,"to-color":Cl,"to-number":Cl,"to-string":Cl,var:zg,within:Ku,distance:Me,config:xc,split:Wg};function Gv(a,[e,s,u,d]){e=e.evaluate(a),s=s.evaluate(a),u=u.evaluate(a);let m=d?d.evaluate(a):1,g=ah(e,s,u,m);if(g)throw new Lr(g);return new Qn(e/255,s/255,u/255,m)}function V1(a,[e,s,u,d]){e=e.evaluate(a),s=s.evaluate(a),u=u.evaluate(a);let m=d?d.evaluate(a):1,g=(function(w,S,D,I){return typeof w=="number"&&w>=0&&w<=360?typeof S=="number"&&S>=0&&S<=100&&typeof D=="number"&&D>=0&&D<=100?I===void 0||typeof I=="number"&&I>=0&&I<=1?null:`Invalid hsla value [${[w,S,D,I].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof I=="number"?[w,S,D,I]:[w,S,D]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof I=="number"?[w,S,D,I]:[w,S,D]).join(", ")}]: 'h' must be between 0 and 360.`})(e,s,u,m);if(g)throw new Lr(g);let v=`hsla(${e}, ${s}%, ${u}%, ${m})`,b=Qn.parse(v);if(!b)throw new Lr(`Failed to parse HSLA color: ${v}`);return b}function U1(a,e){return a in e}function Xg(a,e){let s=e[a];return s===void 0?null:s}function tu(a){return{type:a}}function lm(a){if(a instanceof xc)return new Set([a.key]);let e=new Set;return a.eachChild(s=>{e=new Set([...e,...lm(s)])}),e}function Yg(a){if(a instanceof as&&a.name==="is-active-floor")return!0;let e=!1;return a.eachChild(s=>{!e&&Yg(s)&&(e=!0)}),e}function gh(a){return{result:"success",value:a}}function id(a){return{result:"error",value:a}}function qv(a,e){return!!a&&!!a.parameters&&a.parameters.indexOf(e)>-1}function Kg(a){return a["property-type"]==="data-driven"}function Wv(a){return qv(a.expression,"measure-light")}function Zv(a){return qv(a.expression,"zoom")}function Jg(a){return!!a.expression&&a.expression.interpolated}function Qg(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function Xv(a){return a}function e_(a,e){let s=e.type==="color",u=a.stops&&typeof a.stops[0][0]=="object",d=u||!(u||a.property!==void 0),m=a.type||(Jg(e)?"exponential":"interval");if(s&&((a=Object.assign({},a)).stops&&(a.stops=a.stops.map(w=>[w[0],Qn.parse(w[1])])),a.default=Qn.parse(a.default?a.default:e.default)),a.colorSpace&&a.colorSpace!=="rgb"&&!$g[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let g,v,b;if(m==="exponential")g=$1;else if(m==="interval")g=H1;else if(m==="categorical"){g=ND,v=Object.create(null);for(let w of a.stops)v[w[0]]=w[1];b=typeof a.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);g=zD}if(u){let w={},S=[];for(let R=0;R<a.stops.length;R++){let k=a.stops[R],B=k[0].zoom;w[B]===void 0&&(w[B]={zoom:B,type:a.type,property:a.property,default:a.default,stops:[]},S.push(B)),w[B].stops.push([k[0].value,k[1]])}let D=[];for(let R of S)D.push([w[R].zoom,e_(w[R],e)]);let I={name:"linear"};return{kind:"composite",interpolationType:I,interpolationFactor:Ka.interpolationFactor.bind(void 0,I),zoomStops:D.map(R=>R[0]),evaluate:({zoom:R},k)=>$1({stops:D,base:a.base},e,R).evaluate(R,k)}}if(d){let w=m==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:w,interpolationFactor:Ka.interpolationFactor.bind(void 0,w),zoomStops:a.stops.map(S=>S[0]),evaluate:({zoom:S})=>g(a,e,S,v,b)}}return{kind:"source",evaluate(w,S){let D=S&&S.properties?S.properties[a.property]:void 0;return D===void 0?If(a.default,e.default):g(a,e,D,v,b)}}}function If(a,e,s){return a!==void 0?a:e!==void 0?e:s!==void 0?s:void 0}function ND(a,e,s,u,d){return If(typeof s===d?u[s]:void 0,a.default,e.default)}function H1(a,e,s){if(!Xu(s))return If(a.default,e.default);let u=a.stops.length;if(u===1||s<=a.stops[0][0])return a.stops[0][1];if(s>=a.stops[u-1][0])return a.stops[u-1][1];let d=jg(a.stops.map(m=>m[0]),s);return a.stops[d][1]}function $1(a,e,s){let u=a.base!==void 0?a.base:1;if(!Xu(s))return If(a.default,e.default);let d=a.stops.length;if(d===1||s<=a.stops[0][0])return a.stops[0][1];if(s>=a.stops[d-1][0])return a.stops[d-1][1];let m=jg(a.stops.map(S=>S[0]),s),g=(function(S,D,I,R){let k=R-I,B=S-I;return k===0?0:D===1?B/k:(Math.pow(D,B)-1)/(Math.pow(D,k)-1)})(s,u,a.stops[m][0],a.stops[m+1][0]),v=a.stops[m][1],b=a.stops[m+1][1],w=$l[e.type]||Xv;if(a.colorSpace&&a.colorSpace!=="rgb"){let S=$g[a.colorSpace];w=(D,I)=>S.reverse(S.interpolate(S.forward(D),S.forward(I),g))}return typeof v.evaluate=="function"?{evaluate(...S){let D=v.evaluate.apply(void 0,S),I=b.evaluate.apply(void 0,S);if(D!==void 0&&I!==void 0)return w(D,I,g)}}:w(v,b,g)}function zD(a,e,s){return e.type==="color"?s=Qn.parse(s):e.type==="formatted"?s=xo.fromString(s.toString()):e.type==="resolvedImage"?s=xs.build(s.toString()):Zu(s)===e.type||e.type==="enum"&&e.values[s]||(s=void 0),If(s,a.default,e.default)}as.register(Df,{error:[{kind:"error"},[Yn],(a,[e])=>{throw new Lr(e.evaluate(a))}],typeof:[Yn,[wi],(a,[e])=>to($r(e.evaluate(a)))],"to-rgba":[Io(Kt,4),[Ys],(a,[e])=>e.evaluate(a).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Io(Kt,4),[Ys],(a,[e])=>e.evaluate(a).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[Ys,[Kt,Kt,Kt],Gv],rgba:[Ys,[Kt,Kt,Kt,Kt],Gv],hsl:[Ys,[Kt,Kt,Kt],V1],hsla:[Ys,[Kt,Kt,Kt,Kt],V1],has:{type:li,overloads:[[[Yn],(a,[e])=>U1(e.evaluate(a),a.properties())],[[Yn,$u],(a,[e,s])=>U1(e.evaluate(a),s.evaluate(a))]]},get:{type:wi,overloads:[[[Yn],(a,[e])=>Xg(e.evaluate(a),a.properties())],[[Yn,$u],(a,[e,s])=>Xg(e.evaluate(a),s.evaluate(a))]]},"feature-state":[wi,[Yn],(a,[e])=>Xg(e.evaluate(a),a.featureState||{})],properties:[$u,[],a=>a.properties()],"geometry-type":[Yn,[],a=>a.geometryType()],worldview:[Yn,[],a=>a.globals.worldview||""],"is-active-floor":[li,tu(Yn),(a,e)=>{if(!(a.globals.activeFloors&&a.globals.activeFloors.size>0))return!1;let s=a.globals.activeFloors;return e.some(u=>{let d=u.evaluate(a);return s.has(d)})}],id:[wi,[],a=>a.id()],zoom:[Kt,[],a=>a.globals.zoom],pitch:[Kt,[],a=>a.globals.pitch||0],"distance-from-center":[Kt,[],a=>a.distanceFromCenter()],"measure-light":[Kt,[Yn],(a,[e])=>a.measureLight(e.evaluate(a))],"heatmap-density":[Kt,[],a=>a.globals.heatmapDensity||0],"line-progress":[Kt,[],a=>a.globals.lineProgress||0],"raster-value":[Kt,[],a=>a.globals.rasterValue||0],"raster-particle-speed":[Kt,[],a=>a.globals.rasterParticleSpeed||0],"sky-radial-progress":[Kt,[],a=>a.globals.skyRadialProgress||0],accumulated:[wi,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[Kt,tu(Kt),(a,e)=>{let s=0;for(let u of e)s+=u.evaluate(a);return s}],"*":[Kt,tu(Kt),(a,e)=>{let s=1;for(let u of e)s*=u.evaluate(a);return s}],"-":{type:Kt,overloads:[[[Kt,Kt],(a,[e,s])=>e.evaluate(a)-s.evaluate(a)],[[Kt],(a,[e])=>-e.evaluate(a)]]},"/":[Kt,[Kt,Kt],(a,[e,s])=>e.evaluate(a)/s.evaluate(a)],"%":[Kt,[Kt,Kt],(a,[e,s])=>e.evaluate(a)%s.evaluate(a)],ln2:[Kt,[],()=>Math.LN2],pi:[Kt,[],()=>Math.PI],e:[Kt,[],()=>Math.E],"^":[Kt,[Kt,Kt],(a,[e,s])=>Math.pow(e.evaluate(a),s.evaluate(a))],sqrt:[Kt,[Kt],(a,[e])=>Math.sqrt(e.evaluate(a))],log10:[Kt,[Kt],(a,[e])=>Math.log(e.evaluate(a))/Math.LN10],ln:[Kt,[Kt],(a,[e])=>Math.log(e.evaluate(a))],log2:[Kt,[Kt],(a,[e])=>Math.log2(e.evaluate(a))],sin:[Kt,[Kt],(a,[e])=>Math.sin(e.evaluate(a))],cos:[Kt,[Kt],(a,[e])=>Math.cos(e.evaluate(a))],tan:[Kt,[Kt],(a,[e])=>Math.tan(e.evaluate(a))],asin:[Kt,[Kt],(a,[e])=>Math.asin(e.evaluate(a))],acos:[Kt,[Kt],(a,[e])=>Math.acos(e.evaluate(a))],atan:[Kt,[Kt],(a,[e])=>Math.atan(e.evaluate(a))],min:[Kt,tu(Kt),(a,e)=>Math.min(...e.map(s=>s.evaluate(a)))],max:[Kt,tu(Kt),(a,e)=>Math.max(...e.map(s=>s.evaluate(a)))],abs:[Kt,[Kt],(a,[e])=>Math.abs(e.evaluate(a))],round:[Kt,[Kt],(a,[e])=>{let s=e.evaluate(a);return s<0?-Math.round(-s):Math.round(s)}],floor:[Kt,[Kt],(a,[e])=>Math.floor(e.evaluate(a))],ceil:[Kt,[Kt],(a,[e])=>Math.ceil(e.evaluate(a))],"filter-==":[li,[Yn,wi],(a,[e,s])=>a.properties()[e.value]===s.value],"filter-id-==":[li,[wi],(a,[e])=>a.id()===e.value],"filter-type-==":[li,[Yn],(a,[e])=>a.geometryType()===e.value],"filter-<":[li,[Yn,wi],(a,[e,s])=>{let u=a.properties()[e.value],d=s.value;return typeof u==typeof d&&u<d}],"filter-id-<":[li,[wi],(a,[e])=>{let s=a.id(),u=e.value;return typeof s==typeof u&&s<u}],"filter->":[li,[Yn,wi],(a,[e,s])=>{let u=a.properties()[e.value],d=s.value;return typeof u==typeof d&&u>d}],"filter-id->":[li,[wi],(a,[e])=>{let s=a.id(),u=e.value;return typeof s==typeof u&&s>u}],"filter-<=":[li,[Yn,wi],(a,[e,s])=>{let u=a.properties()[e.value],d=s.value;return typeof u==typeof d&&u<=d}],"filter-id-<=":[li,[wi],(a,[e])=>{let s=a.id(),u=e.value;return typeof s==typeof u&&s<=u}],"filter->=":[li,[Yn,wi],(a,[e,s])=>{let u=a.properties()[e.value],d=s.value;return typeof u==typeof d&&u>=d}],"filter-id->=":[li,[wi],(a,[e])=>{let s=a.id(),u=e.value;return typeof s==typeof u&&s>=u}],"filter-has":[li,[wi],(a,[e])=>e.value in a.properties()],"filter-has-id":[li,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[li,[Io(Yn)],(a,[e])=>e.value.indexOf(a.geometryType())>=0],"filter-id-in":[li,[Io(wi)],(a,[e])=>e.value.indexOf(a.id())>=0],"filter-in-small":[li,[Yn,Io(wi)],(a,[e,s])=>s.value.indexOf(a.properties()[e.value])>=0],"filter-in-large":[li,[Yn,Io(wi)],(a,[e,s])=>(function(u,d,m,g){for(;m<=g;){let v=m+g>>1;if(d[v]===u)return!0;d[v]>u?g=v-1:m=v+1}return!1})(a.properties()[e.value],s.value,0,s.value.length-1)],all:{type:li,overloads:[[[li,li],(a,[e,s])=>e.evaluate(a)&&s.evaluate(a)],[tu(li),(a,e)=>{for(let s of e)if(!s.evaluate(a))return!1;return!0}]]},any:{type:li,overloads:[[[li,li],(a,[e,s])=>e.evaluate(a)||s.evaluate(a)],[tu(li),(a,e)=>{for(let s of e)if(s.evaluate(a))return!0;return!1}]]},"!":[li,[li],(a,[e])=>!e.evaluate(a)],"is-supported-script":[li,[Yn],(a,[e])=>{let s=a.globals&&a.globals.isSupportedScript;return!s||s(e.evaluate(a))}],upcase:[Yn,[Yn],(a,[e])=>e.evaluate(a).toUpperCase()],downcase:[Yn,[Yn],(a,[e])=>e.evaluate(a).toLowerCase()],concat:[Yn,tu(wi),(a,e)=>e.map(s=>wl(s.evaluate(a))).join("")],"resolved-locale":[Yn,[Gu],(a,[e])=>e.evaluate(a).resolvedLocale()],random:[Kt,[Kt,Kt,wi],(a,e)=>{let[s,u,d]=e.map(g=>g.evaluate(a));if(s>u||s===u)return s;let m;if(typeof d=="string")m=(function(g){let v=0;if(g.length===0)return v;for(let b=0;b<g.length;b++)v=(v<<5)-v+g.charCodeAt(b),v|=0;return v})(d);else{if(typeof d!="number")throw new Lr(`Invalid seed input: ${d}`);m=d}return s+j1(m)()*(u-s)}]});class t_{constructor(e,s,u,d,m){this.expression=e,this._warningHistory={},this._scope=u,this._options=d,this._iconImageUseTheme=m,this._evaluator=new bo(u,d,m),this._defaultValue=s?(function(g){return g.type==="color"&&(Qg(g.default)||Array.isArray(g.default))?new Qn(0,0,0,0):g.type==="color"?Qn.parse(g.default)||null:g.default===void 0?null:g.default})(s):null,this._enumValues=s&&s.type==="enum"?s.values:null,this.configDependencies=lm(e),this.isIndoorDependent=Yg(e)}evaluateWithoutErrorHandling(e,s,u,d,m,g,v,b){return this._evaluator.globals=e,this._evaluator.feature=s,this._evaluator.featureState=u,this._evaluator.canonical=d||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(e,s,u,d,m,g,v,b,w){this._evaluator||(this._evaluator=new bo(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=e,this._evaluator.feature=s||null,this._evaluator.featureState=u||null,this._evaluator.canonical=d||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=b||null,this._evaluator.iconImageUseTheme=w||null;try{let S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new Lr(`Expected value to be one of ${Object.keys(this._enumValues).map(D=>JSON.stringify(D)).join(", ")}, but found ${JSON.stringify(S)} instead.`);return S}catch(S){return this._warningHistory[S.message]||(this._warningHistory[S.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${S.message}`)),this._defaultValue}}}function n_(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in Df}function bc(a,e,s,u,d){let m=new Bg(Df,[],e?(function(v){let b={color:Ys,string:Yn,number:Kt,enum:Yn,boolean:li,formatted:Zc,resolvedImage:Xc};return v.type==="array"?Io(b[v.value]||wi,v.length):b[v.type]})(e):void 0,void 0,void 0,s,u,d),g=m.parse(a,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return g?gh(new t_(g,e,s,u,d)):id(m.errors)}class cm{constructor(e,s,u,d){this.kind=e,this._styleExpression=s,this.isLightConstant=u,this.isLineProgressConstant=d,this.isStateDependent=e!=="constant"&&!_n(s.expression),this.configDependencies=lm(s.expression),this.isIndoorDependent=Yg(s.expression)}evaluateWithoutErrorHandling(e,s,u,d,m,g){return this._styleExpression.evaluateWithoutErrorHandling(e,s,u,d,m,g)}evaluate(e,s,u,d,m,g,v){return this._styleExpression.evaluate(e,s,u,d,m,g,void 0,void 0,v)}}class rd{constructor(e,s,u,d,m,g){this.kind=e,this.zoomStops=u,this._styleExpression=s,this.isStateDependent=e!=="camera"&&!_n(s.expression),this.isIndoorDependent=Yg(s.expression),this.isLightConstant=m,this.isLineProgressConstant=g,this.configDependencies=lm(s.expression),this.interpolationType=d}evaluateWithoutErrorHandling(e,s,u,d,m,g){return this._styleExpression.evaluateWithoutErrorHandling(e,s,u,d,m,g)}evaluate(e,s,u,d,m,g){return this._styleExpression.evaluate(e,s,u,d,m,g)}interpolationFactor(e,s,u){return this.interpolationType?Ka.interpolationFactor(this.interpolationType,e,s,u):0}}function Yv(a,e,s,u,d){if((a=bc(a,e,s,u,d)).result==="error")return a;let m=a.value.expression,g=Ct(m);if(!g&&!Kg(e))return id([new Aa("","data expressions not supported")]);let v=Hi(m,["zoom","pitch","distance-from-center"]);if(!v&&!Zv(e))return id([new Aa("","zoom expressions not supported")]);let b=Hi(m,["measure-light"]);if(!b&&!Wv(e))return id([new Aa("","measure-light expression not supported")]);let w=Hi(m,["line-progress"]);if(!w&&!(function(I){return qv(I.expression,"line-progress")})(e))return id([new Aa("","line-progress expression not supported")]);let S=e.expression&&e.expression.relaxZoomRestriction,D=r_(m);return D||v||S?D instanceof Aa?id([D]):D instanceof Ka&&!Jg(e)?id([new Aa("",'"interpolate" expressions cannot be used with this property')]):gh(D?new rd(g&&w?"camera":"composite",a.value,D.labels,D instanceof Ka?D.interpolation:void 0,b,w):new cm(g&&w?"constant":"source",a.value,b,w)):id([new Aa("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class i_{constructor(e,s){this._parameters=e,this._specification=s,Object.assign(this,e_(this._parameters,this._specification))}static deserialize(e){return new i_(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function r_(a){let e=null;if(a instanceof sm)e=r_(a.result);else if(a instanceof om){for(let s of a.args)if(e=r_(s),e)break}else(a instanceof im||a instanceof Ka)&&a.input instanceof as&&a.input.name==="zoom"&&(e=a);return e instanceof Aa||a.eachChild(s=>{let u=r_(s);u instanceof Aa?e=u:e&&u&&e!==u&&(e=new Aa("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var um,o_,G1=(function(){if(o_)return um;o_=1,um=e;var a=3;function e(s,u,d){var m=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var g=new Int32Array(this.arrayBuffer);s=g[0],this.d=(u=g[1])+2*(d=g[2]);for(var v=0;v<this.d*this.d;v++){var b=g[a+v],w=g[a+v+1];m.push(b===w?null:g.subarray(b,w))}var S=g[a+m.length+1];this.keys=g.subarray(g[a+m.length],S),this.bboxes=g.subarray(S),this.insert=this._insertReadonly}else{this.d=u+2*d;for(var D=0;D<this.d*this.d;D++)m.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=s,this.padding=d,this.scale=u/s,this.uid=0;var I=d/u*s;this.min=-I,this.max=s+I}return e.prototype.insert=function(s,u,d,m,g){this._forEachCell(u,d,m,g,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(u),this.bboxes.push(d),this.bboxes.push(m),this.bboxes.push(g)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(s,u,d,m,g,v){this.cells[g].push(v)},e.prototype.query=function(s,u,d,m,g){var v=this.min,b=this.max;if(s<=v&&u<=v&&b<=d&&b<=m&&!g)return Array.prototype.slice.call(this.keys);var w=[];return this._forEachCell(s,u,d,m,this._queryCell,w,{},g),w},e.prototype._queryCell=function(s,u,d,m,g,v,b,w){var S=this.cells[g];if(S!==null)for(var D=this.keys,I=this.bboxes,R=0;R<S.length;R++){var k=S[R];if(b[k]===void 0){var B=4*k;(w?w(I[B+0],I[B+1],I[B+2],I[B+3]):s<=I[B+2]&&u<=I[B+3]&&d>=I[B+0]&&m>=I[B+1])?(b[k]=!0,v.push(D[k])):b[k]=!1}}},e.prototype._forEachCell=function(s,u,d,m,g,v,b,w){for(var S=this._convertToCellCoord(s),D=this._convertToCellCoord(u),I=this._convertToCellCoord(d),R=this._convertToCellCoord(m),k=S;k<=I;k++)for(var B=D;B<=R;B++){var U=this.d*B+k;if((!w||w(this._convertFromCellCoord(k),this._convertFromCellCoord(B),this._convertFromCellCoord(k+1),this._convertFromCellCoord(B+1)))&&g.call(this,s,u,d,m,U,v,b,w))return}},e.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},e.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,u=a+this.cells.length+1+1,d=0,m=0;m<this.cells.length;m++)d+=this.cells[m].length;var g=new Int32Array(u+d+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;for(var v=u,b=0;b<s.length;b++){var w=s[b];g[a+b]=v,g.set(w,v),v+=w.length}return g[a+s.length]=v,g.set(this.keys,v),g[a+s.length+1]=v+=this.keys.length,g.set(this.bboxes,v),v+=this.bboxes.length,g.buffer},um})(),_h=Gd(G1);let Mf={};function Bt(a,e,s={}){Object.defineProperty(a,"_classRegistryKey",{value:e,writable:!1}),Mf[e]={klass:a,omit:s.omit||[]}}Bt(Object,"Object"),_h.serialize=function(a,e){let s=a.toArrayBuffer();return e&&e.add(s),{buffer:s}},_h.deserialize=function(a){return new _h(a.buffer)},Object.defineProperty(_h,"name",{value:"Grid"}),Bt(_h,"Grid"),delete ct.prototype.constructor,typeof DOMMatrix<"u"&&Bt(DOMMatrix,"DOMMatrix"),Bt(Qn,"Color"),Bt(Error,"Error"),Bt(xo,"Formatted"),Bt(Wu,"FormattedSection"),Bt(Gc,"AJAXError"),Bt(xs,"ResolvedImage"),Bt(i_,"StylePropertyFunction"),Bt(t_,"StyleExpression",{omit:["_evaluator"]}),Bt(uo,"ImageId"),Bt(bl,"ImageVariant"),Bt(rd,"ZoomDependentExpression"),Bt(cm,"ZoomConstantExpression"),Bt(as,"CompoundExpression",{omit:["_evaluate"]});for(let a in Df)Mf[Df[a]._classRegistryKey]||Bt(Df[a],`Expression${a}`);function Kv(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function nu(a){return self.ImageBitmap&&a instanceof ImageBitmap}function od(a,e){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(Kv(a)||nu(a))return e&&e.add(a),a;if(ArrayBuffer.isView(a))return e&&e.add(a.buffer),a;if(a instanceof ImageData)return e&&e.add(a.data.buffer),a;if(Array.isArray(a)){let s=[];for(let u of a)s.push(od(u,e));return s}if(a instanceof Map){let s={$name:"Map",entries:[]};for(let[u,d]of a.entries())s.entries.push(od(u),od(d,e));return s}if(a instanceof Set){let s={$name:"Set"},u=0;for(let d of a.values())s[++u]=od(d);return s}if(a instanceof DOMMatrix){let s={$name:"DOMMatrix"},u=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(let d of u)s[d]=a[d];return s}if(typeof a=="bigint")return{$name:"BigInt",value:a.toString()};if(typeof a=="object"){let s=a.constructor,u=s._classRegistryKey;if(!u)throw new Error(`Can't serialize object of unregistered class "${s.name}".`);let d=s.serialize?s.serialize(a,e):{};if(!s.serialize){for(let m in a)a.hasOwnProperty(m)&&(Mf[u].omit.indexOf(m)>=0||(d[m]=od(a[m],e)));a instanceof Error&&(d.message=a.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(d.$name=u),d}throw new Error("can't serialize object of type "+typeof a)}function sd(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||Kv(a)||nu(a)||ArrayBuffer.isView(a)||a instanceof ImageData)return a;if(Array.isArray(a))return a.map(sd);if(typeof a=="object"){let e=a.$name||"Object";if(e==="Map"){let d=a.entries||[],m=new Map;for(let g=0;g<d.length;g+=2)m.set(sd(d[g]),sd(d[g+1]));return m}if(e==="Set"){let d=new Set;for(let m of Object.keys(a))m!=="$name"&&d.add(sd(a[m]));return d}if(e==="DOMMatrix"){let d;return d=a.is2D?[a.a,a.b,a.c,a.d,a.e,a.f]:[a.m11,a.m12,a.m13,a.m14,a.m21,a.m22,a.m23,a.m24,a.m31,a.m32,a.m33,a.m34,a.m41,a.m42,a.m43,a.m44],new DOMMatrix(d)}if(e==="BigInt")return BigInt(a.value);let{klass:s}=Mf[e];if(!s)throw new Error(`Can't deserialize unregistered class "${e}".`);if(s.deserialize)return s.deserialize(a);let u=Object.create(s.prototype);for(let d of Object.keys(a))d!=="$name"&&(u[d]=sd(a[d]));return u}throw new Error("can't deserialize object of type "+typeof a)}let on={"Latin-1 Supplement":a=>a>=128&&a<=255,Arabic:a=>a>=1536&&a<=1791,"Arabic Supplement":a=>a>=1872&&a<=1919,"Arabic Extended-A":a=>a>=2208&&a<=2303,"Hangul Jamo":a=>a>=4352&&a<=4607,"Unified Canadian Aboriginal Syllabics":a=>a>=5120&&a<=5759,Khmer:a=>a>=6016&&a<=6143,"Unified Canadian Aboriginal Syllabics Extended":a=>a>=6320&&a<=6399,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"CJK Radicals Supplement":a=>a>=11904&&a<=12031,"Kangxi Radicals":a=>a>=12032&&a<=12255,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Bopomofo:a=>a>=12544&&a<=12591,"Hangul Compatibility Jamo":a=>a>=12592&&a<=12687,Kanbun:a=>a>=12688&&a<=12703,"Bopomofo Extended":a=>a>=12704&&a<=12735,"CJK Strokes":a=>a>=12736&&a<=12783,"Katakana Phonetic Extensions":a=>a>=12784&&a<=12799,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"CJK Unified Ideographs Extension A":a=>a>=13312&&a<=19903,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Yi Syllables":a=>a>=40960&&a<=42127,"Yi Radicals":a=>a>=42128&&a<=42191,"Hangul Jamo Extended-A":a=>a>=43360&&a<=43391,"Hangul Syllables":a=>a>=44032&&a<=55215,"Hangul Jamo Extended-B":a=>a>=55216&&a<=55295,"Private Use Area":a=>a>=57344&&a<=63743,"CJK Compatibility Ideographs":a=>a>=63744&&a<=64255,"Arabic Presentation Forms-A":a=>a>=64336&&a<=65023,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Arabic Presentation Forms-B":a=>a>=65136&&a<=65279,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519,Osage:a=>a>=66736&&a<=66815,"CJK Unified Ideographs Extension B":a=>a>=131072&&a<=173791};function Jv(a){for(let e of a)if(a_(e.charCodeAt(0)))return!0;return!1}function q1(a){for(let e of a)if(!s_(e.charCodeAt(0)))return!1;return!0}function s_(a){return!(on.Arabic(a)||on["Arabic Supplement"](a)||on["Arabic Extended-A"](a)||on["Arabic Presentation Forms-A"](a)||on["Arabic Presentation Forms-B"](a))}function a_(a){return!(a!==746&&a!==747&&(a<4352||!(on["Bopomofo Extended"](a)||on.Bopomofo(a)||on["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||on["CJK Compatibility Ideographs"](a)||on["CJK Compatibility"](a)||on["CJK Radicals Supplement"](a)||on["CJK Strokes"](a)||!(!on["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||on["CJK Unified Ideographs Extension A"](a)||on["CJK Unified Ideographs"](a)||on["Enclosed CJK Letters and Months"](a)||on["Hangul Compatibility Jamo"](a)||on["Hangul Jamo Extended-A"](a)||on["Hangul Jamo Extended-B"](a)||on["Hangul Jamo"](a)||on["Hangul Syllables"](a)||on.Hiragana(a)||on["Ideographic Description Characters"](a)||on.Kanbun(a)||on["Kangxi Radicals"](a)||on["Katakana Phonetic Extensions"](a)||on.Katakana(a)&&a!==12540||!(!on["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!on["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||on["Unified Canadian Aboriginal Syllabics"](a)||on["Unified Canadian Aboriginal Syllabics Extended"](a)||on["Vertical Forms"](a)||on["Yijing Hexagram Symbols"](a)||on["Yi Syllables"](a)||on["Yi Radicals"](a))))}function Qv(a){return!(a_(a)||(function(e){return!!(on["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||on["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||on["Letterlike Symbols"](e)||on["Number Forms"](e)||on["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||on["Control Pictures"](e)&&e!==9251||on["Optical Character Recognition"](e)||on["Enclosed Alphanumerics"](e)||on["Geometric Shapes"](e)||on["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||on["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||on["CJK Symbols and Punctuation"](e)||on.Katakana(e)||on["Private Use Area"](e)||on["CJK Compatibility Forms"](e)||on["Small Form Variants"](e)||on["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)})(a))}function ey(a){return on.Arabic(a)||on["Arabic Supplement"](a)||on["Arabic Extended-A"](a)||on["Arabic Presentation Forms-A"](a)||on["Arabic Presentation Forms-B"](a)}function W1(a){return a>=1424&&a<=2303||on["Arabic Presentation Forms-A"](a)||on["Arabic Presentation Forms-B"](a)}function BD(a,e){return!(!e&&W1(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||on.Khmer(a))}function jD(a){for(let e of a)if(W1(e.charCodeAt(0)))return!0;return!1}let ka={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"},ty=null,Ks=ka.unavailable,ad=null,Z1=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(Ks=ka.error),ty&&ty(a)};function ny(){iy.fire(new pa("pluginStateChange",{pluginStatus:Ks,pluginURL:ad}))}let iy=new ma,ry=function(){return Ks},oy=function(){if(Ks!==ka.deferred||!ad)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ks=ka.loading,ny(),ad&&Bu({url:ad},a=>{a?Z1(a):(Ks=ka.loaded,ny())})},Fa={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Ks===ka.loaded||Fa.applyArabicShaping!=null,isLoading:()=>Ks===ka.loading,setState(a){Ks=a.pluginStatus,ad=a.pluginURL},isParsing:()=>Ks===ka.parsing,isParsed:()=>Ks===ka.parsed,getPluginURL:()=>ad};class or{constructor(e,s){this.zoom=e,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.transition=s.transition,this.pitch=s.pitch,this.brightness=s.brightness,this.worldview=s.worldview,this.activeFloors=s.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return(function(s,u){for(let d of s)if(!BD(d.charCodeAt(0),u))return!1;return!0})(e,Fa.isLoaded())}}class dm{constructor(e,s,u,d,m){this.property=e,this.value=s,this.expression=(function(g,v,b,w,S){if(Qg(g))return new i_(g,v);if(n_(g)||Array.isArray(g)&&g.length>0){let D=Yv(g,v,b,w,S);if(D.result==="error")throw new Error(D.value.map(I=>`${I.key}: ${I.message}`).join(", "));return D.value}{let D=g;return typeof g=="string"&&v.type==="color"&&(D=Qn.parse(g)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>D}}})(s===void 0?e.specification.default:s,e.specification,u,d,m)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,s,u,d){return this.property.possiblyEvaluate(this,e,s,u,d)}}class Af{constructor(e,s,u,d){this.property=e,this.value=new dm(e,void 0,s,u,d)}transitioned(e,s){return new Y1(this.property,this.value,s,Object.assign({},e.transition,this.transition),e.now)}untransitioned(){return new Y1(this.property,this.value,null,{},0)}}class X1{constructor(e,s,u,d){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=s,this._options=u,this._iconImageUseTheme=d,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return Ht(this._values[e].value.value)}setValue(e,s){this._values.hasOwnProperty(e)||(this._values[e]=new Af(this._values[e].property,this._scope,this._options,this._iconImageUseTheme)),this._values[e].value=new dm(this._values[e].property,s===null?void 0:Ht(s),this._scope,this._options,this._iconImageUseTheme),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].value.isIndoorDependent())}setTransitionOrValue(e,s){s&&(this._options=s);let u=this._properties.properties;if(e)for(let d in e){let m=e[d];if(d.endsWith("-transition")){let g=d.slice(0,-11);u[g]&&this.setTransition(g,m)}else u.hasOwnProperty(d)&&this.setValue(d,m)}}getTransition(e){return Ht(this._values[e].transition)}setTransition(e,s){this._values.hasOwnProperty(e)||(this._values[e]=new Af(this._values[e].property)),this._values[e].transition=Ht(s)||void 0}serialize(){let e={};for(let s of Object.keys(this._values)){let u=this.getValue(s);u!==void 0&&(e[s]=u);let d=this.getTransition(s);d!==void 0&&(e[`${s}-transition`]=d)}return e}transitioned(e,s){let u=new iu(this._properties);for(let d of Object.keys(this._values))u._values[d]=this._values[d].transitioned(e,s._values[d]);return u}untransitioned(){let e=new iu(this._properties);for(let s of Object.keys(this._values))e._values[s]=this._values[s].untransitioned();return e}isIndoorDependent(){return this._isIndoorDependent}}class Y1{constructor(e,s,u,d,m){let g=d.delay||0,v=d.duration||0;m=m||0,this.property=e,this.value=s,this.begin=m+g,this.end=this.begin+v,e.specification.transition&&(d.delay||d.duration)&&(this.prior=u)}possiblyEvaluate(e,s,u){let d=e.now||0,m=this.value.possiblyEvaluate(e,s,u),g=this.prior;if(g){if(d>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(d<this.begin)return g.possiblyEvaluate(e,s,u);{let v=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,s,u),m,Xd(v))}}return m}}class iu{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,s,u){let d=new vh(this._properties);for(let m of Object.keys(this._values))d._values[m]=this._values[m].possiblyEvaluate(e,s,u);return d}hasTransition(){for(let e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class sy{constructor(e,s,u,d){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=s,this._options=u,this._iconImageUseTheme=d,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return Ht(this._values[e].value)}setValue(e,s){this._values[e]=new dm(this._values[e].property,s===null?void 0:Ht(s),this._scope,this._options,this._iconImageUseTheme),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].isIndoorDependent())}serialize(){let e={};for(let s of Object.keys(this._values)){let u=this.getValue(s);u!==void 0&&(e[s]=u)}return e}possiblyEvaluate(e,s,u,d){let m=new vh(this._properties);for(let g of Object.keys(this._values))m._values[g]=this._values[g].possiblyEvaluate(e,s,u,d);return m}isIndoorDependent(){return this._isIndoorDependent}}class Tl{constructor(e,s,u,d){this.property=e,this.value=s,this.parameters=u,this.iconImageUseTheme=d}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,s,u,d){return this.property.evaluate(this.value,this.parameters,e,s,u,d,this.iconImageUseTheme)}}class vh{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class pt{constructor(e){this.specification=e}possiblyEvaluate(e,s){return e.expression.evaluate(s)}interpolate(e,s,u){let d=$l[this.specification.type];return d?d(e,s,u):e}}class Mt{constructor(e,s){this.specification=e,this.overrides=s}possiblyEvaluate(e,s,u,d,m){return e.expression.kind==="constant"||e.expression.kind==="camera"?new Tl(this,{kind:"constant",value:e.expression.evaluate(s,null,{},u,d,void 0,m)},s):new Tl(this,e.expression,s,m)}interpolate(e,s,u){if(e.value.kind!=="constant"||s.value.kind!=="constant")return e;if(e.value.value===void 0||s.value.value===void 0)return new Tl(this,{kind:"constant",value:void 0},e.parameters);let d=$l[this.specification.type];return d?new Tl(this,{kind:"constant",value:d(e.value.value,s.value.value,u)},e.parameters):e}evaluate(e,s,u,d,m,g,v){return e.kind==="constant"?e.value:e.evaluate(s,u,d,m,g,void 0,v)}}class Pf{constructor(e){this.specification=e}possiblyEvaluate(e,s,u,d){return!!e.expression.evaluate(s,null,{},u,d)}interpolate(){return!1}}class Rr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let s=new or(0,{});for(let u in e){let d=e[u];d.specification.overridable&&this.overridableProperties.push(u);let m=this.defaultPropertyValues[u]=new dm(d,void 0),g=this.defaultTransitionablePropertyValues[u]=new Af(d);this.defaultTransitioningPropertyValues[u]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=m.possiblyEvaluate(s)}}}Bt(Mt,"DataDrivenProperty"),Bt(pt,"DataConstantProperty"),Bt(Pf,"ColorRampProperty");var ke=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function ay(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Of(a){if(Array.isArray(a))return a.map(Of);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){let e={};for(let s in a)e[s]=Of(a[s]);return e}return ay(a)}function Rf(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(let e of a.slice(1))if(!Rf(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function l_(a,e="",s=null,u="fill"){if(a==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Rf(a)||(a=Ja(a));let d=a,m=!0;try{m=(function(S){if(!Ff(S))return S;let D=Of(S);return kf(D),D=c_(D),D})(d)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(d,null,2)}
        `)}let g=null,v=null;if(u!=="background"&&u!=="sky"&&u!=="slot"){v=ke[`filter_${u}`];let S=bc(m,v,e,s);if(S.result==="error")throw new Error(S.value.map(D=>`${D.key}: ${D.message}`).join(", "));g=(D,I,R)=>S.value.evaluate(D,I,{},R)}let b=null,w=null;if(m!==d){let S=bc(d,v,e,s);if(S.result==="error")throw new Error(S.value.map(D=>`${D.key}: ${D.message}`).join(", "));b=(D,I,R,k,B)=>S.value.evaluate(D,I,{},R,void 0,void 0,k,B),w=!Ct(S.value.expression)}return{filter:g,dynamicFilter:b||void 0,needGeometry:J1(m),needFeature:!!w}}function c_(a){if(!Array.isArray(a))return a;let e=(function(s){if(VD.has(s[0])){for(let u=1;u<s.length;u++)if(Ff(s[u]))return!0}return s})(a);return e===!0?e:e.map(s=>c_(s))}function kf(a){let e=!1,s=[];if(a[0]==="case"){for(let u=1;u<a.length-1;u+=2)e=e||Ff(a[u]),s.push(a[u+1]);s.push(a[a.length-1])}else if(a[0]==="match"){e=e||Ff(a[1]);for(let u=2;u<a.length-1;u+=2)s.push(a[u+1]);s.push(a[a.length-1])}else if(a[0]==="step"){e=e||Ff(a[1]);for(let u=1;u<a.length-1;u+=2)s.push(a[u+1])}e&&(a.length=0,a.push("any",...s));for(let u=1;u<a.length;u++)kf(a[u])}function Ff(a){if(!Array.isArray(a))return!1;if((e=a[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let s=1;s<a.length;s++)if(Ff(a[s]))return!0;return!1}let VD=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function K1(a,e){return a<e?-1:a>e?1:0}function J1(a){if(!Array.isArray(a))return!1;if(a[0]==="within"||a[0]==="distance")return!0;for(let e=1;e<a.length;e++)if(J1(a[e]))return!0;return!1}function Ja(a){if(!a)return!0;let e=a[0];return a.length<=1?e!=="any":e==="=="?ly(a[1],a[2],"=="):e==="!="?u_(ly(a[1],a[2],"==")):e==="<"||e===">"||e==="<="||e===">="?ly(a[1],a[2],e):e==="any"?(s=a.slice(1),["any"].concat(s.map(Ja))):e==="all"?["all"].concat(a.slice(1).map(Ja)):e==="none"?["all"].concat(a.slice(1).map(Ja).map(u_)):e==="in"?cy(a[1],a.slice(2)):e==="!in"?u_(cy(a[1],a.slice(2))):e==="has"?Q1(a[1]):e!=="!has"||u_(Q1(a[1]));var s}function ly(a,e,s){switch(a){case"$type":return[`filter-type-${s}`,e];case"$id":return[`filter-id-${s}`,e];default:return[`filter-${s}`,a,e]}}function cy(a,e){if(e.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(s=>typeof s!=typeof e[0])?["filter-in-large",a,["literal",e.sort(K1)]]:["filter-in-small",a,["literal",e]]}}function Q1(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function u_(a){return["!",a]}let hm="";function yh(a,e){return e?`${a}${hm}${e}`:a}let ew,tw=()=>ew||(ew=new Rr({"icon-size":new Mt(ke.layout_symbol["icon-size"]),"icon-image":new Mt(ke.layout_symbol["icon-image"]),"icon-rotate":new Mt(ke.layout_symbol["icon-rotate"]),"icon-offset":new Mt(ke.layout_symbol["icon-offset"])}));class UD{constructor(e,s,u,d,m,g){this.cachedIconPrimary=null;let v=bc(e,ke.appearance.condition);if(v.result==="success"&&(this.condition=v.value),this.name=s,u){this.properties=new vh(tw()),this.unevaluatedLayout=new sy(tw(),d,m,g);for(let b in u)this.unevaluatedLayout.setValue(b,u[b])}}hasCachedIconPrimary(){return this.cachedIconPrimary!==null}setCachedIconPrimary(e){this.cachedIconPrimary=e}getCachedIconPrimary(){return this.cachedIconPrimary}isActive(e){return!(this.condition||!e.isHidden||this.name!=="hidden")||this.condition.evaluate(e.globals,e.feature,e.featureState,e.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(e){return this.properties.get(e)}getUnevaluatedProperties(){return this.unevaluatedLayout}recalculate(e,s,u){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(e,void 0,s,u))}serialize(){let e={};return e.condition=this.condition.expression.serialize(),this.name&&(e.name=this.name),this.unevaluatedLayout&&(e.properties=this.unevaluatedLayout.serialize()),e}}let nw="-transition",HD=new Set(["fill","line","background","hillshade","raster"]);class Vs extends ma{constructor(e,s,u,d,m,g){if(super(),this.id=e.id,this.fqid=yh(this.id,u),this.type=e.type,this.scope=u,this.lut=d,this.options=m,this.iconImageUseTheme=g,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;let v=bc(this.filter,ke[`filter_${e.type}`]);v.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...v.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||v.value.isIndoorDependent)}if(e.slot&&(this.slot=e.slot),e.appearances&&this.setAppearances(e.appearances),s.layout&&(this._unevaluatedLayout=new sy(s.layout,this.scope,m,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),s.paint){this._transitionablePaint=new X1(s.paint,this.scope,m);for(let v in e.paint)this.setPaintProperty(v,e.paint[v]);for(let v in e.layout)this.setLayoutProperty(v,e.layout[v]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new vh(s.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&HD.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,s){if(this.type==="custom"&&e==="visibility")return void(this.visibility=s);let u=this._unevaluatedLayout;u._properties.properties[e]&&(u.setValue(e,s),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...u.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||u.isIndoorDependent(),e==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(e){this.appearances=[],e.forEach(s=>{this.appearances.push(new UD(s.condition,s.name,s.properties,this.scope,this.options,this.iconImageUseTheme))})}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(nw)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}isPaintProperty(e){return!!this._transitionablePaint._properties.properties[e]}setPaintProperty(e,s){let u=this._transitionablePaint,d=u._properties.properties;if(e.endsWith(nw)){let D=e.slice(0,-11);return d[D]&&u.setTransition(D,s||void 0),!1}if(!d[e])return!1;let m=u._values[e],g=m.value.isDataDriven(),v=m.value;u.setValue(e,s),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...u.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||u.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(e);let b=u._values[e].value,w=b.isDataDriven(),S=e.endsWith("pattern")||e==="line-dasharray";return w||g||S||this._handleOverridablePaintPropertyUpdate(e,v,b)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,s,u){return null}_handleOverridablePaintPropertyUpdate(e,s,u){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,s){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,s,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,s)}serialize(){let e={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(e.appearances=this.appearances.map(s=>s.serialize())),st(e,(s,u)=>!(s===void 0||u==="layout"&&!Object.keys(s).length||u==="paint"&&!Object.keys(s).length))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(let e in this.paint._values){let s=this.paint.get(e);if(s instanceof Tl&&Kg(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}for(let e of this.appearances)if(!_n(e.condition.expression))return!0;return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=l_(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(e,s,u){return{}}queryRadius(e){}queryIntersectsFeature(e,s,u,d,m,g,v,b,w){}}let $D={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class fm{constructor(e,s){this._structArray=e,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ur{constructor(){this.capacity=-1,this.resize(0)}static serialize(e,s){return e._trim(),s&&s.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){let s=Object.create(this.prototype);return s.arrayBuffer=e.arrayBuffer,s.length=e.length,s.capacity=e.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Bn(a,e=1){let s=0,u=0;return{members:a.map(d=>{let m=$D[d.type].BYTES_PER_ELEMENT,g=s=uy(s,Math.max(e,m)),v=d.components||1;return u=Math.max(u,m),s+=m*v,{name:d.name,type:d.type,components:v,offset:g}}),size:uy(s,Math.max(u,e)),alignment:e}}function uy(a,e){return Math.ceil(a/e)*e}class _a extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s){let u=this.length;return this.resize(u+1),this.emplace(u,e,s)}emplace(e,s,u){let d=2*e;return this.int16[d+0]=s,this.int16[d+1]=u,e}}_a.prototype.bytesPerElement=4,Bt(_a,"StructArrayLayout2i4");class xh extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,u){let d=this.length;return this.resize(d+1),this.emplace(d,e,s,u)}emplace(e,s,u,d){let m=3*e;return this.int16[m+0]=s,this.int16[m+1]=u,this.int16[m+2]=d,e}}xh.prototype.bytesPerElement=6,Bt(xh,"StructArrayLayout3i6");class Lf extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,u,d){let m=this.length;return this.resize(m+1),this.emplace(m,e,s,u,d)}emplace(e,s,u,d,m){let g=4*e;return this.int16[g+0]=s,this.int16[g+1]=u,this.int16[g+2]=d,this.int16[g+3]=m,e}}Lf.prototype.bytesPerElement=8,Bt(Lf,"StructArrayLayout4i8");class ru extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){let s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.float32[1*e+0]=s,e}}ru.prototype.bytesPerElement=4,Bt(ru,"StructArrayLayout1f4");class dy extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,u){let d=this.length;return this.resize(d+1),this.emplace(d,e,s,u)}emplace(e,s,u,d){let m=4*e,g=2*e;return this.int16[m+0]=s,this.int16[m+1]=u,this.float32[g+1]=d,e}}dy.prototype.bytesPerElement=8,Bt(dy,"StructArrayLayout2i1f8");class hy extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,u){let d=this.length;return this.resize(d+1),this.emplace(d,e,s,u)}emplace(e,s,u,d){let m=4*e;return this.int16[m+0]=s,this.int16[m+1]=u,this.int16[m+2]=d,e}}hy.prototype.bytesPerElement=8,Bt(hy,"StructArrayLayout3i8");class d_ extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,u,d,m){let g=this.length;return this.resize(g+1),this.emplace(g,e,s,u,d,m)}emplace(e,s,u,d,m,g){let v=5*e;return this.int16[v+0]=s,this.int16[v+1]=u,this.int16[v+2]=d,this.int16[v+3]=m,this.int16[v+4]=g,e}}d_.prototype.bytesPerElement=10,Bt(d_,"StructArrayLayout5i10");class h_ extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,u,d,m,g,v){let b=this.length;return this.resize(b+1),this.emplace(b,e,s,u,d,m,g,v)}emplace(e,s,u,d,m,g,v,b){let w=6*e,S=12*e,D=3*e;return this.int16[w+0]=s,this.int16[w+1]=u,this.uint8[S+4]=d,this.uint8[S+5]=m,this.uint8[S+6]=g,this.uint8[S+7]=v,this.float32[D+2]=b,e}}h_.prototype.bytesPerElement=12,Bt(h_,"StructArrayLayout2i4ub1f12");class Qa extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,u){let d=this.length;return this.resize(d+1),this.emplace(d,e,s,u)}emplace(e,s,u,d){let m=3*e;return this.float32[m+0]=s,this.float32[m+1]=u,this.float32[m+2]=d,e}}Qa.prototype.bytesPerElement=12,Bt(Qa,"StructArrayLayout3f12");class ld extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,u,d,m){let g=this.length;return this.resize(g+1),this.emplace(g,e,s,u,d,m)}emplace(e,s,u,d,m,g){let v=6*e,b=3*e;return this.uint16[v+0]=s,this.uint16[v+1]=u,this.uint16[v+2]=d,this.uint16[v+3]=m,this.float32[b+2]=g,e}}ld.prototype.bytesPerElement=12,Bt(ld,"StructArrayLayout4ui1f12");class bh extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,u,d){let m=this.length;return this.resize(m+1),this.emplace(m,e,s,u,d)}emplace(e,s,u,d,m){let g=4*e;return this.uint16[g+0]=s,this.uint16[g+1]=u,this.uint16[g+2]=d,this.uint16[g+3]=m,e}}bh.prototype.bytesPerElement=8,Bt(bh,"StructArrayLayout4ui8");class f_ extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,u,d,m,g){let v=this.length;return this.resize(v+1),this.emplace(v,e,s,u,d,m,g)}emplace(e,s,u,d,m,g,v){let b=6*e;return this.int16[b+0]=s,this.int16[b+1]=u,this.int16[b+2]=d,this.int16[b+3]=m,this.int16[b+4]=g,this.int16[b+5]=v,e}}f_.prototype.bytesPerElement=12,Bt(f_,"StructArrayLayout6i12");class p_ extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,u,d,m,g,v,b,w,S,D,I){let R=this.length;return this.resize(R+1),this.emplace(R,e,s,u,d,m,g,v,b,w,S,D,I)}emplace(e,s,u,d,m,g,v,b,w,S,D,I,R){let k=12*e;return this.int16[k+0]=s,this.int16[k+1]=u,this.int16[k+2]=d,this.int16[k+3]=m,this.uint16[k+4]=g,this.uint16[k+5]=v,this.uint16[k+6]=b,this.uint16[k+7]=w,this.int16[k+8]=S,this.int16[k+9]=D,this.int16[k+10]=I,this.int16[k+11]=R,e}}p_.prototype.bytesPerElement=24,Bt(p_,"StructArrayLayout4i4ui4i24");class Nf extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,u,d,m,g){let v=this.length;return this.resize(v+1),this.emplace(v,e,s,u,d,m,g)}emplace(e,s,u,d,m,g,v){let b=10*e,w=5*e;return this.int16[b+0]=s,this.int16[b+1]=u,this.int16[b+2]=d,this.float32[w+2]=m,this.float32[w+3]=g,this.float32[w+4]=v,e}}Nf.prototype.bytesPerElement=20,Bt(Nf,"StructArrayLayout3i3f20");class cd extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,u,d){let m=this.length;return this.resize(m+1),this.emplace(m,e,s,u,d)}emplace(e,s,u,d,m){let g=4*e;return this.float32[g+0]=s,this.float32[g+1]=u,this.float32[g+2]=d,this.float32[g+3]=m,e}}cd.prototype.bytesPerElement=16,Bt(cd,"StructArrayLayout4f16");class fy extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){let s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.uint32[1*e+0]=s,e}}fy.prototype.bytesPerElement=4,Bt(fy,"StructArrayLayout1ul4");class Sl extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s){let u=this.length;return this.resize(u+1),this.emplace(u,e,s)}emplace(e,s,u){let d=2*e;return this.uint16[d+0]=s,this.uint16[d+1]=u,e}}Sl.prototype.bytesPerElement=4,Bt(Sl,"StructArrayLayout2ui4");class py extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,u,d,m,g,v,b,w,S,D,I,R){let k=this.length;return this.resize(k+1),this.emplace(k,e,s,u,d,m,g,v,b,w,S,D,I,R)}emplace(e,s,u,d,m,g,v,b,w,S,D,I,R,k){let B=20*e,U=10*e;return this.int16[B+0]=s,this.int16[B+1]=u,this.int16[B+2]=d,this.int16[B+3]=m,this.int16[B+4]=g,this.float32[U+3]=v,this.float32[U+4]=b,this.float32[U+5]=w,this.float32[U+6]=S,this.int16[B+14]=D,this.uint32[U+8]=I,this.uint16[B+18]=R,this.uint16[B+19]=k,e}}py.prototype.bytesPerElement=40,Bt(py,"StructArrayLayout5i4f1i1ul2ui40");class m_ extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,u,d,m,g,v){let b=this.length;return this.resize(b+1),this.emplace(b,e,s,u,d,m,g,v)}emplace(e,s,u,d,m,g,v,b){let w=8*e;return this.int16[w+0]=s,this.int16[w+1]=u,this.int16[w+2]=d,this.int16[w+4]=m,this.int16[w+5]=g,this.int16[w+6]=v,this.int16[w+7]=b,e}}m_.prototype.bytesPerElement=16,Bt(m_,"StructArrayLayout3i2i2i16");class zf extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,u,d,m){let g=this.length;return this.resize(g+1),this.emplace(g,e,s,u,d,m)}emplace(e,s,u,d,m,g){let v=4*e,b=8*e;return this.float32[v+0]=s,this.float32[v+1]=u,this.float32[v+2]=d,this.int16[b+6]=m,this.int16[b+7]=g,e}}zf.prototype.bytesPerElement=16,Bt(zf,"StructArrayLayout2f1f2i16");class Bf extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,u,d,m,g){let v=this.length;return this.resize(v+1),this.emplace(v,e,s,u,d,m,g)}emplace(e,s,u,d,m,g,v){let b=20*e,w=5*e;return this.uint8[b+0]=s,this.uint8[b+1]=u,this.float32[w+1]=d,this.float32[w+2]=m,this.float32[w+3]=g,this.float32[w+4]=v,e}}Bf.prototype.bytesPerElement=20,Bt(Bf,"StructArrayLayout2ub4f20");class mr extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,u){let d=this.length;return this.resize(d+1),this.emplace(d,e,s,u)}emplace(e,s,u,d){let m=3*e;return this.uint16[m+0]=s,this.uint16[m+1]=u,this.uint16[m+2]=d,e}}mr.prototype.bytesPerElement=6,Bt(mr,"StructArrayLayout3ui6");class jf extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,s,u,d,m,g,v,b,w,S,D,I,R,k,B,U,G,J,ee,se,_e){let fe=this.length;return this.resize(fe+1),this.emplace(fe,e,s,u,d,m,g,v,b,w,S,D,I,R,k,B,U,G,J,ee,se,_e)}emplace(e,s,u,d,m,g,v,b,w,S,D,I,R,k,B,U,G,J,ee,se,_e,fe){let we=30*e,Ee=15*e,Se=60*e;return this.int16[we+0]=s,this.int16[we+1]=u,this.int16[we+2]=d,this.float32[Ee+2]=m,this.float32[Ee+3]=g,this.uint16[we+8]=v,this.uint16[we+9]=b,this.uint32[Ee+5]=w,this.uint32[Ee+6]=S,this.uint32[Ee+7]=D,this.uint16[we+16]=I,this.uint16[we+17]=R,this.uint16[we+18]=k,this.float32[Ee+10]=B,this.float32[Ee+11]=U,this.uint8[Se+48]=G,this.uint8[Se+49]=J,this.uint8[Se+50]=ee,this.uint32[Ee+13]=se,this.int16[we+28]=_e,this.uint8[Se+58]=fe,e}}jf.prototype.bytesPerElement=60,Bt(jf,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class my extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,s,u,d,m,g,v,b,w,S,D,I,R,k,B,U,G,J,ee,se,_e,fe,we,Ee,Se,We,Fe,Ze,Qe,rt,vt,dt,et){let ut=this.length;return this.resize(ut+1),this.emplace(ut,e,s,u,d,m,g,v,b,w,S,D,I,R,k,B,U,G,J,ee,se,_e,fe,we,Ee,Se,We,Fe,Ze,Qe,rt,vt,dt,et)}emplace(e,s,u,d,m,g,v,b,w,S,D,I,R,k,B,U,G,J,ee,se,_e,fe,we,Ee,Se,We,Fe,Ze,Qe,rt,vt,dt,et,ut){let Ge=20*e,$e=40*e,lt=80*e;return this.float32[Ge+0]=s,this.float32[Ge+1]=u,this.int16[$e+4]=d,this.int16[$e+5]=m,this.int16[$e+6]=g,this.int16[$e+7]=v,this.int16[$e+8]=b,this.int16[$e+9]=w,this.int16[$e+10]=S,this.int16[$e+11]=D,this.int16[$e+12]=I,this.uint16[$e+13]=R,this.uint16[$e+14]=k,this.uint16[$e+15]=B,this.uint16[$e+16]=U,this.uint16[$e+17]=G,this.uint16[$e+18]=J,this.uint16[$e+19]=ee,this.uint16[$e+20]=se,this.uint16[$e+21]=_e,this.uint16[$e+22]=fe,this.uint16[$e+23]=we,this.uint16[$e+24]=Ee,this.uint16[$e+25]=Se,this.uint16[$e+26]=We,this.uint16[$e+27]=Fe,this.uint32[Ge+14]=Ze,this.float32[Ge+15]=Qe,this.float32[Ge+16]=rt,this.float32[Ge+17]=vt,this.float32[Ge+18]=dt,this.uint8[lt+76]=et,this.uint16[$e+39]=ut,e}}my.prototype.bytesPerElement=80,Bt(my,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class gy extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,u,d,m,g){let v=this.length;return this.resize(v+1),this.emplace(v,e,s,u,d,m,g)}emplace(e,s,u,d,m,g,v){let b=6*e;return this.float32[b+0]=s,this.float32[b+1]=u,this.float32[b+2]=d,this.float32[b+3]=m,this.float32[b+4]=g,this.float32[b+5]=v,e}}gy.prototype.bytesPerElement=24,Bt(gy,"StructArrayLayout6f24");class wh extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,u,d,m){let g=this.length;return this.resize(g+1),this.emplace(g,e,s,u,d,m)}emplace(e,s,u,d,m,g){let v=5*e;return this.float32[v+0]=s,this.float32[v+1]=u,this.float32[v+2]=d,this.float32[v+3]=m,this.float32[v+4]=g,e}}wh.prototype.bytesPerElement=20,Bt(wh,"StructArrayLayout5f20");class _y extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,u,d,m,g,v){let b=this.length;return this.resize(b+1),this.emplace(b,e,s,u,d,m,g,v)}emplace(e,s,u,d,m,g,v,b){let w=7*e;return this.float32[w+0]=s,this.float32[w+1]=u,this.float32[w+2]=d,this.float32[w+3]=m,this.float32[w+4]=g,this.float32[w+5]=v,this.float32[w+6]=b,e}}_y.prototype.bytesPerElement=28,Bt(_y,"StructArrayLayout7f28");class pm extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,u,d,m,g,v,b,w,S,D){let I=this.length;return this.resize(I+1),this.emplace(I,e,s,u,d,m,g,v,b,w,S,D)}emplace(e,s,u,d,m,g,v,b,w,S,D,I){let R=11*e;return this.float32[R+0]=s,this.float32[R+1]=u,this.float32[R+2]=d,this.float32[R+3]=m,this.float32[R+4]=g,this.float32[R+5]=v,this.float32[R+6]=b,this.float32[R+7]=w,this.float32[R+8]=S,this.float32[R+9]=D,this.float32[R+10]=I,e}}pm.prototype.bytesPerElement=44,Bt(pm,"StructArrayLayout11f44");class vy extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,u,d,m,g,v,b,w){let S=this.length;return this.resize(S+1),this.emplace(S,e,s,u,d,m,g,v,b,w)}emplace(e,s,u,d,m,g,v,b,w,S){let D=9*e;return this.float32[D+0]=s,this.float32[D+1]=u,this.float32[D+2]=d,this.float32[D+3]=m,this.float32[D+4]=g,this.float32[D+5]=v,this.float32[D+6]=b,this.float32[D+7]=w,this.float32[D+8]=S,e}}vy.prototype.bytesPerElement=36,Bt(vy,"StructArrayLayout9f36");class ud extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s){let u=this.length;return this.resize(u+1),this.emplace(u,e,s)}emplace(e,s,u){let d=2*e;return this.float32[d+0]=s,this.float32[d+1]=u,e}}ud.prototype.bytesPerElement=8,Bt(ud,"StructArrayLayout2f8");class yy extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,u,d){let m=this.length;return this.resize(m+1),this.emplace(m,e,s,u,d)}emplace(e,s,u,d,m){let g=6*e;return this.uint32[3*e+0]=s,this.uint16[g+2]=u,this.uint16[g+3]=d,this.uint16[g+4]=m,e}}yy.prototype.bytesPerElement=12,Bt(yy,"StructArrayLayout1ul3ui12");class g_ extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){let s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.uint16[1*e+0]=s,e}}g_.prototype.bytesPerElement=2,Bt(g_,"StructArrayLayout1ui2");class __ extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,u,d,m,g,v,b,w,S,D,I,R,k,B,U){let G=this.length;return this.resize(G+1),this.emplace(G,e,s,u,d,m,g,v,b,w,S,D,I,R,k,B,U)}emplace(e,s,u,d,m,g,v,b,w,S,D,I,R,k,B,U,G){let J=16*e;return this.float32[J+0]=s,this.float32[J+1]=u,this.float32[J+2]=d,this.float32[J+3]=m,this.float32[J+4]=g,this.float32[J+5]=v,this.float32[J+6]=b,this.float32[J+7]=w,this.float32[J+8]=S,this.float32[J+9]=D,this.float32[J+10]=I,this.float32[J+11]=R,this.float32[J+12]=k,this.float32[J+13]=B,this.float32[J+14]=U,this.float32[J+15]=G,e}}__.prototype.bytesPerElement=64,Bt(__,"StructArrayLayout16f64");class Vf extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,u,d,m,g,v){let b=this.length;return this.resize(b+1),this.emplace(b,e,s,u,d,m,g,v)}emplace(e,s,u,d,m,g,v,b){let w=10*e,S=5*e;return this.uint16[w+0]=s,this.uint16[w+1]=u,this.uint16[w+2]=d,this.uint16[w+3]=m,this.float32[S+2]=g,this.float32[S+3]=v,this.float32[S+4]=b,e}}Vf.prototype.bytesPerElement=20,Bt(Vf,"StructArrayLayout4ui3f20");class xy extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){let s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.int16[1*e+0]=s,e}}xy.prototype.bytesPerElement=2,Bt(xy,"StructArrayLayout1i2");class v_ extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){let s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.uint8[1*e+0]=s,e}}v_.prototype.bytesPerElement=1,Bt(v_,"StructArrayLayout1ub1");class by extends fm{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}by.prototype.size=40;class iw extends py{get(e){return new by(this,e)}}Bt(iw,"CollisionBoxArray");class y_ extends fm{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}y_.prototype.size=60;class mm extends jf{get(e){return new y_(this,e)}}Bt(mm,"PlacedSymbolArray");class wy extends fm{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}wy.prototype.size=80;class rw extends my{get(e){return new wy(this,e)}}Bt(rw,"SymbolInstanceArray");class Cy extends ru{getoffsetX(e){return this.float32[1*e+0]}}Bt(Cy,"GlyphOffsetArray");class ow extends _a{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Bt(ow,"SymbolLineVertexArray");class x_ extends fm{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}x_.prototype.size=12;class sw extends yy{get(e){return new x_(this,e)}}Bt(sw,"FeatureIndexArray");class aw extends Sl{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Bt(aw,"FillExtrusionCentroidArray");class lw extends fm{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}lw.prototype.size=6;class cw extends xh{get(e){return new lw(this,e)}}Bt(cw,"FillExtrusionWallArray");let uw=Bn([{name:"a_pos",components:2,type:"Int16"}],4),GD=Bn([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),qD=Bn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class wr{constructor(e=[]){this.segments=e}_prepareSegment(e,s,u,d){let m=this.segments[this.segments.length-1];return e>wr.MAX_VERTEX_ARRAY_LENGTH&&Gt(`Max vertices per segment is ${wr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!m||m.vertexLength+e>wr.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==d)&&(m={vertexOffset:s,primitiveOffset:u,vertexLength:0,primitiveLength:0},d!==void 0&&(m.sortKey=d),this.segments.push(m)),m}prepareSegment(e,s,u,d){return this._prepareSegment(e,s.length,u.length,d)}get(){return this.segments}destroy(){for(let e of this.segments)for(let s in e.vaos)e.vaos[s].destroy()}static simpleSegment(e,s,u,d){return new wr([{vertexOffset:e,primitiveOffset:s,vertexLength:u,primitiveLength:d,vaos:{},sortKey:0}])}}function dw(a,e){return 256*(a=X(Math.floor(a),0,255))+X(Math.floor(e),0,255)}wr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Bt(wr,"SegmentVector");let WD=Bn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),ZD=Bn([{name:"a_pattern_b",components:4,type:"Uint16"}]),XD=Bn([{name:"a_dash",components:4,type:"Uint16"}]);class gm{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,s,u,d){this.ids.push(_m(e)),this.positions.push(s,u,d)}eachPosition(e,s){let u=_m(e),d=0,m=this.ids.length-1;for(;d<m;){let g=d+m>>1;this.ids[g]>=u?m=g:d=g+1}for(;this.ids[d]===u;)s(this.positions[3*d],this.positions[3*d+1],this.positions[3*d+2]),d++}static serialize(e,s){let u=new Float64Array(e.ids),d=new Uint32Array(e.positions);return Ey(u,d,0,u.length-1),s&&(s.add(u.buffer),s.add(d.buffer)),{ids:u,positions:d}}static deserialize(e){let s=new gm,u;s.ids=e.ids,s.positions=e.positions;for(let d of s.ids)d!==u&&s.uniqueIds.push(d),u=d;return s.indexed=!0,s}}function _m(a){let e=+a;return Number.isSafeInteger(e)?e:ju(String(a))}function Ey(a,e,s,u){for(;s<u;){let d=a[s+u>>1],m=s-1,g=u+1;for(;;){do m++;while(a[m]<d);do g--;while(a[g]>d);if(m>=g)break;b_(a,m,g),b_(e,3*m,3*g),b_(e,3*m+1,3*g+1),b_(e,3*m+2,3*g+2)}g-s<u-g?(Ey(a,e,s,g),s=g+1):(Ey(a,e,g+1,u),u=g)}}function b_(a,e,s){let u=a[e];a[e]=a[s],a[s]=u}Bt(gm,"FeaturePositionMap");class Dl{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,s){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,s),this.initialized=!0),!!this.location}set(e,s,u){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class w_ extends Dl{constructor(e){super(e),this.current=0}set(e,s,u){this.fetchUniformLocation(e,s)&&this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}}class io extends Dl{constructor(e){super(e),this.current=0}set(e,s,u){this.fetchUniformLocation(e,s)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class wc extends Dl{constructor(e){super(e),this.current=[0,0]}set(e,s,u){this.fetchUniformLocation(e,s)&&(u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1])))}}class Uf extends Dl{constructor(e){super(e),this.current=[0,0,0]}set(e,s,u){this.fetchUniformLocation(e,s)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2])))}}class vm extends Dl{constructor(e){super(e),this.current=[0,0,0,0]}set(e,s,u){this.fetchUniformLocation(e,s)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class Ty extends Dl{constructor(e){super(e),this.current=Qn.transparent.toPremultipliedRenderColor(null)}set(e,s,u){this.fetchUniformLocation(e,s)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}let hw=new Float32Array(16);class ym extends Dl{constructor(e){super(e),this.current=hw}set(e,s,u){if(this.fetchUniformLocation(e,s)){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let d=1;d<16;d++)if(u[d]!==this.current[d]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}}}let YD=new Float32Array(9),fw=new Float32Array(4);class Sy extends Dl{constructor(e){super(e),this.current=fw}set(e,s,u){if(this.fetchUniformLocation(e,s)){for(let d=0;d<4;d++)if(u[d]!==this.current[d]){this.current=u,this.gl.uniformMatrix2fv(this.location,!1,u);break}}}}function Dy(a){return[dw(255*a.r,255*a.g),dw(255*a.b,255*a.a)]}function C_(a,e,s,u,d,m,g,v){return!!a&&(a.kind==="composite"||a.kind==="source"?a.evaluate(new or(0,{brightness:m,worldview:v}),e,s,d,u,g)==="none":a.value==="none")}class E_{constructor(e,s,u,d){this.value=e,this.uniformNames=s.map(m=>`u_${m}`),this.type=u,this.context=d}setUniform(e,s,u,d,m){let g=d.constantOr(this.value);s.set(e,m,g instanceof Qn?g.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):g)}getBinding(e,s){return this.type==="color"?new Ty(e):new io(e)}}class xm{constructor(e,s){this.uniformNames=s.map(u=>`u_${u}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,s){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=s?s.tl.concat(s.br):this.pattern}setUniform(e,s,u,d,m){let g=null;m!=="u_pattern"&&m!=="u_dash"||(g=this.pattern),m==="u_pattern_b"&&(g=this.patternTransition),m==="u_pixel_ratio"&&(g=this.pixelRatio),g&&s.set(e,m,g)}getBinding(e,s){return s==="u_pattern"||s==="u_pattern_b"||s==="u_dash"?new vm(e):new io(e)}}class ou{constructor(e,s,u,d){this.expression=e,this.type=u,this.maxValue=0,this.paintVertexAttributes=s.map(m=>({name:`a_${m}`,type:"Float32",components:u==="color"?2:1,offset:0})),this.paintVertexArray=new d}populatePaintArray(e,s,u,d,m,g,v,b){let w=this.paintVertexArray.length,S=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new or(0,{brightness:g,worldview:b}),s,{},m,d,v):this.expression.kind==="constant"&&this.expression.value,D=C_(this.lutExpression,s,{},d,m,g,v,b);this.paintVertexArray.resize(e),this._setPaintValue(w,e,S,D?null:this.context.lut)}updatePaintArray(e,s,u,d,m,g,v,b){let w=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:v,worldview:b},u,d,void 0,m):this.expression.kind==="constant"&&this.expression.value,S=C_(this.lutExpression,u,d,m,void 0,v,void 0,b);this._setPaintValue(e,s,w,S?null:this.context.lut)}_setPaintValue(e,s,u,d){if(this.type==="color"){let m=Dy(u.toPremultipliedRenderColor(d));for(let g=e;g<s;g++)this.paintVertexArray.emplace(g,m[0],m[1])}else{for(let m=e;m<s;m++)this.paintVertexArray.emplace(m,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Zl{constructor(e,s,u,d,m,g){this.expression=e,this.uniformNames=s.map(v=>`u_${v}_t`),this.type=u,this.useIntegerZoom=d,this.context=m,this.maxValue=0,this.paintVertexAttributes=s.map(v=>({name:`a_${v}`,type:"Float32",components:u==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(e,s,u,d,m,g,v,b){let w=this.expression.evaluate(new or(this.context.zoom,{brightness:g,worldview:b}),s,{},m,d,v),S=this.expression.evaluate(new or(this.context.zoom+1,{brightness:g,worldview:b}),s,{},m,d,v),D=C_(this.lutExpression,s,{},d,m,g,v,b),I=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(I,e,w,S,D?null:this.context.lut)}updatePaintArray(e,s,u,d,m,g,v,b){let w=this.expression.evaluate({zoom:this.context.zoom,brightness:v,worldview:b},u,d,void 0,m),S=this.expression.evaluate({zoom:this.context.zoom+1,brightness:v,worldview:b},u,d,void 0,m),D=C_(this.lutExpression,u,d,m,void 0,v,void 0,b);this._setPaintValue(e,s,w,S,D?null:this.context.lut)}_setPaintValue(e,s,u,d,m){if(this.type==="color"){let g=Dy(u.toPremultipliedRenderColor(m)),v=Dy(u.toPremultipliedRenderColor(m));for(let b=e;b<s;b++)this.paintVertexArray.emplace(b,g[0],g[1],v[0],v[1])}else{for(let g=e;g<s;g++)this.paintVertexArray.emplace(g,u,d);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(d))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,s,u,d,m){let g=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,v=X(this.expression.interpolationFactor(g,this.context.zoom,this.context.zoom+1),0,1);s.set(e,m,v)}getBinding(e,s){return new io(e)}}class bs{constructor(e,s,u,d,m){this.expression=e,this.layerId=m,this.paintVertexAttributes=(u==="array"?XD:WD).members;for(let g=0;g<s.length;++g);this.paintVertexArray=new d,this.paintTransitionVertexArray=new bh}populatePaintArray(e,s,u,d){let m=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(m,e,s.patterns&&s.patterns[this.layerId],u)}updatePaintArray(e,s,u,d,m,g,v){this._setPaintValues(e,s,u.patterns&&u.patterns[this.layerId],g)}_setPaintValues(e,s,u,d){if(!d||!u)return;let m=d[u[0]],g=d[u[1]];if(m){if(m){let{tl:v,br:b,pixelRatio:w}=m;for(let S=e;S<s;S++)this.paintVertexArray.emplace(S,v[0],v[1],b[0],b[1],w)}if(g){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);let{tl:v,br:b}=g;for(let w=e;w<s;w++)this.paintTransitionVertexArray.emplace(w,v[0],v[1],b[0],b[1])}}}upload(e){let s=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,s)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,ZD.members,s))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class su{constructor(e,s,u=()=>!0){this.binders={},this._buffers=[],this.context=s;let d=[];for(let m in e.paint._values){let g=e.paint.get(m);if(m.endsWith("-use-theme")||!u(m)||!(g instanceof Tl&&Kg(g.property.specification)))continue;let v=JD(m,e.type),b=g.value,w=g.property.specification.type,S=!!g.property.useIntegerZoom,D=m==="line-dasharray"||m.endsWith("pattern"),I=e.paint.get(`${m}-use-theme`),R=m==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||I&&I.value.kind!=="constant";if(b.kind!=="constant"||R)if(b.kind==="source"||R||D){let k=Iy(m,w,"source");this.binders[m]=D?new bs(b,v,w,k,e.id):new ou(b,v,w,k),d.push(`/a_${m}`)}else{let k=Iy(m,w,"composite");this.binders[m]=new Zl(b,v,w,S,s,k),d.push(`/z_${m}`)}else this.binders[m]=D?new xm(b.value,v):new E_(b.value,v,w,s),d.push(`/u_${m}`);I&&(this.binders[m].lutExpression=I.value)}this.cacheKey=d.sort().join("")}getMaxValue(e){let s=this.binders[e];return s instanceof ou||s instanceof Zl?s.maxValue:0}populatePaintArrays(e,s,u,d,m,g,v,b){for(let w in this.binders){let S=this.binders[w];S.context=this.context,(S instanceof ou||S instanceof Zl||S instanceof bs)&&S.populatePaintArray(e,s,u,d,m,g,v,b)}}setConstantPatternPositions(e,s){for(let u in this.binders){let d=this.binders[u];d instanceof xm&&d.setConstantPatternPositions(e,s)}}getPatternTransitionVertexBuffer(e){let s=this.binders[e];return s instanceof bs?s.paintTransitionVertexBuffer:null}updatePaintArrays(e,s,u,d,m,g,v,b,w,S){let D=!1,I=Object.keys(e),R=I.length!==0&&!b,k=R?I:s.uniqueIds;this.context.lut=m.lut;for(let B in this.binders){let U=this.binders[B];if(U.context=this.context,(U instanceof ou||U instanceof Zl||U instanceof bs)&&U.expression&&U.expression.kind&&U.expression.kind!=="constant"&&(U.expression.isStateDependent===!0||U.expression.isLightConstant===!1)){let G=m.paint.get(B);U.expression=G.value;for(let J of k){let ee=e[J.toString()];s.eachPosition(J,(se,_e,fe)=>{let we=d.feature(se);U.updatePaintArray(_e,fe,we,ee,g,v,w,S)})}if(!R)for(let J of u.uniqueIds){let ee=e[J.toString()];u.eachPosition(J,(se,_e,fe)=>{let we=d.feature(se);U.updatePaintArray(_e,fe,we,ee,g,v,w,S)})}D=!0}}return D}defines(){let e=[];for(let s in this.binders){let u=this.binders[s];(u instanceof E_||u instanceof xm)&&e.push(...u.uniformNames.map(d=>`#define HAS_UNIFORM_${d}`))}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){let s=[];for(let u in this.binders){let d=this.binders[u];if(d instanceof E_||d instanceof xm||d instanceof Zl)for(let m of d.uniformNames)s.push({name:m,property:u,binding:d.getBinding(e,m)})}return s}setUniforms(e,s,u,d,m){for(let{name:g,property:v,binding:b}of u)this.binders[v].setUniform(e,b,m,d.get(v),g)}updatePaintBuffers(){this._buffers=[];for(let e in this.binders){let s=this.binders[e];(s instanceof ou||s instanceof Zl||s instanceof bs)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer),s instanceof bs&&s.paintTransitionVertexBuffer&&this._buffers.push(s.paintTransitionVertexBuffer)}}upload(e){for(let s in this.binders){let u=this.binders[s];(u instanceof ou||u instanceof Zl||u instanceof bs)&&u.upload(e)}this.updatePaintBuffers()}destroy(){for(let e in this.binders){let s=this.binders[e];(s instanceof ou||s instanceof Zl||s instanceof bs)&&s.destroy()}}}class Xl{constructor(e,s,u=()=>!0){this.programConfigurations={};for(let d of e)this.programConfigurations[d.id]=new su(d,s,u);this.needsUpload=!1,this._featureMap=new gm,this._featureMapWithoutIds=new gm,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,s,u,d,m,g,v,b,w){for(let S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(e,s,d,m,g,v,b,w);s.id!==void 0?this._featureMap.add(s.id,u,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,u,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,s,u,d,m,g,v,b){for(let w of u)this.needsUpload=this.programConfigurations[w.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,s,w,d,m,g,v||0,b)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(let s in this.programConfigurations)this.programConfigurations[s].upload(e);this.needsUpload=!1}}destroy(){for(let e in this.programConfigurations)this.programConfigurations[e].destroy()}}let KD={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function JD(a,e){return KD[a]||[a.replace(`${e}-`,"").replace(/-/g,"_")]}let QD={"line-pattern":{source:ld,composite:ld},"fill-pattern":{source:ld,composite:ld},"fill-extrusion-pattern":{source:ld,composite:ld},"line-dasharray":{source:bh,composite:bh}},eI={color:{source:ud,composite:cd},number:{source:ru,composite:ud}};function Iy(a,e,s){let u=QD[a];return u&&u[s]||eI[e][s]}Bt(E_,"ConstantBinder"),Bt(xm,"PatternConstantBinder"),Bt(ou,"SourceExpressionBinder"),Bt(bs,"PatternCompositeBinder"),Bt(Zl,"CompositeExpressionBinder"),Bt(su,"ProgramConfiguration",{omit:["_buffers"]}),Bt(Xl,"ProgramConfigurationSet");let va=yt/Math.PI/2,f=5,r=6,c=16383,p=64,_=[p,32,16],y=-va,x=va;function C(a,e,s,u=va){return s=Wn(s),[a*Math.sin(s)*u,-e*u,a*Math.cos(s)*u]}function T(a,e,s){return C(Math.cos(Wn(a)),Math.sin(Wn(a)),e,s)}let M=63710088e-1,P=2*Math.PI*M;class F{constructor(e,s){if(isNaN(e)||isNaN(s))throw new Error(`Invalid LngLat object: (${e}, ${s})`);if(this.lng=+e,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new F(ye(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){let s=Math.PI/180,u=this.lat*s,d=e.lat*s,m=Math.sin(u)*Math.sin(d)+Math.cos(u)*Math.cos(d)*Math.cos((e.lng-this.lng)*s);return M*Math.acos(Math.min(m,1))}toBounds(e=0){let s=360*e/40075017,u=s/Math.cos(Math.PI/180*this.lat);return new O({lng:this.lng-u,lat:this.lat-s},{lng:this.lng+u,lat:this.lat+s})}toEcef(e){return T(this.lat,this.lng,va+e*va/M)}static convert(e){if(e instanceof F)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new F(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new F(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class O{constructor(e,s){e&&(s?this.setSouthWest(e).setNorthEast(s):Array.isArray(e)&&e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof F?new F(e.lng,e.lat):F.convert(e),this}setSouthWest(e){return this._sw=e instanceof F?new F(e.lng,e.lat):F.convert(e),this}extend(e){let s=this._sw,u=this._ne,d,m;if(e instanceof F)d=e,m=e;else{if(!(e instanceof O))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(O.convert(e)):this.extend(F.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(F.convert(e)):this;if(d=e._sw,m=e._ne,!d||!m)return this}return s||u?(s.lng=Math.min(d.lng,s.lng),s.lat=Math.min(d.lat,s.lat),u.lng=Math.max(m.lng,u.lng),u.lat=Math.max(m.lat,u.lat)):(this._sw=new F(d.lng,d.lat),this._ne=new F(m.lng,m.lat)),this}getCenter(){return new F((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new F(this.getWest(),this.getNorth())}getSouthEast(){return new F(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:s,lat:u}=F.convert(e),d=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&d}static convert(e){if(e)return e instanceof O?e:new O(e)}}let z=0,V=25.5;function H(a){return P*Math.cos(a*Math.PI/180)}function K(a){return(180+a)/360}function Z(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function Q(a,e){return a/H(e)}function ae(a){return 360*a-180}function re(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function ge(a,e){return a*H(re(e))}let ce=85.051129;function ve(a){return Math.cos(Wn(X(a,-ce,ce)))}function me(a,e){let s=X(e,z,V),u=Math.pow(2,s);return ve(a)*P/(512*u)}function he(a){return 1/Math.cos(a*Math.PI/180)}function xe(a,e=0){let s=Math.exp(Math.PI*(1-(a.y+e/yt)/(1<<a.z)*2));return 80150034*s/(s*s+1)/yt/(1<<a.z)}class Re{constructor(e,s,u=0){this.x=+e,this.y=+s,this.z=+u}static fromLngLat(e,s=0){let u=F.convert(e);return new Re(K(u.lng),Z(u.lat),Q(s,u.lat))}toLngLat(){return new F(ae(this.x),re(this.y))}toAltitude(){return ge(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/P*he(re(this.y))}}function Ie(a,e,s,u,d,m,g,v,b){let w=(e+u)/2,S=(s+d)/2,D=new ct(w,S);v(D),(function(I,R,k,B,U,G){let J=k-U,ee=B-G;return Math.abs((B-R)*J-(k-I)*ee)/Math.hypot(J,ee)})(D.x,D.y,m.x,m.y,g.x,g.y)>=b?(Ie(a,e,s,w,S,m,D,v,b),Ie(a,w,S,u,d,D,g,v,b)):a.push(g)}function qe(a,e,s){let u=a[0],d=u.x,m=u.y;e(u);let g=[u];for(let v=1;v<a.length;v++){let b=a[v],{x:w,y:S}=b;e(b),Ie(g,d,m,w,S,u,b,e,s),d=w,m=S,u=b}return g}function je(a,e,s,u){if(u(e,s)){let d=e.add(s)._mult(.5);je(a,e,d,u),je(a,d,s,u)}else a.push(s)}function Ke(a,e){let s=a[0],u=[s];for(let d=1;d<a.length;d++){let m=a[d];je(u,s,m,e),s=m}return u}let _t=Math.pow(2,14)-1,Le=-_t-1;function Te(a,e){let s=Math.round(a.x*e),u=Math.round(a.y*e);return a.x=X(s,Le,_t),a.y=X(u,Le,_t),(s<a.x||s>a.x+1||u<a.y||u>a.y+1)&&Gt("Geometry exceeds allowed extent, reduce your vector tile buffer size"),a}function Je(a,e,s){let u=a.loadGeometry(),d=a.extent,m=yt/d;if(e&&s&&s.projection.isReprojectedInTileSpace){let g=1<<e.z,{scale:v,x:b,y:w,projection:S}=s,D=I=>{let R=ae((e.x+I.x/d)/g),k=re((e.y+I.y/d)/g),B=S.project(R,k);I.x=(B.x*v-b)*d,I.y=(B.y*v-w)*d};for(let I=0;I<u.length;I++)if(a.type!==1)u[I]=qe(u[I],D,1);else{let R=[];for(let k of u[I])k.x<0||k.x>=d||k.y<0||k.y>=d||(D(k),R.push(k));u[I]=R}}for(let g of u)for(let v of g)Te(v,m);return u}function Ue(a,e){return{type:a.type,id:a.id,properties:a.properties,geometry:e?Je(a):[]}}class at{constructor(e,s,u,d,m){this.properties={},this.extent=u,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=d,this._values=m,e.readFields(bt,this,s)}loadGeometry(){let e=this._pbf;e.pos=this._geometry;let s=e.readVarint()+e.pos,u=[],d,m=1,g=0,v=0,b=0;for(;e.pos<s;){if(g<=0){let w=e.readVarint();m=7&w,g=w>>3}if(g--,m===1||m===2)v+=e.readSVarint(),b+=e.readSVarint(),m===1&&(d&&u.push(d),d=[]),d&&d.push(new ct(v,b));else{if(m!==7)throw new Error(`unknown command ${m}`);d&&d.push(d[0].clone())}}return d&&u.push(d),u}bbox(){let e=this._pbf;e.pos=this._geometry;let s=e.readVarint()+e.pos,u=1,d=0,m=0,g=0,v=1/0,b=-1/0,w=1/0,S=-1/0;for(;e.pos<s;){if(d<=0){let D=e.readVarint();u=7&D,d=D>>3}if(d--,u===1||u===2)m+=e.readSVarint(),g+=e.readSVarint(),m<v&&(v=m),m>b&&(b=m),g<w&&(w=g),g>S&&(S=g);else if(u!==7)throw new Error(`unknown command ${u}`)}return[v,w,b,S]}toGeoJSON(e,s,u){let d=this.extent*Math.pow(2,u),m=this.extent*e,g=this.extent*s,v=this.loadGeometry();function b(I){return[360*(I.x+m)/d-180,360/Math.PI*Math.atan(Math.exp((1-2*(I.y+g)/d)*Math.PI))-90]}function w(I){return I.map(b)}let S;if(this.type===1){let I=[];for(let k of v)I.push(k[0]);let R=w(I);S=I.length===1?{type:"Point",coordinates:R[0]}:{type:"MultiPoint",coordinates:R}}else if(this.type===2){let I=v.map(w);S=I.length===1?{type:"LineString",coordinates:I[0]}:{type:"MultiLineString",coordinates:I}}else{if(this.type!==3)throw new Error("unknown feature type");{let I=(function(k){let B=k.length;if(B<=1)return[k];let U=[],G,J;for(let ee=0;ee<B;ee++){let se=jt(k[ee]);se!==0&&(J===void 0&&(J=se<0),J===se<0?(G&&U.push(G),G=[k[ee]]):G&&G.push(k[ee]))}return G&&U.push(G),U})(v),R=[];for(let k of I)R.push(k.map(w));S=R.length===1?{type:"Polygon",coordinates:R[0]}:{type:"MultiPolygon",coordinates:R}}}let D={type:"Feature",geometry:S,properties:this.properties};return this.id!=null&&(D.id=this.id),D}}function bt(a,e,s){a===1?e.id=s.readVarint():a===2?(function(u,d){let m=u.readVarint()+u.pos;for(;u.pos<m;){let g=d._keys[u.readVarint()],v=d._values[u.readVarint()];d.properties[g]=v}})(s,e):a===3?e.type=s.readVarint():a===4&&(e._geometry=s.pos)}function jt(a){let e=0;for(let s,u,d=0,m=a.length,g=m-1;d<m;g=d++)s=a[d],u=a[g],e+=(u.x-s.x)*(s.y+u.y);return e}at.types=["Unknown","Point","LineString","Polygon"];class mt{constructor(e,s){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(xt,this,s),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];let s=this._pbf.readVarint()+this._pbf.pos;return new at(this._pbf,s,this.extent,this._keys,this._values)}}function xt(a,e,s){a===15?e.version=s.readVarint():a===1?e.name=s.readString():a===5?e.extent=s.readVarint():a===2?e._features.push(s.pos):a===3?e._keys.push(s.readString()):a===4&&e._values.push((function(u){let d=null,m=u.readVarint()+u.pos;for(;u.pos<m;){let g=u.readVarint()>>3;d=g===1?u.readString():g===2?u.readFloat():g===3?u.readDouble():g===4?u.readVarint64():g===5?u.readVarint():g===6?u.readSVarint():g===7?u.readBoolean():null}if(d==null)throw new Error("unknown feature value");return d})(s))}class $t{constructor(e,s){this.layers=e.readFields(Ft,{},s)}}function Ft(a,e,s){if(a===3){let u=new mt(s,s.readVarint()+s.pos);u.length&&(e[u.name]=u)}}let At="3d_elevation_id",Lt="level";class sn{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,s){return this._valid&&e(s(this._geometry)),this}require(e,s,u){return this.get(e,!0,s,u)}optional(e,s,u){return this.get(e,!1,s,u)}success(){return this._valid}get(e,s,u,d){let m=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&m!==void 0&&!Number.isNaN(m)?u(d?d(m):m):s&&(this._valid=!1),this}}class jn{constructor(e,s){this.featureFunc=e,this.vertexFunc=s}parseFeature(e,s,u){return this.featureFunc(e,s,u)}parseVertex(e,s,u){return this.vertexFunc(e,s,u)}}let ei=new jn((a,e,s)=>a.reset(e).require(At,u=>{s.id=u}).optional("fixed_height_relative",u=>{s.constantHeight=u},pn.decodeRelativeHeight).geometry(u=>{s.bounds=u},uh).success(),(a,e,s)=>a.reset(e).require(At,u=>{s.id=u}).require("elevation_idx",u=>{s.idx=u}).require("extent",u=>{s.extent=u}).require("height_relative",u=>{s.height=u},pn.decodeRelativeHeight).geometry(u=>{s.position=u},pn.getPoint).success()),Ni=new jn((a,e,s)=>a.reset(e).require(At,u=>{s.id=u}).optional("fixed_height",u=>{s.constantHeight=u},pn.decodeMetricHeight).geometry(u=>{s.bounds=u},uh).success(),(a,e,s)=>a.reset(e).require(At,u=>{s.id=u}).require("elevation_idx",u=>{s.idx=u}).require("extent",u=>{s.extent=u}).require("height",u=>{s.height=u},pn.decodeMetricHeight).geometry(u=>{s.position=u},pn.getPoint).success());class pn{static getPoint(e){return jc(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static getVersionSchema(e){return e?e==="1.0.1"?Ni:void 0:ei}static parse(e){let s=[],u=[],d=e.length,m=new sn;for(let g=0;g<d;g++){let v=e.feature(g),b=v.properties.version,w=pn.getVersionSchema(b);if(w===void 0){Gt(`Unknown elevation feature version number ${b||"(unknown)"}`);continue}let S=v.properties.type;if(!S)continue;let D=at.types[v.type];if(D==="Point"&&S==="curve_point"){let I={};w.parseVertex(m,v,I)&&s.push(I)}else if(D==="Polygon"&&S==="curve_meta"){let I={};w.parseFeature(m,v,I)&&u.push(I)}}return{vertices:s,features:u}}}class Kn{constructor(e,s){this.pos=e,this.dir=s}intersectsPlane(e,s,u){let d=da(s,this.dir);if(Math.abs(d)<1e-6)return!1;let m=((e[0]-this.pos[0])*s[0]+(e[1]-this.pos[1])*s[1])/d;return u[0]=this.pos[0]+this.dir[0]*m,u[1]=this.pos[1]+this.dir[1]*m,!0}}class Mn{constructor(e,s){this.pos=e,this.dir=s}intersectsPlane(e,s,u){let d=Vr(s,this.dir);if(Math.abs(d)<1e-6)return!1;let m=((e[0]-this.pos[0])*s[0]+(e[1]-this.pos[1])*s[1]+(e[2]-this.pos[2])*s[2])/d;return u[0]=this.pos[0]+this.dir[0]*m,u[1]=this.pos[1]+this.dir[1]*m,u[2]=this.pos[2]+this.dir[2]*m,!0}closestPointOnSphere(e,s,u){if((function(R,k){var B=R[0],U=R[1],G=R[2],J=k[0],ee=k[1],se=k[2];return Math.abs(B-J)<=E*Math.max(1,Math.abs(B),Math.abs(J))&&Math.abs(U-ee)<=E*Math.max(1,Math.abs(U),Math.abs(ee))&&Math.abs(G-se)<=E*Math.max(1,Math.abs(G),Math.abs(se))})(this.pos,e)||s===0)return u[0]=u[1]=u[2]=0,!1;let[d,m,g]=this.dir,v=this.pos[0]-e[0],b=this.pos[1]-e[1],w=this.pos[2]-e[2],S=d*d+m*m+g*g,D=2*(v*d+b*m+w*g),I=D*D-4*S*(v*v+b*b+w*w-s*s);if(I<0){let R=Math.max(-D/2,0),k=v+d*R,B=b+m*R,U=w+g*R,G=Math.hypot(k,B,U);return u[0]=k*s/G,u[1]=B*s/G,u[2]=U*s/G,!1}{let R=(-D-Math.sqrt(I))/(2*S);if(R<0){let k=Math.hypot(v,b,w);return u[0]=v*s/k,u[1]=b*s/k,u[2]=w*s/k,!1}return u[0]=v+d*R,u[1]=b+m*R,u[2]=w+g*R,!0}}}class Ii{constructor(e,s,u,d,m){this.TL=e,this.TR=s,this.BR=u,this.BL=d,this.horizon=m}static fromInvProjectionMatrix(e,s,u){let d=[-1,1,1],m=[1,1,1],g=[1,-1,1],v=[-1,-1,1],b=pr(d,d,e),w=pr(m,m,e),S=pr(g,g,e),D=pr(v,v,e);return new Ii(b,w,S,D,s/u)}}function ti(a,e,s){let u=1/0,d=-1/0,m=[];for(let g of a){Ur(m,g,e);let v=Vr(m,s);u=Math.min(u,v),d=Math.max(d,v)}return[u,d]}function Xi(a,e){let s=!0;for(let u=0;u<a.planes.length;u++){let d=a.planes[u],m=0;for(let g=0;g<e.length;g++)m+=+(Vr(d,e[g])+d[3]>=0);if(m===0)return 0;m!==e.length&&(s=!1)}return s?2:1}function ci(a,e){for(let s of a.projections){let u=ti(e,a.points[0],s.axis);if(s.projection[1]<u[0]||s.projection[0]>u[1])return 0}return 1}function An(a,e){let s=0,u=[0,0,0,0];for(let g=0;g<a.length;g++)u[0]=a[g][0],u[1]=a[g][1],u[2]=a[g][2],u[3]=1,(d=u)[0]*(m=e)[0]+d[1]*m[1]+d[2]*m[2]+d[3]*m[3]>=0&&s++;var d,m;return s}class yi{constructor(e,s){this.points=e||new Array(8).fill([0,0,0]),this.planes=s||new Array(6).fill([0,0,0,0]),this.bounds=kn.fromPoints(this.points),this.projections=[],this.frustumEdges=[Ur([],this.points[2],this.points[3]),Ur([],this.points[0],this.points[3]),Ur([],this.points[4],this.points[0]),Ur([],this.points[5],this.points[1]),Ur([],this.points[6],this.points[2]),Ur([],this.points[7],this.points[3])];for(let u of this.frustumEdges){let d=[0,-u[2],u[1]],m=[u[2],0,-u[0]];this.projections.push({axis:d,projection:ti(this.points,this.points[0],d)}),this.projections.push({axis:m,projection:ti(this.points,this.points[0],m)})}}static fromInvProjectionMatrix(e,s,u,d){let m=Math.pow(2,u),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{let S=Hr([],w,e),D=1/S[3]/s*m;return(I=S)[0]=(R=S)[0]*(k=[D,D,d?1/S[3]:D,D])[0],I[1]=R[1]*k[1],I[2]=R[2]*k[2],I[3]=R[3]*k[3],I;var I,R,k}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{let S=Li([],Ro([],Ur([],g[w[0]],g[w[1]]),Ur([],g[w[2]],g[w[1]]))),D=-Vr(S,g[w[1]]);return S.concat(D)}),b=[];for(let w=0;w<g.length;w++)b.push([g[w][0],g[w][1],g[w][2]]);return new yi(b,v)}intersectsPrecise(e,s,u){for(let d=0;d<s.length;d++)if(!An(e,s[d]))return 0;for(let d=0;d<this.planes.length;d++)if(!An(e,this.planes[d]))return 0;for(let d of u)for(let m of this.frustumEdges){let g=Ro([],d,m),v=ai(g);if(v===0)continue;Ui(g,g,1/v);let b=ti(this.points,this.points[0],g),w=ti(e,this.points[0],g);if(b[0]>w[1]||w[0]>b[1])return 0}return 1}containsPoint(e){for(let s of this.planes){let u=s[3];if(Vr([s[0],s[1],s[2]],e)+u<0)return!1}return!0}}class kn{static fromPoints(e){let s=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(let d of e)Fs(s,s,d),eo(u,u,d);return new kn(s,u)}static fromTileIdAndHeight(e,s,u){let d=1<<e.canonical.z,m=e.canonical.x,g=e.canonical.y;return new kn([m/d,g/d,s],[(m+1)/d,(g+1)/d,u])}static applyTransform(e,s){let u=e.getCorners();for(let d=0;d<u.length;++d)pr(u[d],u[d],s);return kn.fromPoints(u)}static applyTransformFast(e,s){let u=[s[12],s[13],s[14]],d=[...u];for(let m=0;m<3;m++)for(let g=0;g<3;g++){let v=s[4*g+m],b=v*e.min[g],w=v*e.max[g];u[m]+=Math.min(b,w),d[m]+=Math.max(b,w)}return new kn(u,d)}static projectAabbCorners(e,s){let u=e.getCorners();for(let d=0;d<u.length;++d)pr(u[d],u[d],s);return u}constructor(e,s){this.min=e,this.max=s,this.center=Ui([],Pr([],this.min,this.max),.5)}quadrant(e){let s=[e%2==0,e<2],u=en(this.min),d=en(this.max);for(let m=0;m<s.length;m++)u[m]=s[m]?this.min[m]:this.center[m],d[m]=s[m]?this.center[m]:this.max[m];return d[2]=this.max[2],new kn(u,d)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){let e=this.min,s=this.max;return[[e[0],e[1],e[2]],[s[0],e[1],e[2]],[s[0],s[1],e[2]],[e[0],s[1],e[2]],[e[0],e[1],s[2]],[s[0],e[1],s[2]],[s[0],s[1],s[2]],[e[0],s[1],s[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Xi(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Xi(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,s){return s||this.intersects(e)?ci(e,this.getCorners()):0}intersectsPreciseFlat(e,s){return s||this.intersectsFlat(e)?ci(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let s=0;s<3;++s)if(this.min[s]>e.max[s]||e.min[s]>this.max[s])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let s=0;s<3;s++)this.min[s]=Math.min(this.min[s],e.min[s]),this.max[s]=Math.max(this.max[s],e.max[s])}encapsulatePoint(e){for(let s=0;s<3;s++)this.min[s]=Math.min(this.min[s],e[s]),this.max[s]=Math.max(this.max[s],e[s])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}Bt(kn,"Aabb");class cr{constructor(e,s){this.feature=e,this.metersToTile=s,this.index=0}get(){let e=this.feature.vertices[this.index],s=this.feature.vertexProps[this.index].dir,u=s[1],d=-s[0],m=(e.extent+1)*this.metersToTile;return[new ct(Math.trunc(e.position[0]+u*m),Math.trunc(e.position[1]+d*m)),new ct(Math.trunc(e.position[0]-u*m),Math.trunc(e.position[1]-d*m))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Ci{constructor(e,s,u,d,m,g){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[Xr(),Xr(),Xr(),Xr(),Xr(),Xr(),Xr()],this.id=e,this.heightRange={min:u,max:u},this.safeArea=s,this.constantHeight=u,this.constantHeight==null&&(this.constantHeight!=null||d.length!==0)){this.vertices=d,this.edges=m,this.edges=this.edges.filter(v=>{return v.a<this.vertices.length&&v.b<this.vertices.length&&!((b=this.vertices[v.a].position)[0]===(w=this.vertices[v.b].position)[0]&&b[1]===w[1]);var b,w}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(let v of this.vertices)this.vertexProps.push({dir:jc(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,v.height),this.heightRange.max=Math.max(this.heightRange.max,v.height);for(let v of this.edges){let b=this.vertices[v.a].position,w=this.vertices[v.b].position,S=Za(Xr(),w,b),D=gr(S),I=Sa(Xr(),S,1/D);this.edgeProps.push({vec:S,dir:I,len:D});let R=this.vertexProps[v.a].dir,k=this.vertexProps[v.b].dir;Wa(R,R,I),Wa(k,k,I)}for(let v of this.vertexProps)v.dir[0]===0&&v.dir[1]===0||Zo(v.dir,v.dir);this.tessellate(g)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;let s=this.getClosestEdge(e);if(s==null)return 0;let[u,d]=s;return ln(this.vertices[this.edges[u].a].height,this.vertices[this.edges[u].b].height,d)}computeSlopeNormal(e,s){let u=this.getClosestEdge(e);if(!u)return Fi(0,0,1);let d=u[0],m=this.edges[d],g=this.edgeProps[d].vec,v=Fi(g[0],g[1],(this.vertices[m.b].height-this.vertices[m.a].height)*s),b=Fi(v[1],-v[0],0);Ro(b,b,v);let w=ai(b);return w>0?Ui(b,b,1/w):Wi(b,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let s=0,u=Number.POSITIVE_INFINITY,d=0,[m,g,v,b,w,S,D]=this._tmpVec2;Vc(D,e.x,e.y);let I=new Kn(D,null);for(let R=0;R<this.edges.length;R++){let k=this.edges[R],B=this.edgeProps[R].dir;I.dir=B;let U=this.vertices[k.a].position,G=this.vertices[k.b].position,J=I.intersectsPlane(U,this.vertexProps[k.a].dir,m),ee=I.intersectsPlane(G,this.vertexProps[k.b].dir,g);if(!J||!ee)continue;Za(v,g,m),Za(b,D,m);let se=da(v,v),_e=se>0?da(b,v)/se:0,fe=X(_e,0,1),we=Math.abs((_e-fe)*this.edgeProps[R].len);Za(w,D,U),Vc(S,B[1],-B[0]);let Ee=we+Math.abs(da(w,S));Ee<u&&(s=R,u=Ee,d=fe)}return[s,d]}tessellate(e){let s=Rt(),u=Rt(),d=Rt(),m=Rt();for(let g=this.edges.length-1;g>=0;--g){let v=this.edges[g].a,b=this.edges[g].b,{position:w,height:S,extent:D}=this.vertices[v],{position:I,height:R,extent:k}=this.vertices[b],B=this.vertexProps[v].dir,U=this.vertexProps[b].dir;if(Wi(s,w[0]/e,w[1]/e,S),Wi(u,I[0]/e,I[1]/e,R),Wi(d,B[1],-B[0],0),Ui(d,d,D),Wi(m,U[1],-U[0],0),Ui(m,m,k),this.distSqLines(Fi(s[0]+.5*d[0],s[1]+.5*d[1],s[2]+.5*d[2]),Fi(u[0]-.5*m[0],u[1]-.5*m[1],u[2]-.5*m[2]),Fi(s[0]-.5*d[0],s[1]-.5*d[1],s[2]-.5*d[2]),Fi(u[0]+.5*m[0],u[1]+.5*m[1],u[2]+.5*m[2]))<=.0025000000000000005)continue;let G=this.vertices.length,J=Wa(Xr(),w,I);this.vertices.push({position:Sa(J,J,.5),height:.5*(S+R),extent:.5*(D+k)});let ee=Wa(Xr(),B,U);this.vertexProps.push({dir:Zo(ee,ee)}),this.edges.splice(g,1),this.edgeProps.splice(g,1),this.edges.push({a:v,b:G}),this.edges.push({a:G,b});let se=Za(Xr(),this.vertices[G].position,w),_e=gr(se),fe={vec:se,dir:Sa(Xr(),se,1/_e),len:_e};this.edgeProps.push(fe),this.edgeProps.push(fe)}}distSqLines(e,s,u,d){let m=Oo(Rt(),s,e),g=Oo(Rt(),d,u),v=Oo(Rt(),e,u),b=Vr(m,m),w=Vr(m,g),S=Vr(m,v),D=Vr(g,g),I=Vr(g,v),R=b*D-w*w;if(R===0)return $a(hc(m,u,d,Vr(v,g)/Vr(g,g)),e);let k=(b*I-w*S)/R;return $a(hc(m,e,s,(w*I-S*D)/R),hc(g,u,d,k))}}class vn{static parseFrom(e,s){let u=pn.parse(e);if(!u)return[];let{vertices:d,features:m}=u,g=1/xe(s);m.sort((S,D)=>S.id-D.id),d.sort((S,D)=>S.id-D.id||S.idx-D.idx),d=d.filter((S,D,I)=>D===I.findIndex(R=>R.id===S.id&&R.idx===S.idx));let v=new Array,b=0,w=d.length;for(let S of m){if(S.constantHeight){v.push(new Ci(S.id,S.bounds,S.constantHeight));continue}for(;b!==w&&d[b].id<S.id;)b++;if(b===w||d[b].id!==S.id)continue;let D=new Array,I=new Array,R=b;for(;b!==w&&d[b].id===S.id;){let k=d[b];if(D.push({position:k.position,height:k.height,extent:k.extent}),b!==R&&d[b-1].idx===k.idx-1){let B=b-R;I.push({a:B-1,b:B})}b++}v.push(new Ci(S.id,S.bounds,void 0,D,I,g))}return v}static getElevationFeature(e,s){if(!s)return;let u=+e.properties[At];return Number.isNaN(u)?void 0:s.find(d=>d.id===u)}}class ii{constructor(e,s){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(s)||(this.zScale=Math.pow(2,s.z-e.z),this.xOffset=(e.x*this.zScale-s.x)*yt,this.yOffset=(e.y*this.zScale-s.y)*yt)}constantElevation(e,s){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,s)}pointElevation(e,s,u){let d=this.constantElevation(s,u);return d??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(s.pointElevation(e),u))}computeBiasedHeight(e,s){return s<=0?e:e+s*de(0,s,e>=0?e:Math.abs(.5*e))}}Bt(Ci,"ElevationFeature");class yr{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new _a,this.indexArray=new mr,this.segments=new wr,this.programConfigurations=new Xl(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new ru),this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,s){}updateAppearances(e,s,u,d){}populate(e,s,u,d){let m=this.layers[0],g=[],v=null;m.type==="circle"&&(v=m.layout.get("circle-sort-key"));for(let{feature:w,id:S,index:D,sourceLayerIndex:I}of e){let R=this.layers[0]._featureFilter.needGeometry,k=Ue(w,R);if(!this.layers[0]._featureFilter.filter(new or(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),k,u))continue;let B=v?v.evaluate(k,{},u):void 0,U={id:S,properties:w.properties,type:w.type,sourceLayerIndex:I,index:D,geometry:R?k.geometry:Je(w,u,d),patterns:{},sortKey:B};g.push(U)}v&&g.sort((w,S)=>w.sortKey-S.sortKey);let b=null;d.projection.name==="globe"&&(this.globeExtVertexArray=new f_,b=d.projection);for(let w of g){let{geometry:S,index:D,sourceLayerIndex:I}=w,R=e[D].feature;this.addFeature(w,S,D,s.availableImages,u,b,s.brightness,s.elevationFeatures),s.featureIndex.insert(R,S,D,I,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,s,u,d,m,g,v){this.programConfigurations.updatePaintArrays(e,s,m,u,d,g,v,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,uw.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,qD.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,GD.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,s,u,d,m,g,v,b){let w;this.elevationMode!=="none"&&(w=vn.getElevationFeature(e,b));for(let S of s)for(let D of S){let I=D.x,R=D.y;if(I<0||I>=yt||R<0||R>=yt)continue;if(g){let U=g.projectTilePoint(I,R,m),G=g.upVector(m,I,R);this.addGlobeExtVertex(U,G),this.addGlobeExtVertex(U,G),this.addGlobeExtVertex(U,G),this.addGlobeExtVertex(U,G)}let k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),B=k.vertexLength;if(this.addCircleVertex(I,R,-1,-1),this.addCircleVertex(I,R,1,-1),this.addCircleVertex(I,R,1,1),this.addCircleVertex(I,R,-1,1),this.elevationMode!=="none"){let U=w?w.pointElevation(new ct(I,R)):0;this.hasElevation=this.hasElevation||U!==0;for(let G=0;G<4;G++)this.elevatedLayoutVertexArray.emplaceBack(U)}this.indexArray.emplaceBack(B,B+1,B+2),this.indexArray.emplaceBack(B,B+2,B+3),k.vertexLength+=4,k.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,u,{},d,m,v,void 0,this.worldview)}addCircleVertex(e,s,u,d){this.layoutVertexArray.emplaceBack(2*e+(u+1)/2,2*s+(d+1)/2)}addGlobeExtVertex(e,s){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,s[0]*16384,s[1]*16384,s[2]*16384)}}function Gr(a,e){for(let s=0;s<a.length;s++)if(jo(e,a[s]))return!0;for(let s=0;s<e.length;s++)if(jo(a,e[s]))return!0;return!!Js(a,e)}function Cr(a,e,s){return!!jo(a,e)||!!cs(e,a,s)}function kr(a,e){if(a.length===1)return Il(e,a[0]);for(let s=0;s<e.length;s++){let u=e[s];for(let d=0;d<u.length;d++)if(jo(a,u[d]))return!0}for(let s=0;s<a.length;s++)if(Il(e,a[s]))return!0;for(let s=0;s<e.length;s++)if(Js(a,e[s]))return!0;return!1}function ya(a,e,s){if(a.length>1){if(Js(a,e))return!0;for(let u=0;u<e.length;u++)if(cs(e[u],a,s))return!0}for(let u=0;u<a.length;u++)if(cs(a[u],e,s))return!0;return!1}function Js(a,e){if(a.length===0||e.length===0)return!1;for(let s=0;s<a.length-1;s++){let u=a[s],d=a[s+1];for(let m=0;m<e.length-1;m++)if(ls(u,d,e[m],e[m+1]))return!0}return!1}function ls(a,e,s,u){return Rn(a,s,u)!==Rn(e,s,u)&&Rn(a,e,s)!==Rn(a,e,u)}function ws(a,e,s){return(a.x-s.x)*(e.y-s.y)-(a.y-s.y)*(e.x-s.x)}function el(a,e,s,u){let d=ws(a,e,u),m=ws(a,e,s);if(Math.sign(d)===Math.sign(m))return;let g=ws(s,u,a),v=g+m-d;return Math.sign(g)!==Math.sign(v)?[g/(g-v),m/(m-d)]:void 0}function cs(a,e,s){let u=s*s;if(e.length===1)return a.distSqr(e[0])<u;for(let d=1;d<e.length;d++)if(tl(a,e[d-1],e[d])<u)return!0;return!1}function tl(a,e,s){let u=e.distSqr(s);if(u===0)return a.distSqr(e);let d=((a.x-e.x)*(s.x-e.x)+(a.y-e.y)*(s.y-e.y))/u;return a.distSqr(d<0?e:d>1?s:s.sub(e)._mult(d)._add(e))}function Il(a,e){let s,u,d,m=!1;for(let g=0;g<a.length;g++){s=a[g];for(let v=0,b=s.length-1;v<s.length;b=v++)u=s[v],d=s[b],u.y>e.y!=d.y>e.y&&e.x<(d.x-u.x)*(e.y-u.y)/(d.y-u.y)+u.x&&(m=!m)}return m}function jo(a,e){let s=!1;for(let u=0,d=a.length-1;u<a.length;d=u++){let m=a[u],g=a[d];m.y>e.y!=g.y>e.y&&e.x<(g.x-m.x)*(e.y-m.y)/(g.y-m.y)+m.x&&(s=!s)}return s}function Sr(a,e,s,u,d){for(let g of a)if(e<=g.x&&s<=g.y&&u>=g.x&&d>=g.y)return!0;let m=[new ct(e,s),new ct(e,d),new ct(u,d),new ct(u,s)];if(a.length>2){for(let g of m)if(jo(a,g))return!0}for(let g=0;g<a.length-1;g++)if(qr(a[g],a[g+1],m))return!0;return!1}function qr(a,e,s){let u=s[0],d=s[2];if(a.x<u.x&&e.x<u.x||a.x>d.x&&e.x>d.x||a.y<u.y&&e.y<u.y||a.y>d.y&&e.y>d.y)return!1;let m=Rn(a,e,s[0]);return m!==Rn(a,e,s[1])||m!==Rn(a,e,s[2])||m!==Rn(a,e,s[3])}function Zi(a,e,s,u,d,m){let g=e.y-a.y,v=a.x-e.x;if(m=m||0){let b=g*g+v*v;if(b===0)return!0;let w=Math.sqrt(b);g/=w,v/=w}return!((s.x-a.x)*g+(s.y-a.y)*v-m<0||(u.x-a.x)*g+(u.y-a.y)*v-m<0||(d.x-a.x)*g+(d.y-a.y)*v-m<0)}function Kr(a,e,s,u,d,m,g){return!(Zi(a,e,u,d,m,g)||Zi(e,s,u,d,m,g)||Zi(s,a,u,d,m,g)||Zi(u,d,a,e,s,g)||Zi(d,m,a,e,s,g)||Zi(m,u,a,e,s,g))}function Vo(a,e,s){let u=e.paint.get(a).value;return u.kind==="constant"?u.value:s.programConfigurations.get(e.id).getMaxValue(a)}function Dr(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function nl(a,e,s,u,d){if(!e[0]&&!e[1])return a;let m=ct.convert(e)._mult(d);s==="viewport"&&m._rotate(-u);let g=[];for(let v=0;v<a.length;v++)g.push(a[v].sub(m));return g}function Hf(a,e,s,u){let d=ct.convert(a)._mult(u);return e==="viewport"&&d._rotate(-s),d}let au,$f;function Gf(a,e,s){var u=2*Math.PI*6378137/256/Math.pow(2,s);return[a*u-2*Math.PI*6378137/2,e*u-2*Math.PI*6378137/2]}Bt(yr,"CircleBucket",{omit:["layers"]});class il{constructor(e,s,u){this.z=e,this.x=s,this.y=u,this.key=rl(0,e,e,s,u)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}isChildOf(e){let s=this.z-e.z;return e.z===0||e.z<this.z&&e.x===this.x>>s&&e.y===this.y>>s}url(e,s){let u=(function(m,g,v){var b=Gf(256*m,256*(g=Math.pow(2,v)-g-1),v),w=Gf(256*(m+1),256*(g+1),v);return b[0]+","+b[1]+","+w[0]+","+w[1]})(this.x,this.y,this.z),d=(function(m,g,v){let b,w="";for(let S=m;S>0;S--)b=1<<S-1,w+=(g&b?1:0)+(v&b?2:0);return w})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",d).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Cc{constructor(e,s){this.wrap=e,this.canonical=s,this.key=rl(e,s.z,s.z,s.x,s.y)}}class ko{constructor(e,s,u,d,m){this.overscaledZ=e,this.wrap=s,this.canonical=new il(u,+d,+m),this.key=s===0&&e===u?this.canonical.key:rl(s,e,u,d,m)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){let s=this.canonical.z-e;return e>this.canonical.z?new ko(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ko(e,this.wrap,e,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(e,s=!0){if(this.overscaledZ===e&&s)return this.key;if(e>this.canonical.z)return rl(this.wrap*+s,e,this.canonical.z,this.canonical.x,this.canonical.y);{let u=this.canonical.z-e;return rl(this.wrap*+s,e,e,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;let s=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>s&&e.canonical.y===this.canonical.y>>s}children(e){if(this.overscaledZ>=e)return[new ko(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let s=this.canonical.z+1,u=2*this.canonical.x,d=2*this.canonical.y;return[new ko(s,this.wrap,s,u,d),new ko(s,this.wrap,s,u+1,d),new ko(s,this.wrap,s,u,d+1),new ko(s,this.wrap,s,u+1,d+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ko(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ko(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Cc(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function rl(a,e,s,u,d){let m=1<<Math.min(s,22),g=m*(d%m)+u%m;return a&&s<22&&(g+=m*m*((a<0?-2*a-1:2*a)%(1<<2*(22-s)))),16*(32*g+s)+(e-s)}let Ch=[a=>{let e=a.canonical.x-1,s=a.wrap;return e<0&&(e=(1<<a.canonical.z)-1,s--),new ko(a.overscaledZ,s,a.canonical.z,e,a.canonical.y)},a=>{let e=a.canonical.x+1,s=a.wrap;return e===1<<a.canonical.z&&(e=0,s++),new ko(a.overscaledZ,s,a.canonical.z,e,a.canonical.y)},a=>new ko(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,(a.canonical.y===0?1<<a.canonical.z:a.canonical.y)-1),a=>new ko(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y===(1<<a.canonical.z)-1?0:a.canonical.y+1)];Bt(il,"CanonicalTileID"),Bt(ko,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});let pw=Bn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:T_}=pw,N$=Bn([{name:"a_pos_3",components:3,type:"Int16"}]);var Sk=Bn([{name:"a_pos",type:"Int16",components:2}]);function mw(a){return a*va/M}let z$=[new kn([y,y,y],[x,x,x]),new kn([y,y,y],[0,0,x]),new kn([0,y,y],[x,0,x]),new kn([y,0,y],[0,x,x]),new kn([0,0,y],[x,x,x])];function Dk(a,e,s,u=!0){let d=Ui([],a._camera.position,a.worldSize),m=[e,s,1,1];Hr(m,m,a.pixelMatrixInverse),jl(m,m,1/m[3]);let g=Li([],Ur([],m,d)),v=a.globeMatrix,b=[v[12],v[13],v[14]],w=Ur([],b,d),S=ai(w),D=Li([],w),I=a.worldSize/(2*Math.PI),R=Vr(D,g),k=Math.asin(I/S);if(k<Math.acos(R)){if(!u)return null;let We=[],Fe=[];Ui(We,g,S/R),Li(Fe,Ur(Fe,We,w)),Li(g,Pr(g,w,Ui(g,Fe,Math.tan(k)*S)))}let B=[];new Mn(d,g).closestPointOnSphere(b,I,B);let U=Li([],Or(v,0)),G=Li([],Or(v,1)),J=Li([],Or(v,2)),ee=Vr(U,B),se=Vr(G,B),_e=Vr(J,B),fe=zo(Math.asin(-se/I)),we=zo(Math.atan2(ee,_e));we=a.center.lng+(function(We,Fe){let Ze=(Fe-We+180)%360-180;return Ze<-180?Ze+360:Ze})(a.center.lng,we);let Ee=K(we),Se=X(Z(fe),0,1);return new Re(Ee,Se)}class B${constructor(e,s,u){this.a=Ur([],e,u),this.b=Ur([],s,u),this.center=u;let d=Li([],this.a),m=Li([],this.b);this.angle=Math.acos(Vr(d,m))}}function tI(a,e){if(a.angle===0)return null;let s;return s=a.a[e]===0?1/a.angle*.5*Math.PI:1/a.angle*Math.atan(a.b[e]/a.a[e]/Math.sin(a.angle)-1/Math.tan(a.angle)),s<0||s>1?null:(function(u,d,m,g){let v=Math.sin(m);return u*(Math.sin((1-g)*m)/v)+d*(Math.sin(g*m)/v)})(a.a[e],a.b[e],a.angle,X(s,0,1))+a.center[e]}function dd(a){if(a.z<=1)return z$[a.z+2*a.y+a.x];let e=nI(gw(a));return kn.fromPoints(e)}function Eh(a,e,s){return Ui(a,a,1-s),Do(a,a,e,s)}function Ik(a,e,s){for(let u of a)pr(u,u,e),Ui(u,u,s)}function Mk(a,e,s,u){let d=e/a.worldSize,m=a.globeMatrix;if(s.z<=1){let Se=dd(s).getCorners();return Ik(Se,m,d),kn.fromPoints(Se)}let g=gw(s,u),v=nI(g,va+mw(a._tileCoverLift));Ik(v,m,d);let b=Number.MAX_VALUE,w=[-b,-b,-b],S=[b,b,b];if(g.contains(a.center)){for(let Fe of v)Fs(S,S,Fe),eo(w,w,Fe);w[2]=0;let Se=a.point,We=[Se.x*d,Se.y*d,0];return Fs(S,S,We),eo(w,w,We),new kn(S,w)}if(a._tileCoverLift>0){for(let Se of v)Fs(S,S,Se),eo(w,w,Se);return new kn(S,w)}let D=[m[12]*d,m[13]*d,m[14]*d],I=g.getCenter(),R=X(a.center.lat,-ce,ce),k=X(I.lat,-ce,ce),B=K(a.center.lng),U=Z(R),G=B-K(I.lng),J=U-Z(k);G>.5?G-=1:G<-.5&&(G+=1);let ee=0;Math.abs(G)>Math.abs(J)?ee=G>=0?1:3:(ee=J>=0?0:2,Do(D,D,[m[4]*d,m[5]*d,m[6]*d],-Math.sin(Wn(J>=0?g.getSouth():g.getNorth()))*va));let se=v[ee],_e=v[(ee+1)%4],fe=new B$(se,_e,D),we=[tI(fe,0)||se[0],tI(fe,1)||se[1],tI(fe,2)||se[2]],Ee=qf(a.zoom);if(Ee>0){let Se=(function({x:Fe,y:Ze,z:Qe},rt,vt,dt,et){let ut=1/(1<<Qe),Ge=Fe*ut,$e=Ge+ut,lt=Ze*ut,gt=lt+ut,it=0,Nt=(Ge+$e)/2-dt;return Nt>.5?it=-1:Nt<-.5&&(it=1),Ge=((Ge+it)*rt-(dt*=rt))*vt+dt,$e=(($e+it)*rt-dt)*vt+dt,lt=(lt*rt-(et*=rt))*vt+et,gt=(gt*rt-et)*vt+et,[[Ge,gt,0],[$e,gt,0],[$e,lt,0],[Ge,lt,0]]})(s,e,a._pixelsPerMercatorPixel,B,U);for(let Fe=0;Fe<v.length;Fe++)Eh(v[Fe],Se[Fe],Ee);let We=Pr([],Se[ee],Se[(ee+1)%4]);Ui(We,We,.5),Eh(we,We,Ee)}for(let Se of v)Fs(S,S,Se),eo(w,w,Se);return S[2]=Math.min(se[2],_e[2]),Fs(S,S,we),eo(w,w,we),new kn(S,w)}function gw({x:a,y:e,z:s},u=!1){let d=1/(1<<s),m=new F(ae(a*d),e===(1<<s)-1&&u?-90:re((e+1)*d)),g=new F(ae((a+1)*d),e===0&&u?90:re(e*d));return new O(m,g)}function nI(a,e=va){let s=Wn(a.getNorth()),u=Wn(a.getSouth()),d=Math.cos(s),m=Math.cos(u),g=Math.sin(s),v=Math.sin(u),b=a.getWest(),w=a.getEast();return[C(m,v,b,e),C(m,v,w,e),C(d,g,w,e),C(d,g,b,e)]}function My(a,e,s,u){let d=1<<s.z,m=(a/yt+s.x)/d;return T(re((e/yt+s.y)/d),ae(m),u)}function _w({min:a,max:e}){return c/Math.max(e[0]-a[0],e[1]-a[1],e[2]-a[2])}let Ak=new Float64Array(16);function vw(a){let e=_w(a),s=rr(Ak,[e,e,e]);return kt(s,s,Ga([],a.min))}function iI(a){let e=(u=a.min,(s=Ak)[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=u[0],s[13]=u[1],s[14]=u[2],s[15]=1,s);var s,u;let d=1/_w(a);return Cn(e,e,[d,d,d])}function rI(a){let e=yt/(2*Math.PI);return a/(2*Math.PI)/e}function Pk(a,e){return yt/(512*Math.pow(2,a))*_w(dd(e))}function Ok(a,e,s,u,d){let m=rI(s),g=[a,e,-s/(2*Math.PI)],v=Be(new Float64Array(16));return kt(v,v,g),Cn(v,v,[m,m,m]),Xn(v,v,Wn(-d)),On(v,v,Wn(-u)),v}function qf(a){return de(f,r,a)}function Rk(a,e){let s=T(e.lat,e.lng),u=(function(k){let B=T(k._center.lat,k._center.lng),U=Ro([],Fi(0,1,0),B),G=Vi([],-k.angle,B);U=pr(U,U,G),Vi(G,-k._pitch,U);let J=Li([],B);return Ui(J,J,mw(k.cameraToCenterDistance/k.pixelsPerMeter)),pr(J,J,G),Pr([],B,J)})(a);return g=(d=Oo([],u,s))[0],v=d[1],b=d[2],w=(m=s)[0],S=m[1],D=m[2],R=(I=Math.sqrt((g*g+v*v+b*b)*(w*w+S*S+D*D)))&&Vr(d,m)/I,Math.acos(Math.min(Math.max(R,-1),1));var d,m,g,v,b,w,S,D,I,R}function oI(a,e){return Rk(a,e)>Math.PI/2*1.01}let kk=Wn(85),j$=Math.cos(kk),V$=Math.sin(kk),U$=ze(),Fk=a=>{let e=[];return a.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),a.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function Lk(a,e,s,u,d,m,g,v,b){if(m&&a.queryGeometry.isAboveHorizon)return!1;m&&(b*=a.pixelToTileUnitsFactor);let w=a.tileID.canonical,S=s.projection.upVectorScale(w,s.center.lat,s.worldSize).metersToTile;for(let D of e)for(let I of D){let R=I.add(v),k=d&&s.elevation?s.elevation.exaggeration()*d.getElevationAt(R.x,R.y,!0):0,B=s.projection.projectTilePoint(R.x,R.y,w);if(k>0){let ee=s.projection.upVector(w,R.x,R.y);B.x+=ee[0]*S*k,B.y+=ee[1]*S*k,B.z+=ee[2]*S*k}let U=m?R:H$(B.x,B.y,B.z,u),G=m?a.tilespaceRays.map(ee=>G$(ee,k)):a.queryGeometry.screenGeometry,J=Hr([],[B.x,B.y,B.z,1],u);if(!g&&m?b*=J[3]/s.cameraToCenterDistance:g&&!m&&(b*=s.cameraToCenterDistance/J[3]),m){let ee=re((I.y/yt+w.y)/(1<<w.z));b/=s.projection.pixelsPerMeter(ee,1)/Q(1,ee)}if(Cr(G,U,b))return!0}return!1}function H$(a,e,s,u){let d=Hr([],[a,e,s,1],u);return new ct(d[0]/d[3],d[1]/d[3])}let Nk=Fi(0,0,0),$$=Fi(0,0,1);function G$(a,e){let s=Rt();return Nk[2]=e,a.intersectsPlane(Nk,$$,s),new ct(s[0],s[1])}class zk extends yr{}let Bk,jk,Vk,Uk;function Hk(a,{width:e,height:s},u,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==e*s*u)throw new RangeError("mismatched image size")}else d=new Uint8Array(e*s*u);return a.width=e,a.height=s,a.data=d,a}function $k(a,e,s){let{width:u,height:d}=e;u===a.width&&d===a.height||(sI(a,e,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,u),height:Math.min(a.height,d)},s,null),a.width=u,a.height=d,a.data=e.data)}function sI(a,e,s,u,d,m,g,v){if(d.width===0||d.height===0)return e;if(d.width>a.width||d.height>a.height||s.x>a.width-d.width||s.y>a.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>e.width||d.height>e.height||u.x>e.width-d.width||u.y>e.height-d.height)throw new RangeError("out of range destination coordinates for image copy");let b=a.data,w=e.data,S=m===4&&v;for(let D=0;D<d.height;D++){let I=((s.y+D)*a.width+s.x)*m,R=((u.y+D)*e.width+u.x)*m;if(S)for(let k=0;k<d.width;k++){let B=I+k*m+3,U=R+k*m;w[U+0]=255,w[U+1]=255,w[U+2]=255,w[U+3]=b[B]}else if(g)for(let k=0;k<d.width;k++){let B=I+k*m,U=R+k*m,G=new Qn(b[B+0]/255,b[B+1]/255,b[B+2]/255,b[B+3]).toNonPremultipliedRenderColor(g).toArray();w[U+0]=G[0],w[U+1]=G[1],w[U+2]=G[2],w[U+3]=G[3]}else for(let k=0;k<d.width*m;k++)w[R+k]=b[I+k]}return e}Bt(zk,"HeatmapBucket",{omit:["layers"]});class Wf{constructor(e,s){Hk(this,e,1,s)}resize(e){$k(this,new Wf(e),1)}clone(){return new Wf({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,s,u,d,m){sI(e,s,u,d,m,1,null)}}class Cs{constructor(e,s){Hk(this,e,4,s)}resize(e){$k(this,new Cs(e),4)}replace(e,s){s?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Cs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,s,u,d,m,g,v){sI(e,s,u,d,m,4,g,v)}}class Gk{constructor(e,s){this.width=e.width,this.height=e.height,this.data=s instanceof Uint8Array?new Float32Array(s.buffer):s}}function Ay(a){let e={},s=a.resolution||256,u=a.clips?a.clips.length:1,d=a.image||new Cs({width:s,height:u}),m=(g,v,b)=>{e[a.evaluationKey]=b;let w=a.expression.evaluate(e),S=w?w.toNonPremultipliedRenderColor(null):null;S&&(d.data[g+v+0]=Math.floor(255*S.r),d.data[g+v+1]=Math.floor(255*S.g),d.data[g+v+2]=Math.floor(255*S.b),d.data[g+v+3]=Math.floor(255*S.a))};if(a.clips)for(let g=0,v=0;g<u;++g,v+=4*s)for(let b=0,w=0;b<s;b++,w+=4){let S=b/(s-1),{start:D,end:I}=a.clips[g];m(v,w,D*(1-S)+I*S)}else for(let g=0,v=0;g<s;g++,v+=4)m(0,v,g/(s-1));return d}Bt(Wf,"AlphaImage"),Bt(Cs,"RGBAImage");let q$=Bn([{name:"a_pos",components:2,type:"Int16"}],4),W$=Bn([{name:"a_road_z_offset",components:1,type:"Float32"}],4),Z$=Bn([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),X$=Bn([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function S_(a,e,s=2){let u=e&&e.length,d=u?e[0]*s:a.length,m=qk(a,0,d,s,!0),g=[];if(!m||m.next===m.prev)return g;let v,b,w;if(u&&(m=(function(S,D,I,R){let k=[];for(let B=0,U=D.length;B<U;B++){let G=qk(S,D[B]*R,B<U-1?D[B+1]*R:S.length,R,!1);G===G.next&&(G.steiner=!0),k.push(iG(G))}k.sort(eG);for(let B=0;B<k.length;B++)I=tG(k[B],I);return I})(a,e,m,s)),a.length>80*s){v=a[0],b=a[1];let S=v,D=b;for(let I=s;I<d;I+=s){let R=a[I],k=a[I+1];R<v&&(v=R),k<b&&(b=k),R>S&&(S=R),k>D&&(D=k)}w=Math.max(S-v,D-b),w=w!==0?32767/w:0}return Py(m,g,s,v,b,w,0),g}function qk(a,e,s,u,d){let m;if(d===(function(g,v,b,w){let S=0;for(let D=v,I=b-w;D<b;D+=w)S+=(g[I]-g[D])*(g[D+1]+g[I+1]),I=D;return S})(a,e,s,u)>0)for(let g=e;g<s;g+=u)m=Yk(g/u|0,a[g],a[g+1],m);else for(let g=s-u;g>=e;g-=u)m=Yk(g/u|0,a[g],a[g+1],m);return m&&D_(m,m.next)&&(ky(m),m=m.next),m}function bm(a,e){if(!a)return a;e||(e=a);let s,u=a;do if(s=!1,u.steiner||!D_(u,u.next)&&Uo(u.prev,u,u.next)!==0)u=u.next;else{if(ky(u),u=e=u.prev,u===u.next)break;s=!0}while(s||u!==e);return e}function Py(a,e,s,u,d,m,g){if(!a)return;!g&&m&&(function(b,w,S,D){let I=b;do I.z===0&&(I.z=aI(I.x,I.y,w,S,D)),I.prevZ=I.prev,I.nextZ=I.next,I=I.next;while(I!==b);I.prevZ.nextZ=null,I.prevZ=null,(function(R){let k,B=1;do{let U,G=R;R=null;let J=null;for(k=0;G;){k++;let ee=G,se=0;for(let fe=0;fe<B&&(se++,ee=ee.nextZ,ee);fe++);let _e=B;for(;se>0||_e>0&&ee;)se!==0&&(_e===0||!ee||G.z<=ee.z)?(U=G,G=G.nextZ,se--):(U=ee,ee=ee.nextZ,_e--),J?J.nextZ=U:R=U,U.prevZ=J,J=U;G=ee}J.nextZ=null,B*=2}while(k>1)})(I)})(a,u,d,m);let v=a;for(;a.prev!==a.next;){let b=a.prev,w=a.next;if(m?K$(a,u,d,m):Y$(a))e.push(b.i,a.i,w.i),ky(a),a=w.next,v=w.next;else if((a=w)===v){g?g===1?Py(a=J$(bm(a),e),e,s,u,d,m,2):g===2&&Q$(a,e,s,u,d,m):Py(bm(a),e,s,u,d,m,1);break}}}function Y$(a){let e=a.prev,s=a,u=a.next;if(Uo(e,s,u)>=0)return!1;let d=e.x,m=s.x,g=u.x,v=e.y,b=s.y,w=u.y,S=Math.min(d,m,g),D=Math.min(v,b,w),I=Math.max(d,m,g),R=Math.max(v,b,w),k=u.next;for(;k!==e;){if(k.x>=S&&k.x<=I&&k.y>=D&&k.y<=R&&Oy(d,v,m,b,g,w,k.x,k.y)&&Uo(k.prev,k,k.next)>=0)return!1;k=k.next}return!0}function K$(a,e,s,u){let d=a.prev,m=a,g=a.next;if(Uo(d,m,g)>=0)return!1;let v=d.x,b=m.x,w=g.x,S=d.y,D=m.y,I=g.y,R=Math.min(v,b,w),k=Math.min(S,D,I),B=Math.max(v,b,w),U=Math.max(S,D,I),G=aI(R,k,e,s,u),J=aI(B,U,e,s,u),ee=a.prevZ,se=a.nextZ;for(;ee&&ee.z>=G&&se&&se.z<=J;){if(ee.x>=R&&ee.x<=B&&ee.y>=k&&ee.y<=U&&ee!==d&&ee!==g&&Oy(v,S,b,D,w,I,ee.x,ee.y)&&Uo(ee.prev,ee,ee.next)>=0||(ee=ee.prevZ,se.x>=R&&se.x<=B&&se.y>=k&&se.y<=U&&se!==d&&se!==g&&Oy(v,S,b,D,w,I,se.x,se.y)&&Uo(se.prev,se,se.next)>=0))return!1;se=se.nextZ}for(;ee&&ee.z>=G;){if(ee.x>=R&&ee.x<=B&&ee.y>=k&&ee.y<=U&&ee!==d&&ee!==g&&Oy(v,S,b,D,w,I,ee.x,ee.y)&&Uo(ee.prev,ee,ee.next)>=0)return!1;ee=ee.prevZ}for(;se&&se.z<=J;){if(se.x>=R&&se.x<=B&&se.y>=k&&se.y<=U&&se!==d&&se!==g&&Oy(v,S,b,D,w,I,se.x,se.y)&&Uo(se.prev,se,se.next)>=0)return!1;se=se.nextZ}return!0}function J$(a,e){let s=a;do{let u=s.prev,d=s.next.next;!D_(u,d)&&Zk(u,s,s.next,d)&&Ry(u,d)&&Ry(d,u)&&(e.push(u.i,s.i,d.i),ky(s),ky(s.next),s=a=d),s=s.next}while(s!==a);return bm(s)}function Q$(a,e,s,u,d,m){let g=a;do{let v=g.next.next;for(;v!==g.prev;){if(g.i!==v.i&&rG(g,v)){let b=Xk(g,v);return g=bm(g,g.next),b=bm(b,b.next),Py(g,e,s,u,d,m,0),void Py(b,e,s,u,d,m,0)}v=v.next}g=g.next}while(g!==a)}function eG(a,e){let s=a.x-e.x;return s===0&&(s=a.y-e.y,s===0)&&(s=(a.next.y-a.y)/(a.next.x-a.x)-(e.next.y-e.y)/(e.next.x-e.x)),s}function tG(a,e){let s=(function(d,m){let g=m,v=d.x,b=d.y,w,S=-1/0;if(D_(d,g))return g;do{if(D_(d,g.next))return g.next;if(b<=g.y&&b>=g.next.y&&g.next.y!==g.y){let B=g.x+(b-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(B<=v&&B>S&&(S=B,w=g.x<g.next.x?g:g.next,B===v))return w}g=g.next}while(g!==m);if(!w)return null;let D=w,I=w.x,R=w.y,k=1/0;g=w;do{if(v>=g.x&&g.x>=I&&v!==g.x&&Wk(b<R?v:S,b,I,R,b<R?S:v,b,g.x,g.y)){let B=Math.abs(b-g.y)/(v-g.x);Ry(g,d)&&(B<k||B===k&&(g.x>w.x||g.x===w.x&&nG(w,g)))&&(w=g,k=B)}g=g.next}while(g!==D);return w})(a,e);if(!s)return e;let u=Xk(s,a);return bm(u,u.next),bm(s,s.next)}function nG(a,e){return Uo(a.prev,a,e.prev)<0&&Uo(e.next,a,a.next)<0}function aI(a,e,s,u,d){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-s)*d|0)|a<<8))|a<<4))|a<<2))|a<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-u)*d|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function iG(a){let e=a,s=a;do(e.x<s.x||e.x===s.x&&e.y<s.y)&&(s=e),e=e.next;while(e!==a);return s}function Wk(a,e,s,u,d,m,g,v){return(d-g)*(e-v)>=(a-g)*(m-v)&&(a-g)*(u-v)>=(s-g)*(e-v)&&(s-g)*(m-v)>=(d-g)*(u-v)}function Oy(a,e,s,u,d,m,g,v){return!(a===g&&e===v)&&Wk(a,e,s,u,d,m,g,v)}function rG(a,e){return a.next.i!==e.i&&a.prev.i!==e.i&&!(function(s,u){let d=s;do{if(d.i!==s.i&&d.next.i!==s.i&&d.i!==u.i&&d.next.i!==u.i&&Zk(d,d.next,s,u))return!0;d=d.next}while(d!==s);return!1})(a,e)&&(Ry(a,e)&&Ry(e,a)&&(function(s,u){let d=s,m=!1,g=(s.x+u.x)/2,v=(s.y+u.y)/2;do d.y>v!=d.next.y>v&&d.next.y!==d.y&&g<(d.next.x-d.x)*(v-d.y)/(d.next.y-d.y)+d.x&&(m=!m),d=d.next;while(d!==s);return m})(a,e)&&(Uo(a.prev,a,e.prev)||Uo(a,e.prev,e))||D_(a,e)&&Uo(a.prev,a,a.next)>0&&Uo(e.prev,e,e.next)>0)}function Uo(a,e,s){return(e.y-a.y)*(s.x-e.x)-(e.x-a.x)*(s.y-e.y)}function D_(a,e){return a.x===e.x&&a.y===e.y}function Zk(a,e,s,u){let d=xw(Uo(a,e,s)),m=xw(Uo(a,e,u)),g=xw(Uo(s,u,a)),v=xw(Uo(s,u,e));return d!==m&&g!==v||!(d!==0||!yw(a,s,e))||!(m!==0||!yw(a,u,e))||!(g!==0||!yw(s,a,u))||!(v!==0||!yw(s,e,u))}function yw(a,e,s){return e.x<=Math.max(a.x,s.x)&&e.x>=Math.min(a.x,s.x)&&e.y<=Math.max(a.y,s.y)&&e.y>=Math.min(a.y,s.y)}function xw(a){return a>0?1:a<0?-1:0}function Ry(a,e){return Uo(a.prev,a,a.next)<0?Uo(a,e,a.next)>=0&&Uo(a,a.prev,e)>=0:Uo(a,e,a.prev)<0||Uo(a,a.next,e)<0}function Xk(a,e){let s=lI(a.i,a.x,a.y),u=lI(e.i,e.x,e.y),d=a.next,m=e.prev;return a.next=e,e.prev=a,s.next=d,d.prev=s,u.next=s,s.prev=u,m.next=u,u.prev=m,u}function Yk(a,e,s,u){let d=lI(a,e,s);return u?(d.next=u.next,d.prev=u,u.next.prev=d,u.next=d):(d.prev=d,d.next=d),d}function ky(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function lI(a,e,s){return{i:a,x:e,y:s,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Fy(a,e){let s=a.length;if(s<=1)return[a];let u=[],d,m;for(let g=0;g<s;g++){let v=zn(a[g]);v!==0&&(a[g].area=Math.abs(v),m===void 0&&(m=v<0),m===v<0?(d&&u.push(d),d=[a[g]]):d.push(a[g]))}if(d&&u.push(d),e>1)for(let g=0;g<u.length;g++)u[g].length<=e||(ql(u[g],e,1,u[g].length-1,oG),u[g]=u[g].slice(0,e));return u}function oG(a,e){return e.area-a.area}function Kk(a,e,s=1){if(!a)return null;let u=typeof a=="string"?xs.from(a).getPrimary():a.getPrimary(),d=typeof a=="string"?null:a.getSecondary();for(let m of[u,d]){if(!m)continue;let g=m.id.toString();e.has(g)||e.set(g,[]),m.scaleSelf(s),e.get(g).push(m)}return{primary:u.toString(),secondary:d?d.toString():null}}function cI(a,e,s,u){let d=u.patternDependencies,m=!1;for(let g of e){let v=g.paint.get(`${a}-pattern`);v.isConstant()||(m=!0),Kk(v.constantOr(null),d,s)&&(m=!0)}return m}function uI(a,e,s,u,d,m){let g=m.patternDependencies;for(let v of e){let b=v.paint.get(`${a}-pattern`).value;if(b.kind!=="constant"){let w=b.evaluate({zoom:u},s,{},m.availableImages);w=w&&w.name?w.name:w;let S=Kk(w,g,d);if(!S)continue;let{primary:D,secondary:I}=S;D&&(s.patterns[v.id]=[D,I].filter(Boolean))}}return s}class Jk{constructor(){this.polygons=new Map}add(e,...s){let u=this.polygons.get(e);u?u.push(...s):this.polygons.set(e,s)}merge(e){for(let[s,u]of e.polygons)this.add(s,...u)}}class Th{constructor(){this.portals=[]}static isOnBorder(e,s){return e<=0&&s<=0||e>=yt&&s>=yt}static evaluate(e){if(e.length===0)return new Th;let s=[];for(let b of e)s.push(...b.portals);if(s.length===0)return new Th;for(let b of s){let w=b.va,S=b.vb;(Th.isOnBorder(w.x,S.x)||Th.isOnBorder(w.y,S.y))&&(b.type="border")}let u=s.filter(b=>b.type!=="unevaluated"),d=s.filter(b=>b.type==="unevaluated");if(d.length===0)return new Th;d.sort((b,w)=>b.hash===w.hash?b.isTunnel===w.isTunnel?0:b.isTunnel?-1:1:b.hash<w.hash?1:-1),s=u.concat(d);let m=u.length,g=m,v=m;do if(g++,g===s.length||s[m].hash!==s[g].hash){if(g-m==2){v<m&&(s[v]=s[m],s[m]=null);let b=s[v],w=s[g-1];b.type=b.isTunnel!==w.isTunnel?"tunnel":"polygon",b.connection={a:b.connection.a,b:w.connection.a},v++}m=g}while(m!==s.length);return s.splice(v),s.sort((b,w)=>b.hash<w.hash?1:-1),{portals:s}}}Bt(Th,"ElevationPortalGraph"),Bt(Jk,"ElevationPolygons");class sG{constructor(e,s,u){this.outPositions=e,this.outNormals=s,this.outIndices=u,this.vertexLookup=new Map}addVertex(e,s,u){let d=e[2];u!=null&&(d*=u);let m=`${e[0]},${e[1]},${e[2]},${s[0]},${s[1]},${s[2]}`,g=this.vertexLookup.get(m);if(g!=null)return g;let v=this.outPositions.length;this.vertexLookup.set(m,v);let b=Math.trunc(16384*s[0]),w=Math.trunc(16384*s[1]),S=Math.trunc(16384*s[2]);return this.outPositions.emplaceBack(e[0],e[1],d),this.outNormals.emplaceBack(b,w,S),v}addTriangle(e,s,u){this.outIndices.emplaceBack(e,s,u)}addTriangles(e,s,u){if(e.length===0)return;let d=u.length===1,m=Rt(),g=Rt();for(let v=0;v<e.length;v+=3){let b=s[e[v+0]],w=s[e[v+1]],S=s[e[v+2]],D=d?u[0]:u[e[v+1]],I=d?u[0]:u[e[v+2]];Wi(m,b.x,b.y,d?u[0]:u[e[v+0]]);let R=this.addVertex(m,g);Wi(m,w.x,w.y,D);let k=this.addVertex(m,g);Wi(m,S.x,S.y,I);let B=this.addVertex(m,g);this.outIndices.emplaceBack(R,k,B)}}addQuad(e,s,u,d,m,g){let v=this.addVertex(e,m,g),b=this.addVertex(s,m,g),w=this.addVertex(u,m,g),S=this.addVertex(d,m,g);this.addTriangle(v,b,w),this.addTriangle(w,S,v)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class ol{constructor(e,s,u,d){this.unevaluatedPortals=new Th,this.portalPolygons=new Jk,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new dy,this.vertexNormals=new hy,this.indexArray=new mr,this.tileToMeters=xe(e),this.bridgeProgramConfigurations=new Xl(s,{zoom:u,lut:d},m=>m!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new Xl(s,{zoom:u,lut:d},m=>m!=="fill-bridge-guard-rail-color")}addVertices(e,s){let u=this.unevalVertices.length;for(let d=0;d<e.length;d++)this.unevalVertices.push(e[d]),this.unevalHeights.push(s[d]);return u}addTriangles(e,s,u){let d=u?this.unevalTunnelTriangles:this.unevalTriangles;for(let m of e)d.push(m+s)}addRenderableRing(e,s,u,d,m,g){let v=[new ct(m.min.x,m.min.y),new ct(m.max.x,m.min.y),new ct(m.max.x,m.max.y),new ct(m.min.x,m.max.y)];for(let b=0;b<u-1;b++){let w=s+b,S=w+1,D=this.unevalVertices[w],I=this.unevalVertices[S];if(!(D.x>=m.min.x&&D.x<=m.max.x&&D.y>=m.min.y&&D.y<=m.max.y||I.x>=m.min.x&&I.x<=m.max.x&&I.y>=m.min.y&&I.y<=m.max.y||qr(D,I,v))||this.isOnBorder(D.x,I.x)||this.isOnBorder(D.y,I.y))continue;let R=ol.computeEdgeHash(this.unevalVertices[w],this.unevalVertices[S]),k,B=this.vertexHashLookup.get(ol.computePosHash(D));B!=null?k=B.next:(B=this.vertexHashLookup.get(ol.computePosHash(I)),k=B!=null?B.prev:R),this.unevalEdges.push({polygonIdx:e,a:w,b:S,hash:R,portalHash:k,isTunnel:d,type:"unevaluated",featureInfo:g})}}addPortalCandidates(e,s,u,d,m){if(s.length===0)return;this.portalPolygons.add(e,{geometry:s,zLevel:m});let g=s[0];this.vertexHashLookup.clear();let v=ol.computeEdgeHash(g[g.length-2],g[g.length-1]);for(let b=0;b<g.length-1;b++){let w=g[b+0],S=g[b+1],D=jc(S.x-w.x,S.y-w.y),I=gr(D);if(I===0)continue;let R="unevaluated",k=d.pointElevation(w),B=d.pointElevation(S);Math.abs(k)<.01&&Math.abs(B)<.01?R="entrance":(this.isOnBorder(w.x,S.x)||this.isOnBorder(w.y,S.y))&&(R="border");let U=ol.computeEdgeHash(w,S);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:w,vb:S,vab:D,length:I,hash:U,isTunnel:u,type:R});let G=ol.computePosHash(w);this.vertexHashLookup.set(G,{prev:v,next:U}),v=U}}construct(e){if(this.unevalVertices.length===0)return;let s=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),u=I=>{I.primitiveLength=this.indexArray.length-I.primitiveOffset},d=new sG(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);let m=s(),g=s(),v=s(),b=(I,R)=>{I.sort((B,U)=>B.type===R&&U.type!==R?-1:B.type!==R&&U.type===R?1:0);let k=I.findIndex(B=>B.type!==R);return k>=0?k:I.length},w=0;this.unevalEdges.length>0&&(w=b(this.unevalEdges,"none"),this.constructBridgeStructures(d,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:w},this.tileToMeters)),u(v);let S=s(),D=s();if(this.unevalEdges.length>0){let I=this.unevalEdges.splice(w),R=b(I,"tunnel")+w;this.unevalEdges.push(...I),this.constructTunnelStructures(d,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:w},{min:w,max:R})}u(S),d.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),u(D),d.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),u(g),d.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),u(m),this.maskSegments=wr.simpleSegment(0,D.primitiveOffset,0,D.primitiveLength),this.depthSegments=wr.simpleSegment(0,g.primitiveOffset,0,g.primitiveLength),this.renderableBridgeSegments=wr.simpleSegment(0,v.primitiveOffset,0,v.primitiveLength),this.renderableTunnelSegments=wr.simpleSegment(0,S.primitiveOffset,0,S.primitiveLength),this.shadowCasterSegments=wr.simpleSegment(0,m.primitiveOffset,0,m.primitiveLength)}update(e,s,u,d,m,g,v,b){this.bridgeProgramConfigurations.updatePaintArrays(e,s,m,u,d,g,v,b),this.tunnelProgramConfigurations.updatePaintArrays(e,s,m,u,d,g,v,b)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,Z$.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,X$.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,s,u,d,m){let g=(v,b)=>{for(let w=0;w<b.length-1;w++){let S=b[w].featureIndex,D=b[w+1].vertexStart,I=e.feature(S);v.populatePaintArrays(D,I,S,{},u,s,d,void 0,m)}};g(this.bridgeProgramConfigurations,this.bridgeFeatureSections),g(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,s,u,d,m){let g=new Map;for(let v=d;v<m;v++){let b=u[v],w=b.a,S=b.b,D=ol.computePosHash(e[w]),I=ol.computePosHash(e[S]),R=g.get(D);R||(R={},g.set(D,R));let k=g.get(I);k||(k={},g.set(I,k)),s[w]<=0&&s[S]<=0||(R.to=S,k.from=w)}return g}isTerminalVertex(e,s){let u=ol.computePosHash(this.unevalVertices[e]),d=s.get(u);return!d||!d.from||!d.to}constructBridgeStructures(e,s,u,d,m,g){e.clearVertexLookup();let v=this.computeVertexConnections(s,u,d,m.min,m.max),b=1/g,w=.5*b,S=(vt,dt)=>Wi(vt,s[dt].x,s[dt].y,u[dt]*b),D=Rt(),I=Rt(),R=Rt(),k=Rt(),B=Rt(),U=(vt,dt)=>{let et=v.get(ol.computePosHash(s[dt])),ut=et.from,Ge=et.to;if(!ut||!Ge)return;S(D,ut),S(I,dt),S(R,Ge),co(k),Wo(D,I)||(Ur(B,I,D),Li(k,B)),Wo(R,I)||(Ur(B,R,I),Pr(k,k,Li(B,B)));let $e=_l(k);return $e>0?Ui(vt,k,1/$e):void 0},G=Number.POSITIVE_INFINITY;this.sortSubarray(d,m.min,m.max,(vt,dt)=>vt.featureInfo.featureIndex-dt.featureInfo.featureIndex);let J=Rt(),ee=Rt(),se=Rt(),_e=Rt(),fe=Rt(),we=Rt(),Ee=Rt(),Se=Rt(),We=Rt(),Fe=[Rt(),Rt(),Rt(),Rt()],Ze=[Rt(),Rt(),Rt(),Rt()],Qe=[{coord:new ct(0,0),height:0},{coord:new ct(0,0),height:0}],rt=(vt,dt)=>vt>dt;for(let vt=m.min;vt<m.max;vt++){let dt=d[vt];if(!dt.featureInfo.guardRailEnabled||!this.prepareEdgePoints(Qe,s,u,dt,rt))continue;let[et,ut]=Qe;if(Wi(J,et.coord.x,et.coord.y,b*et.height),Wi(ee,ut.coord.x,ut.coord.y,b*ut.height),Wo(J,ee))continue;Ur(se,ee,J),Li(se,se);let Ge=U(Se,dt.a)||se,$e=U(We,dt.b)||se;Wi(_e,Ge[1],-Ge[0],0),Li(_e,_e),Wi(fe,$e[1],-$e[0],0),Li(fe,fe),Ro(Se,_e,Ge),Li(we,Se),Ro(Se,fe,$e),Li(Ee,Se),Pr(Fe[0],J,Ui(Se,Ur(Se,_e,we),w)),Pr(Fe[1],J,Ui(Se,Pr(Se,_e,we),w)),Pr(Fe[2],J,Ui(Se,we,w)),Fe[3]=J,Pr(Ze[0],ee,Ui(Se,Ur(Se,fe,Ee),w)),Pr(Ze[1],ee,Ui(Se,Pr(Se,fe,Ee),w)),Pr(Ze[2],ee,Ui(Se,Ee,w)),Ze[3]=ee,G=this.addFeatureSection(dt.featureInfo.featureIndex,G,this.bridgeFeatureSections,e);let lt=e.addVertex(Fe[0],_e,g),gt=e.addVertex(Fe[1],_e,g),it=e.addVertex(Ze[0],fe,g),Nt=e.addVertex(Ze[1],fe,g);e.addTriangle(lt,gt,it),e.addTriangle(gt,Nt,it);let Ut=e.addVertex(Fe[1],we,g),Pt=e.addVertex(Fe[2],we,g),St=e.addVertex(Ze[1],Ee,g),yn=e.addVertex(Ze[2],Ee,g);e.addTriangle(Ut,Pt,St),e.addTriangle(Pt,yn,St),Ga(_e,_e),Ga(fe,fe);let It=e.addVertex(Fe[2],_e,g),rn=e.addVertex(Fe[3],_e,g),xn=e.addVertex(Ze[2],fe,g),Nn=e.addVertex(Ze[3],fe,g);e.addTriangle(It,rn,xn),e.addTriangle(rn,Nn,xn);let ri=this.isTerminalVertex(dt.a,v),wn=this.isTerminalVertex(dt.b,v);et.height<.01&&ri&&e.addQuad(Fe[3],Fe[2],Fe[1],Fe[0],Ga(Ge,Ge),g),ut.height<.01&&wn&&e.addQuad(Ze[0],Ze[1],Ze[2],Ze[3],$e,g)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,s,u,d,m,g){e.clearVertexLookup();let v=Number.POSITIVE_INFINITY,b=(G,J)=>G.featureInfo.featureIndex-J.featureInfo.featureIndex;this.sortSubarray(d,m.min,m.max,b),this.sortSubarray(d,g.min,g.max,b);let w=G=>Li(G,G),S=[{coord:new ct(0,0),height:0},{coord:new ct(0,0),height:0}],D=(G,J)=>G<J,I=Rt(),R=Rt(),k=Rt(),B=Rt(),U=Rt();for(let G=m.min;G<m.max;G++){if(!this.prepareEdgePoints(S,s,u,d[G],D))continue;let[J,ee]=S,se=w(Wi(U,-(ee.coord.y-J.coord.y),ee.coord.x-J.coord.x,0));v=this.addFeatureSection(d[G].featureInfo.featureIndex,v,this.tunnelFeatureSections,e),e.addQuad(Wi(I,J.coord.x,J.coord.y,J.height),Wi(R,ee.coord.x,ee.coord.y,ee.height),Wi(k,ee.coord.x,ee.coord.y,d[G].isTunnel?-.1:0),Wi(B,J.coord.x,J.coord.y,d[G].isTunnel?-.1:0),se)}for(let G=g.min;G<g.max;G++){let J=d[G];J.isTunnel&&([J.a,J.b]=[J.b,J.a]);let ee=s[J.a],se=s[J.b],_e=w(Wi(U,-(se.y-ee.y),se.x-ee.x,0));v=this.addFeatureSection(J.featureInfo.featureIndex,v,this.tunnelFeatureSections,e),e.addQuad(Wi(I,se.x,se.y,0),Wi(R,ee.x,ee.y,0),Wi(k,ee.x,ee.y,u[J.a]+4),Wi(B,se.x,se.y,u[J.b]+4),_e),e.addQuad(Wi(I,ee.x,ee.y,0),Wi(R,se.x,se.y,0),Wi(k,se.x,se.y,u[J.b]+4),Wi(B,ee.x,ee.y,u[J.a]+4),_e)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}setElevatedPoint(e,s,u,d){e.coord.x=s,e.coord.y=u,e.height=d}prepareEdgePoints(e,s,u,d,m){let g=s[d.a].x,v=s[d.a].y,b=s[d.b].x,w=s[d.b].y,S=u[d.a],D=u[d.b],I=m(S,0),R=m(D,0);if(I&&R)return this.setElevatedPoint(e[0],g,v,S),this.setElevatedPoint(e[1],b,w,D),!0;if(!I&&!R)return!1;if(I){if(!R){let k=D/(D-S);b=ln(b,g,k),w=ln(w,v,k),D=ln(D,S,k)}}else{let k=S/(S-D);g=ln(g,b,k),v=ln(v,w,k),S=ln(S,D,k)}return this.setElevatedPoint(e[0],g,v,S),this.setElevatedPoint(e[1],b,w,D),!0}prepareEdges(e,s){if(s.length===0)return;s.sort((v,b)=>v.hash===b.hash?b.polygonIdx-v.polygonIdx:b.hash>v.hash?1:-1);let u=0,d=0,m=0,g=s[u].polygonIdx;do d++,(d===s.length||s[u].hash!==s[d].hash)&&((d-u==1||s[d-1].polygonIdx!==g)&&(m<u&&(s[m]=s[u],s[u]=null),s[m].type="none",m++),u=d,u!==s.length&&(g=s[u].polygonIdx));while(u!==s.length);if(s.splice(m),s.length!==0&&e.length!==0){s.sort((w,S)=>w.portalHash<S.portalHash?1:-1);let v=0,b=0;for(;v!==s.length&&b!==e.length;){let w=s[v],S=e[b];w.portalHash>S.hash?v++:S.hash>w.portalHash?b++:(w.type=S.type,v++)}}}isOnBorder(e,s){return e<=0&&s<=0||e>=yt&&s>=yt}addFeatureSection(e,s,u,d){return e!==s&&(s=e,u.push({featureIndex:e,vertexStart:d.getVertexCount()}),d.clearVertexLookup()),s}sortSubarray(e,s,u,d){let m=e.slice(s,u);m.sort(d),e.splice(s,m.length,...m)}static computeEdgeHash(e,s){return(e.y===s.y&&e.x>s.x||e.y>s.y)&&([e,s]=[s,e]),BigInt(ol.computePosHash(e))<<32n|BigInt(ol.computePosHash(s))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var Qk,eF={exports:{}},tF=(Qk||(Qk=1,(function(a,e){(function(s){function u(pe,ue){return pe>ue?1:pe<ue?-1:0}var d=function(pe,ue){pe===void 0&&(pe=u),ue===void 0&&(ue=!1),this._compare=pe,this._root=null,this._size=0,this._noDuplicates=!!ue},m={size:{configurable:!0}};function g(pe,ue,Xe,Et,Ye){var Dt=Ye-Et;if(Dt>0){var Yt=Et+Math.floor(Dt/2),Xt={key:ue[Yt],data:Xe[Yt],parent:pe};return Xt.left=g(Xt,ue,Xe,Et,Yt),Xt.right=g(Xt,ue,Xe,Yt+1,Ye),Xt}return null}function v(pe,ue,Xe,Et,Ye){if(!(Xe>=Et)){for(var Dt=pe[Xe+Et>>1],Yt=Xe-1,Xt=Et+1;;){do Yt++;while(Ye(pe[Yt],Dt)<0);do Xt--;while(Ye(pe[Xt],Dt)>0);if(Yt>=Xt)break;var En=pe[Yt];pe[Yt]=pe[Xt],pe[Xt]=En,En=ue[Yt],ue[Yt]=ue[Xt],ue[Xt]=En}v(pe,ue,Xe,Xt,Ye),v(pe,ue,Xt+1,Et,Ye)}}d.prototype.rotateLeft=function(pe){var ue=pe.right;ue&&(pe.right=ue.left,ue.left&&(ue.left.parent=pe),ue.parent=pe.parent),pe.parent?pe===pe.parent.left?pe.parent.left=ue:pe.parent.right=ue:this._root=ue,ue&&(ue.left=pe),pe.parent=ue},d.prototype.rotateRight=function(pe){var ue=pe.left;ue&&(pe.left=ue.right,ue.right&&(ue.right.parent=pe),ue.parent=pe.parent),pe.parent?pe===pe.parent.left?pe.parent.left=ue:pe.parent.right=ue:this._root=ue,ue&&(ue.right=pe),pe.parent=ue},d.prototype._splay=function(pe){for(;pe.parent;){var ue=pe.parent;ue.parent?ue.left===pe&&ue.parent.left===ue?(this.rotateRight(ue.parent),this.rotateRight(ue)):ue.right===pe&&ue.parent.right===ue?(this.rotateLeft(ue.parent),this.rotateLeft(ue)):ue.left===pe&&ue.parent.right===ue?(this.rotateRight(ue),this.rotateLeft(ue)):(this.rotateLeft(ue),this.rotateRight(ue)):ue.left===pe?this.rotateRight(ue):this.rotateLeft(ue)}},d.prototype.splay=function(pe){for(var ue,Xe,Et,Ye,Dt;pe.parent;)(Xe=(ue=pe.parent).parent)&&Xe.parent?((Et=Xe.parent).left===Xe?Et.left=pe:Et.right=pe,pe.parent=Et):(pe.parent=null,this._root=pe),Ye=pe.left,Dt=pe.right,pe===ue.left?(Xe&&(Xe.left===ue?(ue.right?(Xe.left=ue.right,Xe.left.parent=Xe):Xe.left=null,ue.right=Xe,Xe.parent=ue):(Ye?(Xe.right=Ye,Ye.parent=Xe):Xe.right=null,pe.left=Xe,Xe.parent=pe)),Dt?(ue.left=Dt,Dt.parent=ue):ue.left=null,pe.right=ue,ue.parent=pe):(Xe&&(Xe.right===ue?(ue.left?(Xe.right=ue.left,Xe.right.parent=Xe):Xe.right=null,ue.left=Xe,Xe.parent=ue):(Dt?(Xe.left=Dt,Dt.parent=Xe):Xe.left=null,pe.right=Xe,Xe.parent=pe)),Ye?(ue.right=Ye,Ye.parent=ue):ue.right=null,pe.left=ue,ue.parent=pe)},d.prototype.replace=function(pe,ue){pe.parent?pe===pe.parent.left?pe.parent.left=ue:pe.parent.right=ue:this._root=ue,ue&&(ue.parent=pe.parent)},d.prototype.minNode=function(pe){if(pe===void 0&&(pe=this._root),pe)for(;pe.left;)pe=pe.left;return pe},d.prototype.maxNode=function(pe){if(pe===void 0&&(pe=this._root),pe)for(;pe.right;)pe=pe.right;return pe},d.prototype.insert=function(pe,ue){var Xe=this._root,Et=null,Ye=this._compare;if(this._noDuplicates)for(;Xe;){if(Et=Xe,Ye(Xe.key,pe)===0)return;Xe=Ye(Xe.key,pe)<0?Xe.right:Xe.left}else for(;Xe;)Et=Xe,Xe=Ye(Xe.key,pe)<0?Xe.right:Xe.left;return Xe={key:pe,data:ue,left:null,right:null,parent:Et},Et?Ye(Et.key,Xe.key)<0?Et.right=Xe:Et.left=Xe:this._root=Xe,this.splay(Xe),this._size++,Xe},d.prototype.find=function(pe){for(var ue=this._root,Xe=this._compare;ue;){var Et=Xe(ue.key,pe);if(Et<0)ue=ue.right;else{if(!(Et>0))return ue;ue=ue.left}}return null},d.prototype.contains=function(pe){for(var ue=this._root,Xe=this._compare;ue;){var Et=Xe(pe,ue.key);if(Et===0)return!0;ue=Et<0?ue.left:ue.right}return!1},d.prototype.remove=function(pe){var ue=this.find(pe);if(!ue)return!1;if(this.splay(ue),ue.left)if(ue.right){var Xe=this.minNode(ue.right);Xe.parent!==ue&&(this.replace(Xe,Xe.right),Xe.right=ue.right,Xe.right.parent=Xe),this.replace(ue,Xe),Xe.left=ue.left,Xe.left.parent=Xe}else this.replace(ue,ue.left);else this.replace(ue,ue.right);return this._size--,!0},d.prototype.removeNode=function(pe){if(!pe)return!1;if(this.splay(pe),pe.left)if(pe.right){var ue=this.minNode(pe.right);ue.parent!==pe&&(this.replace(ue,ue.right),ue.right=pe.right,ue.right.parent=ue),this.replace(pe,ue),ue.left=pe.left,ue.left.parent=ue}else this.replace(pe,pe.left);else this.replace(pe,pe.right);return this._size--,!0},d.prototype.erase=function(pe){var ue=this.find(pe);if(ue){this.splay(ue);var Xe=ue.left,Et=ue.right,Ye=null;Xe&&(Xe.parent=null,Ye=this.maxNode(Xe),this.splay(Ye),this._root=Ye),Et&&(Xe?Ye.right=Et:this._root=Et,Et.parent=Ye),this._size--}},d.prototype.pop=function(){var pe=this._root,ue=null;if(pe){for(;pe.left;)pe=pe.left;ue={key:pe.key,data:pe.data},this.remove(pe.key)}return ue},d.prototype.next=function(pe){var ue=pe;if(ue)if(ue.right)for(ue=ue.right;ue&&ue.left;)ue=ue.left;else for(ue=pe.parent;ue&&ue.right===pe;)pe=ue,ue=ue.parent;return ue},d.prototype.prev=function(pe){var ue=pe;if(ue)if(ue.left)for(ue=ue.left;ue&&ue.right;)ue=ue.right;else for(ue=pe.parent;ue&&ue.left===pe;)pe=ue,ue=ue.parent;return ue},d.prototype.forEach=function(pe){for(var ue=this._root,Xe=[],Et=!1,Ye=0;!Et;)ue?(Xe.push(ue),ue=ue.left):Xe.length>0?(pe(ue=Xe.pop(),Ye++),ue=ue.right):Et=!0;return this},d.prototype.range=function(pe,ue,Xe,Et){for(var Ye=[],Dt=this._compare,Yt=this._root;Ye.length!==0||Yt;)if(Yt)Ye.push(Yt),Yt=Yt.left;else{if(Dt((Yt=Ye.pop()).key,ue)>0)break;if(Dt(Yt.key,pe)>=0&&Xe.call(Et,Yt))return this;Yt=Yt.right}return this},d.prototype.keys=function(){for(var pe=this._root,ue=[],Xe=[],Et=!1;!Et;)pe?(ue.push(pe),pe=pe.left):ue.length>0?(pe=ue.pop(),Xe.push(pe.key),pe=pe.right):Et=!0;return Xe},d.prototype.values=function(){for(var pe=this._root,ue=[],Xe=[],Et=!1;!Et;)pe?(ue.push(pe),pe=pe.left):ue.length>0?(pe=ue.pop(),Xe.push(pe.data),pe=pe.right):Et=!0;return Xe},d.prototype.at=function(pe){for(var ue=this._root,Xe=[],Et=!1,Ye=0;!Et;)if(ue)Xe.push(ue),ue=ue.left;else if(Xe.length>0){if(ue=Xe.pop(),Ye===pe)return ue;Ye++,ue=ue.right}else Et=!0;return null},d.prototype.load=function(pe,ue,Xe){if(pe===void 0&&(pe=[]),ue===void 0&&(ue=[]),Xe===void 0&&(Xe=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var Et=pe.length;return Xe&&v(pe,ue,0,Et-1,this._compare),this._root=g(null,pe,ue,0,Et),this._size=Et,this},d.prototype.min=function(){var pe=this.minNode(this._root);return pe?pe.key:null},d.prototype.max=function(){var pe=this.maxNode(this._root);return pe?pe.key:null},d.prototype.isEmpty=function(){return this._root===null},m.size.get=function(){return this._size},d.createTree=function(pe,ue,Xe,Et,Ye){return new d(Xe,Ye).load(pe,ue,Et)},Object.defineProperties(d.prototype,m);var b=0,w=1,S=2,D=3,I=0,R=1,k=2,B=3;function U(pe,ue,Xe){ue===null?(pe.inOut=!1,pe.otherInOut=!0):(pe.isSubject===ue.isSubject?(pe.inOut=!ue.inOut,pe.otherInOut=ue.otherInOut):(pe.inOut=!ue.otherInOut,pe.otherInOut=ue.isVertical()?!ue.inOut:ue.inOut),ue&&(pe.prevInResult=!G(ue,Xe)||ue.isVertical()?ue.prevInResult:ue));var Et=G(pe,Xe);pe.resultTransition=Et?(function(Ye,Dt){var Yt,Xt=!Ye.inOut,En=!Ye.otherInOut;switch(Dt){case I:Yt=Xt&&En;break;case R:Yt=Xt||En;break;case B:Yt=Xt^En;break;case k:Yt=Ye.isSubject?Xt&&!En:En&&!Xt}return Yt?1:-1})(pe,Xe):0}function G(pe,ue){switch(pe.type){case b:switch(ue){case I:return!pe.otherInOut;case R:return pe.otherInOut;case k:return pe.isSubject&&pe.otherInOut||!pe.isSubject&&!pe.otherInOut;case B:return!0}break;case S:return ue===I||ue===R;case D:return ue===k;case w:return!1}return!1}var J=function(pe,ue,Xe,Et,Ye){this.left=ue,this.point=pe,this.otherEvent=Xe,this.isSubject=Et,this.type=Ye||b,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},ee={inResult:{configurable:!0}};function se(pe,ue){return pe[0]===ue[0]&&pe[1]===ue[1]}J.prototype.isBelow=function(pe){var ue=this.point,Xe=this.otherEvent.point;return this.left?(ue[0]-pe[0])*(Xe[1]-pe[1])-(Xe[0]-pe[0])*(ue[1]-pe[1])>0:(Xe[0]-pe[0])*(ue[1]-pe[1])-(ue[0]-pe[0])*(Xe[1]-pe[1])>0},J.prototype.isAbove=function(pe){return!this.isBelow(pe)},J.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},ee.inResult.get=function(){return this.resultTransition!==0},J.prototype.clone=function(){var pe=new J(this.point,this.left,this.otherEvent,this.isSubject,this.type);return pe.contourId=this.contourId,pe.resultTransition=this.resultTransition,pe.prevInResult=this.prevInResult,pe.isExteriorRing=this.isExteriorRing,pe.inOut=this.inOut,pe.otherInOut=this.otherInOut,pe},Object.defineProperties(J.prototype,ee);var _e=11102230246251565e-32,fe=134217729,we=(3+8*_e)*_e;function Ee(pe,ue,Xe,Et,Ye){var Dt,Yt,Xt,En,cn=ue[0],qt=Et[0],ui=0,$i=0;qt>cn==qt>-cn?(Dt=cn,cn=ue[++ui]):(Dt=qt,qt=Et[++$i]);var hn=0;if(ui<pe&&$i<Xe)for(qt>cn==qt>-cn?(Xt=Dt-((Yt=cn+Dt)-cn),cn=ue[++ui]):(Xt=Dt-((Yt=qt+Dt)-qt),qt=Et[++$i]),Dt=Yt,Xt!==0&&(Ye[hn++]=Xt);ui<pe&&$i<Xe;)qt>cn==qt>-cn?(Xt=Dt-((Yt=Dt+cn)-(En=Yt-Dt))+(cn-En),cn=ue[++ui]):(Xt=Dt-((Yt=Dt+qt)-(En=Yt-Dt))+(qt-En),qt=Et[++$i]),Dt=Yt,Xt!==0&&(Ye[hn++]=Xt);for(;ui<pe;)Xt=Dt-((Yt=Dt+cn)-(En=Yt-Dt))+(cn-En),cn=ue[++ui],Dt=Yt,Xt!==0&&(Ye[hn++]=Xt);for(;$i<Xe;)Xt=Dt-((Yt=Dt+qt)-(En=Yt-Dt))+(qt-En),qt=Et[++$i],Dt=Yt,Xt!==0&&(Ye[hn++]=Xt);return Dt===0&&hn!==0||(Ye[hn++]=Dt),hn}function Se(pe){return new Float64Array(pe)}var We=33306690738754716e-32,Fe=22204460492503146e-32,Ze=11093356479670487e-47,Qe=Se(4),rt=Se(8),vt=Se(12),dt=Se(16),et=Se(4);function ut(pe,ue,Xe){var Et=(function(Ye,Dt,Yt,Xt,En,cn){var qt=(Dt-cn)*(Yt-En),ui=(Ye-En)*(Xt-cn),$i=qt-ui;if(qt===0||ui===0||qt>0!=ui>0)return $i;var hn=Math.abs(qt+ui);return Math.abs($i)>=We*hn?$i:-(function(ni,Gi,Ti,Ir,dr,nr,Oi){var mi,Tn,gi,ir,un,oi,hr,Nr,Jr,wo,fr,po,La,mo,al,Es,Kl,Na,ll=ni-dr,Ts=Ti-dr,cl=Gi-nr,Jl=Ir-nr;Qe[0]=(al=(Nr=ll-(hr=(oi=fe*ll)-(oi-ll)))*(wo=Jl-(Jr=(oi=fe*Jl)-(oi-Jl)))-((mo=ll*Jl)-hr*Jr-Nr*Jr-hr*wo))-((fr=al-(Kl=(Nr=cl-(hr=(oi=fe*cl)-(oi-cl)))*(wo=Ts-(Jr=(oi=fe*Ts)-(oi-Ts)))-((Es=cl*Ts)-hr*Jr-Nr*Jr-hr*wo)))+(un=al-fr))+(un-Kl),Qe[1]=(La=mo-((po=mo+fr)-(un=po-mo))+(fr-un))-((fr=La-Es)+(un=La-fr))+(un-Es),Qe[2]=po-((Na=po+fr)-(un=Na-po))+(fr-un),Qe[3]=Na;var Ko=(function(Qf,md){for(var uC=md[0],q_=1;q_<4;q_++)uC+=md[q_];return uC})(0,Qe),Qs=Fe*Oi;if(Ko>=Qs||-Ko>=Qs||(mi=ni-(ll+(un=ni-ll))+(un-dr),gi=Ti-(Ts+(un=Ti-Ts))+(un-dr),Tn=Gi-(cl+(un=Gi-cl))+(un-nr),ir=Ir-(Jl+(un=Ir-Jl))+(un-nr),mi===0&&Tn===0&&gi===0&&ir===0)||(Qs=Ze*Oi+we*Math.abs(Ko),(Ko+=ll*ir+Jl*mi-(cl*gi+Ts*Tn))>=Qs||-Ko>=Qs))return Ko;et[0]=(al=(Nr=mi-(hr=(oi=fe*mi)-(oi-mi)))*(wo=Jl-(Jr=(oi=fe*Jl)-(oi-Jl)))-((mo=mi*Jl)-hr*Jr-Nr*Jr-hr*wo))-((fr=al-(Kl=(Nr=Tn-(hr=(oi=fe*Tn)-(oi-Tn)))*(wo=Ts-(Jr=(oi=fe*Ts)-(oi-Ts)))-((Es=Tn*Ts)-hr*Jr-Nr*Jr-hr*wo)))+(un=al-fr))+(un-Kl),et[1]=(La=mo-((po=mo+fr)-(un=po-mo))+(fr-un))-((fr=La-Es)+(un=La-fr))+(un-Es),et[2]=po-((Na=po+fr)-(un=Na-po))+(fr-un),et[3]=Na;var pd=Ee(4,Qe,4,et,rt);et[0]=(al=(Nr=ll-(hr=(oi=fe*ll)-(oi-ll)))*(wo=ir-(Jr=(oi=fe*ir)-(oi-ir)))-((mo=ll*ir)-hr*Jr-Nr*Jr-hr*wo))-((fr=al-(Kl=(Nr=cl-(hr=(oi=fe*cl)-(oi-cl)))*(wo=gi-(Jr=(oi=fe*gi)-(oi-gi)))-((Es=cl*gi)-hr*Jr-Nr*Jr-hr*wo)))+(un=al-fr))+(un-Kl),et[1]=(La=mo-((po=mo+fr)-(un=po-mo))+(fr-un))-((fr=La-Es)+(un=La-fr))+(un-Es),et[2]=po-((Na=po+fr)-(un=Na-po))+(fr-un),et[3]=Na;var Jf=Ee(pd,rt,4,et,vt);et[0]=(al=(Nr=mi-(hr=(oi=fe*mi)-(oi-mi)))*(wo=ir-(Jr=(oi=fe*ir)-(oi-ir)))-((mo=mi*ir)-hr*Jr-Nr*Jr-hr*wo))-((fr=al-(Kl=(Nr=Tn-(hr=(oi=fe*Tn)-(oi-Tn)))*(wo=gi-(Jr=(oi=fe*gi)-(oi-gi)))-((Es=Tn*gi)-hr*Jr-Nr*Jr-hr*wo)))+(un=al-fr))+(un-Kl),et[1]=(La=mo-((po=mo+fr)-(un=po-mo))+(fr-un))-((fr=La-Es)+(un=La-fr))+(un-Es),et[2]=po-((Na=po+fr)-(un=Na-po))+(fr-un),et[3]=Na;var G_=Ee(Jf,vt,4,et,dt);return dt[G_-1]})(Ye,Dt,Yt,Xt,En,cn,hn)})(pe[0],pe[1],ue[0],ue[1],Xe[0],Xe[1]);return Et>0?-1:Et<0?1:0}function Ge(pe,ue){var Xe=pe.point,Et=ue.point;return Xe[0]>Et[0]?1:Xe[0]<Et[0]?-1:Xe[1]!==Et[1]?Xe[1]>Et[1]?1:-1:(function(Ye,Dt,Yt,Xt){return Ye.left!==Dt.left?Ye.left?1:-1:ut(Yt,Ye.otherEvent.point,Dt.otherEvent.point)!==0?Ye.isBelow(Dt.otherEvent.point)?-1:1:!Ye.isSubject&&Dt.isSubject?1:-1})(pe,ue,Xe)}function $e(pe,ue,Xe){var Et=new J(ue,!1,pe,pe.isSubject),Ye=new J(ue,!0,pe.otherEvent,pe.isSubject);return se(pe.point,pe.otherEvent.point)&&console.warn("what is that, a collapsed segment?",pe),Et.contourId=Ye.contourId=pe.contourId,Ge(Ye,pe.otherEvent)>0&&(pe.otherEvent.left=!0,Ye.left=!1),pe.otherEvent.otherEvent=Ye,pe.otherEvent=Et,Xe.push(Ye),Xe.push(Et),Xe}function lt(pe,ue){return pe[0]*ue[1]-pe[1]*ue[0]}function gt(pe,ue){return pe[0]*ue[0]+pe[1]*ue[1]}function it(pe,ue,Xe){var Et=(function(En,cn,qt,ui,$i){var hn=[cn[0]-En[0],cn[1]-En[1]],ni=[ui[0]-qt[0],ui[1]-qt[1]];function Gi(oi,hr,Nr){return[oi[0]+hr*Nr[0],oi[1]+hr*Nr[1]]}var Ti=[qt[0]-En[0],qt[1]-En[1]],Ir=lt(hn,ni),dr=Ir*Ir,nr=gt(hn,hn);if(dr>0){var Oi=lt(Ti,ni)/Ir;if(Oi<0||Oi>1)return null;var mi=lt(Ti,hn)/Ir;return mi<0||mi>1?null:Oi===0||Oi===1?[Gi(En,Oi,hn)]:mi===0||mi===1?[Gi(qt,mi,ni)]:[Gi(En,Oi,hn)]}if((dr=(Ir=lt(Ti,hn))*Ir)>0)return null;var Tn=gt(hn,Ti)/nr,gi=Tn+gt(hn,ni)/nr,ir=Math.min(Tn,gi),un=Math.max(Tn,gi);return ir<=1&&un>=0?ir===1?[Gi(En,ir>0?ir:0,hn)]:un===0?[Gi(En,un<1?un:1,hn)]:[Gi(En,ir>0?ir:0,hn),Gi(En,un<1?un:1,hn)]:null})(pe.point,pe.otherEvent.point,ue.point,ue.otherEvent.point),Ye=Et?Et.length:0;if(Ye===0||Ye===1&&(se(pe.point,ue.point)||se(pe.otherEvent.point,ue.otherEvent.point))||Ye===2&&pe.isSubject===ue.isSubject)return 0;if(Ye===1)return se(pe.point,Et[0])||se(pe.otherEvent.point,Et[0])||$e(pe,Et[0],Xe),se(ue.point,Et[0])||se(ue.otherEvent.point,Et[0])||$e(ue,Et[0],Xe),1;var Dt=[],Yt=!1,Xt=!1;return se(pe.point,ue.point)?Yt=!0:Ge(pe,ue)===1?Dt.push(ue,pe):Dt.push(pe,ue),se(pe.otherEvent.point,ue.otherEvent.point)?Xt=!0:Ge(pe.otherEvent,ue.otherEvent)===1?Dt.push(ue.otherEvent,pe.otherEvent):Dt.push(pe.otherEvent,ue.otherEvent),Yt&&Xt||Yt?(ue.type=w,pe.type=ue.inOut===pe.inOut?S:D,Yt&&!Xt&&$e(Dt[1].otherEvent,Dt[0].point,Xe),2):Xt?($e(Dt[0],Dt[1].point,Xe),3):Dt[0]!==Dt[3].otherEvent?($e(Dt[0],Dt[1].point,Xe),$e(Dt[1],Dt[2].point,Xe),3):($e(Dt[0],Dt[1].point,Xe),$e(Dt[3].otherEvent,Dt[2].point,Xe),3)}function Nt(pe,ue){if(pe===ue)return 0;if(ut(pe.point,pe.otherEvent.point,ue.point)!==0||ut(pe.point,pe.otherEvent.point,ue.otherEvent.point)!==0)return se(pe.point,ue.point)?pe.isBelow(ue.otherEvent.point)?-1:1:pe.point[0]===ue.point[0]?pe.point[1]<ue.point[1]?-1:1:Ge(pe,ue)===1?ue.isAbove(pe.point)?-1:1:pe.isBelow(ue.point)?-1:1;if(pe.isSubject!==ue.isSubject)return pe.isSubject?-1:1;var Xe=pe.point,Et=ue.point;return Xe[0]===Et[0]&&Xe[1]===Et[1]?(Xe=pe.otherEvent.point)[0]===(Et=ue.otherEvent.point)[0]&&Xe[1]===Et[1]?0:pe.contourId>ue.contourId?1:-1:Ge(pe,ue)===1?1:-1}var Ut=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function Pt(pe,ue,Xe,Et){var Ye,Dt=pe+1,Yt=ue[pe].point,Xt=ue.length;for(Dt<Xt&&(Ye=ue[Dt].point);Dt<Xt&&Ye[0]===Yt[0]&&Ye[1]===Yt[1];){if(!Xe[Dt])return Dt;++Dt<Xt&&(Ye=ue[Dt].point)}for(Dt=pe-1;Xe[Dt]&&Dt>Et;)Dt--;return Dt}Ut.prototype.isExterior=function(){return this.holeOf==null};var St=It,yn=It;function It(pe,ue){if(!(this instanceof It))return new It(pe,ue);if(this.data=pe||[],this.length=this.data.length,this.compare=ue||rn,this.length>0)for(var Xe=(this.length>>1)-1;Xe>=0;Xe--)this._down(Xe)}function rn(pe,ue){return pe<ue?-1:pe>ue?1:0}It.prototype={push:function(pe){this.data.push(pe),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var pe=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),pe}},peek:function(){return this.data[0]},_up:function(pe){for(var ue=this.data,Xe=this.compare,Et=ue[pe];pe>0;){var Ye=pe-1>>1,Dt=ue[Ye];if(Xe(Et,Dt)>=0)break;ue[pe]=Dt,pe=Ye}ue[pe]=Et},_down:function(pe){for(var ue=this.data,Xe=this.compare,Et=this.length>>1,Ye=ue[pe];pe<Et;){var Dt=1+(pe<<1),Yt=Dt+1,Xt=ue[Dt];if(Yt<this.length&&Xe(ue[Yt],Xt)<0&&(Dt=Yt,Xt=ue[Yt]),Xe(Xt,Ye)>=0)break;ue[pe]=Xt,pe=Dt}ue[pe]=Ye}},St.default=yn;var xn=Math.max,Nn=Math.min,ri=0;function wn(pe,ue,Xe,Et,Ye,Dt){var Yt,Xt,En,cn,qt,ui;for(Yt=0,Xt=pe.length-1;Yt<Xt;Yt++)if(cn=pe[Yt+1],qt=new J(En=pe[Yt],!1,void 0,ue),ui=new J(cn,!1,qt,ue),qt.otherEvent=ui,En[0]!==cn[0]||En[1]!==cn[1]){qt.contourId=ui.contourId=Xe,Dt||(qt.isExteriorRing=!1,ui.isExteriorRing=!1),Ge(qt,ui)>0?ui.left=!0:qt.left=!0;var $i=En[0],hn=En[1];Ye[0]=Nn(Ye[0],$i),Ye[1]=Nn(Ye[1],hn),Ye[2]=xn(Ye[2],$i),Ye[3]=xn(Ye[3],hn),Et.push(qt),Et.push(ui)}}var fi=[];function pi(pe,ue,Xe){typeof pe[0][0][0]=="number"&&(pe=[pe]),typeof ue[0][0][0]=="number"&&(ue=[ue]);var Et=(function(hn,ni,Gi){var Ti=null;return hn.length*ni.length==0&&(Gi===I?Ti=fi:Gi===k?Ti=hn:Gi!==R&&Gi!==B||(Ti=hn.length===0?ni:hn)),Ti})(pe,ue,Xe);if(Et)return Et===fi?null:Et;var Ye=[1/0,1/0,-1/0,-1/0],Dt=[1/0,1/0,-1/0,-1/0],Yt=(function(hn,ni,Gi,Ti,Ir){var dr,nr,Oi,mi,Tn,gi,ir=new St(null,Ge);for(Oi=0,mi=hn.length;Oi<mi;Oi++)for(Tn=0,gi=(dr=hn[Oi]).length;Tn<gi;Tn++)(nr=Tn===0)&&ri++,wn(dr[Tn],!0,ri,ir,Gi,nr);for(Oi=0,mi=ni.length;Oi<mi;Oi++)for(Tn=0,gi=(dr=ni[Oi]).length;Tn<gi;Tn++)nr=Tn===0,Ir===k&&(nr=!1),nr&&ri++,wn(dr[Tn],!1,ri,ir,Ti,nr);return ir})(pe,ue,Ye,Dt,Xe);if(Et=(function(hn,ni,Gi,Ti,Ir){var dr=null;return(Gi[0]>Ti[2]||Ti[0]>Gi[2]||Gi[1]>Ti[3]||Ti[1]>Gi[3])&&(Ir===I?dr=fi:Ir===k?dr=hn:Ir!==R&&Ir!==B||(dr=hn.concat(ni))),dr})(pe,ue,Ye,Dt,Xe))return Et===fi?null:Et;for(var Xt=(function(hn){var ni,Gi,Ti=(function(Oi){var mi,Tn,gi,ir,un=[];for(Tn=0,gi=Oi.length;Tn<gi;Tn++)((mi=Oi[Tn]).left&&mi.inResult||!mi.left&&mi.otherEvent.inResult)&&un.push(mi);for(var oi=!1;!oi;)for(oi=!0,Tn=0,gi=un.length;Tn<gi;Tn++)Tn+1<gi&&Ge(un[Tn],un[Tn+1])===1&&(ir=un[Tn],un[Tn]=un[Tn+1],un[Tn+1]=ir,oi=!1);for(Tn=0,gi=un.length;Tn<gi;Tn++)(mi=un[Tn]).otherPos=Tn;for(Tn=0,gi=un.length;Tn<gi;Tn++)(mi=un[Tn]).left||(ir=mi.otherPos,mi.otherPos=mi.otherEvent.otherPos,mi.otherEvent.otherPos=ir);return un})(hn),Ir={},dr=[],nr=function(){if(!Ir[ni]){var Oi=dr.length,mi=(function(un,oi,hr){var Nr=new Ut;if(un.prevInResult!=null){var Jr=un.prevInResult,wo=Jr.outputContourId;if(Jr.resultTransition>0){var fr=oi[wo];if(fr.holeOf!=null){var po=fr.holeOf;oi[po].holeIds.push(hr),Nr.holeOf=po,Nr.depth=oi[wo].depth}else oi[wo].holeIds.push(hr),Nr.holeOf=wo,Nr.depth=oi[wo].depth+1}else Nr.holeOf=null,Nr.depth=oi[wo].depth}else Nr.holeOf=null,Nr.depth=0;return Nr})(Ti[ni],dr,Oi),Tn=function(un){Ir[un]=!0,un<Ti.length&&Ti[un]&&(Ti[un].outputContourId=Oi)},gi=ni,ir=ni;for(mi.points.push(Ti[ni].point);Tn(gi),Tn(gi=Ti[gi].otherPos),mi.points.push(Ti[gi].point),!((gi=Pt(gi,Ti,Ir,ir))==ir||gi>=Ti.length)&&Ti[gi];);dr.push(mi)}};for(ni=0,Gi=Ti.length;ni<Gi;ni++)nr();return dr})((function(hn,ni,Gi,Ti,Ir,dr){for(var nr,Oi,mi,Tn=new d(Nt),gi=[],ir=Math.min(Ti[2],Ir[2]);hn.length!==0;){var un=hn.pop();if(gi.push(un),dr===I&&un.point[0]>ir||dr===k&&un.point[0]>Ti[2])break;if(un.left){Oi=nr=Tn.insert(un),nr=nr!==(mi=Tn.minNode())?Tn.prev(nr):null,Oi=Tn.next(Oi);var oi=nr?nr.key:null;if(U(un,oi,dr),Oi&&it(un,Oi.key,hn)===2&&(U(un,oi,dr),U(Oi.key,un,dr)),nr&&it(nr.key,un,hn)===2){var hr=nr;U(oi,(hr=hr!==mi?Tn.prev(hr):null)?hr.key:null,dr),U(un,oi,dr)}}else Oi=nr=Tn.find(un=un.otherEvent),nr&&Oi&&(nr=nr!==mi?Tn.prev(nr):null,Oi=Tn.next(Oi),Tn.remove(un),Oi&&nr&&it(nr.key,Oi.key,hn))}return gi})(Yt,0,0,Ye,Dt,Xe)),En=[],cn=0;cn<Xt.length;cn++){var qt=Xt[cn];if(qt.isExterior()){for(var ui=[qt.points],$i=0;$i<qt.holeIds.length;$i++)ui.push(Xt[qt.holeIds[$i]].points);En.push(ui)}}return En}var xr={UNION:R,DIFFERENCE:k,INTERSECTION:I,XOR:B};s.diff=function(pe,ue){return pi(pe,ue,k)},s.intersection=function(pe,ue){return pi(pe,ue,I)},s.operations=xr,s.union=function(pe,ue){return pi(pe,ue,R)},s.xor=function(pe,ue){return pi(pe,ue,B)},Object.defineProperty(s,"__esModule",{value:!0})})(e)})(0,eF.exports)),eF.exports);function bw(a,e,s,u){let d=[],m=u===0?(g,v,b,w,S,D)=>{g.push(new ct(D,b+(D-v)/(w-v)*(S-b)))}:(g,v,b,w,S,D)=>{g.push(new ct(v+(D-b)/(S-b)*(w-v),D))};for(let g of a){let v=[];for(let b of g){if(b.length<=2)continue;let w=[];for(let I=0;I<b.length-1;I++){let R=b[I].x,k=b[I].y,B=b[I+1].x,U=b[I+1].y,G=u===0?R:k,J=u===0?B:U;G<e?J>e&&m(w,R,k,B,U,e):G>s?J<s&&m(w,R,k,B,U,s):w.push(b[I]),J<e&&G>=e&&m(w,R,k,B,U,e),J>s&&G<=s&&m(w,R,k,B,U,s)}let S=b[b.length-1],D=u===0?S.x:S.y;D>=e&&D<=s&&w.push(S),w.length&&(S=w[w.length-1],w[0].x===S.x&&w[0].y===S.y||w.push(w[0]),v.push(w))}v.length&&d.push(v)}return d}function aG(a,e){let s=dI(a),u=dI([e]),d=tF.intersection(s,u);return d==null?[]:nF(d)}function lG(a,e){let u=dI(a,65536),d=[];for(;e.valid();e.next()){let[m,g]=e.get(),v=m.x*65536,b=m.y*65536,w=g.x*65536,S=g.y*65536,D=w-v,I=S-b,R=Math.hypot(D,I);if(R===0)continue;let k=Math.trunc(I/R*3),B=-Math.trunc(D/R*3);d.push([[[v,b],[w,S],[w+k,S+B],[v+k,b+B],[v,b]]])}return d.length>0&&(u=tF.diff(u,d)),nF(u,1/65536)}function dI(a,e=1){return[a.map(s=>s.map(u=>[u.x*e,u.y*e]))]}function nF(a,e=1){return a.map(s=>s.map((u,d)=>{let m=u.map(g=>new ct(g[0]*e,g[1]*e).round());return d>0&&m.reverse(),m}))}class hI{constructor(e,s){this.layoutVertexArray=new _a,this.indexArray=new mr,this.lineIndexArray=new Sl,this.triangleSegments=new wr,this.lineSegments=new wr,this.programConfigurations=new Xl(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,s&&(this.elevatedLayoutVertexArray=new ru)}update(e,s,u,d,m,g,v,b){this.programConfigurations.updatePaintArrays(e,s,m,u,d,g,v,b)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,q$.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,W$.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,s,u,d,m,g,v){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,u,d,m,g,void 0,v)}}class fI{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new hI(e,!1),this.elevationBufferData=new hI(e,!0),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,s){}updateAppearances(e,s,u,d){}populate(e,s,u,d){this.hasPattern=cI("fill",this.layers,this.pixelRatio,s);let m=this.layers[0].layout.get("fill-sort-key"),g=[];for(let{feature:v,id:b,index:w,sourceLayerIndex:S}of e){let D=this.layers[0]._featureFilter.needGeometry,I=Ue(v,D);if(!this.layers[0]._featureFilter.filter(new or(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),I,u))continue;let R=m?m.evaluate(I,{},u,s.availableImages):void 0,k={id:b,properties:v.properties,type:v.type,sourceLayerIndex:S,index:w,geometry:D?I.geometry:Je(v,u,d),patterns:{},sortKey:R};g.push(k)}m&&g.sort((v,b)=>v.sortKey-b.sortKey);for(let v of g){let{geometry:b,index:w,sourceLayerIndex:S}=v;if(this.hasPattern){let D=uI("fill",this.layers,v,this.zoom,this.pixelRatio,s);this.patternFeatures.push(D)}else this.addFeature(v,b,w,u,{},s.availableImages,s.brightness,s.elevationFeatures);s.featureIndex.insert(e[w].feature,b,w,S,this.index)}}update(e,s,u,d,m,g,v){this.bufferData.update(e,s,u,d,m,g,v,this.worldview),this.elevationBufferData.update(e,s,u,d,m,g,v,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,s,u,d,m,g,v,this.worldview)}addFeatures(e,s,u,d,m,g){for(let v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,s,u,d,g,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,s,u,d,m,g=[],v,b){let w=Fy(s,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,w,d,u,b):this.addGeometry(w,this.bufferData),this.bufferData.populatePaintArrays(e,u,m,g,d,v,this.worldview),this.elevationBufferData.populatePaintArrays(e,u,m,g,d,v,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,s,u,d,m){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(s,u,d,m,this.worldview))}addElevatedRoadFeature(e,s,u,d,m){let g=new Array,v=vn.getElevationFeature(e,m);if(!v)return void this.addGeometry(s,this.bufferData);{let w=this.clipPolygonsToTile(s,1);w.length>0&&g.push({polygons:w,elevationFeature:v,elevationTileID:u})}let b={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},u),featureIndex:d};for(let w of g)if(w.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new ol(w.elevationTileID,this.layers,this.zoom,this.lut));let D=w.elevationFeature.isTunnel(),I=0;e.properties.hasOwnProperty(Lt)&&(I=+e.properties[Lt]);for(let R of w.polygons)this.elevatedStructures.addPortalCandidates(w.elevationFeature.id,R,D,w.elevationFeature,I)}w.elevationFeature.constantHeight==null&&(w.polygons=this.prepareElevatedPolygons(w.polygons,w.elevationFeature,w.elevationTileID));let S=new ii(u,w.elevationTileID);this.addElevatedGeometry(w.polygons,S,w.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,d,b)}}addElevatedGeometry(e,s,u,d,m,g){let v={elevation:u,elevationSampler:s,bias:d,index:m,featureInfo:g},[b,w]=this.addGeometry(e,this.elevationBufferData,v);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:b,max:w}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,b),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,w))}addGeometry(e,s,u){let d=Number.POSITIVE_INFINITY,m=Number.NEGATIVE_INFINITY,g=null;u&&(g=u.elevationSampler.constantElevation(u.elevation,u.bias),g!=null&&(d=g,m=g));let v=(b,w,S)=>{if(u!=null)if(w.push(b),g!=null)s.elevatedLayoutVertexArray.emplaceBack(g),S.push(g);else{let D=u.elevationSampler.pointElevation(b,u.elevation,u.bias);s.elevatedLayoutVertexArray.emplaceBack(D),S.push(D),d=Math.min(d,D),m=Math.max(m,D)}};for(let b of e){let w=0;for(let ee of b)w+=ee.length;let S=s.triangleSegments.prepareSegment(w,s.layoutVertexArray,s.indexArray),D=S.vertexLength,I=[],R=[],k=[],B=[],U=[],G=s.layoutVertexArray.length;for(let ee of b){if(ee.length===0)continue;ee!==b[0]&&R.push(I.length/2);let se=s.lineSegments.prepareSegment(ee.length,s.layoutVertexArray,s.lineIndexArray),_e=se.vertexLength;u&&U.push(s.layoutVertexArray.length-G),v(ee[0],k,B),s.layoutVertexArray.emplaceBack(ee[0].x,ee[0].y),s.lineIndexArray.emplaceBack(_e+ee.length-1,_e),I.push(ee[0].x),I.push(ee[0].y);for(let fe=1;fe<ee.length;fe++)v(ee[fe],k,B),s.layoutVertexArray.emplaceBack(ee[fe].x,ee[fe].y),s.lineIndexArray.emplaceBack(_e+fe-1,_e+fe),I.push(ee[fe].x),I.push(ee[fe].y);se.vertexLength+=ee.length,se.primitiveLength+=ee.length}let J=S_(I,R);for(let ee=0;ee<J.length;ee+=3)s.indexArray.emplaceBack(D+J[ee],D+J[ee+1],D+J[ee+2]);if(J.length>0&&u&&this.elevationMode==="hd-road-base"){let ee=u.elevation.isTunnel(),se=u.elevation.safeArea,_e=this.elevatedStructures.addVertices(k,B);this.elevatedStructures.addTriangles(J,_e,ee);let fe=U.length;if(fe>0){for(let we=0;we<fe-1;we++)this.elevatedStructures.addRenderableRing(u.index,U[we]+_e,U[we+1]-U[we],ee,se,u.featureInfo);this.elevatedStructures.addRenderableRing(u.index,U[fe-1]+_e,k.length-U[fe-1],ee,se,u.featureInfo)}}S.vertexLength+=w,S.primitiveLength+=J.length/3}return[d,m]}prepareElevatedPolygons(e,s,u){let d=1/xe(u),m=[];for(let g of e){let v=lG(g,new cr(s,d));m.push(...v)}return m}clipPolygonsToTile(e,s){let u=-s,d=-s,m=yt+s,g=yt+s,v=0,b=[],w=[];for(;v<e.length;v++){let I=e[v],R=uh(I);(R.min.x>=u&&R.max.x<=m&&R.min.y>=d&&R.max.y<=g?b:w).push(I)}if(b.length===e.length)return e;let S=[new ct(u,d),new ct(m,d),new ct(m,g),new ct(u,g),new ct(u,d)],D=b;for(let I of w)D.push(...aG(I,S));return D}}let iF,rF,oF,sF;Bt(fI,"FillBucket",{omit:["layers","patternFeatures"]}),Bt(hI,"FillBufferData"),Bt(ol,"ElevatedStructures");class ww{constructor(e,s,u,d){if(this.triangleCount=s.length/3,this.min=new ct(0,0),this.max=new ct(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;let[m,g]=[e[0].clone(),e[0].clone()];for(let D=1;D<e.length;++D){let I=e[D];m.x=Math.min(m.x,I.x),m.y=Math.min(m.y,I.y),g.x=Math.max(g.x,I.x),g.y=Math.max(g.y,I.y)}if(d){let D=Math.ceil(Math.max(g.x-m.x,g.y-m.y)/d);u=Math.max(u,D)}if(u===0)return;this.min=m,this.max=g;let v=this.max.sub(this.min);v.x=Math.max(v.x,1),v.y=Math.max(v.y,1);let b=Math.max(v.x,v.y)/u;this.cellsX=Math.max(1,Math.ceil(v.x/b)),this.cellsY=Math.max(1,Math.ceil(v.y/b)),this.xScale=1/b,this.yScale=1/b;let w=[];for(let D=0;D<this.triangleCount;D++){let I=e[s[3*D+0]].sub(this.min),R=e[s[3*D+1]].sub(this.min),k=e[s[3*D+2]].sub(this.min),B=hd(Math.floor(Math.min(I.x,R.x,k.x)),this.xScale,this.cellsX),U=hd(Math.floor(Math.max(I.x,R.x,k.x)),this.xScale,this.cellsX),G=hd(Math.floor(Math.min(I.y,R.y,k.y)),this.yScale,this.cellsY),J=hd(Math.floor(Math.max(I.y,R.y,k.y)),this.yScale,this.cellsY),ee=new ct(0,0),se=new ct(0,0),_e=new ct(0,0),fe=new ct(0,0);for(let we=G;we<=J;++we){ee.y=se.y=we*b,_e.y=fe.y=(we+1)*b;for(let Ee=B;Ee<=U;++Ee)ee.x=_e.x=Ee*b,se.x=fe.x=(Ee+1)*b,(Kr(I,R,k,ee,se,fe)||Kr(I,R,k,ee,fe,_e))&&w.push({cellIdx:we*this.cellsX+Ee,triIdx:D})}}if(w.length===0)return;w.sort((D,I)=>D.cellIdx-I.cellIdx||D.triIdx-I.triIdx);let S=0;for(;S<w.length;){let D=w[S].cellIdx,I={start:this.payload.length,len:0};for(;S<w.length&&w[S].cellIdx===D;)++I.len,this.payload.push(w[S++].triIdx);this.cells[D]=I}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,s){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;let u=hd(e.x-this.min.x,this.xScale,this.cellsX),d=hd(e.y-this.min.y,this.yScale,this.cellsY),m=this.cells[d*this.cellsX+u];if(m){this._lazyInitLookup();for(let g=0;g<m.len;g++){let v=this.payload[m.start+g],b=Math.floor(v/8),w=1<<v%8;if(!(this.lookup[b]&w)&&(this.lookup[b]|=w,s.push(v),s.length===this.triangleCount))return}}}query(e,s,u){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>s.x||e.y>this.max.y||this.min.y>s.y)return;this._lazyInitLookup();let d=hd(e.x-this.min.x,this.xScale,this.cellsX),m=hd(s.x-this.min.x,this.xScale,this.cellsX),g=hd(e.y-this.min.y,this.yScale,this.cellsY),v=hd(s.y-this.min.y,this.yScale,this.cellsY);for(let b=g;b<=v;b++)for(let w=d;w<=m;w++){let S=this.cells[b*this.cellsX+w];if(S)for(let D=0;D<S.len;D++){let I=this.payload[S.start+D],R=Math.floor(I/8),k=1<<I%8;if(!(this.lookup[R]&k)&&(this.lookup[R]|=k,u.push(I),u.length===this.triangleCount))return}}}}function hd(a,e,s){return Math.max(0,Math.min(s-1,Math.floor(a*e)))}Bt(ww,"TriangleGridIndex");class aF{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.footprints=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,s){for(let u of this.footprints)s.push({footprint:u,id:e})}updateAppearances(e,s,u,d){}populate(e,s,u,d){let m=[];for(let{feature:g,id:v,index:b,sourceLayerIndex:w}of e){let S=this.layers[0]._featureFilter.needGeometry,D=Ue(g,S);if(!this.layers[0]._featureFilter.filter(new or(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),D,u))continue;let I={id:v,properties:g.properties,type:g.type,sourceLayerIndex:w,index:b,geometry:S?D.geometry:Je(g,u,d),patterns:{}};m.push(I)}for(let g of m){let{geometry:v,index:b,sourceLayerIndex:w}=g;this.addFeature(g,v,b,u,{},s.availableImages,s.brightness),s.featureIndex.insert(e[b].feature,v,b,w,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,s,u,d,m,g,v){}destroy(){}addFeature(e,s,u,d,m,g=[],v){for(let b of Fy(s,2)){let w=[],S=[],D=[],I=new ct(1/0,1/0),R=new ct(-1/0,-1/0);for(let U of b)if(U.length!==0){U!==b[0]&&D.push(S.length/2);for(let G=0;G<U.length;G++)S.push(U[G].x),S.push(U[G].y),w.push(U[G]),I.x=Math.min(I.x,U[G].x),I.y=Math.min(I.y,U[G].y),R.x=Math.max(R.x,U[G].x),R.y=Math.max(R.y,U[G].y)}let k=S_(S,D),B=new ww(w,k,8,256);this.footprints.push({vertices:w,indices:k,grid:B,min:I,max:R})}}}Bt(aF,"ClipBucket",{omit:["layers"]});let cG=Bn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),uG=Bn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),dG=Bn([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),hG=Bn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),fG=Bn([{name:"a_join_normal_inside",components:3,type:"Int16"}]),pG=Bn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),mG=Bn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:gG}=cG,Ly=Number.MAX_SAFE_INTEGER,lF=Ly-1;function cF(a,e,s,u){return a.order<e||a.order===Ly||!(a.clipMask&s)||(function(d,m){return m.length!==0&&m.find(g=>g===d)===void 0})(u,a.clipScope)}function Cw(a,e){return a.x-e.x||a.y-e.y}function uF(a,e){return Cw(a.min,e.min)===0&&Cw(a.max,e.max)===0}function pI(a,e){return!(a.min.x>e.max.x||a.max.x<e.min.x||a.min.y>e.max.y||a.max.y<e.min.y)}function Ew(a,e){if(a.length!==e.length)return!1;for(let s=0;s<a.length;s++)if(a[s].sourceId!==e[s].sourceId||!uF(a[s],e[s])||a[s].order!==e[s].order||a[s].clipMask!==e[s].clipMask||!Vl(a[s].clipScope,e[s].clipScope))return!1;return!0}function dF(a,e,s){let u=1/yt,d=1/(1<<s.canonical.z),m=(e.x*u+s.canonical.x)*d+s.wrap,g=(e.y*u+s.canonical.y)*d;return{min:new ct((a.x*u+s.canonical.x)*d+s.wrap,(a.y*u+s.canonical.y)*d),max:new ct(m,g)}}function _G(a,e,s){let u=1<<s.canonical.z,d=((e.x-s.wrap)*u-s.canonical.x)*yt,m=(e.y*u-s.canonical.y)*yt;return{min:new ct(((a.x-s.wrap)*u-s.canonical.x)*yt,(a.y*u-s.canonical.y)*yt),max:new ct(d,m)}}function mI(a,e,s,u,d,m,g){let v=a.indices,b=a.vertices,w=[];for(let S=u;S<u+d;S+=3){let D=e[s[S+0]+m],I=e[s[S+1]+m],R=e[s[S+2]+m],k=Math.min(D.x,I.x,R.x),B=Math.max(D.x,I.x,R.x),U=Math.min(D.y,I.y,R.y),G=Math.max(D.y,I.y,R.y);w.length=0,a.grid.query(new ct(k,U),new ct(B,G),w);for(let J=0;J<w.length;J++){let ee=w[J];if(Kr(b[v[3*ee+0]],b[v[3*ee+1]],b[v[3*ee+2]],D,I,R,g))return!0}}return!1}function hF(a,e,s,u){if(!a||!s)return!1;let d=a.vertices;if(!e.canonical.equals(u.canonical)||e.wrap!==u.wrap){if(s.vertices.length<a.vertices.length)return hF(s,u,a,e);let m=e.canonical,g=u.canonical,v=Math.pow(2,g.z-m.z);d=a.vertices.map(b=>new ct((b.x+m.x*yt)*v-g.x*yt,(b.y+m.y*yt)*v-g.y*yt))}return mI(s,d,a.indices,0,a.indices.length,0,0)}function fF(a,e,s,u){let d=Math.pow(2,u.z-s.z);return new ct((a+s.x*yt)*d-u.x*yt,(e+s.y*yt)*d-u.y*yt)}function gI(a,e){let s=[];e.grid.queryPoint(a,s);let u=e.indices,d=e.vertices;for(let m=0;m<s.length;m++){let g=s[m];if(jo([d[u[3*g+0]],d[u[3*g+1]],d[u[3*g+2]]],a))return!0}return!1}let _I=[new ct(0,0),new ct(yt,0),new ct(yt,yt),new ct(0,yt)];function pF(a,e){let s=[],u=[];if(!e||a.length<2)return[a];if(a.length===2)return qr(a[0],a[1],_I)?[a]:[];for(let d=0;d<a.length+2;d++){let m=a[d%a.length],g=a[(d+1)%a.length],v=qr(d===0?a[a.length-1]:a[(d-1)%a.length],m,_I),b=qr(m,g,_I),w=v||b;w&&u.push(m),w&&b||u.length>0&&(u.length>1&&s.push(u),u=[])}return u.length>1&&s.push(u),s}let vI=at.types,vG=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],yG=["fill-extrusion-flood-light-ground-radius"],xG=Math.pow(2,13),bG=Math.pow(2,15)-1,mF=new ct(0,1),Zf=2147483648,gF=7,_F=450;function Ny(a,e,s,u,d,m,g,v){a.emplaceBack((e<<1)+g,(s<<1)+m,(Math.floor(u*xG)<<1)+d,Math.round(v))}function zy(a,e,s){a.emplaceBack(e.x*yt,e.y*yt,s?1:0)}function Tw(a,e,s,u,d,m){a.emplaceBack(e.x,e.y,(s.x<<1)+u,(s.y<<1)+d,m)}function By(a,e,s){a.emplaceBack(e.x,e.y,e.z,s[0]*16384,s[1]*16384,s[2]*16384)}class vF{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class yF{constructor(){this.centroidXY=new ct(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new ct(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new ct(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new ct(this.max.x-this.min.x,this.max.y-this.min.y)}}class xF{constructor(){this.acc=new ct(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,s){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=s.x,e.min.y=e.max.y=s.y)}appendEdge(e,s,u){this.accCount++,this.acc._add(s);let d=!!this.borders;s.x<e.min.x?(e.min.x=s.x,d=!0):s.x>e.max.x&&(e.max.x=s.x,d=!0),s.y<e.min.y?(e.min.y=s.y,d=!0):s.y>e.max.y&&(e.max.y=s.y,d=!0),((s.x===0||s.x===yt)&&s.x===u.x)!=((s.y===0||s.y===yt)&&s.y===u.y)&&this.processBorderOverlap(s,u),d&&this.checkBorderIntersection(s,u)}checkBorderIntersection(e,s){s.x<0!=e.x<0&&this.addBorderIntersection(0,ln(s.y,e.y,(0-s.x)/(e.x-s.x))),s.x>yt!=e.x>yt&&this.addBorderIntersection(1,ln(s.y,e.y,(yt-s.x)/(e.x-s.x))),s.y<0!=e.y<0&&this.addBorderIntersection(2,ln(s.x,e.x,(0-s.y)/(e.y-s.y))),s.y>yt!=e.y>yt&&this.addBorderIntersection(3,ln(s.x,e.x,(yt-s.y)/(e.y-s.y)))}addBorderIntersection(e,s){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let u=this.borders[e];s<u[0]&&(u[0]=s),s>u[1]&&(u[1]=s)}processBorderOverlap(e,s){if(e.x===s.x){if(e.y===s.y)return;let u=e.x===0?0:1;this.addBorderIntersection(u,s.y),this.addBorderIntersection(u,e.y)}else{let u=e.y===0?2:3;this.addBorderIntersection(u,s.x),this.addBorderIntersection(u,e.x)}}centroid(){return this.accCount===0?new ct(0,0):new ct(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,s)=>e+ +(s[0]!==Number.MAX_VALUE),0):0}}function bF(a,e){let s=a.add(e)._unit(),u=X(a.x*s.x+a.y*s.y,-1,1);var d,m,g;return d=Math.acos(u),Math.min(4,Math.max(-4,Math.tan(d)))/4*bG*((m=a).x*(g=e).y-m.y*g.x<0?-1:1)}let wG=[a=>a.x<0,a=>a.x>yt,a=>a.y<0,a=>a.y>yt];function CG(a,e,s,u){let d=[4];if(u===0)return d;s._mult(u);let m=a.sub(s),g=e.sub(s),v=[a,e,m,g];for(let b=0;b<4;b++)for(let w of v)if(wG[b](w)){d.push(b);break}return d}class yI{constructor(e){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new d_,this.indexArray=new mr,this.programConfigurations=new Xl(e.layers,{zoom:e.zoom,lut:e.lut},s=>yG.includes(s)),this._segments=new wr,this.hiddenByLandmarkVertexArray=new v_,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new wr}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,s,u,d=!1){let m=e.length;if(m>2){let g=Math.max(0,this._segments.get().length-1),v=this._segments._prepareSegment(4*m,this.vertexArray.length,2*this._segmentToGroundQuads[g].length),b;g!==this._segments.get().length-1&&(g++,this._segmentToGroundQuads[g]=[],this._segmentToRegionTriCounts[g]=[0,0,0,0,0]);{let w=e[0],S=e[1];b=bF(w.sub(e[m-1])._perp()._unit(),S.sub(w)._perp()._unit())}for(let w=0;w<m;w++){let S=w===m-1?0:w+1,D=e[w],I=e[S],R=e[S===m-1?0:S+1],k=I.sub(D)._perp()._unit(),B=bF(k,R.sub(I)._perp()._unit()),U=b,G=B;if(xI(D,I,s)||d&&EF(D,s)&&EF(I,s)){b=B;continue}let J=v.vertexLength;Tw(this.vertexArray,D,I,1,1,U),Tw(this.vertexArray,D,I,1,0,U),Tw(this.vertexArray,D,I,0,1,G),Tw(this.vertexArray,D,I,0,0,G),v.vertexLength+=4;let ee=CG(D,I,k,u);for(let se of ee)this._segmentToGroundQuads[g].push({id:J,region:se}),this._segmentToRegionTriCounts[g][se]+=2,v.primitiveLength+=2;b=B}}}prepareBorderSegments(){if(!this.hasData())return;let e=this._segments.get(),s=e.length;for(let u=0;u<s;u++)this._segmentToGroundQuads[u].sort((d,m)=>d.region-m.region);for(let u=0;u<s;u++){let d=this._segmentToGroundQuads[u],m=e[u],g=this._segmentToRegionTriCounts[u];g.reduce((b,w)=>b+w,0);let v=0;for(let b=0;b<=4;b++){let w=g[b];if(w!==0){let S=this.regionSegments[b];S||(S=this.regionSegments[b]=new wr);let D={vertexOffset:m.vertexOffset,primitiveOffset:m.primitiveOffset+v,vertexLength:m.vertexLength,primitiveLength:w};S.get().push(D)}v+=w}for(let b=0;b<d.length;b++){let w=d[b].id;this.indexArray.emplaceBack(w,w+1,w+3),this.indexArray.emplaceBack(w,w+3,w+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,s,u,d,m,g,v){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,s,u,d,m,g,void 0,v)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,uG.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=e.createVertexBuffer(this.groundRadiusArray,dG.members)))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,s,u,d,m,g,v,b){this.hasData()&&this.programConfigurations.updatePaintArrays(e,s,u,d,m,g,v,b)}updateHiddenByLandmark(e){this.updateHiddenByLandmarkRange(e.groundVertexArrayOffset,e.groundVertexCount,!!(e.flags&Zf))}updateHiddenByLandmarkRange(e,s,u){if(!this.hasData())return;let d=s+e;if(s!==0){for(let m=e;m<d;++m)this.hiddenByLandmarkVertexArray.emplace(m,u?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,pG.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){let s=this.regionSegments[e];s&&s.destroy()}}}}class Sw{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(s=>s.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new mr,this.footprintVertices=new _a,this.footprintSegments=[],this.layoutVertexArray=new Lf,this.centroidVertexArray=new aw,this.wallVertexArray=new cw,this.indexArray=new mr,this.programConfigurations=new Xl(e.layers,{zoom:e.zoom,lut:e.lut},s=>vG.includes(s)),this.segments=new wr,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.groundEffect=new yI(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,s){}updateAppearances(e,s,u,d){}populate(e,s,u,d){this.features=[],this.hasPattern=cI("fill-extrusion",this.layers,this.pixelRatio,s),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=xe(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(let{feature:m,id:g,index:v,sourceLayerIndex:b}of e){let w=this.layers[0]._featureFilter.needGeometry,S=Ue(m,w);if(!this.layers[0]._featureFilter.filter(new or(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),S,u))continue;let D={id:g,sourceLayerIndex:b,index:v,geometry:w?S.geometry:Je(m,u,d),properties:m.properties,type:m.type,patterns:{}},I=this.layoutVertexArray.length,R=vI[D.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:m.id,feature:uI("fill-extrusion",this.layers,D,this.zoom,this.pixelRatio,s)});else if(this.wallMode)for(let k of D.geometry)for(let B of pF(k,R))this.addFeature(m.id,D,[B],v,u,{},s.availableImages,d,s.brightness);else this.addFeature(m.id,D,D.geometry,v,u,{},s.availableImages,d,s.brightness);s.featureIndex.insert(m,D.geometry,v,b,this.index,I)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,s,u,d,m,g){for(let{featureId:v,feature:b}of this.features){let w=vI[b.type]==="Polygon",{geometry:S}=b;if(this.wallMode)for(let D of S)for(let I of pF(D,w))this.addFeature(v,b,[I],b.index,s,u,d,m,g);else this.addFeature(v,b,S,b.index,s,u,d,m,g)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,s,u,d,m,g,v){this.programConfigurations.updatePaintArrays(e,s,m,u,d,g,v,this.worldview),this.groundEffect.update(e,s,m,u,d,g,v,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,gG),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,fG.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,mG.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,hG.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,s,u,d,m,g,v,b,w){let S=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(s,{})/this.tileToMeter,D=[new ct(0,0),new ct(yt,yt)],I=b.projection,R=I.name==="globe",k=this.wallMode||vI[s.type]==="Polygon",B=new xF;B.centroidDataIndex=this.centroidData.length;let U=new yF;U.buildingId=e,s.properties&&s.properties.hasOwnProperty("building_id")&&(U.buildingId=s.properties.building_id);let G=this.layers[0].paint.get("fill-extrusion-base").evaluate(s,{},m)<=0,J=this.layers[0].paint.get("fill-extrusion-height").evaluate(s,{},m),ee;if(U.height=J,U.vertexArrayOffset=this.layoutVertexArray.length,U.groundVertexArrayOffset=this.groundEffect.vertexArray.length,R&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new f_),this.wallMode){if(R)return void Gt("Non zero fill-extrusion-line-width is not yet supported on globe.");if(u.length!==1)return;ee=(function(Fe){let Ze=Fe[0].x===Fe[Fe.length-1].x&&Fe[0].y===Fe[Fe.length-1].y;(function(Pt){let St=0,yn=Pt.length;for(let It=0;It<yn;It++)St+=(Pt[(It+1)%yn].x-Pt[It].x)*(Pt[(It+1)%yn].y+Pt[It].y);return St>=0})(Fe)||(Fe=Fe.reverse());let rt={geometry:[],joinNormals:[],indices:[]},vt=[],dt=[],et=[],ut=Fe.length;for(;ut>=2&&Fe[ut-1].equals(Fe[ut-2]);)ut--;if(ut<(Ze?3:2))return rt;let Ge,$e,lt,gt,it,Nt=0;for(;Nt<ut-1&&Fe[Nt].equals(Fe[Nt+1]);)Nt++;Ze&&(Ge=Fe[ut-2],it=Fe[Nt].sub(Ge)._unit()._perp());for(let Pt=Nt;Pt<ut;Pt++){if(lt=Pt===ut-1?Ze?Fe[Nt+1]:void 0:Fe[Pt+1],lt&&Fe[Pt].equals(lt))continue;it&&(gt=it),Ge&&($e=Ge),Ge=Fe[Pt],it=lt?lt.sub(Ge)._unit()._perp():gt,gt=gt||it;let St=gt.add(it);St.x===0&&St.y===0||St._unit();let yn=St.x*it.x+St.y*it.y,It=yn!==0?1/yn:1/0,rn=gt.x*it.y-gt.y*it.x>0,xn="miter",Nn=2;xn==="miter"&&It>Nn&&(xn="bevel"),xn==="bevel"&&(It>100&&(xn="flipbevel"),It<Nn&&(xn="miter"));let ri=(wn,fi,pi,xr)=>{let pe=new ct(wn.x,wn.y),ue=new ct(wn.x,wn.y);pe.x+=fi.x*xr,pe.y+=fi.y*xr,ue.x-=fi.x*Math.max(pi,1),ue.y-=fi.y*Math.max(pi,1),et.push(fi),vt.push(pe),dt.push(ue)};if(xn==="miter")St._mult(It),ri(Ge,St,0,0);else if(xn==="flipbevel")St=it.mult(-1),ri(Ge,St,0,0),ri(Ge,St.mult(-1),0,0);else{let wn=-Math.sqrt(It*It-1),fi=rn?wn:0,pi=rn?0:wn;$e&&ri(Ge,gt,fi,pi),lt&&ri(Ge,it,fi,pi)}}rt.geometry=[...vt,...dt.reverse(),vt[0]],rt.joinNormals=[...et,...et.reverse(),et[et.length-1]];let Ut=rt.geometry.length-1;for(let Pt=0;Pt<Ut/2;Pt++)if(Pt+1<Ut/2){let St=Pt,yn=Pt+1,It=Ut-1-Pt,rn=Ut-2-Pt;St=St===0?Ut-1:St-1,yn=yn===0?Ut-1:yn-1,It=It===0?Ut-1:It-1,rn=rn===0?Ut-1:rn-1,rt.indices.push(It),rt.indices.push(yn),rt.indices.push(St),rt.indices.push(It),rt.indices.push(rn),rt.indices.push(yn)}return rt})(u[0]),u=[ee.geometry]}let se=(Fe,Ze)=>Fe<(Ze.length-1)/2||Fe===Ze.length-1,_e=this.wallMode?[u]:Fy(u,500);for(let Fe=_e.length-1;Fe>=0;Fe--){let Ze=_e[Fe];(Ze.length===0||(fe=Ze[0]).every(Qe=>Qe.x<=0)||fe.every(Qe=>Qe.x>=yt)||fe.every(Qe=>Qe.y<=0)||fe.every(Qe=>Qe.y>=yt))&&_e.splice(Fe,1)}var fe;let we;if(R)we=IF(_e,D,m);else{we=[];for(let Fe of _e)we.push({polygon:Fe,bounds:D})}let Ee=k?this.edgeRadius:0,Se=Ee>0&&this.zoom<17,We=(Fe,Ze)=>{if(Fe.length===0)return!1;let Qe=Fe[Fe.length-1];return Ze.x===Qe.x&&Ze.y===Qe.y};for(let{polygon:Fe,bounds:Ze}of we){let Qe=0,rt=0;for(let ut of Fe)k&&!ut[0].equals(ut[ut.length-1])&&ut.push(ut[0]),rt+=k?ut.length-1:ut.length;let vt=this.segments.prepareSegment((k?5:4)*rt,this.layoutVertexArray,this.indexArray);U.footprintSegIdx<0&&(U.footprintSegIdx=this.footprintSegments.length),U.polygonSegIdx<0&&(U.polygonSegIdx=this.polygonSegments.length);let dt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},et=new vF;if(et.vertexOffset=this.footprintVertices.length,et.indexOffset=3*this.footprintIndices.length,et.ringIndices=[],k){let ut=[],Ge=[];Qe=vt.vertexLength;for(let lt=0;lt<Fe.length;lt++){let gt=Fe[lt];gt.length&&lt!==0&&Ge.push(ut.length/2);let it=[],Nt,Ut;Nt=gt[1].sub(gt[0])._perp()._unit(),et.ringIndices.push(gt.length-1);for(let Pt=1;Pt<gt.length;Pt++){let St=gt[Pt],yn=gt[Pt===gt.length-1?1:Pt+1],It=St.clone();if(Ee){Ut=yn.sub(St)._perp()._unit();let rn=Nt.add(Ut)._unit(),xn=Ee*Math.min(4,1/(Nt.x*rn.x+Nt.y*rn.y));It.x+=xn*rn.x,It.y+=xn*rn.y,It.x=Math.round(It.x),It.y=Math.round(It.y),Nt=Ut}if(!G||Ee!==0&&!Se||We(it,It)||it.push(It),Ny(this.layoutVertexArray,It.x,It.y,0,0,1,1,0),this.wallMode){let rn=se(Pt,gt);zy(this.wallVertexArray,ee.joinNormals[Pt],!rn)}vt.vertexLength++,this.footprintVertices.emplaceBack(St.x,St.y),ut.push(St.x,St.y),R&&By(this.layoutVertexExtArray,I.projectTilePoint(It.x,It.y,m),I.upVector(m,It.x,It.y))}G&&(Ee===0||Se)&&(it.length!==0&&We(it,it[0])&&it.pop(),this.groundEffect.addData(it,Ze,S))}let $e=this.wallMode?ee.indices:S_(ut,Ge);for(let lt=0;lt<$e.length;lt+=3)this.footprintIndices.emplaceBack(et.vertexOffset+$e[lt+0],et.vertexOffset+$e[lt+1],et.vertexOffset+$e[lt+2]),this.indexArray.emplaceBack(Qe+$e[lt],Qe+$e[lt+2],Qe+$e[lt+1]),vt.primitiveLength++;et.indexCount+=$e.length,et.vertexCount+=this.footprintVertices.length-et.vertexOffset}for(let ut=0;ut<Fe.length;ut++){let Ge=Fe[ut];B.startRing(U,Ge[0]);let $e=Ge.length>4&&TF(Ge[Ge.length-2],Ge[0],Ge[1]),lt=Ee?EG(Ge[Ge.length-2],Ge[0],Ge[1],Ee):0,gt=[],it,Nt,Ut;Nt=Ge[1].sub(Ge[0])._perp()._unit();let Pt=!0;for(let St=1,yn=0;St<Ge.length;St++){let It=Ge[St-1],rn=Ge[St],xn=Ge[St===Ge.length-1?1:St+1];if(B.appendEdge(U,rn,It),xI(rn,It,Ze)){Ee&&(Nt=xn.sub(rn)._perp()._unit(),Pt=!Pt);continue}let Nn=rn.sub(It)._perp(),ri=Nn.x/(Math.abs(Nn.x)+Math.abs(Nn.y)),wn=Nn.y>0?1:0,fi=It.dist(rn);if(yn+fi>32768&&(yn=0),Ee){Ut=xn.sub(rn)._perp()._unit();let ue=CF(It,rn,xn,wF(Nt,Ut),Ee);isNaN(ue)&&(ue=0);let Xe=rn.sub(It)._unit();It=It.add(Xe.mult(lt))._round(),rn=rn.add(Xe.mult(-ue))._round(),lt=ue,Nt=Ut,G&&this.zoom>=17&&(We(gt,It)||gt.push(It),We(gt,rn)||gt.push(rn))}let pi=vt.vertexLength,xr=Ge.length>4&&TF(It,rn,xn),pe=SF(yn,$e,Pt);if(Ny(this.layoutVertexArray,It.x,It.y,ri,wn,0,0,pe),Ny(this.layoutVertexArray,It.x,It.y,ri,wn,0,1,pe),this.wallMode){let ue=se(St-1,Ge),Xe=ee.joinNormals[St-1];zy(this.wallVertexArray,Xe,ue),zy(this.wallVertexArray,Xe,ue)}if(yn+=fi,pe=SF(yn,xr,!Pt),$e=xr,Ny(this.layoutVertexArray,rn.x,rn.y,ri,wn,0,0,pe),Ny(this.layoutVertexArray,rn.x,rn.y,ri,wn,0,1,pe),this.wallMode){let ue=se(St,Ge),Xe=ee.joinNormals[St];zy(this.wallVertexArray,Xe,ue),zy(this.wallVertexArray,Xe,ue)}if(vt.vertexLength+=4,this.indexArray.emplaceBack(pi+0,pi+1,pi+2),this.indexArray.emplaceBack(pi+1,pi+3,pi+2),vt.primitiveLength+=2,Ee){let ue=Qe+(St===1?Ge.length-2:St-2),Xe=St===1?Qe:ue+1;if(this.indexArray.emplaceBack(pi+1,ue,pi+3),this.indexArray.emplaceBack(ue,Xe,pi+3),vt.primitiveLength+=2,it===void 0&&(it=pi),!xI(xn,Ge[St],Ze)){let Et=St===Ge.length-1?it:vt.vertexLength;this.indexArray.emplaceBack(pi+2,pi+3,Et),this.indexArray.emplaceBack(pi+3,Et+1,Et),this.indexArray.emplaceBack(pi+3,Xe,Et+1),vt.primitiveLength+=3}Pt=!Pt}if(R){let ue=this.layoutVertexExtArray,Xe=I.projectTilePoint(It.x,It.y,m),Et=I.projectTilePoint(rn.x,rn.y,m),Ye=I.upVector(m,It.x,It.y),Dt=I.upVector(m,rn.x,rn.y);By(ue,Xe,Ye),By(ue,Xe,Ye),By(ue,Et,Dt),By(ue,Et,Dt)}}k&&(Qe+=Ge.length-1),G&&Ee&&this.zoom>=17&&(gt.length!==0&&We(gt,gt[0])&&gt.pop(),this.groundEffect.addData(gt,Ze,S,Ee>0))}this.footprintSegments.push(et),dt.triangleCount=this.indexArray.length-dt.triangleArrayOffset,this.polygonSegments.push(dt),++U.footprintSegLen,++U.polygonSegLen}if(U.vertexCount=this.layoutVertexArray.length-U.vertexArrayOffset,U.groundVertexCount=this.groundEffect.vertexArray.length-U.groundVertexArrayOffset,U.vertexCount!==0){if(U.centroidXY=B.borders?mF:this.encodeCentroid(B,U),this.centroidData.push(U),B.borders){this.featuresOnBorder.push(B);let Fe=this.featuresOnBorder.length-1;for(let Ze=0;Ze<B.borders.length;Ze++)B.borders[Ze][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ze].push(Fe)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,d,g,v,m,w,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(s,d,g,v,m,w,this.worldview),this.maxHeight=Math.max(this.maxHeight,J)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((s,u)=>this.featuresOnBorder[s].borders[e][0]-this.featuresOnBorder[u].borders[e][0])}splitToSubtiles(){let e=[];for(let v=0;v<this.centroidData.length;v++){let b=this.centroidData[v],w=+(b.min.y+b.max.y>yt),S=2*w+(+(b.min.x+b.max.x>yt)^w);for(let D=0;D<b.polygonSegLen;D++){let I=b.polygonSegIdx+D;e.push({centroidIdx:v,subtile:S,polygonSegmentIdx:I,triangleSegmentIdx:this.polygonSegments[I].triangleSegIdx})}}let s=new mr;e.sort((v,b)=>v.triangleSegmentIdx===b.triangleSegmentIdx?v.subtile-b.subtile:v.triangleSegmentIdx-b.triangleSegmentIdx);let u=0,d=0,m=0;for(let v of e){if(v.triangleSegmentIdx!==u)break;m++}let g=e.length;for(;d!==e.length;){u=e[d].triangleSegmentIdx;let v=0,b=d,w=d;for(let S=b;S<m&&e[S].subtile===v;S++)w++;for(;b!==m;){let S=e[b];v=S.subtile;let D=this.centroidData[S.centroidIdx].min.clone(),I=this.centroidData[S.centroidIdx].max.clone(),R={vertexOffset:this.segments.segments[u].vertexOffset,primitiveOffset:s.length,vertexLength:this.segments.segments[u].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let k=b;k<w;k++){let B=e[k],U=this.polygonSegments[B.polygonSegmentIdx],G=this.centroidData[B.centroidIdx].min,J=this.centroidData[B.centroidIdx].max,ee=this.indexArray.uint16;for(let se=U.triangleArrayOffset;se<U.triangleArrayOffset+U.triangleCount;se++)s.emplaceBack(ee[3*se],ee[3*se+1],ee[3*se+2]);R.primitiveLength+=U.triangleCount,D.x=Math.min(D.x,G.x),D.y=Math.min(D.y,G.y),I.x=Math.max(I.x,J.x),I.y=Math.max(I.y,J.y)}R.primitiveLength>0&&this.triangleSubSegments.push({segment:R,min:D,max:I}),b=w;for(let k=b;k<m&&e[k].subtile===e[b].subtile;k++)w++}d=m;for(let S=d;S<g&&e[S].triangleSegmentIdx===e[d].triangleSegmentIdx;S++)m++}s._trim(),this.indexArray=s}getVisibleSegments(e,s,u){let d=new wr;if(this.wallMode){for(let B of this.triangleSubSegments)d.segments.push(B.segment);return d}let m=0,g=0,v=1<<e.canonical.z;if(s){let B=s.getMinMaxForTile(e);B&&(m=B.min,g=B.max)}g+=this.maxHeight;let b=e.toUnwrapped(),w,S=[b.canonical.x/v+b.wrap,b.canonical.y/v],D=[(b.canonical.x+1)/v+b.wrap,(b.canonical.y+1)/v],I=(B,U,G)=>[B[0]*(1-G[0])+U[0]*G[0],B[1]*(1-G[1])+U[1]*G[1]],R=[],k=[];for(let B of this.triangleSubSegments){R[0]=B.min.x/yt,R[1]=B.min.y/yt,k[0]=B.max.x/yt,k[1]=B.max.y/yt;let U=I(S,D,R),G=I(S,D,k);if(new kn([U[0],U[1],m],[G[0],G[1],g]).intersectsPrecise(u)===0){w&&(d.segments.push(w),w=void 0);continue}let J=B.segment;w&&w.vertexOffset!==J.vertexOffset&&(d.segments.push(w),w=void 0),w?(w.vertexLength+=J.vertexLength,w.primitiveLength+=J.primitiveLength):w={vertexOffset:J.vertexOffset,primitiveLength:J.primitiveLength,vertexLength:J.vertexLength,primitiveOffset:J.primitiveOffset,sortKey:void 0,vaos:{}}}return w&&d.segments.push(w),d}encodeCentroid(e,s){let u=e.centroid(),d=s.span(),m=Math.min(7,Math.round(d.x*this.tileToMeter/10)),g=Math.min(7,Math.round(d.y*this.tileToMeter/10));return new ct(X(u.x,1,yt-1)<<3|m,X(u.y,1,yt-1)<<3|g)}encodeBorderCentroid(e){if(!e.borders)return new ct(0,0);let s=e.borders,u=Number.MAX_VALUE;if(s[0][0]!==u||s[1][0]!==u){let d=s[0][0]!==u?0:1;return new ct(6|(s[0][0]!==u?0:65528),(s[d][0]+s[d][1])/2<<3|6)}{let d=s[2][0]!==u?2:3;return new ct((s[d][0]+s[d][1])/2<<3|6,6|(s[2][0]!==u?0:65528))}}showCentroid(e){let s=this.centroidData[e.centroidDataIndex];s.flags&=2147483647,s.centroidXY.x=0,s.centroidXY.y=0,this.writeCentroidToBuffer(s)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);let s=e.vertexArrayOffset,u=e.vertexCount+e.vertexArrayOffset,d=e.flags&Zf?mF:e.centroidXY,m=this.centroidVertexArray.geta_centroid_pos0(s);if(this.centroidVertexArray.geta_centroid_pos1(s)!==d.y||m!==d.x){for(let g=s;g<u;++g)this.centroidVertexArray.emplace(g,d.x,d.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,s,u){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;let d=s.getReplacementRegionsForTile(e.toUnwrapped());if(Ew(this.activeReplacements,d))return;if(this.activeReplacements=d,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(let g of this.centroidData)g.flags&=2147483647;let m=[];for(let g of this.activeReplacements){if(g.order<u)continue;let v=Math.max(1,Math.pow(2,g.footprintTileId.canonical.z-e.canonical.z));if(g.footprint.buildingId){let b=g.footprint.buildingId;for(let w of this.centroidData)w.buildingId===b&&(w.flags|=Zf)}else for(let b of this.centroidData)if(!(b.flags&Zf||g.min.x>b.max.x||b.min.x>g.max.x||g.min.y>b.max.y||b.min.y>g.max.y))for(let w=0;w<b.footprintSegLen;w++){let S=this.footprintSegments[b.footprintSegIdx+w];if(m.length=0,TG(this.footprintVertices,S.vertexOffset,S.vertexCount,g.footprintTileId.canonical,e.canonical,m),mI(g.footprint,m,this.footprintIndices.uint16,S.indexOffset,S.indexCount,-S.vertexOffset,-v)){b.flags|=Zf;break}}}for(let g of this.centroidData)this.writeCentroidToBuffer(g);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,s,u){let d=!1;for(let m=0;m<u.footprintSegLen;m++){let g=this.footprintSegments[u.footprintSegIdx+m],v=0;for(let b of g.ringIndices){for(let w=v,S=b+v-1;w<b+v;S=w++){let D=this.footprintVertices.int16[2*(w+g.vertexOffset)+0],I=this.footprintVertices.int16[2*(w+g.vertexOffset)+1],R=this.footprintVertices.int16[2*(S+g.vertexOffset)+1];I>s!=R>s&&e<(this.footprintVertices.int16[2*(S+g.vertexOffset)+0]-D)*(s-I)/(R-I)+D&&(d=!d)}v=b}}return d}getHeightAtTileCoord(e,s){let u=Number.NEGATIVE_INFINITY,d=!0,m=4*(e+yt)*yt+(s+yt);if(this.partLookup.hasOwnProperty(m)){let g=this.partLookup[m];return g?{height:g.height,hidden:!!(g.flags&Zf)}:void 0}for(let g of this.centroidData)e>g.max.x||g.min.x>e||s>g.max.y||g.min.y>s||g.height<=u||this.footprintContainsPoint(e,s,g)&&(u=g.height,this.partLookup[m]=g,d=!!(g.flags&Zf));if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:d};this.partLookup[m]=void 0}}function wF(a,e){let s=a.add(e)._unit();return a.x*s.x+a.y*s.y}function EG(a,e,s,u){let d=e.sub(a)._perp()._unit(),m=s.sub(e)._perp()._unit();return CF(a,e,s,wF(d,m),u)}function CF(a,e,s,u,d){let m=Math.sqrt(1-u*u);return Math.min(a.dist(e)/3,e.dist(s)/3,d*m/u)}function xI(a,e,s){return a.x<s[0].x&&e.x<s[0].x||a.x>s[1].x&&e.x>s[1].x||a.y<s[0].y&&e.y<s[0].y||a.y>s[1].y&&e.y>s[1].y}function EF(a,e){return a.x<e[0].x||a.x>e[1].x||a.y<e[0].y||a.y>e[1].y}function TF(a,e,s){if(a.x<0||a.x>=yt||e.x<0||e.x>=yt||s.x<0||s.x>=yt)return!1;let u=s.sub(e),d=u.perp(),m=a.sub(e);return(u.x*m.x+u.y*m.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(m.x*m.x+m.y*m.y))>-.866&&d.x*m.x+d.y*m.y<0}function SF(a,e,s){let u=e?2|a:-3&a;return s?1|u:-2&u}function DF(){let a=Math.PI/32,e=Math.tan(a),s=M;return s*Math.sqrt(1+2*e*e)-s}function IF(a,e,s){let u=1<<s.z,d=ae(s.x/u),m=ae((s.x+1)/u),g=re(s.y/u),v=re((s.y+1)/u);return(function(b,w,S,D,I=0,R){let k=[];if(!b.length||!S||!D)return k;let B=(fe,we)=>{for(let Ee of fe)k.push({polygon:Ee,bounds:we})},U=Math.ceil(Math.log2(S)),G=Math.ceil(Math.log2(D)),J=U-G,ee=[];for(let fe=0;fe<Math.abs(J);fe++)ee.push(J>0?0:1);for(let fe=0;fe<Math.min(U,G);fe++)ee.push(0),ee.push(1);let se=b;if(se=bw(se,w[0].y-I,w[1].y+I,1),se=bw(se,w[0].x-I,w[1].x+I,0),!se.length)return k;let _e=[];for(ee.length?_e.push({polygons:se,bounds:w,depth:0}):B(se,w);_e.length;){let fe=_e.pop(),we=fe.depth,Ee=ee[we],Se=fe.bounds[0],We=fe.bounds[1],Fe=Ee===0?Se.x:Se.y,Ze=Ee===0?We.x:We.y,Qe=R?R(Ee,Fe,Ze):.5*(Fe+Ze),rt=bw(fe.polygons,Fe-I,Qe+I,Ee),vt=bw(fe.polygons,Qe-I,Ze+I,Ee);if(rt.length){let dt=[Se,new ct(Ee===0?Qe:We.x,Ee===1?Qe:We.y)];ee.length>we+1?_e.push({polygons:rt,bounds:dt,depth:we+1}):B(rt,dt)}if(vt.length){let dt=[new ct(Ee===0?Qe:Se.x,Ee===1?Qe:Se.y),We];ee.length>we+1?_e.push({polygons:vt,bounds:dt,depth:we+1}):B(vt,dt)}}return k})(a,e,Math.ceil((m-d)/11.25),Math.ceil((g-v)/11.25),1,(b,w,S)=>{if(b===0)return .5*(w+S);{let D=re((s.y+w/yt)/u);return(Z(.5*(re((s.y+S/yt)/u)+D))*u-s.y)*yt}})}function TG(a,e,s,u,d,m){let g=Math.pow(2,u.z-d.z);for(let v=0;v<s;v++){let b=a.int16[2*(v+e)+0],w=a.int16[2*(v+e)+1];b=(b+d.x*yt)*g-u.x*yt,w=(w+d.y*yt)*g-u.y*yt,m.push(new ct(b,w))}}let MF,AF;Bt(Sw,"FillExtrusionBucket",{omit:["layers","features"]}),Bt(yF,"PartData"),Bt(vF,"FootprintSegment"),Bt(xF,"BorderCentroidData"),Bt(yI,"GroundEffect");class wm extends ct{constructor(e,s,u){super(e,s),this.z=u}}class PF extends wm{constructor(e,s,u,d){super(e,s,u),this.w=d}}function OF(a,e,s,u){let d=s==="x"?"y":"x",m=(u-a[s])/(e[s]-a[s]);a[d]=Math.round(a[d]+(e[d]-a[d])*m),a[s]=u,a.hasOwnProperty("z")&&(a.z=ln(a.z,e.z,m)),a.hasOwnProperty("w")&&(a.w=ln(a.w,e.w,m))}function RF(a,e,s,u){let d=s,m=u;for(let g of["x","y"]){let v=a,b=e;v[g]>=b[g]&&(v=e,b=a),v[g]<d&&b[g]>d&&OF(v,b,g,d),v[g]<m&&b[g]>m&&OF(b,v,g,m)}}function Dw(a,e,s,u,d,m){let g=[];for(let v=0;v<a.length;v++){let b=a[v],w,S=g.length,D=0;for(let I=0;I<b.length-1;I++){let R=b[I],k=b[I+1],B=0,U=D,G,J;m&&(B=Math.hypot(k.x-R.x,k.y-R.y),D+=B,G=R,J=k),R.x<e&&k.x<e||(R.x<e?R=new ct(e,R.y+(e-R.x)/(k.x-R.x)*(k.y-R.y))._round():k.x<e&&(k=new ct(e,R.y+(e-R.x)/(k.x-R.x)*(k.y-R.y))._round()),R.y<s&&k.y<s||(R.y<s?R=new ct(R.x+(s-R.y)/(k.y-R.y)*(k.x-R.x),s)._round():k.y<s&&(k=new ct(R.x+(s-R.y)/(k.y-R.y)*(k.x-R.x),s)._round()),R.x>=u&&k.x>=u||(R.x>=u?R=new ct(u,R.y+(u-R.x)/(k.x-R.x)*(k.y-R.y))._round():k.x>=u&&(k=new ct(u,R.y+(u-R.x)/(k.x-R.x)*(k.y-R.y))._round()),R.y>=d&&k.y>=d||(R.y>=d?R=new ct(R.x+(d-R.y)/(k.y-R.y)*(k.x-R.x),d)._round():k.y>=d&&(k=new ct(R.x+(d-R.y)/(k.y-R.y)*(k.x-R.x),d)._round()),w&&R.equals(w[w.length-1])||(w=[R],g.push(w),m&&m.push({progress:{min:U+kF(G,J,R)*B,max:1},parentIndex:v,prevPoint:G,nextPoint:J})),w.push(k),m&&(m[m.length-1].progress.max=U+kF(G,J,k)*B,m[m.length-1].nextPoint=J)))))}if(m&&D>0)for(let I=S;I<g.length;I++)m[I].progress.min/=D,m[I].progress.max/=D}return g}function SG(a,e,s,u,d){if(a.length<2)return void u.push(a);let m=[];for(;e.valid();){let[w,S]=e.get();for(let D=0;D<a.length-1;D++){let I=a[D],R=a[D+1],k=el(I,R,w,S);if(k){let[B]=k,U=new ct(ln(I.x,R.x,B),ln(I.y,R.y,B));m.push({t:D+B,distance:0,point:U})}}e.next()}if(m.length===0)return void u.push(a);m.sort((w,S)=>w.t-S.t);let g=0,v=0,b=[];for(u.push(b);g!==a.length;){if(v===m.length){for(;g!==a.length;)b.length!==0&&b[b.length-1].equals(a[g])||b.push(a[g]),g++;break}m[v].t<=g?(b.length!==0&&b[b.length-1].equals(m[v].point)||b.push(m[v].point),Math.trunc(m[v].t),v++):(b.length!==0&&b[b.length-1].equals(a[g])||b.push(a[g]),g++)}}function kF(a,e,s){return a.x!==e.x?(s.x-a.x)/(e.x-a.x):a.y!==e.y?(s.y-a.y)/(e.y-a.y):0}function jy(a,e){return a.x*e.x+a.y*e.y}function FF(a,e){if(a.length===1){let s=0,u=e[s++],d;for(;!d||u.equals(d);)if(d=e[s++],!d)return 1/0;for(;s<e.length;s++){let m=e[s],g=a[0],v=d.sub(u),b=m.sub(u),w=g.sub(u),S=jy(v,v),D=jy(v,b),I=jy(b,b),R=jy(w,v),k=jy(w,b),B=S*I-D*D,U=(I*R-D*k)/B,G=(S*k-D*R)/B,J=u.z*(1-U-G)+d.z*U+m.z*G;if(isFinite(J))return J}return 1/0}{let s=1/0;for(let u of e)s=Math.min(s,u.z);return s}}function LF(a,e,s){let u=1/0;kr(s,e)&&(u=FF(s,e[0]));for(let d=0;d<e.length;d++){let m=e[d],g=a[d];for(let v=0;v<m.length-1;v++){let b=m[v],w=[b,m[v+1],g[v+1],g[v],b];Gr(s,w)&&(u=Math.min(u,FF(s,w)))}}return u!==1/0&&u}function NF(a,e,s,u,d,m,g,v,b,w,S){return a.projection.name==="globe"?(function(D,I,R,k,B,U,G,J,ee,se,_e){let fe=[],we=[],Ee=D.projection.upVectorScale(_e,D.center.lat,D.worldSize).metersToTile,Se=[0,0,0,1],We=[0,0,0,1],Fe=(Qe,rt,vt,dt)=>{Qe[0]=rt,Qe[1]=vt,Qe[2]=dt,Qe[3]=1},Ze=DF();R>0&&(R+=Ze),k+=Ze;for(let Qe of I){let rt=[],vt=[];for(let dt of Qe){let et=dt.x+B.x,ut=dt.y+B.y,Ge=D.projection.projectTilePoint(et,ut,_e),$e=D.projection.upVector(_e,dt.x,dt.y),lt=R,gt=k;if(G){let it=zF(et,ut,R,k,G,J,ee,se);lt+=it.base,gt+=it.top}R!==0?Fe(Se,Ge.x+$e[0]*Ee*lt,Ge.y+$e[1]*Ee*lt,Ge.z+$e[2]*Ee*lt):Fe(Se,Ge.x,Ge.y,Ge.z),Fe(We,Ge.x+$e[0]*Ee*gt,Ge.y+$e[1]*Ee*gt,Ge.z+$e[2]*Ee*gt),pr(Se,Se,U),pr(We,We,U),rt.push(new wm(Se[0],Se[1],Se[2])),vt.push(new wm(We[0],We[1],We[2]))}fe.push(rt),we.push(vt)}return[fe,we]})(a,e,s,u,d,m,g,v,b,w,S):g?(function(D,I,R,k,B,U,G,J,ee){let se=[],_e=[],fe=[0,0,0,1];for(let we of D){let Ee=[],Se=[];for(let We of we){let Fe=We.x+k.x,Ze=We.y+k.y,Qe=zF(Fe,Ze,I,R,U,G,J,ee);fe[0]=Fe,fe[1]=Ze,fe[2]=Qe.base,fe[3]=1,Hr(fe,fe,B),fe[3]=Math.max(fe[3],1e-5);let rt=new wm(fe[0]/fe[3],fe[1]/fe[3],fe[2]/fe[3]);fe[0]=Fe,fe[1]=Ze,fe[2]=Qe.top,fe[3]=1,Hr(fe,fe,B),fe[3]=Math.max(fe[3],1e-5);let vt=new wm(fe[0]/fe[3],fe[1]/fe[3],fe[2]/fe[3]);Ee.push(rt),Se.push(vt)}se.push(Ee),_e.push(Se)}return[se,_e]})(e,s,u,d,m,g,v,b,w):(function(D,I,R,k,B){let U=[],G=[],J=B[8]*I,ee=B[9]*I,se=B[10]*I,_e=B[11]*I,fe=B[8]*R,we=B[9]*R,Ee=B[10]*R,Se=B[11]*R;for(let We of D){let Fe=[],Ze=[];for(let Qe of We){let rt=Qe.x+k.x,vt=Qe.y+k.y,dt=B[0]*rt+B[4]*vt+B[12],et=B[1]*rt+B[5]*vt+B[13],ut=B[2]*rt+B[6]*vt+B[14],Ge=B[3]*rt+B[7]*vt+B[15],$e=dt+J,lt=et+ee,gt=ut+se,it=Math.max(Ge+_e,1e-5),Nt=dt+fe,Ut=et+we,Pt=ut+Ee,St=Math.max(Ge+Se,1e-5);Fe.push(new wm($e/it,lt/it,gt/it)),Ze.push(new wm(Nt/St,Ut/St,Pt/St))}U.push(Fe),G.push(Ze)}return[U,G]})(e,s,u,d,m)}function zF(a,e,s,u,d,m,g,v){let b=g*d.getElevationAt(a,e,!0,!0),w=m[0]!==0,S=w?m[1]===0?g*(m[0]/gF-_F):g*(function(D,I,R){let k=Math.floor(I[0]/8),B=Math.floor(I[1]/8),U=10*(I[0]-8*k),G=10*(I[1]-8*B),J=D.getElevationAt(k,B,!0,!0),ee=D.getMeterToDEM(R),se=Math.floor(.5*(U*ee-1)),_e=Math.floor(.5*(G*ee-1)),fe=D.tileCoordToPixel(k,B),we=2*se+1,Ee=2*_e+1,Se=(function(vt,dt,et,ut,Ge){return[vt.getElevationAtPixel(dt,et,!0),vt.getElevationAtPixel(dt+Ge,et,!0),vt.getElevationAtPixel(dt,et+Ge,!0),vt.getElevationAtPixel(dt+ut,et+Ge,!0)]})(D,fe.x-se,fe.y-_e,we,Ee),We=Math.abs(Se[0]-Se[1]),Fe=Math.abs(Se[2]-Se[3]),Ze=Math.abs(Se[0]-Se[2])+Math.abs(Se[1]-Se[3]),Qe=Math.min(.25,.5*ee*(We+Fe)/we),rt=Math.min(.25,.5*ee*Ze/Ee);return J+Math.max(Qe*U,rt*G)})(d,m,v):b;return{base:b+(s===0?-1:s),top:w?Math.max(S+u,b+s+2):b+u}}class DG{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class IG{constructor(){this.tasks={},this.taskQueue=[],Ve(["process"],this),this.invoker=new DG(this.process),this.nextId=0}add(e,s){let u=this.nextId++,d=(function({type:m,isSymbolTile:g,zoom:v}){return v=v||0,m==="message"?0:m!=="maybePrepare"||g?m!=="parseTile"||g?m==="parseTile"&&g?300-v:m==="maybePrepare"&&g?400-v:500:200-v:100-v})(s);if(d===0){try{e()}finally{}return null}return this.tasks[u]={fn:e,metadata:s,priority:d,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;let e=this.pick();if(e===null)return;let s=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!s)return;s.fn()}finally{}}pick(){let e=null,s=1/0;for(let d=0;d<this.taskQueue.length;d++){let m=this.tasks[this.taskQueue[d]];m.priority<s&&(s=m.priority,e=d)}if(e===null)return null;let u=this.taskQueue[e];return this.taskQueue.splice(e,1),u}remove(){this.invoker.remove()}}class BF{constructor(e,s,u){this.target=e,this.parent=s,this.mapId=u,this.callbacks={},this.cancelCallbacks={},Ve(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new IG}send(e,s,u,d,m=!1,g){let v=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(u.metadata=g,this.callbacks[v]=u);let b=new Set;return this.target.postMessage({id:v,type:e,hasCallback:!!u,targetMapId:d,mustQueue:m,sourceMapId:this.mapId,data:od(s,b)},b),{cancel:()=>{u&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:d,sourceMapId:this.mapId})}}}receive(e){let s=e.data;if(!s)return;let u=s.id;if(u&&(!s.targetMapId||this.mapId===s.targetMapId))if(s.type==="<cancel>"){let d=this.cancelCallbacks[u];delete this.cancelCallbacks[u],d&&d.cancel()}else if(s.mustQueue||_r(self)){let d=this.callbacks[u],m=this.scheduler.add(()=>this.processTask(u,s),d&&d.metadata||{type:"message"});m&&(this.cancelCallbacks[u]=m)}else this.processTask(u,s)}processTask(e,s){if(delete this.cancelCallbacks[e],s.type==="<response>"){let u=this.callbacks[e];delete this.callbacks[e],u&&(s.error?u(sd(s.error)):u(null,sd(s.data)))}else{let u=new Set,d=s.hasCallback?(g,v)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:g?od(g):null,data:od(v,u)},u)}:()=>{},m=sd(s.data);if(this.parent[s.type])this.parent[s.type](s.sourceMapId,m,d);else if(this.parent.getWorkerSource){let g=s.type.split("."),{source:v,scope:b}=m;this.parent.getWorkerSource(s.sourceMapId,g[0],v,b)[g[1]](m,d)}else d(new Error(`Could not find function ${s.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Vy={workerUrl:"",workerClass:null,workerParams:void 0};let bI="mapboxgl_preloaded_worker_pool",Iw=(()=>{class a{constructor(){this.active={}}acquire(s,u=a.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<u;)this.workers.push(Vy.workerClass!=null?new Vy.workerClass:new self.Worker(Vy.workerUrl,Vy.workerParams));return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],this.workers&&this.numActive()===0&&(this.workers.forEach(u=>{u.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[bI]}numActive(){return Object.keys(this.active).length}}return a.workerCount=2,a})();class I_{constructor(e,s,u="Worker",d=Iw.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=He();let m=this.workerPool.acquire(this.id,d);for(let g=0;g<m.length;g++){let v=new I_.Actor(m[g],s,this.id);v.name=`${u} ${g}`,this.actors.push(v)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,s,u){Ce(this.actors,(d,m)=>{d.send(e,s,m)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let Uy,wI;function Mw(){return Uy||(Uy=new Iw),Uy}I_.Actor=BF;class MG{constructor(e){this.module=e}createIntArray(e){let s=new Int32Array(e),u=this.module.malloc(s.length*s.BYTES_PER_ELEMENT);return this.module.heap32.set(s,u/s.BYTES_PER_ELEMENT),u}createFloatArray(e){let s=new Float32Array(e),u=this.module.malloc(s.length*s.BYTES_PER_ELEMENT);return this.module.heapF32.set(s,u/s.BYTES_PER_ELEMENT),u}createStringBuffer(e){let s=this.module.malloc(e.length+1);for(let u=0;u<e.length;++u)this.module.heapU8[s+u]=e.charCodeAt(u);return this.module.heapU8[s+e.length]=0,s}readStringBuffer(e){let s="";for(;this.module.heapU8[e]!==0;)s+=String.fromCharCode(this.module.heapU8[e]),++e;return s}setStyle(e){let s=e.entranceColorRgb,u=e.facadeGlazingColorRgb,d=e.roofColorRgb,m=e.wallColorRgb,g=e.normalScale;this.module.setStyle(s[0],s[1],s[2],u[0],u[1],u[2],d[0],d[1],d[2],m[0],m[1],m[2],g[0],g[1],g[2],e.tileToMeters)}setAOOptions(e,s){this.module.setAOOptions(e?1:0,s)}setMetricOptions(e,s){this.module.setMetricOptions(e?1:0,s)}setStructuralOptions(e){this.module.setStructuralOptions(e?1:0)}setFacadeOptions(e,s){this.module.setFacadeOptions(e,s?1:0)}setFauxFacadeOptions(e,s,u){this.module.setFauxFacadeOptions(e?1:0,s?1:0,u)}setFacadeClassifierOptions(e){this.module.setFacadeClassifierOptions(e)}generateMesh(e,s){for(let v of e){let b=this.createStringBuffer(v.roofType),w=[0],S=[];for(let R of v.coordinates)if(Array.isArray(R)){for(let k of R)S.push(k.x),S.push(k.y);w.push(S.length)}let D=this.createIntArray(w),I=this.createFloatArray(S);this.module.addFeature(v.id,v.sourceId,v.minHeight,v.height,b,v.roofType.length,I,D,w.length-1),this.module.free(b),this.module.free(D),this.module.free(I)}for(let v of s){let b;b=v.entrances?JSON.parse(v.entrances):[];let w=this.createFloatArray(b),S=[];for(let I of v.coordinates)S.push(I.x),S.push(I.y);let D=this.createFloatArray(S);this.module.addFacade(v.sourceId,v.crossPerc,v.distanceToRoad,w,b.length,D,S.length),this.module.free(w),this.module.free(D)}if(!this.module.generateMesh()){let v=this.module.getLastError();return this.readStringBuffer(v)}let u=this.module.getMeshCount(),d=new Array(u);for(let v=0;v<u;v++){let b=this.module.getPositionsPtr(v),w=this.module.getPositionsLength(v),S=new Float32Array(this.module.heapF32.buffer,b,w),D=this.module.getNormalsPtr(v),I=this.module.getNormalsLength(v),R=new Float32Array(this.module.heapF32.buffer,D,I),k=this.module.getColorsPtr(v),B=this.module.getColorsLength(v),U=new Uint8Array(this.module.heapU8.buffer,k,B),G=this.module.getAOPtr(v),J=this.module.getAOLength(v),ee=new Float32Array(this.module.heapF32.buffer,G,J),se=this.module.getUVPtr(v),_e=this.module.getUVLength(v),fe=new Float32Array(this.module.heapF32.buffer,se,_e),we=this.module.getFauxFacadePtr(v),Ee=this.module.getFauxFacadeLength(v),Se=new Uint8Array(this.module.heapU8.buffer,we,Ee),We=this.module.getIndicesPtr(v),Fe=this.module.getIndicesLength(v),Ze=new Int32Array(this.module.heap32.buffer,We,Fe),Qe=this.module.getBuildingPart(v),rt=this.readStringBuffer(Qe);d[v]={positions:S,normals:R,colors:U,ao:ee,uv:fe,isFauxFacade:Se,indices:Ze,buildingPart:rt}}let m=this.module.getRingCount(),g=[];for(let v=0;v<m;v++){let b=this.module.getRingPtr(v),w=this.module.getRingLength(v),S=new Float32Array(this.module.heapF32.buffer,b,w);g.push(S)}return{meshes:d,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:g}}}let Hy,CI,lu,M_,EI,A_=null,P_=null,jF=null,Aw=null;function VF(){return _r(self)&&self.worker.dracoUrl?self.worker.dracoUrl:CI||tr.DRACO_URL}function UF(){if(_r(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(M_)return M_;let a=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return M_=WebAssembly.validate(a)?tr.MESHOPT_SIMD_URL:tr.MESHOPT_URL,M_}function AG(){return Aw}let Pw={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},PG={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},$y={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function HF(a,e,s){let u=s.json.bufferViews.length,d=s.buffers.length;e.bufferView=u,s.json.bufferViews[u]={buffer:d,byteLength:a.byteLength},s.buffers[d]=a}let TI="KHR_draco_mesh_compression";function OG(a,e){let s=a.extensions&&a.extensions[TI];if(!s)return;let u=new lu.Decoder,d=WF(e,s.bufferView),m=new lu.Mesh;if(!u.DecodeArrayToMesh(d,d.byteLength,m))throw new Error("Failed to decode Draco mesh");let g=e.json.accessors[a.indices],v=Pw[g.componentType],b=g.count*v.BYTES_PER_ELEMENT,w=lu._malloc(b);v===Uint16Array?u.GetTrianglesUInt16Array(m,b,w):u.GetTrianglesUInt32Array(m,b,w),HF(lu.memory.buffer.slice(w,w+b),g,e),lu._free(w);for(let S of Object.keys(s.attributes)){let D=u.GetAttributeByUniqueId(m,s.attributes[S]),I=e.json.accessors[a.attributes[S]],R=PG[I.componentType],k=I.count*$y[I.type]*Pw[I.componentType].BYTES_PER_ELEMENT,B=lu._malloc(k);u.GetAttributeDataArrayForAllPoints(m,D,lu[R],k,B),HF(lu.memory.buffer.slice(B,B+k),I,e),lu._free(B)}u.destroy(),m.destroy(),delete a.extensions[TI]}let Ow="EXT_meshopt_compression";function RG(a,e){if(!a.extensions||!a.extensions[Ow])return;let s=a.extensions[Ow],u=new Uint8Array(e.buffers[s.buffer],s.byteOffset||0,s.byteLength||0),d=new Uint8Array(s.count*s.byteStride);EI.decodeGltfBuffer(d,s.count,s.byteStride,u,s.mode,s.filter),a.buffer=e.buffers.length,a.byteOffset=0,e.buffers[a.buffer]=d.buffer,delete a.extensions[Ow]}let $F=1179937895,GF=new TextDecoder("utf8");function qF(a,e){return new URL(a,e).href}function kG(a,e,s,u){return fetch(qF(a.uri,u)).then(d=>d.arrayBuffer()).then(d=>{e.buffers[s]=d})}function WF(a,e){let s=a.json.bufferViews[e];return new Uint8Array(a.buffers[s.buffer],s.byteOffset||0,s.byteLength)}function FG(a,e,s,u){if(a.uri){let d=qF(a.uri,u);return fetch(d).then(m=>m.blob()).then(m=>createImageBitmap(m)).then(m=>{e.images[s]=m})}if(a.bufferView!==void 0){let d=WF(e,a.bufferView),m=new Blob([d],{type:a.mimeType});return createImageBitmap(m).then(g=>{e.images[s]=g})}}function ZF(a,e=0,s){let u={json:null,images:[],buffers:[]};if(new Uint32Array(a,e,1)[0]===$F){let S=new Uint32Array(a,e),D=2,I=(S[D++]>>2)-3,R=S[D++]>>2;if(D++,u.json=JSON.parse(GF.decode(S.subarray(D,D+R))),D+=R,D<I){let k=S[D++];D++;let B=e+(D<<2);u.buffers[0]=a.slice(B,B+k)}}else u.json=JSON.parse(GF.decode(new Uint8Array(a,e)));let{buffers:d,images:m,meshes:g,extensionsUsed:v,bufferViews:b}=u.json,w=Promise.resolve();if(d){let S=[];for(let D=0;D<d.length;D++){let I=d[D];I.uri?S.push(kG(I,u,D,s)):u.buffers[D]||(u.buffers[D]=null)}w=Promise.all(S)}return w.then(()=>{let S=[],D=v&&v.includes(TI),I=v&&v.includes(Ow);if(D&&S.push((function(){if(!lu)return Hy??(Hy=(function(R){let k,B=null;function U(){k=new Uint8Array(B.buffer)}function G(){throw new Error("Unexpected Draco error.")}let J={a:{a:G,d:function(ee,se,_e){return k.copyWithin(ee,se,se+_e)},c:function(ee){let se=k.length,_e=Math.max(ee>>>0,Math.ceil(1.2*se)),fe=Math.ceil((_e-se)/65536);try{return B.grow(fe),U(),!0}catch{return!1}},b:G}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(R,J):R.then(ee=>ee.arrayBuffer()).then(ee=>WebAssembly.instantiate(ee,J))).then(ee=>{let{Rb:se,Qb:_e,P:fe,T:we,X:Ee,Ja:Se,La:We,Qa:Fe,Va:Ze,Wa:Qe,eb:rt,jb:vt,f:dt,e:et,yb:ut,zb:Ge,Ab:$e,Bb:lt,Db:gt,Gb:it}=ee.instance.exports;B=et;let Nt=(()=>{let Ut=0,Pt=0,St=0,yn=0;return It=>{St&&(se(yn),se(Ut),Pt+=St,St=Ut=0),Ut||(Pt+=128,Ut=_e(Pt));let rn=It.length+7&-8,xn=Ut;rn>=Pt&&(St=rn,xn=yn=_e(rn));for(let Nn=0;Nn<It.length;Nn++)k[xn+Nn]=It[Nn];return xn}})();return U(),dt(),{memory:et,_free:se,_malloc:_e,Mesh:class{constructor(){this.ptr=fe()}destroy(){we(this.ptr)}},Decoder:class{constructor(){this.ptr=Se()}destroy(){vt(this.ptr)}DecodeArrayToMesh(Ut,Pt,St){let yn=Nt(Ut),It=We(this.ptr,yn,Pt,St.ptr);return!!Ee(It)}GetAttributeByUniqueId(Ut,Pt){return{ptr:Fe(this.ptr,Ut.ptr,Pt)}}GetTrianglesUInt16Array(Ut,Pt,St){Ze(this.ptr,Ut.ptr,Pt,St)}GetTrianglesUInt32Array(Ut,Pt,St){Qe(this.ptr,Ut.ptr,Pt,St)}GetAttributeDataArrayForAllPoints(Ut,Pt,St,yn,It){rt(this.ptr,Ut.ptr,Pt.ptr,St,yn,It)}},DT_INT8:ut(),DT_UINT8:Ge(),DT_INT16:$e(),DT_UINT16:lt(),DT_UINT32:gt(),DT_FLOAT32:it()}})})(fetch(VF())),Hy.then(R=>{lu=R,Hy=void 0}))})()),I&&S.push((function(){if(EI)return;let R=(function(k){let B,U=WebAssembly.instantiateStreaming(k,{}).then(ee=>{B=ee.instance,B.exports.__wasm_call_ctors()}),G={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},J={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:U,supported:!0,decodeGltfBuffer(ee,se,_e,fe,we,Ee){(function(Se,We,Fe,Ze,Qe,rt,vt){let dt=Se.exports.sbrk,et=Ze+3&-4,ut=dt(et*Qe),Ge=dt(rt.length),$e=new Uint8Array(Se.exports.memory.buffer);$e.set(rt,Ge);let lt=We(ut,Ze,Qe,Ge,rt.length);if(lt===0&&vt&&vt(ut,et,Qe),Fe.set($e.subarray(ut,ut+Ze*Qe)),dt(ut-dt(0)),lt!==0)throw new Error(`Malformed buffer data: ${lt}`)})(B,B.exports[J[we]],ee,se,_e,fe,B.exports[G[Ee]])}}})(fetch(UF()));return R.ready.then(()=>{EI=R})})()),m)for(let R=0;R<m.length;R++)S.push(FG(m[R],u,R,s));return(S.length?Promise.all(S):Promise.resolve()).then(()=>{if(D&&g)for(let{primitives:R}of g)for(let k of R)OG(k,u);if(I&&g&&b)for(let R of b)RG(R,u);return u})})}function XF(a){return fetch(a).then(e=>e.arrayBuffer()).then(e=>ZF(e,0,a))}function SI(a){switch(a){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function DI(a){switch(a){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class II{constructor(e,s,u,d){this.context=e,this.format=u,this.useMipmap=d&&d.useMipmap,this.texture=e.gl.createTexture(),this.update(s,{premultiply:d&&d.premultiply})}update(e,s){let u=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,d=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:m}=this,{gl:g}=m,{x:v,y:b}=s&&s.position?s.position:{x:0,y:0},w=v+u,S=b+d;!this.size||this.size[0]===w&&this.size[1]===S||(g.bindTexture(g.TEXTURE_2D,null),g.deleteTexture(this.texture),this.texture=g.createTexture(),this.size=null),g.bindTexture(g.TEXTURE_2D,this.texture),m.pixelStoreUnpackFlipY.set(!1),m.pixelStoreUnpack.set(1),m.pixelStoreUnpackPremultiplyAlpha.set(this.format===g.RGBA8&&(!s||s.premultiply!==!1));let D=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&w>0&&S>0){let I=this.useMipmap?Math.floor(Math.log2(Math.max(w,S)))+1:1;g.texStorage2D(g.TEXTURE_2D,I,this.format,w,S),this.size=[w,S]}this.size&&(D?g.texSubImage2D(g.TEXTURE_2D,0,v,b,SI(this.format),DI(this.format),e):"data"in e&&e.data&&g.texSubImage2D(g.TEXTURE_2D,0,v,b,u,d,SI(this.format),DI(this.format),e.data)),this.useMipmap&&g.generateMipmap(g.TEXTURE_2D)}bind(e,s,u=!1){let{context:d}=this,{gl:m}=d;m.bindTexture(m.TEXTURE_2D,this.texture),e!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,e),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap&&!u?e===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),s!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,s),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,s),this.wrapS=s)}bindExtraParam(e,s,u,d,m){let{context:g}=this,{gl:v}=g;v.bindTexture(v.TEXTURE_2D,this.texture),s!==this.magFilter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,s),this.magFilter=s),e!==this.minFilter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,this.useMipmap?e===v.NEAREST?v.NEAREST_MIPMAP_NEAREST:v.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),u!==this.wrapS&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,u),this.wrapS=u),d!==this.wrapT&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,d),this.wrapT=d),m!==this.compareMode&&(m?(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_MODE,v.COMPARE_REF_TO_TEXTURE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_FUNC,m)):v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_MODE,v.NONE),this.compareMode=m)}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Gy{constructor(e,s){this.context=e,this.texture=s}bind(e,s){let{context:u}=this,{gl:d}=u;d.bindTexture(d.TEXTURE_2D,this.texture),e!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,e),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,e),this.minFilter=e),s!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,s),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,s),this.wrapS=s)}}let LG=Bn([{name:"a_pos_3f",components:3,type:"Float32"}]),NG=Bn([{name:"a_color_3f",components:3,type:"Float32"}]),zG=Bn([{name:"a_color_4f",components:4,type:"Float32"}]),BG=Bn([{name:"a_uv_2f",components:2,type:"Float32"}]),jG=Bn([{name:"a_normal_3f",components:3,type:"Float32"}]),VG=Bn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),UG=Bn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function YF(a,e){let s=Rw(a.projection,a.zoom,a.width,a.height),u=(function(m,g,v,b,w){let S=new F(v.lng-180*Xf,v.lat),D=new F(v.lng+180*Xf,v.lat),I=m.project(S.lng,S.lat),R=m.project(D.lng,D.lat),k=-Math.atan2(R.y-I.y,R.x-I.x),B=Re.fromLngLat(v);B.y=X(B.y,-1+Xf,1-Xf);let U=B.toLngLat(),G=m.project(U.lng,U.lat),J=Re.fromLngLat(U);J.x+=Xf;let ee=J.toLngLat(),se=m.project(ee.lng,ee.lat),_e=JF(se.x-G.x,se.y-G.y,k),fe=Re.fromLngLat(U);fe.y+=Xf;let we=fe.toLngLat(),Ee=m.project(we.lng,we.lat),Se=JF(Ee.x-G.x,Ee.y-G.y,k),We=Math.abs(_e.x)/Math.abs(Se.y),Fe=Be([]);Vn(Fe,Fe,-k*(1-(w?0:b)));let Ze=Be([]);return Cn(Ze,Ze,[1,1-(1-We)*b,1]),Ze[4]=-Se.x/Se.y*b,Vn(Ze,Ze,k),ot(Ze,Fe,Ze),Ze})(a.projection,0,a.center,s,e),d=KF(a);return Cn(u,u,[d,d,1]),u}function KF(a){let e=a.projection,s=Rw(a.projection,a.zoom,a.width,a.height),u=MI(e,a.center),d=MI(e,F.convert(e.center));return Math.pow(2,u*s+(1-s)*d)}function Rw(a,e,s,u,d=1/0){let m=a.range;if(!m)return 0;let g=Math.min(d,Math.max(s,u)),v=Math.log2(g/1024);return de(m[0]+v,m[1]+v,e)}let Xf=1/4e4;function MI(a,e){let s=X(e.lat,-ce,ce),u=new F(e.lng-180*Xf,s),d=new F(e.lng+180*Xf,s),m=a.project(u.lng,s),g=a.project(d.lng,s),v=Re.fromLngLat(u),b=Re.fromLngLat(d),w=g.x-m.x,S=g.y-m.y,D=b.x-v.x,I=b.y-v.y,R=Math.sqrt((D*D+I*I)/(w*w+S*S));return Math.log2(R)}function JF(a,e,s){let u=Math.cos(s),d=Math.sin(s);return{x:a*u-e*d,y:a*d+e*u}}function QF(a,e,s){Be(a),Vn(a,a,Wn(e[2])),Xn(a,a,Wn(e[0])),On(a,a,Wn(e[1])),Cn(a,a,s),ot(a,a,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function kw(a,e,s,u,d,m,g,v){let b=[s[0]-e[0],s[1]-e[1],0],w=[u[0]-e[0],u[1]-e[1],0];if(ai(b)<1e-12||ai(w)<1e-12)return vs(a);let S=Ro([],b,w);Li(S,S),Oo(w,u,e),b[2]=(m-d)*v,w[2]=(g-d)*v;let D=b;return Ro(D,b,w),Li(D,D),zu(a,S,D)}function Fw(a,e,s=!1){let u=qf(e.zoom),d=(function(m,g,v){let b=g.worldSize,w=[m[12],m[13],m[14]],S=re(w[1]/b),D=ae(w[0]/b),I=Be([]),R=Q(1,S)*b,k=Q(1,0)*b*me(S,g.zoom),B=1/rI(b),U=k*B;if(v){let se=Rw(g.projection,g.zoom,g.width,g.height,1024);U=B*g.projection.pixelSpaceConversion(g.center.lat,b,se)}let G=T(S,D);Pr(G,G,Ui([],Li([],G),R*U*w[2]));let J=(function(se){let _e=[se[0],se[1],se[2]],fe=[0,1,0],we=Ro([],fe,_e);return Ro(fe,_e,we),Bl(fe)===0&&(fe=[0,1,0],Ro(we,_e,fe)),Li(we,we),Li(fe,fe),Li(_e,_e),[we[0],we[1],we[2],0,fe[0],fe[1],fe[2],0,_e[0],_e[1],_e[2],0,se[0],se[1],se[2],1]})(G);Cn(I,I,[U,U,U*R]),kt(I,I,[-w[0],-w[1],-w[2]]);let ee=ot([],g.globeMatrix,J);return ot(ee,ee,I),ot(ee,ee,m),ee})(a,e,s);if(u>0){let m=(function(g,v){let b=v.worldSize,w=Q(1,0)*b*me(v.center.lat,v.zoom)/rI(b),S=Q(1,v.center.lat)*b,D=Be([]);On(D,D,Wn(v.center.lng)),Xn(D,D,Wn(v.center.lat)),kt(D,D,[0,0,va]),Cn(D,D,[w,w,w*S]);let I=v.point;return kt(D,D,[-I.x,-I.y,0]),ot(D,D,g),ot(D,v.globeMatrix,D)})(a,e);return(function(g,v,b){let w=(k,B,U)=>{let G=ai(k),J=ai(B),ee=Eh(k,B,U);return Ui(ee,ee,1/ai(ee)*ln(G,J,U))},S=w([g[0],g[1],g[2]],[v[0],v[1],v[2]],b),D=w([g[4],g[5],g[6]],[v[4],v[5],v[6]],b),I=w([g[8],g[9],g[10]],[v[8],v[9],v[10]],b),R=Eh([g[12],g[13],g[14]],[v[12],v[13],v[14]],b);return[S[0],S[1],S[2],0,D[0],D[1],D[2],0,I[0],I[1],I[2],0,R[0],R[1],R[2],1]})(d,m,u)}return d}function AI(a,e,s,u){let d=kn.projectAabbCorners(u,s),m=Number.MAX_VALUE;for(let v=0;v<d.length;++v){let b=d[v];b[0]=(.5*b[0]+.5)*e.width,b[1]=(.5-.5*b[1])*e.height,b[2]<m&&(m=b[2])}let g=(function(v){let b=[],w=0;for(let R=1;R<v.length;R++)(v[R][0]<v[w][0]||v[R][0]===v[w][0]&&v[R][1]<v[w][1])&&(w=R);let S,D=w,I=new Uint8Array(v.length);do{if(I[D])break;b.push(new ct(v[D][0],v[D][1])),I[D]=1,S=(D+1)%v.length;for(let R=0;R<v.length;R++){if(v[R][0]===v[S][0]&&v[R][1]===v[S][1]||v[R][0]===v[D][0]&&v[R][1]===v[D][1])continue;let k=[v[R][0]-v[D][0],v[R][1]-v[D][1]],B=[v[S][0]-v[D][0],v[S][1]-v[D][1]],U=k[0]*B[1]-k[1]*B[0];(U>0||U===0&&k[0]*B[0]+k[1]*B[1]>=0&&k[0]*k[0]+k[1]*k[1]>B[0]*B[0]+B[1]*B[1])&&(S=R)}D=S}while(D!==w);return b.length>0&&b.push(b[0]),b})(d);if(Gr(a,g))return m}let Cm=64,O_={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function Lw(a,e,s,u,d,m,g,v,b,w=!1){let S=s.zoom,D=s.project(u),I=me(u.lat,S),R=1/I;Be(a),kt(a,a,[D.x+g[0]*R,D.y+g[1]*R,g[2]]);let k=1,B=1,U=s.worldSize;if(w){if(s.projection.name==="mercator"){let se=0;s.elevation&&(se=s.elevation.getAtPointOrZero(new Re(D.x/U,D.y/U),0));let _e=Hr([],[D.x,D.y,se,1],s.projMatrix)[3]/s.cameraToCenterDistance;k=_e,B=_e*me(s.center.lat,S)}else if(s.projection.name==="globe"){let se=Fw(a,s),_e=[0,0,0,1];Hr(_e,_e,ot([],s.projMatrix,se));let fe=_e[3]/s.cameraToCenterDistance,we=qf(S),Ee=s.projection.pixelsPerMeter(u.lat,U)*me(u.lat,S),Se=s.projection.pixelsPerMeter(s.center.lat,U)*me(s.center.lat,S);k=fe/ln(Ee,ve(s.center.lat),we),B=fe*I/Ee,k*=Se,B*=Se}}else k=R;Cn(a,a,[k,k,B]);let G=[...a],J=e.orientation,ee=[];if(QF(ee,[J[0]+(d?d[0]:0),J[1]+(d?d[1]:0),J[2]+(d?d[2]:0)],m),ot(a,G,ee),v&&s.elevation){let se=0,_e=[];if(b&&s.elevation){se=(function(we,Ee,Se,We,Fe){let Ze=Ee.elevation;if(!Ze)return 0;let Qe=kn.projectAabbCorners(Se,We),rt=Q(1,Fe.lat)*Ee.worldSize,vt=(function(Pt,St){let yn=[0,0,1],It=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(let rn of It){let xn=Pt[rn.corners[0]],Nn=Pt[rn.corners[1]],ri=Pt[rn.corners[2]],wn=[Nn[0]-xn[0],Nn[1]-xn[1],St*(Nn[2]-xn[2])],fi=Ro(wn,wn,[ri[0]-xn[0],ri[1]-xn[1],St*(ri[2]-xn[2])]);Li(fi,fi),rn.dotProductWithUp=Vr(fi,yn)}return It.sort((rn,xn)=>rn.dotProductWithUp-xn.dotProductWithUp),It[0].corners})(Qe,rt),dt=Qe[vt[0]],et=Qe[vt[1]],ut=Qe[vt[2]],Ge=Qe[vt[3]],$e=Ze.getAtPointOrZero(new Re(dt[0]/Ee.worldSize,dt[1]/Ee.worldSize),0),lt=Ze.getAtPointOrZero(new Re(et[0]/Ee.worldSize,et[1]/Ee.worldSize),0),gt=Ze.getAtPointOrZero(new Re(ut[0]/Ee.worldSize,ut[1]/Ee.worldSize),0),it=Ze.getAtPointOrZero(new Re(Ge[0]/Ee.worldSize,Ge[1]/Ee.worldSize),0),Nt=($e+it)/2,Ut=(lt+gt)/2;return Nt>Ut?lt<gt?kw(we,et,Ge,dt,lt,it,$e,rt):kw(we,ut,dt,Ge,gt,$e,it,rt):$e<it?kw(we,dt,et,ut,$e,lt,gt,rt):kw(we,Ge,ut,et,it,gt,lt,rt),Math.max(Nt,Ut)})(_e,s,e.aabb,a,u);let fe=ot([],$n([],_e),ee);ot(a,G,fe)}else se=s.elevation.getAtPointOrZero(new Re(D.x/U,D.y/U),0);se!==0&&(a[14]+=se)}}class eL{constructor(e,s,u,d,m){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=e,this.uri=s,this.position=u!=null?new F(u[0],u[1]):new F(0,0),this.orientation=d??[0,0,0],this.nodes=m,this.uploaded=!1,this.aabb=new kn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,s){ot(e.globalMatrix,s,e.localMatrix);let u=this.nodeOverrides.get(e.name);if(u!==void 0){let g=[];m=u.orientation,Be(d=g),On(d,d,Wn(m[1])),Vn(d,d,Wn(m[2])),Xn(d,d,Wn(m[0])),ot(e.globalMatrix,e.globalMatrix,g)}var d,m;if(e.meshes)for(let g of e.meshes){let v=kn.applyTransformFast(g.aabb,e.globalMatrix);this.aabb.encapsulate(v)}if(e.children)for(let g of e.children)this._applyTransformations(g,e.globalMatrix)}computeBoundsAndApplyParent(){let e=Be([]);this.aabb=new kn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(let s of this.nodes)this._applyTransformations(s,e)}computeModelMatrix(e,s,u,d,m,g,v=!1){Lw(this.matrix,this,e.transform,this.position,s,u,d,m,g,v)}upload(e){if(!this.uploaded){for(let s of this.nodes)PI(s,e);for(let s of this.nodes)Nw(s);this.uploaded=!0}}destroy(){for(let e of this.nodes)OI(e)}}function qy(a,e,s=!1){a.uploaded||(a.gfxTexture=new II(e,a.image,s?e.gl.R8:e.gl.RGBA8,{useMipmap:a.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),a.uploaded=!0,a.image=null)}function HG(a,e,s){a.indexBuffer=e.createIndexBuffer(a.indexArray,!1,!0),a.vertexBuffer=e.createVertexBuffer(a.vertexArray,LG.members,!1,!0),a.normalArray&&(a.normalBuffer=e.createVertexBuffer(a.normalArray,jG.members,!1,!0)),a.texcoordArray&&(a.texcoordBuffer=e.createVertexBuffer(a.texcoordArray,BG.members,!1,!0)),a.colorArray&&(a.colorBuffer=e.createVertexBuffer(a.colorArray,(a.colorArray.bytesPerElement===12?NG:zG).members,!1,!0)),a.featureArray&&(a.pbrBuffer=e.createVertexBuffer(a.featureArray,UG.members,!0)),a.segments=wr.simpleSegment(0,0,a.vertexArray.length,a.indexArray.length);let u=a.material;u.pbrMetallicRoughness.baseColorTexture&&qy(u.pbrMetallicRoughness.baseColorTexture,e),u.pbrMetallicRoughness.metallicRoughnessTexture&&qy(u.pbrMetallicRoughness.metallicRoughnessTexture,e),u.normalTexture&&qy(u.normalTexture,e),u.occlusionTexture&&qy(u.occlusionTexture,e,s),u.emissionTexture&&qy(u.emissionTexture,e)}function PI(a,e,s){if(a.meshes)for(let u of a.meshes)HG(u,e,s);if(a.children)for(let u of a.children)PI(u,e,s)}function Nw(a){if(a.meshes)for(let e of a.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(a.children)for(let e of a.children)Nw(e)}function OI(a){if(a.meshes)for(let s of a.meshes)s.vertexBuffer&&(s.vertexBuffer.destroy(),s.indexBuffer.destroy(),s.normalBuffer&&s.normalBuffer.destroy(),s.texcoordBuffer&&s.texcoordBuffer.destroy(),s.colorBuffer&&s.colorBuffer.destroy(),s.pbrBuffer&&s.pbrBuffer.destroy(),s.segments.destroy(),s.material&&((e=s.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(a.children)for(let s of a.children)OI(s)}function Em(a,e){let s=a.json.bufferViews[e.bufferView],u=Pw[e.componentType];return new u(a.buffers[s.buffer],(e.byteOffset||0)+(s.byteOffset||0),e.count*(s.byteStride&&s.byteStride!==$y[e.type]*u.BYTES_PER_ELEMENT?s.byteStride/u.BYTES_PER_ELEMENT:$y[e.type]))}function RI(a,e,s,u){let d=Pw[e.componentType],m=(function(S){switch(S){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}})(d),g=a.json.bufferViews[e.bufferView],v=g.byteStride?g.byteStride/d.BYTES_PER_ELEMENT:$y[e.type],b=s.float32,w=b.length/s.capacity;for(let S=0,D=0;S<e.count*v;S+=v,D+=w)for(let I=0;I<w;I++)b[D+I]=u[S+I]*m;s._trim()}function $G(a,e,s){let u=a.indices,d=a.attributes,m={};m.indexArray=new mr;let g=e.json.accessors[u],v=g.count/3;m.indexArray.reserve(v);let b=Em(e,g);for(let I=0;I<v;I++)m.indexArray.emplaceBack(b[3*I],b[3*I+1],b[3*I+2]);m.indexArray._trim(),m.vertexArray=new Qa;let w=e.json.accessors[d.POSITION];m.vertexArray.reserve(w.count);let S=Em(e,w);for(let I=0;I<w.count;I++)m.vertexArray.emplaceBack(S[3*I],S[3*I+1],S[3*I+2]);if(m.vertexArray._trim(),m.aabb=new kn(w.min,w.max),m.centroid=(function(I,R){let k=[0,0,0],B=I.length;if(B>0){for(let U=0;U<B;U++){let G=3*I[U];k[0]+=R[G],k[1]+=R[G+1],k[2]+=R[G+2]}k[0]/=B,k[1]/=B,k[2]/=B}return k})(b,S),d.COLOR_0!==void 0){let I=e.json.accessors[d.COLOR_0],R=$y[I.type],k=Em(e,I);m.colorArray=R===3?new Qa:new cd,m.colorArray.resize(I.count),RI(e,I,m.colorArray,k)}if(d.NORMAL!==void 0){m.normalArray=new Qa;let I=e.json.accessors[d.NORMAL];m.normalArray.resize(I.count);let R=Em(e,I);RI(e,I,m.normalArray,R)}if(d.TEXCOORD_0!==void 0&&s.length>0){m.texcoordArray=new ud;let I=e.json.accessors[d.TEXCOORD_0];m.texcoordArray.resize(I.count);let R=Em(e,I);RI(e,I,m.texcoordArray,R)}if(d._FEATURE_ID_RGBA4444!==void 0){let I=e.json.accessors[d._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(m.featureData=Em(e,I))}d._FEATURE_RGBA4444!==void 0&&(m.featureData=new Uint32Array(Em(e,e.json.accessors[d._FEATURE_RGBA4444]).buffer));let D=a.material;return m.material=(function(I,R){let{emissiveFactor:k=[0,0,0],alphaMode:B="OPAQUE",alphaCutoff:U=.5,normalTexture:G,occlusionTexture:J,emissiveTexture:ee,doubleSided:se,name:_e}=I,{baseColorFactor:fe=[1,1,1,1],metallicFactor:we=1,roughnessFactor:Ee=1,baseColorTexture:Se,metallicRoughnessTexture:We}=I.pbrMetallicRoughness||{},Fe=J?R[J.index]:void 0;if(J&&J.extensions&&J.extensions.KHR_texture_transform&&Fe){let Ze=J.extensions.KHR_texture_transform;Fe.offsetScale=[Ze.offset[0],Ze.offset[1],Ze.scale[0],Ze.scale[1]]}return{name:_e,pbrMetallicRoughness:{baseColorFactor:new Qn(...fe),metallicFactor:we,roughnessFactor:Ee,baseColorTexture:Se?R[Se.index]:void 0,metallicRoughnessTexture:We?R[We.index]:void 0},doubleSided:se,emissiveFactor:new Qn(...k),alphaMode:B,alphaCutoff:U,normalTexture:G?R[G.index]:void 0,occlusionTexture:Fe,emissionTexture:ee?R[ee.index]:void 0,defined:I.defined===void 0}})(D!==void 0?e.json.materials[D]:{defined:!1},s),m}function tL(a,e,s){let{matrix:u,rotation:d,translation:m,scale:g,mesh:v,extras:b,children:w,name:S}=a,D={};if(D.name=S,D.localMatrix=u||(function(I,R,k,B){var U=R[0],G=R[1],J=R[2],ee=R[3],se=U+U,_e=G+G,fe=J+J,we=U*se,Ee=U*_e,Se=U*fe,We=G*_e,Fe=G*fe,Ze=J*fe,Qe=ee*se,rt=ee*_e,vt=ee*fe,dt=B[0],et=B[1],ut=B[2];return I[0]=(1-(We+Ze))*dt,I[1]=(Ee+vt)*dt,I[2]=(Se-rt)*dt,I[3]=0,I[4]=(Ee-vt)*et,I[5]=(1-(we+Ze))*et,I[6]=(Fe+Qe)*et,I[7]=0,I[8]=(Se+rt)*ut,I[9]=(Fe-Qe)*ut,I[10]=(1-(we+We))*ut,I[11]=0,I[12]=k[0],I[13]=k[1],I[14]=k[2],I[15]=1,I})([],d||[0,0,0,1],m||[0,0,0],g||[1,1,1]),D.globalMatrix=Ae(D.localMatrix),v!==void 0){D.meshes=s[v];let I=D.anchor=[0,0];for(let R of D.meshes){let{min:k,max:B}=R.aabb;I[0]+=k[0]+B[0],I[1]+=k[1]+B[1]}I[0]=Math.floor(I[0]/D.meshes.length/2),I[1]=Math.floor(I[1]/D.meshes.length/2)}if(b&&(b.id&&(D.id=b.id),b.lights&&(D.lights=(function(I){if(!I.length)return[];let R=(function(J){let ee=atob(J),se=new Uint8Array(ee.length);for(let _e=0;_e<ee.length;_e++)se[_e]=ee.codePointAt(_e);return se})(I),k=[],B=R.length/24,U=new Uint16Array(R.buffer),G=new Float32Array(R.buffer);for(let J=0;J<B;J++){let ee=U[2*J*6]/30,se=U[2*J*6+1]/30,_e=U[2*J*6+10]/100,fe=G[6*J+1],we=G[6*J+2],Ee=G[6*J+3],Se=G[6*J+4],We=Ee-fe,Fe=Se-we,Ze=Math.hypot(We,Fe);k.push({pos:[fe+.5*We,we+.5*Fe,se],normal:[Fe/Ze,-We/Ze,0],width:Ze,height:ee,depth:_e,points:[fe,we,Ee,Se]})}return k})(b.lights)),b.MAPBOX_geometry_bloom&&(D.isGeometryBloom=b.MAPBOX_geometry_bloom)),w){let I=[];for(let R of w)I.push(tL(e.json.nodes[R],e,s));D.children=I}return D}function GG(a){if(a.vertices.length===0||a.indices.length===0)return null;let e=new ww(a.vertices,a.indices,8,256),[s,u]=[e.min.clone(),e.max.clone()];return{vertices:a.vertices,indices:a.indices,grid:e,min:s,max:u}}function qG(a){if(!a.extras||!a.extras.ground)return null;let e=a.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;let s=e[0];if(!s||!Array.isArray(s)||s.length===0)return null;let u=[];for(let g of s){if(!Array.isArray(g)||g.length!==2)continue;let v=g[0],b=g[1];typeof v=="number"&&typeof b=="number"&&u.push(new ct(v,b))}if(u.length<3)return null;u.length>1&&u[u.length-1].equals(u[0])&&u.pop();let d=0;for(let g=0;g<u.length;g++){let v=u[g],b=u[(g+1)%u.length],w=u[(g+2)%u.length];d+=(v.x-b.x)*(w.y-b.y)-(w.x-b.x)*(v.y-b.y)}d>0&&u.reverse();let m=S_(u.flatMap(g=>[g.x,g.y]),[]);return m.length===0?null:{vertices:u,indices:m}}function WG(a,e){let s=[],u=[],d=0,m=[];for(let g of a){d=s.length;let v=g.vertexArray.float32,b=g.indexArray.uint16;for(let w=0;w<g.vertexArray.length;w++)m[0]=v[3*w+0],m[1]=v[3*w+1],m[2]=v[3*w+2],pr(m,m,e),s.push(new ct(m[0],m[1]));for(let w=0;w<3*g.indexArray.length;w++)u.push(b[w]+d)}if(u.length%3!=0)return null;for(let g=0;g<u.length;g+=3){let v=s[u[g+0]],b=s[u[g+1]],w=s[u[g+2]];(v.x-b.x)*(w.y-b.y)-(w.x-b.x)*(v.y-b.y)>0&&([u[g+1],u[g+2]]=[u[g+2],u[g+1]])}return{vertices:s,indices:u}}function kI(a){let e=(function(b,w){let S=[],D=WebGL2RenderingContext;if(b.json.textures)for(let I of b.json.textures){let R={magFilter:D.LINEAR,minFilter:D.NEAREST,wrapS:D.REPEAT,wrapT:D.REPEAT};I.sampler!==void 0&&Object.assign(R,b.json.samplers[I.sampler]),S.push({image:w[I.source],sampler:R,uploaded:!1})}return S})(a,a.images),s=(function(b,w){let S=[];for(let D of b.json.meshes){let I=[];for(let R of D.primitives)I.push($G(R,b,w));S.push(I)}return S})(a,e),{scenes:u,scene:d,nodes:m}=a.json,g=u?u[d||0].nodes:[...m.keys()],v=[];for(let b of g)v.push(tL(m[b],a,s));return(function(b,w,S){let D={},I=new Set;for(let R=0;R<b.length;R++){let k=S[w[R]];if(!k.extras)continue;let B=k.extras["mapbox:footprint:version"],U=k.extras["mapbox:footprint:id"];(B||U)&&I.add(R),B==="1.0.0"&&U&&(D[U]=R)}for(let R=0;R<b.length;R++){if(I.has(R))continue;let k=b[R],B=S[w[R]];if(!B.extras)continue;let U=null;k.id in D&&(U=WG(b[D[k.id]].meshes,k.localMatrix)),U||(U=qG(B)),U&&(k.footprint=GG(U))}if(I.size>0){let R=Array.from(I.values()).sort((k,B)=>k-B);for(let k=R.length-1;k>=0;k--)b.splice(R[k],1)}})(v,g,a.json.nodes),v}function ZG(a){a.heightmap=new Float32Array(4096),a.heightmap.fill(-1);let e=a.vertexArray.float32,s=a.aabb.min[0]-1,u=a.aabb.min[1]-1,d=Cm/(a.aabb.max[0]-s+2),m=Cm/(a.aabb.max[1]-u+2);for(let g=0;g<e.length;g+=3){let v=e[g+2],b=(e[g+0]-s)*d|0,w=(e[g+1]-u)*m|0;v>a.heightmap[w*Cm+b]&&(a.heightmap[w*Cm+b]=v)}}function nL(a,e,s,u,d){s.reserve(s.length+4*a.length),u.reserve(u.length+10*a.length),d.reserve(d.length+10*a.length);let m=u.length;for(let g of a){let v=Math.min(10,Math.max(4,1.3*g.height))*e,b=[-g.normal[1],g.normal[0],0],w=Math.min(.29,.1*g.width/g.depth),S=g.width-2*g.depth*e*(w+.01),D=Do([],g.pos,b,S/2),I=Do([],g.pos,b,-S/2),R=[D[0],D[1],D[2]+g.height],k=[I[0],I[1],I[2]+g.height],B=Do([],g.normal,b,w);Ui(B,B,v);let U=Do([],g.normal,b,-w);Ui(U,U,v),Pr(B,D,B),Pr(U,I,U),D[2]+=.1,I[2]+=.1,u.emplaceBack(B[0],B[1],B[2]),u.emplaceBack(U[0],U[1],U[2]),u.emplaceBack(D[0],D[1],D[2]),u.emplaceBack(I[0],I[1],I[2]),u.emplaceBack(R[0],R[1],R[2]),u.emplaceBack(k[0],k[1],k[2]),u.emplaceBack(D[0],D[1],D[2]),u.emplaceBack(I[0],I[1],I[2]),u.emplaceBack(B[0],B[1],B[2]),u.emplaceBack(U[0],U[1],U[2]);let G=S/v/2;d.emplaceBack(-G-w,-1,G,.8),d.emplaceBack(G+w,-1,G,.8),d.emplaceBack(-G,0,G,1.3),d.emplaceBack(G,0,G,1.3),d.emplaceBack(G+w,-.8,G,.7),d.emplaceBack(G+w,-.8,G,.7),d.emplaceBack(0,0,G,1.3),d.emplaceBack(0,0,G,1.3),d.emplaceBack(G+w,-1.2,G,.8),d.emplaceBack(G+w,-1.2,G,.8),s.emplaceBack(6+m,4+m,8+m),s.emplaceBack(7+m,9+m,5+m),s.emplaceBack(0+m,1+m,2+m),s.emplaceBack(1+m,3+m,2+m),m+=10}}function XG(a,e){let s={};s.indexArray=new mr,s.vertexArray=new Qa,s.colorArray=new cd,nL(a,e,s.indexArray,s.vertexArray,s.colorArray);let u={defined:!0};u.emissiveFactor=Qn.black;let d={};return d.baseColorFactor=Qn.white,u.pbrMetallicRoughness=d,s.material=u,s.aabb=new kn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),s}let iL=Bn([{name:"a_pos_3f",components:3,type:"Float32"}]),YG=Bn([{name:"a_normal_3",components:3,type:"Int16"}]),KG=Bn([{name:"a_centroid_3",components:3,type:"Int16"}]),rL=Bn([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),JG=Bn([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),QG=Bn([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),eq=Bn([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),tq=Bn([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),nq=Bn([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),oL=at.types,zw=32767;function iq(a,e){let s=yt+e;for(let u of a)for(let d of u)if(d.x<-e||d.x>s||d.y<-e||d.y>s)return!1;return!0}class sL{constructor(){this.layoutVertexArray=new Qa,this.layoutAttenuationArray=new cd,this.layoutColorArray=new Sl,this.indexArray=new mr,this.indexArrayForConflation=new mr,this.segmentsBucket=new wr}}class FI{constructor(){this.layoutVertexArray=new Qa,this.layoutNormalArray=new xh,this.layoutCentroidArray=new xh,this.layoutColorArray=new Sl,this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.layoutFloodLightDataArray=new g_,this.layoutAOArray=new ru,this.indexArray=new mr,this.indexArrayForConflation=new mr,this.segmentsBucket=new wr,this.entranceBloom=new sL}}class aL{constructor(e){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.buildingWithoutFacade=new FI,this.buildingWithFacade=new FI,this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.footprintLookup={},this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=e.index,this.hasPattern=!1,this.worldview=e.worldview,this.lut=e.lut,this.buildingWithFacade.layoutFacadePaintArray=new Sl,this.buildingWithFacade.layoutFacadeDataArray=new bh,this.buildingWithFacade.layoutFacadeVerticalRangeArray=new Sl,this.programConfigurations=new Xl(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.projection=e.projection,this.groundEffect=new yI(e),this.groundEffect.groundRadiusArray=new ru,this.hasAppearances=null}updateFootprints(e,s){for(let u of this.footprints)s.push({footprint:u,id:e})}updateAppearances(e,s,u,d){}prepare(){return(function(){if(Aw!=null||jF!=null)return null;if(P_!=null)return P_;let e=fetch(tr.BUILDING_GEN_URL);return P_=(function(s){let u,d,m,g;function v(){u=new Uint8Array(g.buffer),d=new Int32Array(g.buffer),m=new Float32Array(g.buffer)}function b(){throw new Error("Unexpected BuildingGen error.")}let w=()=>{},S={a:{a:b,f:function(D){let I=u.length,R=Math.max(D>>>0,Math.ceil(1.2*I)),k=Math.ceil((R-I)/65536);try{return g.grow(k),v(),!0}catch{return!1}},g:b,b:w,c:w,d:w,e:w}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(s,S):s.then(D=>D.arrayBuffer()).then(D=>WebAssembly.instantiate(D,S))).then(D=>{let I=D.instance.exports;return(0,I.g)(),g=I.f,v(),new MG({setStyle:I.h,setAOOptions:I.i,setMetricOptions:I.j,setStructuralOptions:I.k,setFacadeOptions:I.l,setFauxFacadeOptions:I.m,setFacadeClassifierOptions:I.n,addFeature:I.o,addFacade:I.p,generateMesh:I.q,getLastError:I.r,getOuterRingLength:I.s,getMeshCount:I.t,getPositionsPtr:I.u,getPositionsLength:I.v,getNormalsPtr:I.w,getNormalsLength:I.x,getColorsPtr:I.y,getColorsLength:I.z,getAOPtr:I.A,getAOLength:I.B,getUVPtr:I.C,getUVLength:I.D,getFauxFacadePtr:I.E,getFauxFacadeLength:I.F,getIndicesPtr:I.G,getIndicesLength:I.H,getBuildingPart:I.I,getRingCount:I.J,getRingPtr:I.K,getRingLength:I.L,free:I.M,malloc:I.N,heapU8:u,heap32:d,heapF32:m})})})(e).then(s=>(P_=null,Aw=s,Aw)).catch(s=>{Gt("Could not load building-gen"),P_=null,jF=s}),P_})()}populate(e,s,u,d){let m=AG();if(!m)return;let g=xe(u);this.tileToMeter=g,this.brightness=s.brightness,m.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,g],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:g,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),m.setAOOptions(!1,.3),m.setMetricOptions(!1,16),m.setStructuralOptions(!0),m.setFacadeClassifierOptions(3);let v=new Map,b=new Map;for(let{feature:w}of e){if(oL[w.type]!=="LineString"){v.set(w.id,w.properties.source_id);continue}let S=this.layers[0]._featureFilter.needGeometry,D=Ue(w,S);if(!this.layers[0]._featureFilter.filter(new or(this.zoom),D,u))continue;let I=S?D.geometry:Je(w,u,d),R=[];for(let G of I)for(let J of G)R.push({x:J.x,y:J.y});let k={coordinates:R,crossPerc:w.properties.cross_perc,distanceToRoad:w.properties.distance_to_road,entrances:w.properties.entrances,sourceId:0},B=w.properties.source_id,U=b.get(B);U||(U=[],b.set(B,U)),U.push(k)}this.maxHeight=0;for(let{feature:w,id:S,index:D,sourceLayerIndex:I}of e){if(oL[w.type]==="LineString")continue;let R=this.layers[0]._featureFilter.needGeometry,k=Ue(w,R);if(!this.layers[0]._featureFilter.filter(new or(this.zoom),k,u))continue;let B=R?k.geometry:Je(w,u,d),U=Fy(B,500);if(!iq(B,163))continue;let G=this.layers[0],J=G.layout.get("building-roof-shape").evaluate(w,{},u);if(J==="flat")continue;let ee=G.layout.get("building-base").evaluate(w,{},u),se=G.layout.get("building-height").evaluate(w,{},u),_e=G.layout.get("building-flood-light-ground-radius").evaluate(w,{},u),fe=G.paint.get("building-ambient-occlusion-intensity"),we=_e/this.tileToMeter,Ee=G.layout.get("building-flood-light-wall-radius").evaluate(w,{},u);Ee=X(Ee,0,2048);let Se=Ee/2048*zw,We=v.get(S),Fe;Fe=b.has(We)?b.get(We):[];let Ze=Fe.length!==0&&G.layout.get("building-facade").evaluate(w,{},u);m.setFacadeOptions(4,!0),m.setFauxFacadeOptions(Ze,!1,1);let Qe=0,rt=0,vt=0,dt=0,et=0,ut=0;if(Ze){let Ye=Math.round(G.layout.get("building-facade-floors").evaluate(w,{},u));if(ee===0){Ye=Math.max(1,Ye-(Fe.length>0?1:0));let Yt=4;if(se>100){let Xt=[10,13,15];Yt=Xt[w.id?w.id%Xt.length:0],m.setFacadeOptions(Yt,!0)}et=1.6803*Yt/g}else et=ee/g;ut=se/g,et=Math.min(et,ut),vt=G.layout.get("building-facade-unit-width").evaluate(w,{},u)/g,dt=(ut-et)/Ye,m.setFauxFacadeOptions(!0,!0,vt);let Dt=G.layout.get("building-facade-window").evaluate(w,{},u);Qe=Dt[0],rt=Dt[1]}let Ge=[],$e=new ct(1/0,1/0),lt=new ct(-1/0,-1/0),gt=new ct(0,0),it=0;for(let Ye of U)if(Ye.length>0){let Dt=[];for(let Yt of Ye){let Xt=[];for(let En=Yt.length-1;En>=0;En--){let cn=Yt[En];Xt.push({x:cn.x,y:cn.y}),$e.x=Math.min($e.x,cn.x),$e.y=Math.min($e.y,cn.y),lt.x=Math.max(lt.x,cn.x),lt.y=Math.max(lt.y,cn.y),gt.x+=cn.x,gt.y+=cn.y,it++}Dt.push(Xt)}Ge.push({id:w.id?w.id:0,height:se,minHeight:ee,sourceId:0,roofType:J,coordinates:Dt})}gt.x/=it||1,gt.y/=it||1;let Nt=m.generateMesh(Ge,Fe);if(typeof Nt=="string"){Gt(`Unable to generate building ${w.id}: ${Nt}`);continue}if(Nt.meshes.length===0||Nt.modifiedPolygonRings.length===0)continue;let Ut=0;for(let Ye of Nt.meshes)Ut+=Ye.positions.length/3;let Pt=Ze?this.buildingWithFacade:this.buildingWithoutFacade,St=Pt.segmentsBucket.prepareSegment(Ut,Pt.layoutVertexArray,Pt.indexArray),yn=[],It=null,rn=0,xn=-1,Nn=Pt.layoutVertexArray.length,ri=Pt.indexArray.length,wn=0;for(let Ye of Nt.meshes){let Dt=Pt.layoutVertexArray.length;if(Ye.buildingPart==="entrance"){let qt=new Array;for(let ni=0;ni<Ye.positions.length;ni+=12){let Gi=Ye.positions[ni+0],Ti=Ye.positions[ni+1],Ir=Ye.positions[ni+3],dr=Ye.positions[ni+4],nr=Ye.positions[ni+2],Oi=Ye.positions[ni+8]-nr,mi=1,Tn=Ir-Gi,gi=dr-Ti,ir=Math.hypot(Tn,gi);qt.push({pos:[Gi+.5*Tn,Ti+.5*gi,nr],normal:[gi/ir,-Tn/ir,0],width:ir,height:Oi,depth:mi,points:[Gi,Ti,Ir,dr]})}let ui=Pt.entranceBloom.segmentsBucket.prepareSegment(10*qt.length,Pt.entranceBloom.layoutVertexArray,Pt.entranceBloom.indexArray),$i=Pt.entranceBloom.layoutVertexArray.length;rn=Pt.entranceBloom.indexArray.length,nL(qt,.5/this.tileToMeter,Pt.entranceBloom.indexArray,Pt.entranceBloom.layoutVertexArray,Pt.entranceBloom.layoutAttenuationArray);let hn=Pt.entranceBloom.layoutVertexArray.length-$i;xn=Pt.entranceBloom.indexArray.length-rn;for(let ni=0;ni<hn;ni++)Pt.entranceBloom.layoutColorArray.emplaceBack(65535,65535);ui.vertexLength+=hn,ui.primitiveLength+=xn,It={part:Ye.buildingPart,vertexOffset:$i,vertexLength:hn}}for(let qt=0;qt<Ye.positions.length;qt+=3)wn=Math.max(wn,Ye.positions[qt+2]),Pt.layoutVertexArray.emplaceBack(Ye.positions[qt],Ye.positions[qt+1],Ye.positions[qt+2]);let Yt=Math.floor(gt.x),Xt=Math.floor(gt.y),En=Math.floor(wn);for(let qt=0;qt<Ye.positions.length;qt+=3)Pt.layoutCentroidArray.emplaceBack(Yt,Xt,En),Pt.layoutFloodLightDataArray.emplaceBack(Ye.buildingPart==="wall"?Se:0);for(let qt=0;qt<Ye.normals.length;qt+=3)Pt.layoutNormalArray.emplaceBack(Ye.normals[qt+0]*zw,Ye.normals[qt+1]*zw,Ye.normals[qt+2]*zw);for(let qt=0;qt<Ye.ao.length;qt++)Pt.layoutAOArray.emplaceBack(Ye.ao[qt]);for(let qt=0;qt<Ye.colors.length;qt+=3){let ui=1+(Ye.ao[qt/3]-1)*fe;Pt.layoutColorArray.emplaceBack(Ye.colors[qt]*ui<<8|Ye.colors[qt+1]*ui,Ye.colors[qt+2]*ui<<8)}if(Ze){for(let qt=0;qt<Ye.positions.length;qt+=3)Pt.layoutFacadePaintArray.emplaceBack(65535,255);for(let qt=0;qt<Ye.isFauxFacade.length;qt++)if(Ye.isFauxFacade[qt]){let ui=1|Math.min(65535,Math.floor(Ye.uv[2*qt]*Nt.outerRingLength)),$i=Math.floor(255*Qe)<<8|Math.floor(255*rt),hn=Math.floor(65535*Math.min(1,vt/yt)),ni=Math.floor(65535*Math.min(1,dt/yt));Pt.layoutFacadeDataArray.emplaceBack(ui,$i,hn,ni);let Gi=Math.floor(65535*Math.min(1,et/yt)),Ti=Math.floor(65535*Math.min(1,ut/yt));Pt.layoutFacadeVerticalRangeArray.emplaceBack(Gi,Ti)}else Pt.layoutFacadeDataArray.emplaceBack(0,0,0,0),Pt.layoutFacadeVerticalRangeArray.emplaceBack(0,0)}let cn=St.vertexLength;for(let qt=0;qt<Ye.indices.length;qt+=3)Pt.indexArray.emplaceBack(cn+Ye.indices[qt],cn+Ye.indices[qt+1],cn+Ye.indices[qt+2]);St.vertexLength+=Ye.positions.length/3,St.primitiveLength+=Ye.indices.length/3,(Ye.buildingPart==="roof"||Ye.buildingPart==="wall"||Ye.buildingPart==="facade_glazing"||Ye.buildingPart==="entrance")&&yn.push({part:Ye.buildingPart,vertexOffset:Dt,vertexLength:Ye.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,wn),this.buildingFeatures.push({promoteId:S,feature:k,hasFauxFacade:Ze,segment:St,parts:yn,buildingBloom:It});let fi=Pt.indexArray.length-ri,pi=[],xr=[],pe=new ct(1/0,1/0),ue=new ct(-1/0,-1/0),Xe=this.groundEffect.vertexArray.length;for(let Ye of Nt.modifiedPolygonRings){let Dt=[],Yt=new ct(1/0,1/0),Xt=new ct(-1/0,-1/0);for(let En=0;En<Ye.length;En+=2){let cn=Ye.length-En-2;Yt.x=Math.min(Yt.x,Ye[cn]),Yt.y=Math.min(Yt.y,Ye[cn+1]),Xt.x=Math.max(Xt.x,Ye[cn]),Xt.y=Math.max(Xt.y,Ye[cn+1]);let qt=new ct(Ye[cn],Ye[cn+1]);Dt.push(qt),pi.push(qt.x,qt.y),xr.push(qt.clone())}pe.x=Math.min(pe.x,Yt.x),pe.y=Math.min(pe.y,Yt.y),ue.x=Math.max(ue.x,Xt.x),ue.y=Math.max(ue.y,Xt.y),this.groundEffect.addData(Dt,[Yt,Xt],we)}let Et=this.groundEffect.vertexArray.length-Xe;for(let Ye=0;Ye<Et;Ye++)this.groundEffect.groundRadiusArray.emplaceBack(_e);($e.x<0||lt.x>yt||$e.y<0||lt.y>yt)&&this.featuresOnBorder.push({featureId:w.id,footprintIndex:this.footprints.length});{let Ye=S_(pi,null,2),Dt=new ww(xr,Ye,8,256),Yt=w.id;w.properties&&w.properties.hasOwnProperty("building_id")&&(Yt=w.properties.building_id);let Xt={vertices:xr,indices:Ye,grid:Dt,min:pe,max:ue,buildingId:Yt,hiddenFlags:0,indicesOffset:ri,indicesLength:fi,bloomIndicesOffset:rn,bloomIndicesLength:xn,groundEffectVertexOffset:Xe,groundEffectVertexLength:Et,hasFauxFacade:Ze,segment:St,height:wn};w.id!==void 0&&this.featureFootprintLookup.set(w.id,this.footprints.length),this.footprints.push(Xt)}this.programConfigurations.populatePaintArrays(Pt.layoutVertexArray.length,w,D,{},s.availableImages,u,s.brightness),this.groundEffect.addPaintPropertiesData(w,D,{},s.availableImages,u,s.brightness),s.featureIndex.insert(w,B,D,I,this.index,Nn)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0],{})}update(e,s,u,d,m,g,v){this.programConfigurations.updatePaintArrays(e,s,m,u,d,g,v),this.groundEffect.update(e,s,m,u,d,g,v),this.evaluate(this.layers[0],e),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){let s=u=>{u.layoutVertexBuffer=e.createVertexBuffer(u.layoutVertexArray,iL.members),u.layoutNormalBuffer=e.createVertexBuffer(u.layoutNormalArray,YG.members),u.layoutCentroidBuffer=e.createVertexBuffer(u.layoutCentroidArray,KG.members),u.layoutFloodLightDataBuffer=e.createVertexBuffer(u.layoutFloodLightDataArray,nq.members),u.layoutFacadeDataArray&&u.layoutFacadeDataArray.length&&(u.layoutFacadeDataBuffer=e.createVertexBuffer(u.layoutFacadeDataArray,QG.members)),u.layoutFacadeVerticalRangeArray&&u.layoutFacadeVerticalRangeArray.length&&(u.layoutFacadeVerticalRangeBuffer=e.createVertexBuffer(u.layoutFacadeVerticalRangeArray,eq.members)),u.entranceBloom.layoutVertexArray.length&&(u.entranceBloom.layoutVertexBuffer=e.createVertexBuffer(u.entranceBloom.layoutVertexArray,iL.members),u.entranceBloom.layoutAttenuationBuffer=e.createVertexBuffer(u.entranceBloom.layoutAttenuationArray,tq.members)),this.uploadUpdatedColorBuffer(e),this.uploadUpdatedIndexBuffer(e)};this.uploaded||(s(this.buildingWithoutFacade),s(this.buildingWithFacade),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){let e=s=>{s.layoutVertexBuffer&&(s.layoutVertexBuffer.destroy(),s.layoutNormalBuffer.destroy(),s.layoutColorBuffer.destroy(),s.segmentsBucket.destroy(),s.indexBuffer&&s.indexBuffer.destroy(),s.entranceBloom.layoutVertexBuffer&&(s.entranceBloom.layoutVertexBuffer.destroy(),s.entranceBloom.layoutColorBuffer.destroy(),s.entranceBloom.layoutAttenuationBuffer.destroy(),s.entranceBloom.indexBuffer.destroy(),s.entranceBloom.segmentsBucket.destroy()))};e(this.buildingWithoutFacade),e(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(e,s,u=!0){let d=!1,m=u?s:0,g=0|(u?-1:~s);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let v of e){let b=this.footprints[v],w=b.hiddenFlags&g|m;b.hiddenFlags!==w&&(b.hiddenFlags=w,d=!0,this.groundEffect.updateHiddenByLandmarkRange(b.groundEffectVertexOffset,b.groundEffectVertexLength,b.hiddenFlags!==0))}return d&&(this.indexArrayForConflationUploaded=!1),d}uploadUpdatedIndexBuffer(e){if(this.groundEffect.uploadHiddenByLandmark(e),this.indexArrayForConflationUploaded)return;let s=d=>{d.indexArray.length!==0&&(d.indexArrayForConflation.resize(d.indexArray.length),d.indexArrayForConflation.uint16.set(d.indexArray.uint16),d.entranceBloom.indexArrayForConflation.resize(d.entranceBloom.indexArray.length),d.entranceBloom.indexArrayForConflation.uint16.set(d.entranceBloom.indexArray.uint16))};s(this.buildingWithoutFacade),s(this.buildingWithFacade);for(let d of this.footprints){let m=d.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,g=d.indicesOffset+d.indicesLength;if(d.hiddenFlags!==0){for(let b=d.indicesOffset;b<g;b++)m.indexArrayForConflation.uint16[3*b+0]=0,m.indexArrayForConflation.uint16[3*b+1]=0,m.indexArrayForConflation.uint16[3*b+2]=0;let v=d.bloomIndicesOffset+d.bloomIndicesLength;for(let b=d.bloomIndicesOffset;b<v;b++)m.entranceBloom.indexArrayForConflation.uint16[3*b+0]=0,m.entranceBloom.indexArrayForConflation.uint16[3*b+1]=0,m.entranceBloom.indexArrayForConflation.uint16[3*b+2]=0}}let u=d=>{d.indexArray.length!==0&&(d.indexBuffer?d.indexBuffer.updateData(d.indexArrayForConflation):d.indexBuffer=e.createIndexBuffer(d.indexArrayForConflation,!0),d.entranceBloom.indexBuffer?d.entranceBloom.indexBuffer.updateData(d.entranceBloom.indexArrayForConflation):d.entranceBloom.indexBuffer=e.createIndexBuffer(d.entranceBloom.indexArrayForConflation,!0))};u(this.buildingWithoutFacade),u(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(e){let s=u=>{u.layoutColorBuffer?u.layoutColorBuffer.updateData(u.layoutColorArray):u.layoutColorBuffer=e.createVertexBuffer(u.layoutColorArray,rL.members,!0),u.layoutFacadePaintArray&&(u.layoutFacadePaintBuffer?u.layoutFacadePaintBuffer.updateData(u.layoutFacadePaintArray):u.layoutFacadePaintBuffer=e.createVertexBuffer(u.layoutFacadePaintArray,JG.members,!0)),u.entranceBloom.layoutColorBuffer?u.entranceBloom.layoutColorBuffer.updateData(u.entranceBloom.layoutColorArray):u.entranceBloom.layoutColorBuffer=e.createVertexBuffer(u.entranceBloom.layoutColorArray,rL.members,!0)};s(this.buildingWithoutFacade),s(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(e,s){let u=e.paint.get("building-ambient-occlusion-intensity");for(let d of this.buildingFeatures){let m=s[d.promoteId],g=d.feature;g.properties["building-part"]="roof";let v=e.paint.get("building-color").evaluate(g,m,this.canonical).toPremultipliedRenderColor(this.lut),b=e.paint.get("building-emissive-strength").evaluate(g,m,this.canonical);g.properties["building-part"]="wall";let w=e.paint.get("building-color").evaluate(g,m,this.canonical).toPremultipliedRenderColor(this.lut),S=e.paint.get("building-emissive-strength").evaluate(g,m,this.canonical);g.properties["building-part"]="window";let D=e.paint.get("building-color").evaluate(g,m,this.canonical).toPremultipliedRenderColor(this.lut),I=e.paint.get("building-emissive-strength").evaluate(g,m,this.canonical);g.properties["building-part"]="door";let R=e.paint.get("building-color").evaluate(g,m,this.canonical).toPremultipliedRenderColor(this.lut),k=e.paint.get("building-emissive-strength").evaluate(g,m,this.canonical),B=d.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(let G of d.parts){let J,ee=v;G.part==="roof"?(ee=v,J=b):G.part==="wall"?(ee=w,J=S):G.part==="facade_glazing"?(ee=D,J=I):G.part==="entrance"&&(ee=R,J=k),J=X(J,0,1);for(let se=0;se<G.vertexLength;se++){let _e=G.vertexOffset+se,fe=1+(B.layoutAOArray.float32[_e]-1)*u;B.layoutColorArray.emplace(_e,ee.r*fe*255<<8|ee.g*fe*255,ee.b*fe*255<<8|255*J),d.hasFauxFacade&&B.layoutFacadePaintArray.emplace(_e,255*D.r<<8|255*D.g,255*D.b<<8|255*I)}}let U=d.buildingBloom;if(U)for(let G=0;G<U.vertexLength;G++)B.entranceBloom.layoutColorArray.emplace(U.vertexOffset+G,255*R.r<<8|255*R.g,255*R.b<<8|51*k)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(e,s,u){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;let d=s.getReplacementRegionsForTile(e.toUnwrapped());if(Ew(this.activeReplacements,d))return;this.activeReplacements=d;for(let g of this.footprints)g.hiddenFlags&=-2;let m=[];for(let g of this.activeReplacements){if(g.order<=lF)continue;let v=Math.max(1,Math.pow(2,g.footprintTileId.canonical.z-e.canonical.z));for(let b of this.footprints)b.min.x>g.max.x||b.max.x<g.min.x||b.min.y>g.max.y||b.max.y<g.min.y||(m.length=0,rq(b.vertices,0,b.vertices.length,g.footprintTileId.canonical,e.canonical,m),mI(g.footprint,m,b.indices,0,b.indices.length,0,-v)&&(b.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let g of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(g.groundEffectVertexOffset,g.groundEffectVertexLength,g.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(e){if(e.id!==void 0){let s=this.featureFootprintLookup.get(e.id);return this.footprints[s]}return null}getHeightAtTileCoord(e,s){let u=Number.NEGATIVE_INFINITY,d=!0,m=4*(e+yt)*yt+(s+yt);if(this.footprintLookup.hasOwnProperty(m)){let v=this.footprintLookup[m];return v?{height:v.height,hidden:v.hiddenFlags!==0}:void 0}let g=new ct(e,s);for(let v of this.footprints)e>v.max.x||v.min.x>e||s>v.max.y||v.min.y>s||v.height<=u||gI(g,v)&&(u=v.height,this.footprintLookup[m]=v,d=v.hiddenFlags!==0);if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:d};this.footprintLookup[m]=void 0}}function rq(a,e,s,u,d,m){let g=Math.pow(2,u.z-d.z);for(let v=0;v<s;v++){let b=a[v+e].x,w=a[v+e].y;b=(b+d.x*yt)*g-u.x*yt,w=(w+d.y*yt)*g-u.y*yt,m.push(new ct(b,w))}}let lL,cL;Bt(aL,"BuildingBucket",{omit:["layers"]}),Bt(FI,"BuildingGeometry"),Bt(sL,"BuildingBloomGeometry");let oq=Bn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),sq=Bn([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:aq}=oq,lq=Bn([{name:"a_packed",components:3,type:"Float32"}]),{members:cq}=lq,uq=Bn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:dq}=uq;class uL{constructor(e,s){this.width=e,this.height=s,this.nextRow=0,this.image=new Wf({width:e,height:s}),this.positions={},this.uploaded=!1}getDash(e,s){let u=this.getKey(e,s);return this.positions[u]}trim(){let e=this.width,s=this.height=Pe(this.nextRow);this.image.resize({width:e,height:s})}getKey(e,s){return e.join(",")+s}getDashRanges(e,s,u){let d=[],m=e.length%2==1?-e[e.length-1]*u:0,g=e[0]*u,v=!0;d.push({left:m,right:g,isDash:v,zeroLength:e[0]===0});let b=e[0];for(let w=1;w<e.length;w++){v=!v;let S=e[w];m=b*u,b+=S,g=b*u,d.push({left:m,right:g,isDash:v,zeroLength:S===0})}return d}addRoundDash(e,s,u){let d=s/2;for(let m=-u;m<=u;m++){let g=this.width*(this.nextRow+u+m),v=0,b=e[v];for(let w=0;w<this.width;w++){w/b.right>1&&(b=e[++v]);let S=Math.abs(w-b.left),D=Math.abs(w-b.right),I=Math.min(S,D),R,k=m/u*(d+1);if(b.isDash){let B=d-Math.abs(k);R=Math.sqrt(I*I+B*B)}else R=d-Math.sqrt(I*I+k*k);this.image.data[g+w]=Math.max(0,Math.min(255,R+128))}}}addRegularDash(e,s){for(let b=e.length-1;b>=0;--b){let w=e[b],S=e[b+1];w.zeroLength?e.splice(b,1):S&&S.isDash===w.isDash&&(S.left=w.left,e.splice(b,1))}let u=e[0],d=e[e.length-1];u.isDash===d.isDash&&(u.left=d.left-this.width,d.right=u.right+this.width);let m=this.width*this.nextRow,g=0,v=e[g];for(let b=0;b<this.width;b++){b/v.right>1&&(v=e[++g]);let w=Math.abs(b-v.left),S=Math.abs(b-v.right),D=Math.min(w,S);this.image.data[m+b]=Math.max(0,Math.min(255,(v.isDash?D:-D)+s+128))}}addDash(e,s){let u=this.getKey(e,s);if(this.positions[u])return this.positions[u];let d=s==="round",m=d?7:0,g=2*m+1;if(this.nextRow+g>this.height)return Gt("LineAtlas out of space"),null;e.length===0&&e.push(1);let v=0;for(let S=0;S<e.length;S++)e[S]<0&&(Gt("Negative value is found in line dasharray, replacing values with 0"),e[S]=0),v+=e[S];if(v!==0){let S=this.width/v,D=this.getDashRanges(e,this.width,S);d?this.addRoundDash(D,S,m):this.addRegularDash(D,s==="square"?.5*S:0)}let b=this.nextRow+m;this.nextRow+=g;let w={tl:[b,m],br:[v,0]};return this.positions[u]=w,w}}Bt(uL,"LineAtlas");let hq=at.types,fq=Math.cos(Math.PI/180*37.5),pq=Math.cos(Math.PI/180*5);class LI{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new h_,this.layoutVertexArray2=new Qa,this.patternVertexArray=new Qa,this.indexArray=new mr,this.programConfigurations=new Xl(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new wr,this.maxLineLength=0,this.zOffsetVertexArray=new Qa,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:yt/64,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,s){}updateAppearances(e,s,u,d){}populate(e,s,u,d){this.hasPattern=cI("line",this.layers,this.pixelRatio,s);let m=this.layers[0].layout.get("line-sort-key");this.tileToMeter=xe(u);let g=this.layers[0].layout.get("line-elevation-reference");if(g==="hd-road-markup")this.elevationType="road";else{let I=this.layers[0].layout.get("line-z-offset"),R=I.isConstant()&&!I.constantOr(0);this.elevationType=g!=="sea"&&g!=="ground"&&R?"none":"offset",this.elevationType==="offset"&&g==="none"&&Gt(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}let v=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&v!==void 0;let b=[];for(let{feature:I,id:R,index:k,sourceLayerIndex:B}of e){let U=this.layers[0]._featureFilter.needGeometry,G=Ue(I,U);if(!this.layers[0]._featureFilter.filter(new or(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),G,u))continue;let J=m?m.evaluate(G,{},u):void 0,ee={id:R,properties:I.properties,type:I.type,sourceLayerIndex:B,index:k,geometry:U?G.geometry:Je(I,u,d),patterns:{},sortKey:J};b.push(ee)}m&&b.sort((I,R)=>I.sortKey-R.sortKey);let{lineAtlas:w,featureIndex:S}=s,D=this.addConstantDashes(w);for(let I of b){let{geometry:R,index:k,sourceLayerIndex:B}=I;if(D&&this.addFeatureDashes(I,w),this.hasPattern){let U=uI("line",this.layers,I,this.zoom,this.pixelRatio,s);this.patternFeatures.push(U)}else this.addFeature(I,R,k,u,w.positions,s.availableImages,s.brightness,s.elevationFeatures);S.insert(e[k].feature,R,k,B,this.index)}}addConstantDashes(e){let s=!1;for(let u of this.layers){let d=u.paint.get("line-dasharray").value,m=u.layout.get("line-cap").value;if(d.kind!=="constant"||m.kind!=="constant")s=!0;else{let g=m.value,v=d.value;if(!v)continue;e.addDash(v,g)}}return s}addFeatureDashes(e,s){let u=this.zoom;for(let d of this.layers){let m=d.paint.get("line-dasharray").value,g=d.layout.get("line-cap").value;if(m.kind==="constant"&&g.kind==="constant")continue;let v,b;if(m.kind==="constant"){if(v=m.value,!v)continue}else v=m.evaluate({zoom:u},e);b=g.kind==="constant"?g.value:g.evaluate({zoom:u},e),s.addDash(v,b),e.patterns[d.id]=[s.getKey(v,b)]}}update(e,s,u,d,m,g,v,b){this.programConfigurations.updatePaintArrays(e,s,m,u,d,g,v,b)}addFeatures(e,s,u,d,m,g){for(let v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,s,u,d,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,cq)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,dq)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,sq.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,aq),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e,s){let u,d;if(s&&s>0?(u=`mapbox_clip_start_${s}`,d=`mapbox_clip_end_${s}`):(u="mapbox_clip_start",d="mapbox_clip_end"),e.properties&&e.properties.hasOwnProperty(u)&&e.properties.hasOwnProperty(d))return{start:+e.properties[u],end:+e.properties[d]}}addFeature(e,s,u,d,m,g,v,b){let w=this.layers[0].layout,S=w.get("line-join").evaluate(e,{}),D=w.get("line-cap").evaluate(e,{}),I=w.get("line-miter-limit"),R=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e;let k=!(!e.properties||!e.properties.hasOwnProperty("mapbox_line_metrics"))&&e.properties.mapbox_line_metrics;this.zOffsetValue=w.get("line-z-offset").value;let B=this.layers[0].paint.get("line-width").value;if(B.kind!=="constant"&&B.isLineProgressConstant===!1&&(this.variableWidthValue=B),this.elevationType==="road"){let U=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,s,d,b,S,D,I,R)){let[G,J]=this.clipRuntimeLinesToTile(s,1);for(let ee=0;ee<G.length;ee++){let se=G[ee],_e=J[ee],fe={progress:{min:_e.progress.min,max:_e.progress.max},nextDir:this.computeSegNextDir(_e,se),prevDir:this.computeSegPrevDir(_e,se)};this.addLine(se,e,d,S,D,I,R,fe,k&&_e.parentIndex>0?_e.parentIndex:null)}this.fillNonElevatedRoadSegment(U)}}else for(let U=0;U<s.length;U++)this.addLine(s[U],e,d,S,D,I,R,void 0,k&&U>0?U:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,u,m,g,d,v,void 0,this.worldview)}computeSegNextDir(e,s){return e.nextPoint.sub(s.at(-2)).unit()}computeSegPrevDir(e,s){return s[1].sub(e.prevPoint).unit()}clipLinesToTile(e,s){return Dw(e,-s,-s,yt+s,yt+s)}clipRuntimeLinesToTile(e,s){let u=[];return[Dw(e,-s,-s,yt+s,yt+s,u),u]}addElevatedRoadFeature(e,s,u,d,m,g,v,b){let w=[],S=vn.getElevationFeature(e,d);if(S){let D=this.clipLinesToTile(s,1),I=this.prepareElevatedLines(D,S,u);for(let R of I)w.push({geometry:R,elevation:S,elevationTileID:u,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(w.length===0)return!1;for(let D of w){let I=this.layoutVertexArray.length;this.addLine(D.geometry,e,u,m,g,v,b);let R=new ii(u,D.elevationTileID);if(D.elevation)for(let k=I;k<this.layoutVertexArray.length;k++){let B=new ct(this.layoutVertexArray.int16[6*k]>>1,this.layoutVertexArray.int16[6*k+1]>>1),U=R.pointElevation(B,D.elevation,.05);this.updateHeightRange(U),this.zOffsetVertexArray.emplaceBack(U,0,0)}else this.fillNonElevatedRoadSegment(I)}return!0}prepareElevatedLines(e,s,u){if(s.constantHeight!=null)return e;let d=[],m=1/xe(u);for(let g of e)SG(g,new cr(s,m),0,d);return d}fillNonElevatedRoadSegment(e){for(let s=e;s<this.layoutVertexArray.length;s++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,s,u,d,m,g,v,b,w){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=w?this.lineFeatureClips(s,w):this.lineClips;let S=d==="none";this.patternJoinNone=this.hasPattern&&S,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];let D=b&&b.progress.min>0,I=b&&b.progress.max<1;if(this.lineClips){let Se={min:this.lineClips.start,max:this.lineClips.end},We=1;if(b){let Qe=this.lineClips.end-this.lineClips.start;Se=(function(rt,vt,dt){return{min:Ei(rt.min,vt,dt),max:Ei(rt.max,vt,dt)}})(b.progress,{min:0,max:1},Se),Qe>0&&(We=(Se.max-Se.min)/Qe)}let Fe=+s.properties.mapbox_clip_feature_len,Ze=+s.properties.mapbox_clip_seg_len;if(Number.isNaN(Fe)||Number.isNaN(Ze)){for(let rt=0;rt<e.length-1;rt++)this.totalDistance+=e[rt].dist(e[rt+1]);let Qe=this.totalDistance/(Se.max-Se.min);this.totalFeatureLength=Number.isFinite(Qe)?Qe:0,this.lineClips.start=Se.min,this.lineClips.end=Se.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Fe,this.distance=Ze*We,this.lineClips.start=Se.min,this.lineClips.end=Se.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}let R=hq[s.type]==="Polygon",k=e.length;for(;k>=2&&e[k-1].equals(e[k-2]);)k--;let B=0;for(;B<k-1&&e[B].equals(e[B+1]);)B++;if(k<(R?3:2))return;d==="bevel"&&(g=1.05);let U=this.segments.prepareSegment(10*k,this.layoutVertexArray,this.indexArray),G,J,ee,se,_e,fe,we,Ee;b&&b.prevDir&&(fe=b.prevDir.perp()),b&&b.nextDir&&(we=b.nextDir.perp()),this.e1=this.e2=-1,R&&(G=e[k-2],_e=e[B].sub(G)._unit()._perp());for(let Se=B;Se<k;Se++){if(ee=Se===k-1?R?e[B+1]:void 0:e[Se+1],ee&&e[Se].equals(ee))continue;_e&&(se=_e),G&&(J=G),G=e[Se],Ee=this.evaluateLineProgressFeatures(J?J.dist(G):0),_e=ee?ee.sub(G)._unit()._perp():se,se=se||_e;let We=J&&ee,Fe=We?d:R||S?"butt":m,Ze=se.x*_e.x+se.y*_e.y;if(S){let $e=function(lt){if(lt.patternJoinNone){let gt=lt.segmentPoints.length/2,it=lt.lineSoFar-lt.segmentStart;for(let Nt=0;Nt<gt;++Nt){let Ut=lt.segmentPoints[2*Nt+1],Pt=Math.round(lt.segmentPoints[2*Nt])+.5+.25*Ut;lt.patternVertexArray.emplaceBack(Pt,it,lt.segmentStart),lt.patternVertexArray.emplaceBack(Pt,it,lt.segmentStart)}lt.segmentPoints.length=0}lt.e1=lt.e2=-1};if(We&&Ze<pq){this.updateDistance(J,G),this.addCurrentVertex(G,se,1,1,U,Ee),$e(this),this.addCurrentVertex(G,_e,-1,-1,U,Ee);continue}if(J){if(!ee){this.updateDistance(J,G),this.addCurrentVertex(G,se,1,1,U,Ee),$e(this);continue}Fe="miter"}}let Qe=se.add(_e);Qe.x===0&&Qe.y===0||Qe._unit();let rt=Qe.x*_e.x+Qe.y*_e.y,vt=rt!==0?1/rt:1/0,dt=2*Math.sqrt(2-2*rt),et=rt<fq&&J&&ee,ut=se.x*_e.y-se.y*_e.x>0,Ge=this.overscaling<=16?15*yt/(512*this.overscaling):0;if(We&&Fe==="round"){if(vt<v)Fe="miter";else if(vt<=2){let $e=NI(G,-10,yt+10);Fe=this.elevationType==="offset"&&($e||this.hasCrossSlope)?"miter":"fakeround"}}if(Fe==="miter"&&vt>g&&(Fe="bevel"),Fe==="bevel"&&(vt>2&&(Fe="flipbevel"),vt<g&&(Fe="miter")),J&&!(Fe==="miter"&&et)&&this.updateDistance(J,G),Fe==="miter")if(et){let $e=G.dist(J);if($e>2*Ge){let gt=G.sub(G.sub(J)._mult(Ge/$e)._round());this.updateDistance(J,gt),this.addCurrentVertex(gt,se,0,0,U,Ee),J=gt}this.updateDistance(J,G),Qe._mult(vt),this.addCurrentVertex(G,Qe,0,0,U,Ee);let lt=G.dist(ee);if(lt>2*Ge){let gt=G.add(ee.sub(G)._mult(Ge/lt)._round());this.updateDistance(G,gt),this.addCurrentVertex(gt,_e,0,0,U,Ee),G=gt}}else Qe._mult(vt),this.addCurrentVertex(G,Qe,0,0,U,Ee);else if(Fe==="flipbevel"){if(vt>100)Qe=_e.mult(-1);else{let $e=vt*se.add(_e).mag()/se.sub(_e).mag();Qe._perp()._mult($e*(ut?-1:1))}this.addCurrentVertex(G,Qe,0,0,U,Ee),this.addCurrentVertex(G,Qe.mult(-1),0,0,U,Ee)}else if(Fe==="bevel"||Fe==="fakeround"){Ee!=null&&J&&this.addCurrentVertex(G,we||se,-1,-1,U,Ee);let $e=G.dist(J)<=2*Ge&&Fe!=="bevel",lt=Qe.mult(ut?1:-1);lt._mult(vt);let gt=_e.mult(ut?-1:1),it=se.mult(ut?-1:1),Nt=this.evaluateLineProgressFeatures(this.distance);if(Ee==null&&(this.addHalfVertex(G,lt.x,lt.y,!1,!ut,0,U,Nt),$e||this.addHalfVertex(G,lt.x+2*it.x,lt.y+2*it.y,!1,ut,0,U,Nt)),Fe==="fakeround"){let Ut=Math.round(180*dt/Math.PI/20);this.addHalfVertex(G,it.x,it.y,!1,ut,0,U,Nt);for(let Pt=0;Pt<Ut;Pt++){let St=Pt/Ut;if(St!==.5){let It=St-.5;St+=St*It*(St-1)*((1.0904+Ze*(Ze*(3.55645-1.43519*Ze)-3.2452))*It*It+(.848013+Ze*(.215638*Ze-1.06021)))}let yn=gt.sub(it)._mult(St)._add(it)._unit();this.addHalfVertex(G,yn.x,yn.y,!1,ut,0,U,Nt)}this.addHalfVertex(G,gt.x,gt.y,!1,ut,0,U,Nt)}$e||Ee!=null||this.addHalfVertex(G,lt.x+2*gt.x,lt.y+2*gt.y,!1,ut,0,U,Nt),Ee!=null&&ee&&this.addCurrentVertex(G,fe||_e,1,1,U,Ee)}else if(Fe==="butt")this.addCurrentVertex(G,Qe,0,0,U,Ee);else if(Fe==="square"){if(!J){let $e=D?0:-1;this.addCurrentVertex(G,Qe,$e,$e,U,Ee)}if(this.addCurrentVertex(G,Qe,0,0,U,Ee),J){let $e=I?0:1;this.addCurrentVertex(G,Qe,$e,$e,U,Ee)}}else if(Fe==="round"){if(J){let $e=!We&&we?we:se;this.addCurrentVertex(G,$e,0,0,U,Ee),!We&&I||this.addCurrentVertex(G,$e,1,1,U,Ee,!0)}if(ee){let $e=!We&&fe?fe:_e;!We&&D||this.addCurrentVertex(G,$e,-1,-1,U,Ee,!0),this.addCurrentVertex(G,$e,0,0,U,Ee)}}}}addVerticesTo(e,s,u,d,m,g,v,b,w,S){let D=(s.w-e.w)/this.tessellationStep|0,I=0,R=this.scaledDistance;if(D>1){this.lineSoFar=e.w;let B=(s.x-e.x)/D,U=(s.y-e.y)/D,G=(s.z-e.z)/D,J=(s.w-e.w)/D;for(let ee=1;ee<D;++ee){e.x+=B,e.y+=U,e.z+=G,this.lineSoFar+=J,I+=J;let se=this.evaluateLineProgressFeatures(this.prevDistance+I);this.scaledDistance=(this.prevDistance+I)/this.totalDistance,this.addHalfVertex(e,u,d,S,!1,v,w,se),this.addHalfVertex(e,m,g,S,!0,-b,w,se)}}this.lineSoFar=s.w,this.scaledDistance=R;let k=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(s,u,d,S,!1,v,w,k),this.addHalfVertex(s,m,g,S,!0,-b,w,k)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):Gt(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let s=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(s=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:s}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:s}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:s}}addCurrentVertex(e,s,u,d,m,g,v=!1){let b=s.x+s.y*u,w=s.y-s.x*u,S=s.y*d-s.x,D=-s.y-s.x*d;if(g!=null){let I=this.elevationType==="offset",R=-10,k=yt+10,B=g.zOffset,U=new PF(e.x,e.y,B,this.lineSoFar),G=!!I&&NI(e,R,k),J=this.lineSoFar,ee=this.distance;if(this.currentVertex)if(G){let se=this.currentVertexIsOutside,_e=this.currentVertex,fe=new PF(e.x,e.y,B,this.lineSoFar);if(RF(_e,fe,R,k),!NI(fe,R,k)){if(se){this.e1=this.e2=-1,this.distance-=_e.dist(U),this.lineSoFar=_e.w;let we=this.evaluateLineProgressFeatures(_e.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(_e,b,w,v,!1,u,m,we),this.addHalfVertex(_e,S,D,v,!0,-d,m,we),this.prevDistance=this.distance}this.distance=this.prevDistance+_e.dist(fe),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(_e,fe,b,w,S,D,u,d,m,v),this.distance=ee,this.scaledDistance=this.distance/this.totalDistance}}else{let se=this.currentVertex;if(this.currentVertexIsOutside){RF(se,U,R,k),this.e1=this.e2=-1,this.distance-=se.dist(U),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=se.w;let _e=this.evaluateLineProgressFeatures(se.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(se,b,w,v,!1,u,m,_e),this.addHalfVertex(se,S,D,v,!0,-d,m,_e),this.prevDistance=this.distance,this.distance=ee,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(se,U,b,w,S,D,u,d,m,v)}else G||(this.addHalfVertex(e,b,w,v,!1,u,m,g),this.addHalfVertex(e,S,D,v,!0,-d,m,g));this.currentVertex=U,this.currentVertexIsOutside=G,this.lineSoFar=J}else this.addHalfVertex(e,b,w,v,!1,u,m,g),this.addHalfVertex(e,S,D,v,!0,-d,m,g)}addHalfVertex({x:e,y:s},u,d,m,g,v,b,w){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),g||this.segmentPoints.push(this.lineSoFar-this.segmentStart,v)),this.layoutVertexArray.emplaceBack((e<<1)+(m?1:0),(s<<1)+(g?1:0),Math.round(63*u)+128,Math.round(63*d)+128,1+(v===0?0:v<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){let D=ln(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,D)}let S=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,S),b.primitiveLength++),g?this.e2=S:this.e1=S,w!=null&&this.zOffsetVertexArray.emplaceBack(w.zOffset,w.variableWidth,w.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,s){this.prevDistance=this.distance,this.distance+=e.dist(s),this.updateScaledDistance()}}function NI(a,e,s){return a.x<e||a.x>s||a.y<e||a.y>s}let dL,hL;function fL(a,e,s){return e*(yt/(a.tileSize*Math.pow(2,s-a.tileID.overscaledZ)))}Bt(LI,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});let pL=(a,e,s)=>(1-s)*a+s*e;function mL(a,e){return 1/fL(a,1,e.tileZoom)}function gL(a,e,s,u){return a.translatePosMatrix(u||e.tileID.projMatrix,e,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}let _L=a=>{let e=[];vL(a)&&e.push("RENDER_LINE_DASH"),a.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");let s=a.paint.get("line-trim-offset");s[0]===0&&s[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),a.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");let u=a.layout.get("line-join").constantOr("miter")==="none",d=!!a.paint.get("line-pattern").constantOr(1);return u&&d&&e.push("LINE_JOIN_NONE"),e};function vL(a){let e=a.paint.get("line-dasharray").value;return e.kind!=="constant"||e.value}let zI,yL=()=>zI||(zI={layout:dL||(dL=new Rr({"line-cap":new Mt(ke.layout_line["line-cap"]),"line-join":new Mt(ke.layout_line["line-join"]),"line-miter-limit":new pt(ke.layout_line["line-miter-limit"]),"line-round-limit":new pt(ke.layout_line["line-round-limit"]),"line-sort-key":new Mt(ke.layout_line["line-sort-key"]),"line-z-offset":new Mt(ke.layout_line["line-z-offset"]),"line-elevation-reference":new pt(ke.layout_line["line-elevation-reference"]),"line-cross-slope":new pt(ke.layout_line["line-cross-slope"]),visibility:new pt(ke.layout_line.visibility),"line-width-unit":new pt(ke.layout_line["line-width-unit"])})),paint:hL||(hL=new Rr({"line-opacity":new Mt(ke.paint_line["line-opacity"]),"line-color":new Mt(ke.paint_line["line-color"]),"line-translate":new pt(ke.paint_line["line-translate"]),"line-translate-anchor":new pt(ke.paint_line["line-translate-anchor"]),"line-width":new Mt(ke.paint_line["line-width"]),"line-gap-width":new Mt(ke.paint_line["line-gap-width"]),"line-offset":new Mt(ke.paint_line["line-offset"]),"line-blur":new Mt(ke.paint_line["line-blur"]),"line-dasharray":new Mt(ke.paint_line["line-dasharray"]),"line-pattern":new Mt(ke.paint_line["line-pattern"]),"line-pattern-cross-fade":new pt(ke.paint_line["line-pattern-cross-fade"]),"line-gradient":new Pf(ke.paint_line["line-gradient"]),"line-trim-offset":new pt(ke.paint_line["line-trim-offset"]),"line-trim-fade-range":new pt(ke.paint_line["line-trim-fade-range"]),"line-trim-color":new pt(ke.paint_line["line-trim-color"]),"line-emissive-strength":new pt(ke.paint_line["line-emissive-strength"]),"line-border-width":new Mt(ke.paint_line["line-border-width"]),"line-border-color":new Mt(ke.paint_line["line-border-color"]),"line-occlusion-opacity":new pt(ke.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"})}))},zI);class mq extends Mt{possiblyEvaluate(e,s){return s=new or(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,transition:s.transition,worldview:s.worldview}),super.possiblyEvaluate(e,s)}evaluate(e,s,u,d){return s=Object.assign({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(e,s,u,d)}}let Wy;function xL(a,e){return e>0?e+2*a:a}let gq=Bn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),_q=Bn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),vq=Bn([{name:"a_projected_pos",components:4,type:"Float32"}],4);Bn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let yq=Bn([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),xq=Bn([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),bq=Bn([{name:"a_texb",components:2,type:"Uint16"}]),wq=Bn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),Cq=Bn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Bn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let bL=Bn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Eq=Bn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Bn([{name:"triangle",components:3,type:"Uint16"}]),Bn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Bn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Bn([{type:"Float32",name:"offsetX"}]),Bn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Yo=24;function Tq(a,e,s){return a.sections.forEach(u=>{u.text=(function(d,m,g){let v=m.layout.get("text-transform").evaluate(g,{});return v==="uppercase"?d=d.toLocaleUpperCase():v==="lowercase"&&(d=d.toLocaleLowerCase()),Fa.applyArabicShaping&&(d=Fa.applyArabicShaping(d)),d})(u.text,e,s)}),a}let Zy={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42","\u2190":"\u2191","\u2192":"\u2193"};function Sq(a){return a==="\uFE36"||a==="\uFE48"||a==="\uFE38"||a==="\uFE44"||a==="\uFE42"||a==="\uFE3E"||a==="\uFE3C"||a==="\uFE3A"||a==="\uFE18"||a==="\uFE40"||a==="\uFE10"||a==="\uFE13"||a==="\uFE14"||a==="\uFF40"||a==="\uFFE3"||a==="\uFE11"||a==="\uFE12"}function Dq(a){return a==="\uFE35"||a==="\uFE47"||a==="\uFE37"||a==="\uFE43"||a==="\uFE41"||a==="\uFE3D"||a==="\uFE3B"||a==="\uFE39"||a==="\uFE17"||a==="\uFE3F"}let BI=4294967296,wL=1/BI,CL=typeof TextDecoder>"u"?null:new TextDecoder("utf-8"),Bw=class{constructor(a=new Uint8Array(16)){this.buf=ArrayBuffer.isView(a)?a:new Uint8Array(a),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(a,e,s=this.length){for(;this.pos<s;){let u=this.readVarint(),d=u>>3,m=this.pos;this.type=7&u,a(d,e,this),this.pos===m&&this.skip(u)}return e}readMessage(a,e){return this.readFields(a,e,this.readVarint()+this.pos)}readFixed32(){let a=this.dataView.getUint32(this.pos,!0);return this.pos+=4,a}readSFixed32(){let a=this.dataView.getInt32(this.pos,!0);return this.pos+=4,a}readFixed64(){let a=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*BI;return this.pos+=8,a}readSFixed64(){let a=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*BI;return this.pos+=8,a}readFloat(){let a=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,a}readDouble(){let a=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,a}readVarint(a){let e=this.buf,s,u;return u=e[this.pos++],s=127&u,u<128?s:(u=e[this.pos++],s|=(127&u)<<7,u<128?s:(u=e[this.pos++],s|=(127&u)<<14,u<128?s:(u=e[this.pos++],s|=(127&u)<<21,u<128?s:(u=e[this.pos],s|=(15&u)<<28,(function(d,m,g){let v=g.buf,b,w;if(w=v[g.pos++],b=(112&w)>>4,w<128||(w=v[g.pos++],b|=(127&w)<<3,w<128)||(w=v[g.pos++],b|=(127&w)<<10,w<128)||(w=v[g.pos++],b|=(127&w)<<17,w<128)||(w=v[g.pos++],b|=(127&w)<<24,w<128)||(w=v[g.pos++],b|=(1&w)<<31,w<128))return R_(d,b,m);throw new Error("Expected varint not more than 10 bytes")})(s,a,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){let a=this.readVarint();return a%2==1?(a+1)/-2:a/2}readBoolean(){return!!this.readVarint()}readString(){let a=this.readVarint()+this.pos,e=this.pos;return this.pos=a,a-e>=12&&CL?CL.decode(this.buf.subarray(e,a)):(function(s,u,d){let m="",g=u;for(;g<d;){let v=s[g],b,w,S,D=null,I=v>239?4:v>223?3:v>191?2:1;if(g+I>d)break;I===1?v<128&&(D=v):I===2?(b=s[g+1],(192&b)==128&&(D=(31&v)<<6|63&b,D<=127&&(D=null))):I===3?(b=s[g+1],w=s[g+2],(192&b)==128&&(192&w)==128&&(D=(15&v)<<12|(63&b)<<6|63&w,(D<=2047||D>=55296&&D<=57343)&&(D=null))):I===4&&(b=s[g+1],w=s[g+2],S=s[g+3],(192&b)==128&&(192&w)==128&&(192&S)==128&&(D=(15&v)<<18|(63&b)<<12|(63&w)<<6|63&S,(D<=65535||D>=1114112)&&(D=null))),D===null?(D=65533,I=1):D>65535&&(D-=65536,m+=String.fromCharCode(D>>>10&1023|55296),D=56320|1023&D),m+=String.fromCharCode(D),g+=I}return m})(this.buf,e,a)}readBytes(){let a=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,a);return this.pos=a,e}readPackedVarint(a=[],e){let s=this.readPackedEnd();for(;this.pos<s;)a.push(this.readVarint(e));return a}readPackedSVarint(a=[]){let e=this.readPackedEnd();for(;this.pos<e;)a.push(this.readSVarint());return a}readPackedBoolean(a=[]){let e=this.readPackedEnd();for(;this.pos<e;)a.push(this.readBoolean());return a}readPackedFloat(a=[]){let e=this.readPackedEnd();for(;this.pos<e;)a.push(this.readFloat());return a}readPackedDouble(a=[]){let e=this.readPackedEnd();for(;this.pos<e;)a.push(this.readDouble());return a}readPackedFixed32(a=[]){let e=this.readPackedEnd();for(;this.pos<e;)a.push(this.readFixed32());return a}readPackedSFixed32(a=[]){let e=this.readPackedEnd();for(;this.pos<e;)a.push(this.readSFixed32());return a}readPackedFixed64(a=[]){let e=this.readPackedEnd();for(;this.pos<e;)a.push(this.readFixed64());return a}readPackedSFixed64(a=[]){let e=this.readPackedEnd();for(;this.pos<e;)a.push(this.readSFixed64());return a}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(a){let e=7&a;if(e===0)for(;this.buf[this.pos++]>127;);else if(e===2)this.pos=this.readVarint()+this.pos;else if(e===5)this.pos+=4;else{if(e!==1)throw new Error(`Unimplemented type: ${e}`);this.pos+=8}}writeTag(a,e){this.writeVarint(a<<3|e)}realloc(a){let e=this.length||16;for(;e<this.pos+a;)e*=2;if(e!==this.length){let s=new Uint8Array(e);s.set(this.buf),this.buf=s,this.dataView=new DataView(s.buffer),this.length=e}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(a){this.realloc(4),this.dataView.setInt32(this.pos,a,!0),this.pos+=4}writeSFixed32(a){this.realloc(4),this.dataView.setInt32(this.pos,a,!0),this.pos+=4}writeFixed64(a){this.realloc(8),this.dataView.setInt32(this.pos,-1&a,!0),this.dataView.setInt32(this.pos+4,Math.floor(a*wL),!0),this.pos+=8}writeSFixed64(a){this.realloc(8),this.dataView.setInt32(this.pos,-1&a,!0),this.dataView.setInt32(this.pos+4,Math.floor(a*wL),!0),this.pos+=8}writeVarint(a){(a=+a||0)>268435455||a<0?(function(e,s){let u,d;if(e>=0?(u=e%4294967296|0,d=e/4294967296|0):(u=~(-e%4294967296),d=~(-e/4294967296),4294967295^u?u=u+1|0:(u=0,d=d+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),(function(m,g,v){v.buf[v.pos++]=127&m|128,m>>>=7,v.buf[v.pos++]=127&m|128,m>>>=7,v.buf[v.pos++]=127&m|128,m>>>=7,v.buf[v.pos++]=127&m|128,v.buf[v.pos]=127&(m>>>=7)})(u,0,s),(function(m,g){let v=(7&m)<<4;g.buf[g.pos++]|=v|((m>>>=3)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m)))))})(d,s)})(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))}writeSVarint(a){this.writeVarint(a<0?2*-a-1:2*a)}writeBoolean(a){this.writeVarint(+a)}writeString(a){a=String(a),this.realloc(4*a.length),this.pos++;let e=this.pos;this.pos=(function(u,d,m){for(let g,v,b=0;b<d.length;b++){if(g=d.charCodeAt(b),g>55295&&g<57344){if(!v){g>56319||b+1===d.length?(u[m++]=239,u[m++]=191,u[m++]=189):v=g;continue}if(g<56320){u[m++]=239,u[m++]=191,u[m++]=189,v=g;continue}g=v-55296<<10|g-56320|65536,v=null}else v&&(u[m++]=239,u[m++]=191,u[m++]=189,v=null);g<128?u[m++]=g:(g<2048?u[m++]=g>>6|192:(g<65536?u[m++]=g>>12|224:(u[m++]=g>>18|240,u[m++]=g>>12&63|128),u[m++]=g>>6&63|128),u[m++]=63&g|128)}return m})(this.buf,a,this.pos);let s=this.pos-e;s>=128&&EL(e,s,this),this.pos=e-1,this.writeVarint(s),this.pos+=s}writeFloat(a){this.realloc(4),this.dataView.setFloat32(this.pos,a,!0),this.pos+=4}writeDouble(a){this.realloc(8),this.dataView.setFloat64(this.pos,a,!0),this.pos+=8}writeBytes(a){let e=a.length;this.writeVarint(e),this.realloc(e);for(let s=0;s<e;s++)this.buf[this.pos++]=a[s]}writeRawMessage(a,e){this.pos++;let s=this.pos;a(e,this);let u=this.pos-s;u>=128&&EL(s,u,this),this.pos=s-1,this.writeVarint(u),this.pos+=u}writeMessage(a,e,s){this.writeTag(a,2),this.writeRawMessage(e,s)}writePackedVarint(a,e){e.length&&this.writeMessage(a,Iq,e)}writePackedSVarint(a,e){e.length&&this.writeMessage(a,Mq,e)}writePackedBoolean(a,e){e.length&&this.writeMessage(a,Oq,e)}writePackedFloat(a,e){e.length&&this.writeMessage(a,Aq,e)}writePackedDouble(a,e){e.length&&this.writeMessage(a,Pq,e)}writePackedFixed32(a,e){e.length&&this.writeMessage(a,Rq,e)}writePackedSFixed32(a,e){e.length&&this.writeMessage(a,kq,e)}writePackedFixed64(a,e){e.length&&this.writeMessage(a,Fq,e)}writePackedSFixed64(a,e){e.length&&this.writeMessage(a,Lq,e)}writeBytesField(a,e){this.writeTag(a,2),this.writeBytes(e)}writeFixed32Field(a,e){this.writeTag(a,5),this.writeFixed32(e)}writeSFixed32Field(a,e){this.writeTag(a,5),this.writeSFixed32(e)}writeFixed64Field(a,e){this.writeTag(a,1),this.writeFixed64(e)}writeSFixed64Field(a,e){this.writeTag(a,1),this.writeSFixed64(e)}writeVarintField(a,e){this.writeTag(a,0),this.writeVarint(e)}writeSVarintField(a,e){this.writeTag(a,0),this.writeSVarint(e)}writeStringField(a,e){this.writeTag(a,2),this.writeString(e)}writeFloatField(a,e){this.writeTag(a,5),this.writeFloat(e)}writeDoubleField(a,e){this.writeTag(a,1),this.writeDouble(e)}writeBooleanField(a,e){this.writeVarintField(a,+e)}};function R_(a,e,s){return s?4294967296*e+(a>>>0):4294967296*(e>>>0)+(a>>>0)}function EL(a,e,s){let u=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));s.realloc(u);for(let d=s.pos-1;d>=a;d--)s.buf[d+u]=s.buf[d]}function Iq(a,e){for(let s=0;s<a.length;s++)e.writeVarint(a[s])}function Mq(a,e){for(let s=0;s<a.length;s++)e.writeSVarint(a[s])}function Aq(a,e){for(let s=0;s<a.length;s++)e.writeFloat(a[s])}function Pq(a,e){for(let s=0;s<a.length;s++)e.writeDouble(a[s])}function Oq(a,e){for(let s=0;s<a.length;s++)e.writeBoolean(a[s])}function Rq(a,e){for(let s=0;s<a.length;s++)e.writeFixed32(a[s])}function kq(a,e){for(let s=0;s<a.length;s++)e.writeSFixed32(a[s])}function Fq(a,e){for(let s=0;s<a.length;s++)e.writeFixed64(a[s])}function Lq(a,e){for(let s=0;s<a.length;s++)e.writeSFixed64(a[s])}let jI=3;function Nq(a,e,s){e.glyphs=[],a===1&&s.readMessage(zq,e)}function zq(a,e,s){if(a===3){let{id:u,bitmap:d,width:m,height:g,left:v,top:b,advance:w}=s.readMessage(Bq,{});e.glyphs.push({id:u,bitmap:new Wf({width:m+2*jI,height:g+2*jI},d),metrics:{width:m,height:g,left:v,top:b,advance:w}})}else a===4?e.ascender=s.readSVarint():a===5&&(e.descender=s.readSVarint())}function Bq(a,e,s){a===1?e.id=s.readVarint():a===2?e.bitmap=s.readBytes():a===3?e.width=s.readVarint():a===4?e.height=s.readVarint():a===5?e.left=s.readSVarint():a===6?e.top=s.readSVarint():a===7&&(e.advance=s.readVarint())}let TL=jI,sl={horizontal:1,vertical:2,horizontalOnly:3};class Xy{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,s){let u=new Xy;return u.scale=e||1,u.fontStack=s,u}static forImage(e){let s=new Xy;return s.image=e,s}}class k_{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,s,u){let d=new k_;for(let m=0;m<e.sections.length;m++){let g=e.sections[m];g.image?d.addImageSection(g,u):d.addTextSection(g,s)}return d}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=(function(s,u){let d="";for(let m=0;m<s.length;m++){let g=s.charCodeAt(m+1)||null,v=s.charCodeAt(m-1)||null;d+=!u&&(g&&Qv(g)&&!Zy[s[m+1]]||v&&Qv(v)&&!Zy[s[m-1]])||!Zy[s[m]]?s[m]:Zy[s[m]]}return d})(this.text,e)}trim(){let e=0;for(let u=0;u<this.text.length&&jw[this.text.charCodeAt(u)];u++)e++;let s=this.text.length;for(let u=this.text.length-1;u>=0&&u>=e&&jw[this.text.charCodeAt(u)];u--)s--;this.text=this.text.substring(e,s),this.sectionIndex=this.sectionIndex.slice(e,s)}substring(e,s){let u=new k_;return u.text=this.text.substring(e,s),u.sectionIndex=this.sectionIndex.slice(e,s),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,s)=>Math.max(e,this.sections[s].scale),0)}addTextSection(e,s){this.text+=e.text,this.sections.push(Xy.forText(e.scale,e.fontStack||s));let u=this.sections.length-1;for(let d=0;d<e.text.length;++d)this.sectionIndex.push(u)}addImageSection(e,s){let u=e.image?e.image.getPrimary():null;if(!u)return void Gt("Can't add FormattedSection with an empty image.");u.scaleSelf(s);let d=this.getNextImageSectionCharCode();d?(this.text+=String.fromCodePoint(d),this.sections.push(Xy.forImage(u)),this.sectionIndex.push(this.sections.length-1)):Gt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function VI(a,e,s,u,d,m,g,v,b,w,S,D,I,R,k,B=1){let U=k_.fromFeature(a,d,B);D===sl.vertical&&U.verticalizePunctuation(I);let G=[],J=(function(we,Ee,Se,We,Fe,Ze){if(!we)return[];let Qe=[],rt=(function(ut,Ge,$e,lt,gt,it){let Nt=0;for(let Ut=0;Ut<ut.length();Ut++){let Pt=ut.getSection(Ut);Nt+=SL(ut.getCodePoint(Ut),Pt,lt,gt,Ge,it)}return Nt/Math.max(1,Math.ceil(Nt/$e))})(we,Ee,Se,We,Fe,Ze),vt=we.text.indexOf("\u200B")>=0,dt=0;for(let ut=0;ut<we.length();ut++){let Ge=we.getSection(ut),$e=we.getCodePoint(ut);if(jw[$e]||(dt+=SL($e,Ge,We,Fe,Ee,Ze)),ut<we.length()-1){let lt=!((et=$e)<11904||!(on["Bopomofo Extended"](et)||on.Bopomofo(et)||on["CJK Compatibility Forms"](et)||on["CJK Compatibility Ideographs"](et)||on["CJK Compatibility"](et)||on["CJK Radicals Supplement"](et)||on["CJK Strokes"](et)||on["CJK Symbols and Punctuation"](et)||on["CJK Unified Ideographs Extension A"](et)||on["CJK Unified Ideographs"](et)||on["Enclosed CJK Letters and Months"](et)||on["Halfwidth and Fullwidth Forms"](et)||on.Hiragana(et)||on["Ideographic Description Characters"](et)||on["Kangxi Radicals"](et)||on["Katakana Phonetic Extensions"](et)||on.Katakana(et)||on["Vertical Forms"](et)||on["Yi Radicals"](et)||on["Yi Syllables"](et)));(jq[$e]||lt||Ge.image)&&Qe.push(IL(ut+1,dt,rt,Qe,Vq($e,we.getCodePoint(ut+1),lt&&vt),!1))}}var et;return ML(IL(we.length(),dt,rt,Qe,0,!0))})(U,w,m,e,u,R),{processBidirectionalText:ee,processStyledBidirectionalText:se}=Fa;if(ee&&U.sections.length===1){let we=ee(U.toString(),J);for(let Ee of we){let Se=new k_;Se.text=Ee,Se.sections=U.sections;for(let We=0;We<Ee.length;We++)Se.sectionIndex.push(0);G.push(Se)}}else if(se){let we=se(U.text,U.sectionIndex,J);for(let Ee of we){let Se=new k_;Se.text=Ee[0],Se.sectionIndex=Ee[1],Se.sections=U.sections,G.push(Se)}}else G=(function(we,Ee){let Se=[],We=we.text,Fe=0;for(let Ze of Ee)Se.push(we.substring(Fe,Ze)),Fe=Ze;return Fe<We.length&&Se.push(we.substring(Fe,We.length)),Se})(U,J);let _e=[],fe={positionedLines:_e,text:U.toString(),top:S[1],bottom:S[1],left:S[0],right:S[0],writingMode:D,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if((function(we,Ee,Se,We,Fe,Ze,Qe,rt,vt,dt,et,ut){let Ge=0,$e=0,lt=0,gt=rt==="right"?1:rt==="left"?0:.5,it=!1;for(let It of Fe){let rn=It.getSections();for(let xn of rn){if(xn.image)continue;let Nn=Ee[xn.fontStack];if(Nn&&(it=Nn.ascender!==void 0&&Nn.descender!==void 0,!it))break}if(!it)break}let Nt=0;for(let It of Fe){It.trim();let rn=It.getMaxScale(),xn=(rn-1)*Yo,Nn={positionedGlyphs:[],lineOffset:0};we.positionedLines[Nt]=Nn;let ri=Nn.positionedGlyphs,wn=0;if(!It.length()){$e+=Ze,++Nt;continue}let fi=0,pi=0;for(let pe=0;pe<It.length();pe++){let ue=It.getSection(pe),Xe=It.getSectionIndex(pe),Et=It.getCodePoint(pe),Ye=ue.scale,Dt=null,Yt=null,Xt=null,En=Yo,cn=0,qt=vt;qt===sl.vertical&&((Ut=Et)===12312||Ut===12313||Ut===12316||Ut===12540||Ut===12448)&&(qt=sl.horizontal);let ui=!(qt===sl.horizontal||!et&&!a_(Et)||et&&(jw[Et]||ey(Et)));if(ue.image){let $i=We.get(ue.image.toString());if(!$i)continue;Xt=ue.image,we.iconsInText=we.iconsInText||!0,Yt=$i.paddedRect;let hn=$i.displaySize;Ye=Ye*Yo/ut,Dt={width:hn[0],height:hn[1],left:0,top:-TL,advance:ui?hn[1]:hn[0],localGlyph:!1},cn=it?-Dt.height*Ye:rn*Yo-17-hn[1]*Ye,En=Dt.advance;let ni=(ui?hn[0]:hn[1])*Ye-Yo*rn;ni>0&&ni>wn&&(wn=ni)}else{let $i=Se[ue.fontStack];if(!$i)continue;$i[Et]&&(Yt=$i[Et]);let hn=Ee[ue.fontStack];if(!hn)continue;let ni=hn.glyphs[Et];if(!ni)continue;if(Dt=ni.metrics,En=Et!==8203?Yo:0,it){let Gi=hn.ascender!==void 0?Math.abs(hn.ascender):0,Ti=hn.descender!==void 0?Math.abs(hn.descender):0,Ir=(Gi+Ti)*Ye;fi<Ir&&(fi=Ir,pi=(Gi-Ti)/2*Ye),cn=-Gi*Ye}else cn=(rn-Ye)*Yo-17}ui?(we.verticalizable=!0,ri.push({glyph:Et,image:Xt,x:Ge,y:$e+cn,vertical:ui,scale:Ye,localGlyph:Dt.localGlyph,fontStack:ue.fontStack,sectionIndex:Xe,metrics:Dt,rect:Yt}),Ge+=En*Ye+dt):(ri.push({glyph:Et,image:Xt,x:Ge,y:$e+cn,vertical:ui,scale:Ye,localGlyph:Dt.localGlyph,fontStack:ue.fontStack,sectionIndex:Xe,metrics:Dt,rect:Yt}),Ge+=Dt.advance*Ye+dt)}ri.length!==0&&(lt=Math.max(Ge-dt,lt),it?AL(ri,gt,wn,pi,Ze*rn/2):AL(ri,gt,wn,0,Ze/2)),Ge=0;let xr=Ze*rn+wn;Nn.lineOffset=Math.max(wn,xn),$e+=xr,++Nt}var Ut;let Pt=$e,{horizontalAlign:St,verticalAlign:yn}=UI(Qe);(function(It,rn,xn,Nn,ri,wn){let fi=(rn-xn)*ri,pi=-wn*Nn;for(let xr of It)for(let pe of xr.positionedGlyphs)pe.x+=fi,pe.y+=pi})(we.positionedLines,gt,St,yn,lt,Pt),we.top+=-yn*Pt,we.bottom=we.top+Pt,we.left+=-St*lt,we.right=we.left+lt,we.hasBaseline=it})(fe,e,s,u,G,g,v,b,D,w,I,k),!(function(we){for(let Ee of we)if(Ee.positionedGlyphs.length!==0)return!1;return!0})(_e))return fe}let jw={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},jq={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function SL(a,e,s,u,d,m){if(e.image){let g=u.get(e.image.toString());return g?g.displaySize[0]*e.scale*Yo/m+d:0}{let g=s[e.fontStack],v=g&&g.glyphs[a];return v?v.metrics.advance*e.scale+d:0}}function DL(a,e,s,u){let d=Math.pow(a-e,2);return u?a<e?d/2:2*d:d+Math.abs(s)*s}function Vq(a,e,s){let u=0;return a===10&&(u-=1e4),s&&(u+=150),a!==40&&a!==65288||(u+=50),e!==41&&e!==65289||(u+=50),u}function IL(a,e,s,u,d,m){let g=null,v=DL(e,s,d,m);for(let b of u){let w=DL(e-b.x,s,d,m)+b.badness;w<=v&&(g=b,v=w)}return{index:a,x:e,priorBreak:g,badness:v}}function ML(a){return a?ML(a.priorBreak).concat(a.index):[]}function UI(a){let e=.5,s=.5;switch(a){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:e,verticalAlign:s}}function AL(a,e,s,u,d){if(!(e||s||u||d))return;let m=a.length-1,g=a[m],v=(g.x+g.metrics.advance*g.scale)*e;for(let b=0;b<=m;b++)a[b].x-=v,a[b].y+=s+u+d}function PL(a){return a.imagePrimary!==void 0&&a.top!==void 0&&a.bottom!==void 0&&a.left!==void 0&&a.right!==void 0}function Vw(a,e,s,u){let{horizontalAlign:d,verticalAlign:m}=UI(u),g=s[0]-a.displaySize[0]*d,v=s[1]-a.displaySize[1]*m;return{imagePrimary:a,imageSecondary:e,top:v,bottom:v+a.displaySize[1],left:g,right:g+a.displaySize[0]}}function HI(a,e,s,u,d,m){let g=a.imagePrimary,v;if(g.content){let U=g.content,G=g.pixelRatio||1;v=[U[0]/G,U[1]/G,g.displaySize[0]-U[2]/G,g.displaySize[1]-U[3]/G]}let b=e.left*m,w=e.right*m,S,D,I,R;s==="width"||s==="both"?(R=d[0]+b-u[3],D=d[0]+w+u[1]):(R=d[0]+(b+w-g.displaySize[0])/2,D=R+g.displaySize[0]);let k=e.top*m,B=e.bottom*m;return s==="height"||s==="both"?(S=d[1]+k-u[0],I=d[1]+B+u[2]):(S=d[1]+(k+B-g.displaySize[1])/2,I=S+g.displaySize[1]),{imagePrimary:g,imageSecondary:void 0,top:S,right:D,bottom:I,left:R,collisionPadding:v}}function OL(a){return!a.imagePrimary.stretchX}function RL(a){return!a.imagePrimary.stretchY}function kL(a){return{width:a.right-a.left,height:a.bottom-a.top}}let cu=128;function F_(a,e,s){let{expression:u}=e;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new or(a+1,{worldview:s}))};if(u.kind==="source")return{kind:"source"};{let{zoomStops:d,interpolationType:m}=u,g=0;for(;g<d.length&&d[g]<=a;)g++;g=Math.max(0,g-1);let v=g;for(;v<d.length&&d[v]<a+1;)v++;v=Math.min(d.length-1,v);let b=d[g],w=d[v];return u.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:w,interpolationType:m}:{kind:"camera",minZoom:b,maxZoom:w,minSize:u.evaluate(new or(b,{worldview:s})),maxSize:u.evaluate(new or(w,{worldview:s})),interpolationType:m}}}function $I(a,{uSize:e,uSizeT:s},{lowerSize:u,upperSize:d}){return a.kind==="source"?u/cu:a.kind==="composite"?ln(u/cu,d/cu,s):e}function L_(a,e,s=1){let u=0,d=0;if(a.kind==="constant")d=a.layoutSize*s;else if(a.kind!=="source"){let{interpolationType:m,minZoom:g,maxZoom:v}=a,b=m?X(Ka.interpolationFactor(m,e,g,v),0,1):0;a.kind==="camera"?d=ln(a.minSize,a.maxSize,b)*s:u=b*s}return{uSizeT:u,uSize:d}}class Sh extends ct{constructor(e,s,u,d,m){super(e,s),this.angle=d,this.z=u,m!==void 0&&(this.segment=m)}clone(){return new Sh(this.x,this.y,this.z,this.angle,this.segment)}}function FL(a,e,s,u,d){if(e.segment===void 0)return!0;let m=e,g=e.segment+1,v=0;for(;v>-s/2;){if(g--,g<0)return!1;v-=a[g].dist(m),m=a[g]}v+=a[g].dist(a[g+1]),g++;let b=[],w=0;for(;v<s/2;){let S=a[g],D=a[g+1];if(!D)return!1;let I=a[g-1].angleTo(S)-S.angleTo(D);for(I=Math.abs((I+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:v,angleDelta:I}),w+=I;v-b[0].distance>u;)w-=b.shift().angleDelta;if(w>d)return!1;g++,v+=S.dist(D)}return!0}function LL(a){let e=0;for(let s=0;s<a.length-1;s++)e+=a[s].dist(a[s+1]);return e}function NL(a,e,s){return a?.6*e*s:0}function zL(a,e){return Math.max(a?a.right-a.left:0,e?e.right-e.left:0)}function Uq(a,e,s,u,d,m){let g=NL(s,d,m),v=zL(s,u)*m,b=0,w=LL(a)/2;for(let S=0;S<a.length-1;S++){let D=a[S],I=a[S+1],R=D.dist(I);if(b+R>w){let k=(w-b)/R,B=ln(D.x,I.x,k),U=ln(D.y,I.y,k),G=new Sh(B,U,0,I.angleTo(D),S);return!g||FL(a,G,v,g,e)?G:void 0}b+=R}}function Hq(a,e,s,u,d,m,g,v,b){let w=NL(u,m,g),S=zL(u,d),D=S*g,I=a[0].x===0||a[0].x===b||a[0].y===0||a[0].y===b;return e-D<e/4&&(e=D+e/4),BL(a,I?e/2*v%e:(S/2+2*m)*g*v%e,e,w,s,D,I,!1,b)}function BL(a,e,s,u,d,m,g,v,b){let w=m/2,S=LL(a),D=0,I=e-s,R=[];for(let k=0;k<a.length-1;k++){let B=a[k],U=a[k+1],G=B.dist(U),J=U.angleTo(B);for(;I+s<D+G;){I+=s;let ee=(I-D)/G,se=ln(B.x,U.x,ee),_e=ln(B.y,U.y,ee);if(se>=0&&se<b&&_e>=0&&_e<b&&I-w>=0&&I+w<=S){let fe=new Sh(se,_e,0,J,k);u&&!FL(a,fe,m,u,d)||R.push(fe)}}D+=G}return v||R.length||g||(R=BL(a,D/2,s,u,d,m,g,!0,b)),R}function jL(a){let e=0,s=0;for(let g of a)e+=g.w*g.h,s=Math.max(s,g.w);a.sort((g,v)=>v.h-g.h);let u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),s),h:1/0}],d=0,m=0;for(let g of a)for(let v=u.length-1;v>=0;v--){let b=u[v];if(!(g.w>b.w||g.h>b.h)){if(g.x=b.x,g.y=b.y,m=Math.max(m,g.y+g.h),d=Math.max(d,g.x+g.w),g.w===b.w&&g.h===b.h){let w=u.pop();w&&v<u.length&&(u[v]=w)}else g.h===b.h?(b.x+=g.w,b.w-=g.w):g.w===b.w?(b.y+=g.h,b.h-=g.h):(u.push({x:b.x+g.w,y:b.y,w:b.w-g.w,h:g.h}),b.y+=g.h,b.h-=g.h);break}}return{w:d,h:m,fill:e/(d*m)||0}}Bt(Sh,"Anchor");let Tm=1;class Yy{static getImagePositionScale(e,s,u){if(s&&e&&e.options&&e.options.transform){let d=e.options.transform;return{x:d.a,y:d.d}}return{x:u,y:u}}constructor(e,s,u,d){this.paddedRect=e;let{pixelRatio:m,version:g,stretchX:v,stretchY:b,content:w,sdf:S,usvg:D}=s;this.pixelRatio=m,this.stretchX=v,this.stretchY=b,this.content=w,this.version=g,this.padding=u,this.sdf=S,this.usvg=D,this.scale=Yy.getImagePositionScale(d,D,m)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function GI(a,e,s){let u=bl.parse(a),d=(function(m,g,v=[1,1]){return{x:0,y:0,w:(m.data?m.data.width:m.width*v[0])+2*g,h:(m.data?m.data.height:m.height*v[1])+2*g}})(e,s,[u.options.transform.a,u.options.transform.d]);return{bin:d,imagePosition:new Yy(d,e,s,u),imageVariant:u}}class VL{constructor(e,s,u){let d=new Map,m=new Map;this.haveRenderCallbacks=[];let g=[];this.addImages(e,d,Tm,g),this.addImages(s,m,2,g);let{w:v,h:b}=jL(g),w=new Cs({width:v||1,height:b||1});for(let[S,D]of e.entries()){let I=d.get(S).paddedRect;Cs.copy(D.data,w,{x:0,y:0},{x:I.x+Tm,y:I.y+Tm},D.data,null,D.sdf)}for(let[S,D]of s.entries()){let I=m.get(S),R=I.paddedRect,k=I.padding,B=R.x+k,U=R.y+k,G=D.data.width,J=D.data.height;k=k>1?k-1:k,Cs.copy(D.data,w,{x:0,y:0},{x:B,y:U},D.data,u),Cs.copy(D.data,w,{x:0,y:J-k},{x:B,y:U-k},{width:G,height:k},u),Cs.copy(D.data,w,{x:0,y:0},{x:B,y:U+J},{width:G,height:k},u),Cs.copy(D.data,w,{x:G-k,y:0},{x:B-k,y:U},{width:k,height:J},u),Cs.copy(D.data,w,{x:0,y:0},{x:B+G,y:U},{width:k,height:J},u),Cs.copy(D.data,w,{x:G-k,y:J-k},{x:B-k,y:U-k},{width:k,height:k},u),Cs.copy(D.data,w,{x:0,y:J-k},{x:B+G,y:U-k},{width:k,height:k},u),Cs.copy(D.data,w,{x:0,y:0},{x:B+G,y:U+J},{width:k,height:k},u),Cs.copy(D.data,w,{x:G-k,y:0},{x:B-k,y:U+J},{width:k,height:k},u)}this.lut=u,this.image=w,this.iconPositions=d,this.patternPositions=m}addImages(e,s,u,d){for(let[m,g]of e.entries()){let{bin:v,imagePosition:b,imageVariant:w}=GI(m,g,u);s.set(m,b),d.push(v),g.hasRenderCallback&&this.haveRenderCallbacks.push(w.id)}}patchUpdatedImages(e,s,u){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(d=>e.hasImage(d,u)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,u);for(let d of e.getUpdatedImages(u)){for(let m of this.iconPositions.keys()){let g=bl.parse(m);if(uo.isEqual(g.id,d)){let v=e.getImage(d,u);this.patchUpdatedImage(this.iconPositions.get(m),v,s,null)}}for(let m of this.patternPositions.keys()){let g=bl.parse(m);if(uo.isEqual(g.id,d)){let v=e.getImage(d,u);this.patchUpdatedImage(this.patternPositions.get(m),v,s,this.lut)}}}}patchUpdatedImage(e,s,u,d=null){if(!e||!s||e.version===s.version)return;e.version=s.version;let[m,g]=e.tl,v=e.sdf;if(this.lut||v){let b={width:s.data.width,height:s.data.height},w=new Cs(b);Cs.copy(s.data,w,{x:0,y:0},{x:0,y:0},b,d,v),u.update(w,{position:{x:m,y:g}})}else u.update(s.data,{position:{x:m,y:g}})}}Bt(Yy,"ImagePosition"),Bt(VL,"ImageAtlas");let Ky=1e20;function UL(a,e,s,u,d,m,g,v,b){for(let w=e;w<e+u;w++)HL(a,s*m+w,m,d,g,v,b);for(let w=s;w<s+d;w++)HL(a,w*m+e,1,u,g,v,b)}function HL(a,e,s,u,d,m,g){m[0]=0,g[0]=-Ky,g[1]=Ky,d[0]=a[e];for(let v=1,b=0,w=0;v<u;v++){d[v]=a[e+v*s];let S=v*v;do{let D=m[b];w=(d[v]-d[D]+S-D*D)/(v-D)/2}while(w<=g[b]&&--b>-1);b++,m[b]=v,g[b]=w,g[b+1]=Ky}for(let v=0,b=0;v<u;v++){for(;g[b+1]<v;)b++;let w=m[b],S=v-w;a[e+v*s]=d[w]+S*S}}let uu=2,qI={none:0,ideographs:1,all:2};class N_{constructor(e,s,u){this.requestManager=e,this.localGlyphMode=s,this.localFontFamily=u,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,s){let u=[],d=this.url||tr.GLYPHS_URL;for(let m in e)for(let g of e[m])u.push({stack:m,id:g});Ce(u,({stack:m,id:g},v)=>{let b=this.entries[m];b||(b=this.entries[m]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let w=b.glyphs[g];if(w!==void 0)return void v(null,{stack:m,id:g,glyph:w});if(w=this._tinySDF(b,m,g),w)return b.glyphs[g]=w,void v(null,{stack:m,id:g,glyph:w});let S=Math.floor(g/256);if(256*S>65535)return Gt("glyphs > 65535 not supported"),void v(null,{stack:m,id:g,glyph:w});if(b.ranges[S])return void v(null,{stack:m,id:g,glyph:w});let D=b.requests[S];D||(D=b.requests[S]=[],N_.loadGlyphRange(m,S,d,this.requestManager,(I,R)=>{if(R){b.ascender=R.ascender,b.descender=R.descender;for(let k in R.glyphs)this._doesCharSupportLocalGlyph(+k)||(b.glyphs[+k]=R.glyphs[+k]);b.ranges[S]=!0}for(let k of D)k(I,R);delete b.requests[S]})),D.push((I,R)=>{I?v(I):R&&v(null,{stack:m,id:g,glyph:R.glyphs[g]||null})})},(m,g)=>{if(m)s(m);else if(g){let v={};for(let{stack:b,id:w,glyph:S}of g)v[b]===void 0&&(v[b]={}),v[b].glyphs===void 0&&(v[b].glyphs={}),v[b].glyphs[w]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics},v[b].ascender=this.entries[b].ascender,v[b].descender=this.entries[b].descender;s(null,v)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==qI.none&&(this.localGlyphMode===qI.all?!!this.localFontFamily:!!this.localFontFamily&&(on["CJK Unified Ideographs"](e)||on["Hangul Syllables"](e)||on.Hiragana(e)||on.Katakana(e)||on["CJK Symbols and Punctuation"](e)||on["CJK Unified Ideographs Extension A"](e)||on["CJK Unified Ideographs Extension B"](e)||on.Osage(e)))}_tinySDF(e,s,u){let d=this.localFontFamily;if(!d||!this._doesCharSupportLocalGlyph(u))return;let m=e.tinySDF;if(!m){let B="400";/bold/i.test(s)?B="900":/medium/i.test(s)?B="500":/light/i.test(s)&&(B="200"),m=e.tinySDF=new N_.TinySDF({fontFamily:d,fontWeight:B,fontSize:24*uu,buffer:3*uu,radius:8*uu}),m.fontWeight=B}if(this.localGlyphs[m.fontWeight][u])return this.localGlyphs[m.fontWeight][u];let g=String.fromCodePoint(u),{data:v,width:b,height:w,glyphWidth:S,glyphHeight:D,glyphLeft:I,glyphTop:R,glyphAdvance:k}=m.draw(g);return this.localGlyphs[m.fontWeight][u]={id:u,bitmap:new Wf({width:b,height:w},v),metrics:{width:S/uu,height:D/uu,left:I/uu,top:R/uu-27,advance:k/uu,localGlyph:!0}}}}N_.loadGlyphRange=function(a,e,s,u,d){let m=256*e,g=m+255,v=u.transformRequest(u.normalizeGlyphsURL(s).replace("{fontstack}",a).replace("{range}",`${m}-${g}`),$c.Glyphs);Bu(v,(b,w)=>{if(b)d(b);else if(w){let S={},D=(function(I){return new Bw(I).readFields(Nq,{})})(w);for(let I of D.glyphs)S[I.id]=I;d(null,{glyphs:S,ascender:D.ascender,descender:D.descender})}})},N_.TinySDF=class{constructor({fontSize:a=24,buffer:e=3,radius:s=8,cutoff:u=.25,fontFamily:d="sans-serif",fontWeight:m="normal",fontStyle:g="normal",lang:v=null}={}){this.buffer=e,this.cutoff=u,this.radius=s,this.lang=v;let b=this.size=a+4*e,w=this._createCanvas(b),S=this.ctx=w.getContext("2d",{willReadFrequently:!0});S.font=`${g} ${m} ${a}px ${d}`,S.textBaseline="alphabetic",S.textAlign="left",S.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(a){let e=document.createElement("canvas");return e.width=e.height=a,e}draw(a){let{width:e,actualBoundingBoxAscent:s,actualBoundingBoxDescent:u,actualBoundingBoxLeft:d,actualBoundingBoxRight:m}=this.ctx.measureText(a),g=Math.ceil(s),v=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-d))),b=Math.min(this.size-this.buffer,g+Math.ceil(u)),w=v+2*this.buffer,S=b+2*this.buffer,D=Math.max(w*S,0),I=new Uint8ClampedArray(D),R={data:I,width:w,height:S,glyphWidth:v,glyphHeight:b,glyphTop:g,glyphLeft:0,glyphAdvance:e};if(v===0||b===0)return R;let{ctx:k,buffer:B,gridInner:U,gridOuter:G}=this;this.lang&&(k.lang=this.lang),k.clearRect(B,B,v,b),k.fillText(a,B,B+g);let J=k.getImageData(B,B,v,b);G.fill(Ky,0,D),U.fill(0,0,D);for(let ee=0;ee<b;ee++)for(let se=0;se<v;se++){let _e=J.data[4*(ee*v+se)+3]/255;if(_e===0)continue;let fe=(ee+B)*w+se+B;if(_e===1)G[fe]=0,U[fe]=Ky;else{let we=.5-_e;G[fe]=we>0?we*we:0,U[fe]=we<0?we*we:0}}UL(G,0,0,w,S,w,this.f,this.v,this.z),UL(U,B,B,v,b,w,this.f,this.v,this.z);for(let ee=0;ee<D;ee++){let se=Math.sqrt(G[ee])-Math.sqrt(U[ee]);I[ee]=Math.round(255-255*(se/this.radius+this.cutoff))}return R}};let fd=Tm;function $L(a,e){return a+e[1]-e[0]}function WI(a,e,s,u,d=1){let m=[],g=a.imagePrimary,v=g.pixelRatio,b=g.paddedRect.w-2*fd,w=g.paddedRect.h-2*fd,S=(a.right-a.left)*d,D=(a.bottom-a.top)*d,I=g.stretchX||[[0,b]],R=g.stretchY||[[0,w]],k=I.reduce($L,0),B=R.reduce($L,0),U=b-k,G=w-B,J=0,ee=k,se=0,_e=B,fe=0,we=U,Ee=0,Se=G;if(g.content&&u){let Fe=g.content;J=Uw(I,0,Fe[0]),se=Uw(R,0,Fe[1]),ee=Uw(I,Fe[0],Fe[2]),_e=Uw(R,Fe[1],Fe[3]),fe=Fe[0]-J,Ee=Fe[1]-se,we=Fe[2]-Fe[0]-ee,Se=Fe[3]-Fe[1]-_e}let We=(Fe,Ze,Qe,rt)=>{let vt=Hw(Fe.stretch-J,ee,S,a.left*d),dt=$w(Fe.fixed-fe,we,Fe.stretch,k),et=Hw(Ze.stretch-se,_e,D,a.top*d),ut=$w(Ze.fixed-Ee,Se,Ze.stretch,B),Ge=Hw(Qe.stretch-J,ee,S,a.left*d),$e=$w(Qe.fixed-fe,we,Qe.stretch,k),lt=Hw(rt.stretch-se,_e,D,a.top*d),gt=$w(rt.fixed-Ee,Se,rt.stretch,B),it=new ct(vt,et),Nt=new ct(Ge,et),Ut=new ct(Ge,lt),Pt=new ct(vt,lt),St=new ct(dt/v,ut/v),yn=new ct($e/v,gt/v),It=e*Math.PI/180;if(It){let fi=Math.sin(It),pi=Math.cos(It),xr=[pi,-fi,fi,pi];it._matMult(xr),Nt._matMult(xr),Pt._matMult(xr),Ut._matMult(xr)}let rn=Fe.stretch+Fe.fixed,xn=Qe.stretch+Qe.fixed,Nn=Ze.stretch+Ze.fixed,ri=rt.stretch+rt.fixed,wn=a.imageSecondary;return{tl:it,tr:Nt,bl:Pt,br:Ut,texPrimary:{x:g.paddedRect.x+fd+rn,y:g.paddedRect.y+fd+Nn,w:xn-rn,h:ri-Nn},texSecondary:wn?{x:wn.paddedRect.x+fd+rn,y:wn.paddedRect.y+fd+Nn,w:xn-rn,h:ri-Nn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:St,pixelOffsetBR:yn,minFontScaleX:we/v/S,minFontScaleY:Se/v/D,isSDF:s}};if(u&&(g.stretchX||g.stretchY)){let Fe=GL(I,U,k),Ze=GL(R,G,B);for(let Qe=0;Qe<Fe.length-1;Qe++){let rt=Fe[Qe],vt=Fe[Qe+1];for(let dt=0;dt<Ze.length-1;dt++)m.push(We(rt,Ze[dt],vt,Ze[dt+1]))}}else m.push(We({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:w+1}));return m}function $q(a,e){let s=a.stretchY||[[0,a.paddedRect.h-2*fd]];return e&&(a.stretchX||a.stretchY)?qL(a.stretchX||[[0,a.paddedRect.w-2*fd]])*qL(s):1}function Uw(a,e,s){let u=0;for(let d of a)u+=Math.max(e,Math.min(s,d[1]))-Math.max(e,Math.min(s,d[0]));return u}function GL(a,e,s){let u=[{fixed:-fd,stretch:0}];for(let[d,m]of a){let g=u[u.length-1];u.push({fixed:d-g.stretch,stretch:g.stretch}),u.push({fixed:d-g.stretch,stretch:g.stretch+(m-d)})}return u.push({fixed:e+fd,stretch:s}),u}function qL(a){return 2*a.length+1}function Hw(a,e,s,u){return a/e*s+u}function $w(a,e,s,u){return a-e*s/u}function Gq(a,e,s,u){let d=e+a.positionedLines[u].lineOffset;return u===0?s+d/2:s+(d+(e+a.positionedLines[u-1].lineOffset))/2}function qq(a,e=1,s=!1){let u=1/0,d=1/0,m=-1/0,g=-1/0,v=a[0];for(let R=0;R<v.length;R++){let k=v[R];(!R||k.x<u)&&(u=k.x),(!R||k.y<d)&&(d=k.y),(!R||k.x>m)&&(m=k.x),(!R||k.y>g)&&(g=k.y)}let b=Math.min(m-u,g-d),w=b/2,S=new bf([],Wq);if(b===0)return new ct(u,d);for(let R=u;R<m;R+=b)for(let k=d;k<g;k+=b)S.push(new z_(R+w,k+w,w,a));let D=(function(R){let k=0,B=0,U=0,G=R[0];for(let J=0,ee=G.length,se=ee-1;J<ee;se=J++){let _e=G[J],fe=G[se],we=_e.x*fe.y-fe.x*_e.y;B+=(_e.x+fe.x)*we,U+=(_e.y+fe.y)*we,k+=3*we}return new z_(B/k,U/k,0,R)})(a),I=S.length;for(;S.length;){let R=S.pop();(R.d>D.d||!D.d)&&(D=R,s&&console.log("found best %d after %d probes",Math.round(1e4*R.d)/1e4,I)),R.max-D.d<=e||(w=R.h/2,S.push(new z_(R.p.x-w,R.p.y-w,w,a)),S.push(new z_(R.p.x+w,R.p.y-w,w,a)),S.push(new z_(R.p.x-w,R.p.y+w,w,a)),S.push(new z_(R.p.x+w,R.p.y+w,w,a)),I+=4)}return s&&(console.log(`num probes: ${I}`),console.log(`best distance: ${D.d}`)),D.p}function Wq(a,e){return e.max-a.max}class z_{constructor(e,s,u,d){this.p=new ct(e,s),this.h=u,this.d=(function(m,g){let v=!1,b=1/0;for(let w=0;w<g.length;w++){let S=g[w];for(let D=0,I=S.length,R=I-1;D<I;R=D++){let k=S[D],B=S[R];k.y>m.y!=B.y>m.y&&m.x<(B.x-k.x)*(m.y-k.y)/(B.y-k.y)+k.x&&(v=!v),b=Math.min(b,tl(m,k,B))}}return(v?1:-1)*Math.sqrt(b)})(this.p,d),this.max=this.d+this.h*Math.SQRT2}}let Zq=Object.keys,ZI=Number.POSITIVE_INFINITY,Xq=Math.sqrt(2);function Gw(a,e,s,u){let d=a.collisionPadding||[0,0,0,0],m={top:a.top-d[1],bottom:a.bottom+d[3],left:a.left-d[0],right:a.right+d[2],scaled:!1};return u!==void 0&&(function(g,v){g.top*=v,g.bottom*=v,g.left*=v,g.right*=v,g.scaled=!0})(m,u),s&&(function(g,v){if(!v)return;let b=Wn(v),w=new ct(g.left,g.top),S=new ct(g.right,g.top),D=new ct(g.left,g.bottom),I=new ct(g.right,g.bottom);w._rotateAround(b,new ct(0,0)),S._rotateAround(b,new ct(0,0)),D._rotateAround(b,new ct(0,0)),I._rotateAround(b,new ct(0,0)),g.left=Math.min(w.x,S.x,D.x,I.x),g.right=Math.max(w.x,S.x,D.x,I.x),g.top=Math.min(w.y,S.y,D.y,I.y),g.bottom=Math.max(w.y,S.y,D.y,I.y)})(m,s),e?{top:Math.min(e.top,m.top),bottom:Math.max(e.bottom,m.bottom),left:Math.min(e.left,m.left),right:Math.max(e.right,m.right),scaled:e.scaled||m.scaled}:m}function WL(a,[e,s]){let u=0,d=0;if(s===ZI){e<0&&(e=0);let m=e/Xq;switch(a){case"top-right":case"top-left":d=m-7;break;case"bottom-right":case"bottom-left":d=7-m;break;case"bottom":d=7-e;break;case"top":d=e-7}switch(a){case"top-right":case"bottom-right":u=-m;break;case"top-left":case"bottom-left":u=m;break;case"left":u=e;break;case"right":u=-e}}else{switch(e=Math.abs(e),s=Math.abs(s),a){case"top-right":case"top-left":case"top":d=s-7;break;case"bottom-right":case"bottom-left":case"bottom":d=7-s}switch(a){case"top-right":case"bottom-right":case"right":u=-e;break;case"top-left":case"bottom-left":case"left":u=e}}return[u,d]}function Yq(a,e,s,u,d,m,g,v,b,w,S){let D=a.layers[0],I=D.appearances;if(I.length===0)return{iconBBox:null,iconVerticalBBox:null};let R=null,k=null,B=u.get("icon-rotate").evaluate(d,{},m);e&&(R=Gw(e,R,B,g),s)&&(k=Gw(s,k,B+90,g));let[U,G]=u.get("icon-size-scale-range"),J=X(1,U,G);for(let ee of I){let se=ee.getUnevaluatedProperties(),_e=se._values["icon-image"].value!==void 0,fe=se._values["icon-size"].value!==void 0,we=se._values["icon-offset"].value!==void 0,Ee=se._values["icon-rotate"].value!==void 0;if(_e||fe||we||Ee){let Se=we?D.getAppearanceValueAndResolveTokens(ee,"icon-offset",d,m,[]):null,We=Se&&Array.isArray(Se)?Se:v,Fe=Ee?D.getAppearanceValueAndResolveTokens(ee,"icon-rotate",d,m,[]):null,Ze=typeof Fe=="number"?Fe:B,Qe=fe?D.getAppearanceValueAndResolveTokens(ee,"icon-size",d,m,[]):null,rt=typeof Qe=="number"?Qe*b.iconScaleFactor:g,vt=null,dt=null,et=null;if(_e){let ut=D.getAppearanceValueAndResolveTokens(ee,"icon-image",d,m,[]);if(ut){let Ge=a.getResolvedImageFromTokens(ut),$e=se._values["icon-size"],lt=Jy(Ge,F_(a.zoom,$e,a.worldview),$e,m,a.zoom,d,a.pixelRatio,J,a.worldview);et=w.get(lt.iconPrimary.toString())}}else e&&(et=e.imagePrimary);et&&(vt=Vw(et,null,We,S),a.allowVerticalPlacement&&(dt=Vw(et,null,We,S))),vt&&(R=Gw(vt,R,Ze,rt)),dt&&(k=Gw(dt,k,Ze+90,rt))}}return{iconBBox:R,iconVerticalBBox:k}}function qw(a,e,s,u,d,m,g,v,b){if(!e||!e.usvg)return;let w=kL(u),S=kL(d),D=m!=="both"&&m!=="width"||!OL(u)?1:S.width/w.width,I=m!=="both"&&m!=="height"||!RL(u)?1:S.height/w.height;s.scaleSelf(D,I);let R=s.toString();g.set(R,s),v.set(R,e);let{imagePosition:k}=GI(R,e,Tm);b.set(R,k)}function ZL(a,e,s,u,d,m,g,v,b){if(!a)return;let w=(function(S,D,I,R,k,B){if(S.kind==="camera")return S.maxSize;if(S.kind==="composite"){let U=D.possiblyEvaluate(new or(S.maxZoom,{worldview:B}),I).evaluate(k,{},I),G=D.possiblyEvaluate(new or(S.minZoom,{worldview:B}),I).evaluate(k,{},I);return Math.max(U,G)}return D.possiblyEvaluate(new or(R,{worldview:B})).evaluate(k,{},I)})(e,s,u,d,m,b);return a.scaleSelf(w*v*g)}function Jy(a,e,s,u,d,m,g,v,b){return{iconPrimary:ZL(a.getPrimary(),e,s,u,d,m,g,v,b),iconSecondary:ZL(a.getSecondary(),e,s,u,d,m,g,v,b)}}function Kq(a,e,s){if(!e)return;let u=s.get(a.toString()),d=s.get(e.toString());u&&d&&(u.paddedRect.w===d.paddedRect.w&&u.paddedRect.h===d.paddedRect.h||Gt(`Mismatch in icon variant sizes: ${a.toString()} and ${e.toString()}`),u.usvg!==d.usvg&&Gt(`Mismatch in icon variant image types: ${a.id} and ${e.id}`))}function XL(a,e,s,u){if(!a)return;let d=e.get(s.toString());if(a.imagePrimary=d,u){let m=e.get(u.toString());a.imageSecondary=m}}function Jq(a,e){for(let s in a.horizontal)YL(a.horizontal[s],e);YL(a.vertical,e)}function YL(a,e){if(a){for(let s of a.positionedLines)for(let u of s.positionedGlyphs)if(u.image!==null){let d=u.image.toString();u.rect=e.get(d).paddedRect}}}function XI(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Qq(a,e,s,u,d,m,g,v,b){let w=YI(m.horizontal)||m.vertical,S=s.get("icon-text-fit-padding").evaluate(u,{},d),D,I=e;return e&&b!=="none"&&(a.allowVerticalPlacement&&m.vertical&&(D=HI(e,m.vertical,b,S,v,g)),w&&(I=HI(e,w,b,S,v,g))),{defaultShapedIcon:I,verticallyShapedIcon:D}}function e7(a,e,s,u,d,m,g,v,b,w,S,D,I,R,k,B,U,G,J,ee,se,_e){let fe=g.textMaxSize.evaluate(e,{},I);fe===void 0?fe=v*g.textScaleFactor:fe*=g.textScaleFactor;let we=a.layers[0].layout,Ee=Yo,Se=v*g.textScaleFactor/Ee,We=YI(s.horizontal)||s.vertical;if(U!=="none"&&a.appearanceFeatureData&&e.index<a.appearanceFeatureData.length){let it=a.appearanceFeatureData[e.index];it&&(it.textShaping=We,it.iconTextFitPadding=we.get("icon-text-fit-padding").evaluate(e,{},I),it.fontScale=Se)}let Fe=R.name==="globe",Ze=a.tilePixelRatio*fe/Ee,Qe=(Ge=a.overscaling,a.zoom>18&&Ge>2&&(Ge>>=1),Math.max(yt/(512*Ge),1)*we.get("symbol-spacing")),rt=we.get("text-padding")*a.tilePixelRatio,vt=we.get("icon-padding")*a.tilePixelRatio,dt=Wn(we.get("text-max-angle")),et=we.get("icon-rotation-alignment")==="map"&&ee!=="point",ut=Qe/2;var Ge;a.hasAnyIconTextFit===!1&&U!=="none"&&(a.hasAnyIconTextFit=!0);let $e=e.properties?+e.properties[At]:null,lt=$e&&a.elevationFeatureIdToIndex?a.elevationFeatureIdToIndex.get($e):65535,gt=(it,Nt,Ut)=>{if(Nt.x<0||Nt.x>=yt||Nt.y<0||Nt.y>=yt)return;let Pt=null;if(Fe){let{x:St,y:yn,z:It}=R.projectTilePoint(Nt.x,Nt.y,Ut);Pt={anchor:new Sh(St,yn,It,0,void 0),up:R.upVector(Ut,Nt.x,Nt.y)}}(function(St,yn,It,rn,xn,Nn,ri,wn,fi,pi,xr,pe,ue,Xe,Et,Ye,Dt,Yt,Xt,En,cn,qt,ui,$i,hn,ni,Gi,Ti,Ir,dr,nr){let Oi=St.addToLineVertexArray(yn,rn),mi,Tn,gi,ir,un,oi,hr,Nr=0,Jr=0,wo=0,fr=0,po=-1,La=-1,mo={},al=ju(""),Es=It?It.anchor:yn,Kl=Ti!=="none",Na=0,ll=0;if(fi._unevaluatedLayout.getValue("text-radial-offset")===void 0){let Ko=fi.layout.get("text-offset").evaluate(cn,{},hn);Na=Ko[0]*Yo,ll=Ko[1]*Yo}else Na=fi.layout.get("text-radial-offset").evaluate(cn,{},hn)*Yo,ll=ZI;if(St.allowVerticalPlacement&&xn.vertical){let Ko=xn.vertical;if(Et)oi=KI(Ko),wn&&(hr=KI(wn));else{let Qs=fi.layout.get("text-rotate").evaluate(cn,{},hn)+90;gi=Ww(pi,Es,yn,xr,pe,ue,Ko,Xe,Qs,Ye),wn&&(ir=Ww(pi,Es,yn,xr,pe,ue,wn,Yt,Qs,null,nr))}}if(Nn){let Ko=St.iconSizeData,Qs=fi.layout.get("icon-rotate").evaluate(cn,{},hn),pd=WI(Nn,Qs,ui,Kl,qt.iconScaleFactor),Jf=wn?WI(wn,Qs,ui,Kl,qt.iconScaleFactor):void 0;Tn=Ww(pi,Es,yn,xr,pe,ue,Nn,Yt,Qs,null,dr);let G_=(function(md,uC,q_,fW,m3,g3,pW,mW){let _3=md.layers[0],v3=_3.appearances,W_=uC.length;if(q_&&(W_=Math.max(W_,q_.length)),v3.length===0)return W_;let[gW,_W]=fW.get("icon-size-scale-range"),vW=X(1,gW,_W);for(let y3 of v3){let x3=y3.getUnevaluatedProperties();if(x3._values["icon-image"].value!==void 0){let b3=_3.getAppearanceValueAndResolveTokens(y3,"icon-image",m3,g3,[]);if(b3){let w3=md.getResolvedImageFromTokens(b3);if(w3){let C3=x3._values["icon-size"],yW=Jy(w3,F_(md.zoom,C3,md.worldview),C3,g3,md.zoom,m3,md.pixelRatio,vW,md.worldview),xW=pW.get(yW.iconPrimary.toString());W_=Math.max(W_,$q(xW,mW))}}}}return W_})(St,pd,Jf,fi.layout,cn,hn,St.iconAtlasPositions,Kl);Nr=4*G_;let Qf=null;Ko.kind==="source"?(Qf=[cu*fi.layout.get("icon-size").evaluate(cn,{},hn)*qt.iconScaleFactor],Qf[0]>Dh&&Gt(`${St.layerIds[0]}: Value for "icon-size" is >= ${Qy}. Reduce your "icon-size".`)):Ko.kind==="composite"&&(Qf=[cu*qt.compositeIconSizes[0].evaluate(cn,{},hn)*qt.iconScaleFactor,cu*qt.compositeIconSizes[1].evaluate(cn,{},hn)*qt.iconScaleFactor],(Qf[0]>Dh||Qf[1]>Dh)&&Gt(`${St.layerIds[0]}: Value for "icon-size" is >= ${Qy}. Reduce your "icon-size".`)),St.addSymbols(St.icon,pd,Qf,En,Xt,cn,void 0,It,yn,Oi.lineStartIndex,Oi.lineLength,-1,$i,hn,ni,Gi,St.symbolInstances.length,G_),po=St.icon.placedSymbolArray.length-1,Jf&&(Jr=4*G_,St.addSymbols(St.icon,Jf,Qf,En,Xt,cn,sl.vertical,It,yn,Oi.lineStartIndex,Oi.lineLength,-1,$i,hn,ni,Gi,St.symbolInstances.length,G_),La=St.icon.placedSymbolArray.length-1)}for(let Ko in xn.horizontal){let Qs=Ko,pd=xn.horizontal[Qs];mi||(al=ju(pd.text),Et?un=KI(pd):mi=Ww(pi,Es,yn,xr,pe,ue,pd,Xe,fi.layout.get("text-rotate").evaluate(cn,{},hn),Ye));let Jf=pd.positionedLines.length===1;if(wo+=KL(St,It,yn,pd,ri,fi,Et,cn,Ye,Oi,xn.vertical?sl.horizontal:sl.horizontalOnly,Jf?Zq(xn.horizontal):[Qs],mo,po,qt,$i,hn,St.symbolInstances.length,ni),Jf)break}xn.vertical&&(fr+=KL(St,It,yn,xn.vertical,ri,fi,Et,cn,Ye,Oi,sl.vertical,["vertical"],mo,La,qt,$i,hn,St.symbolInstances.length,ni));let Ts=-1,cl=(Ko,Qs)=>Ko?Math.max(Ko,Qs):Qs;Ts=cl(un,Ts),Ts=cl(oi,Ts),Ts=cl(hr,Ts);let Jl=Ts>-1?1:0;St.glyphOffsetArray.length>=65535&&Gt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),cn.sortKey!==void 0&&St.addToSortKeyRanges(St.symbolInstances.length,cn.sortKey),St.symbolInstances.emplaceBack(yn.x,yn.y,Es.x,Es.y,Es.z,mo.right>=0?mo.right:-1,mo.center>=0?mo.center:-1,mo.left>=0?mo.left:-1,mo.vertical>=0?mo.vertical:-1,po,La,al,mi!==void 0?mi:St.collisionBoxArray.length,mi!==void 0?mi+1:St.collisionBoxArray.length,gi!==void 0?gi:St.collisionBoxArray.length,gi!==void 0?gi+1:St.collisionBoxArray.length,Tn!==void 0?Tn:St.collisionBoxArray.length,Tn!==void 0?Tn+1:St.collisionBoxArray.length,ir||St.collisionBoxArray.length,ir?ir+1:St.collisionBoxArray.length,xr,wo,fr,Nr,Jr,Jl,0,Na,ll,Ts,0,Kl?1:0,Ir)})(a,Nt,Pt,it,s,u,m,d,a.layers[0],a.collisionBoxArray,e.index,e.sourceLayerIndex,a.index,rt,J,w,0,vt,et,G,e,g,S,D,I,k,B,U,lt,se,_e)};if(ee==="line")for(let it of Dw(e.geometry,0,0,yt,yt)){let Nt=Hq(it,Qe,dt,s.vertical||We,u,Ee,Ze,a.overscaling,yt);for(let Ut of Nt)We&&t7(a,We.text,ut,Ut)||gt(it,Ut,I)}else if(ee==="line-center"){for(let it of e.geometry)if(it.length>1){let Nt=Uq(it,dt,s.vertical||We,u,Ee,Ze);Nt&&gt(it,Nt,I)}}else if(e.type==="Polygon")for(let it of Fy(e.geometry,0)){let Nt=qq(it,16);gt(it[0],new Sh(Nt.x,Nt.y,0,0,void 0),I)}else if(e.type==="LineString")for(let it of e.geometry)gt(it,new Sh(it[0].x,it[0].y,0,0,void 0),I);else if(e.type==="Point")for(let it of e.geometry)for(let Nt of it)gt([Nt],new Sh(Nt.x,Nt.y,0,0,void 0),I)}let Qy=255,Dh=Qy*cu;function KL(a,e,s,u,d,m,g,v,b,w,S,D,I,R,k,B,U,G,J){let ee=(function(fe,we,Ee,Se,We,Fe,Ze,Qe){let rt=[];if(we.positionedLines.length===0)return rt;let vt=Se.layout.get("text-rotate").evaluate(Fe,{})*Math.PI/180,dt=(function(lt){let gt=lt[0],it=lt[1],Nt=gt*it;return Nt>0?[gt,-it]:Nt<0?[-gt,it]:gt===0?[it,gt]:[it,-gt]})(Ee),et=Math.abs(we.top-we.bottom);for(let lt of we.positionedLines)et-=lt.lineOffset;let ut=we.positionedLines.length,Ge=et/ut,$e=we.top-Ee[1];for(let lt=0;lt<ut;++lt){let gt=we.positionedLines[lt];$e=Gq(we,Ge,$e,lt);for(let it of gt.positionedGlyphs){if(!it.rect)continue;let Nt=it.rect||{},Ut=TL+1,Pt=!0,St=1,yn=0;if(it.image){let Xt=Ze.get(it.image.toString());if(!Xt)continue;if(Xt.sdf){Gt("SDF images are not supported in formatted text and will be ignored.");continue}Pt=!1,St=Xt.pixelRatio,Ut=Tm/St}let It=(We||Qe)&&it.vertical,rn=it.metrics.advance*it.scale/2,xn=it.metrics,Nn=it.rect;if(Nn===null)continue;Qe&&we.verticalizable&&(yn=it.image?rn-it.metrics.width*it.scale/2:0);let ri=We?[it.x+rn,it.y]:[0,0],wn=[0,0],fi=[0,0],pi=!1;We||(It?(fi=[it.x+rn+dt[0],it.y+dt[1]-yn],pi=!0):wn=[it.x+rn+Ee[0],it.y+Ee[1]-yn]);let xr=Nn.w*it.scale/(St*(it.localGlyph?uu:1)),pe=Nn.h*it.scale/(St*(it.localGlyph?uu:1)),ue,Xe,Et,Ye;if(It){let Xt=it.y-$e,En=new ct(-rn,rn-Xt),cn=-Math.PI/2,qt=new ct(...fi);ue=new ct(-rn+wn[0],wn[1]),ue._rotateAround(cn,En)._add(qt),ue.x+=-Xt+rn,ue.y-=(xn.left-Ut)*it.scale;let ui=it.image?xn.advance*it.scale:Yo*it.scale,$i=String.fromCodePoint(it.glyph);Sq($i)?ue.x+=(1-Ut)*it.scale:Dq($i)?ue.x+=ui-xn.height*it.scale+(-Ut-1)*it.scale:ue.x+=it.image||xn.width+2*Ut===Nn.w&&xn.height+2*Ut===Nn.h?(ui-pe)/2:(ui-(xn.height+2*Ut)*it.scale)/2,Xe=new ct(ue.x,ue.y-xr),Et=new ct(ue.x+pe,ue.y),Ye=new ct(ue.x+pe,ue.y-xr)}else{let Xt=(xn.left-Ut)*it.scale-rn+wn[0],En=(-xn.top-Ut)*it.scale+wn[1],cn=Xt+xr,qt=En+pe;ue=new ct(Xt,En),Xe=new ct(cn,En),Et=new ct(Xt,qt),Ye=new ct(cn,qt)}if(vt){let Xt;Xt=We?new ct(0,0):pi?new ct(dt[0],dt[1]):new ct(Ee[0],Ee[1]),ue._rotateAround(vt,Xt),Xe._rotateAround(vt,Xt),Et._rotateAround(vt,Xt),Ye._rotateAround(vt,Xt)}let Dt=new ct(0,0),Yt=new ct(0,0);rt.push({tl:ue,tr:Xe,bl:Et,br:Ye,texPrimary:Nt,texSecondary:void 0,writingMode:we.writingMode,glyphOffset:ri,sectionIndex:it.sectionIndex,isSDF:Pt,pixelOffsetTL:Dt,pixelOffsetBR:Yt,minFontScaleX:0,minFontScaleY:0})}}return rt})(0,u,b,m,g,v,d,a.allowVerticalPlacement),se=a.textSizeData,_e=null;se.kind==="source"?(_e=[cu*m.layout.get("text-size").evaluate(v,{},U)*k.textScaleFactor],_e[0]>Dh&&Gt(`${a.layerIds[0]}: Value for "text-size" is >= ${Qy}. Reduce your "text-size".`)):se.kind==="composite"&&(_e=[cu*k.compositeTextSizes[0].evaluate(v,{},U)*k.textScaleFactor,cu*k.compositeTextSizes[1].evaluate(v,{},U)*k.textScaleFactor],(_e[0]>Dh||_e[1]>Dh)&&Gt(`${a.layerIds[0]}: Value for "text-size" is >= ${Qy}. Reduce your "text-size".`)),a.addSymbols(a.text,ee,_e,b,g,v,S,e,s,w.lineStartIndex,w.lineLength,R,B,U,J,!1,G,ee.length);for(let fe of D)I[fe]=a.text.placedSymbolArray.length-1;return 4*ee.length}function YI(a){for(let e in a)return a[e];return null}function Ww(a,e,s,u,d,m,g,v,b,w,S){let D,I,R,k;if(D=S?S.top:g.top,I=S?S.bottom:g.bottom,R=S?S.left:g.left,k=S?S.right:g.right,PL(g)&&g.collisionPadding){let B=g.collisionPadding;R-=B[0],D-=B[1],k+=B[2],I+=B[3]}if(b){let B=new ct(R,D),U=new ct(k,D),G=new ct(R,I),J=new ct(k,I),ee=Wn(b),se=new ct(0,0);w&&(se=new ct(w[0],w[1])),B._rotateAround(ee,se),U._rotateAround(ee,se),G._rotateAround(ee,se),J._rotateAround(ee,se),R=Math.min(B.x,U.x,G.x,J.x),k=Math.max(B.x,U.x,G.x,J.x),D=Math.min(B.y,U.y,G.y,J.y),I=Math.max(B.y,U.y,G.y,J.y)}return a.emplaceBack(e.x,e.y,e.z,s.x,s.y,R,D,k,I,v,u,d,m),a.length-1}function KI(a){PL(a)&&a.collisionPadding&&(a.top-=a.collisionPadding[1],a.bottom+=a.collisionPadding[3]);let e=a.bottom-a.top;return e>0?Math.max(10,e):null}function t7(a,e,s,u){let d=a.compareText;if(e in d){let m=d[e];for(let g=m.length-1;g>=0;g--)if(u.dist(m[g])<s)return!0}else d[e]=[];return d[e].push(u),!1}function JL(a,e){let s=a.fovAboveCenter,u=a.elevation?a.elevation.getMinElevationBelowMSL()*e:0,d=(a._camera.position[2]*a.worldSize-u)/Math.cos(a._pitch),m=Math.sin(s)*d/Math.sin(Math.max(Math.PI/2-a._pitch-s,.01)),g=Math.sin(a._pitch)*m+d,v=d*(1/a._horizonShift);if(!a.elevation||a.elevation.exaggeration()===0){let b=Math.max(a.zoom-17,0);a.isOrthographic&&(b/=10),g*=1+b}return Math.min(1.01*g,v)}function ex(a,e){if(!e.isReprojectedInTileSpace)return{scale:1<<a.z,x:a.x,y:a.y,x2:a.x+1,y2:a.y+1,projection:e};let s=Math.pow(2,-a.z),u=a.x*s,d=(a.x+1)*s,m=a.y*s,g=(a.y+1)*s,v=ae(u),b=ae(d),w=re(m),S=re(g),D=e.project(v,w),I=e.project(b,w),R=e.project(b,S),k=e.project(v,S),B=Math.min(D.x,I.x,R.x,k.x),U=Math.min(D.y,I.y,R.y,k.y),G=Math.max(D.x,I.x,R.x,k.x),J=Math.max(D.y,I.y,R.y,k.y),ee=s/16;function se(fe,we,Ee,Se,We,Fe){let Ze=(Ee+We)/2,Qe=(Se+Fe)/2,rt=e.project(ae(Ze),re(Qe)),vt=Math.max(0,B-rt.x,U-rt.y,rt.x-G,rt.y-J);B=Math.min(B,rt.x),G=Math.max(G,rt.x),U=Math.min(U,rt.y),J=Math.max(J,rt.y),vt>ee&&(se(fe,rt,Ee,Se,Ze,Qe),se(rt,we,Ze,Qe,We,Fe))}se(D,I,u,m,d,m),se(I,R,d,m,d,g),se(R,k,d,g,u,g),se(k,D,u,g,u,m),B-=ee,U-=ee,G+=ee,J+=ee;let _e=1/Math.max(G-B,J-U);return{scale:_e,x:B*_e,y:U*_e,x2:G*_e,y2:J*_e,projection:e}}function QL(a,{x:e,y:s},u=0){return new ct(((e-u)*a.scale-a.x)*yt,(s*a.scale-a.y)*yt)}let n7=Be(new Float32Array(16));class Yf{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,s){return{x:0,y:0,z:0}}unproject(e,s){return new F(0,0)}projectTilePoint(e,s,u){return{x:e,y:s,z:0}}locationPoint(e,s,u,d=!0){return e._coordinatePoint(e.locationCoordinate(s,u),d)}pixelsPerMeter(e,s){return Q(1,e)*s}pixelSpaceConversion(e,s,u){return 1}farthestPixelDistance(e){return JL(e,e.pixelsPerMeter)}pointCoordinate(e,s,u,d){let m=e.horizonLineFromTop(!1),g=new ct(s,Math.max(m,u));return e.rayIntersectionCoordinate(e.pointRayIntersection(g,d))}pointCoordinate3D(e,s,u){let d=new ct(s,u);if(e.elevation)return e.elevation.pointCoordinate(d);{let m=this.pointCoordinate(e,d.x,d.y,0);return[m.x,m.y,m.z]}}isPointAboveHorizon(e,s){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,s.x,s.y);let u=e.horizonLineFromTop();return s.y<u}createInversionMatrix(e,s){return n7}createTileMatrix(e,s,u){let d,m,g,v=u.canonical,b=Be(new Float64Array(16));if(this.isReprojectedInTileSpace){let w=ex(v,this);d=1,m=w.x+u.wrap*w.scale,g=w.y,Cn(b,b,[d/w.scale,d/w.scale,e.pixelsPerMeter/s])}else d=s/e.zoomScale(v.z),m=(v.x+Math.pow(2,v.z)*u.wrap)*d,g=v.y*d;return kt(b,b,[m,g,0]),Cn(b,b,[d/yt,d/yt,1]),b}upVector(e,s,u){return[0,0,1]}upVectorScale(e,s,u){return{metersToTile:1}}}class i7 extends Yf{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];let[s,u]=this.parallels=e.parallels||[29.5,45.5],d=Math.sin(Wn(s));this.n=(d+Math.sin(Wn(u)))/2,this.c=1+d*(2*this.n-d),this.r0=Math.sqrt(this.c)/this.n}project(e,s){let{n:u,c:d,r0:m}=this,g=Wn(e-this.center[0]),v=Wn(s),b=Math.sqrt(d-2*u*Math.sin(v))/u;return{x:b*Math.sin(g*u),y:b*Math.cos(g*u)-m,z:0}}unproject(e,s){let{n:u,c:d,r0:m}=this,g=m+s,v=Math.atan2(e,Math.abs(g))*Math.sign(g);g*u<0&&(v-=Math.PI*Math.sign(e)*Math.sign(g));let b=Wn(this.center[0])*u;v=ye(v,-Math.PI-b,Math.PI-b);let w=X(zo(v/u)+this.center[0],-180,180),S=Math.asin(X((d-(e*e+g*g)*u*u)/(2*u),-1,1)),D=X(zo(S),-ce,ce);return new F(w,D)}}let tx=1.340264,nx=-.081106,ix=893e-6,rx=.003796,Zw=Math.sqrt(3)/2;class r7 extends Yf{project(e,s){s=s/180*Math.PI,e=e/180*Math.PI;let u=Math.asin(Zw*Math.sin(s)),d=u*u,m=d*d*d;return{x:.5*(e*Math.cos(u)/(Zw*(tx+3*nx*d+m*(7*ix+9*rx*d)))/Math.PI+.5),y:1-.5*(u*(tx+nx*d+m*(ix+rx*d))/Math.PI+1),z:0}}unproject(e,s){e=(2*e-.5)*Math.PI;let u=s=(2*(1-s)-1)*Math.PI,d=u*u,m=d*d*d;for(let S,D,I,R=0;R<12&&(D=u*(tx+nx*d+m*(ix+rx*d))-s,I=tx+3*nx*d+m*(7*ix+9*rx*d),S=D/I,u=X(u-S,-Math.PI/3,Math.PI/3),d=u*u,m=d*d*d,!(Math.abs(S)<1e-12));++R);let g=Zw*e*(tx+3*nx*d+m*(7*ix+9*rx*d))/Math.cos(u),v=Math.asin(Math.sin(u)/Zw),b=X(180*g/Math.PI,-180,180),w=X(180*v/Math.PI,-ce,ce);return new F(b,w)}}class o7 extends Yf{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,s){return{x:.5+e/360,y:.5-s/360,z:0}}unproject(e,s){let u=360*(e-.5),d=X(360*(.5-s),-ce,ce);return new F(u,d)}}let B_=Math.PI/2;function Xw(a){return Math.tan((B_+a)/2)}class s7 extends Yf{constructor(e){super(e),this.center=e.center||[0,30];let[s,u]=this.parallels=e.parallels||[30,30],d=Wn(s),m=Wn(u);this.southernCenter=d+m<0,this.southernCenter&&(d=-d,m=-m);let g=Math.cos(d),v=Xw(d);this.n=d===m?Math.sin(d):Math.log(g/Math.cos(m))/Math.log(Xw(m)/v),this.f=g*Math.pow(Xw(d),this.n)/this.n}project(e,s){s=Wn(s),this.southernCenter&&(s=-s),e=Wn(e-this.center[0]);let u=1e-6,{n:d,f:m}=this;m>0?s<-B_+u&&(s=-B_+u):s>B_-u&&(s=B_-u);let g=m/Math.pow(Xw(s),d),v=g*Math.sin(d*e),b=m-g*Math.cos(d*e);return v=.5*(v/Math.PI+.5),b=.5*(b/Math.PI+.5),{x:v,y:this.southernCenter?b:1-b,z:0}}unproject(e,s){e=(2*e-.5)*Math.PI,this.southernCenter&&(s=1-s),s=(2*(1-s)-.5)*Math.PI;let{n:u,f:d}=this,m=d-s,g=Math.sign(m),v=Math.sign(u)*Math.sqrt(e*e+m*m),b=Math.atan2(e,Math.abs(m))*g;m*u<0&&(b-=Math.PI*Math.sign(e)*g);let w=X(zo(b/u)+this.center[0],-180,180),S=X(zo(2*Math.atan(Math.pow(d/v,1/u))-B_),-ce,ce);return new F(w,this.southernCenter?-S:S)}}class eN extends Yf{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,s){return{x:K(e),y:Z(s),z:0}}unproject(e,s){let u=ae(e),d=re(s);return new F(u,d)}}let tN=Wn(ce);class a7 extends Yf{project(e,s){let u=(s=Wn(s))*s,d=u*u;return{x:.5*((e=Wn(e))*(.8707-.131979*u+d*(d*(.003971*u-.001529*d)-.013791))/Math.PI+.5),y:1-.5*(s*(1.007226+u*(.015085+d*(.028874*u-.044475-.005916*d)))/Math.PI+1),z:0}}unproject(e,s){e=(2*e-.5)*Math.PI;let u=s=(2*(1-s)-1)*Math.PI,d=25,m=0,g=u*u;do{g=u*u;let w=g*g;m=(u*(1.007226+g*(.015085+w*(.028874*g-.044475-.005916*w)))-s)/(1.007226+g*(.045255+w*(.259866*g-.311325-.005916*11*w))),u=X(u-m,-tN,tN)}while(Math.abs(m)>1e-6&&--d>0);g=u*u;let v=X(zo(e/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),b=zo(u);return new F(v,b)}}let nN=Wn(ce);class l7 extends Yf{project(e,s){s=Wn(s),e=Wn(e);let u=Math.cos(s),d=2/Math.PI,m=Math.acos(u*Math.cos(e/2)),g=Math.sin(m)/m,v=.5*(e*d+2*u*Math.sin(e/2)/g)||0,b=.5*(s+Math.sin(s)/g)||0;return{x:.5*(v/Math.PI+.5),y:1-.5*(b/Math.PI+1),z:0}}unproject(e,s){let u=e=(2*e-.5)*Math.PI,d=s=(2*(1-s)-1)*Math.PI,m=25,g=1e-6,v=0,b=0;do{let w=Math.cos(d),S=Math.sin(d),D=2*S*w,I=S*S,R=w*w,k=Math.cos(u/2),B=Math.sin(u/2),U=2*k*B,G=B*B,J=1-R*k*k,ee=J?1/J:0,se=J?Math.acos(w*k)*Math.sqrt(1/J):0,_e=.5*(2*se*w*B+2*u/Math.PI)-e,fe=.5*(se*S+d)-s,we=.5*ee*(R*G+se*w*k*I)+1/Math.PI,Ee=ee*(U*D/4-se*S*B),Se=.125*ee*(D*B-se*S*R*U),We=.5*ee*(I*k+se*G*w)+.5,Fe=Ee*Se-We*we;v=(fe*Ee-_e*We)/Fe,b=(_e*Se-fe*we)/Fe,u=X(u-v,-Math.PI,Math.PI),d=X(d-b,-nN,nN)}while((Math.abs(v)>g||Math.abs(b)>g)&&--m>0);return new F(zo(u),zo(d))}}class iN extends Yf{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Wn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,s){let{scale:u,cosPhi:d}=this;return{x:Wn(e)*d*u+.5,y:-Math.sin(Wn(s))/d*u+.5,z:0}}unproject(e,s){let{scale:u,cosPhi:d}=this,m=-(s-.5)/u,g=X(zo((e-.5)/u)/d,-180,180),v=Math.asin(X(m*d,-1,1)),b=X(zo(v),-ce,ce);return new F(g,b)}}class c7 extends eN{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,s,u){let d=My(e,s,u);return pr(d,d,vw(dd(u))),{x:d[0],y:d[1],z:d[2]}}locationPoint(e,s,u){let d=T(s.lat,s.lng),m=Li([],d),g=u?e._centerAltitude+u:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(s),e._centerAltitude):e._centerAltitude;Do(d,d,m,Q(1,0)*yt*g);let v=Be(new Float64Array(16));return ot(v,e.pixelMatrix,e.globeMatrix),pr(d,d,v),new ct(d[0],d[1])}pixelsPerMeter(e,s){return Q(1,0)*s}pixelSpaceConversion(e,s,u){let d=Q(1,e)*s,m=ln(Q(1,45)*s,d,u);return this.pixelsPerMeter(e,s)/m}createTileMatrix(e,s,u){let d=iI(dd(u.canonical));return ot(new Float64Array(16),e.globeMatrix,d)}createInversionMatrix(e,s){let{center:u}=e,d=vw(dd(s));return On(d,d,Wn(u.lng)),Xn(d,d,Wn(u.lat)),Cn(d,d,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(d)}pointCoordinate(e,s,u,d){return Dk(e,s,u,!0)||new Re(0,0)}pointCoordinate3D(e,s,u){let d=this.pointCoordinate(e,s,u,0);return[d.x,d.y,d.z]}isPointAboveHorizon(e,s){return!Dk(e,s.x,s.y,!1)}farthestPixelDistance(e){let s=(function(d,m){let g=d.cameraToCenterDistance,v=d._centerAltitude*m,b=d._camera,w=d._camera.forward(),S=Pr([],Ui([],w,-g),[0,0,v]),D=d.worldSize/(2*Math.PI),I=[0,0,-D],R=d.width/d.height,k=Math.tan(d.fovAboveCenter),B=Ui([],b.up(),k),U=Ui([],b.right(),k*R),G=Li([],Pr([],Pr([],w,B),U)),J=[],ee;if(new Mn(S,G).closestPointOnSphere(I,D,J)){let se=Pr([],J,I),_e=Ur([],se,S);ee=Math.cos(d.fovAboveCenter)*ai(_e)}else{let se=Ur([],S,I),_e=Ur([],I,S);Li(_e,_e);let fe=ai(se)-D;ee=Math.sqrt(fe*(fe+2*D));let we=Math.acos(ee/(D+fe))-Math.acos(Vr(w,_e));ee*=Math.cos(we)}return 1.01*ee})(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),u=qf(e.zoom);if(u>0){let d=JL(e,Q(1,e.center.lat)*e.worldSize),m=e.worldSize/(2*Math.PI),g=Math.max(e.width,e.height)/e.worldSize*Math.PI;return ln(s,d+m*(1-Math.cos(g)),Math.pow(u,10))}return s}upVector(e,s,u){return My(s,u,e,1)}upVectorScale(e){return{metersToTile:mw(_w(dd(e)))}}}function rN(a){let e=a.parallels,s=!!e&&Math.abs(e[0]+e[1])<.01;switch(a.name){case"mercator":return new eN(a);case"equirectangular":return new o7(a);case"naturalEarth":return new a7(a);case"equalEarth":return new r7(a);case"winkelTripel":return new l7(a);case"albers":return s?new iN(a):new i7(a);case"lambertConformalConic":return s?new iN(a):new s7(a);case"globe":return new c7(a)}throw new Error(`Invalid projection name: ${a.name}`)}let u7=at.types,d7=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ox(a,e,s,u,d,m,g,v,b,w,S,D,I){let R=v?Math.min(Dh,Math.round(v[0])):0,k=v?Math.min(Dh,Math.round(v[1])):0;a.emplaceBack(e,s,Math.round(32*u),Math.round(32*d),m,g,(R<<1)+(b?1:0),0+(k<<1),16*w,16*S,256*D,256*I)}function sx(a,e,s){a.emplaceBack(e,s)}function ax(a,e,s,u,d,m,g){a.emplaceBack(e,s,u,d,m,g)}let Yw=(a,e,s,u)=>{for(let d=0;d<e;d++)a.emplaceBack(s[0],s[1],s[2],u[0],u[1],u[2])};function j_(a,e,s,u,d){a.emplaceBack(e,s,u,d),a.emplaceBack(e,s,u,d),a.emplaceBack(e,s,u,d),a.emplaceBack(e,s,u,d)}function h7(a){for(let e of a.sections)if(jD(e.text))return!0;return!1}class JI{constructor(e){this.layoutVertexArray=new p_,this.indexArray=new mr,this.programConfigurations=e,this.segments=new wr,this.dynamicLayoutVertexArray=new cd,this.opacityVertexArray=new fy,this.placedSymbolArray=new mm,this.iconTransitioningVertexArray=new Sl,this.globeExtVertexArray=new Nf,this.zOffsetVertexArray=new ru,this.orientationVertexArray=new gy,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getIconVertexData(e,s){let u=[],d=this.layoutVertexArray.uint16;for(let m=0;m<s;++m){let g=12*(e+m);u.push(...d.slice(g,g+12))}return u}updateIconVertexData(e,s,u,d,m,g,v,b,w,S,D,I,R){let k=this.layoutVertexArray.uint16,B=12*e;k[B]=s,k[B+1]=u,k[B+2]=d,k[B+3]=m,k[B+4]=g,k[B+5]=v,k[B+6]=b,k[B+7]=w,k[B+8]=S,k[B+9]=D,k[B+10]=I,k[B+11]=R}upload(e,s,u,d,m,g){this.isEmpty()||(u&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,gq.members,!!g),this.indexBuffer=e.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,vq.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,d7,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,bq.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,_q.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||m)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,yq.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,xq.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||d)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Bt(JI,"SymbolBuffers");class QI{constructor(e,s,u){this.layoutVertexArray=new e,this.layoutAttributes=s,this.indexArray=new u,this.segments=new wr,this.collisionVertexArray=new Bf,this.collisionVertexArrayExt=new cd}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,wq.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Cq.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Bt(QI,"CollisionBuffers");class Kw{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(g=>g.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Be([]),this.placementViewportMatrix=Be([]);let s=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.textSizeData=F_(this.zoom,s["text-size"],this.worldview),this.iconSizeData=F_(this.zoom,s["icon-size"],this.worldview);let u=this.layers[0].layout,d=u.get("symbol-sort-key"),m=u.get("symbol-z-order");this.lut=e.lut,this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&d.constantOr(1)!==void 0,this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(g=>sl[g]),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null}hasAnyAppearanceProperty(e){let s=this.layers[0].getAppearances();return!(!s||s.length===0)&&s.some(u=>u.getProperty(e)!=null)}createArrays(){this.text=new JI(new Xl(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new JI(new Xl(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new Cy,this.lineVertexArray=new ow,this.symbolInstances=new rw}calculateGlyphDependencies(e,s,u,d,m){for(let g of e){let v=g.codePointAt(0);if(v===void 0)break;if(s[v]=!0,d&&m&&v<=65535){let b=Zy[g];b&&(s[b.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(e,s,u,d,m,g){let v=1,b=e.getUnevaluatedProperties()._values["icon-size"],w=F_(this.zoom,b,this.worldview),S=L_(w,s);if(w.kind!=="constant"&&w.kind!=="camera"||(v=S.uSize),w.kind==="composite"){let{minZoom:D,maxZoom:I}=w,R=b.possiblyEvaluate(new or(D,{worldview:this.worldview}),d),k=b.possiblyEvaluate(new or(I,{worldview:this.worldview}),d),B=R.evaluate(u,{},d,m);v=B+(k.evaluate(u,{},d,m)-B)*S.uSizeT}return w.kind==="source"&&(v=b.possiblyEvaluate(new or(this.zoom,{worldview:this.worldview}),d).evaluate(u,{},d,m)),v*g}updateFootprints(e,s){}updateReplacement(e,s){if(s.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=s.updateTime;let u=s.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!Ew(this.activeReplacements,u)&&(this.activeReplacements=u,!0)}getResolvedImageFromTokens(e){return typeof e=="string"?xs.build(e):e}populate(e,s,u,d){let m=this.layers[0],g=m.layout,v=this.projection.name==="globe",b=g.get("text-font"),w=g.get("text-field"),S=g.get("icon-image"),[D,I]=g.get("icon-size-scale-range"),R=X(s.scaleFactor||1,D,I),k=(w.value.kind!=="constant"||w.value.value instanceof xo&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),B=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,U=this.hasAnyAppearanceProperty("icon-image"),G=g.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!k&&!B&&!U)return;let J=s.iconDependencies,ee=s.glyphDependencies,se=s.availableImages,_e=new or(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),fe=we=>{let Ee=we.id.toString();J.has(Ee)?J.get(Ee).push(we):J.set(Ee,[we])};for(let we of e){let{feature:Ee,id:Se,index:We,sourceLayerIndex:Fe}=we,Ze=m._featureFilter.needGeometry,Qe=Ue(Ee,Ze);if(!m._featureFilter.filter(_e,Qe,u))continue;if(Ze||(Qe.geometry=Je(Ee,u,d)),v&&Ee.type!==1&&u.z<=5){let lt=Qe.geometry,gt=.98078528056,it=(Nt,Ut)=>Vr(My(Nt.x,Nt.y,u,1),My(Ut.x,Ut.y,u,1))<gt;for(let Nt=0;Nt<lt.length;Nt++)lt[Nt]=Ke(lt[Nt],it)}let rt,vt;if(k){let lt=m.getValueAndResolveTokens("text-field",Qe,u,se),gt=xo.factory(lt);h7(gt)&&(this.hasRTLText=!0),(!this.hasRTLText||ry()==="unavailable"||this.hasRTLText&&Fa.isParsed())&&(rt=Tq(gt,m,Qe))}if(B){let lt=m.getValueAndResolveTokens("icon-image",Qe,u,se);vt=this.getResolvedImageFromTokens(lt)}let dt=this.layers[0],et=!1;if(!vt&&U){let lt=dt.getAppearances();for(let gt of lt)if(gt.getProperty("icon-image")){let it=dt.getAppearanceValueAndResolveTokens(gt,"icon-image",Qe,u,se);if(it){vt=this.getResolvedImageFromTokens(it),et=!0;break}}}if(!rt&&!vt)continue;let ut=this.sortFeaturesByKey?G.evaluate(Qe,{},u):void 0,Ge={id:Se,text:rt,icon:vt,index:We,sourceLayerIndex:Fe,geometry:Qe.geometry,properties:Ee.properties,type:u7[Ee.type],sortKey:ut};if(this.features.push(Ge),this.appearanceFeatureData.push({id:Se,properties:Ee.properties,usesAppearanceIconAsPlaceholder:et,isUsingAppearanceVertexData:!1,layoutBasedVertexData:[],activeAppearance:null}),vt){let lt=dt._unevaluatedLayout._values,{iconPrimary:gt,iconSecondary:it}=Jy(vt,this.iconSizeData,lt["icon-size"],u,this.zoom,Ge,this.pixelRatio,R,this.worldview);fe(gt),it&&(this.hasAnySecondaryIcon=!0,fe(it))}let $e=dt.getAppearances();if($e.length!==0&&$e.forEach(lt=>{if(!lt.getProperty("icon-image"))return;let gt=this.getCombinedIconPrimary(lt,dt,Qe,u,se,Ge,R);gt&&fe(gt)}),rt){let lt=b.evaluate(Qe,{},u).join(","),gt=g.get("text-rotation-alignment")==="map"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(sl.vertical)>=0;for(let it of rt.sections)if(it.image){let Nt=it.image.getPrimary().scaleSelf(this.pixelRatio),Ut=Nt.id.toString(),Pt=J.get(Ut)||[];Pt.push(Nt),J.set(Ut,Pt)}else{let Nt=Jv(rt.toString()),Ut=it.fontStack||lt,Pt=ee[Ut]=ee[Ut]||{};this.calculateGlyphDependencies(it.text,Pt,gt,this.allowVerticalPlacement,Nt)}}}if(g.get("symbol-placement")==="line"&&(this.features=(function(we){let Ee={},Se={},We=[],Fe=0;function Ze(dt){We.push(we[dt]),Fe++}function Qe(dt,et,ut){let Ge=Se[dt];return delete Se[dt],Se[et]=Ge,We[Ge].geometry[0].pop(),We[Ge].geometry[0]=We[Ge].geometry[0].concat(ut[0]),Ge}function rt(dt,et,ut){let Ge=Ee[et];return delete Ee[et],Ee[dt]=Ge,We[Ge].geometry[0].shift(),We[Ge].geometry[0]=ut[0].concat(We[Ge].geometry[0]),Ge}function vt(dt,et,ut){let Ge=ut?et[0][et[0].length-1]:et[0][0];return`${dt}:${Ge.x}:${Ge.y}`}for(let dt=0;dt<we.length;dt++){let et=we[dt],ut=et.geometry,Ge=et.text?et.text.toString():null;if(!Ge){Ze(dt);continue}let $e=vt(Ge,ut),lt=vt(Ge,ut,!0);if($e in Se&&lt in Ee&&Se[$e]!==Ee[lt]){let gt=rt($e,lt,ut),it=Qe($e,lt,We[gt].geometry);delete Ee[$e],delete Se[lt],Se[vt(Ge,We[it].geometry,!0)]=it,We[gt].geometry=null}else $e in Se?Qe($e,lt,ut):lt in Ee?rt($e,lt,ut):(Ze(dt),Ee[$e]=Fe-1,Se[lt]=Fe-1)}return We.filter(dt=>dt.geometry)})(this.features)),g.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",s.elevationFeatures){!this.elevationFeatures&&s.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(let we of s.elevationFeatures)this.elevationFeatureIdToIndex.set(we.id,this.elevationFeatures.length),this.elevationFeatures.push(we)}}else g.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((we,Ee)=>we.sortKey-Ee.sortKey)}getCombinedIconPrimary(e,s,u,d,m,g,v){let b,w,S=e.getUnevaluatedProperties();if(S._values["icon-image"].value!==void 0){let D=s.getAppearanceValueAndResolveTokens(e,"icon-image",u,d,m);b=this.getResolvedImageFromTokens(D)}else{let D=s.getValueAndResolveTokens("icon-image",u,d,m);b=this.getResolvedImageFromTokens(D)}if(b){let D=S._values["icon-size"]||s._unevaluatedLayout._values["icon-size"];w=Jy(b,F_(this.zoom,D,this.worldview),D,d,this.zoom,g,this.pixelRatio,v,this.worldview).iconPrimary}return w}updateAppearanceBasedIconTextures(e,s,u,d){if(!this.appearanceFeatureData||!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)return!1;let m=this.layers[0],g=!1,v=0,b=m.layout,[w,S]=b.get("icon-size-scale-range"),D=X(1,w,S);for(let I=0;I<this.symbolInstances.length;I++){let R=this.symbolInstances.get(I),k=this.appearanceFeatureData[R.featureIndex];if(k&&R.placedIconSymbolIndex>=0){let B=k.id,U=s&&B!==void 0?s[String(B)]:void 0,G={type:"Point",id:k.id,properties:k.properties,geometry:[]},J=this.layers[0].appearances&&this.layers[0].appearances.find(ee=>ee.isActive({globals:d,feature:G,canonical:e,featureState:U}));if(k.activeAppearance===J)continue;if(J){k.activeAppearance=J;let ee={sortKey:void 0,text:void 0,icon:null,index:R.featureIndex,sourceLayerIndex:R.featureIndex,geometry:[],properties:k.properties,type:"Point",id:k.id};if(!J.hasCachedIconPrimary()){let we=this.getCombinedIconPrimary(J,m,G,e,u,ee,D);J.setCachedIconPrimary(we)}let se=J.getCachedIconPrimary();if(!se)continue;let _e=se.toString(),fe=this.iconAtlasPositions&&this.iconAtlasPositions.get(_e);if(fe){let we=m.getAppearanceValueAndResolveTokens(J,"icon-offset",G,e,u),Ee=we&&Array.isArray(we)?we:[0,0],Se=Vw(fe,void 0,Ee,m.layout.get("icon-anchor").evaluate(G,{},e)),We=m.getAppearanceValueAndResolveTokens(J,"icon-rotate",G,e,u),Fe=typeof We=="number"?We:0,Ze=fe.sdf,Qe=m.layout.get("icon-text-fit").constantOr("none");Qe!=="none"&&k.textShaping&&k.iconTextFitPadding&&k.fontScale&&(Se=HI(Se,k.textShaping,Qe,k.iconTextFitPadding,Ee,k.fontScale));let rt=this.calculateEffectiveAppearanceIconSize(J,d.zoom,G,e,u,D),vt=0,dt=1+(Math.min(Dh,Math.round(rt*cu))<<1),et=WI(Se,Fe,Ze,Qe!=="none",D);k.isUsingAppearanceVertexData||(k.isUsingAppearanceVertexData=!0,k.layoutBasedVertexData=this.icon.getIconVertexData(v,R.numIconVertices));for(let Ge=0;Ge<et.length;++Ge){let $e=et[Ge],lt=k.layoutBasedVertexData[0]||R.tileAnchorX,gt=k.layoutBasedVertexData[1]||R.tileAnchorY,it=16*$e.pixelOffsetTL.x,Nt=16*$e.pixelOffsetTL.y,Ut=16*$e.pixelOffsetBR.x,Pt=16*$e.pixelOffsetBR.y,St=16*$e.minFontScaleX,yn=16*$e.minFontScaleY;this.icon.updateIconVertexData(v,lt,gt,Math.round(32*$e.tl.x),Math.round(32*$e.tl.y),$e.texPrimary.x,$e.texPrimary.y,vt,dt,it,Nt,St,yn),this.icon.updateIconVertexData(v+1,lt,gt,Math.round(32*$e.tr.x),Math.round(32*$e.tr.y),$e.texPrimary.x+$e.texPrimary.w,$e.texPrimary.y,vt,dt,Ut,Nt,St,yn),this.icon.updateIconVertexData(v+2,lt,gt,Math.round(32*$e.bl.x),Math.round(32*$e.bl.y),$e.texPrimary.x,$e.texPrimary.y+$e.texPrimary.h,vt,dt,it,Pt,St,yn),this.icon.updateIconVertexData(v+3,lt,gt,Math.round(32*$e.br.x),Math.round(32*$e.br.y),$e.texPrimary.x+$e.texPrimary.w,$e.texPrimary.y+$e.texPrimary.h,vt,dt,Ut,Pt,St,yn),v+=4}let ut=R.numIconVertices-4*et.length;for(let Ge=0;Ge<ut;++Ge)this.icon.updateIconVertexData(v+Ge,0,0,0,0,0,0,0,0,0,0,0,0);g=!0}else v+=R.numIconVertices}else if(k.usesAppearanceIconAsPlaceholder)this.layers[0].appearances&&this.layers[0].appearances.length>0&&(this.icon.updateIconVertexData(v,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(v+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(v+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(v+3,0,0,0,0,0,0,0,0,0,0,0,0),g=!0),v+=R.numIconVertices,k.activeAppearance=null;else if(k.isUsingAppearanceVertexData){let se=k.layoutBasedVertexData.length/12;for(let _e=0;_e<se;++_e){let fe=_e*12;this.icon.updateIconVertexData(v+_e,k.layoutBasedVertexData[fe+0],k.layoutBasedVertexData[fe+1],k.layoutBasedVertexData[fe+2],k.layoutBasedVertexData[fe+3],k.layoutBasedVertexData[fe+4],k.layoutBasedVertexData[fe+5],k.layoutBasedVertexData[fe+6],k.layoutBasedVertexData[fe+7],k.layoutBasedVertexData[fe+8],k.layoutBasedVertexData[fe+9],k.layoutBasedVertexData[fe+10],k.layoutBasedVertexData[fe+11])}v+=se,k.isUsingAppearanceVertexData=!1,k.activeAppearance=null,g=!0}else v+=R.numIconVertices,k.activeAppearance=null}}return g}update(e,s,u,d,m,g,v){this.text.programConfigurations.updatePaintArrays(e,s,m,u,d,g,v,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,s,m,u,d,g,v,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let s=!1,u=xe(e),d=1/u,m=!1,g=!1;for(let v=0;v<this.symbolInstances.length;v++){let b=this.symbolInstances.get(v),w=Fi(1,0,0),S=Fi(0,1,0),{numHorizontalGlyphVertices:D,numVerticalGlyphVertices:I,numIconVertices:R,numVerticalIconVertices:k}=b,B=D>0||I>0,U=R>0,G=this.elevationFeatures[b.elevationFeatureIndex];if(G){let J=new ct(b.tileAnchorX,b.tileAnchorY),ee=.075+G.pointElevation(J);b.zOffset!==ee&&(s=!0,b.zOffset=ee),ee!==0&&(this.hasAnyZOffset=!0);let se=G.computeSlopeNormal(J,d),_e=zu(Ns(),Fi(0,0,1),se);ua(w,w,_e),ua(S,S,_e),w[2]*=u,S[2]*=u,w[0]===1&&w[1]===0&&w[2]===0&&S[0]===0&&S[1]===1&&S[2]===0||(m=m||B,g=g||U)}if(B&&(Yw(this.text.orientationVertexArray,D,w,S),Yw(this.text.orientationVertexArray,I,w,S)),U){let{placedIconSymbolIndex:J,verticalPlacedIconSymbolIndex:ee}=b;J>=0&&Yw(this.icon.orientationVertexArray,R,w,S),ee>=0&&Yw(this.icon.orientationVertexArray,k,w,S)}}m||(this.text.orientationVertexArray=void 0),g||(this.icon.orientationVertexArray=void 0),s&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){let e=(m,g,v)=>{u+=g,u>m.length&&m.resize(u);for(let b=-g;b<0;b++)m.emplace(b+u,v)},s=(m,g,v)=>{d+=g,d>m.length&&m.resize(d);for(let b=-g;b<0;b++)m.emplace(b+d,v)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let u=0,d=0;for(let m=0;m<this.symbolInstances.length;m++){let g=this.symbolInstances.get(m),{numHorizontalGlyphVertices:v,numVerticalGlyphVertices:b,numIconVertices:w}=g,S=g.zOffset,D=w>0;if((v>0||b>0)&&(e(this.text.zOffsetVertexArray,v,S),e(this.text.zOffsetVertexArray,b,S)),D){let{placedIconSymbolIndex:I,verticalPlacedIconSymbolIndex:R}=g;I>=0&&s(this.icon.zOffsetVertexArray,w,S),R>=0&&s(this.icon.zOffsetVertexArray,g.numVerticalIconVertices,S)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e,s,u,d,m){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,!1),this.hasAppearances===null&&(this.hasAppearances=this.layers.some(g=>g.appearances&&g.appearances.length>0)),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(e,s,u,d){return!!(e&&s&&u)&&!(!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)&&!!this.icon.layoutVertexArray.arrayBuffer&&void(this.updateAppearanceBasedIconTextures(e,s,u,d)&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray))}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=rN(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,s){let u=this.lineVertexArray.length;if(e.segment!==void 0)for(let{x:d,y:m}of s)this.lineVertexArray.emplaceBack(d,m);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(e,s,u,d,m,g,v,b,w,S,D,I,R,k,B,U,G,J){let ee=e.indexArray,se=e.layoutVertexArray,_e=e.globeExtVertexArray,fe=e.segments.prepareSegment(4*J,se,ee,this.canOverlap?g.sortKey:void 0),we=this.glyphOffsetArray.length,Ee=fe.vertexLength,Se=this.allowVerticalPlacement&&v===sl.vertical?Math.PI/2:0,We=g.text&&g.text.sections;for(let Qe=0;Qe<s.length;Qe++){let{tl:rt,tr:vt,bl:dt,br:et,texPrimary:ut,texSecondary:Ge,pixelOffsetTL:$e,pixelOffsetBR:lt,minFontScaleX:gt,minFontScaleY:it,glyphOffset:Nt,isSDF:Ut,sectionIndex:Pt}=s[Qe],St=fe.vertexLength,yn=Nt[1];if(ox(se,w.x,w.y,rt.x,yn+rt.y,ut.x,ut.y,u,Ut,$e.x,$e.y,gt,it),ox(se,w.x,w.y,vt.x,yn+vt.y,ut.x+ut.w,ut.y,u,Ut,lt.x,$e.y,gt,it),ox(se,w.x,w.y,dt.x,yn+dt.y,ut.x,ut.y+ut.h,u,Ut,$e.x,lt.y,gt,it),ox(se,w.x,w.y,et.x,yn+et.y,ut.x+ut.w,ut.y+ut.h,u,Ut,lt.x,lt.y,gt,it),b){let{x:It,y:rn,z:xn}=b.anchor,[Nn,ri,wn]=b.up;ax(_e,It,rn,xn,Nn,ri,wn),ax(_e,It,rn,xn,Nn,ri,wn),ax(_e,It,rn,xn,Nn,ri,wn),ax(_e,It,rn,xn,Nn,ri,wn),j_(e.dynamicLayoutVertexArray,It,rn,xn,Se)}else j_(e.dynamicLayoutVertexArray,w.x,w.y,w.z,Se);if(U){let It=Ge||ut;sx(e.iconTransitioningVertexArray,It.x,It.y),sx(e.iconTransitioningVertexArray,It.x+It.w,It.y),sx(e.iconTransitioningVertexArray,It.x,It.y+It.h),sx(e.iconTransitioningVertexArray,It.x+It.w,It.y+It.h)}ee.emplaceBack(St,St+1,St+2),ee.emplaceBack(St+1,St+2,St+3),fe.vertexLength+=4,fe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Nt[0]),Qe!==s.length-1&&Pt===s[Qe+1].sectionIndex||e.programConfigurations.populatePaintArrays(se.length,g,g.index,{},R,k,B,We&&We[Pt],this.worldview)}let Fe=J-s.length;Fe!==0&&this._addNullVertices(Fe,se,u,b,_e,e,U,fe,ee);let Ze=b?b.anchor:w;e.placedSymbolArray.emplaceBack(Ze.x,Ze.y,Ze.z,w.x,w.y,we,this.glyphOffsetArray.length-we,Ee,S,D,w.segment,u?u[0]:0,u?u[1]:0,d[0],d[1],v,0,0,0,I,0),e.symbolInstanceIndices.push(G)}_addNullVertices(e,s,u,d,m,g,v,b,w){for(let S=0;S<e;S++){for(let I=0;I<4;I++)ox(s,0,0,0,0,0,0,u,!1,0,0,0,0),d&&ax(m,0,0,0,0,0,0),j_(g.dynamicLayoutVertexArray,0,0,0,0),v&&sx(g.iconTransitioningVertexArray,0,0);let D=b.vertexLength;w.emplaceBack(D,D+1,D+2),w.emplaceBack(D+1,D+2,D+3),b.vertexLength+=4,b.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(e,s,u,d,m,g,v){e.emplaceBack(s,u,d,m,g,Math.round(v.x),Math.round(v.y))}_addCollisionDebugVertices(e,s,u,d,m,g,v){let b=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),w=b.vertexLength,S=v.tileAnchorX,D=v.tileAnchorY;for(let R=0;R<4;R++)u.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(u.collisionVertexArrayExt,s,e.padding,v.zOffset),this._commitLayoutVertex(u.layoutVertexArray,d,m,g,S,D,new ct(e.x1,e.y1)),this._commitLayoutVertex(u.layoutVertexArray,d,m,g,S,D,new ct(e.x2,e.y1)),this._commitLayoutVertex(u.layoutVertexArray,d,m,g,S,D,new ct(e.x2,e.y2)),this._commitLayoutVertex(u.layoutVertexArray,d,m,g,S,D,new ct(e.x1,e.y2)),b.vertexLength+=4;let I=u.indexArray;I.emplaceBack(w,w+1),I.emplaceBack(w+1,w+2),I.emplaceBack(w+2,w+3),I.emplaceBack(w+3,w),b.primitiveLength+=4}_addTextDebugCollisionBoxes(e,s,u,d,m,g){for(let v=d;v<m;v++){let b=u.get(v),w=this.getSymbolInstanceTextSize(e,g,s,v);this._addCollisionDebugVertices(b,w,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(e,s,u,d,m,g){for(let v=d;v<m;v++){let b=u.get(v),w=this.getSymbolInstanceIconSize(e,s,g.placedIconSymbolIndex);this._addCollisionDebugVertices(b,w,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,g)}}generateCollisionDebugBuffers(e,s,u){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new QI(m_,bL.members,Sl),this.iconCollisionBox=new QI(m_,bL.members,Sl);let d=L_(this.iconSizeData,e),m=L_(this.textSizeData,e,u);for(let g=0;g<this.symbolInstances.length;g++){let v=this.symbolInstances.get(g);this._addTextDebugCollisionBoxes(m,e,s,v.textBoxStartIndex,v.textBoxEndIndex,v),this._addTextDebugCollisionBoxes(m,e,s,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._addIconDebugCollisionBoxes(d,e,s,v.iconBoxStartIndex,v.iconBoxEndIndex,v),this._addIconDebugCollisionBoxes(d,e,s,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v)}}getSymbolInstanceTextSize(e,s,u,d){let m=this.text.placedSymbolArray.get(s.rightJustifiedTextSymbolIndex>=0?s.rightJustifiedTextSymbolIndex:s.centerJustifiedTextSymbolIndex>=0?s.centerJustifiedTextSymbolIndex:s.leftJustifiedTextSymbolIndex>=0?s.leftJustifiedTextSymbolIndex:s.verticalPlacedTextSymbolIndex>=0?s.verticalPlacedTextSymbolIndex:d),g=$I(this.textSizeData,e,m)/Yo;return this.tilePixelRatio*g}getSymbolInstanceIconSize(e,s,u){let d=this.icon.placedSymbolArray.get(u),m=$I(this.iconSizeData,e,d);return this.tilePixelRatio*m}_commitDebugCollisionVertexUpdate(e,s,u,d){e.emplaceBack(s,-u,-u,d),e.emplaceBack(s,u,-u,d),e.emplaceBack(s,u,u,d),e.emplaceBack(s,-u,u,d)}_updateTextDebugCollisionBoxes(e,s,u,d,m,g,v){for(let b=d;b<m;b++){let w=u.get(b),S=this.getSymbolInstanceTextSize(e,g,s,b);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,S,w.padding,g.zOffset)}}_updateIconDebugCollisionBoxes(e,s,u,d,m,g,v){for(let b=d;b<m;b++){let w=u.get(b),S=this.getSymbolInstanceIconSize(e,s,g.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,S,w.padding,g.zOffset)}}updateCollisionDebugBuffers(e,s,u,d){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let m=L_(this.iconSizeData,e,d),g=L_(this.textSizeData,e,u);for(let v=0;v<this.symbolInstances.length;v++){let b=this.symbolInstances.get(v);this._updateTextDebugCollisionBoxes(g,e,s,b.textBoxStartIndex,b.textBoxEndIndex,b,u),this._updateTextDebugCollisionBoxes(g,e,s,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b,u),this._updateIconDebugCollisionBoxes(m,e,s,b.iconBoxStartIndex,b.iconBoxEndIndex,b,d),this._updateIconDebugCollisionBoxes(m,e,s,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b,d)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,s,u,d,m,g,v,b,w){let S={};if(s<u){let{x1:D,y1:I,x2:R,y2:k,padding:B,projectedAnchorX:U,projectedAnchorY:G,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:se,featureIndex:_e}=e.get(s);S.textBox={x1:D,y1:I,x2:R,y2:k,padding:B,projectedAnchorX:U,projectedAnchorY:G,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:se},S.textFeatureIndex=_e}if(d<m){let{x1:D,y1:I,x2:R,y2:k,padding:B,projectedAnchorX:U,projectedAnchorY:G,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:se,featureIndex:_e}=e.get(d);S.verticalTextBox={x1:D,y1:I,x2:R,y2:k,padding:B,projectedAnchorX:U,projectedAnchorY:G,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:se},S.verticalTextFeatureIndex=_e}if(g<v){let{x1:D,y1:I,x2:R,y2:k,padding:B,projectedAnchorX:U,projectedAnchorY:G,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:se,featureIndex:_e}=e.get(g);S.iconBox={x1:D,y1:I,x2:R,y2:k,padding:B,projectedAnchorX:U,projectedAnchorY:G,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:se},S.iconFeatureIndex=_e}if(b<w){let{x1:D,y1:I,x2:R,y2:k,padding:B,projectedAnchorX:U,projectedAnchorY:G,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:se,featureIndex:_e}=e.get(b);S.verticalIconBox={x1:D,y1:I,x2:R,y2:k,padding:B,projectedAnchorX:U,projectedAnchorY:G,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:se},S.verticalIconFeatureIndex=_e}return S}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){let u=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,s){let u=e.placedSymbolArray.get(s),d=u.vertexStartIndex+4*u.numGlyphs;for(let m=u.vertexStartIndex;m<d;m+=4)e.indexArray.emplaceBack(m,m+1,m+2),e.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let s=Math.sin(e),u=Math.cos(e),d=[],m=[],g=[];for(let v=0;v<this.symbolInstances.length;++v){g.push(v);let b=this.symbolInstances.get(v);d.push(0|Math.round(s*b.tileAnchorX+u*b.tileAnchorY)),m.push(b.featureIndex)}return g.sort((v,b)=>d[v]-d[b]||m[b]-m[v]),g}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,s)=>this.symbolInstances.get(s).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,s){let u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===s?u.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let s of this.symbolInstanceIndexes){let u=this.symbolInstances.get(s);this.featureSortOrder.push(u.featureIndex);let{rightJustifiedTextSymbolIndex:d,centerJustifiedTextSymbolIndex:m,leftJustifiedTextSymbolIndex:g,verticalPlacedTextSymbolIndex:v,placedIconSymbolIndex:b,verticalPlacedIconSymbolIndex:w}=u;d>=0&&this.addIndicesForPlacedSymbol(this.text,d),m>=0&&m!==d&&this.addIndicesForPlacedSymbol(this.text,m),g>=0&&g!==m&&g!==d&&this.addIndicesForPlacedSymbol(this.text,g),v>=0&&this.addIndicesForPlacedSymbol(this.text,v),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(e){let s=this.symbolInstances.get(this.text.symbolInstanceIndices[e]).elevationFeatureIndex,u;return this.elevationFeatures&&s<this.elevationFeatures.length&&(u=this.elevationFeatures[s]),u}}function oN(a,e){return e.replace(/{([^{}]+)}/g,(s,u)=>u in a?String(a[u]):"")}let sN,aN,e2;Bt(Kw,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),Kw.addDynamicAttributes=j_;class lN{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Hu,this.defaultValue=e}evaluate(e){if(e.formattedSection){let s=this.defaultValue.property.overrides;if(s&&s.hasOverride(e.formattedSection))return s.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Bt(lN,"FormatSectionOverride",{omit:["defaultValue"]});let t2=()=>e2||(e2={layout:sN||(sN=new Rr({"symbol-placement":new pt(ke.layout_symbol["symbol-placement"]),"symbol-spacing":new pt(ke.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new pt(ke.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Mt(ke.layout_symbol["symbol-sort-key"]),"symbol-z-order":new pt(ke.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new pt(ke.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new pt(ke.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new pt(ke.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new pt(ke.layout_symbol["icon-ignore-placement"]),"icon-optional":new pt(ke.layout_symbol["icon-optional"]),"icon-rotation-alignment":new pt(ke.layout_symbol["icon-rotation-alignment"]),"icon-size":new Mt(ke.layout_symbol["icon-size"]),"icon-size-scale-range":new pt(ke.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Mt(ke.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Mt(ke.layout_symbol["icon-text-fit-padding"]),"icon-image":new Mt(ke.layout_symbol["icon-image"]),"icon-image-use-theme":new pt({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new Mt(ke.layout_symbol["icon-rotate"]),"icon-padding":new pt(ke.layout_symbol["icon-padding"]),"icon-keep-upright":new pt(ke.layout_symbol["icon-keep-upright"]),"icon-offset":new Mt(ke.layout_symbol["icon-offset"]),"icon-anchor":new Mt(ke.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new pt(ke.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new pt(ke.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new pt(ke.layout_symbol["text-rotation-alignment"]),"text-field":new Mt(ke.layout_symbol["text-field"]),"text-font":new Mt(ke.layout_symbol["text-font"]),"text-size":new Mt(ke.layout_symbol["text-size"]),"text-size-scale-range":new pt(ke.layout_symbol["text-size-scale-range"]),"text-max-width":new Mt(ke.layout_symbol["text-max-width"]),"text-line-height":new Mt(ke.layout_symbol["text-line-height"]),"text-letter-spacing":new Mt(ke.layout_symbol["text-letter-spacing"]),"text-justify":new Mt(ke.layout_symbol["text-justify"]),"text-radial-offset":new Mt(ke.layout_symbol["text-radial-offset"]),"text-variable-anchor":new pt(ke.layout_symbol["text-variable-anchor"]),"text-anchor":new Mt(ke.layout_symbol["text-anchor"]),"text-max-angle":new pt(ke.layout_symbol["text-max-angle"]),"text-writing-mode":new pt(ke.layout_symbol["text-writing-mode"]),"text-rotate":new Mt(ke.layout_symbol["text-rotate"]),"text-padding":new pt(ke.layout_symbol["text-padding"]),"text-keep-upright":new pt(ke.layout_symbol["text-keep-upright"]),"text-transform":new Mt(ke.layout_symbol["text-transform"]),"text-offset":new Mt(ke.layout_symbol["text-offset"]),"text-allow-overlap":new pt(ke.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new pt(ke.layout_symbol["text-ignore-placement"]),"text-optional":new pt(ke.layout_symbol["text-optional"]),visibility:new pt(ke.layout_symbol.visibility)})),paint:aN||(aN=new Rr({"icon-opacity":new Mt(ke.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Mt(ke.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Mt(ke.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Mt(ke.paint_symbol["text-emissive-strength"]),"icon-color":new Mt(ke.paint_symbol["icon-color"]),"icon-halo-color":new Mt(ke.paint_symbol["icon-halo-color"]),"icon-halo-width":new Mt(ke.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Mt(ke.paint_symbol["icon-halo-blur"]),"icon-translate":new pt(ke.paint_symbol["icon-translate"]),"icon-translate-anchor":new pt(ke.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new pt(ke.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Mt(ke.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Mt(ke.paint_symbol["text-occlusion-opacity"]),"text-color":new Mt(ke.paint_symbol["text-color"],{runtimeType:Ys,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new Mt(ke.paint_symbol["text-halo-color"]),"text-halo-width":new Mt(ke.paint_symbol["text-halo-width"]),"text-halo-blur":new Mt(ke.paint_symbol["text-halo-blur"]),"text-translate":new pt(ke.paint_symbol["text-translate"]),"text-translate-anchor":new pt(ke.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new pt(ke.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new pt(ke.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new pt(ke.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new pt(ke.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Mt(ke.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"})}))},e2);class Jw extends Vs{constructor(e,s,u,d){super(e,t2(),s,u,d,e.layout?e.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=Be([]),this.hasOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}_handleSpecialPaintPropertyUpdate(e){e!=="icon-occlusion-opacity"&&e!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(e,s){super.recalculate(e,s),this.appearances&&this.appearances.forEach(d=>{d.recalculate(e,s,this.iconImageUseTheme)}),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let u=this.layout.get("text-writing-mode");if(u){let d=[];for(let m of u)d.indexOf(m)<0&&d.push(m);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,s,u,d){return this._saturation===e&&this._contrast===s&&this._brightnessMin===u&&this._brightnessMax===d||(this._colorAdjustmentMatrix=(function(m,g,v,b){m=vr(m),g=er(g);let w=ze(),S=m/3,D=1-2*S,I=[D,S,S,0,S,D,S,0,S,S,D,0,0,0,0,1],R=.5-.5*g,k=b-v;return ot(w,[k,0,0,0,0,k,0,0,0,0,k,0,v,v,v,1],[g,0,0,0,0,g,0,0,0,0,g,0,R,R,R,1]),ot(w,w,I),w})(e,s,u,d),this._saturation=e,this._contrast=s,this._brightnessMin=u,this._brightnessMax=d),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,s,u,d){let m=this.layout.get(e).evaluate(s,{},u,d),g=this._unevaluatedLayout._values[e];return g.isDataDriven()||n_(g.value)||!m?m:oN(s.properties,m)}getAppearanceValueAndResolveTokens(e,s,u,d,m){let g=e.getProperty(s);if(!g)return;let v=g.evaluate(u,{},d,m),b=e.getUnevaluatedProperties()._values[s];return b.isDataDriven()||n_(b.value)||!v||typeof v!="string"?v:oN(u.properties,v)}createBucket(e){return new Kw(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let e of t2().paint.overridableProperties){if(!Jw.hasPaintOverride(this.layout,e))continue;let s=this.paint.get(e),u=new lN(s),d=new t_(u,s.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme")),m=null;m=s.value.kind==="constant"||s.value.kind==="source"?new cm("source",d):new rd("composite",d,s.value.zoomStops,s.value.interpolationType),this.paint._values[e]=new Tl(s.property,m,s.parameters)}}_handleOverridablePaintPropertyUpdate(e,s,u){return!(!this.layout||s.isDataDriven()||u.isDataDriven())&&Jw.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,s){let u=e.get("text-field"),d=t2().paint.properties[s],m=!1,g=v=>{for(let b of v)if(d.overrides&&d.overrides.hasOverride(b))return void(m=!0)};if(u.value.kind==="constant"&&u.value.value instanceof xo)g(u.value.value.sections);else if(u.value.kind==="source"){let v=w=>{m||(w instanceof Gl&&$r(w.value)===Zc?g(w.value.sections):w instanceof _c?g(w.sections):w.eachChild(v))},b=u.value;b._styleExpression&&v(b._styleExpression.expression)}return m}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,s,u){return{config:new su(this,{zoom:s,lut:u}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let cN,uN,dN,hN;var n2=Bn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function Qw(a,e,s,u,d,m,g,v){let b=[a,e,1,s,u,1,d,m,1],w=[g,v,1],S=le([],b),[D,I,R]=qa(w,w,S);return te(b,b,[D,0,0,0,I,0,0,0,R])}function fN(a,e,s,u,d,m,g,v){let b=(function(w,S,D,I,R,k,B,U){let G=Qw(0,0,1,0,1,1,0,1),J=Qw(w,S,D,I,R,k,B,U);return te(J,J,le([],G))})(a,e,s,u,d,m,g,v);return[b[2]/b[8]/yt,b[5]/b[8]/yt]}function eC(a){return[a[0],Math.min(Math.max(a[1],-ce),ce)]}class pN extends ma{constructor(e,s,u,d){super(),this.id=e,this.dispatcher=u,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(d),this.options=s,this._dirty=!1}load(e,s){if(this._loaded=s||!1,this.fire(new pa("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Hp(this.map._requestManager.transformRequest(this.url,$c.Image),(u,d)=>{this._imageRequest=null,this._loaded=!0,u?this.fire(new Ma(u)):d&&(this.image=d instanceof HTMLImageElement?Zs.getImageData(d):d,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Gy(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new pa("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Gy||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let s=e[0][1],u=e[0][1];for(let m of e)m[1]>u&&(u=m[1]),m[1]<s&&(s=m[1]);let d=(u+s)/2;if(d>ce?this.onNorthPole=!0:d<-ce&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){let m=e.map(Re.fromLngLat);this.tileID=(function(g){let v=1/0,b=1/0,w=-1/0,S=-1/0;for(let B of g)v=Math.min(v,B.x),b=Math.min(b,B.y),w=Math.max(w,B.x),S=Math.max(S,B.y);let D=Math.max(w-v,S-b),I=Math.max(0,Math.floor(-Math.log2(D))),R=Math.pow(2,I),k=Math.floor((v+w)/2*R);return k>1&&(k-=1),new il(I,k,Math.floor((b+S)/2*R))})(m),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new pa("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof Gy||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(let G in this.tiles){let J=this.tiles[G];J.state!=="loaded"&&(J.state="loaded",J.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;let s=ex(new il(0,0,0),this.map.transform.projection),u=[s.projection.project(this.coordinates[0][0],this.coordinates[0][1]),s.projection.project(this.coordinates[1][0],this.coordinates[1][1]),s.projection.project(this.coordinates[2][0],this.coordinates[2][1]),s.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!(function(G){let J=G[1].x-G[0].x,ee=G[1].y-G[0].y,se=G[2].x-G[1].x,_e=G[2].y-G[1].y,fe=G[3].x-G[2].x,we=G[3].y-G[2].y,Ee=G[0].x-G[3].x,Se=G[0].y-G[3].y,We=J*_e-se*ee,Fe=se*we-fe*_e,Ze=fe*Se-Ee*we,Qe=Ee*ee-J*Se;return We>0&&Fe>0&&Ze>0&&Qe>0||We<0&&Fe<0&&Ze<0&&Qe<0})(u))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);let d=ex(this.tileID,this.map.transform.projection),[m,g,v,b]=this.coordinates.map(G=>{let J=d.projection.project(G[0],G[1]);return QL(d,J)._round()});this.perspectiveTransform=fN(m.x,m.y,g.x,g.y,v.x,v.y,b.x,b.y);let w=this._boundsArray=new Lf;w.emplaceBack(m.x,m.y,0,0),w.emplaceBack(g.x,g.y,yt,0),w.emplaceBack(b.x,b.y,0,yt),w.emplaceBack(v.x,v.y,yt,yt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(w,n2.members),this.boundsSegments=wr.simpleSegment(0,0,4,2);let S=[],D=[eC((I=this.coordinates)[0]),eC(I[1]),eC(I[2]),eC(I[3])];var I;let[R,k,B,U]=(function(G){let J=G[0][0],ee=J,se=G[0][1],_e=se;for(let fe=1;fe<G.length;fe++)G[fe][0]<J?J=G[fe][0]:G[fe][0]>ee&&(ee=G[fe][0]),G[fe][1]<se?se=G[fe][1]:G[fe][1]>_e&&(_e=G[fe][1]);return[J,se,ee-J,_e-se]})(D);{let G=new Lf,[J,ee,se,_e]=(function(et){let ut=et[0].x,Ge=ut,$e=et[0].y,lt=$e;for(let gt=1;gt<et.length;gt++)et[gt].x<ut?ut=et[gt].x:et[gt].x>Ge&&(Ge=et[gt].x),et[gt].y<$e?$e=et[gt].y:et[gt].y>lt&&(lt=et[gt].y);return[ut,$e,Ge-ut,lt-$e]})(u),fe=et=>[(et.x-J)/se,(et.y-ee)/_e],[we,Ee,Se,We]=u.map(fe),Fe=(function(et,ut,Ge,$e,lt,gt,it,Nt){let Ut=Qw(0,0,1,0,1,1,0,1);return te(Ut,Ut,le([],Qw(et,ut,Ge,$e,lt,gt,it,Nt)))})(we[0],we[1],Ee[0],Ee[1],Se[0],Se[1],We[0],We[1]);this.elevatedGlobePerspectiveTransform=fN(we[0],we[1],Ee[0],Ee[1],Se[0],Se[1],We[0],We[1]);let Ze=(et,ut)=>{S.push(et.lng);let Ge=Math.round((et.lng-R)/B*yt),$e=Math.round((et.lat-k)/U*yt),lt=fe(ut),gt=qa([],[lt[0],lt[1],1],Fe),it=Math.round(gt[0]/gt[2]*yt),Nt=Math.round(gt[1]/gt[2]*yt);G.emplaceBack(Ge,$e,it,Nt)},Qe=u[3].x-u[0].x,rt=u[3].y-u[0].y,vt=u[2].x-u[1].x,dt=u[2].y-u[1].y;for(let et=0;et<65;et++){let ut=et/64,Ge=[u[0].x+ut*Qe,u[0].y+ut*rt],$e=[u[1].x+ut*vt,u[1].y+ut*dt],lt=$e[0]-Ge[0],gt=$e[1]-Ge[1];for(let it=0;it<65;it++){let Nt=it/64,Ut={x:Ge[0]+lt*Nt,y:Ge[1]+gt*Nt};Ze(s.projection.unproject(Ut.x,Ut.y),Ut)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(G,n2.members)}{this.maxLongitudeTriangleSize=0;let G=[],J=new mr,ee=(se,_e,fe)=>{J.emplaceBack(se,_e,fe);let we=S[se],Ee=S[_e],Se=S[fe],We=Math.min(Math.min(we,Ee),Se),Fe=Math.max(Math.max(we,Ee),Se)-We;Fe>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Fe),G.push(We+Fe/2)};for(let se=0;se<64;se++)for(let _e=0;_e<64;_e++){let fe=65*se+_e,we=fe+1,Ee=fe+65,Se=Ee+1;ee(fe,Ee,we),ee(we,Ee,Se)}[G,J]=(function(se,_e){let fe=Array.from({length:se.length},(Se,We)=>We);fe.sort((Se,We)=>se[Se]-se[We]);let we=[],Ee=new mr;for(let Se=0;Se<fe.length;Se++){let We=fe[Se];we.push(se[We]);let Fe=3*We,Ze=Fe+1;Ee.emplaceBack(_e.uint16[Fe],_e.uint16[Ze],_e.uint16[Ze+1])}return[we,Ee]})(G,J),this.elevatedGlobeTrianglesCenterLongitudes=G,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(J)}this.elevatedGlobeSegments=wr.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,B/yt,0,U/yt,0,0,k,R,0])}prepare(){let e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;let s=this.map.painter.context,u=s.gl;!this._dirty||this.texture instanceof Gy||(this.texture?this.texture.update(this.image):(this.texture=new II(s,this.image,u.RGBA8),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(s)}loadTile(e,s){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},s(null)):(e.state="errored",s(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){let s=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!s)return null;let u=this.elevatedGlobeTrianglesCenterLongitudes,d=(m=e+180)+360*Math.round((u[0]-m)/360);var m;let g=new wr,v=(D,I)=>{g.segments.push({vertexOffset:0,primitiveOffset:D,vertexLength:s.segments[0].vertexLength,primitiveLength:I,sortKey:void 0,vaos:{}})},b=.51*this.maxLongitudeTriangleSize;if(Math.abs(u[0]-d)<=b){let D=Zn(u,0,u.length,d+b);return D===u.length||v(D,bi(u,D+1,u.length,d+360-b)-D),g}d<u[0]&&(d+=360);let w=bi(u,0,u.length,d-b);if(w===u.length)return v(0,u.length),g;v(0,w-0);let S=Zn(u,w+1,u.length,d+b);return S!==u.length&&v(S,u.length-S),g}}let f7=(Math.pow(256,2)-1)/16907520;class mN extends Vs{constructor(e,s,u,d){super(e,{layout:dN||(dN=new Rr({visibility:new pt(ke.layout_raster.visibility)})),paint:hN||(hN=new Rr({"raster-opacity":new pt(ke.paint_raster["raster-opacity"]),"raster-color":new Pf(ke.paint_raster["raster-color"]),"raster-color-mix":new pt(ke.paint_raster["raster-color-mix"]),"raster-color-range":new pt(ke.paint_raster["raster-color-range"]),"raster-hue-rotate":new pt(ke.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new pt(ke.paint_raster["raster-brightness-min"]),"raster-brightness-max":new pt(ke.paint_raster["raster-brightness-max"]),"raster-saturation":new pt(ke.paint_raster["raster-saturation"]),"raster-contrast":new pt(ke.paint_raster["raster-contrast"]),"raster-resampling":new pt(ke.paint_raster["raster-resampling"]),"raster-fade-duration":new pt(ke.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new pt(ke.paint_raster["raster-emissive-strength"]),"raster-array-band":new pt(ke.paint_raster["raster-array-band"]),"raster-elevation":new pt(ke.paint_raster["raster-elevation"]),"raster-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"})}))},s,u,d),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof pN&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;let s=this._transitionablePaint._values["raster-color"].value.expression,[u,d]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(u)&&isNaN(d)||u===this._curRampRange[0]&&d===this._curRampRange[1]||(this.colorRamp=Ay({expression:s,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:u,end:d}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[u,d])}}let gN,_N,vN,yN,xN;class bN extends Vs{constructor(e,s,u,d){super(e,{layout:gN||(gN=new Rr({visibility:new pt(ke["layout_raster-particle"].visibility)})),paint:_N||(_N=new Rr({"raster-particle-array-band":new pt(ke["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new pt(ke["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Pf(ke["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new pt(ke["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new pt(ke["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new pt(ke["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new pt(ke["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new pt(ke["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"})}))},s,u,d),this._updateColorRamp(),this.lastInvalidatedAt=Zs.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;let e=this._transitionablePaint._values["raster-particle-color"].value.expression,s=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Ay({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:s}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Zs.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class p7 extends Vs{constructor(e,s){super(e,{},s,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function i2(a,e,s){let u=[0,0,1],d=vs([]);return vo(d,d,s?-Wn(a)+Math.PI:Wn(a)),Zr(d,d,-Wn(e)),ua(u,u,d),Li(u,u)}let wN={None:0,Model:1,Symbol:2,FillExtrusion:4};class tC{constructor(e,s,u,d){this.message=(e?`${e}: `:"")+u,d&&(this.identifier=d),s!=null&&s.__line__&&(this.line=s.__line__)}}function r2(a,e){let s=a.indexOf("://")===-1;try{return new URL(a,s&&e?"http://example.com":void 0),!0}catch{return!1}}class CN{constructor(e,s){this.feature=e,this.instancedDataOffset=s,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class EN{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new __,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(e){let s=16*e,u=this.instancedDataArray.float32,d=Math.floor(u[s+2]),m=1.05*(u[s+2]-d);return d/=100,[u[s]%1*1.05,u[s+1]%1*1.05,m,d]}tileCoordinatesForInstance(e){let s=16*e,u=this.instancedDataArray.float32,d=u[s+0];return d=d>yt?d-yt:d,new ct(Math.trunc(d),Math.trunc(u[s+1]))}translationForInstance(e){let s=16*e,u=this.instancedDataArray.float32;return[u[s+4],u[s+5],u[s+6]]}rotationScaleForInstance(e){let s=16*e,u=this.instancedDataArray.float32;return[u[s+7],u[s+8],u[s+9],u[s+10],u[s+11],u[s+12],u[s+13],u[s+14],u[s+15]]}transformForInstance(e){let s=16*e,u=this.instancedDataArray.float32;return[u[s+7],u[s+8],u[s+9],u[s+4],u[s+10],u[s+11],u[s+12],u[s+5],u[s+13],u[s+14],u[s+15],u[s+6],0,0,0,1]}}class o2{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaledZ=this.canonical.z+Math.log2(e.overscaling),this.layers=e.layers,this.layerIds=this.layers.map(s=>s.fqid),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(e,s){}updateAppearances(e,s,u,d){}populate(e,s,u,d){this.tileToMeter=xe(u);let m=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(let{feature:g,id:v,index:b,sourceLayerIndex:w}of e){let S=v??(g.properties&&g.properties.hasOwnProperty("id")?g.properties.id:void 0),D=Ue(g,m);if(!this.layers[0]._featureFilter.filter(new or(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),D,u))continue;let I={id:S,sourceLayerIndex:w,index:b,geometry:m?D.geometry:Je(g,u,d),properties:g.properties,type:g.type,patterns:{}},R=this.addFeature(I,I.geometry,D);R&&s.featureIndex.insert(g,I.geometry,b,w,this.index,this.instancesPerModel[R].instancedDataArray.length,yt/32)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){let e=this.layers[0].modelManager,s=this.layers[0].scope,u=0;for(let d of this.modelUris){let m=e.getModel(d,s);if(!m)continue;let g=this.instancesPerModel[d];if(g){let v=.5*Nu(m.aabb.max,m.aabb.min)*g.maxScale+g.maxXYTranslationDistance,b=Math.min(yt,Math.max(v/this.tileToMeter,yt/32));u=Math.max(b,u)}}return u}update(e,s,u,d){for(let m in this.instancesPerModel){let g=this.instancesPerModel[m];for(let v in e)g.idToFeaturesIndex.hasOwnProperty(v)&&(this.evaluate(g.features[g.idToFeaturesIndex[v]],e[v],g,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(let s in this.instancesPerModel){let u=this.instancesPerModel[s];for(let d of u.features){let m=this.layers[0],g=d.feature,v=this.canonical,b=m.paint.get("model-rotation").evaluate(g,{},v),w=m.paint.get("model-scale").evaluate(g,{},v),S=m.paint.get("model-translation").evaluate(g,{},v);Wo(d.rotation,b)&&Wo(d.scale,w)&&Wo(d.translation,S)||(this.evaluate(d,d.featureStates,u,!0),e=!0)}}return e}updateReplacement(e,s,u,d){if(s.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=s.updateTime;let m=s.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(Ew(this.activeReplacements,m))return!1;this.activeReplacements=m;let g=!1;for(let v in this.instancesPerModel){let b=this.instancesPerModel[v],w=b.instancedDataArray;for(let S of b.features){let D=S.instancedDataOffset,I=S.instancedDataCount;for(let R=0;R<I;R++){let k=16*(R+D),B=w.float32[k+0],U=B>yt;B=U?B-yt:B;let G=Math.floor(B),J=Math.floor(w.float32[k+1]),ee=!1;for(let se of this.activeReplacements)if(!cF(se,u,wN.Model,d)&&!(se.min.x>G||G>se.max.x||se.min.y>J||J>se.max.y)&&(ee=gI(fF(G,J,e.canonical,se.footprintTileId.canonical),se.footprint),ee))break;w.float32[k]=ee?B+yt:B,g=g||ee!==U}}}return g}isEmpty(){for(let e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(let s in this.instancesPerModel){let u=this.instancesPerModel[s];u.instancedDataArray.length<0||u.instancedDataArray.length===0||(u.instancedDataBuffer?u.instancedDataBuffer.updateData(u.instancedDataArray):u.instancedDataBuffer=e.createVertexBuffer(u.instancedDataArray,VG.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(let s in this.instancesPerModel){let u=this.instancesPerModel[s];u.instancedDataArray.length!==0&&u.instancedDataBuffer&&u.instancedDataBuffer.destroy()}let e=this.layers[0].modelManager;if(e&&this.modelUris&&this.modelsRequested)for(let s of this.modelUris)e.removeModel(s,"",!0)}addFeature(e,s,u){let d=this.layers[0],m=d.layout.get("model-id").evaluate(u,{},this.canonical);if(!m)return Gt(`modelId is not evaluated for layer ${d.id} and it is not going to get rendered.`),m;(r2(m,!1)||this.styleDefinedModelURLs[m]!==void 0)&&(this.modelUris.includes(m)||this.modelUris.push(m)),this.instancesPerModel[m]||(this.instancesPerModel[m]=new EN);let g=this.instancesPerModel[m],v=g.instancedDataArray,b=new CN(u,v.length);for(let w of s)for(let S of w){if(S.x<0||S.x>=yt||S.y<0||S.y>=yt)continue;if(this.lookupDim!==0){let I=(this.lookupDim-1)/yt,R=this.lookupDim*(S.y*I|0)+S.x*I|0;if(this.lookup){if(this.lookup[R]!==0)continue;this.lookup[R]=1}}this.instanceCount++;let D=v.length;v.resize(D+1),g.instancesEvaluatedElevation.push(0),v.float32[16*D]=S.x,v.float32[16*D+1]=S.y}return b.instancedDataCount=g.instancedDataArray.length-b.instancedDataOffset,b.instancedDataCount>0&&(e.id&&(g.idToFeaturesIndex[e.id]=g.features.length),g.features.push(b),this.evaluate(b,{},g,!1)),m}getModelUris(){return this.modelUris}evaluate(e,s,u,d){let m=this.layers[0],g=e.feature,v=this.canonical,b=e.rotation=m.paint.get("model-rotation").evaluate(g,s,v),w=e.scale=m.paint.get("model-scale").evaluate(g,s,v),S=e.translation=m.paint.get("model-translation").evaluate(g,s,v),D=Object.assign({},m.paint.get("model-color").evaluate(g,s,v));D.a=m.paint.get("model-color-mix-intensity").evaluate(g,s,v);let I=[];this.maxVerticalOffset<S[2]&&(this.maxVerticalOffset=S[2]);let R=S[0]*S[0]+S[1]*S[1],k=R>0?Math.sqrt(R):0;u.maxScale=Math.max(Math.max(u.maxScale,w[0]),Math.max(w[1],w[2])),u.maxXYTranslationDistance=Math.max(u.maxXYTranslationDistance,k),this.maxScale=Math.max(Math.max(this.maxScale,w[0]),Math.max(w[1],w[2])),QF(I,b,w);let B=Math.round(100*D.a)+D.b/1.05;for(let U=0;U<e.instancedDataCount;++U){let G=e.instancedDataOffset+U,J=16*G,ee=u.instancedDataArray.float32,se=0;d&&(se=ee[J+6]-u.instancesEvaluatedElevation[G]);let _e=0|ee[J+1];ee[J]=(0|ee[J])+D.r/1.05,ee[J+1]=_e+D.g/1.05,ee[J+2]=B,ee[J+3]=1/(v.z>10?this.tileToMeter:xe(v,_e)),ee[J+4]=S[0],ee[J+5]=S[1],ee[J+6]=S[2]+se,ee[J+7]=I[0],ee[J+8]=I[1],ee[J+9]=I[2],ee[J+10]=I[4],ee[J+11]=I[5],ee[J+12]=I[6],ee[J+13]=I[8],ee[J+14]=I[9],ee[J+15]=I[10],u.instancesEvaluatedElevation[G]=S[2]}}}let TN,SN;Bt(o2,"ModelBucket",{omit:["layers"]}),Bt(EN,"PerModelAttributes"),Bt(CN,"ModelFeature");class V_{constructor(e,s,u){this._demTile=e,this._dem=this._demTile.dem,this._scale=s,this._offset=u}static create(e,s,u){let d=u||e.findDEMTileFor(s);if(!d||!d.dem)return;let m=d.dem,g=d.tileID,v=1<<s.canonical.z-g.canonical.z;return new V_(d,m.dim/yt/v,[(s.canonical.x/v-g.canonical.x)*m.dim,(s.canonical.y/v-g.canonical.y)*m.dim])}tileCoordToPixel(e,s){let u=s*this._scale+this._offset[1];return new ct(Math.floor(e*this._scale+this._offset[0]),Math.floor(u))}getElevationAt(e,s,u,d){let m=e*this._scale+this._offset[0],g=s*this._scale+this._offset[1],v=Math.floor(m),b=Math.floor(g),w=this._dem;return d=!!d,u?ln(ln(w.get(v,b,d),w.get(v,b+1,d),g-b),ln(w.get(v+1,b,d),w.get(v+1,b+1,d),g-b),m-v):w.get(v,b,d)}getElevationAtPixel(e,s,u){return this._dem.get(e,s,!!u)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Q(1,e)*this._dem.stride}}let s2=new Float32Array(262144),Sm=new Uint8Array(262144);function DN(a){let e=0;if(a.meshes)for(let s of a.meshes)e=Math.max(e,s.aabb.max[2]);if(a.children)for(let s of a.children)e=Math.max(e,DN(s));return e}function IN(a,e,s){if(a.meshes)for(let u of a.meshes){if(u.aabb.min[0]===1/0)continue;let d=kn.applyTransform(u.aabb,a.globalMatrix);s.insert(e,d.min[0],d.min[1],d.max[0],d.max[1])}if(a.children)for(let u of a.children)IN(u,e,s)}let MN=["","wall","door","roof","window","lamp","logo"];class AN{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:DN(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new kn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0,s=new kn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(let u of this.node.meshes)this.node.lightMeshIndex!==e&&(u.transformedAabb=kn.applyTransformFast(u.aabb,this.node.globalMatrix),s.encapsulate(u.transformedAabb)),e++;this.aabb=s}return this.aabb}}class nC{constructor(e,s,u,d,m,g,v,b){this.id=u,this.layers=e,this.layerIds=this.layers.map(w=>w.fqid),this.stateDependentLayerIds=this.layers.filter(w=>w.isStateDependent()).map(w=>w.id),this.modelTraits|=O_.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,d&&(this.modelTraits|=O_.HasMapboxMeshFeatures),m&&(this.modelTraits|=O_.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=g,this.worldview=b,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(let w of s)this.nodesInfo.push(new AN(w)),IN(w,v.featureIndexArray.length,v.grid),v.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,v.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(e,s){for(let u of this.getNodesInfo()){let d=u.node;d.footprint&&s.push({footprint:d.footprint,id:e})}}updateAppearances(e,s,u,d){}update(e){let s=Object.keys(e).length!==0;if(s&&!this.stateDependentLayers.length)return;let u=s?this.stateDependentLayers:this.layers;if(!Vl(e,this.states))for(let d of u)this.evaluate(d,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;let s=this.getNodesInfo();for(let u of s){let d=u.node;this.uploaded?this.updatePbrBuffer(d):PI(d,e,!0)}for(let u of s)Nw(u.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let s=!1;if(!e.meshes)return s;for(let u of e.meshes)u.pbrBuffer&&(u.pbrBuffer.updateData(u.featureArray),s=!0);return s}needsReEvaluation(e,s,u){let d=e.transform.projectionOptions,m=e.style.getBrightness(),g=this.brightness!==m;if(!this.uploaded||this.dirty||d.name!==this.projection.name||lx(u.paint.get("model-color").value,g)||lx(u.paint.get("model-color-mix-intensity").value,g)||lx(u.paint.get("model-roughness").value,g)||lx(u.paint.get("model-emissive-strength").value,g)||lx(u.paint.get("model-height-based-emissive-strength-multiplier").value,g)){this.projection=d,this.brightness=m;let v=this.getNodesInfo();for(let b of v)b.state=null;return!0}return!1}evaluateTransform(e,s){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;let u=this.getNodesInfo(),d=this.id.canonical;for(let m of u){let g=m.feature;m.evaluatedTranslation=s.paint.get("model-translation").evaluate(g,{},d),m.evaluatedScale=s.paint.get("model-scale").evaluate(g,{},d)}}evaluate(e,s){let u=this.getNodesInfo();for(let d of u){if(!d.node.meshes)continue;let m=d.feature,g=s&&s[m.id];if(Vl(g,d.state))continue;d.state=structuredClone(g);let v=d.node.meshes&&d.node.meshes[0].featureData,b=d.evaluatedColor[2],w=d.evaluatedRMEA[2],S=this.id.canonical;if(d.hasTranslucentParts=!1,v){for(let D=0;D<MN.length;D++){let I=MN[D];I.length&&(m.properties.part=I);let R=e.paint.get("model-color").evaluate(m,g,S).toPremultipliedRenderColor(null),k=e.paint.get("model-color-mix-intensity").evaluate(m,g,S);d.evaluatedColor[D]=[R.r,R.g,R.b,k],d.evaluatedRMEA[D][0]=e.paint.get("model-roughness").evaluate(m,g,S),d.evaluatedRMEA[D][2]=e.paint.get("model-emissive-strength").evaluate(m,g,S),d.evaluatedRMEA[D][3]=R.a,d.emissionHeightBasedParams[D]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(m,g,S),!d.hasTranslucentParts&&R.a<1&&(d.hasTranslucentParts=!0)}delete m.properties.part,g7(d,b!==d.evaluatedColor[2]||w!==d.evaluatedRMEA[2],this.modelTraits)}else d.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(m,g,S);d.evaluatedTranslation=e.paint.get("model-translation").evaluate(m,g,S),d.evaluatedScale=e.paint.get("model-scale").evaluate(m,g,S),this.updatePbrBuffer(d.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,s,u,d){let m=e.findDEMTileFor(u);if(m&&(m.tileID.canonical!==this.terrainTile||s!==this.terrainExaggeration)){if(m.dem&&m.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=m.tileID.overscaledZ;let g=V_.create(e,u,m);if(!g)return;this.modelTraits&O_.HasMapboxMeshFeatures&&this.updateDEM(e,g,u,d);for(let v of this.getNodesInfo()){let b=v.node;if(!b.footprint||!b.footprint.vertices||!b.footprint.vertices.length)continue;let w=b.footprint.vertices,S=g.getElevationAt(w[0].x,w[0].y,!0,!0);for(let D=1;D<w.length;D++)S=Math.min(S,g.getElevationAt(w[D].x,w[D].y,!0,!0));b.elevation=S}}this.terrainTile=m.tileID.canonical,this.terrainExaggeration=s}}updateDEM(e,s,u,d){let m=s._dem._modifiedForSources[d];if(m===void 0&&(s._dem._modifiedForSources[d]=[],m=s._dem._modifiedForSources[d]),m.includes(u.canonical))return;let g=s._dem.dim;m.push(u.canonical);let v=!1;for(let b of this.getNodesInfo()){let w=b.node;if(!w.footprint||!w.footprint.grid)continue;let S=w.footprint.grid,D=s.tileCoordToPixel(S.min.x,S.min.y),I=s.tileCoordToPixel(S.max.x,S.max.y),R=Math.min(Math.min(g-I.y,D.x),Math.min(D.y,g-I.x));if(R<0)continue;let k=X(R,2,5),B=Math.max(0,D.x-k),U=Math.max(0,D.y-k),G=Math.min(I.x+k,g-1),J=Math.min(I.y+k,g-1);for(let fe=U;fe<=J;++fe)for(let we=B;we<=G;++we)Sm[fe*g+we]=255;let ee=0,se=0;for(let fe=0;fe<S.cellsY;++fe)for(let we=0;we<S.cellsX;++we){if(!S.cells[fe*S.cellsX+we])continue;let Ee=s.tileCoordToPixel(S.min.x+we/S.xScale,S.min.y+fe/S.yScale),Se=s.tileCoordToPixel(S.min.x+(we+1)/S.xScale,S.min.y+(fe+1)/S.yScale);for(let We=Ee.y;We<=Math.min(Se.y+1,g-1);++We)for(let Fe=Ee.x;Fe<=Math.min(Se.x+1,g-1);++Fe)Sm[We*g+Fe]===255&&(Sm[We*g+Fe]=0,ee+=s.getElevationAtPixel(Fe,We),se++)}let _e=ee/se;B=Math.max(1,D.x-k),U=Math.max(1,D.y-k),G=Math.min(I.x+k,g-2),J=Math.min(I.y+k,g-2),v=!0;for(let fe=U;fe<=J;++fe)for(let we=B;we<=G;++we)Sm[fe*g+we]===0&&(s2[fe*g+we]=s._dem.set(we,fe,_e));for(let fe=1;fe<k;++fe){B=Math.max(1,D.x-fe),U=Math.max(1,D.y-fe),G=Math.min(I.x+fe,g-2),J=Math.min(I.y+fe,g-2);for(let we=U;we<=J;++we)for(let Ee=B;Ee<=G;++Ee){let Se=we*g+Ee;if(Sm[Se]===255){let We=0,Fe=0,Ze=-1,Qe=-1;for(let rt=-1;rt<=1;++rt)for(let vt=-1;vt<=1;++vt){let dt=(we+rt)*g+Ee+vt;if(Sm[dt]>=fe)continue;let et=s2[dt],ut=Math.abs(et);ut>Fe&&(We=et,Fe=ut,Ze=vt,Qe=rt)}if(Fe>.1){let rt=1-(fe+.5*Math.abs(Ze*Qe))/k,vt=s._dem.get(Ee,we)+We*rt,dt=s._dem.get(Ee+Ze,we+Qe),et=s._dem.get(Ee-Ze,we-Qe,!0);(vt-dt)*(vt-et)>0&&(vt=(dt+et)/2),s2[Se]=s._dem.set(Ee,we,vt),Sm[Se]=fe}}}}}v&&(s._demTile.needsDEMTextureUpload=!0,s._dem._timestamp=Zs.now())}setFilter(e){this.filter=e?l_(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new or(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical)):this.nodesInfo}destroy(){let e=this.getNodesInfo();for(let s of e)Nw(s.node),OI(s.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,s){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;let u=s.getReplacementRegionsForTile(e.toUnwrapped());for(let d of this.getNodesInfo()){let m=d.node.footprint;d.hiddenByReplacement=!!m&&!u.find(g=>g.footprint===m)}}getHeightAtTileCoord(e,s){let u=[],d=[0,0,0],m=Be([]);for(let g of this.getNodesInfo()){let v=g.node.meshes[0],b=v.transformedAabb;if(e<b.min[0]||s<b.min[1]||e>b.max[0]||s>b.max[1])continue;if(g.node.hidden===!0)return{height:1/0,maxHeight:g.feature.properties.height,hidden:!1,verticalScale:g.evaluatedScale[2]};Tt(m,g.node.globalMatrix),d[0]=e,d[1]=s,pr(d,d,m);let w=(d[0]-v.aabb.min[0])/(v.aabb.max[0]-v.aabb.min[0])*Cm|0,S=Math.min(63,(d[1]-v.aabb.min[1])/(v.aabb.max[1]-v.aabb.min[1])*Cm|0)*Cm+Math.min(63,w),D=v.heightmap[S];if(!(D<0&&g.node.footprint))return g.hiddenByReplacement?void 0:{height:D,maxHeight:g.feature.properties.height,hidden:!1,verticalScale:g.evaluatedScale[2]};if(g.node.footprint.grid.query(new ct(e,s),new ct(e,s),u),u.length>0)return{height:void 0,maxHeight:g.feature.properties.height,hidden:g.hiddenByReplacement,verticalScale:g.evaluatedScale[2]}}}}function lx(a,e){return a instanceof cm&&!a.isLightConstant&&e}function m7(a,e,s,u,d,m,g,v){let b=(61440&e|(61440&e)>>4)>>8,w=(3840&e|(3840&e)>>4)>>4,S=240&e|(240&e)>>4;s[3]>0&&(b=ln(b,255*s[0],s[3]),w=ln(w,255*s[1],s[3]),S=ln(S,255*s[2],s[3]));let D=b<<8|w,I=S<<8|Math.floor(255*u[3]),R=(function(fe){let we=X(fe,0,2);return Math.min(Math.round(.5*we*255),255)})(u[2])<<8|15*u[0]<<4|15*u[1],k=X(d[0],0,1),B=X(d[1],0,1),U=X(d[2],0,1),G=X(d[3],0,1),J,ee,se,_e;if(k!==B&&g!==m&&B!==k){let fe=g-m;ee=1/(fe*(B-k)),se=-(m+fe*k)/(fe*(B-k));let we=X(d[4],-1,1);_e=Math.pow(10,we),J=255*U<<8|255*G}else J=65535,ee=0,se=1,_e=1;if(a.emplaceBack(D,I,R,J,ee,se,_e),v){let fe=v.length;v.clear();for(let we=0;we<fe;we++)v.emplaceBack(D,I,R,J,ee,se,_e)}}function g7(a,e,s){let u=a.node,d=0,m=s&O_.HasMeshoptCompression;for(let g of u.meshes){if(u.lights&&u.lightMeshIndex===d||!g.featureData)continue;g.featureArray=new Vf,g.featureArray.reserve(g.featureData.length);let v=e;for(let b of g.featureData){let w=m?65535&b:b>>16&65535,S=m?b>>16&65535:65535&b,D=(15&S)<8?15&S:0,I=a.evaluatedRMEA[D],R=a.evaluatedColor[D],k=a.emissionHeightBasedParams[D],B;if(v&&D===2&&u.lights&&(B=new Vf,B.resize(10*u.lights.length)),m7(g.featureArray,w,R,I,k,g.aabb.min[2],g.aabb.max[2],B),B&&v){v=!1;let U=u.meshes[u.lightMeshIndex];U.featureArray=B,U.featureArray._trim()}}g.featureArray._trim(),d++}}Bt(nC,"Tiled3dModelBucket",{omit:["layers"]}),Bt(AN,"Tiled3dModelFeature");let _7=["id","tile","layer","source","sourceLayer","state"];class Dm{constructor(e,s,u,d,m){this.type="Feature",this._vectorTileFeature=e,this._z=s,this._x=u,this._y=d,this.properties=e?e.properties:{},this.id=m}clone(){let e=new Dm(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){let e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(let s of _7)this[s]!==void 0&&(e[s]=this[s]);return e}}class Im extends ma{constructor(e,s,u,d){super(),this.id=e,this.type="model",this.models=[],this._loaded=!1,this._options=s,this._modelsInfo=new Map}load(){let e=[];for(let s in this._options.models){let u=this._options.models[s],d=this._modelsInfo.get(s);if(d){let m=d.model;m.position=u.position!=null?new F(u.position[0],u.position[1]):new F(0,0),m.orientation=u.orientation!=null?u.orientation:[0,0,0],d.modelSpec=u,Im.applyModelSpecification(m,u),m.computeBoundsAndApplyParent(),this.models.push(m)}else{let m=XF(this.map._requestManager.transformRequest(u.uri,$c.Model).url).then(g=>{if(!g)return;let v=kI(g),b=new eL(s,u.uri,u.position,u.orientation,v);Im.applyModelSpecification(b,u),b.computeBoundsAndApplyParent(),this.models.push(b),this._modelsInfo.set(s,{modelSpec:u,model:b})}).catch(g=>{this.fire(new Ma(new Error(`Could not load model ${s} from ${u.uri}: ${g.message}`)))});e.push(m)}}Promise.allSettled(e).then(()=>{this._loaded=!0,this.fire(new pa("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(s=>{this._loaded=!0,this.fire(new Ma(new Error(`Could not load models: ${s.message}`)))})}static applyModelSpecification(e,s){s.nodeOverrides&&Im.convertNodeOverrides(e,s.nodeOverrides),s.materialOverrides&&Im.convertMaterialOverrides(e,s.materialOverrides),s.nodeOverrideNames&&(e.nodeOverrideNames=[...s.nodeOverrideNames]),s.materialOverrideNames&&(e.materialOverrideNames=[...s.materialOverrideNames]),s.featureProperties&&(e.featureProperties=s.featureProperties)}static convertNodeOverrides(e,s){if(Array.isArray(s)&&s.every(u=>typeof u=="string")){e.nodeOverrideNames=[];for(let u of s)e.nodeOverrideNames.push(u)}else Object.entries(s).forEach(([u,d])=>{let m={orientation:[0,0,0]};if(d.hasOwnProperty("orientation")){let g=d.orientation;g&&(m.orientation=g)}e.nodeOverrides.set(u,m)})}static convertMaterialOverrides(e,s){if(Array.isArray(s)&&s.every(u=>typeof u=="string")){e.materialOverrideNames=[];for(let u of s)e.materialOverrideNames.push(u)}else Object.entries(s).forEach(([u,d])=>{let m={color:new Qn(1,1,1),colorMix:0,emissionStrength:0,opacity:1},g=d["model-color"];g!==void 0&&(m.color.r=g[0],m.color.g=g[1],m.color.b=g[2]);let v=d["model-color-mix-intensity"];v!==void 0&&(m.colorMix=v);let b=d["model-emissive-strength"];b!==void 0&&(m.emissionStrength=b);let w=d["model-opacity"];w!==void 0&&(m.opacity=w),e.materialOverrides.set(u,m)})}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(e,s){}serialize(){return this._options}setProperty(e,s){return!1}reload(){let e=yh(this.id,this.scope);this.map.style.clearSource(e),this.models=[],this._modelsInfo.clear(),this._loaded=!1,this.load()}setModels(e){this.models=[];let s=new Map;for(let u in e){let d=e[u];if(this._modelsInfo.has(u)){let m=this._modelsInfo.get(u);m&&m.modelSpec.uri===d.uri&&s.set(u,m)}}this._modelsInfo=s,this._options.models=e,this._loaded=!1,this.load()}}function a2(a,e,s,u){let d=1<<a.z;e.lat=re((u/yt+a.y)/d),e.lng=ae((s/yt+a.x)/d)}function v7(a,e,s,u){let d=a.getNodesInfo()[e];if(!d||d.hiddenByReplacement||!d.node.meshes)return;let m=Number.MAX_VALUE,g=d.node,v=s.tile,b=u.calculatePosMatrix(v.tileID.toUnwrapped(),u.worldSize),w=d.evaluatedScale,S=0;u.elevation&&g.elevation&&(S=g.elevation*u.elevation.exaggeration()),kt(b,b,[(g.anchor?g.anchor[0]:0)*(w[0]-1),(g.anchor?g.anchor[1]:0)*(w[1]-1),S]),Cn(b,b,w);let D=s.queryGeometry,I=D.isPointQuery()?D.screenBounds:D.screenGeometry,R=function(B){let U=ot([],b,B.globalMatrix);ot(U,u.expandedFarZProjMatrix,U);for(let G=0;G<B.meshes.length;++G){let J=B.meshes[G];if(G===B.lightMeshIndex)continue;let ee=AI(I,u,U,J.aabb);ee!=null&&(m=Math.min(ee,m))}if(B.children)for(let G of B.children)R(G)};if(R(g),m===Number.MAX_VALUE)return;let k=new F(0,0);return a2(v.tileID.canonical,k,d.node.anchor[0],d.node.anchor[1]),{intersectionZ:m,position:k,feature:d.feature}}let y7={circle:class extends Vs{constructor(a,e,s,u){super(a,{layout:au||(au=new Rr({"circle-sort-key":new Mt(ke.layout_circle["circle-sort-key"]),"circle-elevation-reference":new pt(ke.layout_circle["circle-elevation-reference"]),visibility:new pt(ke.layout_circle.visibility)})),paint:$f||($f=new Rr({"circle-radius":new Mt(ke.paint_circle["circle-radius"]),"circle-color":new Mt(ke.paint_circle["circle-color"]),"circle-blur":new Mt(ke.paint_circle["circle-blur"]),"circle-opacity":new Mt(ke.paint_circle["circle-opacity"]),"circle-translate":new pt(ke.paint_circle["circle-translate"]),"circle-translate-anchor":new pt(ke.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new pt(ke.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new pt(ke.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Mt(ke.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Mt(ke.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Mt(ke.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new pt(ke.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"})}))},e,s,u)}createBucket(a){return new yr(a)}queryRadius(a){let e=a;return Vo("circle-radius",this,e)+Vo("circle-stroke-width",this,e)+Dr(this.paint.get("circle-translate"))}queryIntersectsFeature(a,e,s,u,d,m,g,v){let b=Hf(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,a.pixelToTileUnitsFactor),w=this.paint.get("circle-radius").evaluate(e,s)+this.paint.get("circle-stroke-width").evaluate(e,s);return Lk(a,u,m,g,v,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",b,w)}getProgramIds(){return["circle"]}getDefaultProgramParams(a,e,s){let u=Fk(this);return{config:new su(this,{zoom:e,lut:s}),defines:u,overrideFog:!1}}is3D(a){return!a&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends Vs{createBucket(a){return new zk(a)}constructor(a,e,s,u){super(a,{layout:Bk||(Bk=new Rr({visibility:new pt(ke.layout_heatmap.visibility)})),paint:jk||(jk=new Rr({"heatmap-radius":new Mt(ke.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Mt(ke.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new pt(ke.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Pf(ke.paint_heatmap["heatmap-color"]),"heatmap-opacity":new pt(ke.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"})}))},e,s,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ay({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(a){return Vo("heatmap-radius",this,a)}queryIntersectsFeature(a,e,s,u,d,m,g,v){let b=this.paint.get("heatmap-radius").evaluate(e,s);return Lk(a,u,m,g,v,!0,!0,new ct(0,0),b)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(a,e,s){return a==="heatmap"?{config:new su(this,{zoom:e,lut:s}),overrideFog:!1}:{}}},hillshade:class extends Vs{constructor(a,e,s,u){super(a,{layout:Vk||(Vk=new Rr({visibility:new pt(ke.layout_hillshade.visibility)})),paint:Uk||(Uk=new Rr({"hillshade-illumination-direction":new pt(ke.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new pt(ke.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new pt(ke.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new pt(ke.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new pt(ke.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new pt(ke.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new pt(ke.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"})}))},e,s,u)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(a,e,s){return{overrideFog:!1}}},fill:class extends Vs{constructor(a,e,s,u){super(a,{layout:iF||(iF=new Rr({"fill-sort-key":new Mt(ke.layout_fill["fill-sort-key"]),visibility:new pt(ke.layout_fill.visibility),"fill-elevation-reference":new pt(ke.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Mt(ke.layout_fill["fill-construct-bridge-guard-rail"])})),paint:rF||(rF=new Rr({"fill-antialias":new pt(ke.paint_fill["fill-antialias"]),"fill-opacity":new Mt(ke.paint_fill["fill-opacity"]),"fill-color":new Mt(ke.paint_fill["fill-color"]),"fill-outline-color":new Mt(ke.paint_fill["fill-outline-color"]),"fill-translate":new pt(ke.paint_fill["fill-translate"]),"fill-translate-anchor":new pt(ke.paint_fill["fill-translate-anchor"]),"fill-pattern":new Mt(ke.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new pt(ke.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new pt(ke.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Mt(ke.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Mt(ke.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Mt(ke.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"})}))},e,s,u)}getProgramIds(){let a=this.paint.get("fill-pattern"),e=a&&a.constantOr(1),s=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&s.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),s}getDefaultProgramParams(a,e,s){return{config:new su(this,{zoom:e,lut:s}),overrideFog:!1}}recalculate(a,e){super.recalculate(a,e);let s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new fI(a)}queryRadius(){return Dr(this.paint.get("fill-translate"))}queryIntersectsFeature(a,e,s,u,d,m){return!a.queryGeometry.isAboveHorizon&&kr(nl(a.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,a.pixelToTileUnitsFactor),u)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(a){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;let e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return a!=null?e&&!a:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends Vs{constructor(a,e,s,u){super(a,{layout:MF||(MF=new Rr({visibility:new pt(ke["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new pt(ke["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:AF||(AF=new Rr({"fill-extrusion-opacity":new pt(ke["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Mt(ke["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new pt(ke["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new pt(ke["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Mt(ke["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new pt(ke["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Mt(ke["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Mt(ke["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new pt(ke["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new pt(ke["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new pt(ke["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new pt(ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new pt(ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new pt(ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new pt(ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new pt(ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new pt(ke["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new pt(ke["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Mt(ke["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Mt(ke["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new pt(ke["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new pt(ke["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new pt(ke["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new pt(ke["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Mt(ke["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Mt(ke["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new pt(ke["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"})}))},e,s,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new Sw(a)}queryRadius(){return Dr(this.paint.get("fill-extrusion-translate"))}is3D(a){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(a,e,s,u,d,m,g,v,b){let w=Hf(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,a.pixelToTileUnitsFactor),S=this.paint.get("fill-extrusion-height").evaluate(e,s),D=this.paint.get("fill-extrusion-base").evaluate(e,s),I=[0,0],R=v&&m.elevation,k=m.elevation?m.elevation.exaggeration():1,B=a.tile.getBucket(this);if(R&&B instanceof Sw){let se=B.centroidVertexArray,_e=b+1;_e<se.length&&(I[0]=se.geta_centroid_pos0(_e),I[1]=se.geta_centroid_pos1(_e))}if(I[0]===0&&I[1]===1)return!1;m.projection.name==="globe"&&(u=IF([u],[new ct(0,0),new ct(yt,yt)],a.tileID.canonical).map(se=>se.polygon).flat());let U=R?v:null,[G,J]=NF(m,u,D,S,w,g,U,I,k,m.center.lat,a.tileID.canonical),ee=a.queryGeometry;return LF(G,J,ee.isPointQuery()?ee.screenBounds:ee.screenGeometry)}},building:class extends Vs{constructor(a,e,s,u){super(a,{layout:lL||(lL=new Rr({visibility:new pt(ke.layout_building.visibility),"building-facade":new Mt(ke.layout_building["building-facade"]),"building-facade-floors":new Mt(ke.layout_building["building-facade-floors"]),"building-facade-unit-width":new Mt(ke.layout_building["building-facade-unit-width"]),"building-facade-window":new Mt(ke.layout_building["building-facade-window"]),"building-roof-shape":new Mt(ke.layout_building["building-roof-shape"]),"building-height":new Mt(ke.layout_building["building-height"]),"building-base":new Mt(ke.layout_building["building-base"]),"building-flood-light-wall-radius":new Mt(ke.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new Mt(ke.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new Mt(ke.layout_building["building-flip-roof-orientation"])})),paint:cL||(cL=new Rr({"building-opacity":new pt(ke.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new pt(ke.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new pt(ke.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new pt(ke.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new pt(ke.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new pt(ke.paint_building["building-vertical-scale"]),"building-cast-shadows":new pt(ke.paint_building["building-cast-shadows"]),"building-color":new Mt(ke.paint_building["building-color"]),"building-emissive-strength":new Mt(ke.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new pt(ke.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new pt(ke.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new pt(ke.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new pt(ke.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new pt(ke.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"})}))},e,s,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new aL(a)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(a){return!0}queryRadius(a){return 0}queryIntersectsFeature(a,e,s,u,d,m,g,v,b){let w=this.layout.get("building-height").evaluate(e,s),S=this.layout.get("building-base").evaluate(e,s),D=a.tile.getBucket(this).getFootprint(e);if(D){if(D.hiddenFlags!==0)return!1;w=D.height}let[I,R]=NF(m,u,S,w,new ct(0,0),g,null,[0,0],1,m.center.lat,a.tileID.canonical),k=a.queryGeometry;return LF(I,R,k.isPointQuery()?k.screenBounds:k.screenGeometry)}},line:class extends Vs{constructor(a,e,s,u){let d=yL();super(a,d,e,s,u),d.layout&&(this.layout=new vh(d.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(a){if(a==="line-gradient"){let e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof im,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(a,e){super.recalculate(a,e),this.paint._values["line-floorwidth"]=(()=>{if(Wy)return Wy;let s=yL();return Wy=new mq(s.paint.properties["line-width"].specification),Wy.useIntegerZoom=!0,Wy})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new LI(a)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(a,e,s){let u=_L(this);return{config:new su(this,{zoom:e,lut:s}),defines:u,overrideFog:!1}}queryRadius(a){let e=a,s=xL(Vo("line-width",this,e),Vo("line-gap-width",this,e)),u=Vo("line-offset",this,e);return s/2+Math.abs(u)+Dr(this.paint.get("line-translate"))}queryIntersectsFeature(a,e,s,u,d,m){if(a.queryGeometry.isAboveHorizon)return!1;let g=nl(a.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,a.pixelToTileUnitsFactor),v=a.pixelToTileUnitsFactor/2*xL(this.paint.get("line-width").evaluate(e,s),this.paint.get("line-gap-width").evaluate(e,s)),b=this.paint.get("line-offset").evaluate(e,s);return b&&(u=(function(w,S){let D=[],I=new ct(0,0);for(let R=0;R<w.length;R++){let k=w[R],B=[];for(let U=0;U<k.length;U++){let G=k[U],J=k[U+1],ee=U===0?I:G.sub(k[U-1])._unit()._perp(),se=U===k.length-1?I:J.sub(G)._unit()._perp(),_e=ee._add(se)._unit();_e._mult(1/(_e.x*se.x+_e.y*se.y)),B.push(_e._mult(S)._add(G))}D.push(B)}return D})(u,b*a.pixelToTileUnitsFactor)),(function(w,S,D){for(let I=0;I<S.length;I++){let R=S[I];if(w.length>=3){for(let k=0;k<R.length;k++)if(jo(w,R[k]))return!0}if(ya(w,R,D))return!0}return!1})(g,u,v)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(a){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:Jw,background:class extends Vs{constructor(a,e,s,u){super(a,{layout:cN||(cN=new Rr({visibility:new pt(ke.layout_background.visibility)})),paint:uN||(uN=new Rr({"background-pitch-alignment":new pt(ke.paint_background["background-pitch-alignment"]),"background-color":new pt(ke.paint_background["background-color"]),"background-pattern":new pt(ke.paint_background["background-pattern"]),"background-opacity":new pt(ke.paint_background["background-opacity"]),"background-emissive-strength":new pt(ke.paint_background["background-emissive-strength"]),"background-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"})}))},e,s,u)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(a,e,s){return{overrideFog:!1}}is3D(a){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:mN,"raster-particle":bN,sky:class extends Vs{constructor(a,e,s,u){super(a,{layout:vN||(vN=new Rr({visibility:new pt(ke.layout_sky.visibility)})),paint:yN||(yN=new Rr({"sky-type":new pt(ke.paint_sky["sky-type"]),"sky-atmosphere-sun":new pt(ke.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new pt(ke.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new pt(ke.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new pt(ke.paint_sky["sky-gradient-radius"]),"sky-gradient":new Pf(ke.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new pt(ke.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new pt(ke.paint_sky["sky-atmosphere-color"]),"sky-opacity":new pt(ke.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"})}))},e,s,u),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(a){a==="sky-gradient"?this._updateColorRamp():a!=="sky-atmosphere-sun"&&a!=="sky-atmosphere-halo-color"&&a!=="sky-atmosphere-color"&&a!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Ay({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(a){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let e=a.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(a,e){if(this.paint.get("sky-type")==="atmosphere"){let u=this.paint.get("sky-atmosphere-sun"),d=!u,m=a.style.light,g=m.properties.get("position");return d&&m.properties.get("anchor")==="viewport"&&Gt("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),d?i2(g.azimuthal,90-g.polar,e):i2(u[0],90-u[1],e)}let s=this.paint.get("sky-gradient-center");return i2(s[0],90-s[1],e)}isSky(){return!0}markSkyboxValid(a){this._skyboxInvalidated=!1,this._lightPosition=a.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let a=this.paint.get("sky-type");return a==="atmosphere"?["skyboxCapture","skybox"]:a==="gradient"?["skyboxGradient"]:null}},slot:class extends Vs{constructor(a,e,s,u){super(a,{paint:xN||(xN=new Rr({}))},e,null)}},model:class extends Vs{constructor(a,e,s,u){super(a,{layout:TN||(TN=new Rr({visibility:new pt(ke.layout_model.visibility),"model-id":new Mt(ke.layout_model["model-id"])})),paint:SN||(SN=new Rr({"model-opacity":new Mt(ke.paint_model["model-opacity"]),"model-rotation":new Mt(ke.paint_model["model-rotation"]),"model-scale":new Mt(ke.paint_model["model-scale"]),"model-translation":new Mt(ke.paint_model["model-translation"]),"model-color":new Mt(ke.paint_model["model-color"]),"model-color-mix-intensity":new Mt(ke.paint_model["model-color-mix-intensity"]),"model-type":new pt(ke.paint_model["model-type"]),"model-cast-shadows":new pt(ke.paint_model["model-cast-shadows"]),"model-receive-shadows":new pt(ke.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new pt(ke.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Mt(ke.paint_model["model-emissive-strength"]),"model-roughness":new Mt(ke.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Mt(ke.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new pt(ke.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new pt(ke.paint_model["model-front-cutoff"]),"model-elevation-reference":new pt(ke.paint_model["model-elevation-reference"]),"model-color-use-theme":new Mt({type:"string",default:"default","property-type":"data-driven"})}))},e,s,u),this.layer=a,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new o2(a)}getProgramIds(){return["model"]}is3D(a){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(a){return a instanceof nC?yt-1:0}queryRenderedFeatures(a,e,s){let u=e.getSource();if(!(u&&u instanceof Im))return{};let d=u,m={};m[this.id]=[];let g=m[this.id],v=0;for(let b of d.models){let w=e.getFeatureState(this.sourceLayer,b.id),S={type:"Unknown",id:b.id,properties:b.featureProperties},D=this.paint.get("model-rotation").evaluate(S,w),I=this.paint.get("model-scale").evaluate(S,w),R=this.paint.get("model-translation").evaluate(S,w),k=this.paint.get("model-elevation-reference"),B=[];Lw(B,b,s,b.position,D,I,R,k==="ground",k==="ground",!1),s.projection.name==="globe"&&(B=Fw(B,s));let U=ot([],s.projMatrix,B),G=AI(a.isPointQuery()?a.screenBounds:a.screenGeometry,s,U,b.aabb);if(G!=null){let J=new Dm(void 0,0,0,0,b.id);J.layer=this.layer,J.properties=structuredClone(b.featureProperties),J.properties.layer=this.id,J.properties.uri=b.uri,J.properties.orientation=b.orientation,J.sourceLayer=this.sourceLayer,J.geometry={type:"Point",coordinates:[b.position.lng,b.position.lat]},J.state=w,J.source=this.source,g.push({featureIndex:v,feature:J,intersectionZ:G})}++v}return m}queryIntersectsFeature(a,e,s,u,d,m){if(!this.modelManager)return!1;let g=this.modelManager,v=a.tile.getBucket(this);if(!(v&&v instanceof o2))return!1;for(let b in v.instancesPerModel){let w=v.instancesPerModel[b],S=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(w.idToFeaturesIndex.hasOwnProperty(S)){let D=w.features[w.idToFeaturesIndex[S]],I=g.getModel(b,this.scope);if(!I)return!1;let R=[],k=new F(0,0),B=v.canonical,U=Number.MAX_VALUE;for(let G=0;G<D.instancedDataCount;++G){let J=16*(D.instancedDataOffset+G),ee=w.instancedDataArray.float32,se=[ee[J+4],ee[J+5],ee[J+6]];a2(B,k,Math.floor(ee[J]),Math.floor(ee[J+1])),Lw(R,I,m,k,D.rotation,D.scale,se,!1,!1,!1),m.projection.name==="globe"&&(R=Fw(R,m));let _e=ot([],m.projMatrix,R),fe=a.queryGeometry,we=AI(fe.isPointQuery()?fe.screenBounds:fe.screenGeometry,m,_e,I.aabb);we!=null&&(U=Math.min(we,U))}return U!==Number.MAX_VALUE&&U}}return!1}_handleOverridablePaintPropertyUpdate(a,e,s){return!(!this.layout||e.isDataDriven()||s.isDataDriven()||a!=="model-color"&&a!=="model-color-mix-intensity"&&a!=="model-rotation"&&a!=="model-scale"&&a!=="model-translation"&&a!=="model-emissive-strength")}_isPropertyZoomDependent(a){let e=this._transitionablePaint._values[a];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof rd}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Vs{constructor(a,e,s,u){super(a,{layout:oF||(oF=new Rr({"clip-layer-types":new pt(ke.layout_clip["clip-layer-types"]),"clip-layer-scope":new pt(ke.layout_clip["clip-layer-scope"])})),paint:sF||(sF=new Rr({}))},e,s,u)}recalculate(a,e){super.recalculate(a,e)}createBucket(a){return new aF(a)}is3D(a){return!0}}},l2=new Qn(0,0,0),c2={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},u2={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},iC={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},x7={PAINT_ORDER_FILL_AND_STROKE:1},cx={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},PN={MASK_TYPE_LUMINANCE:1};function b7(a,e,s){a===1&&e.icons.push((function(u,d){return(function(m){if(m.usvg_tree.height||(m.usvg_tree.height=m.usvg_tree.width),!m.metadata)return m;let{metadata:g}=m;if(g.content_area){let{content_area:v}=g;v.left==null&&(v.left=0),v.top==null&&(v.top=v.left),v.width==null&&(v.width=m.usvg_tree.width),v.height==null&&(v.height=v.width)}if(g.text_placeholder){let{text_placeholder:v}=g;v.top==null&&(v.top=v.left),v.height==null&&(v.height=v.width)}return g.stretch_x&&g.stretch_x.length&&ON(g,"x"),g.stretch_y&&g.stretch_y.length&&ON(g,"y"),m})(u.readFields(w7,{name:void 0},d))})(s,s.readVarint()+s.pos))}function ON(a,e){let s=[],u=a[`stretch_${e}`],d=null;for(let m=0;m<u.length;m++)d===null?d=s.length===0?u[0]:s[s.length-1][1]+u[m]:(s.push([d,d+u[m]]),d=null);a[`stretch_${e}_areas`]=s}function w7(a,e,s){a===1?e.name=s.readString():a===2?e.metadata=(function(u,d){return u.readFields(C7,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},d)})(s,s.readVarint()+s.pos):a===3&&(e.usvg_tree=(function(u,d){return u.readFields(S7,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},d)})(s,s.readVarint()+s.pos),e.data="usvg_tree")}function C7(a,e,s){a===1?e.stretch_x=s.readPackedVarint():a===2?e.stretch_y=s.readPackedVarint():a===3?e.content_area=RN(s,s.readVarint()+s.pos):a===4?e.variables.push((function(u,d){return u.readFields(T7,{name:void 0},d)})(s,s.readVarint()+s.pos)):a===5&&(e.text_placeholder=RN(s,s.readVarint()+s.pos))}function RN(a,e){return a.readFields(E7,{},e)}function E7(a,e,s){a===1?e.left=s.readVarint():a===2?e.width=s.readVarint():a===3?e.top=s.readVarint():a===4&&(e.height=s.readVarint())}function T7(a,e,s){a===1?e.name=s.readString():a===2&&(e.rgb_color=sC(s.readVarint()),e.value="rgb_color")}function S7(a,e,s){a===1?e.width=e.height=s.readVarint():a===2?e.height=s.readVarint():a===3?e.children.push(rC(s,s.readVarint()+s.pos)):a===4?e.linear_gradients.push((function(u,d){return u.readFields(R7,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},d)})(s,s.readVarint()+s.pos)):a===5?e.radial_gradients.push((function(u,d){return u.readFields(F7,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},d)})(s,s.readVarint()+s.pos)):a===7?e.clip_paths.push((function(u,d){return u.readFields(L7,{children:[]},d)})(s,s.readVarint()+s.pos)):a===8&&e.masks.push((function(u,d){let m=u.readFields(N7,{left:0,width:20,mask_type:PN.MASK_TYPE_LUMINANCE,children:[]},d);return m.height==null&&(m.height=m.width),m.top==null&&(m.top=m.left),m})(s,s.readVarint()+s.pos))}function rC(a,e){return a.readFields(D7,{},e)}function D7(a,e,s){a===1?(e.group=(function(u,d){return u.readFields(I7,{opacity:255,children:[]},d)})(s,s.readVarint()+s.pos),e.node="group"):a===2&&(e.path=(function(u,d){return u.readFields(A7,{paint_order:1,commands:[],step:1,diffs:[],rule:c2.PATH_RULE_NON_ZERO},d)})(s,s.readVarint()+s.pos),e.node="path")}function I7(a,e,s){a===1?e.transform=oC(s,s.readVarint()+s.pos):a===2?e.opacity=s.readVarint():a===5?e.clip_path_idx=s.readVarint():a===6?e.mask_idx=s.readVarint():a===7&&e.children.push(rC(s,s.readVarint()+s.pos))}function oC(a,e){return a.readFields(M7,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function M7(a,e,s){a===1?e.sx=s.readFloat():a===2?e.ky=s.readFloat():a===3?e.kx=s.readFloat():a===4?e.sy=s.readFloat():a===5?e.tx=s.readFloat():a===6&&(e.ty=s.readFloat())}function A7(a,e,s){a===1?e.fill=(function(u,d){return u.readFields(P7,{rgb_color:l2,paint:"rgb_color",opacity:255},d)})(s,s.readVarint()+s.pos):a===2?e.stroke=(function(u,d){return u.readFields(O7,{rgb_color:l2,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},d)})(s,s.readVarint()+s.pos):a===3?e.paint_order=s.readVarint():a===5?s.readPackedVarint(e.commands):a===6?e.step=s.readFloat():a===7?s.readPackedSVarint(e.diffs):a===8&&(e.rule=s.readVarint())}function P7(a,e,s){a===1?(e.rgb_color=sC(s.readVarint()),e.paint="rgb_color"):a===2?(e.linear_gradient_idx=s.readVarint(),e.paint="linear_gradient_idx"):a===3?(e.radial_gradient_idx=s.readVarint(),e.paint="radial_gradient_idx"):a===5&&(e.opacity=s.readVarint())}function sC(a){return new Qn((a>>16&255)/255,(a>>8&255)/255,(255&a)/255,1)}function O7(a,e,s){a===1?(e.rgb_color=sC(s.readVarint()),e.paint="rgb_color"):a===2?(e.linear_gradient_idx=s.readVarint(),e.paint="linear_gradient_idx"):a===3?(e.radial_gradient_idx=s.readVarint(),e.paint="radial_gradient_idx"):a===5?s.readPackedFloat(e.dasharray):a===6?e.dashoffset=s.readFloat():a===7?e.miterlimit=s.readFloat():a===8?e.opacity=s.readVarint():a===9?e.width=s.readFloat():a===10?e.linecap=s.readVarint():a===11&&(e.linejoin=s.readVarint())}function R7(a,e,s){a===1?e.transform=oC(s,s.readVarint()+s.pos):a===2?e.spread_method=s.readVarint():a===3?e.stops.push(kN(s,s.readVarint()+s.pos)):a===4?e.x1=s.readFloat():a===5?e.y1=s.readFloat():a===6?e.x2=s.readFloat():a===7&&(e.y2=s.readFloat())}function kN(a,e){return a.readFields(k7,{offset:0,opacity:255,rgb_color:l2},e)}function k7(a,e,s){a===1?e.offset=s.readFloat():a===2?e.opacity=s.readVarint():a===3&&(e.rgb_color=sC(s.readVarint()))}function F7(a,e,s){a===1?e.transform=oC(s,s.readVarint()+s.pos):a===2?e.spread_method=s.readVarint():a===3?e.stops.push(kN(s,s.readVarint()+s.pos)):a===4?e.cx=s.readFloat():a===5?e.cy=s.readFloat():a===6?e.r=s.readFloat():a===7?e.fx=s.readFloat():a===8?e.fy=s.readFloat():a===9&&(e.fr=s.readFloat())}function L7(a,e,s){a===1?e.transform=oC(s,s.readVarint()+s.pos):a===2?e.clip_path_idx=s.readVarint():a===3&&e.children.push(rC(s,s.readVarint()+s.pos))}function N7(a,e,s){a===1?e.left=e.top=s.readFloat():a===2?e.width=e.height=s.readFloat():a===3?e.top=s.readFloat():a===4?e.height=s.readFloat():a===5?e.mask_type=s.readVarint():a===6?e.mask_idx=s.readVarint():a===7&&e.children.push(rC(s,s.readVarint()+s.pos))}class z7{static calculate(e={},s=[]){let u=new Map,d=new Map;if(Object.keys(e).length===0)return u;s.forEach(m=>{d.set(m.name,m.rgb_color||new Qn(0,0,0))});for(let[m,g]of Object.entries(e))d.has(m)?u.set(d.get(m).toString(),g):console.warn(`Ignoring unknown image variable "${m}"`);return u}}function U_(a,e=255,s){let u=e/255,d=a.toString(),m=s.has(d)?s.get(d).clone():a.clone();return m.a*=u,m.toString()}function ux(a,e){if(!Bs()){let s=document.createElement("canvas");return s.width=a,s.height=e,s}return new OffscreenCanvas(a,e)}function B7(a,e){let s=z7.calculate(e.params,a.metadata?a.metadata.variables:[]),u=a.usvg_tree,d=u.width,m=u.height,g=e.transform?e.transform:new DOMMatrix,v=Math.max(1,Math.round(d*g.a)),b=Math.max(1,Math.round(m*g.d)),w=new DOMMatrix([v/d,0,0,b/m,0,0]),S=ux(v,b).getContext("2d");return d2(S,w,u,u,s),S.getImageData(0,0,v,b)}function d2(a,e,s,u,d){for(let m of u.children)FN(a,e,s,m,d)}function FN(a,e,s,u,d){u.group?(a.save(),(function(m,g,v,b,w){let S=b.mask_idx!=null?v.masks[b.mask_idx]:null,D=b.clip_path_idx!=null?v.clip_paths[b.clip_path_idx]:null;if(b.transform&&(g=H_(b.transform).preMultiplySelf(g)),!(function(k,B,U){return k.opacity!==255||B||U})(b,D!=null,S!=null))return void d2(m,g,v,b,w);let I=ux(m.canvas.width,m.canvas.height),R=I.getContext("2d");d2(R,g,v,b,w),D&&UN(R,g,v,D),S&&HN(R,g,v,S,w),m.globalAlpha=b.opacity/255,m.drawImage(I,0,0)})(a,e,s,u.group,d),a.restore()):u.path&&(a.save(),(function(m,g,v,b,w){m.setTransform(g),b.paint_order===x7.PAINT_ORDER_FILL_AND_STROKE?(LN(m,v,b,w),zN(m,v,b,w)):(zN(m,v,b,w),LN(m,v,b,w))})(a,e,s,u.path,d),a.restore())}function LN(a,e,s,u){let d=s.fill;if(!d)return;let m=d.opacity/255;switch(a.save(),a.beginPath(),$N(s,a),d.paint){case"rgb_color":a.fillStyle=U_(d.rgb_color,d.opacity,u);break;case"linear_gradient_idx":{let g=e.linear_gradients[d.linear_gradient_idx];g.transform&&a.setTransform(H_(g.transform).preMultiplySelf(a.getTransform())),a.fillStyle=BN(a,g,m,u);break}case"radial_gradient_idx":{let g=e.radial_gradients[d.radial_gradient_idx];g.transform&&a.setTransform(H_(g.transform).preMultiplySelf(a.getTransform())),a.fillStyle=jN(a,g,m,u)}}a.fill(NN(s)),a.restore()}function NN(a){return a.rule===c2.PATH_RULE_NON_ZERO?"nonzero":a.rule===c2.PATH_RULE_EVEN_ODD?"evenodd":void 0}function zN(a,e,s,u){let d=s.stroke;if(!d)return;let m=GN(s);a.lineWidth=d.width,a.miterLimit=d.miterlimit,a.setLineDash(d.dasharray),a.lineDashOffset=d.dashoffset;let g=d.opacity/255;switch(d.paint){case"rgb_color":a.strokeStyle=U_(d.rgb_color,d.opacity,u);break;case"linear_gradient_idx":a.strokeStyle=BN(a,e.linear_gradients[d.linear_gradient_idx],g,u,!0);break;case"radial_gradient_idx":a.strokeStyle=jN(a,e.radial_gradients[d.radial_gradient_idx],g,u,!0)}switch(d.linejoin){case iC.LINE_JOIN_MITER_CLIP:case iC.LINE_JOIN_MITER:a.lineJoin="miter";break;case iC.LINE_JOIN_ROUND:a.lineJoin="round";break;case iC.LINE_JOIN_BEVEL:a.lineJoin="bevel"}switch(d.linecap){case u2.LINE_CAP_BUTT:a.lineCap="butt";break;case u2.LINE_CAP_ROUND:a.lineCap="round";break;case u2.LINE_CAP_SQUARE:a.lineCap="square"}a.stroke(m)}function BN(a,e,s,u,d=!1){if(e.stops.length===1){let I=e.stops[0];return U_(I.rgb_color,I.opacity*s,u)}let{x1:m,y1:g,x2:v,y2:b}=e,w=new DOMPoint(m,g),S=new DOMPoint(v,b);if(d){let I=H_(e.transform);w=I.transformPoint(w),S=I.transformPoint(S)}let D=a.createLinearGradient(w.x,w.y,S.x,S.y);for(let I of e.stops)D.addColorStop(I.offset,U_(I.rgb_color,I.opacity*s,u));return D}function jN(a,e,s,u,d=!1){if(e.stops.length===1){let G=e.stops[0];return U_(G.rgb_color,G.opacity*s,u)}let m=H_(e.transform),{fx:g,fy:v,fr:b,cx:w,cy:S,r:D}=e,I=new DOMPoint(g,v),R=new DOMPoint(w,S),k=b,B=D;if(d){I=m.transformPoint(I),R=m.transformPoint(R);let G=(m.a+m.d)/2;k=b*G,B=e.r*G}let U=a.createRadialGradient(I.x,I.y,k,R.x,R.y,B);for(let G of e.stops)U.addColorStop(G.offset,U_(G.rgb_color,G.opacity*s,u));return U}function VN(a,e,s,u){let d=u.transform?H_(u.transform).preMultiplySelf(e):e,m=ux(a.canvas.width,a.canvas.height),g=m.getContext("2d");for(let b of u.children)if(b.group)VN(g,d,s,b.group);else if(b.path){let w=b.path,S=new Path2D;S.addPath(GN(w),d),g.fill(S,NN(w))}let v=u.clip_path_idx!=null?s.clip_paths[u.clip_path_idx]:null;v&&UN(g,d,s,v),a.globalCompositeOperation="source-over",a.drawImage(m,0,0)}function UN(a,e,s,u){let d=ux(a.canvas.width,a.canvas.height);VN(d.getContext("2d"),e,s,u),a.globalCompositeOperation="destination-in",a.drawImage(d,0,0)}function HN(a,e,s,u,d){if(u.children.length===0)return;let m=u.mask_idx!=null?s.masks[u.mask_idx]:null;m&&HN(a,e,s,m,d);let g=a.canvas.width,v=a.canvas.height,b=ux(g,v),w=b.getContext("2d"),S=u.width,D=u.height,I=u.left,R=u.top,k=new Path2D,B=new Path2D;B.rect(I,R,S,D),k.addPath(B,e),w.clip(k);for(let J of u.children)FN(w,e,s,J,d);let U=w.getImageData(0,0,g,v),G=U.data;if(u.mask_type===PN.MASK_TYPE_LUMINANCE)for(let J=0;J<G.length;J+=4)G[J+3]=G[J+3]/255*(.2126*G[J]+.7152*G[J+1]+.0722*G[J+2]);w.putImageData(U,0,0),a.globalCompositeOperation="destination-in",a.drawImage(b,0,0)}function H_(a){return a?new DOMMatrix([a.sx,a.ky,a.kx,a.sy,a.tx,a.ty]):new DOMMatrix}function $N(a,e){let s=a.step,u=a.diffs[0]*s,d=a.diffs[1]*s;e.moveTo(u,d);for(let m=0,g=2;m<a.commands.length;m++)switch(a.commands[m]){case cx.PATH_COMMAND_MOVE:u+=a.diffs[g++]*s,d+=a.diffs[g++]*s,e.moveTo(u,d);break;case cx.PATH_COMMAND_LINE:u+=a.diffs[g++]*s,d+=a.diffs[g++]*s,e.lineTo(u,d);break;case cx.PATH_COMMAND_QUAD:{let v=u+a.diffs[g++]*s,b=d+a.diffs[g++]*s;u=v+a.diffs[g++]*s,d=b+a.diffs[g++]*s,e.quadraticCurveTo(v,b,u,d);break}case cx.PATH_COMMAND_CUBIC:{let v=u+a.diffs[g++]*s,b=d+a.diffs[g++]*s,w=v+a.diffs[g++]*s,S=b+a.diffs[g++]*s;u=w+a.diffs[g++]*s,d=S+a.diffs[g++]*s,e.bezierCurveTo(v,b,w,S,u,d);break}case cx.PATH_COMMAND_CLOSE:e.closePath()}return e}function GN(a){return $N(a,new Path2D)}class aC{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;let s=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,s),s}put(e,s){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,s)}delete(e){this.cache.delete(e)}}Bt(aC,"LRUCache");class h2{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new Cs(e,e.data)}getFromCache(e,s,u){return this.cacheMap.has(u)||this.cacheMap.set(u,new aC(150)),this.cacheMap.get(u).get(yh(e.toString(),s))}setInCache(e,s,u,d){this.cacheDependenciesMap.has(d)||this.cacheDependenciesMap.set(d,new Map),this.cacheMap.has(d)||this.cacheMap.set(d,new aC(150));let m=this.cacheDependenciesMap.get(d),g=yh(e.id.toString(),u);m.get(g)||m.set(g,new Set);let v=this.cacheMap.get(d),b=e.toString();m.get(g).add(b),v.put(yh(e.toString(),u),s)}removeImagesFromCacheByIds(e,s,u=0){if(!this.cacheMap.has(u)||!this.cacheDependenciesMap.has(u))return;let d=this.cacheMap.get(u),m=this.cacheDependenciesMap.get(u);for(let g of e){let v=yh(g.toString(),s);if(m.has(v)){for(let b of m.get(v))d.delete(b);m.delete(v)}}}rasterize(e,s,u,d,m=B7){let g=this.getFromCache(e,u,d);if(g)return g.clone();let v=m(s.icon,e.options),b=h2._getImage(v);return this.setInCache(e,b,u,d),b.clone()}}class qN{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,s){let u=this.toIdx(e,s);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(e,s){return this.leaves[this.toIdx(e,s)]}toIdx(e,s){return s*this.size+e}}function WN(a,e,s,u){let d=0,m=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(u[g])<1e-15){if(s[g]<a[g]||s[g]>e[g])return null}else{let v=1/u[g],b=(a[g]-s[g])*v,w=(e[g]-s[g])*v;if(b>w){let S=b;b=w,w=S}if(b>d&&(d=b),w<m&&(m=w),d>m)return null}return d}function ZN(a,e,s,u,d,m,g,v,b,w,S){let D=u-a,I=d-e,R=m-s,k=g-a,B=v-e,U=b-s,G=S[1]*U-S[2]*B,J=S[2]*k-S[0]*U,ee=S[0]*B-S[1]*k,se=D*G+I*J+R*ee;if(Math.abs(se)<1e-15)return null;let _e=1/se,fe=w[0]-a,we=w[1]-e,Ee=w[2]-s,Se=(fe*G+we*J+Ee*ee)*_e;if(Se<0||Se>1)return null;let We=we*R-Ee*I,Fe=Ee*D-fe*R,Ze=fe*I-we*D,Qe=(S[0]*We+S[1]*Fe+S[2]*Ze)*_e;return Qe<0||Se+Qe>1?null:(k*We+B*Fe+U*Ze)*_e}function XN(a,e,s){return(a-e)/(s-e)}function YN(a,e,s,u,d,m,g,v,b){let w=1<<s,S=m-u,D=g-d,I=(a+1)/w*S+u,R=(e+0)/w*D+d,k=(e+1)/w*D+d;v[0]=(a+0)/w*S+u,v[1]=R,b[0]=I,b[1]=k}class KN{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let s=(function(m){let g=Math.ceil(Math.log2(m.dim/8)),v=[],b=Math.ceil(Math.pow(2,g)),w=1/b,S=(R,k,B,U,G)=>{let J=U?1:0,ee=(R+1)*B-J,se=k*B,_e=(k+1)*B-J;G[0]=R*B,G[1]=se,G[2]=ee,G[3]=_e},D=new qN(b),I=[];for(let R=0;R<b*b;R++){S(R%b,Math.floor(R/b),w,!1,I);let k=Kf(I[0],I[1],m),B=Kf(I[2],I[1],m),U=Kf(I[2],I[3],m),G=Kf(I[0],I[3],m);D.minimums.push(Math.min(k,B,U,G)),D.maximums.push(Math.max(k,B,U,G)),D.leaves.push(1)}for(v.push(D),b/=2;b>=1;b/=2){let R=v[v.length-1];D=new qN(b);for(let k=0;k<b*b;k++){S(k%b,Math.floor(k/b),2,!0,I);let B=R.getElevation(I[0],I[1]),U=R.getElevation(I[2],I[1]),G=R.getElevation(I[2],I[3]),J=R.getElevation(I[0],I[3]),ee=R.isLeaf(I[0],I[1]),se=R.isLeaf(I[2],I[1]),_e=R.isLeaf(I[2],I[3]),fe=R.isLeaf(I[0],I[3]),we=Math.min(B.min,U.min,G.min,J.min),Ee=Math.max(B.max,U.max,G.max,J.max),Se=ee&&se&&_e&&fe;D.maximums.push(Ee),D.minimums.push(we),D.leaves.push(Ee-we<=5&&Se?1:0)}v.push(D)}return v})(this.dem),u=s.length-1,d=s[u];this._addNode(d.minimums[0],d.maximums[0],d.leaves[0]),this._construct(s,0,0,u,0)}raycastRoot(e,s,u,d,m,g,v=1){return WN([e,s,-100],[u,d,this.maximums[0]*v],m,g)}raycast(e,s,u,d,m,g,v=1){if(!this.nodeCount)return null;let b=this.raycastRoot(e,s,u,d,m,g,v);if(b==null)return null;let w=[],S=[],D=[],I=[],R=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;R.length>0;){let{idx:k,t:B,nodex:U,nodey:G,depth:J}=R.pop();if(this.leaves[k]){YN(U,G,J,e,s,u,d,D,I);let se=1<<J,_e=(U+0)/se,fe=(U+1)/se,we=(G+0)/se,Ee=(G+1)/se,Se=Kf(_e,we,this.dem)*v,We=Kf(fe,we,this.dem)*v,Fe=Kf(fe,Ee,this.dem)*v,Ze=Kf(_e,Ee,this.dem)*v,Qe=ZN(D[0],D[1],Se,I[0],D[1],We,I[0],I[1],Fe,m,g),rt=ZN(I[0],I[1],Fe,D[0],I[1],Ze,D[0],D[1],Se,m,g),vt=Math.min(Qe!==null?Qe:Number.MAX_VALUE,rt!==null?rt:Number.MAX_VALUE);if(vt!==Number.MAX_VALUE)return vt;{let dt=Do([],m,g,B);if(JN(Se,We,Ze,Fe,XN(dt[0],D[0],I[0]),XN(dt[1],D[1],I[1]))>=dt[2])return B}continue}let ee=0;for(let se=0;se<this._siblingOffset.length;se++){YN((U<<1)+this._siblingOffset[se][0],(G<<1)+this._siblingOffset[se][1],J+1,e,s,u,d,D,I),D[2]=-100,I[2]=this.maximums[this.childOffsets[k]+se]*v;let _e=WN(D,I,m,g);if(_e!=null){let fe=_e;w[se]=fe;let we=!1;for(let Ee=0;Ee<ee&&!we;Ee++)fe>=w[S[Ee]]&&(S.splice(Ee,0,se),we=!0);we||(S[ee]=se),ee++}}for(let se=0;se<ee;se++){let _e=S[se];R.push({idx:this.childOffsets[k]+_e,t:w[_e],nodex:(U<<1)+this._siblingOffset[_e][0],nodey:(G<<1)+this._siblingOffset[_e][1],depth:J+1})}}return null}_addNode(e,s,u){return this.minimums.push(e),this.maximums.push(s),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(e,s,u,d,m){if(e[d].isLeaf(s,u)===1)return;this.childOffsets[m]||(this.childOffsets[m]=this.nodeCount);let g=d-1,v=e[g],b=0,w=0;for(let S=0;S<this._siblingOffset.length;S++){let D=2*s+this._siblingOffset[S][0],I=2*u+this._siblingOffset[S][1],R=v.getElevation(D,I),k=v.isLeaf(D,I),B=this._addNode(R.min,R.max,k);k&&(b|=1<<S),w||(w=B)}for(let S=0;S<this._siblingOffset.length;S++)b&1<<S||this._construct(e,2*s+this._siblingOffset[S][0],2*u+this._siblingOffset[S][1],g,w+S)}}function JN(a,e,s,u,d,m){return ln(ln(a,s,m),ln(e,u,m),d)}function Kf(a,e,s){let u=s.dim,d=X(a*u-.5,0,u-1),m=X(e*u-.5,0,u-1),g=Math.floor(d),v=Math.floor(m),b=Math.min(g+1,u-1),w=Math.min(v+1,u-1);return JN(s.get(g,v),s.get(b,v),s.get(g,w),s.get(b,w),d-g,m-v)}let j7={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function V7(a,e,s){return(256*a*256+256*e+s)/10-1e4}function U7(a,e,s){return 256*a+e+s/256-32768}class lC{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,s,u,d=!1){if(this.uid=e,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return void Gt(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=s.height;let m=this.dim=s.height-2,g=new Uint32Array(s.data.buffer);if(this.pixels=new Uint8Array(s.data.buffer),this.floatView=new Float32Array(s.data.buffer),this.borderReady=d,this._modifiedForSources={},!d){for(let b=0;b<m;b++)g[this._idx(-1,b)]=g[this._idx(0,b)],g[this._idx(m,b)]=g[this._idx(m-1,b)],g[this._idx(b,-1)]=g[this._idx(b,0)],g[this._idx(b,m)]=g[this._idx(b,m-1)];g[this._idx(-1,-1)]=g[this._idx(0,0)],g[this._idx(m,-1)]=g[this._idx(m-1,0)],g[this._idx(-1,m)]=g[this._idx(0,m-1)],g[this._idx(m,m)]=g[this._idx(m-1,m-1)]}let v=u==="terrarium"?U7:V7;for(let b=0;b<g.length;++b){let w=4*b;this.floatView[b]=v(this.pixels[w],this.pixels[w+1],this.pixels[w+2])}this._timestamp=Zs.now()}_buildQuadTree(){this._tree=new KN(this)}get(e,s,u=!1){u&&(e=X(e,-1,this.dim),s=X(s,-1,this.dim));let d=this._idx(e,s);return this.floatView[d]}set(e,s,u){let d=this._idx(e,s),m=this.floatView[d];return this.floatView[d]=u,u-m}static getUnpackVector(e){return j7[e]}_idx(e,s){if(e<-1||e>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(e+1)}static pack(e,s){let u=[0,0,0,0],d=lC.getUnpackVector(s),m=Math.floor((e+d[3])/d[2]);return u[2]=m%256,m=Math.floor(m/256),u[1]=m%256,m=Math.floor(m/256),u[0]=m,u}getPixels(){return new Gk({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,s,u){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let d=s*this.dim,m=s*this.dim+this.dim,g=u*this.dim,v=u*this.dim+this.dim;switch(s){case-1:d=m-1;break;case 1:m=d+1}switch(u){case-1:g=v-1;break;case 1:v=g+1}let b=-s*this.dim,w=-u*this.dim;for(let S=g;S<v;S++)for(let D=d;D<m;D++){let I=4*this._idx(D,S),R=4*this._idx(D+b,S+w);this.pixels[I+0]=e.pixels[R+0],this.pixels[I+1]=e.pixels[R+1],this.pixels[I+2]=e.pixels[R+2],this.pixels[I+3]=e.pixels[R+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function H7(a,e,s){a===1?e.headerLength=s.readFixed32():a===2?e.x=s.readVarint():a===3?e.y=s.readVarint():a===4?e.z=s.readVarint():a===5&&e.layers.push((function(u,d){return u.readFields(Z7,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},d)})(s,s.readVarint()+s.pos))}function $7(a,e,s){a===1?(e.delta_filter=(function(u,d){return u.readFields(G7,{blockSize:0},d)})(s,s.readVarint()+s.pos),e.filter="delta_filter"):a===2?(s.readVarint(),e.filter="zigzag_filter"):a===3?(s.readVarint(),e.filter="bitshuffle_filter"):a===4&&(s.readVarint(),e.filter="byteshuffle_filter")}function G7(a,e,s){a===1&&(e.blockSize=s.readVarint())}function q7(a,e,s){a===1?(s.readVarint(),e.codec="gzip_data"):a===2?(s.readVarint(),e.codec="jpeg_image"):a===3?(s.readVarint(),e.codec="webp_image"):a===4&&(s.readVarint(),e.codec="png_image")}function W7(a,e,s){let u=0,d=0;a===1?e.firstByte=s.readFixed64():a===2?e.lastByte=s.readFixed64():a===3?e.filters.push((function(m,g){return m.readFields($7,{},g)})(s,s.readVarint()+s.pos)):a===4?e.codec=(function(m,g){return m.readFields(q7,{},g)})(s,s.readVarint()+s.pos):a===5?d=s.readFloat():a===6?u=s.readFloat():a===7?e.bands.push(s.readString()):a===8?e.offset=s.readDouble():a===9&&(e.scale=s.readDouble()),e.offset===0&&(e.offset=d),e.scale===0&&(e.scale=u)}function Z7(a,e,s){a===1?e.version=s.readVarint():a===2?e.name=s.readString():a===3?e.units=s.readString():a===4?e.tileSize=s.readVarint():a===5?e.buffer=s.readVarint():a===6?e.pixelFormat=s.readVarint():a===7&&e.dataIndex.push((function(u,d){return u.readFields(W7,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},d)})(s,s.readVarint()+s.pos))}function X7(a,e,s){if(a===2)(function(u,d,m){u.readFields(Y7,m,d)})(s,s.readVarint()+s.pos,e);else if(a===3)throw new Error("Not implemented")}function Y7(a,e,s){if(a===1){let u=0,d=s.readVarint()+s.pos;for(;s.pos<d;)e[u++]=s.readVarint()}}function K7(a,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let s=e[3];for(let u=2;u>=1;u--){let d=u===1?1:0,m=u===2?1:0;for(let g=0;g<e[0];g++){let v=e[1]*g;for(let b=d;b<e[1];b++){let w=e[2]*(b+v);for(let S=m;S<e[2];S++){let D=e[3]*(S+w);for(let I=0;I<e[3];I++){let R=D+I;a[R]+=a[R-s]}}}}s*=e[u]}return a}function J7(a){for(let e=0,s=a.length;e<s;e++)a[e]=a[e]>>>1^-(1&a[e]);return a}function Q7(a,e){switch(e){case"uint32":return a;case"uint16":for(let s=0;s<a.length;s+=2){let u=a[s],d=a[s+1];a[s]=(240&u)>>4|(61440&u)>>8|(240&d)<<4|61440&d,a[s+1]=15&u|(3840&u)>>4|(15&d)<<8|(3840&d)<<4}return a;case"uint8":for(let s=0;s<a.length;s+=4){let u=a[s],d=a[s+1],m=a[s+2],g=a[s+3];a[s+0]=(192&u)>>6|(192&d)>>4|(192&m)>>2|192&g,a[s+1]=(48&u)>>4|(48&d)>>2|48&m|(48&g)<<2,a[s+2]=(12&u)>>2|12&d|(12&m)<<2|(12&g)<<4,a[s+3]=3&u|(3&d)<<2|(3&m)<<4|(3&g)<<6}return a;default:throw new Error(`Invalid pixel format, "${e}"`)}}Bt(lC,"DEMData"),Bt(KN,"DemMinMaxQuadTree",{omit:["dem"]});var Yl=Uint8Array,dx=Uint16Array,eW=Int32Array,QN=new Yl([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),e3=new Yl([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),tW=new Yl([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),t3=function(a,e){for(var s=new dx(31),u=0;u<31;++u)s[u]=e+=1<<a[u-1];var d=new eW(s[30]);for(u=1;u<30;++u)for(var m=s[u];m<s[u+1];++m)d[m]=m-s[u]<<5|u;return{b:s,r:d}},n3=t3(QN,2),i3=n3.b,nW=n3.r;i3[28]=258,nW[258]=28;for(var iW=t3(e3,0).b,r3=new dx(32768),Mo=0;Mo<32768;++Mo){var $_=(43690&Mo)>>1|(21845&Mo)<<1;r3[Mo]=((65280&($_=(61680&($_=(52428&$_)>>2|(13107&$_)<<2))>>4|(3855&$_)<<4))>>8|(255&$_)<<8)>>1}var hx=function(a,e,s){for(var u=a.length,d=0,m=new dx(e);d<u;++d)a[d]&&++m[a[d]-1];var g,v=new dx(e);for(d=1;d<e;++d)v[d]=v[d-1]+m[d-1]<<1;g=new dx(1<<e);var b=15-e;for(d=0;d<u;++d)if(a[d])for(var w=d<<4|a[d],S=e-a[d],D=v[a[d]-1]++<<S,I=D|(1<<S)-1;D<=I;++D)g[r3[D]>>b]=w;return g},fx=new Yl(288);for(Mo=0;Mo<144;++Mo)fx[Mo]=8;for(Mo=144;Mo<256;++Mo)fx[Mo]=9;for(Mo=256;Mo<280;++Mo)fx[Mo]=7;for(Mo=280;Mo<288;++Mo)fx[Mo]=8;var o3=new Yl(32);for(Mo=0;Mo<32;++Mo)o3[Mo]=5;var rW=hx(fx,9),oW=hx(o3,5),f2=function(a){for(var e=a[0],s=1;s<a.length;++s)a[s]>e&&(e=a[s]);return e},du=function(a,e,s){var u=e/8|0;return(a[u]|a[u+1]<<8)>>(7&e)&s},p2=function(a,e){var s=e/8|0;return(a[s]|a[s+1]<<8|a[s+2]<<16)>>(7&e)},sW=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],hu=function(a,e,s){var u=new Error(e||sW[a]);if(u.code=a,Error.captureStackTrace&&Error.captureStackTrace(u,hu),!s)throw u;return u},aW=new Yl(0),lW=typeof TextDecoder<"u"&&new TextDecoder;try{lW.decode(aW,{stream:!0})}catch{}let cW={gzip_data:"gzip"};class Ec extends Error{constructor(e){super(e),this.name="MRTError"}}let uW={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},s3={uint32:1,uint16:2,uint8:4},dW={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array},m2;class cC{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){let s=this.layers[e];if(!s)throw new Ec(`Layer '${e}' not found`);return s}getHeaderLength(e){let s=new Uint8Array(e),u=new DataView(e);if(s[0]!==13)throw new Ec("File is not a valid MRT.");return u.getUint32(1,!0)}parseHeader(e){let s=new Uint8Array(e),u=this.getHeaderLength(e);if(s.length<u)throw new Ec(`Expected header with length >= ${u} but got buffer of length ${s.length}`);let d=new m2(s.subarray(0,u)).readFields(H7,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==d.x||this.y!==d.y||this.z!==d.z))throw new Ec(`Invalid attempt to parse header ${d.z}/${d.x}/${d.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=d.x,this.y=d.y,this.z=d.z;for(let m of d.layers)this.layers[m.name]=new a3(m,{cacheSize:this._cacheSize});return this}createDecodingTask(e){let s=[],u=this.getLayer(e.layerName);for(let d of e.blockIndices){let m=u.dataIndex[d],g=m.firstByte-e.firstByte,v=m.lastByte-e.firstByte;if(u._blocksInProgress.has(d))continue;let b={layerName:u.name,firstByte:g,lastByte:v,pixelFormat:u.pixelFormat,blockIndex:d,blockShape:[m.bands.length].concat(u.bandShape),buffer:u.buffer,codec:m.codec.codec,filters:m.filters.map(w=>w.filter)};u._blocksInProgress.add(d),s.push(b)}return new l3(s,()=>{s.forEach(d=>u._blocksInProgress.delete(d.blockIndex))},(d,m)=>{if(s.forEach(g=>u._blocksInProgress.delete(g.blockIndex)),d)throw d;m.forEach(g=>{this.getLayer(g.layerName).processDecodedData(g)})})}}class a3{constructor({version:e,name:s,units:u,tileSize:d,pixelFormat:m,buffer:g,dataIndex:v},b){if(this.version=e,this.version!==1)throw new Ec(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=s,this.units=u,this.tileSize=d,this.buffer=g,this.pixelFormat=uW[m],this.dataIndex=v,this.bandShape=[d+2*g,d+2*g,s3[this.pixelFormat]],this._decodedBlocks=new aC(b?b.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return s3[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){let s=e.blockIndex.toString();this._decodedBlocks.get(s)||this._decodedBlocks.put(s,e.data)}getBlockForBand(e){let s=0;switch(typeof e){case"string":for(let[u,d]of this.dataIndex.entries()){for(let[m,g]of d.bands.entries())if(g===e)return{bandIndex:s+m,blockIndex:u,blockBandIndex:m};s+=d.bands.length}break;case"number":for(let[u,d]of this.dataIndex.entries()){if(e>=s&&e<s+d.bands.length)return{bandIndex:e,blockIndex:u,blockBandIndex:e-s};s+=d.bands.length}break;default:throw new Ec(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let s=1/0,u=-1/0,d=[],m=new Set;for(let g of e){let{blockIndex:v}=this.getBlockForBand(g);if(v<0)throw new Ec(`Invalid band: ${JSON.stringify(g)}`);let b=this.dataIndex[v];d.includes(v)||d.push(v),m.add(v),s=Math.min(s,b.firstByte),u=Math.max(u,b.lastByte)}if(m.size>this.cacheSize)throw new Ec(`Number of blocks to decode (${m.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:s,lastByte:u,blockIndices:d}}hasBand(e){let{blockIndex:s}=this.getBlockForBand(e);return s>=0}hasDataForBand(e){let{blockIndex:s}=this.getBlockForBand(e);return s>=0&&!!this._decodedBlocks.get(s.toString())}getBandView(e){let{blockIndex:s,blockBandIndex:u}=this.getBlockForBand(e);if(s<0)throw new Ec(`Band not found: ${JSON.stringify(e)}`);let d=this._decodedBlocks.get(s.toString());if(!d)throw new Ec(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);let m=this.dataIndex[s],g=this.bandShape.reduce((w,S)=>w*S,1),v=u*g,b=d.subarray(v,v+g);return{data:b,bytes:new Uint8Array(b.buffer).subarray(b.byteOffset,b.byteOffset+b.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:m.offset,scale:m.scale}}}cC.setPbf=function(a){m2=a};class l3{constructor(e,s,u){this.tasks=e,this._onCancel=s,this._onComplete=u,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,s){this._finalized||(this._onComplete(e,s),this._finalized=!0)}}cC.performDecoding=function(a,e){let s=new Uint8Array(a);return Promise.all(e.tasks.map(u=>{let{layerName:d,firstByte:m,lastByte:g,pixelFormat:v,blockShape:b,blockIndex:w,filters:S,codec:D}=u,I=s.subarray(m,g+1),R=new Uint32Array(b[0]*b[1]*b[2]),k;if(D!=="gzip_data")throw new Ec(`Unhandled codec: ${D}`);return k=(function(B,U){if(!globalThis.DecompressionStream&&U==="gzip_data")return Promise.resolve(((se=(function(we){we[0]==31&&we[1]==139&&we[2]==8||hu(6,"invalid gzip data");var Ee=we[3],Se=10;4&Ee&&(Se+=2+(we[10]|we[11]<<8));for(var We=(Ee>>3&1)+(Ee>>4&1);We>0;We-=!we[Se++]);return Se+(2&Ee)})(ee=B))+8>ee.length&&hu(6,"invalid gzip data"),(function(we,Ee,Se,We){var Fe=we.length;if(!Fe||Ee.f&&!Ee.l)return Se||new Yl(0);var Ze=!Se,Qe=Ze||Ee.i!=2,rt=Ee.i;Ze&&(Se=new Yl(3*Fe));var vt,dt,et=function(Ir){var dr=Se.length;if(Ir>dr){var nr=new Yl(Math.max(2*dr,Ir));nr.set(Se),Se=nr}},ut=Ee.f||0,Ge=Ee.p||0,$e=Ee.b||0,lt=Ee.l,gt=Ee.d,it=Ee.m,Nt=Ee.n,Ut=8*Fe;do{if(!lt){ut=du(we,Ge,1);var Pt=du(we,Ge+1,3);if(Ge+=3,!Pt){var St=we[(pe=4+((Ge+7)/8|0))-4]|we[pe-3]<<8,yn=pe+St;if(yn>Fe){rt&&hu(0);break}Qe&&et($e+St),Se.set(we.subarray(pe,yn),$e),Ee.b=$e+=St,Ee.p=Ge=8*yn,Ee.f=ut;continue}if(Pt==1)lt=rW,gt=oW,it=9,Nt=5;else if(Pt==2){var It=du(we,Ge,31)+257,rn=du(we,Ge+10,15)+4,xn=It+du(we,Ge+5,31)+1;Ge+=14;for(var Nn=new Yl(xn),ri=new Yl(19),wn=0;wn<rn;++wn)ri[tW[wn]]=du(we,Ge+3*wn,7);Ge+=3*rn;var fi=f2(ri),pi=(1<<fi)-1,xr=hx(ri,fi);for(wn=0;wn<xn;){var pe,ue=xr[du(we,Ge,pi)];if(Ge+=15&ue,(pe=ue>>4)<16)Nn[wn++]=pe;else{var Xe=0,Et=0;for(pe==16?(Et=3+du(we,Ge,3),Ge+=2,Xe=Nn[wn-1]):pe==17?(Et=3+du(we,Ge,7),Ge+=3):pe==18&&(Et=11+du(we,Ge,127),Ge+=7);Et--;)Nn[wn++]=Xe}}var Ye=Nn.subarray(0,It),Dt=Nn.subarray(It);it=f2(Ye),Nt=f2(Dt),lt=hx(Ye,it),gt=hx(Dt,Nt)}else hu(1);if(Ge>Ut){rt&&hu(0);break}}Qe&&et($e+131072);for(var Yt=(1<<it)-1,Xt=(1<<Nt)-1,En=Ge;;En=Ge){var cn=(Xe=lt[p2(we,Ge)&Yt])>>4;if((Ge+=15&Xe)>Ut){rt&&hu(0);break}if(Xe||hu(2),cn<256)Se[$e++]=cn;else{if(cn==256){En=Ge,lt=null;break}var qt=cn-254;cn>264&&(qt=du(we,Ge,(1<<(hn=QN[wn=cn-257]))-1)+i3[wn],Ge+=hn);var ui=gt[p2(we,Ge)&Xt],$i=ui>>4;if(ui||hu(3),Ge+=15&ui,Dt=iW[$i],$i>3){var hn=e3[$i];Dt+=p2(we,Ge)&(1<<hn)-1,Ge+=hn}if(Ge>Ut){rt&&hu(0);break}Qe&&et($e+131072);var ni=$e+qt;if($e<Dt){var Gi=0-Dt,Ti=Math.min(Dt,ni);for(Gi+$e<0&&hu(3);$e<Ti;++$e)Se[$e]=(void 0)[Gi+$e]}for(;$e<ni;++$e)Se[$e]=Se[$e-Dt]}}Ee.l=lt,Ee.p=En,Ee.b=$e,Ee.f=ut,lt&&(ut=1,Ee.m=it,Ee.d=gt,Ee.n=Nt)}while(!ut);return $e!=Se.length&&Ze?(vt=Se,((dt=$e)==null||dt>vt.length)&&(dt=vt.length),new Yl(vt.subarray(0,dt))):Se.subarray(0,$e)})(ee.subarray(se,-8),{i:2},new Yl(((G=ee)[(J=G.length)-4]|G[J-3]<<8|G[J-2]<<16|G[J-1]<<24)>>>0))));var G,J,ee,se;let _e=cW[U];if(!_e)throw new Error(`Unhandled codec: ${U}`);let fe=new globalThis.DecompressionStream(_e);return new Response(new Blob([B]).stream().pipeThrough(fe)).arrayBuffer().then(we=>new Uint8Array(we))})(I,D).then(B=>((function(U,G){U.readFields(X7,G)})(new m2(B),R),new dW[v](R.buffer))),k.then(B=>{for(let U=S.length-1;U>=0;U--)switch(S[U]){case"delta_filter":K7(B,b);break;case"zigzag_filter":J7(B);break;case"bitshuffle_filter":Q7(B,v);break;default:throw new Ec(`Unhandled filter "${S[U]}"`)}return{layerName:d,blockIndex:w,data:B}}).catch(B=>{throw B})}))},Bt(l3,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Bt(cC,"MapboxRasterTile"),Bt(a3,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class c3{constructor(e){this._stringToNumber={},this._numberToString=[];for(let s=0;s<e.length;s++){let u=e[s];this._stringToNumber[u]=s,this._numberToString[s]=u}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class u3{constructor(e,s){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new _h(yt,16,0),this.featureIndexArray=new sw,this.promoteId=s,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,s,u,d,m,g=0,v=0){let b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,d,m,g);let w=this.grid;for(let S=0;S<s.length;S++){let D=s[S],I=[1/0,1/0,-1/0,-1/0];for(let R=0;R<D.length;R++){let k=D[R];I[0]=Math.min(I[0],k.x),I[1]=Math.min(I[1],k.y),I[2]=Math.max(I[2],k.x),I[3]=Math.max(I[3],k.y)}v!==0&&(I[0]-=v,I[1]-=v,I[2]+=v,I[3]+=v),I[0]<yt&&I[1]<yt&&I[2]>=0&&I[3]>=0&&w.insert(b,I[0],I[1],I[2],I[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new $t(new Bw(this.rawTileData)).layers,this.sourceLayerCoder=new c3(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,s){let{tilespaceGeometry:u,transform:d,tileTransform:m,pixelPosMatrix:g,availableImages:v,worldview:b}=s;this.loadVTLayers(),this.serializedLayersCache.clear();let w=s.queryRadius?s.queryRadius:0,S=u.bufferedTilespaceBounds,D=this.grid.query(S.min.x,S.min.y,S.max.x,S.max.y,(B,U,G,J)=>Sr(u.bufferedTilespaceGeometry,B-w,U-w,G+w,J+w));D.sort(hW);let I=null;d.elevation&&D.length>0&&(I=V_.create(d.elevation,this.tileID));let R={},k;for(let B=0;B<D.length;B++){let U=D[B];if(U===k)continue;k=U;let G=this.featureIndexArray.get(U),J=null;this.is3DTile?this.loadMatchingModelFeature(R,G,e,u,d,b):this.loadMatchingFeature(R,G,e,v,b,(ee,se,_e,fe=0)=>(J||(J=Je(ee,this.tileID.canonical,m)),se.queryIntersectsFeature(u,ee,_e,J,this.z,d,g,I,fe)))}return R}loadMatchingFeature(e,s,u,d,m,g){let{featureIndex:v,bucketIndex:b,sourceLayerIndex:w,layoutVertexArrayOffset:S}=s,D=this.bucketLayerIDs[b],I=u.layers,R=Object.keys(I);if(R.length&&!fn(R,D))return;let k=u.sourceCache,B=this.sourceLayerCoder.decode(w),U=this.vtLayers[B].feature(v),G=this.getId(U,B);for(let J=0;J<D.length;J++){let ee=D[J];if(!I[ee])continue;let{styleLayer:se,targets:_e}=I[ee],fe={};G!==void 0&&(fe=k.getFeatureState(se.sourceLayer,G));let we=!g||g(U,se,fe,S);if(!we)continue;let Ee=new Dm(U,this.z,this.x,this.y,G);Ee.tile=this.tileID.canonical,Ee.state=fe;let Se=this.serializedLayersCache.get(ee);Se||(Se=se.serialize(),Se.id=ee,this.serializedLayersCache.set(ee,Se)),Ee.source=Se.source,Ee.sourceLayer=Se["source-layer"],Ee.layer=Object.assign({},Se),Ee.layer.paint=d3(Se.paint,se.paint,U,fe,d),Ee.layer.layout=d3(Se.layout,se.layout,U,fe,d);let We=!1;for(let Fe of _e){this.updateFeatureProperties(Ee,Fe);let{filter:Ze}=Fe;if(Ze){if(U.properties=Ee.properties,Ze.needGeometry){let Qe=Ue(U,!0);if(!Ze.filter(new or(this.tileID.overscaledZ,{worldview:m}),Qe,this.tileID.canonical))continue}else if(!Ze.filter(new or(this.tileID.overscaledZ,{worldview:m}),U))continue}We=!0,Fe.targetId&&this.addFeatureVariant(Ee,Fe)}We&&this.appendToResult(e,ee,v,Ee,we)}}loadMatchingModelFeature(e,s,u,d,m,g){let{featureIndex:v,bucketIndex:b}=s,w=this.bucketLayerIDs[b],S=u.layers,D=Object.keys(S);if(!D.length||fn(D,w))for(let I=0;I<w.length;I++){let R=w[I],{styleLayer:k,targets:B}=S[R];if(k.type!=="model")continue;let U=d.tile,G=U.getBucket(k);if(!(G&&G instanceof nC))continue;let J=v7(G,v,d,m);if(!J)continue;let{z:ee,x:se,y:_e}=U.tileID.canonical,{feature:fe,intersectionZ:we,position:Ee}=J,Se={};fe.id!==void 0&&(Se=u.sourceCache.getFeatureState(k.sourceLayer,fe.id));let We=new Dm({},ee,se,_e,fe.id);We.tile=this.tileID.canonical,We.state=Se,We.properties=fe.properties,We.geometry={type:"Point",coordinates:[Ee.lng,Ee.lat]};let Fe=this.serializedLayersCache.get(R);Fe||(Fe=k.serialize(),Fe.id=R,this.serializedLayersCache.set(R,Fe)),We.source=Fe.source,We.sourceLayer=Fe["source-layer"],We.layer=Object.assign({},Fe);let Ze=!1;for(let Qe of B){this.updateFeatureProperties(We,Qe);let{filter:rt}=Qe;if(rt){if(fe.properties=We.properties,rt.needGeometry){if(!rt.filter(new or(this.tileID.overscaledZ,{worldview:g}),fe,this.tileID.canonical))continue}else if(!rt.filter(new or(this.tileID.overscaledZ,{worldview:g}),fe))continue}Ze=!0,Qe.targetId&&this.addFeatureVariant(We,Qe)}Ze&&this.appendToResult(e,R,v,We,we)}}updateFeatureProperties(e,s,u){if(s.properties){let d={};for(let m in s.properties){let g=s.properties[m].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,u);g!=null&&(d[m]=g)}e.properties=d}}addFeatureVariant(e,s,u){let d={target:s.target,namespace:s.namespace,uniqueFeatureID:s.uniqueFeatureID};s.properties&&(d.properties=e.properties),e.variants=e.variants||{},e.variants[s.targetId]=e.variants[s.targetId]||[],e.variants[s.targetId].push(d)}appendToResult(e,s,u,d,m){let g=e[s];g===void 0&&(g=e[s]=[]),g.push({featureIndex:u,feature:d,intersectionZ:m})}lookupSymbolFeatures(e,s,u,d,m,g){let v={};this.loadVTLayers();for(let b of e)this.loadMatchingFeature(v,{bucketIndex:s,sourceLayerIndex:u,featureIndex:b,layoutVertexArrayOffset:0},d,m,g);return v}loadFeature(e){let{featureIndex:s,sourceLayerIndex:u}=e;this.loadVTLayers();let d=this.sourceLayerCoder.decode(u),m=this.vtFeatures[d];if(m[s])return m[s];let g=this.vtLayers[d].feature(s);return m[s]=g,g}hasLayer(e){for(let s of this.bucketLayerIDs)for(let u of s)if(e===u)return!0;return!1}getId(e,s){let u=e.id;if(this.promoteId){let d=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[s];if(d!=null)if(Array.isArray(d)){if(!this.promoteIdExpression){let m=bc(d);if(m.result!=="success"){let g=m.value.map(v=>`${v.key}: ${v.message}`).join(", ");return void Gt(`Failed to create expression for promoteId: ${g}`)}this.promoteIdExpression=m.value}u=this.promoteIdExpression.evaluate({zoom:0},e)}else u=e.properties[d];typeof u=="boolean"&&(u=Number(u))}return u}}function d3(a,e,s,u,d){return ht(a,(m,g)=>{let v=e instanceof vh?e.get(g):null;return v&&v.evaluate?v.evaluate(s,u,void 0,d):v})}function hW(a,e){return e-a}Bt(u3,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});let h3=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class g2{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[s,u]=new Uint8Array(e,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");let d=u>>4;if(d!==1)throw new Error(`Got v${d} data when expected v1.`);let m=h3[15&u];if(!m)throw new Error("Unrecognized array type.");let[g]=new Uint16Array(e,2,1),[v]=new Uint32Array(e,4,1);return new g2(v,g,m,e)}constructor(e,s=64,u=Float64Array,d){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=u,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;let m=h3.indexOf(this.ArrayType),g=2*e*this.ArrayType.BYTES_PER_ELEMENT,v=e*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-v%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${u}.`);d&&d instanceof ArrayBuffer?(this.data=d,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+b,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+g+v+b),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+b,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=e)}add(e,s){let u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=e,this.coords[this._pos++]=s,u}finish(){let e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return _2(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,s,u,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:m,coords:g,nodeSize:v}=this,b=[0,m.length-1,0],w=[];for(;b.length;){let S=b.pop()||0,D=b.pop()||0,I=b.pop()||0;if(D-I<=v){for(let U=I;U<=D;U++){let G=g[2*U],J=g[2*U+1];G>=e&&G<=u&&J>=s&&J<=d&&w.push(m[U])}continue}let R=I+D>>1,k=g[2*R],B=g[2*R+1];k>=e&&k<=u&&B>=s&&B<=d&&w.push(m[R]),(S===0?e<=k:s<=B)&&(b.push(I),b.push(R-1),b.push(1-S)),(S===0?u>=k:d>=B)&&(b.push(R+1),b.push(D),b.push(1-S))}return w}within(e,s,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:d,coords:m,nodeSize:g}=this,v=[0,d.length-1,0],b=[],w=u*u;for(;v.length;){let S=v.pop()||0,D=v.pop()||0,I=v.pop()||0;if(D-I<=g){for(let U=I;U<=D;U++)p3(m[2*U],m[2*U+1],e,s)<=w&&b.push(d[U]);continue}let R=I+D>>1,k=m[2*R],B=m[2*R+1];p3(k,B,e,s)<=w&&b.push(d[R]),(S===0?e-u<=k:s-u<=B)&&(v.push(I),v.push(R-1),v.push(1-S)),(S===0?e+u>=k:s+u>=B)&&(v.push(R+1),v.push(D),v.push(1-S))}return b}}function _2(a,e,s,u,d,m){if(d-u<=s)return;let g=u+d>>1;f3(a,e,g,u,d,m),_2(a,e,s,u,g-1,1-m),_2(a,e,s,g+1,d,1-m)}function f3(a,e,s,u,d,m){for(;d>u;){if(d-u>600){let w=d-u+1,S=s-u+1,D=Math.log(w),I=.5*Math.exp(2*D/3),R=.5*Math.sqrt(D*I*(w-I)/w)*(S-w/2<0?-1:1);f3(a,e,s,Math.max(u,Math.floor(s-S*I/w+R)),Math.min(d,Math.floor(s+(w-S)*I/w+R)),m)}let g=e[2*s+m],v=u,b=d;for(px(a,e,u,s),e[2*d+m]>g&&px(a,e,u,d);v<b;){for(px(a,e,v,b),v++,b--;e[2*v+m]<g;)v++;for(;e[2*b+m]>g;)b--}e[2*u+m]===g?px(a,e,u,b):(b++,px(a,e,b,d)),b<=s&&(u=b+1),s<=b&&(d=b-1)}}function px(a,e,s,u){v2(a,s,u),v2(e,2*s,2*u),v2(e,2*s+1,2*u+1)}function v2(a,e,s){let u=a[e];a[e]=a[s],a[s]=u}function p3(a,e,s,u){let d=a-s,m=e-u;return d*d+m*m}o.$=gf,o.A=bl,o.B=yh,o.C=2,o.D=I_,o.E=ma,o.F=Yy,o.G=jL,o.H=mf,o.I=uo,o.J=ay,o.K=Zu,o.L=Xu,o.M=Jg,o.N=Kg,o.O=Zv,o.P=ct,o.Q=n_,o.R=$c,o.S=Of,o.T=II,o.U=bc,o.V=tC,o.W=Yv,o.X=Hi,o.Y=Ct,o.Z=_n,o._=as,o.a=function(a){return tr.API_CDN_URL_REGEX.test(a)},o.a$=Lf,o.a0=dn,o.a1=ff,o.a2=Rf,o.a3=class extends tC{},o.a4=Qg,o.a5=Wv,o.a6=ke,o.a7=function(a){let e=a.value;return e?dn(e)?r2(e,!0)?[]:[new tC(a.key,e,`invalid url "${e}"`)]:[new tC(a.key,e,`string expected, "${Zu(e)}" found`)]:[]},o.a8=X1,o.a9=Rr,o.aA=X,o.aB=ot,o.aC=Hr,o.aD=va,o.aE=jo,o.aF=K,o.aG=qe,o.aH=function(a,e){let s={};for(let u=0;u<e.length;u++){let d=e[u];d in a&&(s[d]=a[d])}return s},o.aI=O,o.aJ=Z,o.aK=class{constructor(a){this.entries={},this.scheduler=a}request(a,e,s,u){let d=this.entries[a]=this.entries[a]||{callbacks:[]};if(d.result){let[m,g]=d.result;return this.scheduler?this.scheduler.add(()=>{u(m,g)},e):u(m,g),()=>{}}return d.callbacks.push(u),d.cancel||(d.cancel=s((m,g)=>{d.result=[m,g];for(let v of d.callbacks)this.scheduler?this.scheduler.add(()=>{v(m,g)},e):v(m,g);setTimeout(()=>delete this.entries[a],3e3)})),()=>{d.result||(d.callbacks=d.callbacks.filter(m=>m!==u),d.callbacks.length||(d.cancel(),delete this.entries[a]))}}},o.aL=function(a,e,s){let u=JSON.stringify(a.request);return a.data&&(this.deduped.entries[u]={result:[null,a.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom},d=>{let m=Bu(a.request,(g,v,b)=>{g?d(g):v&&d(null,{vectorTile:s?void 0:new $t(new Bw(v)),rawData:v,responseHeaders:new Map(b.entries())})});return()=>{m.cancel(),d()}},e)},o.aM=function(a){return a?{cacheControl:a.get("Cache-Control"),expires:a.get("Expires")}:{cacheControl:void 0,expires:void 0}},o.aN=function(a){Hl++,Hl>js&&(a.getActor().send("enforceCacheSizeLimit",Jd),Hl=0)},o.aO=function(a){return a<=1?1:Math.pow(2,Math.floor(Math.log2(a)))},o.aP=ko,o.aQ=mN,o.aR=bN,o.aS=F,o.aT=pN,o.aU=function(a,e){let s=document.createElement("video");s.muted=!0,s.onloadstart=function(){e(null,s)};for(let u=0;u<a.length;u++){let d=document.createElement("source");si(a[u])||(s.crossOrigin="Anonymous"),d.src=a[u],s.appendChild(d)}return{cancel:()=>{}}},o.aV=Gy,o.aW=Im,o.aX=Ve,o.aY=ex,o.aZ=ae,o.a_=re,o.aa=pt,o.ab=class{constructor(a){this.specification=a}possiblyEvaluate(a,e){return Di(a.expression.evaluate(e))}interpolate(a,e,s){return{x:ln(a.x,e.x,s),y:ln(a.y,e.y,s),z:ln(a.z,e.z,s),azimuthal:ln(a.azimuthal,e.azimuthal,s),polar:ln(a.polar,e.polar,s)}}},o.ac=or,o.ad=rd,o.ae=Re,o.af=pr,o.ag=ai,o.ah=de,o.ai=vh,o.aj=qf,o.ak=ln,o.al=yt,o.am=oh,o.an=Wn,o.ao=Qn,o.ap=class{constructor(a){this.specification=a}possiblyEvaluate(a,e){return(function([s,u]){let d=Di([1,s,u]);return{x:d.x,y:d.y,z:d.z}})(a.expression.evaluate(e))}interpolate(a,e,s){return{x:ln(a.x,e.x,s),y:ln(a.y,e.y,s),z:ln(a.z,e.z,s)}}},o.aq=function(a,e,s=0,u=!0){let d=new ct(s,s),m=a.sub(d),g=e.add(d),v=[m,new ct(g.x,m.y),g,new ct(m.x,g.y)];return u&&v.push(m.clone()),v},o.ar=function(a,e){let s=[];for(let u=0;u<a.length;u++){let d=ye(u-1,-1,a.length-1),m=ye(u+1,-1,a.length-1),g=a[u],v=a[m],b=a[d].sub(g).unit(),w=v.sub(g).unit(),S=w.angleWithSep(b.x,b.y),D=b.add(w).unit().mult(-1*e/Math.sin(S/2));s.push(g.add(D))}return s},o.as=QL,o.at=Sr,o.au=function(a,e,s=0){return Fi(((e.x-s)*a.scale-a.x)*yt,(e.y*a.scale-a.y)*yt,ge(e.z,e.y))},o.av=Ur,o.aw=Li,o.ax=Mn,o.ay=fL,o.az=function(a){let e=1/0,s=1/0,u=-1/0,d=-1/0;for(let m of a)e=Math.min(e,m.x),s=Math.min(s,m.y),u=Math.max(u,m.x),d=Math.max(d,m.y);return{min:new ct(e,s),max:new ct(u,d)}},o.b=function(a){return tr.API_FONTS_REGEX.test(a)},o.b$=gI,o.b0=mr,o.b1=He,o.b2=iw,o.b3=Kw,o.b4=function(){Fa.isLoading()||Fa.isLoaded()||ry()!=="deferred"||oy()},o.b5=l_,o.b6=Ue,o.b7=Dm,o.b8=Yr,o.b9=LI,o.bA=Vn,o.bB=ze,o.bC=function(a,e){let{x:s,y:u}=a.point,d=Ok(s,u,a.worldSize/a._pixelsPerMercatorPixel,0,0);return ot(d,d,iI(dd(e)))},o.bD=L,o.bE=co,o.bF=Nu,o.bG=Do,o.bH=Ro,o.bI=Vr,o.bJ=L_,o.bK=sl,o.bL=$I,o.bM=function(a,e,s,u,d){let m=5*e+2;a.float32[m+0]=s,a.float32[m+1]=u,a.float32[m+2]=d},o.bN=j_,o.bO=jc,o.bP=Sa,o.bQ=Wa,o.bR=lf,o.bS=ye,o.bT=function(a,e,s,u){var d=new A(4);return d[0]=a,d[1]=e,d[2]=s,d[3]=u,d},o.bU=class{isDataAvailableAtPoint(a){let e=this._source();if(this.isUsingMockSource()||!e||a.y<0||a.y>1)return!1;let s=e.getSource().maxzoom,u=1<<s,d=Math.floor(a.x),m=Math.floor((a.x-d)*u),g=Math.floor(a.y*u),v=this.findDEMTileFor(new ko(s,d,s,m,g));return!(!v||!v.dem)}getAtPointOrZero(a,e=0){return this.getAtPoint(a,e)||0}getAtPoint(a,e,s=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);let u=this._source();if(!u||a.y<0||a.y>1)return e;let d=u.getSource().maxzoom,m=1<<d,g=Math.floor(a.x),v=a.x-g,b=new ko(d,g,d,Math.floor(v*m),Math.floor(a.y*m)),w=this.findDEMTileFor(b);if(!w||!w.dem)return e;let S=w.dem,D=1<<w.tileID.canonical.z,I=(v*D-w.tileID.canonical.x)*S.dim,R=(a.y*D-w.tileID.canonical.y)*S.dim,k=Math.floor(I),B=Math.floor(R);return(s?this.exaggeration():1)*ln(ln(S.get(k,B),S.get(k,B+1),R-B),ln(S.get(k+1,B),S.get(k+1,B+1),R-B),I-k)}static getAtTileOffset(a,e,s,u){let d=1<<a.canonical.z;return u?u.pointElevation(e):s?s.getAtPointOrZero(new Re(a.wrap+(a.canonical.x+e.x/yt)/d,(a.canonical.y+e.y/yt)/d)):0}static getAtTileOffsetFunc(a,e,s,u){return(d,m,g)=>{let v=this.getAtTileOffset(a,d,m,g),b=u.upVector(a.canonical,d.x,d.y);return Ui(b,b,v*u.upVectorScale(a.canonical,e,s).metersToTile),b}}getForTilePoints(a,e,s,u){if(this.isUsingMockSource())return!1;let d=V_.create(this,a,u);return!!d&&(e.forEach(m=>{m[2]=this.exaggeration()*d.getElevationAt(m[0],m[1],s)}),!0)}getMinMaxForTile(a){if(this.isUsingMockSource())return null;let e=this.findDEMTileFor(a);if(!e||!e.dem)return null;let s=e.dem.tree,u=e.tileID,d=1<<a.canonical.z-u.canonical.z,m=a.canonical.x/d-u.canonical.x,g=a.canonical.y/d-u.canonical.y,v=0;for(let b=0;b<a.canonical.z-u.canonical.z&&!s.leaves[v];b++){m*=2,g*=2;let w=2*Math.floor(g)+Math.floor(m);v=s.childOffsets[v]+w,m%=1,g%=1}return{min:this.exaggeration()*s.minimums[v],max:this.exaggeration()*s.maximums[v]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(a,e,s){throw new Error("Pure virtual method called.")}pointCoordinate(a){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(a){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){let a=this.visibleDemTiles;if(a.length===0)return null;let e=!1,s=Number.MAX_VALUE,u=Number.MIN_VALUE;for(let d of a){let m=this.getMinMaxForTile(d.tileID);m&&(s=Math.min(s,m.min),u=Math.max(u,m.max),e=!0)}return e?{min:s,max:u}:null}},o.bV=Dw,o.bW=Gr,o.bX=Yo,o.bY=cF,o.bZ=wN,o.b_=fF,o.ba=fI,o.bb=Je,o.bc=_a,o.bd=g_,o.be=Sk,o.bf=wr,o.bg=S_,o.bh=n2,o.bi=function(a,e){let s=qf(e.zoom);if(s===0)return dd(a);let u=gw(a),d=nI(u),m=K(u.getWest())*e.worldSize,g=K(u.getEast())*e.worldSize,v=Z(u.getNorth())*e.worldSize,b=Z(u.getSouth())*e.worldSize,w=[m,v,0],S=[g,v,0],D=[m,b,0],I=[g,b,0],R=Tt([],e.globeMatrix);return pr(w,w,R),pr(S,S,R),pr(D,D,R),pr(I,I,R),d[0]=Eh(d[0],D,s),d[1]=Eh(d[1],I,s),d[2]=Eh(d[2],S,s),d[3]=Eh(d[3],w,s),kn.fromPoints(d)},o.bj=vw,o.bk=Tt,o.bl=My,o.bm=Eh,o.bn=xh,o.bo=N$,o.bp=rr,o.bq=kt,o.br=cC,o.bs=Bw,o.bt=Bu,o.bu=function(a,e){let s=[];for(let u in a)u in e||s.push(u);return s},o.bv=Ce,o.bw=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.bx=Vl,o.by=Ae,o.bz=Be,o.c=Xo,o.c$=function(a){return a*a*a*a*a},o.c0=UI,o.c1=WL,o.c2=XI,o.c3=g2,o.c4=Ui,o.c5=_l,o.c6=vs,o.c7=function(a,e,s){s*=.5;var u=e[0],d=e[1],m=e[2],g=e[3],v=Math.sin(s),b=Math.cos(s);return a[0]=u*b+d*v,a[1]=d*b-u*v,a[2]=m*b+g*v,a[3]=g*b-m*v,a},o.c8=Zr,o.c9=Or,o.cA=yi,o.cB=KF,o.cC=il,o.cD=Mk,o.cE=function(a,e,s,u,d,m,g,v,b){if(b.name==="globe")return Mk(a,e,new il(s,u,d),!1);let w=ex({z:s,x:u,y:d},b);return new kn([(m+w.x/w.scale)*e,e*(w.y/w.scale),g],[(m+w.x2/w.scale)*e,e*(w.y2/w.scale),v])},o.cF=function(a,e,s){return a[0]=Math.min(e[0],s[0]),a[1]=Math.min(e[1],s[1]),a[2]=Math.min(e[2],s[2]),a[3]=Math.min(e[3],s[3]),a},o.cG=function(a,e,s){return a[0]=Math.max(e[0],s[0]),a[1]=Math.max(e[1],s[1]),a[2]=Math.max(e[2],s[2]),a[3]=Math.max(e[3],s[3]),a},o.cH=function(a){let e=Math.round((a+45+360)%360/90)%4;return Zd[e]},o.cI=ce,o.cJ=jl,o.cK=r,o.cL=function(a){let e=Be(new Float64Array(16));ot(e,a.pixelMatrix,a.globeMatrix);let s=[0,y,0],u=[0,x,0];return pr(s,s,e),pr(u,u,e),[s[0]>0&&s[0]<=a.width&&s[1]>0&&s[1]<=a.height&&!oI(a,new F(a.center.lat,90)),u[0]>0&&u[0]<=a.width&&u[1]>0&&u[1]<=a.height&&!oI(a,new F(a.center.lat,-90))]},o.cM=function(a,e){let{scale:s}=a.tileTransform,u=s*yt/(a.tileSize*Math.pow(2,e.zoom-a.tileID.overscaledZ+a.tileID.canonical.z));return(function(d,m,g){var v=m[1],b=m[2],w=m[3],S=g[0],D=g[1];return d[0]=m[0]*S,d[1]=v*S,d[2]=b*D,d[3]=w*D,d})(new Float32Array(4),e.inverseAdjustmentMatrix,[u,u])},o.cN=Rw,o.cO=Qi,o.cP=YF,o.cQ=function(a){let e=YF(a,!0);return L([],[e[0],e[1],e[4],e[5]])},o.cR=Cn,o.cS=Ii,o.cT=Xn,o.cU=function(a){let{x:e,y:s}=a.point,{lng:u,lat:d}=a._center;return Ok(e,s,a.worldSize,u,d)},o.cV=ks,o.cW=zo,o.cX=rl,o.cY=qr,o.cZ=f,o.c_=function(a,e,s){let u=0;for(let d=0;d<2;++d)a[d]>0&&(u+=(a[d]-0)*(a[d]-0)),e[d]<0&&(u+=(0-e[d])*(0-e[d]));return u},o.ca=function(a,e){return a[0]=-e[0],a[1]=-e[1],a[2]=-e[2],a[3]=e[3],a},o.cb=$n,o.cc=function(a,e,s,u,d){var m=1/Math.tan(e/2);if(a[0]=m/s,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=m,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,d!=null&&d!==1/0){var g=1/(u-d);a[10]=(d+u)*g,a[14]=2*d*u*g}else a[10]=-1,a[14]=-2*u;return a},o.cd=function(a,e,s,u,d,m,g){var v=1/(e-s),b=1/(u-d),w=1/(m-g);return a[0]=-2*v,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*b,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*w,a[11]=0,a[12]=(e+s)*v,a[13]=(d+u)*b,a[14]=(g+m)*w,a[15]=1,a},o.ce=Q,o.cf=function(a,e,s){a[4*e+0]=s[0],a[4*e+1]=s[1],a[4*e+2]=s[2],a[4*e+3]=s[3]},o.cg=w_,o.ch=Uf,o.ci=io,o.cj=wc,o.ck=ym,o.cl=rN,o.cm=function(){var a=new A(4);return A!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a},o.cn=function(a,e,s){var u=e[0],d=e[1],m=e[2],g=e[3],v=Math.sin(s),b=Math.cos(s);return a[0]=u*b+m*v,a[1]=d*b+g*v,a[2]=u*-v+m*b,a[3]=d*-v+g*b,a},o.co=function(a,e){return a[0]===e[0]&&a[1]===e[1]&&a[2]===e[2]&&a[3]===e[3]},o.cp=Wo,o.cq=function(a){var e=a[0],s=a[1],u=a[2],d=a[3];return Math.sqrt(e*e+s*s+u*u+d*d)},o.cr=No,o.cs=ua,o.ct=Cc,o.cu=3,o.cv=2,o.cw=7,o.cx=6,o.cy=hc,o.cz=Rt,o.d=function(a){return tr.API_TILEJSON_REGEX.test(a)},o.d$=Fk,o.d0=H,o.d1=45,o.d2=vm,o.d3=function(a,e,s){let u=Math.sqrt(a*a+e*e+s*s),d=u>0?Math.acos(s/u)*Wd:0,m=a!==0||e!==0?Math.atan2(-e,-a)*Wd+90:0;return m<0&&(m+=360),[u,m,d]},o.d4=Fi,o.d5=Di,o.d6=xe,o.d7=Pr,o.d8=kn,o.d9=Oo,o.dA=Ty,o.dB=class extends Dl{constructor(a){super(a),this.current=YD}set(a,e,s){if(this.fetchUniformLocation(a,e)){for(let u=0;u<9;u++)if(s[u]!==this.current[u]){this.current=s,this.gl.uniformMatrix3fv(this.location,!1,s);break}}}},o.dC=Xd,o.dD=function(a,e,s){let u=qf(s.zoom),d=a.style.map._antialias,m=a.terrain&&a.terrain.exaggeration()>0;return u===0&&!d&&!m},o.dE=function(a){let e=a.pixelsPerMeter,s=e/Q(1,a.center.lat),u=Be(new Float64Array(16));return kt(u,u,[a.point.x,a.point.y,0]),Cn(u,u,[s,s,e]),Float32Array.from(u)},o.dF=gw,o.dG=function(a){let e=ce-5;a=X(a,-e,e)/e*90;let s=Math.pow(Math.abs(Math.sin(Wn(a))),3);return Math.round(s*(_.length-1))},o.dH=function(a,e,s,u){let d=e.getNorth(),m=e.getSouth(),g=e.getWest(),v=e.getEast(),b=1<<a.z,w=v-g,S=d-m,D=w/p,I=-S/_[s],R=[0,D,0,I,0,0,d,g,0];if(a.z>0){let k=180/u;te(R,R,[k/w+1,0,0,0,k/S+1,0,-.5*k/D,.5*k/I,1])}return R[2]=b,R[5]=a.x,R[8]=a.y,R},o.dI=dd,o.dJ=function(a,e,s){let u=Be(new Float64Array(16)),d=(e/(1<<a)-.5)*Math.PI*2;return On(u,s.globeMatrix,d),Float32Array.from(u)},o.dK=Gk,o.dL=mw,o.dM=function(a,e){return[Math.pow(a[0],2.2)*e,Math.pow(a[1],2.2)*e,Math.pow(a[2],2.2)*e]},o.dN=Y,o.dO=function(a,e){var s=Math.sin(e),u=Math.cos(e);return a[0]=u,a[1]=s,a[2]=0,a[3]=-s,a[4]=u,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},o.dP=qa,o.dQ=Pk,o.dR=er,o.dS=vr,o.dT=256,o.dU=function(a,e){let s=[0,0,0];return pr(s,s,vw(dd(e.canonical))),pr(s,s,a),s},o.dV=a=>({u_matrix:new ym(a),u_texsize:new wc(a),u_pixels_to_tile_units:new Sy(a),u_device_pixel_ratio:new io(a),u_width_scale:new io(a),u_floor_width_scale:new io(a),u_image:new w_(a),u_units_to_pixels:new wc(a),u_tile_units_to_pixels:new io(a),u_alpha_discard_threshold:new io(a),u_trim_offset:new wc(a),u_trim_fade_range:new wc(a),u_trim_color:new vm(a),u_emissive_strength:new io(a),u_zbias_factor:new io(a),u_tile_to_meter:new io(a),u_ground_shadow_factor:new Uf(a),u_pattern_transition:new io(a)}),o.dW=a=>({u_matrix:new ym(a),u_pixels_to_tile_units:new Sy(a),u_device_pixel_ratio:new io(a),u_width_scale:new io(a),u_floor_width_scale:new io(a),u_units_to_pixels:new wc(a),u_dash_image:new w_(a),u_gradient_image:new w_(a),u_image_height:new io(a),u_texsize:new wc(a),u_tile_units_to_pixels:new io(a),u_alpha_discard_threshold:new io(a),u_trim_offset:new wc(a),u_trim_fade_range:new wc(a),u_trim_color:new vm(a),u_emissive_strength:new io(a),u_zbias_factor:new io(a),u_tile_to_meter:new io(a),u_ground_shadow_factor:new Uf(a)}),o.dX=a=>({u_camera_to_center_distance:new io(a),u_extrude_scale:new Sy(a),u_device_pixel_ratio:new io(a),u_matrix:new ym(a),u_inv_rot_matrix:new ym(a),u_merc_center:new wc(a),u_tile_id:new Uf(a),u_zoom_transition:new io(a),u_up_dir:new Uf(a),u_emissive_strength:new io(a)}),o.dY=zf,o.dZ=Eq,o.d_=class{constructor(a,e,s,u){this.context=a,this.format=u,this.size=s,this.texture=a.gl.createTexture();let[d,m,g]=this.size,{gl:v}=a;v.bindTexture(v.TEXTURE_3D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in e&&e.data&&v.texImage3D(v.TEXTURE_3D,0,this.format,d,m,g,0,SI(this.format),DI(this.format),e.data)}bind(a,e){let{context:s}=this,{gl:u}=s;u.bindTexture(u.TEXTURE_3D,this.texture),a!==this.minFilter&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MAG_FILTER,a),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MIN_FILTER,a),this.minFilter=a),e!==this.wrapS&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_S,e),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){let{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}},o.da=function(a){return[Math.pow(a[0],1/2.2),Math.pow(a[1],1/2.2),Math.pow(a[2],1/2.2)]},o.db=XF,o.dc=kI,o.dd=eL,o.de=r2,o.df=function(a,e){return a.readFields(b7,{icons:[]},e)},o.dg=Mw,o.dh=N_,o.di=qI,o.dj=Up,o.dk=Z1,o.dl=Yd,o.dm=ju,o.dn=Ht,o.dp=function(a){let e=a.indexOf(hm);return e>=0?a.slice(0,e):a},o.dq=function(a){return a.indexOf(hm)>=0},o.dr=function(a){let e=a.lastIndexOf(hm);return e>=0?a.slice(e+1):""},o.ds=function(a){let e=[],s=a.id;return s===void 0&&e.push({message:`layers.${s}: missing required property "id"`}),a.render===void 0&&e.push({message:`layers.${s}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&e.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),e},o.dt=function(a,e,s,u){return a.type==="custom"?new p7(a,e):new y7[a.type](a,e,s,u)},o.du=st,o.dv=function(a){let e=a.indexOf(hm);return e>=0?a.slice(e+1):""},o.dw=class extends Dm{constructor(a,e){super(a._vectorTileFeature,a._z,a._x,a._y,a.id),a.state&&(this.state=Object.assign({},a.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=a.source,this.sourceLayer=a.sourceLayer,this.layer=a.layer)}toJSON(){let a=super.toJSON();return a.target=this.target,a.namespace=this.namespace,a}},o.dx=iy,o.dy=xl,o.dz=function(a){return a({pluginStatus:Ks,pluginURL:ad}),iy.on("pluginStateChange",a),a},o.e=tr,o.e$=function([a,e,s]){let u=Math.hypot(a,e,s),d=Math.atan2(a,s),m=.5*Math.PI-Math.acos(-e/u);return new F(zo(d),zo(m))},o.e0=(a,e,s,u,d,m)=>{let g=a.transform,v=g.projection.name==="globe",b;if(m.paint.get("circle-pitch-alignment")==="map")if(v){let S=Pk(g.zoom,e.canonical)*g._pixelsPerMercatorPixel;b=Float32Array.from([S,0,0,S])}else b=g.calculatePixelsToTileUnitsMatrix(s);else b=new Float32Array([g.pixelsToGLUnits[0],0,0,g.pixelsToGLUnits[1]]);let w={u_camera_to_center_distance:a.transform.getCameraToCenterDistance(g.projection),u_matrix:a.translatePosMatrix(e.projMatrix,s,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Zs.devicePixelRatio,u_extrude_scale:b,u_inv_rot_matrix:U$,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:m.paint.get("circle-emissive-strength")};if(v){w.u_inv_rot_matrix=u,w.u_merc_center=d,w.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],w.u_zoom_transition=qf(g.zoom);let S=d[0]*yt,D=d[1]*yt;w.u_up_dir=g.projection.upVector(new il(0,0,0),S,D)}return w},o.e1=_L,o.e2=xs,o.e3=(a,e,s,u,d,m,g,v,b,w)=>{let S=a.transform,D=S.pitch<15?pL(.07,.7,X((14-S.zoom)/5,0,1)):.07,I=s.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:gL(a,e,s,u),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:S.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:d,u_width_scale:m,u_floor_width_scale:g,u_image:0,u_tile_units_to_pixels:mL(e,S),u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:v,u_trim_fade_range:s.paint.get("line-trim-fade-range"),u_trim_color:s.paint.get("line-trim-color").toPremultipliedRenderColor(I?null:s.lut).toArray01(),u_emissive_strength:s.paint.get("line-emissive-strength"),u_zbias_factor:D,u_tile_to_meter:xe(e.tileID.canonical,0),u_ground_shadow_factor:b,u_pattern_transition:w}},o.e4=(a,e,s,u,d,m,g,v,b,w)=>{let S=a.transform,D=S.calculatePixelsToTileUnitsMatrix(e),I=s.paint.get("line-trim-color-use-theme").constantOr("default")==="none",R=S.pitch<15?pL(.07,.7,X((14-S.zoom)/5,0,1)):.07;return{u_matrix:gL(a,e,s,u),u_pixels_to_tile_units:D,u_device_pixel_ratio:m,u_width_scale:g,u_floor_width_scale:v,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:d,u_texsize:vL(s)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:mL(e,a.transform),u_alpha_discard_threshold:0,u_trim_offset:b,u_trim_fade_range:s.paint.get("line-trim-fade-range"),u_trim_color:s.paint.get("line-trim-color").toPremultipliedRenderColor(I?null:s.lut).toArray01(),u_emissive_strength:s.paint.get("line-emissive-strength"),u_zbias_factor:R,u_tile_to_meter:xe(e.tileID.canonical,0),u_ground_shadow_factor:w}},o.e5=Pe,o.e6=Ay,o.e7=ge,o.e8=Ch,o.e9=Sw,o.eA=a2,o.eB=Lw,o.eC=Fw,o.eD=[1,1,1],o.eE=V_,o.eF=Ls,o.eG=function(a,e,s,u){var d=e[0],m=e[1],g=e[2],v=e[3];return a[0]=d+u*(s[0]-d),a[1]=m+u*(s[1]-m),a[2]=g+u*(s[2]-g),a[3]=v+u*(s[3]-v),a},o.eH=O_,o.eI=Sl,o.eJ=ud,o.eK=function(a,e,s,u,d,m,g,v,b,w,S,D,I,R,k,B){var U=new A(16);return U[0]=a,U[1]=e,U[2]=s,U[3]=u,U[4]=d,U[5]=m,U[6]=g,U[7]=v,U[8]=b,U[9]=w,U[10]=S,U[11]=D,U[12]=I,U[13]=R,U[14]=k,U[15]=B,U},o.eL=M,o.eM=vy,o.eN=pm,o.eO=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new ct(1/0,1/0),max:new ct(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(a,e=!1){let s=dF(new ct(0,0),new ct(yt,yt),a),u=[];if(e&&!pI(s,this._globalClipBounds))return u;for(let d of this._activeRegions){if(d.hiddenByOverlap||!pI(s,d))continue;let m=_G(d.min,d.max,a);u.push({min:m.min,max:m.max,sourceId:this._sourceIds[d.priority],footprint:d.footprint,footprintTileId:d.tileId,order:d.order,clipMask:d.clipMask,clipScope:d.clipScope})}return u}setSources(a){this._setSources(a.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{let s=[];for(let u of e.cache.getVisibleCoordinates()){let d=e.cache.getTile(u).buckets[e.layer];d&&d.updateFootprints(u.toUnwrapped(),s)}return s},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(a){let e=a.getFootprints();if(e.length===0)return;let s=a.getOrder(),u=a.getClipMask(),d=a.getClipScope();for(let m of e){if(!m.footprint)continue;let g=dF(m.footprint.min,m.footprint.max,m.id);this._activeRegions.push({min:g.min,max:g.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:m.id,footprint:m.footprint,order:s,clipMask:u,clipScope:d})}this._sourceIds.push(a.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,s)=>e.priority-s.priority||Cw(e.min,s.min)||Cw(e.max,s.max)||e.order-s.order||e.clipMask-s.clipMask||(function(u,d){let m=(g,v)=>g+v;return u.length-d.length||u.reduce(m,"").localeCompare(d.reduce(m,""))})(e.clipScope,s.clipScope));let a=this._activeRegions.length!==this._prevRegions.length;if(!a){let e=0;for(;!a&&e!==this._activeRegions.length;){let s=this._activeRegions[e],u=this._prevRegions[e];a=s.priority!==u.priority||!uF(s,u)||s.order!==u.order||s.clipMask!==u.clipMask||!Vl(s.clipScope,u.clipScope),this._activeRegions[e].hiddenByOverlap=u.hiddenByOverlap,++e}}if(a){++this._updateTime;for(let s of this._activeRegions)s.order!==Ly&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,s.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,s.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,s.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,s.max.y));let e=s=>{let u=this._activeRegions;if(s>=u.length)return s;let d=u[s].priority;for(;s<u.length&&u[s].priority===d;)++s;return s};if(this._sourceIds.length>1){let s=0,u=e(s);for(;s!==u;){let d=s,m=s;for(;d!==u;){let g=this._activeRegions[d];g.hiddenByOverlap=!1;for(let v=0;v<m;v++){let b=this._activeRegions[v];if(!b.hiddenByOverlap&&g.order===Ly&&pI(g,b)&&(g.hiddenByOverlap=hF(g.footprint,g.tileId,b.footprint,b.tileId),g.hiddenByOverlap))break}++d}s=u,u=e(s)}}}}_setSources(a){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=a.length-1;e>=0;e--)this._addSource(a[e]);this._computeReplacement()}},o.eP=Ly,o.eQ=class{constructor(a){this._createGrid(a),this._createPoles(a)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let a of this._poleSegments)a.destroy();for(let a of this._gridSegments)a.withSkirts.destroy(),a.withoutSkirts.destroy()}_fillGridMeshWithLods(a,e){let s=new _a,u=new mr,d=[],m=a+1+2,g=e[0]+1,v=e[0]+1+(1+e.length),b=(w,S,D)=>{let I=w===m-1?w-2:w===0?w:w-1;return I+=D?24575:0,[I,S]};for(let w=0;w<m;++w)s.emplaceBack(...b(w,0,!0));for(let w=0;w<g;++w)for(let S=0;S<m;++S)s.emplaceBack(...b(S,w,(S===0||S===m-1)&&!0));for(let w=0;w<e.length;++w){let S=e[w];for(let D=0;D<m;++D)s.emplaceBack(...b(D,S,!0))}for(let w=0;w<e.length;++w){let S=u.length,D=e[w]+1+2,I=new mr;for(let B=0;B<D-1;B++){let U=B===D-2,G=U?m*(v-e.length+w-B):m;for(let J=0;J<m-1;J++){let ee=B*m+J;B===0||U||J===0||J===m-2?(I.emplaceBack(ee+1,ee,ee+G),I.emplaceBack(ee+G,ee+G+1,ee+1)):(u.emplaceBack(ee+1,ee,ee+G),u.emplaceBack(ee+G,ee+G+1,ee+1))}}let R=wr.simpleSegment(0,S,s.length,u.length-S);for(let B=0;B<I.uint16.length;B+=3)u.emplaceBack(I.uint16[B],I.uint16[B+1],I.uint16[B+2]);let k=wr.simpleSegment(0,S,s.length,u.length-S);d.push({withoutSkirts:R,withSkirts:k})}return{vertices:s,indices:u,segments:d}}_createGrid(a){let e=this._fillGridMeshWithLods(p,_);this._gridSegments=e.segments,this._gridBuffer=a.createVertexBuffer(e.vertices,Sk.members),this._gridIndexBuffer=a.createIndexBuffer(e.indices,!0)}_createPoles(a){let e=new mr;for(let g=0;g<=p;g++)e.emplaceBack(0,g+1,g+2);this._poleIndexBuffer=a.createIndexBuffer(e,!0);let s=new wh,u=new wh,d=new wh,m=new wh;this._poleSegments=[];for(let g=0,v=0;g<f;g++){let b=360/(1<<g);s.emplaceBack(0,-va,0,.5,0),u.emplaceBack(0,-va,0,.5,1),d.emplaceBack(0,-va,0,.5,.5),m.emplaceBack(0,-va,0,.5,.5);for(let w=0;w<=p;w++){let S=w/p,D=0,I=ln(0,b,S),[R,k,B]=C(j$,V$,I,va);s.emplaceBack(R,k,B,S,D),u.emplaceBack(R,k,B,S,1-D);let U=Wn(I);S=.5+.5*Math.sin(U),D=.5+.5*Math.cos(U),d.emplaceBack(R,k,B,S,D),m.emplaceBack(R,k,B,S,1-D)}this._poleSegments.push(wr.simpleSegment(v,0,66,64)),v+=66}this._poleNorthVertexBuffer=a.createVertexBuffer(s,T_,!1),this._poleSouthVertexBuffer=a.createVertexBuffer(u,T_,!1),this._texturedPoleNorthVertexBuffer=a.createVertexBuffer(d,T_,!1),this._texturedPoleSouthVertexBuffer=a.createVertexBuffer(m,T_,!1)}getGridBuffers(a,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[a].withSkirts:this._gridSegments[a].withoutSkirts]}getPoleBuffers(a,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[a]]}},o.eR=lF,o.eS=Oe,o.eT=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},o.eU=q,o.eV=he,o.eW=function(a,e,s){return a[0]=e[0]/s[0],a[1]=e[1]/s[1],a[2]=e[2]/s[2],a},o.eX=os,o.eY=T,o.eZ=Bl,o.e_=Wi,o.ea=DF,o.eb=Zf,o.ec=_F,o.ed=gF,o.ee=me,o.ef=function(a,e){if(a===e){var s=e[1],u=e[2],d=e[3],m=e[6],g=e[7],v=e[11];a[1]=e[4],a[2]=e[8],a[3]=e[12],a[4]=s,a[6]=e[9],a[7]=e[13],a[8]=u,a[9]=m,a[11]=e[14],a[12]=d,a[13]=g,a[14]=v}else a[0]=e[0],a[1]=e[4],a[2]=e[8],a[3]=e[12],a[4]=e[1],a[5]=e[5],a[6]=e[9],a[7]=e[13],a[8]=e[2],a[9]=e[6],a[10]=e[10],a[11]=e[14],a[12]=e[3],a[13]=e[7],a[14]=e[11],a[15]=e[15];return a},o.eg=f7,o.eh=Bn,o.ei=xy,o.ej=256,o.ek=iI,o.el=Qa,o.em=On,o.en=function(a,e){return a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[4],a[4]=e[5],a[5]=e[6],a[6]=e[8],a[7]=e[9],a[8]=e[10],a},o.eo=wh,o.ep=_y,o.eq=j1,o.er=function(a,e,s,u,d){return X((a-e)/(s-e)*(d-u)+u,u,d)},o.es=vo,o.et=function(a,e){var s=e[0],u=e[1],d=e[2],m=e[3],g=e[4],v=e[5],b=e[6],w=e[7],S=e[8],D=S*g-v*w,I=-S*m+v*b,R=w*m-g*b,k=s*D+u*I+d*R;return k?(a[0]=D*(k=1/k),a[1]=(-S*u+d*w)*k,a[2]=(v*u-d*g)*k,a[3]=I*k,a[4]=(S*s-d*b)*k,a[5]=(-v*s+d*m)*k,a[6]=R*k,a[7]=(-w*s+u*b)*k,a[8]=(g*s-u*m)*k,a):null},o.eu=2,o.ev=Ga,o.ew=Ns,o.ex=Er,o.ey=function(a,e){var s=new A(3);Er(s,e);var u=1/s[0],d=1/s[1],m=1/s[2],g=e[0]*u,v=e[1]*d,b=e[2]*m,w=e[4]*u,S=e[5]*d,D=e[6]*m,I=e[8]*u,R=e[9]*d,k=e[10]*m,B=g+S+k,U=0;return B>0?(U=2*Math.sqrt(B+1),a[3]=.25*U,a[0]=(D-R)/U,a[1]=(I-b)/U,a[2]=(v-w)/U):g>S&&g>k?(U=2*Math.sqrt(1+g-S-k),a[3]=(D-R)/U,a[0]=.25*U,a[1]=(v+w)/U,a[2]=(I+b)/U):S>k?(U=2*Math.sqrt(1+S-g-k),a[3]=(I-b)/U,a[0]=(v+w)/U,a[1]=.25*U,a[2]=(D+R)/U):(U=2*Math.sqrt(1+k-g-S),a[3]=(v-w)/U,a[0]=(I+b)/U,a[1]=(D+R)/U,a[2]=.25*U),a},o.ez=function(a,e){var s=2*Math.acos(e[3]),u=Math.sin(s/2);return u>E?(a[0]=e[0]/u,a[1]=e[1]/u,a[2]=e[2]/u):(a[0]=1,a[1]=0,a[2]=0),s},o.f=function(a){return btoa(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g,(e,s)=>String.fromCharCode(+("0x"+s))))},o.f0=lr,o.f1=MI,o.f2=function(a){let e=a.navigator?a.navigator.userAgent:null;return!!(function(s){if(Fr==null){let u=s.navigator?s.navigator.userAgent:null;Fr=!!s.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return Fr})(a)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},o.f3=function(a,e){Jd=a,js=e},o.f4=oI,o.f5=Rk,o.f6=function(a){let e=[0,0,0],s=Be(new Float64Array(16));return ot(s,a.pixelMatrix,a.globeMatrix),pr(e,e,s),new ct(e[0],e[1])},o.f7=function(){let a=Uy;a&&(a.isPreloaded()&&a.numActive()===1?(a.release(bI),Uy=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},o.f8=function(){Mw().acquire(bI)},o.f9=ry,o.fA=at,o.fB=function(a){let e=0;if(new Uint32Array(a,0,1)[0]!==$F){let s=new Uint32Array(a,0,7),[,,u,d,m,g]=s;e=s.byteLength+d+m+g+m,(u!==a.byteLength||e>=a.byteLength)&&Gt("Invalid b3dm header information.")}return ZF(a,e)},o.fC=function(a,e){let s=kI(a);for(let u of s){for(let d of u.meshes)ZG(d);u.lights&&(u.lightMeshIndex=u.meshes.length,u.meshes.push(XG(u.lights,e)))}return s},o.fD=nC,o.fE=_r,o.fF=BF,o.fG=Fa,o.fH=ka,o.fI=function(a){Hc(),ys?.then(e=>{e.keys().then(s=>{for(let u=0;u<s.length-a;u++)e.delete(s[u]).catch(d=>Gt(d.message))}).catch(s=>Gt(s.message))}).catch(e=>Gt(e.message))},o.fa=function(a,e,s=!1){if(Ks===ka.deferred||Ks===ka.loading||Ks===ka.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");ad=Zs.resolveURL(a),Ks=ka.deferred,ty=e,ny(),s||oy()},o.fb=function(a){M_=Zs.resolveURL(a),A_||(A_=new I_(Mw(),new ma)),A_.broadcast("setMeshoptUrl",M_)},o.fc=UF,o.fd=function(a){CI=Zs.resolveURL(a),A_||(A_=new I_(Mw(),new ma)),A_.broadcast("setDracoUrl",CI)},o.fe=VF,o.ff=Vy,o.fg=function(a){let e=Ul();if(!e)return;let s=e.delete(Kd);a&&s.then(()=>a()).catch(a)},o.fh=Iw,o.fi=Bt,o.fj=Wf,o.fk=uu,o.fl=c3,o.fm=u3,o.fn=uL,o.fo=At,o.fp="hd_road_elevation",o.fq=vn,o.fr=ht,o.fs=Th,o.ft=GI,o.fu=Tm,o.fv=function(a,e,s,u,d,m,g,v=1,b,w,S){a.createArrays(),a.tilePixelRatio=yt/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;let D=a.layers[0].layout,I=a.layers[0]._unevaluatedLayout._values,R={};R.scaleFactor=v,R.textSizeScaleRange=D.get("text-size-scale-range"),R.iconSizeScaleRange=D.get("icon-size-scale-range");let[k,B]=R.textSizeScaleRange,[U,G]=R.iconSizeScaleRange;R.textScaleFactor=X(R.scaleFactor,k,B),R.iconScaleFactor=X(R.scaleFactor,U,G);let J=I["text-size"],ee=I["icon-size"];if(a.textSizeData.kind==="composite"){let{minZoom:Se,maxZoom:We}=a.textSizeData;R.compositeTextSizes=[J.possiblyEvaluate(new or(Se,{worldview:S}),m),J.possiblyEvaluate(new or(We,{worldview:S}),m)]}if(a.iconSizeData.kind==="composite"){let{minZoom:Se,maxZoom:We}=a.iconSizeData;R.compositeIconSizes=[ee.possiblyEvaluate(new or(Se,{worldview:S}),m),ee.possiblyEvaluate(new or(We,{worldview:S}),m)]}R.layoutTextSize=J.possiblyEvaluate(new or(g+1,{worldview:S}),m),R.layoutIconSize=ee.possiblyEvaluate(new or(g+1,{worldview:S}),m),R.textMaxSize=J.possiblyEvaluate(new or(18,{worldview:S}),m);let se=D.get("symbol-placement"),_e=D.get("text-rotation-alignment")==="map"&&se!=="point",fe=D.get("text-size"),we=!1,Ee=[];for(let Se of a.features){let We=D.get("text-font").evaluate(Se,{},m).join(","),Fe=fe.evaluate(Se,{},m)*R.textScaleFactor,Ze=R.layoutTextSize.evaluate(Se,{},m)*R.textScaleFactor,Qe=R.layoutIconSize.evaluate(Se,{},m)*R.iconScaleFactor,rt={horizontal:{},vertical:void 0},vt=Se.text,dt,et=[0,0];if(vt){let Nn=vt.toString(),ri=D.get("text-letter-spacing").evaluate(Se,{},m)*Yo,wn=D.get("text-line-height").evaluate(Se,{},m)*Yo,fi=q1(Nn)?ri:0,pi=D.get("text-anchor").evaluate(Se,{},m),xr=D.get("text-variable-anchor");if(!xr){let Ye=D.get("text-radial-offset").evaluate(Se,{},m);if(Ye)et=WL(pi,[Ye*Yo,ZI]);else{let Dt=D.get("text-offset").evaluate(Se,{},m);et=[Dt[0]*Yo,Dt[1]*Yo]}}let pe=_e?"center":D.get("text-justify").evaluate(Se,{},m),ue=se==="point",Xe=ue?D.get("text-max-width").evaluate(Se,{},m)*Yo:1/0,Et=Ye=>{a.allowVerticalPlacement&&Jv(Nn)&&(rt.vertical=VI(vt,e,s,d,We,Xe,wn,pi,Ye,fi,et,sl.vertical,!0,Ze,Fe,b))};if(!_e&&xr){let Ye=pe==="auto"?xr.map(Yt=>XI(Yt)):[pe],Dt=!1;for(let Yt=0;Yt<Ye.length;Yt++){let Xt=Ye[Yt];if(!rt.horizontal[Xt])if(Dt)rt.horizontal[Xt]=rt.horizontal[0];else{let En=VI(vt,e,s,d,We,Xe,wn,"center",Xt,fi,et,sl.horizontal,!1,Ze,Fe,b);En&&(rt.horizontal[Xt]=En,Dt=En.positionedLines.length===1)}}Et("left")}else{if(pe==="auto"&&(pe=XI(pi)),ue||D.get("text-writing-mode").indexOf("horizontal")>=0||!Jv(Nn)){let Ye=VI(vt,e,s,d,We,Xe,wn,pi,pe,fi,et,sl.horizontal,!1,Ze,Fe,b);Ye&&(rt.horizontal[pe]=Ye)}Et(ue?"left":pe)}}let ut,Ge,$e,lt,gt,it,Nt=!1,Ut=D.get("icon-text-fit").evaluate(Se,{},m);if(Se.icon&&Se.icon.hasPrimary()){let Nn=Jy(Se.icon,a.iconSizeData,I["icon-size"],m,a.zoom,Se,b,R.iconScaleFactor,S);ut=Nn.iconPrimary,$e=Nn.iconSecondary;let ri=ut.toString();if(Ge=u.get(ri),Ge&&(gt=D.get("icon-offset").evaluate(Se,{},m),it=D.get("icon-anchor").evaluate(Se,{},m),dt=Vw(d.get(ri),$e?d.get($e.toString()):void 0,gt,it),Nt=Ge.sdf,a.sdfIcons===void 0?a.sdfIcons=Ge.sdf:a.sdfIcons!==Ge.sdf&&Gt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ge.pixelRatio!==a.pixelRatio||D.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0)),$e){let wn=$e.toString();lt=u.get(wn)}}we=we||!(!Se.icon||!Se.icon.hasSecondary());let Pt=YI(rt.horizontal)||rt.vertical;a.iconsInText||(a.iconsInText=!!Pt&&Pt.iconsInText);let St=Ze*R.textScaleFactor/Yo,{defaultShapedIcon:yn,verticallyShapedIcon:It}=Qq(a,dt,D,Se,m,rt,St,gt,Ut);Ut!=="none"&&dt&&(OL(dt)||RL(dt))&&(qw(0,Ge,ut,dt,yn,Ut,w,u,d),qw(0,lt,$e,dt,yn,Ut,w,u,d),It&&(qw(0,Ge,ut,dt,It,Ut,w,u,d),qw(0,lt,$e,dt,It,Ut,w,u,d))),dt=yn;let{iconBBox:rn,iconVerticalBBox:xn}=Yq(a,dt,It,D,Se,m,Qe,gt,R,d,it);Ee.push({feature:Se,shapedTextOrientations:rt,shapedText:Pt,shapedIcon:dt,iconPrimary:ut,iconSecondary:$e,iconOffset:gt,iconAnchor:it,verticallyShapedIcon:It,layoutTextSize:Ze,layoutIconSize:Qe,textOffset:et,isSDFIcon:Nt,iconTextFit:Ut,iconCollisionBounds:rn,iconVerticalCollisionBounds:xn})}return{featureData:Ee,sizes:R,hasAnySecondaryIcon:we,textAlongLine:_e,symbolPlacement:se}},o.fw=VL,o.fx=function(a,e,s,u,d,m,g,v,b,w){a.iconAtlasPositions=w.iconPositions;let{featureData:S,hasAnySecondaryIcon:D,sizes:I,textAlongLine:R,symbolPlacement:k}=e;for(let B of S){let{shapedIcon:U,verticallyShapedIcon:G,feature:J,shapedTextOrientations:ee,shapedText:se,layoutTextSize:_e,textOffset:fe,isSDFIcon:we,iconPrimary:Ee,iconSecondary:Se,iconTextFit:We,iconOffset:Fe,iconCollisionBounds:Ze,iconVerticalCollisionBounds:Qe}=B;XL(U,w.iconPositions,Ee,Se),XL(G,w.iconPositions,Ee,Se),Jq(ee,w.iconPositions),Kq(Ee,Se,w.iconPositions),(se||U)&&e7(a,J,ee,U,G,b,I,_e,0,fe,we,u,d,g,v,D,We,Fe,R,k,Ze,Qe)}s&&a.generateCollisionDebugBuffers(m,a.collisionBoxArray,I.textScaleFactor)},o.fy=$t,o.fz=lC,o.g=function(a,e){return xl(Object.assign(a,{method:"GET"}),e)},o.h=function(a){return a.indexOf("mapbox:")===0},o.i=function(a){return tr.API_STYLE_REGEX.test(a)&&!Xo(a)},o.j=oo,o.k=Qd,o.l=function(a){return decodeURIComponent(atob(a).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},o.m=function(a,e){return xl(Object.assign(a,{type:"json"}),e)},o.n=Hp,o.o=Zs,o.p=function(a,e){return xl(Object.assign(a,{method:"POST"}),e)},o.q=Cs,o.r=Bs,o.s=function(a){try{let e=self[a];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},o.t=function(){return wI||(wI=new Iw),wI},o.u=function(){return(function a(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)})()},o.v=function(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)},o.w=Gt,o.x=h2,o.y=Ma,o.z=pa}),l(["./shared"],function(o){function E(Oe){let q=Oe?Oe.url.toString():void 0;return q?performance.getEntriesByName(q):[]}function A(Oe){if(typeof Oe=="number"||typeof Oe=="boolean"||typeof Oe=="string"||Oe==null)return JSON.stringify(Oe);if(Array.isArray(Oe)){let X="[";for(let de of Oe)X+=`${A(de)},`;return`${X}]`}let q="{";for(let X of Object.keys(Oe).sort())q+=`${X}:${A(Oe[X])},`;return`${q}}`}function L(Oe){let q="";for(let X of o.bw)q+=`/${A(Oe[X])}`;return q}class Y{constructor(q){this.keyCache={},this._layers={},this._layerConfigs={},q&&this.replace(q)}replace(q,X){this._layerConfigs={},this._layers={},this.update(q,[],X)}update(q,X,de){this._options=de;for(let Ce of q)this._layerConfigs[Ce.id]=Ce,(this._layers[Ce.id]=o.dt(Ce,this.scope,null,this._options)).compileFilter(de),this.keyCache[Ce.id]&&delete this.keyCache[Ce.id];for(let Ce of X)delete this.keyCache[Ce],delete this._layerConfigs[Ce],delete this._layers[Ce];this.familiesBySource={};let ye=(function(Ce,De){let He={};for(let Ve=0;Ve<Ce.length;Ve++){let ht=Ce[Ve],st=De&&De[ht.id];st||(ht.type==="symbol"?st=ht.id:(st=L(ht),ht.type==="line"&&ht.paint&&(function fn(an){return typeof an=="string"&&an==="line-progress"||(Array.isArray(an)?an.some(fn):!(!an||typeof an!="object")&&Object.values(an).some(fn))})(ht.paint["line-width"])&&(st+=`/${A(ht.paint["line-width"])}`))),De&&(De[ht.id]=st);let Ht=He[st];Ht||(Ht=He[st]=[]),Ht.push(ht)}let Pe=[];for(let Ve in He)Pe.push(He[Ve]);return Pe})(Object.values(this._layerConfigs),this.keyCache);for(let Ce of ye){let De=Ce.map(Ht=>this._layers[Ht.id]),He=De[0];if(He.visibility==="none")continue;let Pe=He.source||"",Ve=this.familiesBySource[Pe];Ve||(Ve=this.familiesBySource[Pe]={});let ht=He.sourceLayer||"_geojsonTileLayer",st=Ve[ht];st||(st=Ve[ht]=[]),st.push(De)}}}let le=1*o.fk;class te{constructor(q){let X={},de=[];for(let He in q){let Pe=q[He],Ve=X[He]={};for(let ht in Pe.glyphs){let st=Pe.glyphs[+ht];if(!st||st.bitmap.width===0||st.bitmap.height===0)continue;let Ht=st.metrics.localGlyph?le:1,fn={x:0,y:0,w:st.bitmap.width+2*Ht,h:st.bitmap.height+2*Ht};de.push(fn),Ve[ht]=fn}}let{w:ye,h:Ce}=o.G(de),De=new o.fj({width:ye||1,height:Ce||1});for(let He in q){let Pe=q[He];for(let Ve in Pe.glyphs){let ht=Pe.glyphs[+Ve];if(!ht||ht.bitmap.width===0||ht.bitmap.height===0)continue;let st=X[He][Ve],Ht=ht.metrics.localGlyph?le:1;o.fj.copy(ht.bitmap,De,{x:0,y:0},{x:st.x+Ht,y:st.y+Ht},ht.bitmap)}}this.image=De,this.positions=X}}function ze(Oe,q,X){Oe[q]?X&&(Oe[q].center=X):Oe[q]={floorIds:new Set,center:X||[0,0],floors:{}}}function Ae(Oe,q,X,de){for(let ye of q)ze(Oe,ye),Oe[ye].floors[X]=de,Oe[ye].floorIds.add(X)}function Be(Oe){return{id:Oe.properties.id.toString(),center:Oe.properties.center.toString().split(";").map(Number)}}function Tt(Oe){return{id:Oe.properties.id.toString(),isDefault:!!Oe.properties.is_default&&Oe.properties.is_default,connections:Oe.properties.connected_floor_ids?new Set(Oe.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:Oe.properties.conflicted_floor_ids?new Set(Oe.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:Oe.properties.building_ids?new Set(Oe.properties.building_ids.toString().split(";")):new Set,name:Oe.properties.name.toString(),zIndex:Oe.properties.z_index}}function ot(Oe,q){return q.every(X=>Oe.properties&&Oe.properties[X]!=null)}function kt(Oe){return ot(Oe,["type","id","name"])&&Oe.properties.type==="building"}function Cn(Oe){return ot(Oe,["type","id","name","z_index"])&&Oe.properties.type==="floor"}o.fi(te,"GlyphAtlas");class Xn{constructor(q){this.tileID=new o.aP(q.tileID.overscaledZ,q.tileID.wrap,q.tileID.canonical.z,q.tileID.canonical.x,q.tileID.canonical.y),this.tileZoom=q.tileZoom,this.uid=q.uid,this.zoom=q.zoom,this.lut=q.lut,this.canonical=q.tileID.canonical,this.pixelRatio=q.pixelRatio,this.tileSize=q.tileSize,this.source=q.source,this.scope=q.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=q.showCollisionBoxes,this.collectResourceTiming=!!q.request&&q.request.collectResourceTiming,this.promoteId=q.promoteId,this.isSymbolTile=q.isSymbolTile,this.tileTransform=o.aY(q.tileID.canonical,q.projection),this.projection=q.projection,this.worldview=q.worldview,this.localizableLayerIds=q.localizableLayerIds,this.brightness=q.brightness,this.extraShadowCaster=!!q.extraShadowCaster,this.tessellationStep=q.tessellationStep,this.scaleFactor=q.scaleFactor,this.worldview=q.worldview,this.indoor=q.indoor}parse(q,X,de,ye,Ce,De){this.status="parsing",this.data=q,this.collisionBoxArray=new o.b2;let He=new o.fl(Object.keys(q.layers).sort()),Pe=new o.fm(this.tileID,this.promoteId);Pe.bucketLayerIDs=[];let Ve={},ht=new o.fn(256,256),st={featureIndex:Pe,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:ht,availableImages:de,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){let Gt=this.indoor.indoorState.activeFloorsVisible,Rn=(function(zn,Di,_r){let Yr=(function(bi,Zn){if(!bi)return o.w("No source layers defined in indoor specification"),Zn;if(bi.size===0)return Zn;let er=bi.difference(Zn);for(let vr of er)o.w(`Missing source layer required in indoor specification: ${vr}`);return Zn.intersection(Zn)})(Di.sourceLayers,new Set(Object.keys(zn.layers))),Fr=Di.indoorState,Or=(function(bi,Zn,er,vr){let Ei=new Set,tr=new Set,oo=new Set,Xo=new Map,fa={},Uc=yo=>{let zs=Xo.get(yo)||new Set;for(let Bo of Ei)if((Xo.get(Bo)||new Set).has(yo)||zs.has(Bo))return!0;return!1};for(let yo of Zn){let zs=bi.layers[yo];if(zs)for(let Bo=0;Bo<zs.length;Bo++){let Ws=zs.feature(Bo);if(kt(Ws)){let{id:Bs,center:Zs}=Be(Ws);ze(fa,Bs,Zs),Ei.add(Bs)}else if(Cn(Ws)){let{id:Bs,isDefault:Zs,connections:cf,conflicts:Yd,buildings:Kd,name:Jd,zIndex:js}=Tt(Ws);Ae(fa,Kd,Bs,{name:Jd,zIndex:js}),Xo.set(Bs,Yd),(Bs===vr||cf.has(vr))&&Ei.add(Bs),tr.add(Bs),Zs&&oo.add(Bs)}}else o.w(`indoor source layer not found: ${yo}`)}if(er)for(let yo of er)tr.has(yo)&&(Uc(yo)||Ei.add(yo));for(let yo of oo)Ei.has(yo)||Uc(yo)||Ei.add(yo);return{buildings:fa,activeFloors:Ei}})(zn,Yr,Fr.lastActiveFloors,Fr.selectedFloorId);return _r.send("setIndoorData",Or),Or})(q,this.indoor,Ce);st.activeFloors=Gt?Rn.activeFloors:void 0}let Ht=[],fn=X.familiesBySource[this.source];for(let Gt in fn){let Rn=q.layers[Gt];if(!Rn)continue;let zn=!1,Di=!1,_r=!1;for(let bi of fn[Gt])bi[0].type==="symbol"?zn=!0:Di=!0,bi[0].is3D()&&bi[0].type!=="model"&&(_r=!0);if(this.extraShadowCaster&&!_r||this.isSymbolTile===!0&&!zn||this.isSymbolTile===!1&&!Di)continue;Rn.version===1&&o.w(`Vector tile source "${this.source}" layer "${Gt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let Yr=He.encode(Gt),Fr=[],Or=!1;for(let bi=0,Zn=0;bi<Rn.length;bi++){let er=Rn.feature(bi),vr=Pe.getId(er,Gt);if(this.localizableLayerIds&&this.localizableLayerIds.has(Gt)){let Ei=er.properties?er.properties.worldview:null;if(this.worldview&&typeof Ei=="string")if(Ei==="all")er.properties.$localized=!0;else{if(!Ei.split(",").includes(this.worldview))continue;er.properties.$localized=!0,er.properties.worldview=this.worldview}}!Or&&er.properties&&er.properties.hasOwnProperty(o.fo)&&(Or=!0),Fr.push({feature:er,id:vr,index:Zn,sourceLayerIndex:Yr}),Zn++}Or&&!st.elevationFeatures&&q.layers.hasOwnProperty(o.fp)&&(st.elevationFeatures=o.fq.parseFrom(q.layers[o.fp],this.canonical));for(let bi of fn[Gt]){let Zn=bi[0];if(this.extraShadowCaster&&(!Zn.is3D()||Zn.type==="model")||this.isSymbolTile!==void 0&&Zn.type==="symbol"!==this.isSymbolTile||Zn.minzoom&&this.zoom<Math.floor(Zn.minzoom)||Zn.maxzoom&&this.zoom>=Zn.maxzoom||Zn.visibility==="none")continue;On(bi,this.zoom,st.brightness,de,this.worldview);let er=Ve[Zn.id]=Zn.createBucket({index:Pe.bucketLayerIDs.length,layers:bi,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Yr,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:ye,worldview:this.worldview});Pe.bucketLayerIDs.push(bi.map(Ei=>o.B(Ei.id,Ei.scope)));let vr=er.prepare?er.prepare():null;vr!=null?(vr=vr.then(()=>er.populate(Fr,st,this.tileID.canonical,this.tileTransform)),Ht.push(vr)):er.populate(Fr,st,this.tileID.canonical,this.tileTransform)}}let an=()=>{let Gt,Rn,zn,Di,_r,Yr;ht.trim();let Fr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Or=()=>{if(Gt)return this.status="done",De(Gt);if(this.extraShadowCaster)this.status="done",De(null,{buckets:Object.values(Ve).filter(Zn=>!Zn.isEmpty()),featureIndex:Pe,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:st.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Rn&&zn&&Di){let Zn=new te(Rn),er=new Map;for(let[tr,oo]of zn.entries()){let{imagePosition:Xo}=o.ft(tr,oo,o.fu);er.set(tr,Xo)}let vr={};for(let tr in Ve){let oo=Ve[tr];oo instanceof o.b3&&(On(oo.layers,this.zoom,st.brightness,de,this.worldview),vr[tr]=o.fv(oo,Rn,Zn.positions,zn,er,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,_r,this.worldview))}let Ei={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Ce,zn,_r,()=>{Ei.iconsPending=!1,bi(vr,Zn,Ei)}),this.rasterizeIfNeeded(Ce,Di,Yr,()=>{Ei.patternsPending=!1,bi(vr,Zn,Ei)})}},bi=(Zn,er,vr,Ei)=>{if(vr.iconsPending||vr.patternsPending)return;let tr=new o.fw(zn,Di,this.lut);for(let oo in Ve){let Xo=Ve[oo];if(oo in Zn)o.fx(Xo,Zn[oo],this.showCollisionBoxes,de,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,zn,tr);else if(Xo.hasPattern&&(Xo instanceof o.b9||Xo instanceof o.ba||Xo instanceof o.e9)){On(Xo.layers,this.zoom,st.brightness,de,this.worldview);let fa=Object.fromEntries(tr.patternPositions);Xo.addFeatures(st,this.tileID.canonical,fa,de,this.tileTransform,this.brightness)}}this.status="done",De(null,{buckets:Object.values(Ve).filter(oo=>!oo.isEmpty()),featureIndex:Pe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:er.image,lineAtlas:ht,imageAtlas:tr,brightness:st.brightness})};if(!this.extraShadowCaster){let Zn=o.fr(st.glyphDependencies,Ei=>Object.keys(Ei).map(Number));Object.keys(Zn).length?Ce.send("getGlyphs",{uid:this.uid,stacks:Zn},(Ei,tr)=>{Gt||(Gt=Ei,Rn=tr,Or())},void 0,!1,Fr):Rn={};let er=Array.from(st.iconDependencies.keys()).map(Ei=>o.I.parse(Ei));er.length?Ce.send("getImages",{images:er,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Ei,tr)=>{Gt||(Gt=Ei,zn=new Map,_r=this.updateImageMapAndGetImageTaskQueue(zn,tr,st.iconDependencies),Or())},void 0,!1,Fr):(zn=new Map,_r=new Map);let vr=Array.from(st.patternDependencies.keys()).map(Ei=>o.I.parse(Ei));vr.length?Ce.send("getImages",{images:vr,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Ei,tr)=>{Gt||(Gt=Ei,Di=new Map,Yr=this.updateImageMapAndGetImageTaskQueue(Di,tr,st.patternDependencies),Or())},void 0,!1,Fr):(Di=new Map,Yr=new Map)}if(st.elevationFeatures&&st.elevationFeatures.length>0){let Zn=[];for(let vr of Object.values(Ve))if(vr instanceof o.ba){let Ei=vr.getUnevaluatedPortalGraph();Ei&&Zn.push(Ei)}let er=o.fs.evaluate(Zn);for(let vr of Object.values(Ve))if(vr instanceof o.ba){let Ei=q.layers[He.decode(vr.sourceLayerIndex)];vr.setEvaluatedPortalGraph(er,Ei,this.tileID.canonical,st.availableImages,st.brightness)}}Or()};Ht.length>0?Promise.allSettled(Ht).then(an).catch(De):an()}updateParameters(q){this.scaleFactor=q.scaleFactor,this.showCollisionBoxes=q.showCollisionBoxes,this.projection=q.projection,this.brightness=q.brightness,this.tileTransform=o.aY(q.tileID.canonical,q.projection),this.extraShadowCaster=q.extraShadowCaster,this.lut=q.lut,this.worldview=q.worldview,this.indoor=q.indoor}rasterizeIfNeeded(q,X,de,ye){Array.from(X.values()).some(Ce=>Ce.usvg)?this.rasterize(q,X,de,ye):ye()}updateImageMapAndGetImageTaskQueue(q,X,de){let ye=new Map;for(let Ce of X.keys()){let De=de.get(Ce)||[];for(let He of De){let Pe=He.toString(),Ve=X.get(He.id.toString());Ve.usvg?ye.has(Pe)||(ye.set(Pe,He),q.set(Pe,Object.assign({},Ve))):q.set(Pe,Ve)}}return ye}rasterize(q,X,de,ye){this.rasterizeTask=q.send("rasterizeImages",{scope:this.scope,tasks:de},(Ce,De)=>{if(!Ce)for(let[He,Pe]of De.entries()){let Ve=Object.assign(X.get(He),{data:Pe});X.set(He,Ve)}ye()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function On(Oe,q,X,de,ye){let Ce=new o.ac(q,{brightness:X,worldview:ye});for(let De of Oe)De.recalculate(Ce,de)}class Vn extends o.E{constructor(q,X,de,ye,Ce,De,He){super(),this.actor=q,this.layerIndex=X,this.availableImages=de,this.availableModels=ye,this.loadVectorData=De||o.aL,this.loading={},this.loaded={},this.deduped=new o.aK(q.scheduler),this.isSpriteLoaded=Ce,this.scheduler=q.scheduler,this.brightness=He}loadTile(q,X){let de=q.uid,ye=q&&q.request,Ce=ye&&ye.collectResourceTiming,De=this.loading[de]=new Xn(q);De.abort=this.loadVectorData(q,(He,Pe)=>{let Ve=!this.loading[de];if(delete this.loading[de],De.cancelRasterize(),Ve||He||!Pe)return De.status="done",Ve||(this.loaded[de]=De),X(He);let ht=Pe.rawData,st={},Ht=o.aM(Pe.responseHeaders);Ht&&Ht.expires&&(st.expires=Ht.expires),Ht&&Ht.cacheControl&&(st.cacheControl=Ht.cacheControl),De.vectorTile=Pe.vectorTile||new o.fy(new o.bs(ht));let fn=()=>{De.parse(De.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(an,Gt)=>{if(an||!Gt)return X(an);let Rn={};if(Ce){let zn=E(ye);zn.length>0&&(Rn.resourceTiming=JSON.parse(JSON.stringify(zn)))}X(null,Object.assign({rawTileData:ht.slice(0),responseHeaders:Pe.responseHeaders},Gt,st,Rn))})};this.isSpriteLoaded?fn():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(fn,{type:"parseTile",isSymbolTile:q.isSymbolTile,zoom:q.tileZoom}):fn()}),this.loaded=this.loaded||{},this.loaded[de]=De})}reloadTile(q,X){let de=this.loaded,ye=q.uid;if(de&&de[ye]){let Ce=de[ye];Ce.updateParameters(q);let De=(He,Pe)=>{let Ve=Ce.reloadCallback;Ve&&(delete Ce.reloadCallback,Ce.parse(Ce.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Ve)),X(He,Pe)};Ce.status==="parsing"?Ce.reloadCallback=De:Ce.status==="done"&&(Ce.vectorTile?Ce.parse(Ce.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,De):De())}else X(null,void 0)}abortTile(q,X){let de=q.uid,ye=this.loading[de];ye&&(ye.abort&&ye.abort(),delete this.loading[de]),X()}removeTile(q,X){let de=this.loaded,ye=q.uid;de&&de[ye]&&delete de[ye],X()}}class rr{loadTile(q,X){let{uid:de,encoding:ye,rawImageData:Ce,padding:De}=q,He=ImageBitmap&&Ce instanceof ImageBitmap?this.getImageData(Ce,De):Ce;X(null,new o.fz(de,He,ye,De<1))}reloadTile(q,X){X(null,null)}abortTile(q,X){X()}removeTile(q,X){X()}getImageData(q,X){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(q.width,q.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=q.width,this.offscreenCanvas.height=q.height,this.offscreenCanvasContext.drawImage(q,0,0,q.width,q.height);let de=this.offscreenCanvasContext.getImageData(-X,-X,q.width+2*X,q.height+2*X);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),de}}o.br.setPbf(o.bs);class Vi{constructor(q){this._mrt=new o.br(q.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=q.uid,this.tileID=q.tileID,this.source=q.source}parse(q,X){let de=this._mrt;this.status="parsing",this._entireBuffer=q;try{de.parseHeader(q),this._isHeaderLoaded=!0;let ye=[];for(let Ce in de.layers){let De=de.getLayer(Ce),He=De.getDataRange(De.getBandList()),Pe=de.createDecodingTask(He),Ve=q.slice(He.firstByte,He.lastByte+1),ht=o.br.performDecoding(Ve,Pe).then(st=>Pe.complete(null,st)).catch(st=>Pe.complete(st,null));ye.push(ht)}Promise.allSettled(ye).then(()=>X(null,de)).catch(Ce=>X(Ce))}catch(ye){X(ye)}}}class Er{constructor(q){this.actor=q,this.loading={},this.loaded={}}loadTile(q,X){let de=q.uid,ye=q.request,Ce=this.loading[de]=new Vi(q),{cancel:De}=o.bt(ye,(He,Pe,Ve)=>{let ht=!this.loading[de];if(delete this.loading[de],ht||He||!Pe)return Ce.status="done",ht||(this.loaded[de]=Ce),X(He);Ce.parse(Pe,(st,Ht)=>{if(st||!Ht)return X(st);X(null,Ht,Ve)}),this.loaded[de]=Ce});Ce.abort=De}reloadTile(q,X){X(null,void 0)}abortTile(q,X){let de=q.uid,ye=this.loading[de];ye&&(ye.abort&&ye.abort(),delete this.loading[de]),X()}removeTile(q,X){let de=q.uid;this.loaded[de]&&delete this.loaded[de],X()}decodeRasterArray(q,X){o.br.performDecoding(q.buffer,q.task).then(de=>X(null,de)).catch(de=>X(de))}}let $n=o.fA.prototype.toGeoJSON;class Qi{constructor(q){this._feature=q,this.extent=o.al,this.type=q.type,this.properties=q.tags,"id"in q&&!isNaN(q.id)&&(this.id=parseInt(q.id,10))}loadGeometry(){if(this._feature.type===1){let q=[];for(let X of this._feature.geometry)q.push([new o.P(X[0],X[1])]);return q}{let q=[];for(let X of this._feature.geometry){let de=[];for(let ye of X)de.push(new o.P(ye[0],ye[1]));q.push(de)}return q}}toGeoJSON(q,X,de){return $n.call(this,q,X,de)}}class Rt{constructor(q,X){this.name=q,this.extent=o.al,this.length=X.length,this._jsonFeatures=X}feature(q){return new Qi(this._jsonFeatures[q])}}class en{constructor(q){this.layers={},this.extent=o.al;for(let X of Object.keys(q))this.layers[X]=new Rt(X,q[X])}}let ai=64/4096,Fi=128;class Wi{constructor(){this.features=new Map}clear(){this.features.clear()}load(q=[],X){for(let de of q){let ye=de.id;if(ye==null)continue;let Ce=this.features.get(ye);Ce&&this.updateCache(Ce,X),de.geometry?(Ce=Oo(de),this.updateCache(Ce,X),this.features.set(ye,Ce)):this.features.delete(ye),this.updateCache(Ce,X)}}updateCache(q,X){for(let{canonical:de,uid:ye}of Object.values(X)){let{z:Ce,x:De,y:He}=de;Pr(q,Math.pow(2,Ce),De,He)&&delete X[ye]}}getTile(q,X,de){let ye=Math.pow(2,q),Ce=[];for(let De of this.features.values())Pr(De,ye,X,de)&&Ce.push(Ui(De,ye,X,de));return{features:Ce}}getFeatures(){return[...this.features.values()]}}function Pr({minX:Oe,minY:q,maxX:X,maxY:de},ye,Ce,De){return Oe<(Ce+1+ai)/ye&&q<(De+1+ai)/ye&&X>(Ce-ai)/ye&&de>(De-ai)/ye}function Oo(Oe){let{id:q,geometry:X,properties:de}=Oe;if(!X)return;if(X.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");let{type:ye,coordinates:Ce}=X,De={id:q,type:1,geometry:[],tags:de,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},He=De.geometry;if(ye==="Point")ks(Ce,He,De);else if(ye==="MultiPoint")for(let Pe of Ce)ks(Pe,He,De);else if(ye==="LineString")De.type=2,Fs(Ce,He,De);else if(ye==="MultiLineString")De.type=2,eo(Ce,He,De);else if(ye==="Polygon")De.type=3,eo(Ce,He,De,!0);else{if(ye!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");De.type=3;for(let Pe of Ce)eo(Pe,He,De,!0)}return De}function ks([Oe,q],X,de){let ye=o.aF(Oe),Ce=o.aJ(q);Ce=Ce<0?0:Ce>1?1:Ce,X.push(ye,Ce),de.minX=Math.min(de.minX,ye),de.minY=Math.min(de.minY,Ce),de.maxX=Math.max(de.maxX,ye),de.maxY=Math.max(de.maxY,Ce)}function Fs(Oe,q,X,de=!1,ye=!1){let Ce=[];for(let De of Oe)ks(De,Ce,X);q.push(Ce),de&&(function(De,He){let Pe=0;for(let Ve=0,ht=De.length,st=ht-2;Ve<ht;st=Ve,Ve+=2)Pe+=(De[Ve]-De[st])*(De[Ve+1]+De[st+1]);if(Pe>0===He)for(let Ve=0,ht=De.length;Ve<ht/2;Ve+=2){let st=De[Ve],Ht=De[Ve+1];De[Ve]=De[ht-2-Ve],De[Ve+1]=De[ht-1-Ve],De[ht-2-Ve]=st,De[ht-1-Ve]=Ht}})(Ce,ye)}function eo(Oe,q,X,de=!1){for(let ye=0;ye<Oe.length;ye++)Fs(Oe[ye],q,X,de,ye===0)}function Ui(Oe,q,X,de){let{id:ye,type:Ce,geometry:De,tags:He}=Oe,Pe=[];if(Ce===1)(function(Ve,ht,st,Ht,fn){for(let an=0;an<Ve.length;an+=2){let Gt=Math.round(o.al*(Ve[an+0]*ht-st)),Rn=Math.round(o.al*(Ve[an+1]*ht-Ht));fn.push([Gt,Rn])}})(De,q,X,de,Pe);else for(let Ve of De)Do(Ve,q,X,de,Pe);return{id:ye,type:Ce,geometry:Pe,tags:He}}function Do(Oe,q,X,de,ye){let Ce=-Fi,De=o.al+Fi,He;for(let Pe=0;Pe<Oe.length-2;Pe+=2){let Ve=Math.round(o.al*(Oe[Pe+0]*q-X)),ht=Math.round(o.al*(Oe[Pe+1]*q-de)),st=Math.round(o.al*(Oe[Pe+2]*q-X)),Ht=Math.round(o.al*(Oe[Pe+3]*q-de)),fn=st-Ve,an=Ht-ht;Ve<Ce&&st<Ce||(Ve<Ce?(ht+=Math.round(an*((Ce-Ve)/fn)),Ve=Ce):st<Ce&&(Ht=ht+Math.round(an*((Ce-Ve)/fn)),st=Ce),ht<Ce&&Ht<Ce||(ht<Ce?(Ve+=Math.round(fn*((Ce-ht)/an)),ht=Ce):Ht<Ce&&(st=Ve+Math.round(fn*((Ce-ht)/an)),Ht=Ce),Ve>=De&&st>=De||(Ve>=De?(ht+=Math.round(an*((De-Ve)/fn)),Ve=De):st>=De&&(Ht=ht+Math.round(an*((De-Ve)/fn)),st=De),ht>=De&&Ht>=De||(ht>=De?(Ve+=Math.round(fn*((De-ht)/an)),ht=De):Ht>=De&&(st=Ve+Math.round(fn*((De-ht)/an)),Ht=De),He&&Ve===He[He.length-1][0]&&ht===He[He.length-1][1]||(He=[[Ve,ht]],ye.push(He)),He.push([st,Ht])))))}}function Nu({name:Oe,features:q},X){X.writeStringField(1,Oe),X.writeVarintField(5,o.al);let de=new Map,ye=new Map,Ce={keys:de,values:ye,feature:null};for(let De of q)Ce.feature=De,X.writeMessage(2,$a,Ce);for(let De of de.keys())X.writeStringField(3,De);for(let De of ye.keys())X.writeMessage(4,Ro,De)}function $a(Oe,q){let X=Oe.feature;X.id!==void 0&&Number.isSafeInteger(+X.id)&&q.writeVarintField(1,+X.id),X.tags&&q.writeMessage(2,Bl,Oe),q.writeVarintField(3,X.type),q.writeMessage(4,Vr,X)}function Bl({keys:Oe,values:q,feature:X},de){for(let ye of Object.keys(X.tags)){let Ce=X.tags[ye];if(Ce===null)continue;let De=Oe.get(ye);De===void 0&&(De=Oe.size,Oe.set(ye,De)),de.writeVarint(De);let He=typeof Ce;He!=="string"&&He!=="boolean"&&He!=="number"&&(Ce=JSON.stringify(Ce));let Pe=q.get(Ce);Pe===void 0&&(Pe=q.size,q.set(Ce,Pe)),de.writeVarint(Pe)}}function Ga(Oe,q){return(q<<3)+(7&Oe)}function Li(Oe){return Oe<<1^Oe>>31}function Vr(Oe,q){let{geometry:X,type:de}=Oe,ye=0,Ce=0;if(de===1){q.writeVarint(Ga(1,X.length));for(let De of X){let He=De[0]-ye,Pe=De[1]-Ce;q.writeVarint(Li(He)),q.writeVarint(Li(Pe)),ye+=He,Ce+=Pe}}else for(let De of X){q.writeVarint(Ga(1,1));let He=De.length-(de===3?1:0);for(let Pe=0;Pe<He;Pe++){Pe===1&&q.writeVarint(Ga(2,He-1));let Ve=De[Pe][0]-ye,ht=De[Pe][1]-Ce;q.writeVarint(Li(Ve)),q.writeVarint(Li(ht)),ye+=Ve,Ce+=ht}de===3&&q.writeVarint(Ga(7,1))}}function Ro(Oe,q){let X=typeof Oe;X==="string"?q.writeStringField(1,Oe):X==="boolean"?q.writeBooleanField(7,Oe):X==="number"&&(Oe%1!=0?q.writeDoubleField(3,Oe):Oe<0?q.writeSVarintField(6,Oe):q.writeVarintField(5,Oe))}let hc={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Oe=>Oe},pr=Math.fround||(qa=new Float32Array(1),Oe=>(qa[0]=+Oe,qa[0]));var qa;let ua=3,co=5,Wo=6;class Ur{constructor(q){this.options=Object.assign(Object.create(hc),q),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(q){let{log:X,minZoom:de,maxZoom:ye}=this.options;X&&console.time("total time");let Ce=`prepare ${q.length} points`;X&&console.time(Ce),this.points=q;let De=[];for(let Pe=0;Pe<q.length;Pe++){let Ve=q[Pe];if(!Ve.geometry)continue;let[ht,st]=Ve.geometry.coordinates,Ht=pr(Ls(ht)),fn=pr(jl(st));De.push(Ht,fn,1/0,Pe,-1,1),this.options.reduce&&De.push(0)}let He=this.trees[ye+1]=this._createTree(De);X&&console.timeEnd(Ce);for(let Pe=ye;Pe>=de;Pe--){let Ve=+Date.now();He=this.trees[Pe]=this._createTree(this._cluster(He,Pe)),X&&console.log("z%d: %d clusters in %dms",Pe,He.numItems,+Date.now()-Ve)}return X&&console.timeEnd("total time"),this}getClusters(q,X){let de=((q[0]+180)%360+360)%360-180,ye=Math.max(-90,Math.min(90,q[1])),Ce=q[2]===180?180:((q[2]+180)%360+360)%360-180,De=Math.max(-90,Math.min(90,q[3]));if(q[2]-q[0]>=360)de=-180,Ce=180;else if(de>Ce){let st=this.getClusters([de,ye,180,De],X),Ht=this.getClusters([-180,ye,Ce,De],X);return st.concat(Ht)}let He=this.trees[this._limitZoom(X)],Pe=He.range(Ls(de),jl(De),Ls(Ce),jl(ye)),Ve=He.data,ht=[];for(let st of Pe){let Ht=this.stride*st;ht.push(Ve[Ht+co]>1?os(Ve,Ht,this.clusterProps):this.points[Ve[Ht+ua]])}return ht}getChildren(q){let X=this._getOriginId(q),de=this._getOriginZoom(q),ye="No cluster with the specified id.",Ce=this.trees[de];if(!Ce)throw new Error(ye);let De=Ce.data;if(X*this.stride>=De.length)throw new Error(ye);let He=this.options.radius/(this.options.extent*Math.pow(2,de-1)),Pe=Ce.within(De[X*this.stride],De[X*this.stride+1],He),Ve=[];for(let ht of Pe){let st=ht*this.stride;De[st+4]===q&&Ve.push(De[st+co]>1?os(De,st,this.clusterProps):this.points[De[st+ua]])}if(Ve.length===0)throw new Error(ye);return Ve}getLeaves(q,X,de){let ye=[];return this._appendLeaves(ye,q,X=X||10,de=de||0,0),ye}getTile(q,X,de){let ye=this.trees[this._limitZoom(q)],Ce=Math.pow(2,q),{extent:De,radius:He}=this.options,Pe=He/De,Ve=(de-Pe)/Ce,ht=(de+1+Pe)/Ce,st={features:[]};return this._addTileFeatures(ye.range((X-Pe)/Ce,Ve,(X+1+Pe)/Ce,ht),ye.data,X,de,Ce,st),X===0&&this._addTileFeatures(ye.range(1-Pe/Ce,Ve,1,ht),ye.data,Ce,de,Ce,st),X===Ce-1&&this._addTileFeatures(ye.range(0,Ve,Pe/Ce,ht),ye.data,-1,de,Ce,st),st.features.length?st:null}getClusterExpansionZoom(q){let X=this._getOriginZoom(q)-1;for(;X<=this.options.maxZoom;){let de=this.getChildren(q);if(X++,de.length!==1)break;q=de[0].properties.cluster_id}return X}_appendLeaves(q,X,de,ye,Ce){let De=this.getChildren(X);for(let He of De){let Pe=He.properties;if(Pe&&Pe.cluster?Ce+Pe.point_count<=ye?Ce+=Pe.point_count:Ce=this._appendLeaves(q,Pe.cluster_id,de,ye,Ce):Ce<ye?Ce++:q.push(He),q.length===de)break}return Ce}_createTree(q){let X=new o.c3(q.length/this.stride|0,this.options.nodeSize,Float32Array);for(let de=0;de<q.length;de+=this.stride)X.add(q[de],q[de+1]);return X.finish(),X.data=q,X}_addTileFeatures(q,X,de,ye,Ce,De){for(let He of q){let Pe=He*this.stride,Ve=X[Pe+co]>1,ht,st,Ht;if(Ve)ht=_l(X,Pe,this.clusterProps),st=X[Pe],Ht=X[Pe+1];else{let Gt=this.points[X[Pe+ua]];ht=Gt.properties;let[Rn,zn]=Gt.geometry.coordinates;st=Ls(Rn),Ht=jl(zn)}let fn={type:1,geometry:[[Math.round(this.options.extent*(st*Ce-de)),Math.round(this.options.extent*(Ht*Ce-ye))]],tags:ht},an;an=Ve||this.options.generateId?X[Pe+ua]:this.points[X[Pe+ua]].id,an!==void 0&&(fn.id=an),De.features.push(fn)}}_limitZoom(q){return Math.max(this.options.minZoom,Math.min(Math.floor(+q),this.options.maxZoom+1))}_cluster(q,X){let{radius:de,extent:ye,reduce:Ce,minPoints:De}=this.options,He=de/(ye*Math.pow(2,X)),Pe=q.data,Ve=[],ht=this.stride;for(let st=0;st<Pe.length;st+=ht){if(Pe[st+2]<=X)continue;Pe[st+2]=X;let Ht=Pe[st],fn=Pe[st+1],an=q.within(Pe[st],Pe[st+1],He),Gt=Pe[st+co],Rn=Gt;for(let zn of an){let Di=zn*ht;Pe[Di+2]>X&&(Rn+=Pe[Di+co])}if(Rn>Gt&&Rn>=De){let zn,Di=Ht*Gt,_r=fn*Gt,Yr=-1,Fr=(st/ht<<5)+(X+1)+this.points.length;for(let Or of an){let bi=Or*ht;if(Pe[bi+2]<=X)continue;Pe[bi+2]=X;let Zn=Pe[bi+co];Di+=Pe[bi]*Zn,_r+=Pe[bi+1]*Zn,Pe[bi+4]=Fr,Ce&&(zn||(zn=this._map(Pe,st,!0),Yr=this.clusterProps.length,this.clusterProps.push(zn)),Ce(zn,this._map(Pe,bi)))}Pe[st+4]=Fr,Ve.push(Di/Rn,_r/Rn,1/0,Fr,-1,Rn),Ce&&Ve.push(Yr)}else{for(let zn=0;zn<ht;zn++)Ve.push(Pe[st+zn]);if(Rn>1)for(let zn of an){let Di=zn*ht;if(!(Pe[Di+2]<=X)){Pe[Di+2]=X;for(let _r=0;_r<ht;_r++)Ve.push(Pe[Di+_r])}}}}return Ve}_getOriginId(q){return q-this.points.length>>5}_getOriginZoom(q){return(q-this.points.length)%32}_map(q,X,de){if(q[X+co]>1){let De=this.clusterProps[q[X+Wo]];return de?Object.assign({},De):De}let ye=this.points[q[X+ua]].properties,Ce=this.options.map(ye);return de&&Ce===ye?Object.assign({},Ce):Ce}}function os(Oe,q,X){return{type:"Feature",id:Oe[q+ua],properties:_l(Oe,q,X),geometry:{type:"Point",coordinates:[(de=Oe[q],360*(de-.5)),lr(Oe[q+1])]}};var de}function _l(Oe,q,X){let de=Oe[q+co],ye=de>=1e4?`${Math.round(de/1e3)}k`:de>=1e3?Math.round(de/100)/10+"k":de,Ce=Oe[q+Wo],De=Ce===-1?{}:Object.assign({},X[Ce]);return Object.assign(De,{cluster:!0,cluster_id:Oe[q+ua],point_count:de,point_count_abbreviated:ye})}function Ls(Oe){return Oe/360+.5}function jl(Oe){let q=Math.sin(Oe*Math.PI/180),X=.5-.25*Math.log((1+q)/(1-q))/Math.PI;return X<0?0:X>1?1:X}function lr(Oe){let q=(180-360*Oe)*Math.PI/180;return 360*Math.atan(Math.exp(q))/Math.PI-90}function Hr(Oe,q,X,de){let ye=de,Ce=q+(X-q>>1),De,He=X-q,Pe=Oe[q],Ve=Oe[q+1],ht=Oe[X],st=Oe[X+1];for(let Ht=q+3;Ht<X;Ht+=3){let fn=Ns(Oe[Ht],Oe[Ht+1],Pe,Ve,ht,st);if(fn>ye)De=Ht,ye=fn;else if(fn===ye){let an=Math.abs(Ht-Ce);an<He&&(De=Ht,He=an)}}ye>de&&(De-q>3&&Hr(Oe,q,De,de),Oe[De+2]=ye,X-De>3&&Hr(Oe,De,X,de))}function Ns(Oe,q,X,de,ye,Ce){let De=ye-X,He=Ce-de;if(De!==0||He!==0){let Pe=((Oe-X)*De+(q-de)*He)/(De*De+He*He);Pe>1?(X=ye,de=Ce):Pe>0&&(X+=De*Pe,de+=He*Pe)}return De=Oe-X,He=q-de,De*De+He*He}function vs(Oe,q,X,de){let ye={id:Oe??null,type:q,geometry:X,tags:de,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(q==="Point"||q==="MultiPoint"||q==="LineString")Zr(ye,X);else if(q==="Polygon")Zr(ye,X[0]);else if(q==="MultiLineString")for(let Ce of X)Zr(ye,Ce);else if(q==="MultiPolygon")for(let Ce of X)Zr(ye,Ce[0]);return ye}function Zr(Oe,q){for(let X=0;X<q.length;X+=3)Oe.minX=Math.min(Oe.minX,q[X]),Oe.minY=Math.min(Oe.minY,q[X+1]),Oe.maxX=Math.max(Oe.maxX,q[X]),Oe.maxY=Math.max(Oe.maxY,q[X+1])}function vo(Oe,q,X,de){if(!q.geometry)return;let ye=q.geometry.coordinates;if(ye&&ye.length===0)return;let Ce=q.geometry.type,De=Math.pow(X.tolerance/((1<<X.maxZoom)*X.extent),2),He=[],Pe=q.id;if(X.promoteId?Pe=q.properties[X.promoteId]:X.generateId&&(Pe=de||0),Ce==="Point")ss(ye,He);else if(Ce==="MultiPoint")for(let Ve of ye)ss(Ve,He);else if(Ce==="LineString")fc(ye,He,De,!1);else if(Ce==="MultiLineString"){if(X.lineMetrics){for(let Ve of ye)He=[],fc(Ve,He,De,!1),Oe.push(vs(Pe,"LineString",He,q.properties));return}qs(ye,He,De,!1)}else if(Ce==="Polygon")qs(ye,He,De,!0);else{if(Ce!=="MultiPolygon"){if(Ce==="GeometryCollection"){for(let Ve of q.geometry.geometries)vo(Oe,{id:Pe,geometry:Ve,properties:q.properties},X,de);return}throw new Error("Input data is not a valid GeoJSON object.")}for(let Ve of ye){let ht=[];qs(Ve,ht,De,!0),He.push(ht)}}Oe.push(vs(Pe,Ce,He,q.properties))}function ss(Oe,q){q.push(No(Oe[0]),zu(Oe[1]),0)}function fc(Oe,q,X,de){let ye,Ce,De=0;for(let Pe=0;Pe<Oe.length;Pe++){let Ve=No(Oe[Pe][0]),ht=zu(Oe[Pe][1]);q.push(Ve,ht,0),Pe>0&&(De+=de?(ye*ht-Ve*Ce)/2:Math.sqrt(Math.pow(Ve-ye,2)+Math.pow(ht-Ce,2))),ye=Ve,Ce=ht}let He=q.length-3;q[2]=1,Hr(q,0,He,X),q[He+2]=1,q.size=Math.abs(De),q.start=0,q.end=q.size}function qs(Oe,q,X,de){for(let ye=0;ye<Oe.length;ye++){let Ce=[];fc(Oe[ye],Ce,X,de),q.push(Ce)}}function No(Oe){return Oe/360+.5}function zu(Oe){let q=Math.sin(Oe*Math.PI/180),X=.5-.25*Math.log((1+q)/(1-q))/Math.PI;return X<0?0:X>1?1:X}function Xr(Oe,q,X,de,ye,Ce,De,He){if(de/=q,Ce>=(X/=q)&&De<de)return Oe;if(De<X||Ce>=de)return null;let Pe=[];for(let Ve of Oe){let ht=Ve.geometry,st=Ve.type,Ht=ye===0?Ve.minX:Ve.minY,fn=ye===0?Ve.maxX:Ve.maxY;if(Ht>=X&&fn<de){Pe.push(Ve);continue}if(fn<X||Ht>=de)continue;let an=[];if(st==="Point"||st==="MultiPoint")jc(ht,an,X,de,ye);else if(st==="LineString")Vc(ht,an,X,de,ye,!1,He.lineMetrics);else if(st==="MultiLineString")Za(ht,an,X,de,ye,!1);else if(st==="Polygon")Za(ht,an,X,de,ye,!0);else if(st==="MultiPolygon")for(let Gt of ht){let Rn=[];Za(Gt,Rn,X,de,ye,!0),Rn.length&&an.push(Rn)}if(an.length){if(He.lineMetrics&&st==="LineString"){for(let Gt of an)Pe.push(vs(Ve.id,st,Gt,Ve.tags));continue}st!=="LineString"&&st!=="MultiLineString"||(an.length===1?(st="LineString",an=an[0]):st="MultiLineString"),st!=="Point"&&st!=="MultiPoint"||(st=an.length===3?"Point":"MultiPoint"),Pe.push(vs(Ve.id,st,an,Ve.tags))}}return Pe.length?Pe:null}function jc(Oe,q,X,de,ye){for(let Ce=0;Ce<Oe.length;Ce+=3){let De=Oe[Ce+ye];De>=X&&De<=de&&Sa(q,Oe[Ce],Oe[Ce+1],Oe[Ce+2])}}function Vc(Oe,q,X,de,ye,Ce,De){let He=Wa(Oe),Pe=ye===0?gr:Zo,Ve,ht,st=Oe.start;for(let Rn=0;Rn<Oe.length-3;Rn+=3){let zn=Oe[Rn],Di=Oe[Rn+1],_r=Oe[Rn+2],Yr=Oe[Rn+3],Fr=Oe[Rn+4],Or=ye===0?zn:Di,bi=ye===0?Yr:Fr,Zn=!1;De&&(Ve=Math.sqrt(Math.pow(zn-Yr,2)+Math.pow(Di-Fr,2))),Or<X?bi>X&&(ht=Pe(He,zn,Di,Yr,Fr,X),De&&(He.start=st+Ve*ht)):Or>de?bi<de&&(ht=Pe(He,zn,Di,Yr,Fr,de),De&&(He.start=st+Ve*ht)):Sa(He,zn,Di,_r),bi<X&&Or>=X&&(ht=Pe(He,zn,Di,Yr,Fr,X),Zn=!0),bi>de&&Or<=de&&(ht=Pe(He,zn,Di,Yr,Fr,de),Zn=!0),!Ce&&Zn&&(De&&(He.end=st+Ve*ht),q.push(He),He=Wa(Oe)),De&&(st+=Ve)}let Ht=Oe.length-3,fn=Oe[Ht],an=Oe[Ht+1],Gt=ye===0?fn:an;Gt>=X&&Gt<=de&&Sa(He,fn,an,Oe[Ht+2]),Ht=He.length-3,Ce&&Ht>=3&&(He[Ht]!==He[0]||He[Ht+1]!==He[1])&&Sa(He,He[0],He[1],He[2]),He.length&&q.push(He)}function Wa(Oe){let q=[];return q.size=Oe.size,q.start=Oe.start,q.end=Oe.end,q}function Za(Oe,q,X,de,ye,Ce){for(let De of Oe)Vc(De,q,X,de,ye,Ce,!1)}function Sa(Oe,q,X,de){Oe.push(q,X,de)}function gr(Oe,q,X,de,ye,Ce){let De=(Ce-q)/(de-q);return Sa(Oe,Ce,X+(ye-X)*De,1),De}function Zo(Oe,q,X,de,ye,Ce){let De=(Ce-X)/(ye-X);return Sa(Oe,q+(de-q)*De,Ce,1),De}function da(Oe,q){let X=[];for(let de=0;de<Oe.length;de++){let ye=Oe[de],Ce=ye.type,De;if(Ce==="Point"||Ce==="MultiPoint"||Ce==="LineString")De=pc(ye.geometry,q);else if(Ce==="MultiLineString"||Ce==="Polygon"){De=[];for(let He of ye.geometry)De.push(pc(He,q))}else if(Ce==="MultiPolygon"){De=[];for(let He of ye.geometry){let Pe=[];for(let Ve of He)Pe.push(pc(Ve,q));De.push(Pe)}}X.push(vs(ye.id,Ce,De,ye.tags))}return X}function pc(Oe,q){let X=[];X.size=Oe.size,Oe.start!==void 0&&(X.start=Oe.start,X.end=Oe.end);for(let de=0;de<Oe.length;de+=3)X.push(Oe[de]+q,Oe[de+1],Oe[de+2]);return X}function ha(Oe,q){if(Oe.transformed)return Oe;let X=1<<Oe.z,de=Oe.x,ye=Oe.y;for(let Ce of Oe.features){let De=Ce.geometry,He=Ce.type;if(Ce.geometry=[],He===1)for(let Pe=0;Pe<De.length;Pe+=2)Ce.geometry.push(lf(De[Pe],De[Pe+1],q,X,de,ye));else for(let Pe=0;Pe<De.length;Pe++){let Ve=[];for(let ht=0;ht<De[Pe].length;ht+=2)Ve.push(lf(De[Pe][ht],De[Pe][ht+1],q,X,de,ye));Ce.geometry.push(Ve)}}return Oe.transformed=!0,Oe}function lf(Oe,q,X,de,ye,Ce){return[Math.round(X*(Oe*de-ye)),Math.round(X*(q*de-Ce))]}function Gd(Oe,q,X,de,ye){let Ce=q===ye.maxZoom?0:ye.tolerance/((1<<q)*ye.extent),De={features:[],numPoints:0,numSimplified:0,numFeatures:Oe.length,source:null,x:X,y:de,z:q,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let He of Oe)jp(De,He,Ce,ye);return De}function jp(Oe,q,X,de){let ye=q.geometry,Ce=q.type,De=[];if(Oe.minX=Math.min(Oe.minX,q.minX),Oe.minY=Math.min(Oe.minY,q.minY),Oe.maxX=Math.max(Oe.maxX,q.maxX),Oe.maxY=Math.max(Oe.maxY,q.maxY),Ce==="Point"||Ce==="MultiPoint")for(let He=0;He<ye.length;He+=3)De.push(ye[He],ye[He+1]),Oe.numPoints++,Oe.numSimplified++;else if(Ce==="LineString")mc(De,ye,Oe,X,!1,!1);else if(Ce==="MultiLineString"||Ce==="Polygon")for(let He=0;He<ye.length;He++)mc(De,ye[He],Oe,X,Ce==="Polygon",He===0);else if(Ce==="MultiPolygon")for(let He=0;He<ye.length;He++){let Pe=ye[He];for(let Ve=0;Ve<Pe.length;Ve++)mc(De,Pe[Ve],Oe,X,!0,Ve===0)}if(De.length){let He=q.tags||null;if(Ce==="LineString"&&de.lineMetrics){He={};for(let Ve in q.tags)He[Ve]=q.tags[Ve];He.mapbox_clip_start=ye.start/ye.size,He.mapbox_clip_end=ye.end/ye.size}let Pe={geometry:De,type:Ce==="Polygon"||Ce==="MultiPolygon"?3:Ce==="LineString"||Ce==="MultiLineString"?2:1,tags:He};q.id!==null&&(Pe.id=q.id),Oe.features.push(Pe)}}function mc(Oe,q,X,de,ye,Ce){let De=de*de;if(de>0&&q.size<(ye?De:de))return void(X.numPoints+=q.length/3);let He=[];for(let Pe=0;Pe<q.length;Pe+=3)(de===0||q[Pe+2]>De)&&(X.numSimplified++,He.push(q[Pe],q[Pe+1])),X.numPoints++;ye&&(function(Pe,Ve){let ht=0;for(let st=0,Ht=Pe.length,fn=Ht-2;st<Ht;fn=st,st+=2)ht+=(Pe[st]-Pe[fn])*(Pe[st+1]+Pe[fn+1]);if(ht>0===Ve)for(let st=0,Ht=Pe.length;st<Ht/2;st+=2){let fn=Pe[st],an=Pe[st+1];Pe[st]=Pe[Ht-2-st],Pe[st+1]=Pe[Ht-1-st],Pe[Ht-2-st]=fn,Pe[Ht-1-st]=an}})(He,Ce),Oe.push(He)}let ct={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Vl{constructor(q,X){let de=(X=this.options=(function(Ce,De){for(let He in De)Ce[He]=De[He];return Ce})(Object.create(ct),X)).debug;if(de&&console.time("preprocess data"),X.maxZoom<0||X.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(X.promoteId&&X.generateId)throw new Error("promoteId and generateId cannot be used together.");let ye=(function(Ce,De){let He=[];if(Ce.type==="FeatureCollection")for(let Pe=0;Pe<Ce.features.length;Pe++)vo(He,Ce.features[Pe],De,Pe);else vo(He,Ce.type==="Feature"?Ce:{geometry:Ce},De);return He})(q,X);this.tiles={},this.tileCoords=[],de&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",X.indexMaxZoom,X.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ye=(function(Ce,De){let He=De.buffer/De.extent,Pe=Ce,Ve=Xr(Ce,1,-1-He,He,0,-1,2,De),ht=Xr(Ce,1,1-He,2+He,0,-1,2,De);return(Ve||ht)&&(Pe=Xr(Ce,1,-He,1+He,0,-1,2,De)||[],Ve&&(Pe=da(Ve,1).concat(Pe)),ht&&(Pe=Pe.concat(da(ht,-1)))),Pe})(ye,X),ye.length&&this.splitTile(ye,0,0,0),de&&(ye.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(q,X,de,ye,Ce,De,He){let Pe=[q,X,de,ye],Ve=this.options,ht=Ve.debug;for(;Pe.length;){ye=Pe.pop(),de=Pe.pop(),X=Pe.pop(),q=Pe.pop();let st=1<<X,Ht=qd(X,de,ye),fn=this.tiles[Ht];if(!fn&&(ht>1&&console.time("creation"),fn=this.tiles[Ht]=Gd(q,X,de,ye,Ve),this.tileCoords.push({z:X,x:de,y:ye}),ht)){ht>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",X,de,ye,fn.numFeatures,fn.numPoints,fn.numSimplified),console.timeEnd("creation"));let Zn=`z${X}`;this.stats[Zn]=(this.stats[Zn]||0)+1,this.total++}if(fn.source=q,Ce==null){if(X===Ve.indexMaxZoom||fn.numPoints<=Ve.indexMaxPoints)continue}else{if(X===Ve.maxZoom||X===Ce)continue;if(Ce!=null){let Zn=Ce-X;if(de!==De>>Zn||ye!==He>>Zn)continue}}if(fn.source=null,q.length===0)continue;ht>1&&console.time("clipping");let an=.5*Ve.buffer/Ve.extent,Gt=.5-an,Rn=.5+an,zn=1+an,Di=null,_r=null,Yr=null,Fr=null,Or=Xr(q,st,de-an,de+Rn,0,fn.minX,fn.maxX,Ve),bi=Xr(q,st,de+Gt,de+zn,0,fn.minX,fn.maxX,Ve);q=null,Or&&(Di=Xr(Or,st,ye-an,ye+Rn,1,fn.minY,fn.maxY,Ve),_r=Xr(Or,st,ye+Gt,ye+zn,1,fn.minY,fn.maxY,Ve),Or=null),bi&&(Yr=Xr(bi,st,ye-an,ye+Rn,1,fn.minY,fn.maxY,Ve),Fr=Xr(bi,st,ye+Gt,ye+zn,1,fn.minY,fn.maxY,Ve),bi=null),ht>1&&console.timeEnd("clipping"),Pe.push(Di||[],X+1,2*de,2*ye),Pe.push(_r||[],X+1,2*de,2*ye+1),Pe.push(Yr||[],X+1,2*de+1,2*ye),Pe.push(Fr||[],X+1,2*de+1,2*ye+1)}}getTile(q,X,de){q=+q,X=+X,de=+de;let ye=this.options,{extent:Ce,debug:De}=ye;if(q<0||q>24)return null;let He=1<<q,Pe=qd(q,X=X+He&He-1,de);if(this.tiles[Pe])return ha(this.tiles[Pe],Ce);De>1&&console.log("drilling down to z%d-%d-%d",q,X,de);let Ve,ht=q,st=X,Ht=de;for(;!Ve&&ht>0;)ht--,st>>=1,Ht>>=1,Ve=this.tiles[qd(ht,st,Ht)];return Ve&&Ve.source?(De>1&&(console.log("found parent tile z%d-%d-%d",ht,st,Ht),console.time("drilling down")),this.splitTile(Ve.source,ht,st,Ht,q,X,de),De>1&&console.timeEnd("drilling down"),this.tiles[Pe]?ha(this.tiles[Pe],Ce):null):null}}function qd(Oe,q,X){return 32*((1<<Oe)*X+q)+Oe}function Wd(Oe,q){let X=Oe.tileID.canonical;if(!this._geoJSONIndex)return void q(null,null);let de=this._geoJSONIndex.getTile(X.z,X.x,X.y);if(!de)return void q(null,null);let ye=Ve=>Ve.tags&&"3d_elevation_id"in Ve.tags&&"source"in Ve.tags&&Ve.tags.source==="elevation",Ce=de.features.filter(Ve=>ye(Ve)),De={_geojsonTileLayer:de.features};Ce.length>0&&(De={_geojsonTileLayer:de.features.filter(Ve=>!ye(Ve)),hd_road_elevation:Ce});let He=new en(De),Pe=(function(Ve){let ht=new o.bs;for(let st of Object.keys(Ve))ht.writeMessage(3,Nu,{name:st,features:Ve[st]});return ht.finish()})(De).buffer;q(null,{vectorTile:He,rawData:Pe})}class Wn extends Vn{constructor(q,X,de,ye,Ce,De,He){super(q,X,de,ye,Ce,Wd,He),De&&(this.loadGeoJSON=De),this._dynamicIndex=new Wi}loadData(q,X){let de=q&&q.request,ye=de&&de.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(q,(Ce,De)=>{if(Ce||!De)return X(Ce);if(typeof De!="object")return X(new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`));{try{if(q.filter){let Pe=o.U(q.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Pe.result==="error")throw new Error(Pe.value.map(Ve=>`${Ve.key}: ${Ve.message}`).join(", "));De.features=De.features.filter(Ve=>Pe.value.evaluate({zoom:0},Ve))}q.dynamic?(De.type==="Feature"&&(De={type:"FeatureCollection",features:[De]}),q.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(De.features,this.loaded),q.cluster&&(De.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=q.cluster?new Ur((function({superclusterOptions:Pe,clusterProperties:Ve}){if(!Ve||!Pe)return Pe;let ht={},st={},Ht={accumulated:null,zoom:0},fn={properties:null},an=Object.keys(Ve);for(let Gt of an){let[Rn,zn]=Ve[Gt],Di=o.U(zn),_r=o.U(typeof Rn=="string"?[Rn,["accumulated"],["get",Gt]]:Rn);ht[Gt]=Di.value,st[Gt]=_r.value}return Pe.map=Gt=>{fn.properties=Gt;let Rn={};for(let zn of an)Rn[zn]=ht[zn].evaluate(Ht,fn);return Rn},Pe.reduce=(Gt,Rn)=>{fn.properties=Rn;for(let zn of an)Ht.accumulated=Gt[zn],Gt[zn]=st[zn].evaluate(Ht,fn)},Pe})(q)).load(De.features):q.dynamic?this._dynamicIndex:(function(Pe,Ve){return new Vl(Pe,Ve)})(De,q.geojsonVtOptions)}catch(Pe){return X(Pe)}let He={};if(ye){let Pe=E(de);Pe&&(He.resourceTiming={},He.resourceTiming[q.source]=JSON.parse(JSON.stringify(Pe)))}X(null,He)}})}reloadTile(q,X){let de=this.loaded;return de&&de[q.uid]?q.partial?X(null,void 0):super.reloadTile(q,X):this.loadTile(q,X)}loadGeoJSON(q,X){if(q.request)o.m(q.request,X);else{if(typeof q.data!="string")return X(new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return X(null,JSON.parse(q.data))}catch{return X(new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(q,X){try{X(null,this._geoJSONIndex.getClusterExpansionZoom(q.clusterId))}catch(de){X(de)}}getClusterChildren(q,X){try{X(null,this._geoJSONIndex.getChildren(q.clusterId))}catch(de){X(de)}}getClusterLeaves(q,X){try{X(null,this._geoJSONIndex.getLeaves(q.clusterId,q.limit,q.offset))}catch(de){X(de)}}}class zo{constructor(q,X,de){this.tileID=new o.aP(q.tileID.overscaledZ,q.tileID.wrap,q.tileID.canonical.z,q.tileID.canonical.x,q.tileID.canonical.y),this.tileZoom=q.tileZoom,this.uid=q.uid,this.zoom=q.zoom,this.canonical=q.tileID.canonical,this.pixelRatio=q.pixelRatio,this.tileSize=q.tileSize,this.source=q.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=q.projection,this.brightness=X,this.worldview=de}parse(q,X,de,ye){this.status="parsing";let Ce=new o.aP(de.tileID.overscaledZ,de.tileID.wrap,de.tileID.canonical.z,de.tileID.canonical.x,de.tileID.canonical.y),De=[],He=X.familiesBySource[de.source],Pe=new o.fm(Ce,de.promoteId);Pe.bucketLayerIDs=[],Pe.is3DTile=!0,o.fB(q).then(Ve=>{if(!Ve)return ye(new Error("Could not parse tile"));let ht=Ve.json.extensionsUsed&&Ve.json.extensionsUsed.includes("MAPBOX_mesh_features")||Ve.json.asset.extras&&Ve.json.asset.extras.MAPBOX_mesh_features,st=Ve.json.extensionsUsed&&Ve.json.extensionsUsed.includes("EXT_meshopt_compression"),Ht=new o.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(let fn in He)for(let an of He[fn]){let Gt=an[0];Pe.bucketLayerIDs.push(an.map(Di=>o.B(Di.id,Di.scope))),Gt.recalculate(Ht,[]);let Rn=o.fC(Ve,1/o.d6(de.tileID.canonical)),zn=new o.fD(an,Rn,Ce,ht,st,this.brightness,Pe,this.worldview);ht||(zn.needsUpload=!0),De.push(zn),zn.evaluate(Gt)}this.status="done",ye(null,{buckets:De,featureIndex:Pe,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Ve=>ye(new Error(Ve.message)))}}class Zd{constructor(q,X,de,ye,Ce,De,He,Pe){this.actor=q,this.layerIndex=X,this.availableImages=de,this.availableModels=ye,this.brightness=He,this.loading={},this.loaded={},this.worldview=Pe}loadTile(q,X){let de=q.uid,ye=this.loading[de]=new zo(q,this.brightness,this.worldview);o.bt(q.request,(Ce,De)=>{let He=!this.loading[de];return delete this.loading[de],He||Ce?(ye.status="done",He||(this.loaded[de]=ye),X(Ce)):De&&De.byteLength!==0?void ye.parse(De,this.layerIndex,q,(Pe,Ve)=>{ye.status="done",this.loaded=this.loaded||{},this.loaded[de]=ye,Pe||!Ve?X(Pe):X(null,Ve)}):(ye.status="done",this.loaded[de]=ye,X())})}reloadTile(q,X){let de=this.loaded,ye=q.uid;if(de&&de[ye]){let Ce=de[ye];Ce.projection=q.projection,Ce.brightness=q.brightness;let De=(He,Pe)=>{Ce.reloadCallback&&(delete Ce.reloadCallback,this.loadTile(q,X)),X(He,Pe)};Ce.status==="parsing"?Ce.reloadCallback=De:Ce.status==="done"&&this.loadTile(q,X)}}abortTile(q,X){let de=q.uid;this.loading[de]&&delete this.loading[de],X()}removeTile(q,X){let de=this.loaded,ye=q.uid;de&&de[ye]&&delete de[ye],X()}}class Xd{constructor(q){this.self=q,this.actor=new o.fF(q,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new o.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=o.cl({name:"mercator"}),this.workerSourceTypes={vector:Vn,geojson:Wn,"raster-dem":rr,"raster-array":Er,"batched-model":Zd},this.workerSources={},this.self.registerWorkerSource=(X,de)=>{if(this.workerSourceTypes[X])throw new Error(`Worker source with name "${X}" already registered.`);this.workerSourceTypes[X]=de},this.self.registerRTLTextPlugin=X=>{if(o.fG.isParsed())throw new Error("RTL text plugin already registered.");o.fG.setState({pluginStatus:o.fH.parsed,pluginURL:o.fG.getPluginURL()}),o.fG.applyArabicShaping=X.applyArabicShaping,o.fG.processBidirectionalText=X.processBidirectionalText,o.fG.processStyledBidirectionalText=X.processStyledBidirectionalText;for(let de of this.rtlPluginParsingListeners)de(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(q,X,de){delete this.layerIndexes[q],delete this.availableImages[q],delete this.availableModels[q],delete this.workerSources[q],de()}checkIfReady(q,X,de){de()}setReferrer(q,X){this.referrer=X}spriteLoaded(q,X){this.isSpriteLoaded[q]||(this.isSpriteLoaded[q]={});let{scope:de,isLoaded:ye}=X;if(this.isSpriteLoaded[q][de]=ye,this.workerSources[q]&&this.workerSources[q][de])for(let Ce in this.workerSources[q][de]){let De=this.workerSources[q][de][Ce];for(let He in De){let Pe=De[He];Pe instanceof Vn&&(Pe.isSpriteLoaded=ye,Pe.fire(new o.z("isSpriteLoaded")))}}}setImages(q,X,de){this.availableImages[q]||(this.availableImages[q]={});let{scope:ye,images:Ce}=X;if(this.availableImages[q][ye]=Ce,this.workerSources[q]&&this.workerSources[q][ye]){for(let De in this.workerSources[q][ye]){let He=this.workerSources[q][ye][De];for(let Pe in He)He[Pe].availableImages=Ce}de()}else de()}setModels(q,{scope:X,models:de},ye){if(this.availableModels[q]||(this.availableModels[q]={}),this.availableModels[q][X]=de,this.workerSources[q]&&this.workerSources[q][X]){for(let Ce in this.workerSources[q][X]){let De=this.workerSources[q][X][Ce];for(let He in De)De[He].availableModels=de}ye()}else ye()}setProjection(q,X){this.projections[q]=o.cl(X)}setBrightness(q,X,de){this.brightness=X,de()}setWorldview(q,X,de){this.worldview=X,de()}setLayers(q,X,de){this.getLayerIndex(q,X.scope).replace(X.layers,X.options),de()}updateLayers(q,X,de){this.getLayerIndex(q,X.scope).update(X.layers,X.removedIds,X.options),de()}loadTile(q,X,de){X.projection=this.projections[q]||this.defaultProjection,this.getWorkerSource(q,X.type,X.source,X.scope).loadTile(X,de)}decodeRasterArray(q,X,de){this.getWorkerSource(q,X.type,X.source,X.scope).decodeRasterArray(X,de)}reloadTile(q,X,de){X.projection=this.projections[q]||this.defaultProjection,this.getWorkerSource(q,X.type,X.source,X.scope).reloadTile(X,de)}abortTile(q,X,de){this.getWorkerSource(q,X.type,X.source,X.scope).abortTile(X,de)}removeTile(q,X,de){this.getWorkerSource(q,X.type,X.source,X.scope).removeTile(X,de)}removeSource(q,X,de){if(!(this.workerSources[q]&&this.workerSources[q][X.scope]&&this.workerSources[q][X.scope][X.type]&&this.workerSources[q][X.scope][X.type][X.source]))return;let ye=this.workerSources[q][X.scope][X.type][X.source];delete this.workerSources[q][X.scope][X.type][X.source],ye.removeSource!==void 0?ye.removeSource(X,de):de()}loadWorkerSource(q,X,de){try{this.self.importScripts(X.url),de()}catch(ye){de(ye.toString())}}syncRTLPluginState(q,X,de){if(o.fG.isParsed())de(null,!0);else if(o.fG.isParsing())this.rtlPluginParsingListeners.push(de);else try{o.fG.setState(X);let ye=o.fG.getPluginURL();!o.fG.isLoaded()||o.fG.isParsed()||o.fG.isParsing()||ye==null||(o.fG.setState({pluginStatus:o.fH.parsing,pluginURL:o.fG.getPluginURL()}),this.self.importScripts(ye),o.fG.isParsed()?de(null,!0):this.rtlPluginParsingListeners.push(de))}catch(ye){de(ye.toString())}}setDracoUrl(q,X){this.dracoUrl=X}getAvailableImages(q,X){this.availableImages[q]||(this.availableImages[q]={});let de=this.availableImages[q][X];return de||(de=[]),de}getAvailableModels(q,X){this.availableModels[q]||(this.availableModels[q]={});let de=this.availableModels[q][X];return de||(de={}),de}getLayerIndex(q,X){this.layerIndexes[q]||(this.layerIndexes[q]={});let de=this.layerIndexes[q][X];return de||(de=this.layerIndexes[q][X]=new Y,de.scope=X),de}getWorkerSource(q,X,de,ye){let Ce=this.workerSources;return Ce[q]||(Ce[q]={}),Ce[q][ye]||(Ce[q][ye]={}),Ce[q][ye][X]||(Ce[q][ye][X]={}),this.isSpriteLoaded[q]||(this.isSpriteLoaded[q]={}),Ce[q][ye][X][de]||(Ce[q][ye][X][de]=new this.workerSourceTypes[X]({send:(De,He,Pe,Ve,ht,st)=>this.actor.send(De,He,Pe,q,ht,st),scheduler:this.actor.scheduler},this.getLayerIndex(q,ye),this.getAvailableImages(q,ye),this.getAvailableModels(q,ye),this.isSpriteLoaded[q][ye],void 0,this.brightness,this.worldview)),Ce[q][ye][X][de]}rasterizeImagesWorker(q,X,de){let ye=new Map;for(let[Ce,{image:De,imageVariant:He}]of X.tasks.entries()){let Pe=this.imageRasterizer.rasterize(He,De,X.scope,q);ye.set(Ce,Pe)}de(void 0,ye)}removeRasterizedImages(q,X,de){this.imageRasterizer.removeImagesFromCacheByIds(X.imageIds,X.scope,q),de()}enforceCacheSizeLimit(q,X){o.fI(X)}getWorkerPerformanceMetrics(q,X,de){de(void 0,void 0)}}return o.fE(self)&&(self.worker=new Xd(self)),Xd}),l(["./shared"],function(o){var E="3.16.0";let A={create:"create",load:"load",fullLoad:"fullLoad"},L={mark(f){performance.mark(f)},measure(f,r,c){performance.measure(f,r,c)}};function Y(f){let r=f.name.split("?")[0];return o.a(r)&&r.includes("mapbox-gl.js")?"javascript":o.a(r)&&r.includes("mapbox-gl.css")?"css":o.b(r)?"fontRange":o.c(r)?"sprite":o.i(r)?"style":o.d(r)?"tilejson":"other"}var le,te={},ze=(function(){if(le)return te;function f(p){return!r(p)}function r(p){return typeof window>"u"||typeof document>"u"?"not a browser":(function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var y,x,C=new Blob([""],{type:"text/javascript"}),T=URL.createObjectURL(C);try{x=new Worker(T),y=!0}catch{y=!1}return x&&x.terminate(),URL.revokeObjectURL(T),y})()?(function(){var y=document.createElement("canvas");y.width=y.height=1;var x=y.getContext("2d");if(!x)return!1;var C=x.getImageData(0,0,1,1);return C&&C.width===y.width})()?(c[_=p&&p.failIfMajorPerformanceCaveat]===void 0&&(c[_]=(function(y){var x,C=(function(T){var M=document.createElement("canvas"),P=Object.create(f.webGLContextAttributes);return P.failIfMajorPerformanceCaveat=T,M.getContext("webgl2",P)})(y);if(!C)return!1;try{x=C.createShader(C.VERTEX_SHADER)}catch{return!1}return!(!x||C.isContextLost())&&(C.shaderSource(x,"void main() {}"),C.compileShader(x),C.getShaderParameter(x,C.COMPILE_STATUS)===!0)})(_)),c[_]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var _}le=1,te.supported=f,te.notSupportedReason=r;var c={};return f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},te})();function Ae(f,r,c){let p=document.createElement(f);return r!=null&&(p.className=r),c&&c.appendChild(p),p}function Be(f,r,c){let p=document.createElementNS("http://www.w3.org/2000/svg",f);for(let _ of Object.keys(r))p.setAttributeNS(null,_,String(r[_]));return c&&c.appendChild(p),p}let Tt=typeof document<"u"?document.documentElement&&document.documentElement.style:null,ot=Tt&&Tt.userSelect!==void 0?"userSelect":"WebkitUserSelect",kt;function Cn(){Tt&&ot&&(kt=Tt[ot],Tt[ot]="none")}function Xn(){Tt&&ot&&(Tt[ot]=kt)}function On(f){f.preventDefault(),f.stopPropagation(),window.removeEventListener("click",On,!0)}function Vn(){window.addEventListener("click",On,!0),window.setTimeout(()=>{window.removeEventListener("click",On,!0)},0)}function rr(f,r){let c=f.getBoundingClientRect();return $n(f,c,r)}function Vi(f,r){let c=f.getBoundingClientRect(),p=[];for(let _=0;_<r.length;_++)p.push($n(f,c,r[_]));return p}function Er(f){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&f.button===2&&f.ctrlKey?0:f.button}function $n(f,r,c){let p=f.offsetWidth===r.width?1:f.offsetWidth/r.width;return new o.P((c.clientX-r.left)*p,(c.clientY-r.top)*p)}let Qi="01",Rt="NO_ACCESS_TOKEN";class en{constructor(r,c,p){this._transformRequestFn=r,this._customAccessToken=c,this._silenceAuthErrors=!!p,this._createSkuToken()}_createSkuToken(){let r=(function(){let c="";for(let p=0;p<10;p++)c+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Qi,c].join(""),tokenExpiresAt:Date.now()+432e5}})();this._skuToken=r.token,this._skuTokenExpiresAt=r.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(r,c){return this._transformRequestFn&&this._transformRequestFn(r,c)||{url:r}}normalizeStyleURL(r,c){if(!o.h(r))return r;let p=Fi(r);return p.params.push(`sdk=js-${E}`),p.path=`/styles/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||c)}normalizeGlyphsURL(r,c){if(!o.h(r))return r;let p=Fi(r);return p.path=`/fonts/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||c)}normalizeModelURL(r,c){if(!o.h(r))return r;let p=Fi(r);return p.path=`/models/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||c)}normalizeSourceURL(r,c,p,_){if(!o.h(r))return r;let y=Fi(r);return y.path=`/v4/${y.authority}.json`,y.params.push("secure"),p&&y.params.push(`language=${p}`),_&&y.params.push(`worldview=${_}`),this._makeAPIURL(y,this._customAccessToken||c)}normalizeIconsetURL(r,c){let p=Fi(r);return o.h(r)?(p.path=`/styles/v1${p.path}/iconset.pbf`,this._makeAPIURL(p,this._customAccessToken||c)):Wi(p)}normalizeSpriteURL(r,c,p,_){let y=Fi(r);return o.h(r)?(y.path=`/styles/v1${y.path}/sprite${c}${p}`,this._makeAPIURL(y,this._customAccessToken||_)):(y.path+=`${c}${p}`,Wi(y))}normalizeTileURL(r,c,p){if(this._isSkuTokenExpired()&&this._createSkuToken(),r&&!o.h(r))return r;let _=Fi(r);_.path=_.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${c||p&&_.authority!=="raster"&&p===512?"@2x":""}${o.k.supported?".webp":"$1"}`),_.authority==="raster"?_.path=`/${o.e.RASTER_URL_PREFIX}${_.path}`:_.authority==="rasterarrays"?_.path=`/${o.e.RASTERARRAYS_URL_PREFIX}${_.path}`:_.authority==="3dtiles"?_.path=`/${o.e.TILES3D_URL_PREFIX}${_.path}`:(_.path=_.path.replace(/^.+\/v4\//,"/"),_.path=`/${o.e.TILE_URL_VERSION}${_.path}`);let y=this._customAccessToken||(function(x){for(let C of x){let T=C.match(/^access_token=(.*)$/);if(T)return T[1]}return null})(_.params)||o.e.ACCESS_TOKEN;return o.e.REQUIRE_ACCESS_TOKEN&&y&&this._skuToken&&_.params.push(`sku=${this._skuToken}`),this._makeAPIURL(_,y)}canonicalizeTileURL(r,c){let p=Fi(r);if(!p.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!p.path.match(/\.[\w]+$/))return r;let _="mapbox://";p.path.match(/^\/raster\/v1\//)?_+=`raster/${p.path.replace(`/${o.e.RASTER_URL_PREFIX}/`,"")}`:p.path.match(/^\/rasterarrays\/v1\//)?_+=`rasterarrays/${p.path.replace(`/${o.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:_+=`tiles/${p.path.replace(`/${o.e.TILE_URL_VERSION}/`,"")}`;let y=p.params;return c&&(y=y.filter(x=>!x.match(/^access_token=/))),y.length&&(_+=`?${y.join("&")}`),_}canonicalizeTileset(r,c){let p=!!c&&o.h(c),_=[];for(let y of r.tiles||[])o.j(y)?_.push(this.canonicalizeTileURL(y,p)):_.push(y);return _}_makeAPIURL(r,c){let p="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",_=Fi(o.e.API_URL);if(r.protocol=_.protocol,r.authority=_.authority,r.protocol==="http"){let y=r.params.indexOf("secure");y>=0&&r.params.splice(y,1)}if(_.path!=="/"&&(r.path=`${_.path}${r.path}`),!o.e.REQUIRE_ACCESS_TOKEN)return Wi(r);if(c=c||o.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!c)throw new Error(`An API access token is required to use Mapbox GL. ${p}`);if(c[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${p}`)}return r.params=r.params.filter(y=>y.indexOf("access_token")===-1),r.params.push(`access_token=${c||""}`),Wi(r)}}let ai=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Fi(f){let r=f.match(ai);if(!r)throw new Error("Unable to parse URL object");return{protocol:r[1],authority:r[2],path:r[3]||"/",params:r[4]?r[4].split("&"):[]}}function Wi(f){let r=f.params.length?`?${f.params.join("&")}`:"";return`${f.protocol}://${f.authority}${f.path}${r}`}let Pr="mapbox.eventData";function Oo(f){if(!f)return null;let r=f.split(".");if(!r||r.length!==3)return null;try{return JSON.parse(o.l(r[1]))}catch{return null}}class ks{constructor(r){this.type=r,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(r){let c=Oo(o.e.ACCESS_TOKEN),p="";return p=c&&c.u?o.f(c.u):o.e.ACCESS_TOKEN||"",r?`${Pr}.${r}:${p}`:`${Pr}:${p}`}fetchEventData(){let r=o.s("localStorage"),c=this.getStorageKey(),p=this.getStorageKey("uuid"),_=this.getStorageKey("uuidTimestamp");if(r)try{let y=localStorage.getItem(c);y&&(this.eventData=JSON.parse(y));let x=localStorage.getItem(p);x&&(this.anonId=x);let C=localStorage.getItem(_);C&&(this.anonIdTimestamp=Number(C));let T=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<T)&&this.refreshUUID()}catch{o.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=o.u(),this.anonIdTimestamp=Date.now()}saveEventData(){let r=o.s("localStorage"),c=this.getStorageKey(),p=this.getStorageKey("uuid"),_=this.getStorageKey("uuidTimestamp"),y=this.anonId,x=this.anonIdTimestamp;if(r&&y)try{localStorage.setItem(p,y),Object.keys(this.eventData).length>=1&&localStorage.setItem(c,JSON.stringify(this.eventData)),x&&localStorage.setItem(_,x.toString())}catch{o.w("Unable to write to LocalStorage")}}processRequests(r){}postEvent(r,c,p,_){if(!o.e.EVENTS_URL)return;let y=Fi(o.e.EVENTS_URL);y.params.push(`access_token=${_||o.e.ACCESS_TOKEN||""}`);let x={event:this.type,created:new Date(r).toISOString()},C=c?Object.assign(x,c):x,T={url:Wi(y),headers:{"Content-Type":"text/plain"},body:JSON.stringify([C])};this.pendingRequest=o.p(T,M=>{this.pendingRequest=null,p(M),this.saveEventData(),this.processRequests(_)})}queueRequest(r,c){this.queue.push(r),this.processRequests(c)}}let Fs=new class extends ks{constructor(f){super("appUserTurnstile"),this._customAccessToken=f}postTurnstileEvent(f,r){o.e.EVENTS_URL&&o.e.ACCESS_TOKEN&&Array.isArray(f)&&f.some(c=>o.h(c)||o.j(c))&&this.queueRequest(Date.now(),r)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let r=Oo(o.e.ACCESS_TOKEN),c=r?r.u:o.e.ACCESS_TOKEN,p=c!==this.eventData.tokenU;o.v(this.anonId)||(this.refreshUUID(),p=!0);let _=this.queue.shift();if(this.eventData.lastSuccess){let y=new Date(this.eventData.lastSuccess),x=new Date(_),C=(_-this.eventData.lastSuccess)/864e5;p=p||C>=1||C<-1||y.getDate()!==x.getDate()}else p=!0;p?this.postEvent(_,{sdkIdentifier:"mapbox-gl-js",sdkVersion:E,skuId:Qi,"enabled.telemetry":!1,userId:this.anonId},y=>{y||(this.eventData.lastSuccess=_,this.eventData.tokenU=c)},f):this.processRequests()}},eo=Fs.postTurnstileEvent.bind(Fs),Ui=new class extends ks{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(f,r,c,p){this.skuToken=r,this.errorCb=p,o.e.EVENTS_URL&&(c||o.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},c):this.errorCb(new Error(Rt)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;let{id:r,timestamp:c}=this.queue.shift();r&&this.success[r]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),o.v(this.anonId)||this.refreshUUID(),this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:E,skuId:Qi,skuToken:this.skuToken,userId:this.anonId},p=>{p?this.errorCb(p):r&&(this.success[r]=!0)},f))}remove(){this.errorCb=null}},Do=Ui.postMapLoadEvent.bind(Ui),Nu=new class extends ks{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(f){let r=this.mapInstanceIdMap.get(f);return r||(r=o.u(),this.mapInstanceIdMap.set(f,r)),r}getEventId(f){let r=this.eventIdPerMapInstanceMap.get(f)||0;return this.eventIdPerMapInstanceMap.set(f,r+1),r}postStyleLoadEvent(f,r){let{map:c,style:p,importedStyles:_}=r;if(!o.e.EVENTS_URL||!f&&!o.e.ACCESS_TOKEN)return;let y=this.getMapInstanceId(c),x={mapInstanceId:y,eventId:this.getEventId(y),style:p};_.length&&(x.importedStyles=_),this.queueRequest({timestamp:Date.now(),payload:x},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:r,payload:c}=this.queue.shift();this.postEvent(r,c,()=>{},f)}},$a=Nu.postStyleLoadEvent.bind(Nu),Bl=new class extends ks{constructor(f){super("metrics"),f&&(this.data=f)}postMetricsEvent(f){if(!o.e.EVENTS_URL||!f&&!o.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),o.v(this.anonId)||this.refreshUUID();let r=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:r},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:r,payload:c}=this.queue.shift();this.postEvent(r,c,()=>{},f)}}({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),Ga=Bl.postMetricsEvent.bind(Bl),Li=new class extends ks{constructor(){super("gljs.performance")}postPerformanceEvent(f,r){o.e.EVENTS_URL&&(f||o.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:r},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:r,performanceData:c}=this.queue.shift(),p=(function(_){let y=performance.getEntriesByType("resource"),x=performance.getEntriesByType("mark"),C=(function(z){let V={};if(z){for(let H in z)if(H!=="other")for(let K of z[H]){let Z=`${H}ResolveRangeMin`,Q=`${H}ResolveRangeMax`,ae=`${H}RequestCount`,re=`${H}RequestCachedCount`;V[Z]=Math.min(V[Z]||1/0,K.startTime),V[Q]=Math.max(V[Q]||-1/0,K.responseEnd);let ge=ce=>{V[ce]===void 0&&(V[ce]=0),++V[ce]};K.transferSize!==void 0&&K.transferSize===0&&ge(re),ge(ae)}}return V})((function(z,V){let H={};if(z)for(let K of z){let Z=V(K);H[Z]===void 0&&(H[Z]=[]),H[Z].push(K)}return H})(y,Y)),T=window.devicePixelRatio,M=navigator.connection||navigator.mozConnection||navigator.webkitConnection,P=M?M.effectiveType:void 0,F={counters:[],metadata:[],attributes:[]},O=(z,V,H)=>{H!=null&&z.push({name:V,value:H.toString()})};for(let z in C)O(F.counters,z,C[z]);if(_.interactionRange[0]!==1/0&&_.interactionRange[1]!==-1/0&&(O(F.counters,"interactionRangeMin",_.interactionRange[0]),O(F.counters,"interactionRangeMax",_.interactionRange[1])),x)for(let z of Object.values(A)){let V=x.find(H=>H.name===z);V&&O(F.counters,z,V.startTime)}return O(F.counters,"visibilityHidden",_.visibilityHidden),O(F.attributes,"style",(function(z){if(z)for(let V of z){let H=V.name.split("?")[0];if(o.i(H)){let K=H.split("/").slice(-2);if(K.length===2)return`mapbox://styles/${K[0]}/${K[1]}`}}})(y)),O(F.attributes,"terrainEnabled",_.terrainEnabled?"true":"false"),O(F.attributes,"fogEnabled",_.fogEnabled?"true":"false"),O(F.attributes,"projection",_.projection),O(F.attributes,"zoom",_.zoom),O(F.metadata,"devicePixelRatio",T),O(F.metadata,"connectionEffectiveType",P),O(F.metadata,"navigatorUserAgent",navigator.userAgent),O(F.metadata,"screenWidth",window.screen.width),O(F.metadata,"screenHeight",window.screen.height),O(F.metadata,"windowWidth",window.innerWidth),O(F.metadata,"windowHeight",window.innerHeight),O(F.metadata,"mapWidth",_.width/T),O(F.metadata,"mapHeight",_.height/T),O(F.metadata,"webglRenderer",_.renderer),O(F.metadata,"webglVendor",_.vendor),O(F.metadata,"sdkVersion",E),O(F.metadata,"sdkIdentifier","mapbox-gl-js"),F})(c);for(let _ of p.metadata);for(let _ of p.counters);for(let _ of p.attributes);this.postEvent(r,p,()=>{},f)}},Vr=Li.postPerformanceEvent.bind(Li),Ro=new class extends ks{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(f,r,c,p){if(!o.e.API_URL||!o.e.SESSION_PATH)return;let _=Fi(o.e.API_URL+o.e.SESSION_PATH);_.params.push(`sku=${r||""}`),_.params.push(`access_token=${p||o.e.ACCESS_TOKEN||""}`);let y={url:Wi(_),headers:{"Content-Type":"text/plain"}};this.pendingRequest=o.g(y,x=>{this.pendingRequest=null,c(x),this.saveEventData(),this.processRequests(p)})}getSessionAPI(f,r,c,p){this.skuToken=r,this.errorCb=p,o.e.SESSION_PATH&&o.e.API_URL&&(c||o.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},c):this.errorCb(new Error(Rt)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;let{id:r,timestamp:c}=this.queue.shift();r&&this.success[r]||this.getSession(c,this.skuToken,p=>{p?this.errorCb(p):r&&(this.success[r]=!0)},f)}remove(){this.errorCb=null}},hc=Ro.getSessionAPI.bind(Ro),pr=new Set;function qa(f,r){r?pr.add(f):pr.delete(f)}class ua{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(r,c){this._updatedSourceCaches[r]=c,this.setDirty()}discardSourceCacheUpdate(r){delete this._updatedSourceCaches[r]}updateLayer(r){let c=r.scope;this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._updatedLayers[c].add(r.id),this.setDirty()}removeLayer(r){let c=r.scope;this._removedLayers[c]=this._removedLayers[c]||{},this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._removedLayers[c][r.id]=r,this._updatedLayers[c].delete(r.id),this._updatedPaintProps.delete(r.fqid),this.setDirty()}getRemovedLayer(r){return this._removedLayers[r.scope]?this._removedLayers[r.scope][r.id]:null}discardLayerRemoval(r){this._removedLayers[r.scope]&&delete this._removedLayers[r.scope][r.id]}getLayerUpdatesByScope(){let r={};for(let c in this._updatedLayers)r[c]=r[c]||{},r[c].updatedIds=Array.from(this._updatedLayers[c].values());for(let c in this._removedLayers)r[c]=r[c]||{},r[c].removedIds=Object.keys(this._removedLayers[c]);return r}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(r){this._updatedPaintProps.add(r.fqid),this.setDirty()}getUpdatedImages(r){return this._updatedImages[r]?Array.from(this._updatedImages[r].values()):[]}updateImage(r,c){this._updatedImages[c]=this._updatedImages[c]||new Set,this._updatedImages[c].add(o.I.toString(r)),this.setDirty()}resetUpdatedImages(r){this._updatedImages[r]&&this._updatedImages[r].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function co(f){let{userImage:r}=f;return!!(r&&r.render&&r.render())&&(f.data.replace(new Uint8Array(r.data.buffer)),!0)}class Wo extends o.E{constructor(r){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=r,r!=="raster"&&o.r()&&(this.imageRasterizerDispatcher=new o.D(o.t(),this,"Image Rasterizer Worker",1))}addScope(r){this.loaded.set(r,!1),this.imageProviders.set(r,new Map),this.images.set(r,new Map),this.updatedImages.set(r,new Set),this.callbackDispatchedThisFrame.set(r,new Set),this.patterns.set(r,new Map),this.atlasImage.set(r,new o.q({width:1,height:1}))}removeScope(r){this.loaded.delete(r),this.imageProviders.delete(r),this.images.delete(r),this.updatedImages.delete(r),this.callbackDispatchedThisFrame.delete(r),this.patterns.delete(r),this.atlasImage.delete(r);let c=this.atlasTexture.get(r);c&&(c.destroy(),this.atlasTexture.delete(r))}addImageProvider(r,c){this.imageProviders.has(c)||this.imageProviders.set(c,new Map),this.imageProviders.get(c).set(r.id,r)}removeImageProvider(r,c){this.imageProviders.has(c)&&this.imageProviders.get(c).delete(r)}getPendingImageProviders(){let r=[];for(let c of this.imageProviders.values())for(let p of c.values())p.hasPendingRequests()&&r.push(p);return r}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new o.x),this._imageRasterizer}isLoaded(){for(let r of this.loaded.keys())if(!this.loaded.get(r))return!1;return!0}setLoaded(r,c){if(this.loaded.get(c)!==r&&(this.loaded.set(c,r),r)){for(let{ids:p,callback:_}of this.requestors)this._notify(p,c,_);this.requestors=[]}}hasImage(r,c){return!!this.getImage(r,c)}getImage(r,c){return this.images.get(c).get(r.toString())}addImage(r,c,p){this._validate(r,p)&&this.images.get(c).set(r.toString(),p)}_validate(r,c){let p=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new o.y(new Error(`Image "${r.name}" has invalid "stretchX" value`))),p=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new o.y(new Error(`Image "${r.name}" has invalid "stretchY" value`))),p=!1),this._validateContent(c.content,c)||(this.fire(new o.y(new Error(`Image "${r.name}" has invalid "content" value`))),p=!1),p}_validateStretch(r,c){if(!r)return!0;let p=0;for(let _ of r){if(_[0]<p||_[1]<_[0]||c<_[1])return!1;p=_[1]}return!0}_validateContent(r,c){return r?r.length!==4||!c.usvg&&(r[0]<0||c.data.width<r[0]||r[1]<0||c.data.height<r[1]||r[2]<0||c.data.width<r[2]||r[3]<0||c.data.height<r[3])?!1:!(r[2]<r[0]||r[3]<r[1]):!0}updateImage(r,c,p){let _=this.images.get(c).get(r.toString());p.version=_.version+1,this.images.get(c).set(r.toString(),p),this.updatedImages.get(c).add(r),this.removeFromImageRasterizerCache(r,c)}clearUpdatedImages(r){this.updatedImages.get(r).clear()}removeFromImageRasterizerCache(r,c){this.spriteFormat!=="raster"&&(o.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[r],scope:c}):this.imageRasterizer.removeImagesFromCacheByIds([r],c))}removeImage(r,c){let p=this.images.get(c),_=p.get(r.toString());p.delete(r.toString()),this.patterns.get(c).delete(r.toString()),this.removeFromImageRasterizerCache(r,c),_.userImage&&_.userImage.onRemove&&_.userImage.onRemove()}listImages(r){return Array.from(this.images.get(r).keys()).map(c=>o.I.from(c))}getImages(r,c,p){let _=[],y=[],x=this.imageProviders.get(c);for(let P of r){if(!P.iconsetId){_.push(P);continue}let F=x.get(P.iconsetId);F&&(this.getImage(P,c)?y.push(P):F.addPendingRequest(P))}if(_.length===0)return void this._notify(y,c,p);let C=!0,T=!!this.loaded.get(c),M=this.images.get(c);if(!T)for(let P of _)M.has(P.toString())||(C=!1);T||C?this._notify(_,c,p):this.requestors.push({ids:_,scope:c,callback:p})}rasterizeImages(r,c){let p=new Map,{tasks:_,scope:y}=r;for(let[x,C]of _.entries()){let T=this.getImage(C.id,y);T&&p.set(x,{image:T,imageVariant:C})}this._rasterizeImages(y,p,c)}_rasterizeImages(r,c,p){if(o.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:c,scope:r},p);else{let _=new Map;for(let[y,{image:x,imageVariant:C}]of c.entries())_.set(y,this.imageRasterizer.rasterize(C,x,r,0));p(void 0,_)}}getUpdatedImages(r){return this.updatedImages.get(r)||new Set}_notify(r,c,p){let _=this.images.get(c),y=new Map;for(let x of r){if(!_.get(x.toString())){if(x.iconsetId)continue;this.fire(new o.z("styleimagemissing",{id:x.name}))}let C=_.get(x.toString());if(!C){o.w(`Image "${x.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}let T={data:C.usvg?null:C.data.clone(),pixelRatio:C.pixelRatio,sdf:C.sdf,usvg:C.usvg,version:C.version,stretchX:C.stretchX,stretchY:C.stretchY,content:C.content,hasRenderCallback:!!(C.userImage&&C.userImage.render)};C.usvg&&Object.assign(T,{width:C.icon.usvg_tree.width,height:C.icon.usvg_tree.height}),y.set(o.I.toString(x),T)}p(null,y)}getPixelSize(r){let{width:c,height:p}=this.atlasImage.get(r);return{width:c,height:p}}getPattern(r,c,p){let _=r.toString(),y=this.patterns.get(c),x=y.get(_),C=this.getImage(r,c);if(!C)return null;if(x){if(x.position.version===C.version)return x.position;x.position.version=C.version}else{if(C.usvg&&!C.data){let T=this.getPatternInFlightId(_,c);if(this.patternsInFlight.has(T))return null;this.patternsInFlight.add(T);let M=new o.A(r).scaleSelf(o.o.devicePixelRatio),P=new Map([[M.toString(),{image:C,imageVariant:M}]]);return this._rasterizeImages(c,P,(F,O)=>this.storePatternImage(M,c,C,p,O)),null}this.storePattern(r,c,C)}return this._updatePatternAtlas(c,p),y.get(_).position}getPatternInFlightId(r,c){return o.B(r,c)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(r,c,p,_,y){let x=r.toString(),C=y?y.get(x):void 0;C&&(p.data=C,this.storePattern(r.id,c,p),this._updatePatternAtlas(c,_),this.patternsInFlight.delete(this.getPatternInFlightId(r.id.toString(),c)))}storePattern(r,c,p){let _={w:p.data.width+2*o.C,h:p.data.height+2*o.C,x:0,y:0},y=new o.F(_,p,o.C);this.patterns.get(c).set(r.toString(),{bin:_,position:y})}destroyAtlasTextures(){for(let r of this.atlasTexture.values())r&&r.destroy();this.atlasTexture.clear()}bind(r,c){let p=r.gl,_=this.atlasTexture.get(c);_?this.dirty&&(_.update(this.atlasImage.get(c)),this.dirty=!1):(_=new o.T(r,this.atlasImage.get(c),p.RGBA8),this.atlasTexture.set(c,_)),_.bind(p.LINEAR,p.CLAMP_TO_EDGE)}_updatePatternAtlas(r,c){let p=this.patterns.get(r),_=Array.from(p.values()).map(({bin:M})=>M),{w:y,h:x}=o.G(_),C=this.atlasImage.get(r);C.resize({width:y||1,height:x||1});let T=this.images.get(r);for(let[M,{bin:P,position:F}]of p.entries()){let O=F.padding,z=P.x+O,V=P.y+O,H=T.get(M).data,K=H.width,Z=H.height;O=O>1?O-1:O,o.q.copy(H,C,{x:0,y:0},{x:z,y:V},{width:K,height:Z},c),o.q.copy(H,C,{x:0,y:Z-O},{x:z,y:V-O},{width:K,height:O},c),o.q.copy(H,C,{x:0,y:0},{x:z,y:V+Z},{width:K,height:O},c),o.q.copy(H,C,{x:K-O,y:0},{x:z-O,y:V},{width:O,height:Z},c),o.q.copy(H,C,{x:0,y:0},{x:z+K,y:V},{width:O,height:Z},c),o.q.copy(H,C,{x:K-O,y:Z-O},{x:z-O,y:V-O},{width:O,height:O},c),o.q.copy(H,C,{x:0,y:Z-O},{x:z+K,y:V-O},{width:O,height:O},c),o.q.copy(H,C,{x:0,y:0},{x:z+K,y:V+Z},{width:O,height:O},c),o.q.copy(H,C,{x:K-O,y:0},{x:z-O,y:V+Z},{width:O,height:O},c)}this.dirty=!0}beginFrame(){for(let r of this.images.keys())this.callbackDispatchedThisFrame.set(r,new Set)}dispatchRenderCallbacks(r,c){let p=this.images.get(c);for(let _ of r){if(this.callbackDispatchedThisFrame.get(c).has(_.toString()))continue;this.callbackDispatchedThisFrame.get(c).add(_.toString());let y=p.get(_.toString());co(y)&&this.updateImage(_,c,y)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function Ur(f){let r=f.value,c=f.valueSpec,p=f.style,_=f.styleSpec,y=f.key,x=f.arrayElementValidator||gr;if(!Array.isArray(r))return[new o.V(y,r,`array expected, ${o.K(r)} found`)];if(c.length&&r.length!==c.length)return[new o.V(y,r,`array length ${c.length} expected, length ${r.length} found`)];if(c["min-length"]&&r.length<c["min-length"])return[new o.V(y,r,`array length at least ${c["min-length"]} expected, length ${r.length} found`)];let C={type:c.value,values:c.values,minimum:c.minimum,maximum:c.maximum,function:void 0};_.$version<7&&(C.function=c.function),o.H(c.value)&&(C=c.value);let T=[];for(let M=0;M<r.length;M++)T=T.concat(x({array:r,arrayIndex:M,value:r[M],valueSpec:C,style:p,styleSpec:_,key:`${y}[${M}]`},!0));return T}function os(f){let r=f.key,c=f.value,p=f.valueSpec;if(!o.L(c))return[new o.V(r,c,`number expected, ${o.K(c)} found`)];if(c!=c)return[new o.V(r,c,"number expected, NaN found")];if("minimum"in p){let _=p.minimum;if(Array.isArray(p.minimum)&&(_=p.minimum[f.arrayIndex]),c<_)return[new o.V(r,c,`${c} is less than the minimum value ${_}`)]}if("maximum"in p){let _=p.maximum;if(Array.isArray(p.maximum)&&(_=p.maximum[f.arrayIndex]),c>_)return[new o.V(r,c,`${c} is greater than the maximum value ${_}`)]}return[]}function _l(f){let r=f.key,c=f.value;if(!o.H(c))return[new o.V(r,c,`object expected, ${o.K(c)} found`)];let p=f.valueSpec,_=o.J(c.type),y,x,C,T={},M=_!=="categorical"&&c.property===void 0,P=!M,F=(function(H){let K=H.stops;return Array.isArray(K)&&Array.isArray(K[0])&&o.H(K[0][0])})(c),O=Zo({key:f.key,value:f.value,valueSpec:f.styleSpec.function,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(H){if(_==="identity")return[new o.V(H.key,H.value,'identity function may not have a "stops" property')];let K=[],Z=H.value;return K=K.concat(Ur({key:H.key,value:Z,valueSpec:H.valueSpec,style:H.style,styleSpec:H.styleSpec,arrayElementValidator:z})),Array.isArray(Z)&&Z.length===0&&K.push(new o.V(H.key,Z,"array must have at least one stop")),K},default:function(H){return gr({key:H.key,value:H.value,valueSpec:p,style:H.style,styleSpec:H.styleSpec})}}});return _==="identity"&&M&&O.push(new o.V(f.key,f.value,'missing required property "property"')),_==="identity"||c.stops||O.push(new o.V(f.key,f.value,'missing required property "stops"')),_==="exponential"&&p.expression&&!o.M(p)&&O.push(new o.V(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(P&&!o.N(p)?O.push(new o.V(f.key,f.value,"property functions not supported")):M&&!o.O(p)&&O.push(new o.V(f.key,f.value,"zoom functions not supported"))),_!=="categorical"&&!F||c.property!==void 0||O.push(new o.V(f.key,f.value,'"property" property is required')),O;function z(H){let K=[],Z=H.value,Q=H.key;if(!Array.isArray(Z))return[new o.V(Q,Z,`array expected, ${o.K(Z)} found`)];if(Z.length!==2)return[new o.V(Q,Z,`array length 2 expected, length ${Z.length} found`)];if(F){if(!o.H(Z[0]))return[new o.V(Q,Z,`object expected, ${o.K(Z[0])} found`)];let ae=Z[0];if(ae.zoom===void 0)return[new o.V(Q,Z,"object stop key must have zoom")];if(ae.value===void 0)return[new o.V(Q,Z,"object stop key must have value")];let re=o.J(ae.zoom);if(typeof re!="number")return[new o.V(Q,ae.zoom,"stop zoom values must be numbers")];if(C&&C>re)return[new o.V(Q,ae.zoom,"stop zoom values must appear in ascending order")];re!==C&&(C=re,x=void 0,T={}),K=K.concat(Zo({key:`${Q}[0]`,value:Z[0],valueSpec:{zoom:{}},style:H.style,styleSpec:H.styleSpec,objectElementValidators:{zoom:os,value:V}}))}else K=K.concat(V({key:`${Q}[0]`,value:Z[0],style:H.style,styleSpec:H.styleSpec},Z));return o.Q(o.S(Z[1]))?K.concat([new o.V(`${Q}[1]`,Z[1],"expressions are not allowed in function stops.")]):K.concat(gr({key:`${Q}[1]`,value:Z[1],valueSpec:p,style:H.style,styleSpec:H.styleSpec}))}function V(H,K){let Z=o.K(H.value),Q=o.J(H.value),ae=H.value!==null?H.value:K;if(y){if(Z!==y)return[new o.V(H.key,ae,`${Z} stop domain type must match previous stop domain type ${y}`)]}else y=Z;if(Z!=="number"&&Z!=="string"&&Z!=="boolean"&&typeof Q!="number"&&typeof Q!="string"&&typeof Q!="boolean")return[new o.V(H.key,ae,"stop domain value must be a number, string, or boolean")];if(Z!=="number"&&_!=="categorical"){let re=`number expected, ${Z} found`;return o.N(p)&&_===void 0&&(re+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new o.V(H.key,ae,re)]}return _!=="categorical"||Z!=="number"||typeof Q=="number"&&isFinite(Q)&&Math.floor(Q)===Q?_!=="categorical"&&Z==="number"&&typeof Q=="number"&&typeof x=="number"&&x!==void 0&&Q<x?[new o.V(H.key,ae,"stop domain values must appear in ascending order")]:(x=Q,_==="categorical"&&Q in T?[new o.V(H.key,ae,"stop domain values must be unique")]:(T[Q]=!0,[])):[new o.V(H.key,ae,`integer expected, found ${String(Q)}`)]}}function Ls(f){let r=(f.expressionContext==="property"?o.W:o.U)(o.S(f.value),f.valueSpec);if(r.result==="error")return r.value.map(p=>new o.V(`${f.key}${p.key}`,f.value,p.message));let c=r.value.expression||r.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!c.outputDefined())return[new o.V(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!o.Z(c))return[new o.V(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter")return jl(c,f);if(f.expressionContext==="appearance")return lr(c,f);if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!o.X(c,["zoom","feature-state"]))return[new o.V(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!o.Y(c))return[new o.V(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function jl(f,r){let c=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(let _ of r.valueSpec.expression.parameters)c.delete(_);if(c.size===0)return[];let p=[];return f instanceof o._&&c.has(f.name)?[new o.V(r.key,r.value,`["${f.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(f.eachChild(_=>{p.push(...jl(_,r))}),p)}function lr(f,r){let c=new Set;if(r.valueSpec&&r.valueSpec.expression)for(let _ of r.valueSpec.expression.parameters)c.add(_);if(c.size===0)return[];let p=[];return f instanceof o._&&!c.has(f.name)?[new o.V(r.key,r.value,`["${f.name}"] is not an allowed parameter`)]:(f.eachChild(_=>{p.push(...lr(_,r))}),p)}function Hr(f){let r=f.key,c=f.value,p=f.valueSpec,_=[];return Array.isArray(p.values)?p.values.indexOf(o.J(c))===-1&&_.push(new o.V(r,c,`expected one of [${p.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(p.values).indexOf(o.J(c))===-1&&_.push(new o.V(r,c,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(c)} found`)),_}function Ns(f){return o.a2(o.S(f.value))?Ls(Object.assign({},f,{expressionContext:"filter",valueSpec:f.styleSpec[`filter_${f.layerType||"fill"}`]})):vs(f)}function vs(f){let r=f.value,c=f.key;if(!Array.isArray(r))return[new o.V(c,r,`array expected, ${o.K(r)} found`)];if(r.length<1)return[new o.V(c,r,"filter array must have at least 1 element")];let p=f.styleSpec,_=Hr({key:`${c}[0]`,value:r[0],valueSpec:p.filter_operator});switch(o.J(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&o.J(r[1])==="$type"&&_.push(new o.V(c,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&_.push(new o.V(c,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(o.a0(r[1])||_.push(new o.V(`${c}[1]`,r[1],`string expected, ${o.K(r[1])} found`)));for(let y=2;y<r.length;y++)o.J(r[1])==="$type"?_=_.concat(Hr({key:`${c}[${y}]`,value:r[y],valueSpec:p.geometry_type})):o.a0(r[y])||o.L(r[y])||o.$(r[y])||_.push(new o.V(`${c}[${y}]`,r[y],`string, number, or boolean expected, ${o.K(r[y])} found.`));break;case"any":case"all":case"none":for(let y=1;y<r.length;y++)_=_.concat(vs({key:`${c}[${y}]`,value:r[y],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":r.length!==2?_.push(new o.V(c,r,`filter array for "${r[0]}" operator must have 2 elements`)):o.a0(r[1])||_.push(new o.V(`${c}[1]`,r[1],`string expected, ${o.K(r[1])} found`))}return _}function Zr(f,r){let c=f.key,p=f.style,_=f.layer,y=f.styleSpec,x=f.value,C=f.objectKey,T=y[`${r}_${f.layerType}`];if(!T)return[];let M=C.match(/^(.*)-use-theme$/);if(M&&T[M[1]])return o.Q(o.S(x))?[].concat(gr({key:c,value:x,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:p,styleSpec:y,expressionContext:"property",propertyType:r,propertyKey:C})):gr({key:c,value:x,valueSpec:{type:"string"},style:p,styleSpec:y});let P=C.match(/^(.*)-transition$/);if(r==="paint"&&P&&T[P[1]]&&T[P[1]].transition)return gr({key:c,value:x,valueSpec:y.transition,style:p,styleSpec:y});let F=f.valueSpec||T[C];if(!F)return[new o.a3(c,x,`unknown property "${C}"`)];let O;if(o.a0(x)&&o.N(F)&&!F.tokens&&(O=/^{([^}]+)}$/.exec(x))){let V=`\`{ "type": "identity", "property": ${O?JSON.stringify(O[1]):'"_"'} }\``;return[new o.V(c,x,`"${C}" does not support interpolation syntax
Use an identity property function instead: ${V}.`)]}let z=[];if(f.layerType==="symbol")C!=="text-field"||!p||p.glyphs||p.imports||z.push(new o.V(c,x,'use of "text-field" requires a style "glyphs" property')),C==="text-font"&&o.a4(o.S(x))&&o.J(x.type)==="identity"&&z.push(new o.V(c,x,'"text-font" does not support identity functions'));else if(f.layerType==="model"&&r==="paint"&&_&&_.layout&&_.layout.hasOwnProperty("model-id")&&o.N(F)&&(o.a5(F)||o.O(F))){let V=o.W(o.S(x),F).value,H="expression"in V&&V.expression||"_styleExpression"in V&&V._styleExpression&&V._styleExpression.expression;H&&!o.X(H,["measure-light"])&&(C==="model-emissive-strength"&&o.Y(H)&&o.Z(H)||z.push(new o.V(c,x,`${C} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return z.concat(gr({key:f.key,value:x,valueSpec:F,style:p,styleSpec:y,expressionContext:"property",propertyType:r,propertyKey:C}))}function vo(f){return Zr(f,"paint")}function ss(f){return Zr(f,"layout")}function fc(f){let r=[],c=f.value,p=f.key,_=f.style,y=f.styleSpec;if(!o.H(c))return[new o.V(p,c,"object expected")];c.type||c.ref||r.push(new o.V(p,c,'either "type" or "ref" is required'));let x=o.J(c.type),C=o.J(c.ref);if(c.id){let T=o.J(c.id);for(let M=0;M<f.arrayIndex;M++){let P=_.layers[M];o.J(P.id)===T&&r.push(new o.V(p,c.id,`duplicate layer id "${T}", previously used at line ${P.id.__line__}`))}}if("ref"in c){let T;["type","source","source-layer","filter","layout"].forEach(M=>{M in c&&r.push(new o.V(p,c[M],`"${M}" is prohibited for ref layers`))}),_.layers.forEach(M=>{o.J(M.id)===C&&(T=M)}),T?T.ref?r.push(new o.V(p,c.ref,"ref cannot reference another ref layer")):x=o.J(T.type):typeof C=="string"&&r.push(new o.V(p,c.ref,`ref layer "${C}" not found`))}else if(x!=="background"&&x!=="sky"&&x!=="slot")if(c.source)if(o.a0(c.source)){let T=_.sources&&_.sources[c.source],M=T&&o.J(T.type);T?M==="vector"&&x==="raster"?r.push(new o.V(p,c.source,`layer "${c.id}" requires a raster source`)):M==="raster"&&x!=="raster"?r.push(new o.V(p,c.source,`layer "${c.id}" requires a vector source`)):M!=="vector"||c["source-layer"]?M==="raster-dem"&&x!=="hillshade"?r.push(new o.V(p,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):M!=="raster-array"||["raster","raster-particle"].includes(x)?x==="line"&&c.paint&&(c.paint["line-gradient"]||c.paint["line-trim-offset"])&&M==="geojson"&&!T.lineMetrics?r.push(new o.V(p,c,`layer "${c.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):x==="raster-particle"&&M!=="raster-array"&&r.push(new o.V(p,c.source,`layer "${c.id}" requires a 'raster-array' source.`)):r.push(new o.V(p,c.source,"raster-array source can only be used with layer type 'raster'.")):r.push(new o.V(p,c,`layer "${c.id}" must specify a "source-layer"`)):r.push(new o.V(p,c.source,`source "${c.source}" not found`))}else r.push(new o.V(`${p}.source`,c.source,'"source" must be a string'));else r.push(new o.V(p,c,'missing required property "source"'));return r=r.concat(Zo({key:p,value:c,valueSpec:y.layer,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":()=>[],type:()=>gr({key:`${p}.type`,value:c.type,valueSpec:y.layer.type,style:f.style,styleSpec:f.styleSpec,object:c,objectKey:"type"}),filter:T=>Ns(Object.assign({layerType:x},T)),layout:T=>Zo({layer:c,key:T.key,value:T.value,valueSpec:{},style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":M=>ss(Object.assign({layerType:x},M))}}),paint:T=>Zo({layer:c,key:T.key,value:T.value,valueSpec:{},style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":M=>vo(Object.assign({layerType:x,layer:c},M))}}),appearances(T){let M=Ur({key:T.key,value:T.value,valueSpec:T.valueSpec,style:T.style,styleSpec:T.styleSpec,arrayElementValidator:O=>(function(z){let{key:V,layer:H,layerType:K}=z,Z=o.J(z.value),Q=o.J(Z.name),ae=o.J(Z.condition),re=Zo({key:V,value:Z,valueSpec:z.styleSpec.appearance,style:z.style,styleSpec:z.styleSpec,objectElementValidators:{condition:ge=>(function(ce){let ve=[];return ve.push(...Ls({key:ce.key,value:ce.object.condition,valueSpec:o.a6.appearance.condition,expressionContext:"appearance"})),ve})(Object.assign({layer:H,layerType:K},ge)),properties:ge=>(function(ce){let ve=[],{styleSpec:me,layer:he,layerType:xe}=ce,Re=me[`paint_${xe}`],Ie=me[`layout_${xe}`],qe=ce.object[ce.objectKey];for(let je in qe){let Ke=je in Re?"paint":je in Ie?"layout":void 0;if(!Ke){ve.push(new o.V(ce.key,je,`unknown property "${je}" for layer type "${xe}"`));continue}let _t=Object.assign({},ce,{key:`${ce.key}.${je}`,object:qe,objectKey:je,layer:he,layerType:xe,value:qe[je],valueSpec:Ke==="paint"?Re[je]:Ie[je]});ve.push(...Zr(_t,Ke))}return ve})(Object.assign({layer:H,layerType:K},ge))}});return Q!=="hidden"&&ae===void 0&&re.push(new o.V(z.key,"name",'Appearance with name different than "hidden" must have a condition')),re})(Object.assign({layerType:x,layer:c},O))}),P=Array.isArray(T.value)?T.value:[],F=new Set;return P.forEach((O,z)=>{let V=o.J(O.name);if(V)if(F.has(V)){let H=o.J(c.id);M.push(new o.V(T.key,V,`Duplicated appearance name "${V}" for layer "${H}"`))}else F.add(V)}),M}}})),r}function qs({key:f,value:r}){return o.a0(r)?[]:[new o.V(f,r,`string expected, ${o.K(r)} found`)]}let No={promoteId:function f({key:r,value:c}){if(o.a0(c))return qs({key:r,value:c});if(Array.isArray(c)){let _=[],y=o.S(c),x=o.U(y);return x.result==="error"&&x.value.forEach(C=>{_.push(new o.V(`${r}${C.key}`,null,`${C.message}`))}),o.X(x.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||_.push(new o.V(`${r}`,null,"promoteId expression should be only feature dependent")),_}if(!o.H(c))return[new o.V(r,c,`string, expression or object expected, "${o.K(c)}" found`)];let p=[];for(let _ in c)p.push(...f({key:`${r}.${_}`,value:c[_]}));return p}};function zu(f){let r=f.value,c=f.key,p=f.styleSpec,_=f.style;if(!o.H(r))return[new o.V(c,r,`object expected, ${o.K(r)} found`)];if(!("type"in r))return[new o.V(c,r,'"type" is required')];let y=o.J(r.type),x=[];switch(["vector","raster","raster-dem","raster-array"].includes(y)&&("url"in r||"tiles"in r||x.push(new o.a3(c,r,'Either "url" or "tiles" is required.'))),y){case"vector":case"raster":case"raster-dem":case"raster-array":return x=x.concat(Zo({key:c,value:r,valueSpec:p[`source_${y.replace("-","_")}`],style:f.style,styleSpec:p,objectElementValidators:No})),x;case"geojson":if(x=Zo({key:c,value:r,valueSpec:p.source_geojson,style:_,styleSpec:p,objectElementValidators:No}),"cluster"in r&&"clusterProperties"in r){if(!o.H(r.clusterProperties))return[new o.V(`${c}.clusterProperties`,r,`object expected, ${o.K(r)} found`)];for(let C in r.clusterProperties){let T=r.clusterProperties[C];if(!Array.isArray(T))return[new o.V(`${c}.clusterProperties.${C}`,T,"array expected")];let[M,P]=T,F=typeof M=="string"?[M,["accumulated"],["get",C]]:M;x.push(...Ls({key:`${c}.${C}.map`,value:P,expressionContext:"cluster-map"})),x.push(...Ls({key:`${c}.${C}.reduce`,value:F,expressionContext:"cluster-reduce"}))}}return x;case"video":return Zo({key:c,value:r,valueSpec:p.source_video,style:_,styleSpec:p});case"image":return Zo({key:c,value:r,valueSpec:p.source_image,style:_,styleSpec:p});case"canvas":return[new o.V(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Hr({key:`${c}.type`,value:r.type,valueSpec:{values:Xr(p)}})}}function Xr(f){return f.source.reduce((r,c)=>{let p=f[c];return p.type.type==="enum"&&(r=r.concat(Object.keys(p.type.values||{}))),r},[])}function jc(f){let r=f.value,c=f.styleSpec,p=c.light,_=f.style;if(r===void 0)return[];if(!o.H(r))return[new o.V("light",r,`object expected, ${o.K(r)} found`)];let y=[];for(let x in r){let C=x.match(/^(.*)-transition$/),T=x.match(/^(.*)-use-theme$/);y=y.concat(T&&p[T[1]]?gr({key:x,value:r[x],valueSpec:{type:"string"},style:_,styleSpec:c}):C&&p[C[1]]&&p[C[1]].transition?gr({key:x,value:r[x],valueSpec:c.transition,style:_,styleSpec:c}):p[x]?gr({key:x,value:r[x],valueSpec:p[x],style:_,styleSpec:c}):[new o.V(x,r[x],`unknown property "${x}"`)])}return y}function Vc(f){let r=f.value;if(!r)return[];let c=f.key;if(!o.H(r))return[new o.V(c,r,`object expected, ${o.K(r)} found`)];let p=[],_=f.styleSpec,y=_["light-3d"],x=f.style,C=f.style.lights;for(let P of["type","id"])if(!(P in r))return p=p.concat([new o.V(c,r,`missing property "${P}"`)]),p;if(!o.a0(r.type))return p=p.concat([new o.V(`${c}.type`,r.type,"string expected")]),p;if(C)for(let P=0;P<f.arrayIndex;P++){let F=o.J(r.type),O=C[P];o.J(O.type)===F&&p.push(new o.V(c,r.id,`duplicate light type "${r.type}", previously defined at line ${O.id.__line__}`))}let T=`properties_light_${r.type}`;if(!(T in _))return p=p.concat([new o.V(`${c}.type`,r,`Invalid light type ${r.type}`)]),p;let M=_[T];for(let P in r)if(P==="properties"){let F=r[P];if(!o.H(F))return p=p.concat([new o.V("properties",F,`object expected, ${o.K(F)} found`)]),p;for(let O in F){let z=O.match(/^(.*)-transition$/),V=O.match(/^(.*)-use-theme$/);p=p.concat(V&&M[V[1]]?gr({key:P,value:F[O],valueSpec:{type:"string"},style:x,styleSpec:_}):z&&M[z[1]]&&M[z[1]].transition?gr({key:P,value:r[P],valueSpec:_.transition,style:x,styleSpec:_}):M[O]?gr({key:O,value:F[O],valueSpec:M[O],style:x,styleSpec:_}):[new o.a3(f.key,F[O],`unknown property "${O}"`)])}}else p=p.concat(y[P]?gr({key:P,value:r[P],valueSpec:y[P],style:x,styleSpec:_}):[new o.a3(P,r[P],`unknown property "${P}"`)]);return p}function Wa(f){let r=f.value,c=f.key,p=f.style,_=f.styleSpec,y=_.terrain;if(r==null)return[];if(!o.H(r))return[new o.V("terrain",r,`object expected, ${o.K(r)} found`)];let x=[];for(let C in r){let T=C.match(/^(.*)-transition$/),M=C.match(/^(.*)-use-theme$/);x=x.concat(M&&y[M[1]]?gr({key:C,value:r[C],valueSpec:{type:"string"},style:p,styleSpec:_}):T&&y[T[1]]&&y[T[1]].transition?gr({key:C,value:r[C],valueSpec:_.transition,style:p,styleSpec:_}):y[C]?gr({key:C,value:r[C],valueSpec:y[C],style:p,styleSpec:_}):[new o.a3(C,r[C],`unknown property "${C}"`)])}if(r.source)if(o.a0(r.source)){let C=p.sources&&p.sources[r.source],T=C&&o.J(C.type);C?T!=="raster-dem"&&x.push(new o.V(`${c}.source`,r.source,`terrain cannot be used with a source of type ${T}, it only be used with a "raster-dem" source type`)):x.push(new o.V(`${c}.source`,r.source,`source "${r.source}" not found`))}else x.push(new o.V(`${c}.source`,r.source,"source must be a string"));else x.push(new o.V(c,r,'terrain is missing required property "source"'));return x}function Za(f){let r=f.value,c=f.style,p=f.styleSpec,_=p.fog;if(r===void 0)return[];if(!o.H(r))return[new o.V("fog",r,`object expected, ${o.K(r)} found`)];let y=[];for(let x in r){let C=x.match(/^(.*)-transition$/),T=x.match(/^(.*)-use-theme$/);y=y.concat(T&&_[T[1]]?gr({key:x,value:r[x],valueSpec:{type:"string"},style:c,styleSpec:p}):C&&_[C[1]]&&_[C[1]].transition?gr({key:x,value:r[x],valueSpec:p.transition,style:c,styleSpec:p}):_[x]?gr({key:x,value:r[x],valueSpec:_[x],style:c,styleSpec:p}):[new o.a3(x,r[x],`unknown property "${x}"`)])}return y}let Sa={"*":()=>[],array:Ur,boolean:function(f){let r=f.value,c=f.key;return o.$(r)?[]:[new o.V(c,r,`boolean expected, ${o.K(r)} found`)]},number:os,color:function({key:f,value:r}){return o.a0(r)?o.a1.parseCSSColor(r)===null?[new o.V(f,r,`color expected, "${r}" found`)]:[]:[new o.V(f,r,`color expected, ${o.K(r)} found`)]},enum:Hr,filter:Ns,function:_l,layer:fc,object:Zo,source:zu,model:o.a7,light:jc,"light-3d":Vc,terrain:Wa,fog:Za,string:qs,formatted:function(f){return qs(f).length===0?[]:Ls(f)},resolvedImage:function(f){return qs(f).length===0?[]:Ls(f)},projection:function(f){let r=f.value,c=f.styleSpec,p=c.projection,_=f.style;if(o.H(r)){let y=[];for(let x in r)y=y.concat(gr({key:x,value:r[x],valueSpec:p[x],style:_,styleSpec:c}));return y}return o.a0(r)?[]:[new o.V("projection",r,`object or string expected, ${o.K(r)} found`)]},import:function(f){let r=f.key,{value:c,styleSpec:p}=f;if(!o.H(c))return[new o.V(r,c,"import must be an object")];let C=c,{data:_}=C,y=mx(C,["data"]);Object.defineProperty(y,"__line__",{value:c.__line__,enumerable:!1});let x=Zo(Object.assign({},f,{value:y,valueSpec:p.import}));return o.J(y.id)===""&&x.push(new o.V(`${f.key}.id`,y,"import id can't be an empty string")),_&&(x=x.concat(pc(_,p,{key:`${f.key}.data`}))),x},iconset:function(f){let r=f.value,c=f.key,p=f.styleSpec,_=f.style;if(!o.H(r))return[new o.V(c,r,"object expected")];if(!r.type)return[new o.V(c,r,'"type" is required')];let y=o.J(r.type),x=[];if(x=x.concat(Zo({key:c,value:r,valueSpec:p[`iconset_${y}`],style:_,styleSpec:p})),(function(C,T){return!(C!=="source"||!T.source)})(y,r)){let C=_.sources&&_.sources[r.source],T=C&&o.J(C.type);C?T!=="raster-array"&&x.push(new o.V(c,r.source,`iconset cannot be used with a source of type ${String(T)}, it only be used with a "raster-array" source type`)):x.push(new o.V(c,r.source,`source "${r.source}" not found`))}return x}};function gr(f,r=!1){let c=f.value,p=f.valueSpec,_=f.styleSpec;if(p.expression){if(o.a4(o.J(c)))return _l(f);if(o.Q(o.S(c)))return Ls(f)}if(p.type&&Sa[p.type]){let y=Sa[p.type](f);return r===!0&&y.length>0&&Array.isArray(f.value)?Ls(f):y}return Zo(Object.assign({},f,{valueSpec:p.type?_[p.type]:p}))}function Zo(f){let r=f.key,c=f.value,p=f.valueSpec||{},_=f.objectElementValidators||{},y=f.style,x=f.styleSpec;if(!o.H(c))return[new o.V(r,c,`object expected, ${o.K(c)} found`)];let C=[];for(let T in c){let M=T.split(".")[0],P;_[M]?P=_[M]:p[M]?P=gr:_["*"]?P=_["*"]:p["*"]&&(P=gr),P?C=C.concat(P({key:(r&&`${r}.`)+T,value:c[T],valueSpec:p[M]||p["*"],style:y,styleSpec:x,object:c,objectKey:T},c)):C.push(new o.a3(r,c[T],`unknown property "${T}"`))}for(let T in p){if(_[T])continue;let M=p[T];M.required&&M.default===void 0&&c[T]===void 0&&C.push(new o.V(r,c,`missing required property "${T}"`))}return C}function da({key:f,value:r}){let c=qs({key:f,value:r});if(c.length)return c;let p=r;return p.indexOf("{fontstack}")===-1&&c.push(new o.V(f,r,'"glyphs" url must include a "{fontstack}" token')),p.indexOf("{range}")===-1&&c.push(new o.V(f,r,'"glyphs" url must include a "{range}" token')),c}function pc(f,r=o.a6,c={}){return Zo({key:c.key||"",value:f,valueSpec:Object.assign(r.$root,{"*":{type:"*"}}),styleSpec:r,style:f,objectElementValidators:{glyphs:da}})}function ha(f,r=o.a6){return Oe(pc(f,r))}let lf=f=>Oe(zu(f)),Gd=f=>Oe(jc(f)),jp=f=>Oe(Vc(f)),mc=f=>Oe(Wa(f)),ct=f=>Oe(Za(f)),Vl=f=>Oe((function(r){let c=r.value,p=r.style,_=r.styleSpec,y=_.snow;if(c===void 0)return[];if(!o.H(c))return[new o.V("snow",c,`object expected, ${o.K(c)} found`)];let x=[];for(let C in c){let T=C.match(/^(.*)-transition$/);x=x.concat(T&&y[T[1]]&&y[T[1]].transition?gr({key:C,value:c[C],valueSpec:_.transition,style:p,styleSpec:_}):y[C]?gr({key:C,value:c[C],valueSpec:y[C],style:p,styleSpec:_}):[new o.a3(C,c[C],`unknown property "${C}"`)])}return x})(f)),qd=f=>Oe((function(r){let c=r.value,p=r.style,_=r.styleSpec,y=_.rain;if(c===void 0)return[];if(!o.H(c))return[new o.V("rain",c,`object expected, ${o.K(c)} found`)];let x=[];for(let C in c){let T=C.match(/^(.*)-transition$/);x=x.concat(T&&y[T[1]]&&y[T[1]].transition?gr({key:C,value:c[C],valueSpec:_.transition,style:p,styleSpec:_}):y[C]?gr({key:C,value:c[C],valueSpec:y[C],style:p,styleSpec:_}):[new o.a3(C,c[C],`unknown property "${C}"`)])}return x})(f)),Wd=f=>Oe(fc(f)),Wn=f=>Oe(Ns(f)),zo=f=>Oe(vo(f)),Zd=f=>Oe(ss(f)),Xd=f=>Oe(o.a7(f));function Oe(f){return f.slice().sort((r,c)=>r.line&&c.line?r.line-c.line:0)}function q(f,r){let c=!1;if(r&&r.length)for(let p of r)p instanceof o.a3?o.w(p.message):(f.fire(new o.y(new Error(p.message))),c=!0);return c}let X=o.a6.light,de;class ye extends o.E{constructor(r,c="flat"){super(),this._transitionable=new o.a8(de||(de=new o.a9({anchor:new o.aa(X.anchor),position:new o.ab(X.position),color:new o.aa(X.color),intensity:new o.aa(X.intensity)}))),this.setLight(r,c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,c,p={}){this._validate(Gd,r,p)||(this._transitionable.setTransitionOrValue(r),this.id=c)}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,c,p){return(!p||p.validate!==!1)&&q(this,r.call(ha,Object.assign({value:c,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}}let Ce=o.a6.terrain,De=class extends o.E{constructor(f,r,c,p,_){super(),this.scope=c,this._transitionable=new o.a8(new o.a9({source:new o.aa(Ce.source),exaggeration:new o.aa(Ce.exaggeration)}),c,p),this._transitionable.setTransitionOrValue(f,p),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=r,this.worldview=_}get(){return this._transitionable.serialize()}set(f,r){this._transitionable.setTransitionOrValue(f,r)}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}getExaggeration(f){return this._transitioning.possiblyEvaluate(new o.ac(f,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;let f=this._transitionable._values.exaggeration;if(!f)return null;let r=f.value.expression;if(!r)return null;let c=-1,p=-1,_=1;for(let y of r.zoomStops)_=r.evaluate(new o.ac(y,{worldview:this.worldview})),_>.01?(c=y,p=-1):p=y;return _<.01&&c>0&&p>c?[c,p]:null}isZoomDependent(){let f=this._transitionable._values.exaggeration;return f!=null&&f.value!=null&&f.value.expression!=null&&f.value.expression instanceof o.ad}},He=45,Pe=65,Ve=.05;function ht(f,r,c,p){let _=o.ah(He,Pe,c),[y,x]=st(f,p),C=1-Math.min(1,Math.exp((r-y)/(x-y)*-6));return C*=C*C,C=Math.min(1,1.00747*C),C*_*f.alpha}function st(f,r){let c=.5/Math.tan(.5*r);return[f.range[0]+c,f.range[1]+c]}function Ht(f,r,c,p,_){let y=o.af([],[r,c,p],_.mercatorFogMatrix);return ht(f,o.ag(y),_.pitch,_._fov)}function fn(f,r,c,p,_,y,x){let C=[[c,p,0],[_,p,0],[_,y,0],[c,y,0]],T=Number.MAX_VALUE,M=-Number.MAX_VALUE;for(let P of C){let F=o.af([],P,r),O=o.ag(F);T=Math.min(T,O),M=Math.max(M,O)}return[ht(f,T,x.pitch,x._fov),ht(f,M,x.pitch,x._fov)]}let an=o.a6.fog;class Gt extends o.E{constructor(r,c,p,_){super();let y=new o.a9({range:new o.aa(an.range),color:new o.aa(an.color),"color-use-theme":new o.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new o.aa(an["high-color"]),"high-color-use-theme":new o.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new o.aa(an["space-color"]),"space-color-use-theme":new o.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new o.aa(an["horizon-blend"]),"star-intensity":new o.aa(an["star-intensity"]),"vertical-range":new o.aa(an["vertical-range"])});this._transitionable=new o.a8(y,p,new Map(_)),this.set(r,_),this._transitioning=this._transitionable.untransitioned(),this._transform=c,this.properties=new o.ai(y),this.scope=p}get state(){let r=this._transform,c=r.projection.name==="globe",p=o.aj(r.zoom),_=this.properties.get("range"),y=[.5,3];return{range:c?[o.ak(y[0],_[0],p),o.ak(y[1],_[1],p)]:_,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,c,p={}){if(this._validate(ct,r,p))return;let _=Object.assign({},r);for(let y of Object.keys(an))_[y]===void 0&&(_[y]=an[y].default);this._options=_,this._transitionable.setTransitionOrValue(this._options,c)}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;let c=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.ah(He,Pe,r))*c.a}getOpacityAtLatLng(r,c){return this._transform.projection.supportsFog?(function(p,_,y){let x=o.ae.fromLngLat(_),C=y.elevation?y.elevation.getAtPointOrZero(x):0;return Ht(p,x.x,x.y,C,y)})(this.state,r,c):0}getOpacityForTile(r){if(!this._transform.projection.supportsFog)return[1,1];let c=this._transform.calculateFogTileMatrix(r.toUnwrapped());return fn(this.state,c,0,0,o.al,o.al,this._transform)}getOpacityForBounds(r,c,p,_,y){return this._transform.projection.supportsFog?fn(this.state,r,c,p,_,y,this._transform):[1,1]}getFovAdjustedRange(r){return this._transform.projection.supportsFog?st(this.state,r):[0,1]}isVisibleOnFrustum(r){if(!this._transform.projection.supportsFog)return!1;let c=[4,5,6,7];for(let p of c){let _=r.points[p],y;if(_[2]>=0)y=_;else{let x=r.points[p-4];y=o.am(x,_,x[2]/(x[2]-_[2]))}if(Ht(this.state,y[0],y[1],0,this._transform)>=Ve)return!0}return!1}updateConfig(r){this._transitionable.setTransitionOrValue(this._options,new Map(r))}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,c,p){return(!p||p.validate!==!1)&&q(this,r.call(ha,Object.assign({value:c,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}}let Rn,zn,Di,_r,Yr=class extends o.E{constructor(f,r,c,p){super();let _=Rn||(Rn=new o.a9({density:new o.aa(o.a6.snow.density),intensity:new o.aa(o.a6.snow.intensity),color:new o.aa(o.a6.snow.color),opacity:new o.aa(o.a6.snow.opacity),vignette:new o.aa(o.a6.snow.vignette),"vignette-color":new o.aa(o.a6.snow["vignette-color"]),"center-thinning":new o.aa(o.a6.snow["center-thinning"]),direction:new o.aa(o.a6.snow.direction),"flake-size":new o.aa(o.a6.snow["flake-size"])}));this._transitionable=new o.a8(_,c,new Map(p)),this.set(f,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ai(_),this.scope=c}get state(){let f=this.properties.get("opacity"),r=this.properties.get("color"),c=this.properties.get("direction"),p=o.an(c[0]),_=-Math.max(o.an(c[1]),.01),y=[Math.cos(p)*Math.cos(_),Math.sin(p)*Math.cos(_),Math.sin(_)],x=this.properties.get("vignette"),C=this.properties.get("vignette-color");return C.a=x,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.ao(r.r,r.g,r.b,r.a*f),direction:y,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:C}}get(){return this._transitionable.serialize()}set(f,r,c={}){if(this._validate(Vl,f,c))return;let p=Object.assign({},f),_=o.a6.snow;for(let y of Object.keys(_))p[y]===void 0&&(p[y]=_[y].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,r)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,r,c){return(!c||c.validate!==!1)&&q(this,f.call(ha,Object.assign({value:r,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}},Fr=class extends o.E{constructor(f,r,c,p){super();let _=zn||(zn=new o.a9({density:new o.aa(o.a6.rain.density),intensity:new o.aa(o.a6.rain.intensity),color:new o.aa(o.a6.rain.color),opacity:new o.aa(o.a6.rain.opacity),vignette:new o.aa(o.a6.rain.vignette),"vignette-color":new o.aa(o.a6.rain["vignette-color"]),"center-thinning":new o.aa(o.a6.rain["center-thinning"]),direction:new o.aa(o.a6.rain.direction),"droplet-size":new o.aa(o.a6.rain["droplet-size"]),"distortion-strength":new o.aa(o.a6.rain["distortion-strength"])}));this._transitionable=new o.a8(_,c,new Map(p)),this.set(f,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ai(_),this.scope=c}get state(){let f=this.properties.get("opacity"),r=this.properties.get("color"),c=this.properties.get("direction"),p=o.an(c[0]),_=-Math.max(o.an(c[1]),.01),y=[Math.cos(p)*Math.cos(_),Math.sin(p)*Math.cos(_),Math.sin(_)],x=this.properties.get("vignette-color");return x.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.ao(r.r,r.g,r.b,r.a*f),direction:y,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:x}}get(){return this._transitionable.serialize()}set(f,r,c={}){if(this._validate(qd,f,c))return;let p=Object.assign({},f),_=o.a6.rain;for(let y of Object.keys(_))p[y]===void 0&&(p[y]=_[y].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,r)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,r,c){return(!c||c.validate!==!1)&&q(this,f.call(ha,Object.assign({value:r,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}};class Or extends o.E{constructor(r,c,p,_){super(),this.scope=p,this._options=r,this.properties=new o.ai(c),this._transitionable=new o.a8(c,p,new Map(_)),this._transitionable.setTransitionOrValue(r.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(r){this._transitionable.setTransitionOrValue(this._options.properties,new Map(r))}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(r,c){this._options=r,this._transitionable.setTransitionOrValue(r.properties,c)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class bi{constructor(r,c,p){this.screenBounds=r,this.cameraPoint=p.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=c,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,p)}static createFromScreenPoints(r,c){let p,_;if(r instanceof o.P||typeof r[0]=="number"){let y=o.P.convert(r);p=[y],_=c.isPointAboveHorizon(y)}else{let y=o.P.convert(r[0]),x=o.P.convert(r[1]),C=y.add(x)._div(2);p=[y,x],_=o.aq(y,x).every(T=>c.isPointAboveHorizon(T))&&c.isPointAboveHorizon(C)}return new bi(p,_,c)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(r){return o.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){let c=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],_=o.aq(c,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<p.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?_[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(_[3]=this.cameraPoint)),o.ar(_,r)}bufferedCameraGeometryGlobe(r){let c=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],_=o.aq(c,p,r),y=this.cameraPoint.clone();switch(3*((y.y>c.y)+(y.y>p.y))+((y.x>c.x)+(y.x>p.x))){case 0:_[0]=y,_[4]=y.clone();break;case 1:_.splice(1,0,y);break;case 2:_[1]=y;break;case 3:_.splice(4,0,y);break;case 5:_.splice(2,0,y);break;case 6:_[3]=y;break;case 7:_.splice(3,0,y);break;case 8:_[2]=y}return _}containsTile(r,c,p,_=0){let y=Math.max(r.queryPadding,r.evaluateQueryRenderedFeaturePadding())/c._pixelsPerMercatorPixel+1,x=p?this._bufferedCameraMercator(y,c):this._bufferedScreenMercator(y,c),C=r.tileID.wrap+(x.unwrapped?_:0),T=x.polygon.map(K=>o.as(r.tileTransform,K,C));if(!o.at(T,0,0,o.al,o.al))return;C=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?_:0);let M=this.screenGeometryMercator.polygon.map(K=>o.au(r.tileTransform,K,C)),P=M.map(K=>new o.P(K[0],K[1])),F=c.getFreeCameraOptions().position||new o.ae(0,0,0),O=o.au(r.tileTransform,F,C),z=M.map(K=>{let Z=o.av(K,K,O);return o.aw(Z,Z),new o.ax(O,Z)}),V=o.ay(r,1,c.zoom)*c._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:P,tilespaceRays:z,bufferedTilespaceGeometry:T,bufferedTilespaceBounds:(H=o.az(T),H.min.x=o.aA(H.min.x,0,o.al),H.min.y=o.aA(H.min.y,0,o.al),H.max.x=o.aA(H.max.x,0,o.al),H.max.y=o.aA(H.max.y,0,o.al),H),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:V};var H}_bufferedScreenMercator(r,c){let p=vr(r);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let _;return _=c.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(r),c):{polygon:this.bufferedScreenGeometry(r).map(y=>c.pointCoordinate3D(y)),unwrapped:!0},this._screenRaycastCache[p]=_,_}}_bufferedCameraMercator(r,c){let p=vr(r);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let _;return _=c.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),c):{polygon:this.bufferedCameraGeometry(r).map(y=>c.pointCoordinate3D(y)),unwrapped:!0},this._cameraRaycastCache[p]=_,_}}_projectAndResample(r,c){let p=(function(y,x){let C=o.aB([],x.pixelMatrix,x.globeMatrix),T=[0,-o.aD,0,1],M=[0,o.aD,0,1],P=[0,0,0,1];o.aC(T,T,C),o.aC(M,M,C),o.aC(P,P,C);let F=new o.P(T[0]/T[3],T[1]/T[3]),O=new o.P(M[0]/M[3],M[1]/M[3]),z=o.aE(y,F)&&T[3]<P[3],V=o.aE(y,O)&&M[3]<P[3];if(!z&&!V)return null;let H=(function(ve,me,he){for(let xe=1;xe<ve.length;xe++){let Re=er(me.pointCoordinate3D(ve[xe-1]).x),Ie=er(me.pointCoordinate3D(ve[xe]).x);if(he<0){if(Re<Ie)return{idx:xe,t:-Re/(Ie-1-Re)}}else if(Ie<Re)return{idx:xe,t:(1-Re)/(Ie+1-Re)}}return null})(y,x,z?-1:1);if(!H)return null;let{idx:K,t:Z}=H,Q=K>1?Zn(y.slice(0,K),x):[],ae=K<y.length?Zn(y.slice(K),x):[];Q=Q.map(ve=>new o.P(er(ve.x),ve.y)),ae=ae.map(ve=>new o.P(er(ve.x),ve.y));let re=[...Q];re.length===0&&re.push(ae[ae.length-1]);let ge=o.ak(re[re.length-1].y,(ae.length===0?Q[0]:ae[0]).y,Z),ce;return ce=z?[new o.P(0,ge),new o.P(0,0),new o.P(1,0),new o.P(1,ge)]:[new o.P(1,ge),new o.P(1,1),new o.P(0,1),new o.P(0,ge)],re.push(...ce),ae.length===0?re.push(Q[0]):re.push(...ae),{polygon:re.map(ve=>new o.ae(ve.x,ve.y)),unwrapped:!1}})(r,c);if(p)return p;let _=(function(y,x){let C=!1,T=-1/0,M=0;for(let F=0;F<y.length-1;F++)y[F].x>T&&(T=y[F].x,M=F);for(let F=0;F<y.length-1;F++){let O=(M+F)%(y.length-1),z=y[O],V=y[O+1];Math.abs(z.x-V.x)>.5&&(z.x<V.x?(z.x+=1,O===0&&(y[y.length-1].x+=1)):(V.x+=1,O+1===y.length-1&&(y[0].x+=1)),C=!0)}let P=o.aF(x.center.lng);return C&&P<Math.abs(P-1)&&y.forEach(F=>{F.x-=1}),{polygon:y,unwrapped:C}})(Zn(r,c).map(y=>new o.P(er(y.x),y.y)),c);return{polygon:_.polygon.map(y=>new o.ae(y.x,y.y)),unwrapped:_.unwrapped}}}function Zn(f,r){return o.aG(f,c=>{let p=r.pointCoordinate3D(c);c.x=p.x,c.y=p.y},1/256)}function er(f){return f<0?1+f%1:f%1}function vr(f){return 100*f|0}function Ei(f,r,c,p,_){let y=function(C,T){if(C)return _(C);if(T){if(f.url&&T.tiles&&f.tiles&&delete f.tiles,T.variants){if(!Array.isArray(T.variants))return _(new Error("variants must be an array"));for(let P of T.variants){if(P==null||typeof P!="object"||P.constructor!==Object)return _(new Error("variant must be an object"));if(!Array.isArray(P.capabilities))return _(new Error("capabilities must be an array"));if(P.capabilities.length===1&&P.capabilities[0]==="meshopt"){T=Object.assign(T,P);break}}}let M=o.aH(Object.assign({},T,f),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);M.tiles=r.canonicalizeTileset(M,f.url),_(null,M)}},x=(function(C,T,M){if(!C)return null;if(!T&&!M)return C;M=M||C.worldview_default;let P=Object.values(C.language||{});if(P.length===0)return null;let F=Object.values(C.worldview||{});if(F.length===0)return null;let O=P.every(V=>V===T),z=F.every(V=>V===M);return O&&z?C:T in(C.language_options||{})||M in(C.worldview_options||{})?null:C.language_options&&C.worldview_options?C:null})(f.data,c,p);return x?o.o.frame(()=>y(null,x)):f.url?o.m(r.transformRequest(r.normalizeSourceURL(f.url,null,c,p),o.R.Source),y):o.o.frame(()=>{let M=f,{data:C}=M,T=mx(M,["data"]);y(null,T)})}function tr(f,r){let c=Math.pow(2,r.z),p=Math.floor(o.aF(f.getWest())*c),_=Math.floor(o.aJ(f.getNorth())*c),y=Math.ceil(o.aF(f.getEast())*c),x=Math.ceil(o.aJ(f.getSouth())*c);return r.x>=p&&r.x<y&&r.y>=_&&r.y<x}class oo{constructor(r,c,p){this.bounds=r?o.aI.convert(this.validateBounds(r)):null,this.minzoom=c||0,this.maxzoom=p||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}addExtraBounds(r){if(r){this.extraBounds||(this.extraBounds=[]);for(let c of r)this.extraBounds.push(o.aI.convert(this.validateBounds(c)))}}contains(r){if(r.z>this.maxzoom||r.z<this.minzoom||this.bounds&&!tr(this.bounds,r))return!1;if(!this.extraBounds)return!0;for(let c of this.extraBounds)if(tr(c,r))return!0;return!1}static fromTileJSON(r){if(!r.bounds&&!r.extra_bounds)return null;let c=new oo(r.bounds,r.minzoom,r.maxzoom);return c.addExtraBounds(r.extra_bounds),c}}class Xo extends o.E{constructor(r,c,p,_){if(super(),this.id=r,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,o.aH(c,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},c),this._collectResourceTiming=!!c.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_),this._tileWorkers={},this._deduped=new o.aK}load(r){this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"}));let c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,p=this.map.getWorldview();this._tileJSONRequest=Ei(this._options,this.map._requestManager,c,p,(_,y)=>{if(this._tileJSONRequest=null,this._loaded=!0,_)c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),p&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${p}`),this.fire(new o.y(_));else if(y){if(Object.assign(this,y),this.hasWorldviews=!!y.worldview_options,y.worldview_default&&(this.worldviewDefault=y.worldview_default),y.vector_layers){this.vectorLayers=y.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(let x of y.vector_layers)this.vectorLayerIds.push(x.id),y.worldview&&y.worldview[x.source]&&this.localizableLayerIds.add(x.id)}this.tileBounds=oo.fromTileJSON(y),eo(y.tiles,this.map._requestManager._customAccessToken),this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))}r&&r(_)})}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest();let r=o.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(r))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(r){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(r,c){let p=r.tileID.canonical.url(this.tiles,this.scheme),_=this.map._requestManager.normalizeTileURL(p),y=this.map._requestManager.transformRequest(_,o.R.Tile),x=this.map.style?this.map.style.getLut(this.scope):null,C=x?{image:x.image.clone()}:null,T={request:y,data:void 0,uid:r.uid,tileID:r.tileID,tileZoom:r.tileZoom,zoom:r.tileID.overscaledZ,maxZoom:this.maxzoom,lut:C,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:o.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:r.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:r.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};if(this.hasWorldviews&&o.h(p)&&(T.localizableLayerIds=this.localizableLayerIds),T.request.collectResourceTiming=this._collectResourceTiming,r.actor&&r.state!=="expired")r.state==="loading"?r.reloadCallback=c:r.request=r.actor.send("reloadTile",T,M.bind(this));else if(r.actor=this._tileWorkers[_]=this._tileWorkers[_]||this.dispatcher.getActor(),this.dispatcher.ready)r.request=r.actor.send("loadTile",T,M.bind(this),void 0,!0);else{let P=o.aL.call({deduped:this._deduped},T,(F,O)=>{if(F||!O)M.call(this,F);else{let z=o.aM(O.responseHeaders);T.data={cacheControl:z.cacheControl,expires:z.expires,rawData:O.rawData.slice(0)},r.actor&&r.actor.send("loadTile",T,M.bind(this),void 0,!0)}},!0);r.request={cancel:P}}function M(P,F){return delete r.request,r.aborted?c(null):P&&P.status!==404?c(P):(F&&F.resourceTiming&&(r.resourceTiming=F.resourceTiming),this.map._refreshExpiredTiles&&F&&r.setExpiryData(F),r.loadVectorData(F,this.map.painter),o.aN(this.dispatcher),c(null,F),void(r.reloadCallback&&(this.loadTile(r,r.reloadCallback),r.reloadCallback=null)))}}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(r,c){r.actor&&r.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope}),r.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class fa extends o.E{constructor(r,c,p,_){super(),this.id=r,this.dispatcher=p,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},c),Object.assign(this,o.aH(c,["url","scheme","tileSize"]))}load(r){this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"}));let c=this.map.getWorldview();this._tileJSONRequest=Ei(this._options,this.map._requestManager,null,c,(p,_)=>{this._tileJSONRequest=null,this._loaded=!0,p?this.fire(new o.y(p)):_&&(Object.assign(this,_),_.raster_layers&&(this.rasterLayers=_.raster_layers,this.rasterLayerIds=this.rasterLayers.map(y=>y.id)),this.tileBounds=oo.fromTileJSON(_),eo(_.tiles),this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))),r&&r(p)})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest();let r=o.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(r))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(r){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,c){let p=o.o.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);r.request=o.n(this.map._requestManager.transformRequest(_,o.R.Tile),(y,x,C)=>{if(delete r.request,r.aborted)return r.state="unloaded",c(null);if(y)return r.state="errored",c(y);if(!x)return c(null);let T=o.aM(C);this.map._refreshExpiredTiles&&r.setExpiryData(T),r.setTexture(x,this.map.painter),r.state="loaded",o.aN(this.dispatcher),c(null)})}abortTile(r,c){r.request&&(r.request.cancel(),delete r.request),c&&c()}unloadTile(r,c){r.texture&&r.texture instanceof o.T?(r.destroy(!0),r.texture&&r.texture instanceof o.T&&this.map.painter.saveTileTexture(r.texture)):r.destroy(),c&&c()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Uc([f,r],c,p,{scaled:_=!0}={}){let{tileSize:y,buffer:x}=p,{x:C,y:T,z:M}=c;if(!isFinite(C)||!isFinite(T)||!isFinite(M))throw new Error("Invalid MRT header");let P=2**M,F=P*o.aF(f),O=P*o.aJ(r);return(function([z,V],H,{scaled:K=!0}={}){if(!H)throw new Error("bandView is undefined");let{data:Z,tileSize:Q,buffer:ae,offset:re,scale:ge,dimension:ce}=H;if(z<-ae||z>Q+ae||V<-ae||V>Q+ae)throw new Error(`Point (${z}, ${V}) out of bounds for tileSize=${Q}, buffer=${ae}`);let ve=(V+ae)*(Q+2*ae)+(z+ae);if(new Uint32Array(Z.buffer)[ve]===4294967295)return null;let me=[];me=K?[]:new H.data.constructor(ce);for(let he=0;he<ce;he++)me[he]=Math.round(1e12*(Z[ce*ve+he]*ge+re))/1e12;return me})([Math.min(Math.max(-x,Math.floor((F-C)*y)),y-1+x),Math.min(Math.max(-x,Math.floor((O-T)*y)),y-1+x)],p,{scaled:_})}class yo extends fa{constructor(r,c,p,_){super(r,c,p,_),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},c)}triggerRepaint(r){let c=this.map.painter._terrain,p=this.map.style.getSourceCache(this.id);c&&c.enabled&&p&&c._clearRenderCacheForTile(p.id,r.tileID),this.map.triggerRepaint()}loadTile(r,c){let p=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),_=this.map._requestManager.transformRequest(p,o.R.Tile),y={request:_,uid:r.uid,tileID:r.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};r.source=this.id,r.scope=this.scope,r.requestParams=_,r.actor||(r.actor=this.dispatcher.getActor());let x=(C,T,M)=>{if(delete r.request,r.aborted)return r.state="unloaded",c(null);if(C)return C.name==="AbortError"?void 0:(r.state="errored",c(C));if(this.map._refreshExpiredTiles&&T){let P=o.aM(M);r.setExpiryData(P)}if(this.partial&&r.state!=="expired")r.state="empty";else if(!this.partial){if(!T)return c(null);r.state="loaded",r._isHeaderLoaded=!0,r._mrt=T}c(null)};r.request=this.partial?r.fetchHeader(void 0,x.bind(this)):r.actor.send("loadTile",y,x.bind(this),void 0,!0)}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(r,c){let p=r.texturePerLayer;if(r.flushAllQueues(),p.size){r.destroy(!0);for(let _ of p.values())this.map.painter.saveTileTexture(_)}else r.destroy()}prepareTile(r,c,p,_){r._isHeaderLoaded&&(r.state!=="empty"&&(r.state="reloading"),r.fetchBandForRender(c,p,_,(y,x)=>{if(y)return r.state="errored",this.fire(new o.y(y)),void this.triggerRepaint(r);x&&(r._isHeaderLoaded=!0,r.setTexturePerLayer(p,x,this.map.painter),r.state="loaded",this.triggerRepaint(r))}))}getInitialBand(r){if(!this.rasterLayers)return 0;let c=this.rasterLayers.find(({id:y})=>y===r),p=c&&c.fields,_=p&&p.bands&&p.bands;return _?_[0]:0}getTextureDescriptor(r,c,p){if(!r)return;let _=c.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!_)return;let y=null;c instanceof o.aQ?y=c.paint.get("raster-array-band"):c instanceof o.aR&&(y=c.paint.get("raster-particle-array-band"));let x=y||this.getInitialBand(_);if(x==null)return;if(!r.textureDescriptorPerLayer.get(c.id))return void this.prepareTile(r,_,c.id,x);if(r.updateNeeded(c.id,x)&&!p)return;let C=r.textureDescriptorPerLayer.get(c.id);return Object.assign({},C,{texture:r.texturePerLayer.get(c.id)})}getImages(r,c){let p=new Map;for(let _ of r)for(let y of c){let[x,C]=y.split("/"),T=_.getLayer(x);if(!T||!T.hasBand(C)||!T.hasDataForBand(C))continue;let{bytes:M,tileSize:P,buffer:F}=T.getBandView(C),O=P+2*F,z={data:new o.q({width:O,height:O},M),pixelRatio:2,sdf:!1,usvg:!1,version:0};p.set(y,z)}return p}queryRasterArrayValueByBandId(r,c,p){let _=c._mrt;return new Promise(y=>{let x={},C=new Set;for(let[T,M]of Object.entries(_.layers)){if(p.layerName&&T!==p.layerName)continue;let P={};x[T]=P;for(let{bands:F}of M.dataIndex)for(let O of F)p.bands&&!p.bands.includes(O)||(C.add(o.B(T,O)),c.fetchBand(T,null,O,z=>{o.o.frame(()=>{P[O]=z?null:Uc([r.lng,r.lat],_,M.getBandView(O)),C.delete(o.B(T,O)),C.size===0&&y(x)})},!1))}C.size===0&&y(x)})}_loadTileForQuery(r,c){if(this._loadTileLoaded[r.uid])return void c(null,r._mrt);if(this._loadTilePending[r.uid])return void this._loadTilePending[r.uid].push(c);this._loadTilePending[r.uid]=[c];let p=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),_=this.map._requestManager.transformRequest(p,o.R.Tile);r.actor.send("loadTile",{request:_,uid:r.uid,tileID:r.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(y,x,C)=>{if(y)return this._loadTilePending[r.uid].forEach(T=>T(y,null)),void delete this._loadTilePending[r.uid];if(!x)return this._loadTilePending[r.uid].forEach(T=>T(null,null)),void delete this._loadTilePending[r.uid];if(this.map._refreshExpiredTiles&&x){let T=o.aM(C);r.setExpiryData(T)}r._mrt=x,r._isHeaderLoaded=!0,r.state="loaded",this._loadTilePending[r.uid].forEach(T=>T(null,x)),this._loadTileLoaded[r.uid]=!0,delete this._loadTilePending[r.uid]},void 0,!0)}queryRasterArrayValueByAllBands(r,c,p){return new Promise((_,y)=>{this._loadTileForQuery(c,(x,C)=>{x?y(x):_(C?this.queryRasterArrayValueByBandId(r,c,p):null)})})}queryRasterArrayValue(r,c){let p=o.aS.convert(r),_=this.findLoadedParent(p);return _&&_._mrt?c.bands||!this.partial?this.queryRasterArrayValueByBandId(p,_,c):this.queryRasterArrayValueByAllBands(p,_,c):Promise.resolve(null)}findLoadedParent(r){let c=o.ae.fromLngLat(r,this.map.transform.tileSize),p=this.maxzoom+1,_=1<<p,y=Math.floor(c.x),x=Math.floor((c.x-y)*_),C=Math.floor(c.y*_),T=this.map.style.getSourceCache(this.id),M=new o.aP(p,y,p,x,C);return T.findLoadedParent(M,this.minzoom)}}let zs={vector:Xo,raster:fa,"raster-dem":class extends fa{constructor(f,r,c,p){super(f,r,c,p),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(f,r){let c=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(_,y){_&&(f.state="errored",r(_)),y&&(f.dem=y,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",r(null))}f.request=o.n(this.map._requestManager.transformRequest(c,o.R.Tile),(function(_,y,x){if(delete f.request,f.aborted)f.state="unloaded",r(null);else if(_)f.state="errored",r(_);else if(y){let C=o.aM(x);this.map._refreshExpiredTiles&&f.setExpiryData(C);let T=ImageBitmap&&y instanceof ImageBitmap&&o.r(),M=1-(y.width-o.aO(y.width))/2;M<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));let P=T?y:o.o.getImageData(y,M),F={uid:f.uid,tileID:f.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:P,encoding:this.encoding,padding:M};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadTile",F,p.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(f){let r=f.canonical,c=Math.pow(2,r.z),p=(r.x-1+c)%c,_=r.x===0?f.wrap-1:f.wrap,y=(r.x+1+c)%c,x=r.x+1===c?f.wrap+1:f.wrap,C={};return C[new o.aP(f.overscaledZ,_,r.z,p,r.y).key]={backfilled:!1},C[new o.aP(f.overscaledZ,x,r.z,y,r.y).key]={backfilled:!1},r.y>0&&(C[new o.aP(f.overscaledZ,_,r.z,p,r.y-1).key]={backfilled:!1},C[new o.aP(f.overscaledZ,f.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},C[new o.aP(f.overscaledZ,x,r.z,y,r.y-1).key]={backfilled:!1}),r.y+1<c&&(C[new o.aP(f.overscaledZ,_,r.z,p,r.y+1).key]={backfilled:!1},C[new o.aP(f.overscaledZ,f.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},C[new o.aP(f.overscaledZ,x,r.z,y,r.y+1).key]={backfilled:!1}),C}},"raster-array":yo,geojson:class extends o.E{constructor(f,r,c,p){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(p),this._data=r.data,this._options=Object.assign({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.minzoom!==void 0&&(this.minzoom=r.minzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;let _=o.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(r.buffer!==void 0?r.buffer:128)*_,tolerance:(r.tolerance!==void 0?r.tolerance:.375)*_,extent:o.al,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:o.al,radius:(r.clusterRadius!==void 0?r.clusterRadius:50)*_,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter,dynamic:r.dynamic},r.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}updateData(f){if(!this._options.dynamic)return this.fire(new o.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof f!="string"&&(f.type==="Feature"&&(f={type:"FeatureCollection",features:[f]}),f.type!=="FeatureCollection"))return this.fire(new o.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof f!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){let r=new Map;for(let c of this._data.features)r.set(c.id,c);for(let c of f.features)r.set(c.id,c);this._data.features=[...r.values()]}else this._data=f;return this._updateWorkerData(!0),this}getClusterExpansionZoom(f,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id,scope:this.scope},r),this}getClusterChildren(f,r){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id,scope:this.scope},r),this}getClusterLeaves(f,r,c,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:f,limit:r,offset:c},p),this}_updateWorkerData(f=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.z("dataloading",{dataType:"source"})),this._loaded=!1;let r=Object.assign({append:f},this.workerOptions);r.scope=this.scope;let c=this._data;typeof c=="string"?(r.request=this.map._requestManager.transformRequest(o.o.resolveURL(c),o.R.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,r,(p,_)=>{if(this._loaded=!0,this._pendingLoad=null,p)this.fire(new o.y(p));else{let y={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(y.resourceTiming=_.resourceTiming[this.id]),f&&(this._partialReload=!0),this.fire(new o.z("data",y)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(f),this._coalesce=!1)})}loaded(){return this._loaded}reload(){let f=o.B(this.id,this.scope);this.map.style.clearSource(f),this._updateWorkerData()}loadTile(f,r){let c=f.actor?"reloadTile":"loadTile";f.actor=this.actor;let p=this.map.style?this.map.style.getLut(this.scope):null,_=p?{image:p.image.clone()}:null,y=this._partialReload,x={type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:_,scope:this.scope,pixelRatio:o.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:f.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:y,worldview:this.map.getWorldview(),indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};f.request=this.actor.send(c,x,(C,T)=>y&&!T?(f.state="loaded",r(null)):(delete f.request,f.destroy(),f.aborted?r(null):C?r(C):(f.loadVectorData(T,this.map.painter,c==="reloadTile"),r(null))),void 0,c==="loadTile")}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f,r){this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id,scope:this.scope}),f.destroy()}onRemove(f){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends o.aT{constructor(f,r,c,p){super(f,r,c,p),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;let f=this.options;this.urls=[];for(let r of f.urls)this.urls.push(this.map._requestManager.transformRequest(r,o.R.Source).url);o.aU(this.urls,(r,c)=>{this._loaded=!0,r?this.fire(new o.y(r)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){let r=this.video.seekable;f<r.start(0)||f>r.end(0)?this.fire(new o.y(new o.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let f=this.map.painter.context,r=f.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(f,this.video,r.RGBA8),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:o.aT,model:o.aW,"batched-model":class extends o.E{constructor(f,r,c,p){super(),this.type="batched-model",this.id=f,this.tileSize=512,this._options=r,this.tiles=this._options.tiles,this.maxzoom=r.maxzoom||19,this.minzoom=r.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=c,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(p)}onAdd(f){this.map=f,this.load()}reload(){this.cancelTileJSONRequest();let f=o.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(f))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(f){this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"}));let r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,c=this.map.getWorldview();this._tileJSONRequest=Ei(this._options,this.map._requestManager,r,c,(p,_)=>{this._tileJSONRequest=null,this._loaded=!0,p?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),c&&c.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${c}`),this.fire(new o.y(p))):_&&(Object.assign(this,_),_.bounds&&(this.tileBounds=new oo(_.bounds,this.minzoom,this.maxzoom)),eo(_.tiles,this.map._requestManager._customAccessToken),this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))),f&&f(p)})}hasTransition(){return!1}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}loaded(){return this._loaded}loadTile(f,r){let c=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(c,o.R.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:f.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:o.o.devicePixelRatio,promoteId:this.promoteId};if(f.actor&&f.state!=="expired")if(f.state==="loading")f.reloadCallback=r;else{if(f.buckets){let y=Object.values(f.buckets);for(let x of y)x.dirty=!0;return void(f.state="loaded")}f.request=f.actor.send("reloadTile",p,_.bind(this))}else f.actor=this.dispatcher.getActor(),f.request=f.actor.send("loadTile",p,_.bind(this),void 0,!0);function _(y,x){return f.aborted?r(null):y&&y.status!==404?r(y):(this.map._refreshExpiredTiles&&x&&f.setExpiryData(x),f.loadModelData(x,this.map.painter),f.state="loaded",void r(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends o.aT{constructor(f,r,c,p){super(f,r,c,p),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(y=>typeof y!="number"))||this.fire(new o.y(new o.V(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.y(new o.V(`sources.${f}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new o.y(new o.V(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new o.y(new o.V(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.y(new o.V(`sources.${f}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(f){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let r=this.map.painter.context;this.texture?!f&&!this._playing||this.texture instanceof o.aV||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(r,this.canvas,r.gl.RGBA8,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends o.E{constructor(f,r,c,p){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=r,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new oo(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.clearTiles=this._clearTiles.bind(this),r.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,o.aH(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this.map=f,this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){let{x:r,y:c,z:p}=f.canonical;return this._implementation.hasTile({x:r,y:c,z:p})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,r){let{x:c,y:p,z:_}=f.tileID.canonical,y=new AbortController;f.request=Promise.resolve(this._implementation.loadTile({x:c,y:p,z:_},{signal:y.signal})).then((function(x){return delete f.request,f.aborted?(f.state="unloaded",r(null)):x===void 0?(f.state="errored",r(null)):x===null?(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",r(null)):(function(C){return C instanceof ImageData||C instanceof HTMLCanvasElement||C instanceof ImageBitmap||C instanceof HTMLImageElement})(x)?(this.loadTileData(f,x),f.state="loaded",void r(null)):(f.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(x=>{x.name!=="AbortError"&&(f.state="errored",r(x))}),f.request.cancel=()=>y.abort()}loadTileData(f,r){f.setTexture(r,this.map.painter)}unloadTile(f,r){if(f.texture&&f.texture instanceof o.T?(f.destroy(!0),f.texture&&f.texture instanceof o.T&&this.map.painter.saveTileTexture(f.texture)):f.destroy(),this._implementation.unloadTile){let{x:c,y:p,z:_}=f.tileID.canonical;this._implementation.unloadTile({x:c,y:p,z:_})}r&&r()}abortTile(f,r){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),r&&r()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z}))}_clearTiles(){let f=o.B(this.id,this.scope);this.map.style.clearSource(f)}_update(){this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))}}},Bo=function(f,r,c,p){let _=new zs[r.type](f,r,c,p);if(_.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${_.id}`);return o.aX(["load","abort","unload","serialize","prepare"],_),_};function Ws(f,r,c=""){return`${c}:${r.id||""}:${r.layer.id}:${(function(p){if("layerId"in p)return`layer:${p.layerId}`;{let{featuresetId:_,importId:y}=p;return`featureset:${_}${y?`:import:${y}`:""}`}})(f.target)}`}function Bs(f,r,c,p=""){if(f.uniqueFeatureID){let _=Ws(f,r,p);if(c.has(_))return!0;c.add(_)}return!1}function Zs(f,r,c,p,_=!1){let y=r.sourceCache.transform,x=r.sourceCache.tilesIn(f,r.has3DLayers,_);x.sort(Kd);let C=[];for(let T of x){let M=T.tile.queryRenderedFeatures(r,T,c,p,y,_);Object.keys(M).length&&C.push({wrappedTileID:T.tile.tileID.wrapped().key,queryResults:M})}for(let T in r.layers){let M=r.layers[T];if(M.styleLayer){let P=M.styleLayer.queryRenderedFeatures(f,r.sourceCache,p);Object.keys(P).length&&C.push({wrappedTileID:0,queryResults:P})}}return C.length===0?{}:(function(T){let M={},P={};for(let F of T){let O=F.queryResults,z=F.wrappedTileID,V=P[z]=P[z]||{};for(let H in O){let K=O[H],Z=V[H]=V[H]||{},Q=M[H]=M[H]||[];for(let ae of K)Z[ae.featureIndex]||(Z[ae.featureIndex]=!0,Q.push(ae))}}return M})(C)}function cf(f,r,c,p,_,y){let x={},C=p.queryRenderedSymbols(f),T=[];for(let M of Object.keys(C).map(Number))T.push(_[M]);T.sort(Kd);for(let M of T){let P=M.featureIndex.lookupSymbolFeatures(C[M.bucketInstanceId],M.bucketIndex,M.sourceLayerIndex,r,c,y);for(let F in P){let O=x[F]=x[F]||[],z=P[F];z.sort((V,H)=>{let K=M.featureSortOrder;if(K){let Z=K.indexOf(V.featureIndex);return K.indexOf(H.featureIndex)-Z}return H.featureIndex-V.featureIndex});for(let V of z)O.push(V)}}return x}function Yd(f,r){let c=f.getRenderableIds().map(y=>f.getTileByID(y)),p=[],_={};for(let y=0;y<c.length;y++){let x=c[y],C=x.tileID.canonical.key;_[C]||(_[C]=!0,x.querySourceFeatures(p,r))}return p}function Kd(f,r){let c=f.tileID,p=r.tileID;return c.overscaledZ-p.overscaledZ||c.canonical.y-p.canonical.y||c.wrap-p.wrap||c.canonical.x-p.canonical.x}function Jd(f,r){let c={};if(!r)return c;for(let p of f){let _=p.layerIds.map(y=>r.getLayer(y)).filter(Boolean);if(_.length!==0){p.layers=_,p.stateDependentLayerIds&&(p.stateDependentLayers=p.stateDependentLayerIds.map(y=>_.filter(x=>x.id===y)[0]));for(let y of _)c[y.fqid]=p}}return c}let js=32,Da=33,ys=new Uint16Array(8184);for(let f=0;f<2046;f++){let r=f+2,c=0,p=0,_=0,y=0,x=0,C=0;for(1&r?_=y=x=js:c=p=C=js;(r>>=1)>1;){let M=c+_>>1,P=p+y>>1;1&r?(_=c,y=p,c=x,p=C):(c=_,p=y,_=x,y=C),x=M,C=P}let T=4*f;ys[T+0]=c,ys[T+1]=p,ys[T+2]=_,ys[T+3]=y}let Xs=new Uint16Array(2178),Ul=new Uint8Array(1089),Hc=new Uint16Array(1089);function Hl(f){return f===0?-.03125:f===32?.03125:0}let Qd={type:2,extent:o.al,loadGeometry:()=>[[new o.P(0,0),new o.P(o.al+1,0),new o.P(o.al+1,o.al+1),new o.P(0,o.al+1),new o.P(0,0)]]};class vl{constructor(r,c,p,_,y,x){this.tileID=r,this.uid=o.b1(),this.uses=0,this.tileSize=c,this.tileZoom=p,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=y,_&&_.style&&(this._lastUpdatedBrightness=_.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",_&&_.transform&&(this.projection=_.transform.projection),this.worldview=x,this._hasAppearances=null}registerFadeDuration(r){let c=r+this.timeAdded;c<o.o.now()||this.fadeEndTime&&c<this.fadeEndTime||(this.fadeEndTime=c)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=o.aY(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(r,c,p){if(this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=Jd(r.buckets,c.style),this.hasSymbolBuckets=!1;for(let _ in this.buckets){let y=this.buckets[_];if(y instanceof o.b3){if(this.hasSymbolBuckets=!0,!p)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let _ in this.buckets){let y=this.buckets[_];if(y instanceof o.b3&&y.hasRTLText){this.hasRTLText=!0,o.b4();break}}this.queryPadding=0;for(let _ in this.buckets){let y=this.buckets[_],x=c.style.getOwnLayer(_);if(!x)continue;let C=x.queryRadius(y);this.queryPadding=Math.max(this.queryPadding,C)}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),r.lineAtlas&&(this.lineAtlas=r.lineAtlas),this._lastUpdatedBrightness=r.brightness}else this.collisionBoxArray=new o.b2}unloadVectorData(){if(this.hasData()){for(let r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(r,c,p){r&&(r.resourceTiming&&(this.resourceTiming=r.resourceTiming),this.buckets=Object.assign({},this.buckets,Jd(r.buckets,c.style)),r.featureIndex&&(this.latestFeatureIndex=r.featureIndex))}getBucket(r){return this.buckets[r.fqid]}upload(r,c){for(let y in this.buckets){let x=this.buckets[y];if(x.uploadPending()){let C={},T=[],M={zoom:0,pitch:0,brightness:0,worldview:""};if(c){if(c.style){T=c.style.listImages();let P=x.layers[0],F=P.sourceLayer||"_geojsonTileLayer",O=c.style.getLayerSourceCache(P);O&&(C=O._state.getState(F,void 0))}M={zoom:c.transform.zoom||0,pitch:c.transform.pitch||0,brightness:c.style.getBrightness()||0,worldview:c.worldview||""}}x.upload(r,this.tileID.canonical,C,T,M)}}let p=r.gl,_=this.imageAtlas;_&&!_.uploaded&&(this.imageAtlasTexture=new o.T(r,_.image,p.RGBA8,{useMipmap:!!_.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(r,this.glyphAtlasImage,p.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new o.T(r,this.lineAtlas.image,p.R8),this.lineAtlas.uploaded=!0)}prepare(r,c,p){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture,p),!c||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;let _=c.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(c)),(this._lastUpdatedBrightness||_||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&_&&Math.abs(this._lastUpdatedBrightness-_)<.001||(this.updateBuckets(c,this._lastUpdatedBrightness!==_),this._lastUpdatedBrightness=_))}evaluateQueryRenderedFeaturePadding(){let r=0;for(let c in this.buckets){let p=this.buckets[c];p.evaluateQueryRenderedFeaturePadding&&(r=Math.max(r,p.evaluateQueryRenderedFeaturePadding()))}return r}queryRenderedFeatures(r,c,p,_,y,x){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};let C=this.evaluateQueryRenderedFeaturePadding(),T=(function(M,P){let F=o.bp([],[.5*M.width,.5*-M.height,1]);return o.bq(F,F,[1,-1,0]),o.aB(F,F,M.calculateProjMatrix(P.toUnwrapped())),Float32Array.from(F)})(y,this.tileID);return this.latestFeatureIndex.query(r,{tilespaceGeometry:c,pixelPosMatrix:T,transform:_,availableImages:p,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:C})}querySourceFeatures(r,c){let p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;let _=p.loadVTLayers(),y=c?c.sourceLayer:"",x=_._geojsonTileLayer||_[y];if(!x)return;let C=o.b5(c&&c.filter),{z:T,x:M,y:P}=this.tileID.canonical,F={z:T,x:M,y:P};for(let O=0;O<x.length;O++){let z=x.feature(O);if(C.needGeometry){let K=o.b6(z,!0);if(!C.filter(new o.ac(this.tileID.overscaledZ,{worldview:this.worldview}),K,this.tileID.canonical))continue}else if(!C.filter(new o.ac(this.tileID.overscaledZ,{worldview:this.worldview}),z))continue;let V=p.getId(z,y),H=new o.b7(z,T,M,P,V);H.tile=F,r.push(H)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(r){let c=this.expirationTime;if(r.cacheControl){let p=o.b8(r.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){let p=Date.now(),_=!1;if(this.expirationTime>p)_=!1;else if(c)if(this.expirationTime<c)_=!0;else{let y=this.expirationTime-c;y?this.expirationTime=p+Math.max(y,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(r){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&r&&this.updateBuckets(r)}hasAppearances(r){for(let c in this.buckets)if(r.style.hasLayer(c)&&this.buckets[c].layers.some(p=>p.appearances&&p.appearances.length>0))return!0;return!1}updateBuckets(r,c){if(!this.latestFeatureIndex||!r.style)return;let p=this.latestFeatureIndex.loadVTLayers(),_=r.style.listImages(),y=r.style.getBrightness();for(let x in this.buckets){if(!r.style.hasLayer(x))continue;let C=this.buckets[x],T=C.layers[0],M=T.sourceLayer||"_geojsonTileLayer",P=p[M],F=r.style.getLayerSourceCache(T),O={};F&&(O=F._state.getState(M,void 0));let z=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},V=Object.keys(O).length>0&&!c;if(C.hasAppearances=C.layers.some(K=>K.appearances&&K.appearances.length>0),(V&&C.stateDependentLayers.length!==0||c)&&C.update(O,P,_,z,V?C.stateDependentLayers:C.layers,c,y),V&&C.stateDependentLayers.length!==0||c||C.hasAppearances){let K={zoom:r.transform.zoom,pitch:r.transform.pitch,brightness:r.style.getBrightness()||0,worldview:r.worldview};C.updateAppearances(this.tileID.canonical,O,_,K)}(C instanceof o.b9||C instanceof o.ba)&&r._terrain&&r._terrain.enabled&&F&&C.uploadPending()&&r._terrain._clearRenderCacheForTile(F.id,this.tileID);let H=r&&r.style&&r.style.getOwnLayer(x);H&&(this.queryPadding=Math.max(this.queryPadding,H.queryRadius(C)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=o.o.now()+r}setTexture(r,c){let p=c.context,_=p.gl;this.texture=this.texture||c.getTileTexture(r.width),this.texture&&this.texture instanceof o.T?this.texture.update(r):(this.texture=new o.T(p,r,_.RGBA8,{useMipmap:!0}),this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE))}setDependencies(r,c){let p={};for(let _ of c)p[_]=!0;this.dependencies[r]=p}hasDependency(r,c){for(let p of r){let _=this.dependencies[p];if(_){for(let y of c)if(_[y])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(r,c){if(!c||c.name==="mercator"||this._tileDebugBuffer)return;let p=o.bb(Qd,this.tileID.canonical,this.tileTransform)[0],_=new o.bc,y=new o.bd;for(let x=0;x<p.length;x++){let{x:C,y:T}=p[x];_.emplaceBack(C,T),y.emplaceBack(x)}y.emplaceBack(0),this._tileDebugIndexBuffer=r.createIndexBuffer(y),this._tileDebugBuffer=r.createVertexBuffer(_,o.be.members),this._tileDebugSegments=o.bf.simpleSegment(0,0,_.length,y.length)}_makeTileBoundsBuffers(r,c){if(this._tileBoundsBuffer||!c||c.name==="mercator")return;let p=o.bb(Qd,this.tileID.canonical,this.tileTransform)[0],_,y;if(this.isRaster){let x=(function(C,T){let M=o.aY(C,T),P=Math.pow(2,C.z);for(let K=0;K<Da;K++)for(let Z=0;Z<Da;Z++){let Q=o.aZ((C.x+(Z+Hl(Z))/js)/P),ae=o.a_((C.y+(K+Hl(K))/js)/P),re=T.project(Q,ae),ge=K*Da+Z;Xs[2*ge+0]=Math.round((re.x*M.scale-M.x)*o.al),Xs[2*ge+1]=Math.round((re.y*M.scale-M.y)*o.al)}Ul.fill(0),Hc.fill(0);for(let K=2045;K>=0;K--){let Z=4*K,Q=ys[Z+0],ae=ys[Z+1],re=ys[Z+2],ge=ys[Z+3],ce=Q+re>>1,ve=ae+ge>>1,me=ce+ve-ae,he=ve+Q-ce,xe=ae*Da+Q,Re=ge*Da+re,Ie=ve*Da+ce,qe=Math.hypot((Xs[2*xe+0]+Xs[2*Re+0])/2-Xs[2*Ie+0],(Xs[2*xe+1]+Xs[2*Re+1])/2-Xs[2*Ie+1])>=16;Ul[Ie]=Ul[Ie]||(qe?1:0),K<1022&&(Ul[Ie]=Ul[Ie]||Ul[(ae+he>>1)*Da+(Q+me>>1)]||Ul[(ge+he>>1)*Da+(re+me>>1)])}let F=new o.a$,O=new o.b0,z=0;function V(K,Z){let Q=Z*Da+K;return Hc[Q]===0&&(F.emplaceBack(Xs[2*Q+0],Xs[2*Q+1],K*o.al/js,Z*o.al/js),Hc[Q]=++z),Hc[Q]-1}function H(K,Z,Q,ae,re,ge){let ce=K+Q>>1,ve=Z+ae>>1;if(Math.abs(K-re)+Math.abs(Z-ge)>1&&Ul[ve*Da+ce])H(re,ge,K,Z,ce,ve),H(Q,ae,re,ge,ce,ve);else{let me=V(K,Z),he=V(Q,ae),xe=V(re,ge);O.emplaceBack(me,he,xe)}}return H(0,0,js,js,js,0),H(js,js,0,0,0,js),{vertices:F,indices:O}})(this.tileID.canonical,c);_=x.vertices,y=x.indices}else{_=new o.a$,y=new o.b0;for(let{x:C,y:T}of p)_.emplaceBack(C,T,0,0);let x=o.bg(_.int16.subarray(0,4*_.length),void 0,4);for(let C=0;C<x.length;C+=3)y.emplaceBack(x[C],x[C+1],x[C+2])}this._tileBoundsBuffer=r.createVertexBuffer(_,o.bh.members),this._tileBoundsIndexBuffer=r.createIndexBuffer(y),this._tileBoundsSegments=o.bf.simpleSegment(0,0,_.length,y.length)}_makeGlobeTileDebugBuffers(r,c){let p=c.projection;if(!p||p.name!=="globe"||c.freezeTileCoverage)return;let _=this.tileID.canonical,y=o.bi(_,c),x=o.bj(y),C=o.aj(c.zoom),T;C>0&&(T=o.bk(new Float64Array(16),c.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(r,_,c,x,T,C),this._makeGlobeTileDebugTextBuffer(r,_,c,x,T,C)}_globePoint(r,c,p,_,y,x,C){let T=o.bl(r,c,p);if(x){let M=1<<p.z,P=o.aF(_.center.lng),F=o.aJ(_.center.lat),O=(p.x+.5)/M-P,z=0;O>.5?z=-1:O<-.5&&(z=1);let V=(r/o.al+p.x)/M+z,H=(c/o.al+p.y)/M;V=(V-P)*_._pixelsPerMercatorPixel+P,H=(H-F)*_._pixelsPerMercatorPixel+F;let K=[V*_.worldSize,H*_.worldSize,0];o.af(K,K,x),T=o.bm(T,K,C)}return o.af(T,T,y)}_makeGlobeTileDebugBorderBuffer(r,c,p,_,y,x){let C=new o.bc,T=new o.bd,M=new o.bn,P=(O,z,V,H,K)=>{let Z=(V-O)/(K-1),Q=(H-z)/(K-1),ae=C.length;for(let re=0;re<K;re++){let ge=O+re*Z,ce=z+re*Q;C.emplaceBack(ge,ce);let ve=this._globePoint(ge,ce,c,p,_,y,x);M.emplaceBack(ve[0],ve[1],ve[2]),T.emplaceBack(ae+re)}},F=o.al;P(0,0,F,0,16),P(F,0,F,F,16),P(F,F,0,F,16),P(0,F,0,0,16),this._tileDebugIndexBuffer=r.createIndexBuffer(T),this._tileDebugBuffer=r.createVertexBuffer(C,o.be.members),this._globeTileDebugBorderBuffer=r.createVertexBuffer(M,o.bo.members),this._tileDebugSegments=o.bf.simpleSegment(0,0,C.length,T.length)}_makeGlobeTileDebugTextBuffer(r,c,p,_,y,x){let C=o.al/4,T=new o.bc,M=new o.b0,P=new o.bn,F=25;M.reserve(32),T.reserve(F),P.reserve(F);let O=(z,V)=>F*z+V;for(let z=0;z<F;z++){let V=z*C;for(let H=0;H<F;H++){let K=H*C;T.emplaceBack(K,V);let Z=this._globePoint(K,V,c,p,_,y,x);P.emplaceBack(Z[0],Z[1],Z[2])}}for(let z=0;z<4;z++)for(let V=0;V<4;V++){let H=O(z,V),K=O(z,V+1),Z=O(z+1,V),Q=O(z+1,V+1);M.emplaceBack(H,K,Z),M.emplaceBack(Z,K,Q)}this._tileDebugTextIndexBuffer=r.createIndexBuffer(M),this._tileDebugTextBuffer=r.createVertexBuffer(T,o.be.members),this._globeTileDebugTextBuffer=r.createVertexBuffer(P,o.bo.members),this._tileDebugTextSegments=o.bf.simpleSegment(0,0,F,32)}destroy(r=!1){for(let c in this.buckets)this.buckets[c].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!r&&this.texture&&this.texture instanceof o.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}o.br.setPbf(o.bs);class yl extends vl{constructor(r,c,p,_,y){super(r,c,p,_,y),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(r){return this._mrt&&this._mrt.getLayer(r)}setTexturePerLayer(r,c,p){let _=p.context,y=_.gl,x=this.texturePerLayer.get(r)||p.getTileTexture(c.width);x&&x instanceof o.T?x.update(c,{premultiply:!1}):x=new o.T(_,c,y.RGBA8,{premultiply:!1}),this.texturePerLayer.has(r)||this.texturePerLayer.set(r,x)}flushQueues(r){let c=this._workQueuePerLayer.get(r)||[],p=this._fetchQueuePerLayer.get(r)||[];for(;c.length;)c.pop()();for(;p.length;)p.pop()()}flushAllQueues(){for(let r of this._workQueuePerLayer.keys()){let c=this._workQueuePerLayer.get(r)||[];for(;c.length;)c.pop()()}for(let r of this._fetchQueuePerLayer.keys()){let c=this._fetchQueuePerLayer.get(r)||[];for(;c.length;)c.pop()()}}fetchHeader(r=16384,c){let p=this._mrt=new o.br(30),_=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(r-1)}});return this.entireBuffer=null,this.request=o.bt(_,(y,x,C)=>{if(y)c(y);else try{let T=p.getHeaderLength(x);if(T>r)return void(this.request=this.fetchHeader(T,c));p.parseHeader(x),this._isHeaderLoaded=!0;let M=0;for(let P of Object.values(p.layers))M=Math.max(M,P.dataIndex[P.dataIndex.length-1].lastByte);x.byteLength>=M&&(this.entireBuffer=x),c(null,this.entireBuffer||x,C)}catch(T){c(T)}}),this.request}fetchBandForRender(r,c,p,_){this.fetchBand(r,c,p,y=>{if(y)return void _(y);this.updateTextureDescriptor(r,c,p);let x=this.textureDescriptorPerLayer.get(c);_(null,x?x.img:null)})}fetchBand(r,c,p,_,y=!0){let x=this._mrt;if(!this._isHeaderLoaded||!x)return void _(new Error("Tile header is not ready"));let C=this.actor;if(!C)return void _(new Error("Can't fetch tile band without an actor"));let T,M=o.B(String(p),o.B(this.tileID.key,r)),P=this._taskQueue.get(M);P?P.add(_):(P=new Set,P.add(_),this._taskQueue.set(M,P));let F=(H,K)=>{T.complete(H,K),H?_(H):(P.values().forEach(Z=>Z(null,K)),this._taskQueue.delete(M))},O=(H,K)=>{if(H)return _(H);let Z=C.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:K,task:T},F,void 0,!0);if(c!==null){let Q=this._workQueuePerLayer.get(c)||[];Q.push(()=>{Z&&Z.cancel(),T.cancel()}),this._workQueuePerLayer.has(c)||this._workQueuePerLayer.set(c,Q)}},z;try{z=x.getLayer(r)}catch(H){if(this.state==="reloading")return;throw H}if(!z)return void _(new Error(`Unknown sourceLayer "${r}"`));if(z.hasDataForBand(p))return P.values().forEach(H=>H(null,null)),void this._taskQueue.delete(M);let V=z.getDataRange([p]);if(T=x.createDecodingTask(V),!T||T.tasks.length)if(c!==null&&this.flushQueues(c),this.entireBuffer)O(null,this.entireBuffer.slice(V.firstByte,V.lastByte+1));else{let H=Object.assign({},this.requestParams,{headers:{Range:`bytes=${V.firstByte}-${V.lastByte}`}}),K=o.bt(H,O);if(c!==null){let Z=this._fetchQueuePerLayer.get(c)||[];Z.push(()=>{K.cancel(),T.cancel()}),this._fetchQueuePerLayer.has(c)||this._fetchQueuePerLayer.set(c,Z)}}}updateNeeded(r,c){return(!this.textureDescriptorPerLayer.get(r)||this.textureDescriptorPerLayer.get(r).band!==c||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(r,c,p){if(!this._mrt)return;let _=this._mrt.getLayer(r);if(!_||!_.hasBand(p)||!_.hasDataForBand(p))return;let{bytes:y,tileSize:x,buffer:C,offset:T,scale:M}=_.getBandView(p),P=x+2*C,F=new o.q({width:P,height:P},y),O=this.texturePerLayer.get(c);O&&O instanceof o.T&&O.update(F,{premultiply:!1}),this.textureDescriptorPerLayer.set(c,{layer:r,band:p,img:F,buffer:C,offset:T,tileSize:x,format:_.pixelFormat,mix:[M,256*M,65536*M,16777216*M]})}destroy(r=!1){if(super.destroy(r),delete this._mrt,!r)for(let c of this.texturePerLayer.values())c&&c instanceof o.T&&c.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class uf{constructor(r,c){this.max=r,this.onRemove=c,this.reset()}reset(){for(let r in this.data)for(let c of this.data[r])c.timeout&&clearTimeout(c.timeout),this.onRemove(c.value);return this.data={},this.order=[],this}add(r,c,p){let _=r.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);let y={value:c,timeout:void 0};if(p!==void 0&&(y.timeout=setTimeout(()=>{this.remove(r,y)},p)),this.data[_].push(y),this.order.push(_),this.order.length>this.max){let x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){let c=this.data[r].shift();return c.timeout&&clearTimeout(c.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),c.value}getByKey(r){let c=this.data[r];return c?c[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,c){if(!this.has(r))return this;let p=r.wrapped().key,_=c===void 0?0:this.data[p].indexOf(c),y=this.data[p][_];return this.data[p].splice(_,1),y.timeout&&clearTimeout(y.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(y.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){let c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this}filter(r){let c=[];for(let p in this.data)for(let _ of this.data[p])r(_.value)||c.push(_);for(let p of c)this.remove(p.value.tileID,p)}}class Mg{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,c,p){let _=String(c);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][_]=this.stateChanges[r][_]||{},Object.assign(this.stateChanges[r][_],p),this.deletedStates[r]===null){this.deletedStates[r]={};for(let y in this.state[r])y!==_&&(this.deletedStates[r][y]=null)}else if(this.deletedStates[r]&&this.deletedStates[r][_]===null){this.deletedStates[r][_]={};for(let y in this.state[r][_])p[y]||(this.deletedStates[r][_][y]=null)}else for(let y in p)this.deletedStates[r]&&this.deletedStates[r][_]&&this.deletedStates[r][_][y]===null&&delete this.deletedStates[r][_][y]}removeFeatureState(r,c,p){if(this.deletedStates[r]===null)return;let _=String(c);if(this.deletedStates[r]=this.deletedStates[r]||{},p&&c!==void 0)this.deletedStates[r][_]!==null&&(this.deletedStates[r][_]=this.deletedStates[r][_]||{},this.deletedStates[r][_][p]=null);else if(c!==void 0)if(this.stateChanges[r]&&this.stateChanges[r][_])for(p in this.deletedStates[r][_]={},this.stateChanges[r][_])this.deletedStates[r][_][p]=null;else this.deletedStates[r][_]=null;else this.deletedStates[r]=null}getState(r,c){let p=this.state[r]||{},_=this.stateChanges[r]||{},y=this.deletedStates[r];if(y===null)return{};if(c!==void 0){let C=String(c),T=Object.assign({},p[C],_[C]);if(y){let M=y[c];if(M===null)return{};for(let P in M)delete T[P]}return T}let x=Object.assign({},p,_);if(y)for(let C in y)delete x[C];return x}initializeTileState(r,c){r.refreshFeatureState(c)}coalesceChanges(r,c){let p={};for(let _ in this.stateChanges){this.state[_]=this.state[_]||{};let y={};for(let x in this.stateChanges[_])this.state[_][x]||(this.state[_][x]={}),Object.assign(this.state[_][x],this.stateChanges[_][x]),y[x]=this.state[_][x];p[_]=y}for(let _ in this.deletedStates){this.state[_]=this.state[_]||{};let y={};if(this.deletedStates[_]===null)for(let x in this.state[_])y[x]={},this.state[_][x]={};else for(let x in this.deletedStates[_]){if(this.deletedStates[_][x]===null)this.state[_][x]={};else if(this.state[_][x])for(let C of Object.keys(this.deletedStates[_][x]))delete this.state[_][x][C];y[x]=this.state[_][x]}p[_]=p[_]||{},Object.assign(p[_],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(let _ in r)r[_].refreshFeatureState(c)}}class Ia extends o.E{constructor(r,c,p){super(),this.id=r,this._onlySymbols=p,c.on("data",_=>{_.dataType==="source"&&_.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&_.dataType==="source"&&_.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),c.on("error",()=>{this._sourceErrored=!0}),this._source=c,this._tiles={},this._cache=new uf(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Mg,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(r){this.map=r,this._minTileCacheSize=this._minTileCacheSize===void 0&&r?r._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&r?r._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let r in this._tiles)if(!this._tiles[r].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(r,c){return r.isSymbolTile=this._onlySymbols,r.isExtraShadowCaster=this._shadowCasterTiles[r.tileID.key],this._source.loadTile(r,c)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r)}_abortTile(r){if(this._source.abortTile)return this._source.abortTile(r)}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let c in this._tiles){let p=this._tiles[c];p.upload(r,this.map?this.map.painter:void 0),p.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(r=>r.tileID).sort(Vp).map(r=>r.key)}getRenderableIds(r,c){let p=[];for(let _ in this._tiles)this._isIdRenderable(+_,r,c)&&p.push(this._tiles[_]);return r?p.sort((_,y)=>{let x=_.tileID,C=y.tileID,T=new o.P(x.canonical.x,x.canonical.y)._rotate(this.transform.angle),M=new o.P(C.canonical.x,C.canonical.y)._rotate(this.transform.angle);return x.overscaledZ-C.overscaledZ||M.y-T.y||M.x-T.x}).map(_=>_.tileID.key):p.map(_=>_.tileID).sort(Vp).map(_=>_.key)}hasRenderableParent(r){let c=this.findLoadedParent(r,0);return!!c&&this._isIdRenderable(c.tileID.key)}_isIdRenderable(r,c,p){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(c||!this._tiles[r].holdingForFade())&&(p||!this._shadowCasterTiles[r])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let r in this._tiles)this._tiles[r].state!=="errored"&&this._reloadTile(+r,"reloading")}}_reloadTile(r,c){let p=this._tiles[r];p&&(p.state!=="loading"&&(p.state=c),this._loadTile(p,this._tileLoaded.bind(this,p,r,c)))}_tileLoaded(r,c,p,_,y){if(_){if(r.state="errored",_.status!==404)this._source.fire(new o.y(_,{tile:r}));else{if(this._source.fire(new o.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:r})),!(r.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let C=this.map.painter.terrain;this.update(this.transform,C.getScaledDemTileSize(),!0),C.resetTileLookupCache(this.id)}else this.update(this.transform)}return}r.timeAdded=o.o.now(),p==="expired"&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(c,r),this._source.type==="raster-dem"&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null);let x=new Map;y&&y.responseHeaders&&(x=y.responseHeaders),this._source.fire(new o.z("data",{dataType:"source",tile:r,coord:r.tileID,sourceCacheId:this.id,responseHeaders:x}))}_backfillDEM(r){let c=this.getRenderableIds();for(let _=0;_<c.length;_++){let y=c[_];if(r.neighboringTiles&&r.neighboringTiles[y]){let x=this.getTileByID(y);p(r,x),p(x,r)}}function p(_,y){if(!_.dem||_.dem.borderReady)return;_.needsHillshadePrepare=!0,_.needsDEMTextureUpload=!0;let x=y.tileID.canonical.x-_.tileID.canonical.x,C=y.tileID.canonical.y-_.tileID.canonical.y,T=Math.pow(2,_.tileID.canonical.z),M=y.tileID.key;x===0&&C===0||Math.abs(C)>1||(Math.abs(x)>1&&(Math.abs(x+T)===1?x+=T:Math.abs(x-T)===1&&(x-=T)),y.dem&&_.dem&&(_.dem.backfillBorder(y.dem,x,C),_.neighboringTiles&&_.neighboringTiles[M]&&(_.neighboringTiles[M].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,c,p,_){for(let y in this._tiles){let x=this._tiles[y];if(_[y]||!x.hasData()||x.tileID.overscaledZ<=c||x.tileID.overscaledZ>p)continue;let C=x.tileID;for(;x&&x.tileID.overscaledZ>c+1;){let M=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[M.key],x&&x.hasData()&&(C=M)}let T=C;for(;T.overscaledZ>c;)if(T=T.scaledTo(T.overscaledZ-1),r[T.key]){_[C.key]=C;break}}}findLoadedParent(r,c){if(r.key in this._loadedParentTiles){let p=this._loadedParentTiles[r.key];return p&&p.tileID.overscaledZ>=c?p:null}for(let p=r.overscaledZ-1;p>=c;p--){let _=r.scaledTo(p),y=this._getLoadedTile(_);if(y)return y}}_getLoadedTile(r){let c=this._tiles[r.key];return c&&c.hasData()?c:this._cache.getByKey(this._source.reparseOverscaled?r.wrapped().key:r.canonical.key)}updateCacheSize(r,c){c=c||this._source.tileSize;let p=Math.ceil(r.width/c)+1,_=Math.ceil(r.height/c)+1,y=Math.floor(p*_*5),x=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,y):y,C=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,x):x;this._cache.setMaxSize(C)}handleWrapJump(r){let c=Math.round((r-(this._prevLng===void 0?r:this._prevLng))/360);if(this._prevLng=r,c){let p={};for(let _ in this._tiles){let y=this._tiles[_];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+c),p[y.tileID.key]=y}this._tiles=p;for(let _ in this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(let _ in this._tiles)this._setTileReloadTimer(+_,this._tiles[_])}}update(r,c,p,_,y){if(this.transform=r,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!p)return;this.updateCacheSize(r,c),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};let x=this._source.type==="batched-model",C,T=this._source.maxzoom,M=this.map&&this.map.painter?this.map.painter._terrain:null;if(M&&M.sourceCache===this&&M.attenuationRange()){let O=M.attenuationRange()[0],z=Math.floor(O)-Math.log2(M.getDemUpscale());T>z&&(T=z)}if(this.used||this.usedForTerrain){if(this._source.tileID)C=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(O=>new o.aP(O.canonical.z,O.wrap,O.canonical.z,O.canonical.x,O.canonical.y));else if(this.tileCoverLift!==0){let O=r.clone();O.tileCoverLift=this.tileCoverLift,C=O.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:T,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:x}),this._source.minzoom<=1&&r.projection.name==="globe"&&(C.push(new o.aP(1,0,1,0,0)),C.push(new o.aP(1,0,1,1,0)),C.push(new o.aP(1,0,1,0,1)),C.push(new o.aP(1,0,1,1,1)))}else if(C=r.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:T,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:x}),this._source.hasTile){let O=this._source.hasTile.bind(this._source);C=C.filter(z=>O(z))}}else C=[];if(C.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!$c(this._source.type)){let O=r.coveringZoomLevel({tileSize:c||this._source.tileSize,roundZoom:this._source.roundZoom&&!p}),z=Math.min(O,this._source.maxzoom);if(x){let V=r.extendTileCover(C,z);for(let H of V)C.push(H)}else if(y){let V=r.extendTileCoverToNearPlane(C,this.transform.getFrustum(z),z);for(let H of V)C.push(H)}else if(this.castsShadows&&_){let V=r.extendTileCover(C,z,_);for(let H of V)this._shadowCasterTiles[H.key]=!0,C.push(H)}}let P=this._updateRetainedTiles(C);if($c(this._source.type)&&C.length!==0){let O={},z={},V=Object.keys(P);for(let K of V){let Z=P[K],Q=this._tiles[K];if(!Q||Q.fadeEndTime&&Q.fadeEndTime<=o.o.now())continue;let ae=this.findLoadedParent(Z,Math.max(Z.overscaledZ-Ia.maxOverzooming,this._source.minzoom));ae&&(this._addTile(ae.tileID),O[ae.tileID.key]=ae.tileID),z[K]=Z}let H=C[C.length-1].overscaledZ;for(let K in this._tiles){let Z=this._tiles[K];if(P[K]||!Z.hasData())continue;let Q=Z.tileID;for(;Q.overscaledZ>H;){Q=Q.scaledTo(Q.overscaledZ-1);let ae=this._tiles[Q.key];if(ae&&ae.hasData()&&z[Q.key]){P[K]=Z.tileID;break}}}for(let K in O)P[K]||(this._coveredTiles[K]=!0,P[K]=O[K])}for(let O in P)this._tiles[O].clearFadeHold();let F=o.bu(this._tiles,P);for(let O of F){let z=this._tiles[O];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(+O)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(+r)}_updateRetainedTiles(r){let c={};if(r.length===0)return c;let p={},_=r.reduce((M,P)=>Math.min(M,P.overscaledZ),1/0),y=r[0].overscaledZ,x=Math.max(y-Ia.maxOverzooming,this._source.minzoom),C=Math.max(y+Ia.maxUnderzooming,this._source.minzoom),T={};for(let M of r){let P=this._addTile(M);c[M.key]=M,P.hasData()||_<this._source.maxzoom&&(T[M.key]=M)}this._retainLoadedChildren(T,_,C,c);for(let M of r){let P=this._tiles[M.key];if(P.hasData())continue;if(M.canonical.z>=this._source.maxzoom){let O=M.children(this._source.maxzoom)[0],z=this.getTile(O);if(z&&z.hasData()){c[O.key]=O;continue}}else{let O=M.children(this._source.maxzoom);if(c[O[0].key]&&c[O[1].key]&&c[O[2].key]&&c[O[3].key])continue}let F=P.wasRequested();for(let O=M.overscaledZ-1;O>=x;--O){let z=M.scaledTo(O);if(p[z.key]||(p[z.key]=!0,P=this.getTile(z),!P&&F&&(P=this._addTile(z)),P&&(c[z.key]=z,F=P.wasRequested(),P.hasData())))break}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let r in this._tiles){let c=[],p,_=this._tiles[r].tileID;for(;_.overscaledZ>0;){if(_.key in this._loadedParentTiles){p=this._loadedParentTiles[_.key];break}c.push(_.key);let y=_.scaledTo(_.overscaledZ-1);if(p=this._getLoadedTile(y),p)break;_=y}for(let y of c)this._loadedParentTiles[y]=p}}_addTile(r){let c=this._tiles[r.key];if(c)return c.isExtraShadowCaster!==!0||this._shadowCasterTiles[r.key]||this._reloadTile(r.key,"reloading"),c;c=this._cache.getAndRemove(r),c&&(this._setTileReloadTimer(r.key,c),c.tileID=r,this._state.initializeTileState(c,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,c)));let p=!!c;if(!p){let _=this.map?this.map.painter:null,y=this._source.tileSize*r.overscaleFactor();c=this._source.type==="raster-array"?new yl(r,y,this.transform.tileZoom,_,this._isRaster):new vl(r,y,this.transform.tileZoom,_,this._isRaster,this._source.worldview),this._loadTile(c,this._tileLoaded.bind(this,c,r.key,c.state))}return c.uses++,this._tiles[r.key]=c,p||this._source.fire(new o.z("dataloading",{tile:c,coord:c.tileID,dataType:"source"})),c}_setTileReloadTimer(r,c){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);let p=c.getExpiryTimeout();p&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},p))}_removeTile(r){let c=this._tiles[r];c&&(c.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),c.uses>0||(c.hasData()&&c.state!=="reloading"||c.state==="empty"?this._cache.add(c.tileID,c,c.getExpiryTimeout()):(c.aborted=!0,this._abortTile(c),this._unloadTile(c))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let r in this._tiles)this._removeTile(+r);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(r,c,p){let _=[],y=this.transform;if(!y)return _;let x=y.projection.name==="globe",C=o.aF(y.center.lng);for(let T in this._tiles){let M=this._tiles[T];if(p&&M.clearQueryDebugViz(),M.holdingForFade())continue;let P;if(x){let F=M.tileID.canonical;if(F.z===0){let O=[Math.abs(o.aA(C,...Gc(F,-1))-C),Math.abs(o.aA(C,...Gc(F,1))-C)];P=[0,2*O.indexOf(Math.min(...O))-1]}else{let O=[Math.abs(o.aA(C,...Gc(F,-1))-C),Math.abs(o.aA(C,...Gc(F,0))-C),Math.abs(o.aA(C,...Gc(F,1))-C)];P=[O.indexOf(Math.min(...O))-1]}}else P=[0];for(let F of P){let O=r.containsTile(M,y,c,F);O&&_.push(O)}}return _}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(r){return this._getRenderableCoordinates(r)}_getRenderableCoordinates(r,c){let p=this.getRenderableIds(r,c).map(y=>this._tiles[y].tileID),_=this.transform.projection.name==="globe";for(let y of p)y.projMatrix=this.transform.calculateProjMatrix(y.toUnwrapped()),y.expandedProjMatrix=_?this.transform.calculateProjMatrix(y.toUnwrapped(),!1,!0):y.projMatrix;return p}sortCoordinatesByDistance(r){let c=r.slice(),p=this.transform._camera.position,_=this.transform._camera.forward(),y={};for(let x of c){let C=1/(1<<x.canonical.z);y[x.key]=((x.canonical.x+.5)*C+x.wrap-p[0])*_[0]+((x.canonical.y+.5)*C-p[1])*_[1]-p[2]*_[2]}return c.sort((x,C)=>y[x.key]-y[C.key]),c}hasTransition(){if(this._source.hasTransition())return!0;if($c(this._source.type))for(let r in this._tiles){let c=this._tiles[r];if(c.fadeEndTime!==void 0&&c.fadeEndTime>=o.o.now())return!0}return!1}setFeatureState(r,c,p){this._state.updateState(r=r||"_geojsonTileLayer",c,p)}removeFeatureState(r,c,p){this._state.removeFeatureState(r=r||"_geojsonTileLayer",c,p)}getFeatureState(r,c){return this._state.getState(r=r||"_geojsonTileLayer",c)}setDependencies(r,c,p){let _=this._tiles[r];_&&_.setDependencies(c,p)}reloadTilesForDependencies(r,c){for(let p in this._tiles)this._tiles[p].hasDependency(r,c)&&this._reloadTile(+p,"reloading");this._cache.filter(p=>!p.hasDependency(r,c))}_preloadTiles(r,c){if(!this._sourceLoaded){let T=()=>{this._sourceLoaded&&(this._source.off("data",T),this._preloadTiles(r,c))};return void this._source.on("data",T)}let p=new Map,_=Array.isArray(r)?r:[r],y=this.map.painter.terrain,x=this.usedForTerrain&&y?y.getScaledDemTileSize():this._source.tileSize;for(let T of _){let M=T.coveringTiles({tileSize:x,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let P of M)p.set(P.key,P);this.usedForTerrain&&T.updateElevation(!1)}let C=Array.from(p.values());o.bv(C,(T,M)=>{let P=new vl(T,this._source.tileSize*T.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(P,F=>{this._source.type==="raster-dem"&&P.dem&&this._backfillDEM(P),M(F,P)})},c)}}function Vp(f,r){let c=Math.abs(2*f.wrap)-+(f.wrap<0),p=Math.abs(2*r.wrap)-+(r.wrap<0);return f.overscaledZ-r.overscaledZ||p-c||r.canonical.y-f.canonical.y||r.canonical.x-f.canonical.x}function $c(f){return f==="raster"||f==="image"||f==="video"||f==="custom"}function Gc(f,r){let c=1<<f.z;return[f.x/c+r,(f.x+1)/c+r]}Ia.maxOverzooming=10,Ia.maxUnderzooming=3;class Up{constructor(r){this.style=r,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];let r=!1,c=!1;for(let p in this.style._mergedLayers){let _=this.style._mergedLayers[p];if(_.type==="fill-extrusion"||_.type==="building")this.layers.push({layer:_,visible:r,visibilityChanged:c});else if(_.type==="model"){let y=this.style.getLayerSource(_);y&&y.type==="batched-model"&&this.layers.push({layer:_,visible:r,visibilityChanged:c})}}}onNewFrame(r){this.layersGotHidden=!1;for(let c of this.layers){let p=c.layer,_=!1;p.type==="fill-extrusion"?_=!p.isHidden(r)&&p.paint.get("fill-extrusion-opacity")>0:p.type==="building"?_=!p.isHidden(r)&&p.paint.get("building-opacity")>0:p.type==="model"&&(_=!p.isHidden(r)&&p.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!_&&c.visible,c.visible=_}}updateZOffset(r,c){this.currentBuildingBuckets=[];for(let _ of this.layers){let y=_.layer,x=this.style.getLayerSourceCache(y),C=1;y.type==="fill-extrusion"?C=_.visible?y.paint.get("fill-extrusion-vertical-scale"):0:y.type==="building"&&(C=_.visible?y.paint.get("building-vertical-scale"):0);let T=x?x.getTile(c):null;if(!T&&x)for(let M in x._tiles){let P=x._tiles[M];if(c.canonical.isChildOf(P.tileID.canonical)){T=P;break}}this.currentBuildingBuckets.push({bucket:T?T.getBucket(y):null,tileID:T?T.tileID:c,verticalScale:C})}r.hasAnyZOffset=!1;let p=!1;for(let _=0;_<r.symbolInstances.length;_++){let y=r.symbolInstances.get(_),x=y.zOffset,C=this._getHeightAtTileOffset(c,y.tileAnchorX,y.tileAnchorY);y.zOffset=C!==Number.NEGATIVE_INFINITY?C:x,p||x===y.zOffset||(p=!0),r.hasAnyZOffset||y.zOffset===0||(r.hasAnyZOffset=!0)}p&&(r.zOffsetBuffersNeedUpload=!0,r.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(r,c,p,_){let y=c,x=p;if(r.canonical.z!==_.canonical.z){let C=_.canonical,T=1/(1<<r.canonical.z-C.z);y=(c+r.canonical.x*o.al)*T-C.x*o.al|0,x=(p+r.canonical.y*o.al)*T-C.y*o.al|0}return{tileX:y,tileY:x}}_getHeightAtTileOffset(r,c,p){let _,y;for(let x=0;x<this.layers.length;++x){let C=this.layers[x].layer;if(C.type!=="fill-extrusion"&&C.type!=="building")continue;let{bucket:T,tileID:M,verticalScale:P}=this.currentBuildingBuckets[x];if(!T)continue;let{tileX:F,tileY:O}=this._mapCoordToOverlappingTile(r,c,p,M),z=T.getHeightAtTileCoord(F,O);z&&z.height!==void 0&&(z.hidden?_=z.height:y=Math.max(z.height*P,y||0))}if(y!==void 0)return y;for(let x=0;x<this.layers.length;++x){let C=this.layers[x];if(C.layer.type!=="model"||!C.visible)continue;let{bucket:T,tileID:M}=this.currentBuildingBuckets[x];if(!T)continue;let{tileX:P,tileY:F}=this._mapCoordToOverlappingTile(r,c,p,M),O=T.getHeightAtTileCoord(P,F);if(O&&!O.hidden)return O.height===void 0&&_!==void 0?Math.min(O.maxHeight,_)*O.verticalScale:O.height?O.height*O.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function xl(f,r){let c={};for(let p in f)p!=="ref"&&(c[p]=f[p]);return o.bw.forEach(p=>{p in r&&(c[p]=r[p])}),c}function Bu(f){f=f.slice();let r=Object.create(null);for(let c=0;c<f.length;c++)r[f[c].id]=f[c];for(let c=0;c<f.length;c++)"ref"in f[c]&&(f[c]=xl(f[c],r[f[c].ref]));return f}let si={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function df(f,r,c){c.push({command:si.addSource,args:[f,r[f]]})}function eh(f,r,c){r.push({command:si.removeSource,args:[f]}),c[f]=!0}function th(f,r,c,p){eh(f,c,p),df(f,r,c)}function Hp(f,r,c){let p;for(p in f[c])if(f[c].hasOwnProperty(p)&&p!=="data"&&!o.bx(f[c][p],r[c][p]))return!1;for(p in r[c])if(r[c].hasOwnProperty(p)&&p!=="data"&&!o.bx(f[c][p],r[c][p]))return!1;return!0}function nh(f,r,c,p,_,y){let x;for(x in r=r||{},f=f||{})f.hasOwnProperty(x)&&(o.bx(f[x],r[x])||c.push({command:y,args:[p,x,r[x],_]}));for(x in r)r.hasOwnProperty(x)&&!f.hasOwnProperty(x)&&(o.bx(f[x],r[x])||c.push({command:y,args:[p,x,r[x],_]}))}function ih(f){return f.id}function rh(f,r){return f[r.id]=r,f}function qc(f,r,c){let p=r.createTileMatrix(f,f.worldSize,c.toUnwrapped());return o.aB(new Float32Array(16),f.projMatrix,p)}function Wc(f,r,c){if(r.projection.name===c.projection.name)return f.projMatrix;let p=c.clone();return p.setProjection(r.projection),qc(p,r.getProjection(),f)}function hf(f,r,c){return r.name===c.projection.name?f.projMatrix:qc(c,r,f)}class Cv{constructor(r,c){this.reset(r,c)}reset(r,c){this.points=r||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=o.aA(r,0,1);let c=1,p=this._distances[c],_=r*this.paddedLength+this.padding;for(;p<_&&c<this._distances.length;)p=this._distances[++c];let y=c-1,x=this._distances[y],C=p-x,T=C>0?(_-x)/C:0;return this.points[y].mult(1-T).add(this.points[c].mult(T))}}class ju{constructor(r,c,p){let _=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(r/p),this.yCellCount=Math.ceil(c/p);for(let x=0;x<this.xCellCount*this.yCellCount;x++)_.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=c,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,c,p,_,y){this._forEachCell(c,p,_,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(y)}insertCircle(r,c,p,_){this._forEachCell(c-_,p-_,c+_,p+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(c),this.circles.push(p),this.circles.push(_)}_insertBoxCell(r,c,p,_,y,x){this.boxCells[y].push(x)}_insertCircleCell(r,c,p,_,y,x){this.circleCells[y].push(x)}_query(r,c,p,_,y,x){if(p<0||r>this.width||_<0||c>this.height)return!y&&[];let C=[];if(r<=0&&c<=0&&this.width<=p&&this.height<=_){if(y)return!0;for(let T=0;T<this.boxKeys.length;T++)C.push({key:this.boxKeys[T],x1:this.bboxes[4*T],y1:this.bboxes[4*T+1],x2:this.bboxes[4*T+2],y2:this.bboxes[4*T+3]});for(let T=0;T<this.circleKeys.length;T++){let M=this.circles[3*T],P=this.circles[3*T+1],F=this.circles[3*T+2];C.push({key:this.circleKeys[T],x1:M-F,y1:P-F,x2:M+F,y2:P+F})}return x?C.filter(x):C}return this._forEachCell(r,c,p,_,this._queryCell,C,{hitTest:y,seenUids:{box:{},circle:{}}},x),y?C.length>0:C}_queryCircle(r,c,p,_,y){let x=r-p,C=r+p,T=c-p,M=c+p;if(C<0||x>this.width||M<0||T>this.height)return!_&&[];let P=[];return this._forEachCell(x,T,C,M,this._queryCellCircle,P,{hitTest:_,circle:{x:r,y:c,radius:p},seenUids:{box:{},circle:{}}},y),_?P.length>0:P}query(r,c,p,_,y){return this._query(r,c,p,_,!1,y)}hitTest(r,c,p,_,y){return this._query(r,c,p,_,!0,y)}hitTestCircle(r,c,p,_){return this._queryCircle(r,c,p,!0,_)}_queryCell(r,c,p,_,y,x,C,T){let M=C.seenUids,P=this.boxCells[y];if(P!==null){let O=this.bboxes;for(let z of P)if(!M.box[z]){M.box[z]=!0;let V=4*z;if(r<=O[V+2]&&c<=O[V+3]&&p>=O[V+0]&&_>=O[V+1]&&(!T||T(this.boxKeys[z]))){if(C.hitTest)return x.push(!0),!0;x.push({key:this.boxKeys[z],x1:O[V],y1:O[V+1],x2:O[V+2],y2:O[V+3]})}}}let F=this.circleCells[y];if(F!==null){let O=this.circles;for(let z of F)if(!M.circle[z]){M.circle[z]=!0;let V=3*z;if(this._circleAndRectCollide(O[V],O[V+1],O[V+2],r,c,p,_)&&(!T||T(this.circleKeys[z]))){if(C.hitTest)return x.push(!0),!0;{let H=O[V],K=O[V+1],Z=O[V+2];x.push({key:this.circleKeys[z],x1:H-Z,y1:K-Z,x2:H+Z,y2:K+Z})}}}}}_queryCellCircle(r,c,p,_,y,x,C,T){let M=C.circle,P=C.seenUids,F=this.boxCells[y];if(F!==null){let z=this.bboxes;for(let V of F)if(!P.box[V]){P.box[V]=!0;let H=4*V;if(this._circleAndRectCollide(M.x,M.y,M.radius,z[H+0],z[H+1],z[H+2],z[H+3])&&(!T||T(this.boxKeys[V])))return x.push(!0),!0}}let O=this.circleCells[y];if(O!==null){let z=this.circles;for(let V of O)if(!P.circle[V]){P.circle[V]=!0;let H=3*V;if(this._circlesCollide(z[H],z[H+1],z[H+2],M.x,M.y,M.radius)&&(!T||T(this.circleKeys[V])))return x.push(!0),!0}}}_forEachCell(r,c,p,_,y,x,C,T){let M=this._convertToXCellCoord(r),P=this._convertToYCellCoord(c),F=this._convertToXCellCoord(p),O=this._convertToYCellCoord(_);for(let z=M;z<=F;z++)for(let V=P;V<=O;V++)if(y.call(this,r,c,p,_,this.xCellCount*V+z,x,C,T))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,c,p,_,y,x){let C=_-r,T=y-c,M=p+x;return M*M>C*C+T*T}_circleAndRectCollide(r,c,p,_,y,x,C){let T=(x-_)/2,M=Math.abs(r-(_+T));if(M>T+p)return!1;let P=(C-y)/2,F=Math.abs(c-(y+P));if(F>P+p)return!1;if(M<=T||F<=P)return!0;let O=M-T,z=F-P;return O*O+z*z<=p*p}}let pa={unknown:0,flipRequired:1,flipNotRequired:2},Ma=Math.tan(85*Math.PI/180);function Vu(f,r,c,p,_,y,x){let C=o.bB();if(c)if(y.name==="globe"){let T=o.bC(_,r);o.aB(C,C,T)}else{let T=o.bD([],x);C[0]=T[0],C[1]=T[1],C[4]=T[2],C[5]=T[3],p||o.bA(C,C,_.angle)}else o.aB(C,_.labelPlaneMatrix,f);return C}function Uu(f,r,c,p,_,y,x){let C=Vu(f,r,c,p,_,y,x);return y.name==="globe"&&c||(C[2]=C[6]=C[10]=C[14]=0),C}function ma(f,r,c,p,_,y,x){if(c){if(y.name==="globe"){let C=Vu(f,r,c,p,_,y,x);return o.bk(C,C),o.aB(C,f,C),C}{let C=o.by(f),T=o.bz([]);return T[0]=x[0],T[1]=x[1],T[4]=x[2],T[5]=x[3],o.aB(C,C,T),p||o.bA(C,C,-_.angle),C}}return _.glCoordMatrix}function uo(f,r,c,p){let _=[f,r,c,1];c?o.aC(_,_,p):Aa(_,_,p);let y=_[3];return _[0]/=y,_[1]/=y,_[2]/=y,_}function $p(f,r){return Math.min(.5+f/r*.5,1.5)}function Gp(f,r){let c=f[0]/f[3],p=f[1]/f[3];return c>=-r[0]&&c<=r[0]&&p>=-r[1]&&p<=r[1]}function ff(f,r,c,p,_,y,x,C,T,M,P=1){let F=c.transform,O=p?f.textSizeData:f.iconSizeData,z=o.bJ(O,c.transform.zoom,P),V=F.projection.name==="globe",H=[256/c.width*2+1,256/c.height*2+1],K=p?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;K.clear();let Z=null;V&&(Z=p?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);let Q=f.lineVertexArray,ae=p?f.text.placedSymbolArray:f.icon.placedSymbolArray,re=c.transform.width/c.transform.height,ge,ce=!1;for(let ve=0;ve<ae.length;ve++){let me=ae.get(ve),{numGlyphs:he,writingMode:xe}=me;if(xe!==o.bK.vertical||ce||ge===o.bK.horizontal||(ce=!0),ge=xe,(me.hidden||xe===o.bK.vertical)&&!ce){$l(he,K);continue}ce=!1;let Re=new o.P(me.tileAnchorX,me.tileAnchorY),Ie=f.elevationType==="road",qe=!!F.elevation||Ie,{x:je,y:Ke,z:_t}=F.projection.projectTilePoint(Re.x,Re.y,M.canonical),Le=null;if(qe){let Lt=Ie?f.getElevationFeatureForText(ve):null;Le={getElevation:T,elevation:F.elevation,elevationFeature:Lt};let[sn,jn,ei]=T(Re,F.elevation,Lt);je+=sn,Ke+=jn,_t+=ei}let Te=[je,Ke,_t,1];if(o.aC(Te,Te,r),!Gp(Te,H)){$l(he,K);continue}let Je=Te[3],Ue=$p(c.transform.getCameraToCenterDistance(F.projection),Je),at=o.bL(O,z,me),bt=x?at/Ue:at*Ue,jt=uo(je,Ke,_t,_);if(jt[3]<=0){$l(he,K);continue}let mt={},xt=o.an(f.layers[0].layout.get("text-max-angle")),$t=Math.cos(xt),Ft=x?null:Le,At=Ag(me,bt,!1,C,r,_,y,f.glyphOffsetArray,Q,K,Z,jt,Re,mt,re,Ft,F.projection,M,x,$t);ce=At.useVertical,Ft&&At.needsFlipping&&(mt={}),(At.notEnoughRoom||ce||At.needsFlipping&&Ag(me,bt,!0,C,r,_,y,f.glyphOffsetArray,Q,K,Z,jt,Re,mt,re,Ft,F.projection,M,x,$t).notEnoughRoom)&&$l(he,K)}p?(f.text.dynamicLayoutVertexBuffer.updateData(K),Z&&f.text.globeExtVertexBuffer&&f.text.globeExtVertexBuffer.updateData(Z)):(f.icon.dynamicLayoutVertexBuffer.updateData(K),Z&&f.icon.globeExtVertexBuffer&&f.icon.globeExtVertexBuffer.updateData(Z))}function Qn(f,r,c,p,_,y,x,C,T,M,P,F,O,z,V,H,K){let{lineStartIndex:Z,glyphStartIndex:Q,segment:ae}=C,re=Q+C.numGlyphs,ge=Z+C.lineLength,ce=r.getoffsetX(Q),ve=r.getoffsetX(re-1),me=oh(f*ce,c,p,_,y,x,ae,Z,ge,T,M,P,F,O,!0,z,V,H,K);if(!me)return null;let he=oh(f*ve,c,p,_,y,x,ae,Z,ge,T,M,P,F,O,!0,z,V,H,K);return he?{first:me,last:he}:null}function qp(f,r,c,p){return f===o.bK.horizontal&&Math.abs(p)>Math.abs(c)?{useVertical:!0}:f===o.bK.vertical?p>0?{needsFlipping:!0}:null:r!==pa.unknown&&(function(_,y){return _===0||Math.abs(y/_)>Ma})(c,p)?r===pa.flipRequired?{needsFlipping:!0}:null:c<0?{needsFlipping:!0}:null}function Ag(f,r,c,p,_,y,x,C,T,M,P,F,O,z,V,H,K,Z,Q,ae){let re=r/24,ge=f.lineOffsetX*re,ce=f.lineOffsetY*re,{lineStartIndex:ve,glyphStartIndex:me,numGlyphs:he,segment:xe,writingMode:Re,flipState:Ie}=f,qe=ve+f.lineLength,je=Ke=>{if(P){let[Je,Ue,at]=Ke.up,bt=M.length;o.bM(P,bt+0,Je,Ue,at),o.bM(P,bt+1,Je,Ue,at),o.bM(P,bt+2,Je,Ue,at),o.bM(P,bt+3,Je,Ue,at)}let[_t,Le,Te]=Ke.point;o.bN(M,_t,Le,Te,Ke.angle)};if(he>1){let Ke=Qn(re,C,ge,ce,c,F,O,f,T,y,z,H,!1,K,Z,Q,ae);if(!Ke)return{notEnoughRoom:!0};if(p&&!c){let[_t,Le,Te]=Ke.first.point,[Je,Ue,at]=Ke.last.point;[_t,Le]=uo(_t,Le,Te,x),[Je,Ue]=uo(Je,Ue,at,x);let bt=qp(Re,Ie,(Je-_t)*V,Ue-Le);if(f.flipState=bt&&bt.needsFlipping?pa.flipRequired:pa.flipNotRequired,bt)return bt}je(Ke.first);for(let _t=me+1;_t<me+he-1;_t++){let Le=oh(re*C.getoffsetX(_t),ge,ce,c,F,O,xe,ve,qe,T,y,z,H,!1,!1,K,Z,Q,ae);if(!Le)return M.length-=4*(_t-me),{notEnoughRoom:!0};je(Le)}je(Ke.last)}else{if(p&&!c){let _t=uo(O.x,O.y,0,_),Le=ve+xe+1,Te=new o.P(T.getx(Le),T.gety(Le)),Je=uo(Te.x,Te.y,0,_),Ue=Je[3]>0?Je:ln(O,Te,_t,1,_,void 0,K,Z.canonical),at=qp(Re,Ie,(Ue[0]-_t[0])*V,Ue[1]-_t[1]);if(f.flipState=at&&at.needsFlipping?pa.flipRequired:pa.flipNotRequired,at)return at}let Ke=oh(re*C.getoffsetX(me),ge,ce,c,F,O,xe,ve,qe,T,y,z,H,!1,!1,K,Z,Q,ae);if(!Ke)return{notEnoughRoom:!0};je(Ke)}return{}}function Pg(f,r,c,p,_){let{x:y,y:x,z:C}=p.projectTilePoint(f.x,f.y,r);if(!_)return uo(y,x,C,c);let[T,M,P]=_.getElevation(f,_.elevation,_.elevationFeature);return uo(y+T,x+M,C+P,c)}function ln(f,r,c,p,_,y,x,C){let T=Pg(f.sub(r)._unit()._add(f),C,_,x,y);return o.av(T,c,T),o.aw(T,T),o.bG(T,c,T,p)}function oh(f,r,c,p,_,y,x,C,T,M,P,F,O,z,V,H,K,Z,Q){let ae=p?f-r:f+r,re=ae>0?1:-1,ge=0;p&&(re*=-1,ge=Math.PI),re<0&&(ge+=Math.PI);let ce=C+x+(re>0?0:1)|0,ve=_,me=_,he=0,xe=0,Re=Math.abs(ae),Ie=[],qe=[],je=y,Ke=je,_t=o.bE([]),Le=()=>ln(Ke,je,me,Re-he+1,P,O,H,K.canonical);for(;he+xe<=Re;){if(ce+=re,ce<C||ce>=T)return null;if(me=ve,Ke=je,Ie.push(me),z&&qe.push(Ke),je=new o.P(M.getx(ce),M.gety(ce)),ve=F[ce],!ve){let Ft=Pg(je,K.canonical,P,H,O);ve=Ft[3]>0?F[ce]=Ft:Le()}he+=xe;let xt=o.av([],ve,me),$t=o.bF(me,ve);if(c&&$t>0&&xe>0&&o.bI(_t,xt)/(xe*$t)<Q)return null;xe=$t,_t=xt}V&&O&&(F[ce]&&(ve=Le(),xe=o.bF(me,ve),_t=o.av([],ve,me)),F[ce]=ve);let Te=(Re-he)/xe,Je=je.sub(Ke)._mult(Te)._add(Ke),Ue=o.bG([],me,_t,Te),at=[0,0,1],bt=_t[0],jt=_t[1];if(Z&&(at=H.upVector(K.canonical,Je.x,Je.y),at[0]!==0||at[1]!==0||at[2]!==1)){let xt=[at[2],0,-at[0]],$t=o.bH([],at,xt);o.aw(xt,xt),o.aw($t,$t),bt=o.bI(_t,xt),jt=o.bI(_t,$t)}if(c){let xt=o.bH([],at,_t);o.aw(xt,xt),o.bG(Ue,Ue,xt,c*re)}let mt=ge+Math.atan2(jt,bt);return Ie.push(Ue),z&&qe.push(Je),{point:Ue,angle:mt,path:Ie,tilePath:qe,up:at}}function $l(f,r){let c=r.length,p=c+4*f;r.resize(p),r.float32.fill(-1/0,4*c,4*p)}function Aa(f,r,c){let p=r[0],_=r[1];return f[0]=c[0]*p+c[4]*_+c[12],f[1]=c[1]*p+c[5]*_+c[13],f[3]=c[3]*p+c[7]*_+c[15],f}let Pa=100;class Hu{constructor(r,c,p=new ju(r.width+200,r.height+200,25),_=new ju(r.width+200,r.height+200,25)){this.transform=r,this.grid=p,this.ignoredGrid=_,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+Pa,this.screenBottomBoundary=r.height+Pa,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=c}placeCollisionBox(r,c,p,_,y,x,C,T,M,P,F){let O=p.projectedAnchorX,z=p.projectedAnchorY,V=p.projectedAnchorZ,H=p.tileAnchorX,K=p.tileAnchorY,Z=p.elevation,Q=p.tileID,ae=r.getProjection();if(Z&&Q){let[qe,je,Ke]=ae.upVector(Q.canonical,p.tileAnchorX,p.tileAnchorY),_t=ae.upVectorScale(Q.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;O+=qe*Z*_t,z+=je*Z*_t,V+=Ke*Z*_t}let re=r.projection.name==="globe",ge=r.projection.name==="globe"?o.aj(this.transform.zoom):0;if(Q&&re&&ge<1&&!x){let qe=1<<Q.canonical.z,je=o.bO(H,K);o.bP(je,je,1/o.al),o.bQ(je,je,o.bO(Q.canonical.x,Q.canonical.y)),o.bP(je,je,1/qe),o.bR(je,je,o.bO(_[0],_[1])),je[0]=o.bS(je[0],-.5,.5),o.bP(je,je,o.al);let Ke=o.bT(je[0],je[1],o.al/(2*Math.PI),1);o.aC(Ke,Ke,y),O=o.ak(O,Ke[0],ge),z=o.ak(z,Ke[1],ge),V=o.ak(V,Ke[2],ge)}let ce=this.projectAndGetPerspectiveRatio(P,O,z,V,p.tileID,ae.name==="globe"||!!Z||this.transform.pitch>0,ae),ve=M*ce.perspectiveRatio,me=(p.x1*c+C.x-p.padding)*ve+ce.point.x,he=(p.y1*c+C.y-p.padding)*ve+ce.point.y,xe=(p.x2*c+C.x+p.padding)*ve+ce.point.x,Re=(p.y2*c+C.y+p.padding)*ve+ce.point.y,Ie=ce.perspectiveRatio<=.55||ce.occluded;return!this.isInsideGrid(me,he,xe,Re)||!T&&this.grid.hitTest(me,he,xe,Re,F)||Ie?{box:[],offscreen:!1,occluded:ce.occluded}:{box:[me,he,xe,Re],offscreen:this.isOffscreen(me,he,xe,Re),occluded:!1}}placeCollisionCircles(r,c,p,_,y,x,C,T,M,P,F,O,z,V,H,K){let Z=[],Q=this.transform.elevation,ae=r.getProjection(),re=r.elevationType==="road",ge=!!Q||re,ce=o.bU.getAtTileOffsetFunc(K,this.transform.center.lat,this.transform.worldSize,ae),ve=new o.P(p.tileAnchorX,p.tileAnchorY),me=new o.P(p.tileAnchorX,p.tileAnchorY),{x:he,y:xe,z:Re}=ae.projectTilePoint(me.x,me.y,K.canonical),Ie=null;if(ge){let $t=re?r.getElevationFeatureForText(_):null;Ie={getElevation:ce,elevation:Q,elevationFeature:$t};let[Ft,At,Lt]=ce(ve,Q,$t);he+=Ft,xe+=At,Re+=Lt}let qe=ae.name==="globe",je=this.projectAndGetPerspectiveRatio(T,he,xe,Re,K,qe||!!Q||this.transform.pitch>0,ae),{perspectiveRatio:Ke}=je,_t=(O?C/Ke:C*Ke)/o.bX,Le=uo(he,xe,Re,M),Te=p.lineOffsetX*_t,Je=p.lineOffsetY*_t,Ue=o.an(r.layers[0].layout.get("text-max-angle")),at=Math.cos(Ue),bt=je.signedDistanceFromCamera>0?Qn(_t,x,Te,Je,re&&p.flipState===1,Le,me,p,y,M,{},ge&&!O?Ie:null,O&&ge,ae,K,O,at):null,jt=!1,mt=!1,xt=!0;if(bt&&!je.occluded){let $t=.5*V*Ke+H,Ft=new o.P(-100,-100),At=new o.P(this.screenRightBoundary,this.screenBottomBoundary),Lt=new Cv,{first:sn,last:jn}=bt,ei=sn.path.length,Ni=[];for(let Mn=ei-1;Mn>=1;Mn--)Ni.push(sn.path[Mn]);for(let Mn=1;Mn<jn.path.length;Mn++)Ni.push(jn.path[Mn]);let pn=2.5*$t;P&&(Ni=Ni.map(([Mn,Ii,ti],Xi)=>(ge&&!qe&&(ti=ce(Xi<ei-1?sn.tilePath[ei-1-Xi]:jn.tilePath[Xi-ei+2],Q,Ie.elevationFeature)[2]),uo(Mn,Ii,ti,P))),Ni.some(Mn=>Mn[3]<=0)&&(Ni=[]));let Kn=[];if(Ni.length>0){let Mn=1/0,Ii=-1/0,ti=1/0,Xi=-1/0;for(let ci of Ni)Mn=Math.min(Mn,ci[0]),ti=Math.min(ti,ci[1]),Ii=Math.max(Ii,ci[0]),Xi=Math.max(Xi,ci[1]);Ii>=Ft.x&&Mn<=At.x&&Xi>=Ft.y&&ti<=At.y&&(Kn=[Ni.map(ci=>new o.P(ci[0],ci[1]))],(Mn<Ft.x||Ii>At.x||ti<Ft.y||Xi>At.y)&&(Kn=o.bV(Kn,Ft.x,Ft.y,At.x,At.y)))}for(let Mn of Kn){Lt.reset(Mn,.25*$t);let Ii=0;Ii=Lt.length<=.5*$t?1:Math.ceil(Lt.paddedLength/pn)+1;for(let ti=0;ti<Ii;ti++){let Xi=ti/Math.max(Ii-1,1),ci=Lt.lerp(Xi),An=ci.x+Pa,yi=ci.y+Pa;Z.push(An,yi,$t,0);let kn=An-$t,cr=yi-$t,Ci=An+$t,vn=yi+$t;if(xt=xt&&this.isOffscreen(kn,cr,Ci,vn),mt=mt||this.isInsideGrid(kn,cr,Ci,vn),!c&&this.grid.hitTestCircle(An,yi,$t,z)&&(jt=!0,!F))return{circles:[],offscreen:!1,collisionDetected:jt,occluded:!1}}}}return{circles:!F&&jt||!mt?[]:Z,offscreen:xt,collisionDetected:jt,occluded:je.occluded}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let c=[],p=1/0,_=1/0,y=-1/0,x=-1/0;for(let P of r){let F=new o.P(P.x+Pa,P.y+Pa);p=Math.min(p,F.x),_=Math.min(_,F.y),y=Math.max(y,F.x),x=Math.max(x,F.y),c.push(F)}let C=this.grid.query(p,_,y,x).concat(this.ignoredGrid.query(p,_,y,x)),T={},M={};for(let P of C){let F=P.key;if(T[F.bucketInstanceId]===void 0&&(T[F.bucketInstanceId]={}),T[F.bucketInstanceId][F.featureIndex])continue;let O=[new o.P(P.x1,P.y1),new o.P(P.x2,P.y1),new o.P(P.x2,P.y2),new o.P(P.x1,P.y2)];o.bW(c,O)&&(T[F.bucketInstanceId][F.featureIndex]=!0,M[F.bucketInstanceId]===void 0&&(M[F.bucketInstanceId]=[]),M[F.bucketInstanceId].push(F.featureIndex))}return M}insertCollisionBox(r,c,p,_,y){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:_,collisionGroupID:y},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,c,p,_,y){let x=c?this.ignoredGrid:this.grid,C={bucketInstanceId:p,featureIndex:_,collisionGroupID:y};for(let T=0;T<r.length;T+=4)x.insertCircle(C,r[T],r[T+1],r[T+2])}projectAndGetPerspectiveRatio(r,c,p,_,y,x,C){let T=[c,p,_,1],M=!1;_||this.transform.pitch>0?(o.aC(T,T,r),this.fogState&&y&&C.name!=="globe"&&(M=(function(O,z,V,H,K,Z){let Q=Z.calculateFogTileMatrix(K),ae=[z,V,H];return o.af(ae,ae,Q),ht(O,o.ag(ae),Z.pitch,Z._fov)})(this.fogState,c,p,_,y.toUnwrapped(),this.transform)>.9)):Aa(T,T,r);let P=T[3];return{point:new o.P((T[0]/P+1)/2*this.transform.width+Pa,(-T[1]/P+1)/2*this.transform.height+Pa),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(C)/P*.5,1.5),signedDistanceFromCamera:P,occluded:x&&T[2]>P||M}}isOffscreen(r,c,p,_){return p<Pa||r>=this.screenRightBoundary||_<Pa||c>this.screenBottomBoundary}isInsideGrid(r,c,p,_){return p>=0&&r<this.gridRightBoundary&&_>=0&&c<this.gridBottomBoundary}getViewportMatrix(){let r=o.bz([]);return o.bq(r,r,[-100,-100,0]),r}}class Kt{constructor(r,c,p,_){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?c:-c))):_&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class Yn{constructor(r,c,p,_,y,x=!1){this.text=new Kt(r?r.text:null,c,p,y),this.icon=new Kt(r?r.icon:null,c,_,y),this.clipped=x}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class li{constructor(r,c,p,_=!1){this.text=r,this.icon=c,this.skipFade=p,this.clipped=_}}class Ys{constructor(){this.invProjMatrix=o.bB(),this.viewportMatrix=o.bB(),this.circles=[]}}class $u{constructor(r,c,p,_,y){this.bucketInstanceId=r,this.featureIndex=c,this.sourceLayerIndex=p,this.bucketIndex=_,this.tileID=y}}class wi{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){let c=++this.maxGroupID;this.collisionGroups[r]={ID:c,predicate:p=>p.collisionGroupID===c}}return this.collisionGroups[r]}}function Gu(f,r,c,p,_){let{horizontalAlign:y,verticalAlign:x}=o.c0(f),C=-(y-.5)*r,T=-(x-.5)*c,M=o.c1(f,p);return new o.P(C+M[0]*_,T+M[1]*_)}function Zc(f,r,c,p,_){let y=new o.P(f,r);return c&&y._rotate(p?_:-_),y}class Xc{constructor(r,c,p,_,y,x){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new Hu(this.transform,y),this.buildingIndex=x,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new wi(p),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,c,p,_,y=1){let x=p.getBucket(c),C=p.latestFeatureIndex;if(!x||!C||c.fqid!==x.layerIds[0])return;let T=x.layers[0].layout,M=x.layers[0].paint,P=p.collisionBoxArray,F=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),O=p.tileSize/o.al,z=p.tileID.toUnwrapped();this.transform.setProjection(x.projection);let V=(H=p.tileID,K=x.getProjection(),Z=this.transform,K.name===this.projection?Z.calculateProjMatrix(H.toUnwrapped()):qc(Z,K,H));var H,K,Z;let Q=T.get("text-pitch-alignment")==="map",ae=T.get("text-rotation-alignment")==="map";c.compileFilter(c.options);let re=c.dynamicFilter(),ge=c.dynamicFilterNeedsFeature(),ce=this.transform.calculatePixelsToTileUnitsMatrix(p),ve=Uu(V,p.tileID.canonical,Q,ae,this.transform,x.getProjection(),ce),me=null,he=x.getProjection().createInversionMatrix(this.transform,p.tileID.canonical);if(Q){let Te=ma(V,p.tileID.canonical,Q,ae,this.transform,x.getProjection(),ce);me=o.aB([],this.transform.labelPlaneMatrix,Te)}let xe=null;re&&p.latestFeatureIndex&&(xe={unwrappedTileID:z,dynamicFilter:re,dynamicFilterNeedsFeature:ge}),this.retainedQueryData[x.bucketInstanceId]=new $u(x.bucketInstanceId,C,x.sourceLayerIndex,x.index,p.tileID);let[Re,Ie]=x.layers[0].layout.get("text-size-scale-range"),qe=o.aA(y,Re,Ie),[je,Ke]=T.get("icon-size-scale-range"),_t=o.aA(y,je,Ke),Le={bucket:x,layout:T,paint:M,posMatrix:V,invMatrix:he,mercatorCenter:[o.aF(this.transform.center.lng),o.aJ(this.transform.center.lat)],textLabelPlaneMatrix:ve,labelToScreenMatrix:me,clippingData:xe,scale:F,textPixelRatio:O,holdingForFade:p.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:o.bJ(x.textSizeData,this.transform.zoom,qe),partiallyEvaluatedIconSize:o.bJ(x.iconSizeData,this.transform.zoom,_t),collisionGroup:this.collisionGroups.get(x.sourceID),latestFeatureIndex:p.latestFeatureIndex};if(_)for(let Te of x.sortKeyRanges){let{sortKey:Je,symbolInstanceStart:Ue,symbolInstanceEnd:at}=Te;r.push({sortKey:Je,symbolInstanceStart:Ue,symbolInstanceEnd:at,parameters:Le})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:Le})}attemptAnchorPlacement(r,c,p,_,y,x,C,T,M,P,F,O,z,V,H,K,Z,Q,ae,re,ge){let{textOffset0:ce,textOffset1:ve,crossTileID:me}=H,he=[ce,ve],xe=Gu(r,x,C,he,T),Re=this.collisionIndex.placeCollisionBox(Z,T,c,p,_,y,Zc(xe.x,xe.y,M,P,this.transform.angle),V,F,O,z.predicate);if(ae){let Ie=Z.getSymbolInstanceIconSize(ge,this.transform.zoom,H.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Z,Ie,ae,p,_,y,Zc(xe.x,xe.y,M,P,this.transform.angle),V,F,O,z.predicate).box.length===0)return}if(Re.box.length>0){let Ie;return this.prevPlacement&&this.prevPlacement.variableOffsets[me]&&this.prevPlacement.placements[me]&&this.prevPlacement.placements[me].text&&(Ie=this.prevPlacement.variableOffsets[me].anchor),this.variableOffsets[me]={textOffset:he,width:x,height:C,anchor:r,textScale:T,prevAnchor:Ie},this.markUsedJustification(Z,r,H,Q),Z.allowVerticalPlacement&&(this.markUsedOrientation(Z,Q,H),this.placedOrientations[me]=Q),{shift:xe,placedGlyphBoxes:Re}}}placeLayerBucketPart(r,c,p,_,y=1){let{bucket:x,layout:C,paint:T,posMatrix:M,textLabelPlaneMatrix:P,labelToScreenMatrix:F,clippingData:O,textPixelRatio:z,mercatorCenter:V,invMatrix:H,holdingForFade:K,collisionBoxArray:Z,partiallyEvaluatedTextSize:Q,partiallyEvaluatedIconSize:ae,collisionGroup:re,latestFeatureIndex:ge}=r.parameters,ce=C.get("text-optional"),ve=C.get("icon-optional"),me=C.get("text-allow-overlap"),he=C.get("icon-allow-overlap"),xe=C.get("text-rotation-alignment")==="map",Re=C.get("icon-rotation-alignment")==="map",Ie=C.get("text-pitch-alignment")==="map",qe=T.get("symbol-z-offset"),je=C.get("symbol-elevation-reference")==="sea",Ke=C.get("symbol-placement"),[_t,Le]=C.get("text-size-scale-range"),[Te,Je]=C.get("icon-size-scale-range"),Ue=o.aA(y,_t,Le),at=o.aA(y,Te,Je),bt=C.get("text-variable-anchor"),jt=xe&&Ke!=="point",mt=Re&&Ke!=="point",xt=bt&&x.hasTextData(),$t=x.hasIconTextFit()&&xt&&x.hasIconData();this.transform.setProjection(x.projection);let Ft=xt||jt,At=mt||$t,Lt=me&&(he||!x.hasIconData()||ve),sn=he&&(me||!x.hasTextData()||ce),jn=!qe.isConstant();!x.collisionArrays&&Z&&x.deserializeCollisionBoxes(Z),p&&_&&x.updateCollisionDebugBuffers(this.transform.zoom,Z,Ue,at);let ei=(pn,Kn,Mn)=>{let{crossTileID:Ii,numVerticalGlyphVertices:ti}=pn,Xi=null;if(O&&O.dynamicFilterNeedsFeature||jn){let Sr=this.retainedQueryData[x.bucketInstanceId];Xi=ge.loadFeature({featureIndex:pn.featureIndex,bucketIndex:Sr.bucketIndex,sourceLayerIndex:Sr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(O&&!(0,O.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:x.worldview},Xi,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new o.P(pn.tileAnchorX,pn.tileAnchorY),this.transform.calculateDistanceTileData(O.unwrappedTileID)))return this.placements[Ii]=new li(!1,!1,!1,!0),void c.add(Ii);let ci=qe.evaluate(Xi,{});if(c.has(Ii))return;if(K)return void(this.placements[Ii]=new li(!1,!1,!1));let An=!1,yi=!1,kn=!0,cr=!1,Ci=!1,vn=null,ii={box:null,offscreen:null,occluded:null},yr={box:null},Gr=null,Cr=null,kr=null,ya=0,Js=0,ls=0;Mn.textFeatureIndex?ya=Mn.textFeatureIndex:pn.useRuntimeCollisionCircles&&(ya=pn.featureIndex),Mn.verticalTextFeatureIndex&&(Js=Mn.verticalTextFeatureIndex);let ws=x.elevationFeatures?x.elevationFeatures[pn.elevationFeatureIndex]:void 0,el=Sr=>{Sr.tileID=this.retainedQueryData[x.bucketInstanceId].tileID;let qr=this.transform.elevation;Sr.elevation=je?ci:ci+o.bU.getAtTileOffset(Sr.tileID,new o.P(Sr.tileAnchorX,Sr.tileAnchorY),qr,ws),Sr.elevation+=pn.zOffset},cs=Mn.textBox;if(cs){el(cs);let Sr=Zi=>{let Kr=o.bK.horizontal;if(x.allowVerticalPlacement&&!Zi&&this.prevPlacement){let Vo=this.prevPlacement.placedOrientations[Ii];Vo&&(this.placedOrientations[Ii]=Vo,Kr=Vo,this.markUsedOrientation(x,Kr,pn))}return Kr},qr=(Zi,Kr)=>{if(x.allowVerticalPlacement&&ti>0&&Mn.verticalTextBox){for(let Vo of x.writingModes)if(Vo===o.bK.vertical?(ii=Kr(),yr=ii):ii=Zi(),ii&&ii.box&&ii.box.length)break}else ii=Zi()};if(bt){let Zi=bt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ii]){let Dr=this.prevPlacement.variableOffsets[Ii];Zi.indexOf(Dr.anchor)>0&&(Zi=Zi.filter(nl=>nl!==Dr.anchor),Zi.unshift(Dr.anchor))}let Kr=(Dr,nl,Hf)=>{let au=x.getSymbolInstanceTextSize(Q,pn,this.transform.zoom,Kn),$f=(Dr.x2-Dr.x1)*au+2*Dr.padding,Gf=(Dr.y2-Dr.y1)*au+2*Dr.padding,il=pn.hasIconTextFit&&!he?nl:null;il&&el(il);let Cc={box:[],offscreen:!1,occluded:!1},ko=me?2*Zi.length:Zi.length;for(let rl=0;rl<ko;++rl){let Ch=this.attemptAnchorPlacement(Zi[rl%Zi.length],Dr,V,H,Ft,$f,Gf,au,xe,Ie,z,M,re,rl>=Zi.length,pn,Kn,x,Hf,il,Q,ae);if(Ch&&(Cc=Ch.placedGlyphBoxes,Cc&&Cc.box&&Cc.box.length)){An=!0,vn=Ch.shift;break}}return Cc};qr(()=>Kr(cs,Mn.iconBox,o.bK.horizontal),()=>{let Dr=Mn.verticalTextBox;return Dr&&el(Dr),x.allowVerticalPlacement&&!(ii&&ii.box&&ii.box.length)&&ti>0&&Dr?Kr(Dr,Mn.verticalIconBox,o.bK.vertical):{box:null,offscreen:null,occluded:null}}),ii&&(An=ii.box,kn=ii.offscreen,cr=ii.occluded);let Vo=Sr(!(!ii||!ii.box));if(!An&&this.prevPlacement){let Dr=this.prevPlacement.variableOffsets[Ii];Dr&&(this.variableOffsets[Ii]=Dr,this.markUsedJustification(x,Dr.anchor,pn,Vo))}}else{let Zi=(Kr,Vo)=>{let Dr=x.getSymbolInstanceTextSize(Q,pn,this.transform.zoom,Kn),nl=this.collisionIndex.placeCollisionBox(x,Dr,Kr,V,H,Ft,new o.P(0,0),me,z,M,re.predicate);return nl&&nl.box&&nl.box.length&&(this.markUsedOrientation(x,Vo,pn),this.placedOrientations[Ii]=Vo),nl};qr(()=>Zi(cs,o.bK.horizontal),()=>{let Kr=Mn.verticalTextBox;return x.allowVerticalPlacement&&ti>0&&Kr?(el(Kr),Zi(Kr,o.bK.vertical)):{box:null,offscreen:null,occluded:null}}),Sr(!!(ii&&ii.box&&ii.box.length))}}if(Gr=ii,An=Gr&&Gr.box&&Gr.box.length>0,kn=Gr&&Gr.offscreen,cr=Gr&&Gr.occluded,pn.useRuntimeCollisionCircles){let Sr=pn.centerJustifiedTextSymbolIndex>=0?pn.centerJustifiedTextSymbolIndex:pn.verticalPlacedTextSymbolIndex,qr=x.text.placedSymbolArray.get(Sr),Zi=o.bL(x.textSizeData,Q,qr),Kr=C.get("text-padding");Cr=this.collisionIndex.placeCollisionCircles(x,me,qr,Sr,x.lineVertexArray,x.glyphOffsetArray,Zi,M,P,F,p,Ie,re.predicate,pn.collisionCircleDiameter*Zi/o.bX,Kr,this.retainedQueryData[x.bucketInstanceId].tileID),An=me||Cr.circles.length>0&&!Cr.collisionDetected,kn=kn&&Cr.offscreen,cr=Cr.occluded}if(Mn.iconFeatureIndex&&(ls=Mn.iconFeatureIndex),Mn.iconBox){let Sr=qr=>{el(qr);let Zi=pn.hasIconTextFit&&vn?Zc(vn.x,vn.y,xe,Ie,this.transform.angle):new o.P(0,0),Kr=x.getSymbolInstanceIconSize(ae,this.transform.zoom,pn.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(x,Kr,qr,V,H,At,Zi,he,z,M,re.predicate)};yr&&yr.box&&yr.box.length&&Mn.verticalIconBox?(kr=Sr(Mn.verticalIconBox),yi=kr.box.length>0):(kr=Sr(Mn.iconBox),yi=kr.box.length>0),kn=kn&&kr.offscreen,Ci=kr.occluded}let tl=ce||pn.numHorizontalGlyphVertices===0&&ti===0,Il=ve||pn.numIconVertices===0;if(tl||Il?Il?tl||(yi=yi&&An):An=yi&&An:yi=An=yi&&An,An&&Gr&&Gr.box&&this.collisionIndex.insertCollisionBox(Gr.box,C.get("text-ignore-placement"),x.bucketInstanceId,yr&&yr.box&&Js?Js:ya,re.ID),yi&&kr&&this.collisionIndex.insertCollisionBox(kr.box,C.get("icon-ignore-placement"),x.bucketInstanceId,ls,re.ID),Cr&&(An&&this.collisionIndex.insertCollisionCircles(Cr.circles,C.get("text-ignore-placement"),x.bucketInstanceId,ya,re.ID),p)){let Sr=x.bucketInstanceId,qr=this.collisionCircleArrays[Sr];qr===void 0&&(qr=this.collisionCircleArrays[Sr]=new Ys);for(let Zi=0;Zi<Cr.circles.length;Zi+=4)qr.circles.push(Cr.circles[Zi+0]),qr.circles.push(Cr.circles[Zi+1]),qr.circles.push(Cr.circles[Zi+2]),qr.circles.push(Cr.collisionDetected?1:0)}let jo=x.projection.name!=="globe";Lt=Lt&&(jo||!cr),sn=sn&&(jo||!Ci),this.placements[Ii]=new li(An||Lt,yi||sn,kn||x.justReloaded),c.add(Ii)},Ni=this.retainedQueryData[x.bucketInstanceId].tileID;if(x.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(x,Ni),x.elevationType==="road"&&x.updateRoadElevation(Ni.canonical),x.updateZOffset(),x.sortFeaturesByY){let pn=x.getSortedSymbolIndexes(this.transform.angle);for(let Kn=pn.length-1;Kn>=0;--Kn){let Mn=pn[Kn];ei(x.symbolInstances.get(Mn),Mn,x.collisionArrays[Mn])}x.hasAnyZOffset&&o.w(`${x.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(x.hasAnyZOffset){let pn=x.getSortedIndexesByZOffset();for(let Kn=0;Kn<pn.length;++Kn){let Mn=pn[Kn];ei(x.symbolInstances.get(Mn),Mn,x.collisionArrays[Mn])}}else for(let pn=r.symbolInstanceStart;pn<r.symbolInstanceEnd;pn++)ei(x.symbolInstances.get(pn),pn,x.collisionArrays[pn]);if(p&&x.bucketInstanceId in this.collisionCircleArrays){let pn=this.collisionCircleArrays[x.bucketInstanceId];o.bk(pn.invProjMatrix,M),pn.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(r,c,p,_){let{leftJustifiedTextSymbolIndex:y,centerJustifiedTextSymbolIndex:x,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:T,crossTileID:M}=p,P=o.c2(c),F=_===o.bK.vertical?T:P==="left"?y:P==="center"?x:P==="right"?C:-1;y>=0&&(r.text.placedSymbolArray.get(y).crossTileID=F>=0&&y!==F?0:M),x>=0&&(r.text.placedSymbolArray.get(x).crossTileID=F>=0&&x!==F?0:M),C>=0&&(r.text.placedSymbolArray.get(C).crossTileID=F>=0&&C!==F?0:M),T>=0&&(r.text.placedSymbolArray.get(T).crossTileID=F>=0&&T!==F?0:M)}markUsedOrientation(r,c,p){let _=c===o.bK.horizontal||c===o.bK.horizontalOnly?c:0,y=c===o.bK.vertical?c:0,{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:C,rightJustifiedTextSymbolIndex:T,verticalPlacedTextSymbolIndex:M}=p,P=r.text.placedSymbolArray;x>=0&&(P.get(x).placedOrientation=_),C>=0&&(P.get(C).placedOrientation=_),T>=0&&(P.get(T).placedOrientation=_),M>=0&&(P.get(M).placedOrientation=y)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;let c=this.prevPlacement,p=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;let _=c?c.symbolFadeChange(r):1,y=c?c.opacities:{},x=c?c.variableOffsets:{},C=c?c.placedOrientations:{};for(let T in this.placements){let M=this.placements[T],P=y[T];P?(this.opacities[T]=new Yn(P,_,M.text,M.icon,null,M.clipped),p=p||M.text!==P.text.placed||M.icon!==P.icon.placed):(this.opacities[T]=new Yn(null,_,M.text,M.icon,M.skipFade,M.clipped),p=p||M.text||M.icon)}for(let T in y){let M=y[T];if(!this.opacities[T]){let P=new Yn(M,_,!1,!1);P.isHidden()||(this.opacities[T]=P,p=p||M.text.placed||M.icon.placed)}}for(let T in x)this.variableOffsets[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.variableOffsets[T]=x[T]);for(let T in C)this.placedOrientations[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.placedOrientations[T]=C[T]);p?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:r)}updateLayerOpacities(r,c,p,_){let y=new Set;for(let x of c){let C=x.getBucket(r);C&&x.latestFeatureIndex&&r.fqid===C.layerIds[0]&&(this.updateBucketOpacities(C,y,x,x.collisionBoxArray,p,_,x.tileID,r.scope),C.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(C,x.tileID),C.elevationType==="road"&&C.updateRoadElevation(x.tileID.canonical),C.updateZOffset())}}updateBucketOpacities(r,c,p,_,y,x,C,T){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();let M=r.layers[0].layout,P=r.layers[0].paint,F=!!r.layers[0].dynamicFilter(),O=new Yn(null,0,!1,!1,!0),z=M.get("text-allow-overlap"),V=M.get("icon-allow-overlap"),H=M.get("text-variable-anchor"),K=M.get("text-rotation-alignment")==="map",Z=M.get("text-pitch-alignment")==="map",Q=P.get("symbol-z-offset"),ae=M.get("symbol-elevation-reference")==="sea",re=!Q.isConstant(),ge=new Yn(null,0,z&&(V||!r.hasIconData()||M.get("icon-optional")),V&&(z||!r.hasTextData()||M.get("text-optional")),!0);!r.collisionArrays&&_&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(_);let ce=(me,he,xe)=>{for(let Re=0;Re<he/4;Re++)me.opacityVertexArray.emplaceBack(xe)},ve=0;x&&r.updateReplacement(C,x);for(let me=0;me<r.symbolInstances.length;me++){let he=r.symbolInstances.get(me),{numHorizontalGlyphVertices:xe,numVerticalGlyphVertices:Re,crossTileID:Ie,numIconVertices:qe,tileAnchorX:je,tileAnchorY:Ke}=he,_t=null,Le=this.retainedQueryData[r.bucketInstanceId];re&&he&&Le&&(_t=p.latestFeatureIndex.loadFeature({featureIndex:he.featureIndex,bucketIndex:Le.bucketIndex,sourceLayerIndex:Le.sourceLayerIndex,layoutVertexArrayOffset:0}));let Te=Q.evaluate(_t,{}),Je=c.has(Ie),Ue=this.opacities[Ie];Je?Ue=O:Ue||(Ue=ge,this.opacities[Ie]=Ue),c.add(Ie);let at=xe>0||Re>0,bt=qe>0,jt=this.placedOrientations[Ie],mt=jt===o.bK.vertical,xt=jt===o.bK.horizontal||jt===o.bK.horizontalOnly;!at&&!bt||Ue.isHidden()||ve++;let $t=!1;if((at||bt)&&x)for(let Ft of r.activeReplacements){if(o.bY(Ft,y,o.bZ.Symbol,T)||Ft.min.x>je||je>Ft.max.x||Ft.min.y>Ke||Ke>Ft.max.y)continue;let At=o.b_(je,Ke,C.canonical,Ft.footprintTileId.canonical);if($t=o.b$(At,Ft.footprint),$t)break}if(at){let Ft=$t?xo:Wu(Ue.text);ce(r.text,xe,mt?xo:Ft),ce(r.text,Re,xt?xo:Ft);let At=Ue.text.isHidden(),{leftJustifiedTextSymbolIndex:Lt,centerJustifiedTextSymbolIndex:sn,rightJustifiedTextSymbolIndex:jn,verticalPlacedTextSymbolIndex:ei}=he,Ni=r.text.placedSymbolArray,pn=At||mt?1:0;Lt>=0&&(Ni.get(Lt).hidden=pn),sn>=0&&(Ni.get(sn).hidden=pn),jn>=0&&(Ni.get(jn).hidden=pn),ei>=0&&(Ni.get(ei).hidden=At||xt?1:0);let Kn=this.variableOffsets[Ie];Kn&&this.markUsedJustification(r,Kn.anchor,he,jt);let Mn=this.placedOrientations[Ie];Mn&&(this.markUsedJustification(r,"left",he,Mn),this.markUsedOrientation(r,Mn,he))}if(bt){let Ft=$t?xo:Wu(Ue.icon),{placedIconSymbolIndex:At,verticalPlacedIconSymbolIndex:Lt}=he,sn=r.icon.placedSymbolArray,jn=Ue.icon.isHidden()?1:0;At>=0&&(ce(r.icon,qe,mt?xo:Ft),sn.get(At).hidden=jn),Lt>=0&&(ce(r.icon,he.numVerticalIconVertices,xt?xo:Ft),sn.get(Lt).hidden=jn)}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){let Ft=r.collisionArrays[me];if(Ft){let At=new o.P(0,0),Lt=!0;if(Ft.textBox||Ft.verticalTextBox){if(H){let jn=this.variableOffsets[Ie];jn?(At=Gu(jn.anchor,jn.width,jn.height,jn.textOffset,jn.textScale),K&&At._rotate(Z?this.transform.angle:-this.transform.angle)):Lt=!1}F&&(Lt=!Ue.clipped),Ft.textBox&&Io(r.textCollisionBox.collisionVertexArray,Ue.text.placed,!Lt||mt,Te,ae,At.x,At.y),Ft.verticalTextBox&&Io(r.textCollisionBox.collisionVertexArray,Ue.text.placed,!Lt||xt,Te,ae,At.x,At.y)}let sn=Lt&&!!(!xt&&Ft.verticalIconBox);Ft.iconBox&&Io(r.iconCollisionBox.collisionVertexArray,Ue.icon.placed,sn,Te,ae,he.hasIconTextFit?At.x:0,he.hasIconTextFit?At.y:0),Ft.verticalIconBox&&Io(r.iconCollisionBox.collisionVertexArray,Ue.icon.placed,!sn,Te,ae,he.hasIconTextFit?At.x:0,he.hasIconTextFit?At.y:0)}}}if(r.fullyClipped=ve===0,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){let me=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=me.invProjMatrix,r.placementViewportMatrix=me.viewportMatrix,r.collisionCircleArray=me.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,c){let p=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*p>r}setStale(){this.stale=!0}}function Io(f,r,c,p,_,y,x){f.emplaceBack(r?1:0,c?1:0,y||0,x||0,p,_?1:0),f.emplaceBack(r?1:0,c?1:0,y||0,x||0,p,_?1:0),f.emplaceBack(r?1:0,c?1:0,y||0,x||0,p,_?1:0),f.emplaceBack(r?1:0,c?1:0,y||0,x||0,p,_?1:0)}let to=Math.pow(2,25),Wp=Math.pow(2,24),gc=Math.pow(2,17),Zp=Math.pow(2,16),qu=Math.pow(2,9),sh=Math.pow(2,8),pf=Math.pow(2,1);function Wu(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;let r=f.placed?1:0,c=Math.floor(127*f.opacity);return c*to+r*Wp+c*gc+r*Zp+c*qu+r*sh+c*pf+r}let xo=0;class bl{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&r.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(r,c,p,_,y,x){let C=this._bucketParts;for(;this._currentTileIndex<r.length;)if(c.getBucketParts(C,_,r[this._currentTileIndex],this._sortAcrossTiles,x),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort((T,M)=>T.sortKey-M.sortKey));this._currentPartIndex<C.length;){let T=C[this._currentPartIndex];if(c.placeLayerBucketPart(T,this._seenCrossTileIDs,p,T.symbolInstanceStart===0,x),this._currentPartIndex++,y())return!0}return!1}}class xs{constructor(r,c,p,_,y,x,C,T,M){this.placement=new Xc(r,y,x,C,T,M),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(r,c,p,_,y){let x=o.o.now(),C=()=>{let T=o.o.now()-x;return!this._forceFullPlacement&&T>2};for(;this._currentPlacementIndex>=0;){let T=c[r[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=M)&&(!T.maxzoom||T.maxzoom>M)){let P=T,F=P.layout.get("symbol-z-elevate"),O=P.layout.get("symbol-sort-key").constantOr(1)!==void 0,z=P.layout.get("symbol-z-order"),V=z==="viewport-y"||z==="auto"&&!(z!=="viewport-y"&&O),H=P.layout.get("text-allow-overlap")||P.layout.get("icon-allow-overlap")||P.layout.get("text-ignore-placement")||P.layout.get("icon-ignore-placement"),K=V&&H,Z=this._inProgressLayer=this._inProgressLayer||new bl(P),Q=o.B(T.source,T.scope);if(Z.continuePlacement(F||K?_[Q]:p[Q],this.placement,this._showCollisionBoxes,T,C,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}let ah=512/o.al/2;class Yc{constructor(r,c,p){this.tileID=r,this.bucketInstanceId=p,this.index=new o.c3(c.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let _=r.canonical.x*o.al,y=r.canonical.y*o.al;for(let x=0;x<c.length;x++){let{key:C,crossTileID:T,tileAnchorX:M,tileAnchorY:P}=c.get(x),F=Math.floor((_+M)*ah),O=Math.floor((y+P)*ah);this.index.add(F,O),this.keys.push(C),this.crossTileIDs.push(T)}this.index.finish()}findMatches(r,c,p){let _=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z),y=ah/Math.pow(2,c.canonical.z-this.tileID.canonical.z),x=c.canonical.x*o.al,C=c.canonical.y*o.al;for(let T=0;T<r.length;T++){let M=r.get(T);if(M.crossTileID)continue;let{key:P,tileAnchorX:F,tileAnchorY:O}=M,z=Math.floor((x+F)*y),V=Math.floor((C+O)*y),H=this.index.range(z-_,V-_,z+_,V+_).sort((K,Z)=>K-Z);for(let K of H){let Z=this.crossTileIDs[K];if(this.keys[K]===P&&!p.has(Z)){p.add(Z),M.crossTileID=Z;break}}}}}class $r{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class wl{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){let c=Math.round((r-this.lng)/360);if(c!==0)for(let p in this.indexes){let _=this.indexes[p],y={};for(let x in _){let C=_[x];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+c),y[C.tileID.key]=C}this.indexes[p]=y}this.lng=r}addBucket(r,c,p){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let y=0;y<c.symbolInstances.length;y++)c.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]=new Set);let _=this.usedCrossTileIDs[r.overscaledZ];for(let y in this.indexes){let x=this.indexes[y];if(Number(y)>r.overscaledZ)for(let C in x){let T=x[C];T.tileID.isChildOf(r)&&T.findMatches(c.symbolInstances,r,_)}else{let C=x[r.scaledTo(Number(y)).key];C&&C.findMatches(c.symbolInstances,r,_)}}for(let y=0;y<c.symbolInstances.length;y++){let x=c.symbolInstances.get(y);x.crossTileID||(x.crossTileID=p.generate(),_.add(x.crossTileID))}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new Yc(r,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(r,c){for(let p of c.crossTileIDs)this.usedCrossTileIDs[r].delete(p)}removeStaleBuckets(r){let c=!1;for(let p in this.indexes){let _=this.indexes[p];for(let y in _)r[_[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,_[y]),delete _[y],c=!0)}return c}}class Gl{constructor(){this.layerIndexes={},this.crossTileIDs=new $r,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,c,p,_){let y=this.layerIndexes[r.fqid];y===void 0&&(y=this.layerIndexes[r.fqid]=new wl);let x=!1,C={};_.name!=="globe"&&y.handleWrapJump(p);for(let T of c){let M=T.getBucket(r);M&&r.fqid===M.layerIds[0]&&(M.bucketInstanceId||(M.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(T.tileID,M,this.crossTileIDs)&&(x=!0),C[M.bucketInstanceId]=!0)}return y.removeStaleBuckets(C)&&(x=!0),x}pruneUnusedLayers(r){let c={};r.forEach(p=>{c[p]=!0});for(let p in this.layerIndexes)c[p]||delete this.layerIndexes[p]}}let Lr=771;class In{constructor(r,c,p,_){this.blendFunction=r,this.blendColor=c.toNonPremultipliedRenderColor(null),this.mask=p,this.blendEquation=_}}In.Replace=[1,0,1,0],In.disabled=new In(In.Replace,o.ao.transparent,[!1,!1,!1,!1]),In.unblended=new In(In.Replace,o.ao.transparent,[!0,!0,!0,!0]),In.alphaBlended=new In([1,Lr,1,Lr],o.ao.transparent,[!0,!0,!0,!0]),In.alphaBlendedNonPremultiplied=new In([770,Lr,770,Lr],o.ao.transparent,[!0,!0,!0,!0]),In.multiply=new In([774,0,774,0],o.ao.transparent,[!0,!0,!0,!0]),In.additive=new In([1,1,1,1],o.ao.transparent,[!0,!0,!0,!0]);class Vt{constructor(r,c,p){this.func=r,this.mask=c,this.range=p}}Vt.ReadOnly=!1,Vt.ReadWrite=!0,Vt.disabled=new Vt(519,Vt.ReadOnly,[0,1]);let _c=7680;class mn{constructor(r,c,p,_,y,x){this.test=r,this.ref=c,this.mask=p,this.fail=_,this.depthFail=y,this.pass=x}}mn.disabled=new mn({func:519,mask:0},0,0,_c,_c,_c);let Zu=1029,mf=2305;class dn{constructor(r,c,p){this.enable=r,this.mode=c,this.frontFace=p}}function Xu(f,r){let c=o.c9(f,3);o.cb(f,r),o.cf(f,3,c)}function gf(f,r){let c=o.c6([]);return o.c7(c,c,-r),o.c8(c,c,-f),c}function Xp(f,r){let c=[f[0],f[1],0],p=[r[0],r[1],0];if(o.ag(c)>=1e-15){let x=o.aw([],c);o.c4(p,x,o.bI(p,x)),r[0]=p[0],r[1]=p[1]}let _=o.bH([],r,f);if(o.c5(_)<1e-15)return null;let y=Math.atan2(-_[1],_[0]);return gf(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),y)}dn.disabled=new dn(!1,Zu,mf),dn.backCCW=new dn(!0,Zu,mf),dn.backCW=new dn(!0,Zu,2304),dn.frontCW=new dn(!0,1028,2304),dn.frontCCW=new dn(!0,1028,mf);class Cl{constructor(r,c){this.position=r,this.orientation=c}get position(){return this._position}set position(r){if(r){let c=r instanceof o.ae?r:new o.ae(r[0],r[1],r[2]);this._renderWorldCopies&&(c.x=o.bS(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(r,c,p){if(this.orientation=null,!this.position)return;let _=this.position,y=p||(this._elevation?this._elevation.getAtPointOrZero(o.ae.fromLngLat(r)):0),x=o.ae.fromLngLat(r,y),C=[x.x-_.x,x.y-_.y,x.z-_.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=Xp(C,c)}setPitchBearing(r,c){this.orientation=gf(o.an(r),o.an(-c))}}class lh{constructor(r,c){this._transform=o.bz([]),this.orientation=c,this.position=r}get mercatorPosition(){let r=this.position;return new o.ae(r[0],r[1],r[2])}get position(){let r=o.c9(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var c;r&&o.cf(this._transform,3,[(c=r)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||o.c6([]),r&&Xu(this._transform,this._orientation)}getPitchBearing(){let r=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,c){this._orientation=gf(r,c),Xu(this._transform,this._orientation)}forward(){let r=o.c9(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){let r=o.c9(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){let r=o.c9(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,c){let p=new Float64Array(16);return o.bk(p,this.getWorldToCamera(r,c)),p}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(r,c,p){let _=this.position;o.c4(_,_,-r);let y=new Float64Array(16);return o.bp(y,[p,p,p]),o.bq(y,y,_),y[10]*=c,y}getWorldToCamera(r,c){let p=new Float64Array(16),_=new Float64Array(4),y=this.position;return o.ca(_,this._orientation),o.c4(y,y,-r),o.cb(p,_),o.bq(p,p,y),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=c,p[9]*=c,p[10]*=c,p[11]*=c,p}getCameraToClipPerspective(r,c,p,_){let y=new Float64Array(16);return o.cc(y,r,c,p,_),y}getCameraToClipOrthographic(r,c,p,_,y,x){let C=new Float64Array(16);return o.cd(C,r,c,p,_,y,x),C}getDistanceToElevation(r,c=!1){let p=r===0?0:o.ce(r,c?o.a_(this.position[1]):this.position[1]),_=this.forward();return(p-this.position[2])/_[2]}clone(){return new lh([...this.position],[...this.orientation])}}let bo={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class as{constructor(r=0,c=0,p=0,_=0){if(isNaN(r)||r<0||isNaN(c)||c<0||isNaN(p)||p<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=c,this.left=p,this.right=_}interpolate(r,c,p){return c.top!=null&&r.top!=null&&(this.top=o.ak(r.top,c.top,p)),c.bottom!=null&&r.bottom!=null&&(this.bottom=o.ak(r.bottom,c.bottom,p)),c.left!=null&&r.left!=null&&(this.left=o.ak(r.left,c.left,p)),c.right!=null&&r.right!=null&&(this.right=o.ak(r.right,c.right,p)),this}getCenter(r,c){let p=o.aA((this.left+r-this.right)/2,0,r),_=o.aA((this.top+c-this.bottom)/2,0,c);return new o.P(p,_)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new as(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}let Kc=15;class Yu{constructor(r,c,p,_,y,x,C){this.tileSize=512,this._renderWorldCopies=y===void 0||y,this._minZoom=r||0,this._maxZoom=c||22,this._minPitch=p??0,this._maxPitch=_??60,this.setProjection(x),this.setMaxBounds(C),this.width=0,this.height=0,this._center=new o.aS(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new as,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new lh,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){let r=new Yu(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.mercatorFromTransition=this.mercatorFromTransition,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r._allowWorldUnderZoom=this._allowWorldUnderZoom,r}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<Kc}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(r,c=!1){let p=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||p)&&this._updateCameraOnTerrain(),(r||p)&&this._constrainCamera(c),this._calcMatrices()}getProjection(){return o.aH(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};let c=this.projection?this.getProjection():void 0;this.projection=o.cl(this.projectionOptions);let p=this.getProjection(),_=!o.bx(c,p);return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setOrthographicProjectionAtLowPitch(r){return this._orthographicProjectionAtLowPitch!==r&&(this._orthographicProjectionAtLowPitch=r,this._calcMatrices(),!0)}setMercatorFromTransition(){let r=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.cl({name:"mercator"});let c=r!==this.projection.name;return c&&this._calcMatrices(),c}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get cameraWorldSize(){let r=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.ce(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return o.bS(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){let c=-r*Math.PI/180;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=o.cm(),o.cn(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){let c=o.aA(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=o.an(r),this._calcMatrices())}get fovX(){return this._fov}get fovY(){let r=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/r)}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){let c=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(r){this._tileCoverLift!==r&&(this._tileCoverLift=r)}_updateCameraOnTerrain(){let r=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,c=this.elevation&&r===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||r===Number.NEGATIVE_INFINITY&&(!c||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let p=this._elevation;c||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&p.exaggeration()&&this._centerAltitudeValidForExaggeration!==p.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*p.exaggeration(),this._centerAltitudeValidForExaggeration=p.exaggeration()):(this._centerAltitude=r||0,this._centerAltitudeValidForExaggeration=p.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;let r=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(r)}sampleAverageElevation(){if(!this._elevation)return 0;let r=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop(),_=0,y=0;for(let x=0;x<c.length;x++){let C=new o.P(c[x][0]*this.width,p+c[x][1]*(this.height-p)),T=r.pointCoordinate(C);if(!T)continue;let M=1/Math.hypot(T[0]-this._camera.position[0],T[1]-this._camera.position[1]);_+=T[3]*M,y+=M}return y===0?NaN:_/y}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let r=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*c,_=this._mercatorZfromZoom(r),y=this._mercatorZfromZoom(this._maxZoom),x=Math.max(_-p,y);this._setZoom(this._zoomFromMercatorZ(x))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){let c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude())),p;p=r.z<this._camera.position[2]?[c.x,c.y,c.z]:[r.x,r.y,r.z];let _=o.ag(o.av([],this._camera.position,p));return o.aA(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let c=!1;if(r.orientation&&!o.co(r.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(r.orientation)),r.position){let p=[r.position.x,r.position.y,r.position.z];o.cp(p,this._camera.position)||(this._setCameraPosition(p),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let r=this._camera.position,c=new Cl;return c.position=new o.ae(r[0],r[1],r[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(r){if(!o.cq(r))return!1;o.cr(r,r);let c=o.cs([],[0,0,-1],r),p=o.cs([],[0,-1,0],r);if(p[2]<0)return!1;let _=Xp(c,p);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(r){let c=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;r[2]=o.aA(r[2],_/p,_/c),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,c,p){this._unmodified=!1,this._edgeInsets.interpolate(r,c,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){let c=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(r){let c=[new o.ct(0,r)];if(this.renderWorldCopies){let p=this.pointCoordinate(new o.P(0,0)),_=this.pointCoordinate(new o.P(this.width,0)),y=this.pointCoordinate(new o.P(this.width,this.height)),x=this.pointCoordinate(new o.P(0,this.height)),C=Math.floor(Math.min(p.x,_.x,y.x,x.x)),T=Math.floor(Math.max(p.x,_.x,y.x,x.x)),M=1;for(let P=C-M;P<=T+M;P++)P!==0&&c.push(new o.ct(P,r))}return c}isLODDisabled(r){return(!r||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(r,c,p){let _=[],y=p!=null,x=!y;if(x&&this.zoom<c||y&&p[0]===0&&p[1]===0)return _;let C=new Set,T=(P,F,O,z,V)=>{let H=o.cX(F,P,O,z,V);C.has(H)||(_.push(new o.aP(P,F,O,z,V)),C.add(H))};for(let P=0;P<r.length;P++){let F=r[P];if(x&&F.canonical.z!==c)continue;let O=F.canonical,z=F.overscaledZ,V=F.wrap,H=1<<O.z,K=O.x+1<H,Z=O.x>0,Q=O.y+1<H,ae=O.y>0,re=F.wrap-(Z?0:1),ge=F.wrap+(K?0:1),ce=Z?O.x-1:H-1,ve=K?O.x+1:0;if(y)p[0]<0?(T(z,ge,O.z,ve,O.y),p[1]<0&&Q&&(T(z,V,O.z,O.x,O.y+1),T(z,ge,O.z,ve,O.y+1)),p[1]>0&&ae&&(T(z,V,O.z,O.x,O.y-1),T(z,ge,O.z,ve,O.y-1))):p[0]>0?(T(z,re,O.z,ce,O.y),p[1]<0&&Q&&(T(z,V,O.z,O.x,O.y+1),T(z,re,O.z,ce,O.y+1)),p[1]>0&&ae&&(T(z,V,O.z,O.x,O.y-1),T(z,re,O.z,ce,O.y-1))):p[1]<0&&Q?T(z,V,O.z,O.x,O.y+1):ae&&T(z,V,O.z,O.x,O.y-1);else{let me=F.visibleQuadrants;1&me&&(T(z,re,O.z,ce,O.y),ae&&(T(z,V,O.z,O.x,O.y-1),T(z,re,O.z,ce,O.y-1))),2&me&&(T(z,ge,O.z,ve,O.y),ae&&(T(z,V,O.z,O.x,O.y-1),T(z,ge,O.z,ve,O.y-1))),4&me&&(T(z,re,O.z,ce,O.y),Q&&(T(z,V,O.z,O.x,O.y+1),T(z,re,O.z,ce,O.y+1))),8&me&&(T(z,ge,O.z,ve,O.y),Q&&(T(z,V,O.z,O.x,O.y+1),T(z,ge,O.z,ve,O.y+1)))}}let M=[];for(let P of _)_.some(F=>P.isChildOf(F))||M.push(P);if(_=M.filter(P=>!r.some(F=>!!(P.overscaledZ<c&&F.isChildOf(P))||P.equals(F)||P.isChildOf(F))),x){let P=1<<c,F=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),O=[P*F.x,P*F.y],z=4,V=z*z;_=_.filter(H=>{let K=H.canonical.x+.5-O[0],Z=H.canonical.y+.5-O[1];return K*K+Z*Z<V})}return _}extendTileCoverToNearPlane(r,c,p){let _=[],y=new Set;for(let Q of r)y.add(Q.key);let x=(Q,ae,re,ge,ce)=>{let ve=o.cX(ae,Q,re,ge,ce);y.has(ve)||(_.push(new o.aP(Q,ae,re,ge,ce)),y.add(ve))},C=r.reduce((Q,ae)=>Math.max(Q,ae.overscaledZ),p),T=1<<p,M=[new o.P(0,0),new o.P(o.al,0),new o.P(o.al,o.al),new o.P(0,o.al)],P=new o.P(0,0),F=new o.P(0,0),O=(Q,ae)=>{let re=Math.floor(Q[0]),ge=Math.floor(Q[1]),ce=(Q[0]-re)*o.al,ve=(Q[1]-ge)*o.al,me=Math.floor(ae[0]),he=Math.floor(ae[1]),xe=(ae[0]-me)*o.al,Re=(ae[1]-he)*o.al;for(let Ie=-1;Ie<=1;Ie++){let qe=re+Ie;if(!(qe<0||qe>=T)){P.x=ce-Ie*o.al,F.x=xe-(qe-me)*o.al;for(let je=-1;je<=1;je++){let Ke=ge+je;P.y=ve-je*o.al,F.y=Re-(Ke-he)*o.al,o.cY(P,F,M)&&x(C,0,p,qe,Ke)}}}},z=c.points,V=z[o.cu],H=z[o.cv],K=this._projectToGround(V,z[o.cw]),Z=this._projectToGround(H,z[o.cx]);return O(V,K),O(H,Z),_}_projectToGround(r,c){return o.cy(o.cz(),r,c,r[2]/(r[2]-c[2]))}coveringTiles(r){let c=this.coveringZoomLevel(r),p=c,_=this.elevation&&this.elevation.exaggeration(),y=_&&!r.isTerrainDEM,x=this.projection.name==="mercator";if(r.minzoom!==void 0&&c<r.minzoom)return[];r.maxzoom!==void 0&&c>r.maxzoom&&(c=r.maxzoom);let C=this.locationCoordinate(this.center),T=this.center.lat,M=1<<c,P=[M*C.x,M*C.y,0],F=this.projection.name==="globe",O=!F,z=o.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,O),V=F?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),H=M*o.ce(1,this.center.lat),K=this._camera.position[2]/o.ce(1,this.center.lat),Z=[M*V.x,M*V.y,K*(O?1:H)],Q=F||_,ae=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),re=this.isLODDisabled(!0)?c:0,ge;if(this._elevation&&r.isTerrainDEM)ge=1e4*this._elevation.exaggeration();else if(this._elevation){let Te=this._elevation.getMinMaxForVisibleTiles();ge=Te?Te.max:this._centerAltitude}else ge=this._centerAltitude;let ce=r.isTerrainDEM?-ge:this._elevation?this._elevation.getMinElevationBelowMSL():0,ve=this.projection.isReprojectedInTileSpace?o.cB(this):1,me=Te=>{let Ue=new o.ae(Te.x+25e-6,Te.y,Te.z),at=new o.ae(Te.x,Te.y+25e-6,Te.z),bt=Te.toLngLat(),jt=Ue.toLngLat(),mt=at.toLngLat(),xt=this.locationCoordinate(bt),$t=this.locationCoordinate(jt),Ft=this.locationCoordinate(mt),At=Math.hypot($t.x-xt.x,$t.y-xt.y),Lt=Math.hypot(Ft.x-xt.x,Ft.y-xt.y);return Math.sqrt(At*Lt)*ve/25e-6},he=Te=>{let Je=ge,Ue=ce;return{aabb:o.cE(this,M,0,0,0,Te,Ue,Je,this.projection),zoom:0,x:0,y:0,minZ:Ue,maxZ:Je,wrap:Te,fullyVisible:!1}},xe=[],Re=[],Ie=c,qe=r.reparseOverscaled?p:c,je=(K-this._centerAltitude)*H,Ke=Te=>{if(!this._elevation||!Te.tileID||!x)return;let Je=this._elevation.getMinMaxForTile(Te.tileID),Ue=Te.aabb;Je?(Ue.min[2]=Je.min,Ue.max[2]=Je.max,Ue.center[2]=(Ue.min[2]+Ue.max[2])/2):(Te.shouldSplit=Le(Te),Te.shouldSplit||(Ue.min[2]=Ue.max[2]=Ue.center[2]=this._centerAltitude))},_t=(Te,Je)=>{if(.707*Je<Te)return 1;let Ue=Je/Te;return Ue/(1.4144271570014144+(Math.pow(1.1,Ue-1.4144271570014144+1)-1)/(1.1-1)-1)},Le=Te=>{if(Te.zoom<re)return!0;if(Te.zoom===Ie)return!1;if(Te.shouldSplit!=null)return Te.shouldSplit;let Je=Te.aabb.distanceX(Z),Ue=Te.aabb.distanceY(Z),at=je,bt=1;if(F){at=Te.aabb.distanceZ(Z);let Lt=Math.pow(2,Te.zoom),sn=o.a_((Te.y+1)/Lt),jn=o.a_(Te.y/Lt),ei=Math.min(Math.max(T,sn),jn),Ni=o.d0(ei)/o.d0(T);if(bt=ei===T?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Ni/this._mercatorScaleRatio),this.zoom<=o.cZ&&Te.zoom===Ie-1&&Ni>=.9)return!0}else if(y&&(at=Te.aabb.distanceZ(Z)*H),this.projection.isReprojectedInTileSpace&&p<=5){let Lt=Math.pow(2,Te.zoom),sn=me(new o.ae((Te.x+.5)/Lt,(Te.y+.5)/Lt));bt=sn>.85?1:sn}if(!x&&!F){let Lt=Math.sqrt(Je*Je+Ue*Ue+at*at),sn=(1<<Ie-Te.zoom)*ae*bt;return sn*=_t(Math.max(at,je),Lt),Lt<sn}let jt=Number.MAX_VALUE,mt=0,xt=Te.aabb.getCorners(),$t=[];for(let Lt of xt){o.av($t,Lt,Z),F||(y?$t[2]*=H:$t[2]=je);let sn=o.bI($t,this._camera.forward());sn<jt&&(jt=sn,mt=Math.abs($t[2]))}let Ft=(1<<Ie-Te.zoom)*ae*bt;if(Ft*=_t(Math.max(mt,je),jt),jt<Ft)return!0;let At=Te.aabb.closestPoint(P);return At[0]===P[0]&&At[1]===P[1]};if(this.renderWorldCopies)for(let Te=1;Te<=3;Te++)xe.push(he(-Te)),xe.push(he(Te));for(xe.push(he(0));xe.length>0;){let Te=xe.pop(),Je=Te.x,Ue=Te.y,at=Te.fullyVisible,bt=()=>this.projection.name==="globe"&&(Te.y===0||Te.y===(1<<Te.zoom)-1);if(!at){let jt=Q?Te.aabb.intersects(z):Te.aabb.intersectsFlat(z);if(jt===0&&bt()){let mt=new o.cC(Te.zoom,Je,Ue);jt=o.cD(this,M,mt,!0).intersects(z)}if(jt===0)continue;at=jt===2}if(Te.zoom!==Ie&&Le(Te))for(let jt=0;jt<4;jt++){let mt=(Je<<1)+jt%2,xt=(Ue<<1)+(jt>>1),$t={aabb:x?Te.aabb.quadrant(jt):o.cE(this,M,Te.zoom+1,mt,xt,Te.wrap,Te.minZ,Te.maxZ,this.projection),zoom:Te.zoom+1,x:mt,y:xt,wrap:Te.wrap,fullyVisible:at,tileID:void 0,shouldSplit:void 0,minZ:Te.minZ,maxZ:Te.maxZ};y&&!F&&($t.tileID=new o.aP(Te.zoom+1===Ie?qe:Te.zoom+1,Te.wrap,Te.zoom+1,mt,xt),Ke($t)),xe.push($t)}else{let jt=Te.zoom===Ie?qe:Te.zoom;if(r.minzoom&&r.minzoom>jt)continue;let mt=0;if(!at){let At=Q?Te.aabb.intersectsPrecise(z):Te.aabb.intersectsPreciseFlat(z);if(At===0&&bt()){let Lt=new o.cC(Te.zoom,Je,Ue);At=o.cD(this,M,Lt,!0).intersectsPrecise(z)}if(At===0)continue;if(r.calculateQuadrantVisibility)if(z.containsPoint(Te.aabb.center))mt=15;else for(let Lt=0;Lt<4;Lt++)Te.aabb.quadrant(Lt).intersects(z)!==0&&(mt|=1<<Lt)}let xt=P[0]-(.5+Je+(Te.wrap<<Te.zoom))*(1<<c-Te.zoom),$t=P[1]-.5-Ue,Ft=Te.tileID?Te.tileID:new o.aP(jt,Te.wrap,Te.zoom,Je,Ue);r.calculateQuadrantVisibility&&(Ft.visibleQuadrants=mt),Re.push({tileID:Ft,distanceSq:xt*xt+$t*$t})}}if(this.fogCullDistSq){let Te=this.fogCullDistSq,Je=this.horizonLineFromTop();Re=Re.filter(Ue=>{let at=[0,0,0,1],bt=[o.al,o.al,0,1],jt=this.calculateFogTileMatrix(Ue.tileID.toUnwrapped());o.aC(at,at,jt),o.aC(bt,bt,jt);let mt=o.cF([],at,bt),xt=o.cG([],at,bt),$t=o.c_(mt,xt);if($t===0)return!0;let Ft=!1,At=this._elevation;if(At&&$t>Te&&Je!==0){let Lt=this.calculateProjMatrix(Ue.tileID.toUnwrapped()),sn;r.isTerrainDEM||(sn=At.getMinMaxForTile(Ue.tileID)),sn||(sn={min:ce,max:ge});let jn=o.cH(this.rotation),ei=[jn[0]*o.al,jn[1]*o.al,sn.max];o.af(ei,ei,Lt),Ft=(1-ei[1])*this.height*.5<Je}return $t<Te||Ft})}return Re.sort((Te,Je)=>Te.distanceSq-Je.distanceSq).map(Te=>Te.tileID)}resize(r,c){this.width=r,this.height=c,this.pixelsToGLUnits=[2/r,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log2(r)}project(r){let c=o.aA(r.lat,-o.cI,o.cI),p=this.projection.project(r.lng,c);return new o.P(p.x*this.worldSize,p.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.ce(1,this.center.lat)/this.worldSize}setLocationAtPoint(r,c){let p,_,y=this.centerPoint;if(this.projection.name==="globe"){let C=this.worldSize;p=(c.x-y.x)/C,_=(c.y-y.y)/C}else{let C=this.pointCoordinate(c),T=this.pointCoordinate(y);p=C.x-T.x,_=C.y-T.y}let x=this.locationCoordinate(r);this.setLocation(new o.ae(x.x-p,x.y-_))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r,c){return this.projection.locationPoint(this,r,c)}locationPoint3D(r,c){return this.projection.locationPoint(this,r,c,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r,c){return this.coordinateLocation(this.pointCoordinate3D(r,c))}locationCoordinate(r,c){let p=c?o.ce(c,r.lat):void 0,_=this.projection.project(r.lng,r.lat);return new o.ae(_.x,_.y,p)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,c){let p=c??this._centerAltitude,_=[r.x,r.y,0,1],y=[r.x,r.y,1,1];o.aC(_,_,this.pixelMatrixInverse),o.aC(y,y,this.pixelMatrixInverse);let x=y[3];o.cJ(_,_,1/_[3]),o.cJ(y,y,1/x);let C=_[2],T=y[2];return{p0:_,p1:y,t:C===T?0:(p-C)/(T-C)}}screenPointToMercatorRay(r){let c=[r.x,r.y,0,1],p=[r.x,r.y,1,1];return o.aC(c,c,this.pixelMatrixInverse),o.aC(p,p,this.pixelMatrixInverse),o.cJ(c,c,1/c[3]),o.cJ(p,p,1/p[3]),c[2]=o.ce(c[2],this._center.lat)*this.worldSize,p[2]=o.ce(p[2],this._center.lat)*this.worldSize,o.cJ(c,c,1/this.worldSize),o.cJ(p,p,1/this.worldSize),new o.ax([c[0],c[1],c[2]],o.aw([],o.av([],p,c)))}rayIntersectionCoordinate(r){let{p0:c,p1:p,t:_}=r,y=o.ce(c[2],this._center.lat),x=o.ce(p[2],this._center.lat);return new o.ae(o.ak(c[0],p[0],_)/this.worldSize,o.ak(c[1],p[1],_)/this.worldSize,o.ak(y,x,_))}pointCoordinate(r,c=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,c)}pointCoordinate3D(r,c){if(!this.elevation)return this.pointCoordinate(r,c);let p=this.projection.pointCoordinate3D(this,r.x,r.y);if(p)return new o.ae(p[0],p[1],p[2]);let _=0,y=this.horizonLineFromTop();if(r.y>y)return this.pointCoordinate(r,c);let x=.02*y,C=r.clone();for(let T=0;T<10&&y-_>x;T++){C.y=o.ak(_,y,.66);let M=this.projection.pointCoordinate3D(this,C.x,C.y);M?(y=C.y,p=M):_=C.y}return p?new o.ae(p[0],p[1],p[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}isPointOnSurface(r){if(r.y<0||r.y>this.height||r.x<0||r.x>this.width)return!1;if(this.elevation||this.zoom>=o.cK)return!this.isPointAboveHorizon(r);let c=this.pointCoordinate(r);return c.y>=0&&c.y<=1}_coordinatePoint(r,c){let p=c&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,_=[r.x*this.worldSize,r.y*this.worldSize,p+r.toAltitude(),1];return o.aC(_,_,this.pixelMatrix),_[3]>0?new o.P(_[0]/_[3],_[1]/_[3]):new o.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:r,left:c}=this._edgeInsets,p=this.height-this._edgeInsets.bottom,_=this.width-this._edgeInsets.right,y=this.pointLocation3D(new o.P(c,r)),x=this.pointLocation3D(new o.P(_,r)),C=this.pointLocation3D(new o.P(_,p)),T=this.pointLocation3D(new o.P(c,p)),M=Math.min(y.lng,x.lng,C.lng,T.lng),P=Math.max(y.lng,x.lng,C.lng,T.lng),F=Math.min(y.lat,x.lat,C.lat,T.lat),O=Math.max(y.lat,x.lat,C.lat,T.lat),z=Math.pow(2,-this.zoom)/16*270,V=this.projection.name==="globe"?1:4,H=(K,Z,Q,ae,re)=>{let ge=(K+Q)/2,ce=(Z+ae)/2,ve=new o.P(ge,ce),{lng:me,lat:he}=this.pointLocation3D(ve),xe=Math.max(0,M-me,F-he,me-P,he-O);M=Math.min(M,me),P=Math.max(P,me),F=Math.min(F,he),O=Math.max(O,he),(re<V||xe>z)&&(H(K,Z,ge,ce,re+1),H(ge,ce,Q,ae,re+1))};if(H(c,r,_,r,1),H(_,r,_,p,1),H(_,p,c,p,1),H(c,p,c,r,1),this.projection.name==="globe"){let[K,Z]=o.cL(this);K?(O=90,P=180,M=-180):Z&&(F=-90,P=180,M=-180)}return new o.aI(new o.aS(M,F),new o.aS(P,O))}_getBoundsRectangular(r,c){let{top:p,left:_}=this._edgeInsets,y=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,C=new o.P(_,p),T=new o.P(x,p),M=new o.P(x,y),P=new o.P(_,y),F=this.pointCoordinate(C,r),O=this.pointCoordinate(T,r),z=this.pointCoordinate(M,c),V=this.pointCoordinate(P,c),H=(K,Z)=>(Z.y-K.y)/(Z.x-K.x);return F.y>1&&O.y>=0?F=new o.ae((1-V.y)/H(V,F)+V.x,1):F.y<0&&O.y<=1&&(F=new o.ae(-V.y/H(V,F)+V.x,0)),O.y>1&&F.y>=0?O=new o.ae((1-z.y)/H(z,O)+z.x,1):O.y<0&&F.y<=1&&(O=new o.ae(-z.y/H(z,O)+z.x,0)),new o.aI().extend(this.coordinateLocation(F)).extend(this.coordinateLocation(O)).extend(this.coordinateLocation(V)).extend(this.coordinateLocation(z))}_getBoundsRectangularTerrain(){let r=this.elevation;if(!r.visibleDemTiles.length||r.isUsingMockSource())return this._getBoundsRectangular(0,0);let c=r.visibleDemTiles.reduce((p,_)=>{if(_.dem){let y=_.dem.tree;p.min=Math.min(p.min,y.minimums[0]),p.max=Math.max(p.max,y.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(c.min*r.exaggeration(),c.max*r.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(r=!0){let c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,p=this.height/2-c*(1-this._horizonShift);return r?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-o.cI,this.maxLat=o.cI,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.aF(this.minLng)*this.tileSize,this.worldMaxX=o.aF(this.maxLng)*this.tileSize,this.worldMinY=o.aJ(this.maxLat)*this.tileSize,this.worldMaxY=o.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,c){return this.projection.createTileMatrix(this,c,r)}calculateDistanceTileData(r){let c=r.key,p=this._distanceTileDataCache;if(p[c])return p[c];let _=r.canonical,y=1/this.height,x=this.cameraWorldSize,C=x/this.zoomScale(_.z),T=(_.x+Math.pow(2,_.z)*r.wrap)*C,M=_.y*C,P=this.point;P.x*=x/this.worldSize,P.y*=x/this.worldSize;let F=this.angle,O=Math.sin(-F),z=-Math.cos(-F);return p[c]={bearing:[O,z],center:[(P.x-T)*y,(P.y-M)*y],scale:C/o.al*y},p[c]}calculateFogTileMatrix(r){let c=r.key,p=this._fogTileMatrixCache;if(p[c])return p[c];let _=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,r);return o.aB(_,this.worldToFogMatrix,_),p[c]=new Float32Array(_),p[c]}calculateProjMatrix(r,c=!1,p=!1){let _=r.key,y;if(y=p?this._expandedProjMatrixCache:c?this._alignedProjMatrixCache:this._projMatrixCache,y[_])return y[_];let x=this.calculatePosMatrix(r,this.worldSize),C;return C=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:p?this.expandedFarZProjMatrix:c?this.alignedProjMatrix:this.projMatrix,o.aB(x,C,x),y[_]=new Float32Array(x),y[_]}calculatePixelsToTileUnitsMatrix(r){let c=r.tileID.key,p=this._pixelsToTileUnitsCache;if(p[c])return p[c];let _=o.cM(r,this);return p[c]=_,p[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){let r=1/this.worldSize,c=o.bp([],[r,r,r]);return o.aB(c,c,this.globeMatrix),c}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let r=this._elevation;this._updateCameraState();let c=o.ce(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(c),_=this._camera.forward(),y=o.ce(1,this._center.lat);p[2]/=y,_[2]/=y,o.aw(_,_);let x=r.raycast(p,_,r.exaggeration());if(x){let C=o.bG([],p,_,x),T=new o.ae(C[0],C[1],o.ce(C[2],o.a_(C[1]))),M=(T.z+o.ag([T.x-p[0],T.y-p[1],T.z-p[2]*y]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(M),this._centerAltitude=T.toAltitude(),this._center=this.coordinateLocation(T),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(r=!1){if(!this._elevation)return;let c=this._elevation,p=o.ce(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(p),y=c.getAtPointOrZero(new o.ae(..._)),x=this.pixelsPerMeter/this.worldSize*y,C=this._minimumHeightOverTerrain(),T=_[2]-x;if(T<=C)if(T<0||r){let M=this.locationCoordinate(this._center,this._centerAltitude),P=[_[0],_[1],M.z-_[2]],F=o.ag(P);P[2]-=(C-T)/this._pixelsPerMercatorPixel;let O=o.ag(P);if(O===0)return;o.c4(P,P,F/O*this._pixelsPerMercatorPixel),this._camera.position=[_[0],_[1],M.z*this._pixelsPerMercatorPixel-P[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let r=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||r){let O=this.center;return O.lat=o.aA(O.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!r)&&(O.lng=o.aA(O.lng,this.minLng,this.maxLng)),this.center=O,void(this._constraining=!1)}let c=this._unmodified,{x:p,y:_}=this.point,y=0,x=p,C=_,T=this.width/2,M=this.height/2,P=this.worldMinY*this.scale,F=this.worldMaxY*this.scale;if(_-M<P&&(C=P+M),_+M>F&&(C=F-M),F-P<this.height&&(y=Math.max(y,this.height/(F-P)),C=(F+P)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let O=this.worldMinX*this.scale,z=this.worldMaxX*this.scale,V=this.worldSize/2-(O+z)/2;x=(p+V+this.worldSize)%this.worldSize-V,x-T<O&&(x=O+T),x+T>z&&(x=z-T),z-O<this.width&&(y=Math.max(y,this.width/(z-O)),x=(z+O)/2)}x===p&&C===_||this._allowWorldUnderZoom||(this.center=this.unproject(new o.P(x,C))),y&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(y)),this._constrainCamera(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let r=this.centerOffset,c=this.projection.name==="globe",p=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.ce(1,this.center.lat)/o.ce(1,o.d1));let _=o.cN(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let y=this.projection.zAxisUnit==="meters"?p:1,x=this._camera.getWorldToCamera(this.worldSize,y),C,T=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(T[8]=2*-r.x/this.width,T[9]=2*r.y/this.height,this.isOrthographic){let he=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),xe=he*this.aspect,Re=-xe,Ie=-he;xe-=r.x,Re-=r.x,he+=r.y,Ie+=r.y,C=this._camera.getCameraToClipOrthographic(Re,xe,Ie,he,this._nearZ,this._farZ),((qe,je,Ke,_t)=>{for(let Le=0;Le<16;Le++)qe[Le]=o.ak(je[Le],Ke[Le],_t)})(C,C,T,o.c$(this.pitch>=Kc?1:this.pitch/Kc))}else C=T;let M=o.cO([],T,x),P=o.cO([],C,x);if(this.projection.isReprojectedInTileSpace){let he=this.locationCoordinate(this.center),xe=o.bz([]);o.bq(xe,xe,[he.x*this.worldSize,he.y*this.worldSize,0]),o.aB(xe,xe,o.cP(this)),o.bq(xe,xe,[-he.x*this.worldSize,-he.y*this.worldSize,0]),o.aB(P,P,xe),o.aB(M,M,xe),this.inverseAdjustmentMatrix=o.cQ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=o.cR([],P,[this.worldSize,this.worldSize,this.worldSize/y,1]),this.projMatrix=P,this.invProjMatrix=o.bk(new Float64Array(16),this.projMatrix),c){let he=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);he[8]=2*-r.x/this.width,he[9]=2*r.y/this.height,this.expandedFarZProjMatrix=o.cO([],he,x)}else this.expandedFarZProjMatrix=this.projMatrix;let F=o.bk([],C);this.frustumCorners=o.cS.fromInvProjectionMatrix(F,this.horizonLineFromTop(),this.height),this.cameraFrustum=o.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!c);let O=new Float32Array(16);o.bz(O),o.cR(O,O,[1,-1,1]),o.cT(O,O,this._pitch),o.bA(O,O,this.angle);let z=o.cc(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=o.by(z);let V=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;z[8]=2*-r.x/this.width,z[9]=2*(r.y+V)/this.height,this.skyboxMatrix=o.aB(O,z,O);let H=this.point,K=H.x,Z=H.y,Q=this.width%2/2,ae=this.height%2/2,re=Math.cos(this.angle),ge=Math.sin(this.angle),ce=K-Math.round(K)+re*Q+ge*ae,ve=Z-Math.round(Z)+re*ae+ge*Q,me=new Float64Array(P);if(o.bq(me,me,[ce>.5?ce-1:ce,ve>.5?ve-1:ve,0]),this.alignedProjMatrix=me,P=o.bB(),o.cR(P,P,[this.width/2,-this.height/2,1]),o.bq(P,P,[1,-1,0]),this.labelPlaneMatrix=P,P=o.bB(),o.cR(P,P,[1,-1,1]),o.bq(P,P,[-1,-1,0]),o.cR(P,P,[2/this.width,2/this.height,1]),this.glCoordMatrix=P,this.pixelMatrix=o.aB(new Float64Array(16),this.labelPlaneMatrix,M),this._calcFogMatrices(),this._distanceTileDataCache={},P=o.bk(new Float64Array(16),this.pixelMatrix),!P)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=P,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.cU(this);let he=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.af(he,he,x),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=P;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let r=this.cameraWorldSizeForFog,c=this.cameraPixelsPerMeter,p=this._camera.position,_=1/this.height/this._pixelsPerMercatorPixel,y=[r,r,c];o.c4(y,y,_),o.c4(p,p,-1),o.cV(p,p,y);let x=o.bB();o.bq(x,x,p),o.cR(x,x,y),this.mercatorFogMatrix=x,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,c,_)}_computeCameraPosition(r){let c=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),_=this.point,y=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-r/this.worldSize*this._centerAltitude;return[_.x/this.worldSize-p[0]*y,_.y/this.worldSize-p[1]*y,r/this.worldSize*this._centerAltitude-p[2]*y]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){let c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=this._camera.position[2],_=r[2],y=1;this.projection.wrap&&(this.center=this.center.wrap()),_>0&&(y=Math.min((c-p)/_,1)),this._camera.position=o.bG([],this._camera.position,r,y),this._updateStateFromCamera()}_updateStateFromCamera(){let r=this._camera.position,c=this._camera.forward(),{pitch:p,bearing:_}=this._camera.getPitchBearing(),y=o.ce(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,x=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.an(this._maxPitch)),C=Math.max((r[2]-y)/Math.cos(p),x),T=this._zoomFromMercatorZ(C);o.bG(r,r,c,C),this._pitch=o.aA(p,o.an(this.minPitch),o.an(this.maxPitch)),this.angle=o.bS(_,-Math.PI,Math.PI),this._setZoom(o.aA(T,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.ae(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){let r=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,r)*this.tileSize))}zoomFromMercatorZAdjusted(r){let c=0,p=o.cK,_=0,y=1/0;for(;p-c>1e-6&&p>c;){let x=c+.5*(p-c),C=this.tileSize*Math.pow(2,x),T=this.getCameraToCenterDistance(this.projection,x,C),M=this.scaleZoom(T/(Math.max(0,r)*this.tileSize)),P=Math.abs(x-M);P<y&&(y=P,_=x),x<M?c=x:p=x}return _}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,c){let p=Math.min(r.x,c.x),_=Math.max(r.x,c.x),y=Math.min(r.y,c.y),x=Math.max(r.y,c.y);if(y<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let C=[new o.P(p,y),new o.P(_,x),new o.P(p,x),new o.P(_,y)],T=this.renderWorldCopies?-3:0,M=this.renderWorldCopies?4:1;for(let P of C){let F=this.pointRayIntersection(P);if(F.t<0)return!0;let O=this.rayIntersectionCoordinate(F);if(O.x<T||O.y<0||O.x>M||O.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.cW(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.P(0,0),new o.P(this.width,this.height))}zoomDeltaToMovement(r,c){let p=o.ag(o.av([],this._camera.position,r)),_=this._zoomFromMercatorZ(p)+c;return p-this._mercatorZfromZoom(_)}getCameraPoint(){if(this.projection.name==="globe"){let r=(function([c,p,_],y){let x=[c,p,_,1];o.aC(x,x,y);let C=x[3]=Math.max(x[3],1e-6);return x[0]/=C,x[1]/=C,x[2]/=C,x})([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.P(r[0],r[1])}{let r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,r))}}getCameraToCenterDistance(r,c=this.zoom,p=this.worldSize){let _=o.cN(r,c,this.width,this.height,1024),y=r.pixelSpaceConversion(this.center.lat,p,_),x=.5/Math.tan(.5*this._fov)*this.height*y;return this.isOrthographic&&(x=o.ak(1,x,o.c$(this.pitch>=Kc?1:this.pitch/Kc))),x}getWorldToCameraMatrix(){let r=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.aB(r,r,this.globeMatrix),r}getFrustum(r){return o.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r,this.projection.zAxisUnit==="meters")}}let ql=(f,r)=>{if(r>0&&f.terrain&&o.w("Cutoff is currently disabled on terrain"),r<=0||f.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};let c=f.transform,p=Math.max(Math.abs(c._zoom-(f.minCutoffZoom-1)),1),_=c.isLODDisabled(!1)?o.ah(60,45,c.pitch):o.ah(30,15,c.pitch),y=c._farZ-c._nearZ,x=r*c.height,C=((1-(T=_))*c.cameraToCenterDistance+T*(c._farZ+x))*p;var T;return{shouldRenderCutoff:_<1,uniformValues:{u_cutoff_params:[c._nearZ,c._farZ,(C-c._nearZ)/y,(C-x-c._nearZ)/y]}}},ho={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Ev{constructor(r,c){this.aabb=r,this.lastCascade=c}}class Tv{add(r,c){let p=this.receivers[r.key];p!==void 0?(p.aabb.min[0]=Math.min(p.aabb.min[0],c.min[0]),p.aabb.min[1]=Math.min(p.aabb.min[1],c.min[1]),p.aabb.min[2]=Math.min(p.aabb.min[2],c.min[2]),p.aabb.max[0]=Math.max(p.aabb.max[0],c.max[0]),p.aabb.max[1]=Math.max(p.aabb.max[1],c.max[1]),p.aabb.max[2]=Math.max(p.aabb.max[2],c.max[2])):this.receivers[r.key]=new Ev(c,null)}clear(){this.receivers={}}get(r){return this.receivers[r.key]}computeRequiredCascades(r,c,p){let _=o.d8.fromPoints(r.points),y=0;for(let x in this.receivers){let C=this.receivers[x];if(!C||!_.intersectsAabb(C.aabb))continue;C.aabb.min=_.closestPoint(C.aabb.min),C.aabb.max=_.closestPoint(C.aabb.max);let T=C.aabb.getCorners();for(let M=0;M<p.length;M++){let P=!0;for(let F of T){let O=[F[0]*c,F[1]*c,F[2]];if(o.af(O,O,p[M].matrix),O[0]<-1||O[0]>1||O[1]<-1||O[1]>1){P=!1;break}}if(C.lastCascade=M,y=Math.max(y,M),P)break}}return y+1}}class ch{constructor(r){this.painter=r,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Tv,this._depthMode=new Vt(r.context.gl.LEQUAL,Vt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,r.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),r.tp.registerParameter(ho,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),r.tp.registerParameter(ho,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),r.tp.registerParameter(ho,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),r.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(let r of this._cascades)r.texture.destroy(),r.framebuffer.destroy();this._cascades=[]}updateShadowParameters(r,c){let p=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!c||!c.properties)return;let _=c.properties.get("shadow-intensity");if(!c.shadowsEnabled()||_<=0||(this._shadowLayerCount=p.style.order.reduce((V,H)=>{let K=p.style._mergedLayers[H];return V+(K.hasShadowPass()&&!K.isHidden(r.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;let y=p.context,x=ho.shadowMapResolution,C=ho.shadowMapResolution;if(this._cascades.length===0||ho.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let V=0;V<ho.cascadeCount;++V){let H=p._shadowMapDebug,K=y.gl,Z=y.createFramebuffer(x,C,H,"texture"),Q=new o.T(y,{width:x,height:C,data:null},K.DEPTH_COMPONENT16);if(Z.depthAttachment.set(Q.texture),H){let ae=new o.T(y,{width:x,height:C,data:null},K.RGBA8);Z.colorAttachment.set(ae.texture)}this._cascades.push({framebuffer:Z,texture:Q,matrix:[],far:0,boundingSphereRadius:0,frustum:new o.cA,scale:0})}}this.shadowDirection=Yp(c);let T=0;if(r.elevation){let V=r.elevation,H=[1e4,-1e4];V.visibleDemTiles.filter(K=>K.dem).forEach(K=>{let Z=K.dem.tree;H[0]=Math.min(H[0],Z.minimums[0]),H[1]=Math.max(H[1],Z.maximums[0])}),H[0]!==1e4&&(T=(H[1]-H[0])*V.exaggeration())}let M=1.5*r.cameraToCenterDistance,P=3*M,F=new Float64Array(16);for(let V=0;V<this._cascades.length;++V){let H=this._cascades[V],K=r.height/50,Z=1;ho.cascadeCount===1?Z=P:V===0?Z=M:(K=M,Z=P);let[Q,ae]=Og(r,this.shadowDirection,K,Z,ho.shadowMapResolution,T);H.scale=r.scale,H.matrix=Q,H.boundingSphereRadius=ae,o.bk(F,H.matrix),H.frustum=o.cA.fromInvProjectionMatrix(F,1,0,!0),H.far=Z}let O=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[O].far,this._cascades[O].far],this._uniformValues.u_shadow_intensity=_,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/ho.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=ho.shadowMapResolution,this._uniformValues.u_shadowmap_0=bo.ShadowMap0,this._uniformValues.u_shadowmap_1=bo.ShadowMap0+1,this._groundShadowTiles=p.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});let z=p.transform.elevation;for(let V of this._groundShadowTiles){let H={min:0,max:0};if(z){let K=z.getMinMaxForTile(V);K&&(H=K)}this.addShadowReceiver(V.toUnwrapped(),H.min,H.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(r){this._enabled=r}drawShadowPass(r,c){if(!this.enabled)return;let p=this.painter,_=p.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(p.transform.getFrustum(0),p.transform.worldSize,this._cascades),_.viewport.set([0,0,ho.shadowMapResolution,ho.shadowMapResolution]);for(let y=0;y<this._numCascadesToRender;++y){p.currentShadowCascade=y,_.bindFramebuffer.set(this._cascades[y].framebuffer.framebuffer),_.clear({color:o.ao.white,depth:1});for(let x of r.order){let C=r._mergedLayers[x];if(!C.hasShadowPass()||C.isHidden(p.transform.zoom))continue;let T=r.getLayerSourceCache(C),M=T?c[T.id]:void 0;(C.type==="model"||M&&M.length)&&p.renderLayer(p,T,C,M)}}p.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;let r=this.painter,c=r.style,p=r.context,_=p.gl,y=c.directionalLight,x=c.ambientLight;if(!y||!x)return;let C=[],T=ql(r,r.longestCutoffRange);T.shouldRenderCutoff&&C.push("RENDER_CUTOFF"),C.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&C.push("NORMAL_OFFSET");let M=Oa(c,y,x),P=new Vt(_.LEQUAL,Vt.ReadOnly,r.depthRangeFor3D),F=new mn({func:_.EQUAL,mask:255},0,255,_.KEEP,_.KEEP,_.KEEP);for(let O of this._groundShadowTiles){let z=O.toUnwrapped(),V=r.isTileAffectedByFog(O),H=r.getOrCreateProgram("groundShadow",{defines:C,overrideFog:V});this.setupShadows(z,H),r.uploadCommonUniforms(p,H,z,null,T);let K={u_matrix:r.transform.calculateProjMatrix(z),u_ground_shadow_factor:M};H.draw(r,_.TRIANGLES,P,F,In.multiply,dn.disabled,K,"ground_shadow",r.tileExtentBuffer,r.quadTriangleIndexBuffer,r.tileExtentSegments,null,r.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?In.unblended:In.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(r){let c=this.painter.transform,p=c.calculatePosMatrix(r,c.worldSize);return o.aB(p,this._cascades[this.painter.currentShadowCascade].matrix,p),Float32Array.from(p)}calculateShadowPassMatrixFromMatrix(r){let c=o.by(r);return o.aB(c,this._cascades[this.painter.currentShadowCascade].matrix,r),c}setupShadows(r,c,p){if(!this.enabled)return;let _=this.painter.transform,y=this.painter.context,x=y.gl,C=this._uniformValues,T=new Float64Array(16),M=_.calculatePosMatrix(r,_.worldSize);for(let P=0;P<this._cascades.length;P++)o.aB(T,this._cascades[P].matrix,M),C[P===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(T),y.activeTexture.set(x.TEXTURE0+bo.ShadowMap0+P),this._cascades[P].texture.bindExtraParam(x.LINEAR,x.LINEAR,x.CLAMP_TO_EDGE,x.CLAMP_TO_EDGE,x.GREATER);if(this.useNormalOffset=!!p,this.useNormalOffset){let P=o.d6(r.canonical),F=2/_.tileSize*o.al/ho.shadowMapResolution,O=F*this._cascades[0].boundingSphereRadius,z=F*this._cascades[this._cascades.length-1].boundingSphereRadius,V=(p==="vector-tile"?1:3)*(function(H,K,Z,Q,ae){let re=o.aA((H-22)/-22,0,1);return .125*(1-re)+4*re})(_.zoom);C.u_shadow_normal_offset=[P,O*V,z*V],C.u_shadow_bias=[1e-4,.0012,.012]}else C.u_shadow_bias=[36e-5,.0012,.012];c.setShadowUniformValues(y,C)}setupShadowsFromMatrix(r,c,p=!1){if(!this.enabled)return;let _=this.painter.context,y=_.gl,x=this._uniformValues,C=new Float64Array(16);for(let T=0;T<ho.cascadeCount;T++)o.aB(C,this._cascades[T].matrix,r),x[T===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(C),_.activeTexture.set(y.TEXTURE0+bo.ShadowMap0+T),this._cascades[T].texture.bindExtraParam(y.LINEAR,y.LINEAR,y.CLAMP_TO_EDGE,y.CLAMP_TO_EDGE,y.GREATER);if(this.useNormalOffset=p,p){let T=ho.normalOffset;x.u_shadow_normal_offset=[1,T,T],x.u_shadow_bias=[6e-5,.0012,.012]}else x.u_shadow_bias=[36e-5,.0012,.012];c.setShadowUniformValues(_,x)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(r,c,p,_){if(_[2]>=0)return{};let y=(function(T,M,P){let F=P/(1<<T.canonical.z);return new o.d8([T.canonical.x*F+T.wrap*P,T.canonical.y*F+T.wrap*P,0],[(T.canonical.x+1)*F+T.wrap*P,(T.canonical.y+1)*F+T.wrap*P,M])})(r,c,p).getCorners(),x=c/-_[2];_[0]<0?(o.d7(y[0],y[0],[_[0]*x,0,0]),o.d7(y[3],y[3],[_[0]*x,0,0])):_[0]>0&&(o.d7(y[1],y[1],[_[0]*x,0,0]),o.d7(y[2],y[2],[_[0]*x,0,0])),_[1]<0?(o.d7(y[0],y[0],[0,_[1]*x,0]),o.d7(y[1],y[1],[0,_[1]*x,0])):_[1]>0&&(o.d7(y[2],y[2],[0,_[1]*x,0]),o.d7(y[3],y[3],[0,_[1]*x,0]));let C={};return C.vertices=y,C.planes=[vc(y[1],y[0],y[4]),vc(y[2],y[1],y[5]),vc(y[3],y[2],y[6]),vc(y[0],y[3],y[7])],C}addShadowReceiver(r,c,p){this._receivers.add(r,o.d8.fromTileIdAndHeight(r,c,p))}getMaxCascadeForTile(r){let c=this._receivers.get(r);return c&&c.lastCascade?c.lastCascade:0}}function vc(f,r,c){let p=o.av([],c,r),_=o.av([],f,r),y=o.bH([],p,_),x=o.ag(y);return x===0?[0,0,1,0]:(o.c4(y,y,1/x),[y[0],y[1],y[2],-o.bI(y,r)])}function Yp(f){let r=f.properties.get("direction"),c=o.d3(r.x,r.y,r.z);c[2]=o.aA(c[2],0,75);let p=o.d5([c[0],c[1],c[2]]);return o.d4(p.x,p.y,p.z)}function Oa(f,r,c){let p=r.properties.get("color-use-theme")==="none",_=r.properties.get("color"),y=r.properties.get("intensity"),x=r.properties.get("direction"),C=[x.x,x.y,x.z],T=c.properties.get("color-use-theme")==="none",M=c.properties.get("color"),P=c.properties.get("intensity"),F=Math.max(o.bI([0,0,1],C),0),O=[0,0,0];o.c4(O,M.toPremultipliedRenderColor(T?null:f.getLut(r.scope)).toArray01Linear().slice(0,3),P);let z=[0,0,0];return o.c4(z,_.toPremultipliedRenderColor(p?null:f.getLut(c.scope)).toArray01Linear().slice(0,3),F*y),o.da([O[0]>0?O[0]/(O[0]+z[0]):0,O[1]>0?O[1]/(O[1]+z[1]):0,O[2]>0?O[2]/(O[2]+z[2]):0])}function Og(f,r,c,p,_,y){let x=f.zoom,C=f.scale,T=f.worldSize,M=1/T,P=f.aspect,F=Math.sqrt(1+P*P)*Math.tan(.5*f.fovX),O=F*F,z=p-c,V=p+c,H,K;O>z/V?(H=p,K=p*F):(H=.5*V*(1+O),K=.5*Math.sqrt(z*z+2*(p*p+c*c)*O+V*V*O*O));let Z=f.projection.pixelsPerMeter(f.center.lat,T),Q=f._camera.getCameraToWorldMercator(),ae=[0,0,-H*M];o.af(ae,ae,Q);let re=K*M,ge=f._edgeInsets;if(!(ge.left===0&&ge.top===0&&ge.right===0&&ge.bottom===0||ge.left===ge.right&&ge.top===ge.bottom)){let at=f._camera.getWorldToCamera(f.worldSize,f.projection.zAxisUnit==="meters"?Z:1),bt=f._camera.getCameraToClipPerspective(f._fov,f.width/f.height,c,p);bt[8]=2*-f.centerOffset.x/f.width,bt[9]=2*f.centerOffset.y/f.height;let jt=new Float64Array(16);o.cO(jt,bt,at);let mt=new Float64Array(16);o.bk(mt,jt);let xt=o.cA.fromInvProjectionMatrix(mt,T,x,!0);for(let $t of xt.points){let Ft=((ce=$t)[0]/=C,ce[1]/=C,ce[2]=o.ce(ce[2],f._center.lat),ce);re=Math.max(re,o.c5(o.d9([],ae,Ft)))}}var ce;re*=_/(_-1);let ve=Math.acos(r[2]),me=Math.atan2(-r[0],-r[1]),he=new lh;he.position=ae,he.setPitchBearing(ve,me);let xe=he.getWorldToCamera(T,Z),Re=re*T,Ie=Math.min(f._mercatorZfromZoom(17)*T*-2,-2*Re),qe=he.getCameraToClipOrthographic(-Re,Re,-Re,Re,Ie,(Re+y*Z)/r[2]),je=new Float64Array(16);o.aB(je,qe,xe);let Ke=o.d4(Math.floor(1e6*ae[0])/1e6*T,Math.floor(1e6*ae[1])/1e6*T,0),_t=.5*_,Le=[0,0,0];o.af(Le,Ke,je),o.c4(Le,Le,_t);let Te=[Math.floor(Le[0]),Math.floor(Le[1]),Math.floor(Le[2])],Je=[0,0,0];o.av(Je,Le,Te),o.c4(Je,Je,-1/_t);let Ue=new Float64Array(16);return o.bz(Ue),o.bq(Ue,Ue,Je),o.aB(je,Ue,je),[je,Re]}class _f extends o.E{constructor(r){super(),this.requestManager=r,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(r,c){return o.db(this.requestManager.transformRequest(c,o.R.Model).url).then(p=>{if(!p)return;let _=o.dc(p),y=new o.dd(r,c,void 0,void 0,_);return y.computeBoundsAndApplyParent(),y}).catch(p=>{if(p&&p.status===404)return null;this.fire(new o.y(new Error(`Could not load model ${r} from ${c}: ${p.message}`)))})}load(r,c,p={forceReload:!1}){this.models[c]||(this.models[c]={});let _=Object.keys(r),y=[],x=[];for(let C of _){let T=r[C];this.hasURLBeenRequested(T)&&!p.forceReload||(this.modelByURL[T]={modelId:C,scope:c},y.push(this.loadModel(C,T)),x.push(C)),this.models[c][C]||(this.models[c][C]={model:null,numReferences:1})}this.numModelsLoading[c]=(this.numModelsLoading[c]||0)+x.length,Promise.allSettled(y).then(C=>{for(let T=0;T<C.length;T++){let{status:M}=C[T];if(M==="rejected")continue;let{value:P}=C[T];this.models[c][x[T]]||(this.models[c][x[T]]={model:null,numReferences:1}),this.models[c][x[T]].model=P}this.numModelsLoading[c]-=x.length,this.fire(new o.z("data",{dataType:"style"}))}).catch(C=>{this.fire(new o.y(new Error(`Could not load models: ${C.message}`)))})}isLoaded(){for(let r in this.numModelsLoading)if(this.numModelsLoading[r]>0)return!1;return!0}hasModel(r,c,p={exactIdMatch:!1}){return!!(p.exactIdMatch?this.getModel(r,c):this.getModelByURL(this.modelUris[c][r]))}getModel(r,c){return this.models[c]||(this.models[c]={}),this.models[c][r]?this.models[c][r].model:void 0}getModelByURL(r){if(!r)return null;let c=this.modelByURL[r];return c?this.models[c.scope][c.modelId].model:null}hasModelBeenAdded(r,c){return this.models[c]&&this.models[c][r]!==void 0}getModelURIs(r){return this.modelUris[r]||{}}addModel(r,c,p){this.models[p]||(this.models[p]={}),this.modelUris[p]||(this.modelUris[p]={});let _=this.requestManager.normalizeModelURL(c);if((this.hasModel(r,p,{exactIdMatch:!0})||this.hasModelBeenAdded(r,p))&&this.modelUris[p][r]===_)this.models[p][r].numReferences++;else if(this.hasURLBeenRequested(_)){let{scope:y,modelId:x}=this.modelByURL[_];this.models[y][x].numReferences++}else this.modelUris[p][r]=_,this.load({[r]:this.modelUris[p][r]},p)}addModelURLs(r,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});let p=this.modelUris[c];for(let _ in r)p[_]=this.requestManager.normalizeModelURL(r[_])}reloadModels(r){this.load(this.modelUris[r],r,{forceReload:!0})}addModelsFromBucket(r,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});let p={};for(let _ of r)this.hasModel(_,c,{exactIdMatch:!0})||this.hasURLBeenRequested(_)?this.models[c][_].numReferences++:this.modelUris[c][_]&&!this.hasURLBeenRequested(_)?p[_]=this.modelUris[c][_]:!this.hasURLBeenRequested(_)&&o.de(_,!1)&&(this.modelUris[c][_]=this.requestManager.normalizeModelURL(_),p[_]=this.modelUris[c][_]);this.load(p,c)}hasURLBeenRequested(r){return this.modelByURL[r]!==void 0}removeModel(r,c,p=!1,_=!1){if(this.models[c]&&this.models[c][r]&&(this.models[c][r].numReferences--,this.models[c][r].numReferences===0||_)){let y=this.modelUris[c][r];p||delete this.modelUris[c][r],delete this.modelByURL[y];let x=this.models[c][r].model;if(!x)return;delete this.models[c][r],x.destroy()}}destroy(){for(let r of Object.keys(this.models))for(let c of Object.keys(this.models[r])){let p=this.models[r][c].model;delete this.models[r][c],p&&p.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(r){return this.models[r]||(this.models[r]={}),Object.keys(this.models[r])}upload(r,c){this.models[c]||(this.models[c]={});for(let p in this.models[c])this.models[c][p].model&&this.models[c][p].model.upload(r.context)}}let uh=o.a6.colorTheme,Wl=new o.a9({data:new o.aa(uh.data)});function Rg(f){if(!f.metadata||!f.metadata.content_area)return;let r=o.o.devicePixelRatio,{left:c,top:p,width:_,height:y}=f.metadata.content_area,x=c*r,C=p*r;return[x,C,x+_*r,C+y*r]}function kg(f){if(f)return f.map(([r,c])=>[r*o.o.devicePixelRatio,c*o.o.devicePixelRatio])}class Sv{constructor(r,c,p){this.id=r,this.scope=c,this.sourceCache=p,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(r){this.missingRequests.has(r.name)||this.pendingRequests.has(r.name)||this.pendingRequests.add(r.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){let r=new Map;if(!this.sourceCache.loaded())return r;let c=this.sourceCache.getVisibleCoordinates();if(c.length===0)return r;let p=this.sourceCache.getSource();if(!(p instanceof yo))return r;let _=c.map(x=>this.sourceCache.getTile(x)),y=p.getImages(_,Array.from(this.pendingRequests));for(let[x,C]of y)r.set(o.I.from({name:x,iconsetId:this.id}),C),this.pendingRequests.delete(x);for(let x of this.pendingRequests)this.missingRequests.add(x);return this.pendingRequests.clear(),r}}let yc=(f,r)=>q(f,r&&r.filter(c=>c.identifier!=="source.canvas")),Fg=o.aH(si,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),dh=o.aH(si,["setCenter","setZoom","setBearing","setPitch"]),vf=new Set(["background","sky","slot","custom"]),Kp={version:8,layers:[],sources:{}},Jp={duration:300,delay:0};class Xa extends o.E{constructor(r,c={}){super(),this.map=r,this.scope=c.scope||"",this.globalId=null,this.fragments=[],this.importDepth=c.importDepth||0,this.importsCache=c.importsCache||new Map,this.resolvedImports=c.resolvedImports||new Set,this.transition=Object.assign({},Jp),this._buildingIndex=new Up(this),this.crossTileSymbolIndex=new Gl,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=c.styleChanges||new ua,this.dispatcher=c.dispatcher?c.dispatcher:new o.D(o.dg(),this),c.imageManager?this.imageManager=c.imageManager:(this.imageManager=new Wo(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=c.glyphManager?c.glyphManager:new o.dh(r._requestManager,c.localFontFamily?o.di.all:c.localIdeographFontFamily?o.di.ideographs:o.di.none,c.localFontFamily||c.localIdeographFontFamily),c.modelManager?this.modelManager=c.modelManager:(this.modelManager=new _f(r._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=c.configOptions?c.configOptions:new Map,this._configDependentLayers=c.configDependentLayers?c.configDependentLayers:new Set,this._indoorDependentLayers=c.indoorDependentLayers?c.indoorDependentLayers:new Set,this._config=c.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:c.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=c.initialConfig,this.dispatcher.broadcast("setReferrer",o.dj());let p=this;this._rtlTextPluginCallback=Xa.registerForPluginStateChange(_=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(y,x)=>{if(o.dk(y),x&&x.every(C=>C))for(let C in p._sourceCaches){let T=p._sourceCaches[C],M=T.getSource().type;M!=="vector"&&M!=="geojson"||T.reload()}})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;let y=this.getOwnSource(_.sourceId);if(y&&y.vectorLayerIds)for(let x in this._layers){let C=this._layers[x];C.source===y.id&&this._validateLayer(C)}})}load(r){return r?(typeof r=="string"?this.loadURL(r):this.loadJSON(r),this):this}_getGlobalId(r){if(!r)return null;if(typeof r=="string"){if(o.h(r))return r;let c=o.dl(r);if(!c.startsWith("http"))try{return new URL(c,location.href).toString()}catch{return c}return c}return`json://${o.dm(JSON.stringify(r))}`}_diffStyle(r,c,p){this.globalId=this._getGlobalId(r);let _=(y,x)=>{try{x(null,this.setState(y,p))}catch(C){x(C,!1)}};if(typeof r=="string"){let y=this.map._requestManager.normalizeStyleURL(r),x=this.map._requestManager.transformRequest(y,o.R.Style);o.m(x,(C,T)=>{C?this.fire(new o.y(C)):T&&_(T,c)})}else typeof r=="object"&&_(r,c)}loadURL(r,c={}){this.fire(new o.z("dataloading",{dataType:"style"}));let p=typeof c.validate=="boolean"?c.validate:!o.h(r);this.globalId=this._getGlobalId(r),r=this.map._requestManager.normalizeStyleURL(r,c.accessToken),this.resolvedImports.add(r);let _=this.importsCache.get(r);if(_)return this._load(_,p);let y=this.map._requestManager.transformRequest(r,o.R.Style);this._request=o.m(y,(x,C)=>{if(this._request=null,x)this.fire(new o.y(x));else if(C)return this.importsCache.set(r,C),this._load(C,p)})}loadJSON(r,c={}){this.fire(new o.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(r),this._request=o.o.frame(()=>{this._request=null,this._load(r,c.validate!==!1)})}loadEmpty(){this.fire(new o.z("dataloading",{dataType:"style"})),this._load(Kp,!1)}_loadImports(r,c,p){if(this.importDepth>=4)return o.w("Style doesn't support nesting deeper than 5"),Promise.resolve();let _=[];for(let y of r){let x=this._createFragmentStyle(y),C=new Promise(P=>{x.once("style.import.load",P),x.once("error",P)}).then(()=>this.mergeAll());if(_.push(C),this.resolvedImports.has(y.url)){x.loadEmpty();continue}let T=y.data||this.importsCache.get(y.url);T?(x.loadJSON(T,{validate:c}),this._isInternalStyle(T)&&(x.globalId=null)):y.url?x.loadURL(y.url,{validate:c}):x.loadEmpty();let M={style:x,id:y.id,config:y.config};if(p){let P=this.fragments.findIndex(({id:F})=>F===p);this.fragments=this.fragments.slice(0,P).concat(M).concat(this.fragments.slice(P))}else this.fragments.push(M)}return Promise.allSettled(_)}getImportGlobalIds(r=this,c=new Set){for(let p of r.fragments)p.style.globalId&&c.add(p.style.globalId),this.getImportGlobalIds(p.style,c);return[...c.values()]}_createFragmentStyle(r){let c=this.scope?o.B(r.id,this.scope):r.id,p,_=this._initialConfig&&this._initialConfig[c];(r.config||_)&&(p=Object.assign({},r.config,_));let y=new Xa(this.map,{scope:c,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:p,configOptions:this.options,colorThemeOverride:r["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return y.setEventedParent(this.map,{style:y}),y}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(r){return this.isRootStyle()&&(r.fragment||!!r.schema&&r.fragment!==!1)}_load(r,c){if(this._isInternalStyle(r)){let y=Object.assign({},Kp,{imports:[{id:"basemap",data:r,url:""}]},r.center?{center:r.center}:{},r.bearing?{bearing:r.bearing}:{},r.pitch?{pitch:r.pitch}:{},r.zoom?{zoom:r.zoom}:{},r.light?{light:r.light}:{});return this._importedAsBasemap=!0,void this._load(y,c)}if(this.updateConfig(this._config,r.schema),c&&yc(this,ha(r)))return;this._loaded=!0,this.stylesheet=o.dn(r);let p=()=>{for(let T in r.sources)this.addSource(T,r.sources[T],{validate:!1,isInitialLoad:!0});if(r.iconsets)for(let T in r.iconsets)this.addIconset(T,r.iconsets[T]);r.sprite?this._loadIconset(r.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&r.glyphs&&this.glyphManager.setURL(r.glyphs);let y=Bu(this.stylesheet.layers);if(this._order=y.map(T=>T.id),this.stylesheet.light&&o.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){let T=this.stylesheet.lights[0];this.light=new ye(T.properties,T.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new ye(this.stylesheet.light)),this._layers={};for(let T of y){let M=o.dt(T,this.scope,this._styleColorTheme.lut,this.options);M.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(M.fqid),M.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(M.fqid),this._hasAppearances=this._hasAppearances||M.getAppearances().length!==0,M.setEventedParent(this,{layer:{id:M.id}}),this._layers[M.id]=M;let P=this.getOwnLayerSourceCache(M),F=!!this.directionalLight&&this.directionalLight.shadowsEnabled();P&&M.canCastShadows()&&F&&(P.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);let x=this.stylesheet.terrain;x&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(x,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new o.z("data",{dataType:"style"}));let C=this.isRootStyle();r.imports?this._loadImports(r.imports,c).then(()=>{this._reloadImports(),this.fire(new o.z(C?"style.load":"style.import.load"))}).catch(T=>{this.fire(new o.y(new Error("Failed to load imports",T))),this.fire(new o.z(C?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new o.z(C?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];let _=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(_){let y=this._evaluateColorThemeData(_);this._loadColorTheme(y).then(()=>{p()}).catch(x=>{o.w(`Couldn't load color theme from the stylesheet: ${x}`),p()})}else this._styleColorTheme.lut=null,p()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances}mergeAll(){let r,c,p,_,y,x,C,T,M,P,F={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(O=>{if(O.stylesheet){if(O.light!=null&&(r=O.light),O.stylesheet.lights)for(let z of O.stylesheet.lights)z.type==="ambient"&&O.ambientLight!=null&&(c=O.ambientLight),z.type==="directional"&&O.directionalLight!=null&&(p=O.directionalLight);_=this._prioritizeTerrain(_,O.terrain,O.stylesheet.terrain),O.stylesheet.fog&&O.fog!=null&&(y=O.fog),O.stylesheet.snow&&O.snow!=null&&(x=O.snow),O.stylesheet.rain&&O.rain!=null&&(C=O.rain),O.stylesheet.camera!=null&&(P=O.stylesheet.camera),O.stylesheet.projection!=null&&(T=O.stylesheet.projection),O.stylesheet.transition!=null&&(M=O.stylesheet.transition),F[O.scope]=O._styleColorTheme}}),this.light=r,this.ambientLight=c,this.directionalLight=p,this.fog=y,this.snow=x,this.rain=C,this._styleColorThemeForScope=F,_===null?delete this.terrain:this.terrain=_,this.camera=P||{"camera-projection":"perspective"},this.projection=T||{name:"mercator"},this.transition=Object.assign({},Jp,M),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(r){let c=p=>{for(let _ of p.fragments)c(_.style);r(p)};c(this)}_prioritizeTerrain(r,c,p){let _=r&&r.drapeRenderMode===0;return p===null?c&&c.drapeRenderMode===0?c:_?r:null:c!=null&&(!r||_||c&&c.drapeRenderMode===1)?c:r}mergeTerrain(){let r;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(c=>{r=this._prioritizeTerrain(r,c.terrain,c.stylesheet.terrain)}),r===null?delete this.terrain:this.terrain=r}mergeProjection(){let r;this.forEachFragmentStyle(c=>{c.stylesheet.projection!=null&&(r=c.stylesheet.projection)}),this.projection=r||{name:"mercator"}}mergeSources(){let r={},c={},p={};this.forEachFragmentStyle(_=>{for(let y in _._sourceCaches){let x=o.B(y,_.scope);r[x]=_._sourceCaches[y]}for(let y in _._otherSourceCaches){let x=o.B(y,_.scope);c[x]=_._otherSourceCaches[y]}for(let y in _._symbolSourceCaches){let x=o.B(y,_.scope);p[x]=_._symbolSourceCaches[y]}}),this._mergedSourceCaches=r,this._mergedOtherSourceCaches=c,this._mergedSymbolSourceCaches=p}mergeIndoor(){this.forEachFragmentStyle(r=>{if(r.stylesheet&&r.stylesheet.indoor)for(let c of Object.values(r.stylesheet.indoor)){let p=c,_=o.B(p.sourceId,r.scope);this._mergedIndoor[_]=new Set(p.sourceLayers||[])}})}mergeLayers(){let r={},c=[],p={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(x=>{for(let C of x._order){let T=x._layers[C];if(T.type==="slot"){let M=o.dp(C);if(r[M])continue;r[M]=[]}T.slot&&r[T.slot]?r[T.slot].push(T):c.push(T)}}),this._mergedOrder=[];let _=-1,y=(x=[])=>{for(let C of x)if(C.type==="slot"){let T=o.dp(C.id);r[T]&&y(r[T]),this._mergedSlots.push(T)}else{let T=o.B(C.id,C.scope);this._mergedOrder.push(T),p[T]=C,C.is3D(!!this.terrain)&&(this._has3DLayers=!0,_=this._mergedOrder.length-1),C.type==="circle"&&(this._hasCircleLayers=!0),C.type==="symbol"&&(this._hasSymbolLayers=!0),C.type==="clip"&&(this._clipLayerPresent=!0)}};if(y(c),this._has3DLayers){let x={};for(let C=0;C<this._mergedOrder.length;++C){let T=this._mergedOrder[C];x[T]=C===_?1:C<_?p[T].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((C,T)=>x[C]-x[T])}this._mergedLayers=p,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(r){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,r),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(r){return r.data?(function(c,p,_,y){let x=Object.assign({},p);for(let T of Object.keys(uh))x[T]===void 0&&(x[T]=uh[T].default);let C=new o.a8(Wl,c,new Map(_));return C.setTransitionOrValue(x,_),C.untransitioned().possiblyEvaluate(new o.ac(0,{worldview:void 0}))})(this.scope,r,this.options).get("data"):null}_loadColorTheme(r){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;let c=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((p,_)=>{let y="data:image/png;base64,";if(!r||r.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void p();let x=r;x.startsWith(y)||(x=y+x);let C=o.I.from("mapbox-reserved-lut"),T=new Image;T.src=x,T.onerror=()=>{this._styleColorTheme.lutLoading=!1,_(new Error("Failed to load image data"))},T.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==c)return void p();this._styleColorTheme.lutLoading=!1;let{width:M,height:P,data:F}=o.o.getImageData(T);if(P>32)return void _(new Error("The height of the image must be less than or equal to 32 pixels."));if(M!==P*P)return void _(new Error("The width of the image must be equal to the height squared."));this.getImage(C)&&this.removeImage(C),this.addImage(C,{data:new o.q({width:M,height:P},F),pixelRatio:1,sdf:!1,usvg:!1,version:0});let O=this.imageManager.getImage(C,this.scope);O?(this._styleColorTheme.lut={image:O.data,data:r},p()):_(new Error("Missing LUT image."))}})}getLut(r){let c=this._styleColorThemeForScope[r];return c?c.lut:null}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(r){this._spriteRequest=(function(c,p,_){let y,x,C,T=o.o.devicePixelRatio>1?"@2x":"",M=o.m(p.transformRequest(p.normalizeSpriteURL(c,T,".json"),o.R.SpriteJSON),(O,z)=>{M=null,C||(C=O,y=z,F())}),P=o.n(p.transformRequest(p.normalizeSpriteURL(c,T,".png"),o.R.SpriteImage),(O,z)=>{P=null,C||(C=O,x=z,F())});function F(){if(C)_(C);else if(y&&x){let O=o.o.getImageData(x),z={};for(let V in y){let{width:H,height:K,x:Z,y:Q,sdf:ae,pixelRatio:re,stretchX:ge,stretchY:ce,content:ve}=y[V],me=new o.q({width:H,height:K});o.q.copy(O,me,{x:Z,y:Q},{x:0,y:0},{width:H,height:K},null),z[V]={data:me,pixelRatio:re!==void 0?re:1,sdf:ae!==void 0&&ae,stretchX:ge,stretchY:ce,content:ve,usvg:!1,version:0}}_(null,z)}}return{cancel(){M&&(M.cancel(),M=null),P&&(P.cancel(),P=null)}}})(r,this.map._requestManager,(c,p)=>{if(this._spriteRequest=null,c)this.fire(new o.y(c));else if(p){let _=new Map;for(let y in p)_.set(o.I.from(y),p[y]);this.addImages(_)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.z("data",{dataType:"style"}))})}addIconset(r,c){if(c.type==="sprite")return void this._loadSprite(c.url);let p=this.getOwnSourceCache(c.source);if(!p)return void this.fire(new o.y(new Error(`Source "${c.source}" as specified by iconset "${r}" does not exist and cannot be used as an iconset source`)));let _=p.getSource();if(_.type!=="raster-array")return void this.fire(new o.y(new Error(`Source "${c.source}" as specified by iconset "${r}" is not a "raster-array" source and cannot be used as an iconset source`)));_.partial=!1;let y=new Sv(r,this.scope,p);this.imageManager.addImageProvider(y,this.scope)}removeIconset(r){this.imageManager.removeImageProvider(r,this.scope)}_loadIconset(r){if(!o.h(r)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(r);let c=this.map._spriteFormat==="auto";var p,_;this._spriteRequest=(_=(y,x)=>{if(this._spriteRequest=null,y)c?this._loadSprite(r):this.fire(new o.y(y));else if(x){let C=new Map;for(let T in x)C.set(o.I.from(T),x[T]);this.addImages(C)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.z("data",{dataType:"style"}))},o.bt((p=this.map._requestManager).transformRequest(p.normalizeIconsetURL(r),o.R.Iconset),(y,x)=>{if(y)return void _(y);let C={},T=o.df(new o.bs(x));for(let M of T.icons){let P={version:1,pixelRatio:o.o.devicePixelRatio,content:Rg(M),stretchX:M.metadata?kg(M.metadata.stretch_x_areas):void 0,stretchY:M.metadata?kg(M.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:M};C[M.name]=P}_(null,C)}))}_validateLayer(r){let c=this.getOwnSource(r.source);if(!c)return;let p=r.sourceLayer;p&&(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(p)===-1)&&this.fire(new o.y(new Error(`Source layer "${p}" does not exist on source "${c.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(let r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(let{style:r}of this.fragments)if(!r.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((r,c)=>{let p=this.fragments[c];return p&&p.style&&(r.data=p.style.serialize()),r})}_serializeSources(){let r={};for(let c in this._sourceCaches){let p=this._sourceCaches[c].getSource();r[p.id]||(r[p.id]=p.serialize())}return r}_serializeLayers(r){let c=[];for(let p of r){let _=this._layers[p];_&&_.type!=="custom"&&c.push(_.serialize())}return c}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(let r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(let r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(r){return r?this.order:this._mergedOrder}isLayerDraped(r){return!!this.terrain&&r.isDraped(this.getLayerSourceCache(r))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(r){let c=this.getOwnLayer(r);if(c)return c;this.fire(new o.y(new Error(`The layer '${r}' does not exist in the map's style.`)))}_checkSource(r){let c=this.getOwnSource(r);if(c)return c;this.fire(new o.y(new Error(`The source '${r}' does not exist in the map's style.`)))}precompilePrograms(r,c){let p=this.map.painter;if(p)for(let _=r.minzoom||0;_<(r.maxzoom||25.5);_++){let y=r.getProgramIds();if(y)for(let x of y){let C=r.getDefaultProgramParams(x,c.zoom,this._styleColorTheme.lut);C&&(p.style=this,this.fog&&(p._fogVisible=!0,C.overrideFog=!0,p.getOrCreateProgram(x,C)),p._fogVisible=!1,C.overrideFog=!1,p.getOrCreateProgram(x,C),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(C.overrideRtt=!0,p.getOrCreateProgram(x,C)))}}}update(r){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(r),this.directionalLight&&this.directionalLight.recalculate(r);let c=this.calculateLightsBrightness();r.brightness=c||0,c!==this._brightness&&(this._brightness=c,this.dispatcher.broadcast("setBrightness",c)),r.worldview!==this._worldview&&(this._worldview=r.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));let p=this._changes.isDirty(),_=!1;if(this._changes.isDirty()){let C=this._changes.getLayerUpdatesByScope();for(let T in C){let{updatedIds:M,removedIds:P}=C[T];(M||P)&&(this._updateWorkerLayers(T,M,P),_=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(r),this.light&&this.light.updateTransitions(r),this.ambientLight&&this.ambientLight.updateTransitions(r),this.directionalLight&&this.directionalLight.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this.snow&&this.snow.updateTransitions(r),this.rain&&this.rain.updateTransitions(r),this._changes.reset()}let y={};for(let C in this._mergedSourceCaches){let T=this._mergedSourceCaches[C];y[C]=T.used,T.used=!1,T.tileCoverLift=0}for(let C of this._mergedOrder){let T=this._mergedLayers[C];if(T.recalculate(r,this._availableImages),!T.isHidden(r.zoom)){let M=this.getLayerSourceCache(T);M&&(M.used=!0,M.tileCoverLift=Math.max(M.tileCoverLift,T.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(T,r)}):this.precompilePrograms(T,r))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&_&&this.mergeLayers();let x=this.imageManager.getPendingImageProviders();for(let C of x)C.sourceCache.used=!0;for(let C in y){let T=this._mergedSourceCaches[C];y[C]!==T.used&&T.getSource().fire(new o.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:T.getSource().id}))}this.light&&this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.snow&&this.snow.recalculate(r),this.rain&&this.rain.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),p&&this.fire(new o.z("data",{dataType:"style"}))}updateImageProviders(){let r=this.imageManager.getPendingImageProviders();for(let c of r){let p=c.resolvePendingRequests(),_=this.getFragmentStyle(c.scope);_&&_.addImages(p)}}_updateTilesForChangedImages(){let r={};for(let c in this._mergedSourceCaches){let p=this._mergedSourceCaches[c].getSource().scope;r[p]=r[p]||this._changes.getUpdatedImages(p),r[p].length!==0&&this._mergedSourceCaches[c].reloadTilesForDependencies(["icons","patterns"],r[p])}for(let c in r)this._changes.resetUpdatedImages(c)}_updateWorkerLayers(r,c,p){let _=this.getFragmentStyle(r);_&&this.dispatcher.broadcast("updateLayers",{layers:c?_._serializeLayers(c):[],scope:r,removedIds:p||[],options:_.options})}setState(r,c){if(this._checkLoaded(),yc(this,ha(r)))return!1;(r=o.dn(r)).layers=Bu(r.layers);let p=(function(x,C){if(!x)return[{command:si.setStyle,args:[C]}];let T=[];try{if(!o.bx(x.version,C.version))return[{command:si.setStyle,args:[C]}];if(o.bx(x.center,C.center)||T.push({command:si.setCenter,args:[C.center]}),o.bx(x.zoom,C.zoom)||T.push({command:si.setZoom,args:[C.zoom]}),o.bx(x.bearing,C.bearing)||T.push({command:si.setBearing,args:[C.bearing]}),o.bx(x.pitch,C.pitch)||T.push({command:si.setPitch,args:[C.pitch]}),o.bx(x.sprite,C.sprite)||T.push({command:si.setSprite,args:[C.sprite]}),o.bx(x.glyphs,C.glyphs)||T.push({command:si.setGlyphs,args:[C.glyphs]}),o.bx(x.imports,C.imports)||(function(z=[],V=[],H){V=V||[];let K=(z=z||[]).map(ih),Z=V.map(ih),Q=z.reduce(rh,{}),ae=V.reduce(rh,{}),re=K.slice(),ge,ce,ve,me;for(ge=0,ce=0;ge<K.length;ge++)ve=K[ge],ae.hasOwnProperty(ve)?ce++:(H.push({command:si.removeImport,args:[ve]}),re.splice(re.indexOf(ve,ce),1));for(ge=0,ce=0;ge<Z.length;ge++)ve=Z[Z.length-1-ge],re[re.length-1-ge]!==ve&&(Q.hasOwnProperty(ve)?(H.push({command:si.removeImport,args:[ve]}),re.splice(re.lastIndexOf(ve,re.length-ce),1)):ce++,me=re[re.length-ge],H.push({command:si.addImport,args:[ae[ve],me]}),re.splice(re.length-ge,0,ve));for(let he of V){let xe=Q[he.id];xe&&(delete xe.data,o.bx(xe,he)||H.push({command:si.updateImport,args:[he.id,he]}))}})(x.imports,C.imports,T),o.bx(x.transition,C.transition)||T.push({command:si.setTransition,args:[C.transition]}),o.bx(x.light,C.light)||T.push({command:si.setLight,args:[C.light]}),o.bx(x.fog,C.fog)||T.push({command:si.setFog,args:[C.fog]}),o.bx(x.snow,C.snow)||T.push({command:si.setSnow,args:[C.snow]}),o.bx(x.rain,C.rain)||T.push({command:si.setRain,args:[C.rain]}),o.bx(x.projection,C.projection)||T.push({command:si.setProjection,args:[C.projection]}),o.bx(x.lights,C.lights)||T.push({command:si.setLights,args:[C.lights]}),o.bx(x.camera,C.camera)||T.push({command:si.setCamera,args:[C.camera]}),o.bx(x.iconsets,C.iconsets)||(function(z,V,H){let K;for(K in V=V||{},z=z||{})z.hasOwnProperty(K)&&(V.hasOwnProperty(K)||H.push({command:si.removeIconset,args:[K]}));for(K in V){if(!V.hasOwnProperty(K))continue;let Z=V[K];z.hasOwnProperty(K)?o.bx(z[K],Z)||(H.push({command:si.removeIconset,args:[K]}),H.push({command:si.addIconset,args:[K,Z]})):H.push({command:si.addIconset,args:[K,Z]})}})(x.iconsets,C.iconsets,T),!o.bx(x["color-theme"],C["color-theme"]))return[{command:si.setStyle,args:[C]}];let M={},P=[];(function(z,V,H,K){let Z;for(Z in V=V||{},z=z||{})z.hasOwnProperty(Z)&&(V.hasOwnProperty(Z)||eh(Z,H,K));for(Z in V){if(!V.hasOwnProperty(Z))continue;let Q=V[Z];z.hasOwnProperty(Z)?o.bx(z[Z],Q)||(z[Z].type==="geojson"&&Q.type==="geojson"&&Hp(z,V,Z)?H.push({command:si.setGeoJSONSourceData,args:[Z,Q.data]}):th(Z,V,H,K)):df(Z,V,H)}})(x.sources,C.sources,P,M);let F=[];x.layers&&x.layers.forEach(z=>{z.source&&M[z.source]?T.push({command:si.removeLayer,args:[z.id]}):F.push(z)});let O=x.terrain;O&&M[O.source]&&(T.push({command:si.setTerrain,args:[void 0]}),O=void 0),T=T.concat(P),o.bx(O,C.terrain)||T.push({command:si.setTerrain,args:[C.terrain]}),(function(z,V,H){V=V||[];let K=(z=z||[]).map(ih),Z=V.map(ih),Q=z.reduce(rh,{}),ae=V.reduce(rh,{}),re=K.slice(),ge=Object.create(null),ce,ve,me,he,xe,Re,Ie;for(ce=0,ve=0;ce<K.length;ce++)me=K[ce],ae.hasOwnProperty(me)?ve++:(H.push({command:si.removeLayer,args:[me]}),re.splice(re.indexOf(me,ve),1));for(ce=0,ve=0;ce<Z.length;ce++)me=Z[Z.length-1-ce],re[re.length-1-ce]!==me&&(Q.hasOwnProperty(me)?(H.push({command:si.removeLayer,args:[me]}),re.splice(re.lastIndexOf(me,re.length-ve),1)):ve++,Re=re[re.length-ce],H.push({command:si.addLayer,args:[ae[me],Re]}),re.splice(re.length-ce,0,me),ge[me]=!0);for(ce=0;ce<Z.length;ce++)if(me=Z[ce],he=Q[me],xe=ae[me],!ge[me]&&!o.bx(he,xe))if(o.bx(he.source,xe.source)&&o.bx(he["source-layer"],xe["source-layer"])&&o.bx(he.type,xe.type)){for(Ie in nh(he.layout,xe.layout,H,me,null,si.setLayoutProperty),nh(he.paint,xe.paint,H,me,null,si.setPaintProperty),o.bx(he.slot,xe.slot)||H.push({command:si.setSlot,args:[me,xe.slot]}),o.bx(he.filter,xe.filter)||H.push({command:si.setFilter,args:[me,xe.filter]}),o.bx(he.minzoom,xe.minzoom)&&o.bx(he.maxzoom,xe.maxzoom)||H.push({command:si.setLayerZoomRange,args:[me,xe.minzoom,xe.maxzoom]}),he)he.hasOwnProperty(Ie)&&Ie!=="layout"&&Ie!=="paint"&&Ie!=="filter"&&Ie!=="metadata"&&Ie!=="minzoom"&&Ie!=="maxzoom"&&Ie!=="slot"&&(Ie.indexOf("paint.")===0?nh(he[Ie],xe[Ie],H,me,Ie.slice(6),si.setPaintProperty):o.bx(he[Ie],xe[Ie])||H.push({command:si.setLayerProperty,args:[me,Ie,xe[Ie]]}));for(Ie in xe)xe.hasOwnProperty(Ie)&&!he.hasOwnProperty(Ie)&&Ie!=="layout"&&Ie!=="paint"&&Ie!=="filter"&&Ie!=="metadata"&&Ie!=="minzoom"&&Ie!=="maxzoom"&&Ie!=="slot"&&(Ie.indexOf("paint.")===0?nh(he[Ie],xe[Ie],H,me,Ie.slice(6),si.setPaintProperty):o.bx(he[Ie],xe[Ie])||H.push({command:si.setLayerProperty,args:[me,Ie,xe[Ie]]}))}else H.push({command:si.removeLayer,args:[me]}),Re=re[re.lastIndexOf(me)+1],H.push({command:si.addLayer,args:[xe,Re]})})(F,C.layers,T)}catch(M){console.warn("Unable to compute style diff:",M),T=[{command:si.setStyle,args:[C]}]}return T})(this.serialize(),r).filter(x=>!(x.command in dh));if(p.length===0)return!1;let _=p.filter(x=>!(x.command in Fg));if(_.length>0)throw new Error(`Unimplemented: ${_.map(x=>x.command).join(", ")}.`);let y=[];return p.forEach(x=>{y.push(this[x.command](...x.args))}),c&&Promise.all(y).then(c).catch(c),this.stylesheet=r,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(r){if(r.size===0)return this;for(let[c,p]of r.entries()){if(this.getImage(c))return this.fire(new o.y(new Error(`An image with the name "${c.name}" already exists.`)));this.imageManager.addImage(c,this.scope,p),this._changes.updateImage(c,this.scope)}return this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})),this}addImage(r,c){return this.getImage(r)?this.fire(new o.y(new Error(`An image with the name "${r.name}" already exists.`))):(this.imageManager.addImage(r,this.scope,c),this._changes.updateImage(r,this.scope),this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})),this)}updateImage(r,c,p=!1){this.imageManager.updateImage(r,this.scope,c),p&&(this._changes.updateImage(r,this.scope),this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})))}getImage(r){return this.imageManager.getImage(r,this.scope)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r,this.scope),this._changes.updateImage(r,this.scope),this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})),this):this.fire(new o.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(r){return this.modelManager.addModelURLs(r,this.scope),this._updateWorkerModels(),this.fire(new o.z("data",{dataType:"style"})),this}addModel(r,c,p={}){return this._checkLoaded(),this._validate(Xd,`models.${r}`,c,null,p)||(this.modelManager.addModel(r,c,this.scope),this.fire(new o.z("data",{dataType:"style"}))),this}hasModel(r){return this.modelManager.hasModel(r,this.scope)}removeModel(r){return this.hasModel(r)?(this.modelManager.removeModel(r,this.scope,!1,!0),this.fire(new o.z("data",{dataType:"style"})),this):this.fire(new o.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(r,c,p={}){if(this._checkLoaded(),this.getOwnSource(r)!==void 0)throw new Error(`There is already a source with ID "${r}".`);if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(lf,`sources.${r}`,c,null,p))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);let _=Bo(r,c,this.dispatcher,this);_.scope=this.scope,_.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(_.id),source:_.serialize(),sourceId:_.id}));let y=x=>{let C=(x?"symbol:":"other:")+_.id,T=o.B(C,this.scope),M=this._sourceCaches[C]=new Ia(T,_,x);(x?this._symbolSourceCaches:this._otherSourceCaches)[_.id]=M,M.onAdd(this.map)};y(!1),c.type!=="vector"&&c.type!=="geojson"||y(!0),_.onAdd&&_.onAdd(this.map),p.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(r){this._checkLoaded();let c=this.getOwnSource(r);if(!c)throw new Error("There is no source with this ID");for(let _ in this._layers)if(this._layers[_].source===r)return this.fire(new o.y(new Error(`Source "${r}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===r)return this.fire(new o.y(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){let _=Object.entries(this.stylesheet.iconsets).find(([y,x])=>x.type==="source"&&x.source===r);if(_)return this.fire(new o.y(new Error(`Source "${r}" cannot be removed while iconset "${_[0]}" is using it.`)))}let p=this.getOwnSourceCaches(r);for(let _ of p){let y=o.dp(_.id);delete this._sourceCaches[y],this._changes.discardSourceCacheUpdate(_.id),_.fire(new o.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles()}return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],this.mergeSources(),c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(r,c){this._checkLoaded(),this.getOwnSource(r).setData(c),this._changes.setDirty()}getOwnSource(r){let c=this.getOwnSourceCache(r);return c&&c.getSource()}getOwnSources(){let r=[];for(let c in this._otherSourceCaches){let p=this.getOwnSourceCache(c);p&&r.push(p.getSource())}return r}areTilesLoaded(){let r=this._mergedSourceCaches;for(let c in r){let p=r[c]._tiles;for(let _ in p){let y=p[_];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}setLights(r){if(this._checkLoaded(),!r)return delete this.ambientLight,void delete this.directionalLight;let c=this._getTransitionParameters();for(let y of r){if(this._validate(jp,"lights",y))return;switch(y.type){case"ambient":if(this.ambientLight){let x=this.ambientLight;x.set(y),x.updateTransitions(c)}else this.ambientLight=new Or(y,Di||(Di=new o.a9({color:new o.aa(o.a6.properties_light_ambient.color),"color-use-theme":new o.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.aa(o.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){let x=this.directionalLight;x.set(y),x.updateTransitions(c)}else this.directionalLight=new Or(y,_r||(_r=new o.a9({direction:new o.ap(o.a6.properties_light_directional.direction),color:new o.aa(o.a6.properties_light_directional.color),"color-use-theme":new o.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.aa(o.a6.properties_light_directional.intensity),"cast-shadows":new o.aa(o.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new o.aa(o.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new o.aa(o.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}let p=Object.assign(c,{worldview:this.map.getWorldview()}),_=new o.ac(this.z||0,p);this.ambientLight&&this.ambientLight.recalculate(_),this.directionalLight&&this.directionalLight.recalculate(_),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){let r=this.directionalLight,c=this.ambientLight;if(!r||!c)return;let p=O=>.2126*(O[0]<=.03928?O[0]/12.92:Math.pow((O[0]+.055)/1.055,2.4))+.7152*(O[1]<=.03928?O[1]/12.92:Math.pow((O[1]+.055)/1.055,2.4))+.0722*(O[2]<=.03928?O[2]/12.92:Math.pow((O[2]+.055)/1.055,2.4)),_=r.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),y=r.properties.get("intensity"),x=r.properties.get("direction"),C=1-o.d3(x.x,x.y,x.z)[2]/90,T=p(_)*y*C,M=c.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),P=c.properties.get("intensity"),F=p(M)*P;return Number(((T+F)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;let r=[];return this.directionalLight&&r.push(this.directionalLight.get()),this.ambientLight&&r.push(this.ambientLight.get()),r}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(r){if(r==null||r===""&&this.isRootStyle())return this;if(o.dq(r)){let c=o.dr(r),p=this.fragments.find(({id:y})=>y===c);if(!p)return;let _=o.dp(r);return p.style.getFragmentStyle(_)}{let c=this.fragments.find(({id:p})=>p===r);return c?c.style:void 0}}setFeaturesetSelectors(r){if(!r)return;let c={},p=(_,y="")=>`${_}::${y}`;this._featuresetSelectors={};for(let _ in r){let y=this._featuresetSelectors[_]=[];for(let x of r[_].selectors){if(x.featureNamespace){let T=this.getOwnLayer(x.layer);if(!T){o.w(`Layer is undefined for selector: ${x.layer}`);continue}let M=p(T.source,T.sourceLayer);if(M in c&&c[M]!==x.featureNamespace){o.w(`"featureNamespace ${x.featureNamespace} of featureset ${_}'s selector is not associated to the same source, skip this selector`);continue}c[M]=x.featureNamespace}let C;if(x.properties)for(let T in x.properties){let M=o.U(x.properties[T]);M.result==="success"&&(C=C||{},C[T]=M.value)}y.push({layerId:x.layer,namespace:x.featureNamespace,properties:C,uniqueFeatureID:x._uniqueFeatureID})}}}getFeaturesetDescriptors(r){let c=this.getFragmentStyle(r);if(!c||!c.stylesheet.featuresets)return[];let p=[];for(let _ in c.stylesheet.featuresets)p.push({featuresetId:_,importId:c.scope?c.scope:void 0});return p}getFeaturesetLayers(r,c){let p=this.getFragmentStyle(c),_=p.stylesheet.featuresets;if(!_||!_[r])return this.fire(new o.y(new Error(`The featureset '${r}' does not exist in the map's style and cannot be queried.`))),[];let y=[];for(let x of _[r].selectors){let C=p.getOwnLayer(x.layer);C&&y.push(C)}return y}getConfigProperty(r,c){let p=this.getFragmentStyle(r);if(!p)return null;let _=o.B(c,p.scope),y=p.options.get(_),x=y?y.value||y.default:null;return x?x.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(r,c){let p=o.B(r,c);return this._mergedIndoor[p]}setIndoorData(r,c){this.map.indoor.setIndoorData(c)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(r,c,p){let _=this.getFragmentStyle(r);if(!_)return;let y=_.stylesheet.schema;if(!y||!y[c])return;let x=o.U(p);if(x.result!=="success")return void yc(this,x.value);let C=x.value.expression,T=o.B(c,_.scope),M=_.options.get(T);if(!M)return;let P,{minValue:F,maxValue:O,stepValue:z,type:V,values:H}=y[c],K=o.U(y[c].default);K.result==="success"&&(P=K.value.expression),P?(this.options.set(T,Object.assign({},M,{value:C,default:P,minValue:F,maxValue:O,stepValue:z,type:V,values:H})),this.updateConfigDependencies(c)):this.fire(new o.y(new Error(`No schema defined for the config option "${c}" in the "${r}" fragment.`)))}getConfig(r){let c=this.getFragmentStyle(r);if(!c)return null;let p=c.stylesheet.schema;if(!p)return null;let _={};for(let y in p){let x=o.B(y,c.scope),C=c.options.get(x),T=C?C.value||C.default:null;_[y]=T?T.serialize():null}return _}setConfig(r,c){let p=this.getFragmentStyle(r);p&&(p.updateConfig(c,p.stylesheet.schema),this.updateConfigDependencies())}getSchema(r){let c=this.getFragmentStyle(r);return c?c.stylesheet.schema:null}setSchema(r,c){let p=this.getFragmentStyle(r);p&&(p.stylesheet.schema=c,p.updateConfig(p._config,c),this.updateConfigDependencies())}updateConfig(r,c){if(this._config=r,r||c)if(c)for(let p in c){let _,y,x=o.U(c[p].default);if(x.result==="success"&&(_=x.value.expression),r&&r[p]!==void 0){let O=o.U(r[p]);O.result==="success"&&(y=O.value.expression)}let{minValue:C,maxValue:T,stepValue:M,type:P,values:F}=c[p];if(_){let O=o.B(p,this.scope);this.options.set(O,{default:_,value:y,minValue:C,maxValue:T,stepValue:M,type:P,values:F})}else this.fire(new o.y(new Error(`No schema defined for config option "${p}".`)))}else this.fire(new o.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(r,c=()=>!0){for(let p of r){let _=this.getLayer(p);_&&c(_)&&(_.possiblyEvaluateVisibility(),this._updateLayer(_),this._changes.setDirty())}}updateConfigDependencies(r){this._updateLayers(this._configDependentLayers,c=>!r||c.expressionDependencies.configDependencies.has(r)),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(c=>{let p=c._styleColorTheme.colorThemeOverride?c._styleColorTheme.colorThemeOverride:c._styleColorTheme.colorTheme;if(p){let _=c._evaluateColorThemeData(p);(!c._styleColorTheme.lut&&_!==""||c._styleColorTheme.lut&&_!==c._styleColorTheme.lut.data)&&c.setColorTheme(p)}}),this._changes.setDirty()}addLayer(r,c,p={}){this._checkLoaded();let _=r.id;if(this._layers[_])return void this.fire(new o.y(new Error(`Layer with id "${_}" already exists on this map`)));let y;if(r.type==="custom"){if(yc(this,o.ds(r)))return;y=o.dt(r,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof r.source=="object"&&(this.addSource(_,r.source),r=o.dn(r),r=Object.assign(r,{source:_})),this._validate(Wd,`layers.${_}`,r,{arrayIndex:-1},p))return;y=o.dt(r,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(y),y.setEventedParent(this,{layer:{id:_}})}let x=o.B(y.source,y.scope);y.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(x),y.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(x);let C=this._order.length;if(c){let F=this._order.indexOf(c);if(F===-1)return void this.fire(new o.y(new Error(`Layer with id "${c}" does not exist on this map.`)));y.slot===this._layers[c].slot?C=F:o.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(C,0,_),this._layerOrderChanged=!0,this._layers[_]=y;let T=this.getOwnLayerSourceCache(y),M=!!this.directionalLight&&this.directionalLight.shadowsEnabled();T&&y.canCastShadows()&&M&&(T.castsShadows=!0);let P=this._changes.getRemovedLayer(y);if(P&&y.source&&T&&y.type!=="custom"){this._changes.discardLayerRemoval(y);let F=o.B(y.source,y.scope);P.type!==y.type?this._changes.updateSourceCache(F,"clear"):(this._changes.updateSourceCache(F,"reload"),T.pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map),y.scope=this.scope,this.mergeLayers()}moveLayer(r,c){this._checkLoaded();let p=this._checkLayer(r);if(!p||r===c)return;let _=this._order.indexOf(r);this._order.splice(_,1);let y=this._order.length;if(c){let x=this._order.indexOf(c);if(x===-1)return void this.fire(new o.y(new Error(`Layer with id "${c}" does not exist on this map.`)));p.slot===this._layers[c].slot?y=x:o.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(y,0,r),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(r){this._checkLoaded();let c=this._checkLayer(r);if(!c)return;c.setEventedParent(null);let p=this._order.indexOf(r);this._order.splice(p,1),delete this._layers[r],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(c.fqid),this._indoorDependentLayers.delete(c.fqid),this._changes.removeLayer(c);let _=this.getOwnLayerSourceCache(c);if(_&&_.castsShadows){let y=!1;for(let x in this._layers)if(this._layers[x].source===c.source&&this._layers[x].canCastShadows()){y=!0;break}_.castsShadows=y}c.onRemove&&c.onRemove(this.map),this.mergeLayers()}getOwnLayer(r){return this._layers[r]}hasLayer(r){return r in this._mergedLayers}hasLayerType(r){for(let c in this._layers)if(this._layers[c].type===r)return!0;return!1}setLayerZoomRange(r,c,p){this._checkLoaded();let _=this._checkLayer(r);_&&(_.minzoom===c&&_.maxzoom===p||(c!=null&&(_.minzoom=c),p!=null&&(_.maxzoom=p),this._updateLayer(_)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(r,c){this._checkLoaded();let p=this._checkLayer(r);p&&p.slot!==c&&(p.slot=c,this._updateLayer(p))}setFilter(r,c,p={}){this._checkLoaded();let _=this._checkLayer(r);if(_&&!o.bx(_.filter,c))return c==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(Wn,`layers.${_.id}.filter`,c,{layerType:_.type},p)||(_.filter=o.dn(c),this._updateLayer(_)))}getFilter(r){let c=this._checkLayer(r);if(c)return o.dn(c.filter)}setLayoutProperty(r,c,p,_={}){this._checkLoaded();let y=this._checkLayer(r);if(y&&!o.bx(y.getLayoutProperty(c),p)){if(p!=null&&(!_||_.validate!==!1)&&yc(y,Zd.call(ha,{key:`layers.${r}.layout.${c}`,layerType:y.type,objectKey:c,value:p,styleSpec:o.a6,style:{glyphs:!0,sprite:!0}})))return;y.setLayoutProperty(c,p),y.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid),y.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(y.fqid),this._updateLayer(y)}}setLayerProperty(r,c,p,_={}){this._checkLoaded();let y=this._checkLayer(r);y&&(c==="appearances"?(y.setAppearances(p),this._changes.setDirty()):y.isPaintProperty(c)?this.setPaintProperty(r,c,p,_):this.setLayoutProperty(r,c,p,_))}getLayoutProperty(r,c){let p=this._checkLayer(r);if(p)return p.getLayoutProperty(c)}setPaintProperty(r,c,p,_={}){this._checkLoaded();let y=this._checkLayer(r);if(!y||o.bx(y.getPaintProperty(c),p)||p!=null&&(!_||_.validate!==!1)&&yc(y,zo.call(ha,{key:`layers.${r}.paint.${c}`,layerType:y.type,objectKey:c,value:p,styleSpec:o.a6})))return;let x=y.setPaintProperty(c,p);y.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid),y.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(y.fqid),x&&this._updateLayer(y),this._changes.updatePaintProperties(y)}getPaintProperty(r,c){let p=this._checkLayer(r);if(p)return p.getPaintProperty(c)}setFeatureState(r,c){if(this._checkLoaded(),"target"in r){if("featuresetId"in r.target){let{featuresetId:T,importId:M}=r.target,P=this.getFragmentStyle(M),F=P.getFeaturesetLayers(T);for(let{source:O,sourceLayer:z}of F)P.setFeatureState({id:r.id,source:O,sourceLayer:z},c)}else if("layerId"in r.target){let{layerId:T}=r.target,M=this.getLayer(T);this.setFeatureState({id:r.id,source:M.source,sourceLayer:M.sourceLayer},c)}return}let p=r.source,_=r.sourceLayer,y=this._checkSource(p);if(!y)return;let x=y.type;if(x==="geojson"&&_)return void this.fire(new o.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(x==="vector"&&!_)return void this.fire(new o.y(new Error("The sourceLayer parameter must be provided for vector source types.")));r.id===void 0&&this.fire(new o.y(new Error("The feature id parameter must be provided.")));let C=this.getOwnSourceCaches(p);for(let T of C)T.setFeatureState(_,r.id,c)}removeFeatureState(r,c){if(this._checkLoaded(),"target"in r){if("featuresetId"in r.target){let{featuresetId:T,importId:M}=r.target,P=this.getFragmentStyle(M),F=P.getFeaturesetLayers(T);for(let{source:O,sourceLayer:z}of F)P.removeFeatureState({id:r.id,source:O,sourceLayer:z},c)}else if("layerId"in r.target){let{layerId:T}=r.target,M=this.getLayer(T);this.removeFeatureState({id:r.id,source:M.source,sourceLayer:M.sourceLayer},c)}return}let p=r.source,_=this._checkSource(p);if(!_)return;let y=_.type,x=y==="vector"?r.sourceLayer:void 0;if(y==="vector"&&!x)return void this.fire(new o.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&typeof r.id!="string"&&typeof r.id!="number")return void this.fire(new o.y(new Error("A feature id is required to remove its specific state property.")));let C=this.getOwnSourceCaches(p);for(let T of C)T.removeFeatureState(x,r.id,c)}getFeatureState(r){if(this._checkLoaded(),"target"in r){let y;if("featuresetId"in r.target){let{featuresetId:x,importId:C}=r.target,T=this.getFragmentStyle(C),M=T.getFeaturesetLayers(x);for(let{source:P,sourceLayer:F}of M){let O=T.getFeatureState({id:r.id,source:P,sourceLayer:F});if(O&&!y)y=O;else if(!o.bx(y,O))return void this.fire(new o.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in r.target){let{layerId:x}=r.target,C=this.getLayer(x);y=this.getFeatureState({id:r.id,source:C.source,sourceLayer:C.sourceLayer})}return y}let c=r.source,p=r.sourceLayer,_=this._checkSource(c);if(_){if(_.type!=="vector"||p)return r.id===void 0&&this.fire(new o.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(c)[0].getFeatureState(p,r.id);this.fire(new o.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(r){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,r),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();let r=this.getTerrain(),c=r&&this.terrain&&this.terrain.scope===this.scope?r:this.stylesheet.terrain;return o.du({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:c,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},p=>p!==void 0)}_updateFilteredLayers(r){for(let c of Object.values(this._mergedLayers))r(c)&&this._updateLayer(c)}_updateLayer(r){this._changes.updateLayer(r);let c=this.getLayerSourceCache(r),p=o.B(r.source,r.scope),_=this._changes.getUpdatedSourceCaches();r.source&&!_[p]&&c&&c.getSource().type!=="raster"&&(this._changes.updateSourceCache(p,"reload"),c.pause()),r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){let c=C=>this._mergedLayers[C].is3D(!!this.terrain),p=this.order,_={},y=[];for(let C=p.length-1;C>=0;C--){let T=p[C];if(c(T)){_[T]=C;for(let M of r){let P=M[T];if(P)for(let F of P)y.push(F)}}}y.sort((C,T)=>T.intersectionZ-C.intersectionZ);let x=[];for(let C=p.length-1;C>=0;C--){let T=p[C];if(c(T))for(let M=y.length-1;M>=0;M--){let P=y[M].feature;if(P.layer&&_[P.layer.id]<C)break;x.push(P),y.pop()}else for(let M of r){let P=M[T];if(P)for(let F of P)x.push(F.feature)}}return x}queryRasterValue(r,c,p){let _=this.getOwnSource(r);return _?_.type!=="raster-array"?(this.fire(new o.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):_.queryRasterArrayValue(c,p):(this.fire(new o.y(new Error(`Source with id "${r}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(r,c,p){let _;c&&!Array.isArray(c)&&c.filter&&(this._validate(Wn,"queryRenderedFeatures.filter",c.filter,null,c),_=o.b5(c.filter));let y={},x=P=>{if(vf.has(P.type))return;let F=this.getOwnLayerSourceCache(P),O=y[F.id]=y[F.id]||{sourceCache:F,layers:{},has3DLayers:!1};P.is3D(!!this.terrain)&&(O.has3DLayers=!0),O.layers[P.fqid]=O.layers[P.fqid]||{styleLayer:P,targets:[]},O.layers[P.fqid].targets.push({filter:_})};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new o.y(new Error("parameters.layers must be an Array."))),[];for(let P of c.layers){let F=this._layers[P];if(!F)return this.fire(new o.y(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];x(F)}}else for(let P in this._layers)x(this._layers[P]);let C=this._queryRenderedFeatures(r,y,p),T=this._flattenAndSortRenderedFeatures(C),M=[];for(let P of T)o.dv(P.layer.id)===this.scope&&M.push(P);return M}queryRenderedFeatureset(r,c,p){let _;c&&!Array.isArray(c)&&c.filter&&(this._validate(Wn,"queryRenderedFeatures.filter",c.filter,null,c),_=o.b5(c.filter));let y="mock",x=[];if(c&&c.target)x.push(Object.assign({},c,{targetId:y,filter:_}));else{let P=this.getFeaturesetDescriptors();for(let F of P)x.push({targetId:y,filter:_,target:F});for(let{style:F}of this.fragments){let O=F.getFeaturesetDescriptors();for(let z of O)x.push({targetId:y,filter:_,target:z})}}let C=this.queryRenderedTargets(r,x,p),T=[],M=new Set;for(let P of C)for(let F of P.variants[y])Bs(F,P,M)||T.push(new o.dw(P,F));return T}queryRenderedTargets(r,c,p){let _={},y=(C,T,M,P)=>{let F=_[T.id]=_[T.id]||{sourceCache:T,layers:{},has3DLayers:!1};if(F.layers[C.fqid]=F.layers[C.fqid]||{styleLayer:C,targets:[]},C.is3D(!!this.terrain)&&(F.has3DLayers=!0),!P)return M.uniqueFeatureID=!1,void F.layers[C.fqid].targets.push(M);F.layers[C.fqid].targets.push(Object.assign({},M,{namespace:P.namespace,properties:P.properties,uniqueFeatureID:P.uniqueFeatureID}))};for(let C of c)if("featuresetId"in C.target){let{featuresetId:T,importId:M}=C.target,P=this.getFragmentStyle(M);if(!P||!P._featuresetSelectors)continue;let F=P._featuresetSelectors[T];if(!F){this.fire(new o.y(new Error(`The featureset '${T}' does not exist in the map's style and cannot be queried for features.`)));continue}for(let O of F){let z=P.getOwnLayer(O.layerId);z&&!vf.has(z.type)&&y(z,P.getOwnLayerSourceCache(z),C,O)}}else if("layerId"in C.target){let{layerId:T}=C.target,M=this.getLayer(T);if(!M||vf.has(M.type))continue;y(M,this.getLayerSourceCache(M),C)}let x=this._queryRenderedFeatures(r,_,p);return this._flattenAndSortRenderedFeatures(x)}_queryRenderedFeatures(r,c,p){let _=[],y=!!this.map._showQueryGeometry,x=bi.createFromScreenPoints(r,p);for(let C in c){let T=Zs(x,c[C],this._availableImages,p,y);Object.keys(T).length&&_.push(T)}if(this.placement)for(let C in c){if(!c[C].sourceCache._onlySymbols)continue;let T=cf(x.screenGeometry,c[C],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(T).length&&_.push(T)}return _}querySourceFeatures(r,c){let p=c&&c.filter;p&&this._validate(Wn,"querySourceFeatures.filter",p,null,c);let _=[],y=this.getOwnSourceCaches(r);for(let x of y)_=_.concat(Yd(x,c));return _}addSourceType(r,c,p){return Xa.getSourceType(r)?p(new Error(`A source type called "${r}" already exists.`)):(Xa.setSourceType(r,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:c.workerSourceURL},p):p(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(r,c,p={}){this._checkLoaded();let _=this.light.getLight(),y=!1;for(let C in r)if(!o.bx(r[C],_[C])){y=!0;break}if(!y)return;let x=this._getTransitionParameters();this.light.setLight(r,c,p),this.light.updateTransitions(x)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=o.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&o.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(r,c=1){if(this._checkLoaded(),!r)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),c===0&&delete this.terrain,r===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let p=r,_=r.source==null;if(c===1){if(this.disableElevatedTerrain)return;if(typeof p.source=="object"){let C="terrain-dem-src";this.addSource(C,p.source),p=o.dn(p),p=Object.assign(p,{source:C})}let y=Object.assign({},p),x={};if(this.terrain&&_){y.source=this.terrain.get().source;let C=this.terrain?this.getFragmentStyle(this.terrain.scope):null;C&&(x.style=C.serialize())}if(this._validate(mc,"terrain",y,x))return}if(!this.terrain||this.terrain.scope!==this.scope&&!_||this.terrain&&c!==this.terrain.drapeRenderMode){if(!p)return;this._createTerrain(p,c),this.fire(new o.z("data",{dataType:"style"}))}else{let y=this.terrain,x=y.get();for(let C of Object.keys(o.a6.terrain))!p.hasOwnProperty(C)&&o.a6.terrain[C].default&&(p[C]=o.a6.terrain[C].default);for(let C in r)if(!o.bx(r[C],x[C])){y.set(r,this.options),this.stylesheet.terrain=r;let T=this._getTransitionParameters({duration:0});y.updateTransitions(T),this.fire(new o.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){let c=this.fog=new Gt(r,this.map.transform,this.scope,this.options);this.stylesheet.fog=c.get();let p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}_createSnow(r){let c=this.snow=new Yr(r,this.map.transform,this.scope,this.options);this.stylesheet.snow=c.get();let p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}_createRain(r){let c=this.rain=new Fr(r,this.map.transform,this.scope,this.options);this.stylesheet.rain=c.get();let p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let c=this.fog;if(!o.bx(c.get(),r)){c.set(r,this.options),this.stylesheet.fog=c.get();let p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}}else this._createFog(r);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(r){if(this._checkLoaded(),!r)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){let c=this.snow;if(!o.bx(c.get(),r)){c.set(r,this.options),this.stylesheet.snow=c.get();let p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}}else this._createSnow(r);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(r){if(this._checkLoaded(),!r)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){let c=this.rain;if(!o.bx(c.get(),r)){c.set(r,this.options),this.stylesheet.rain=c.get();let p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}}else this._createRain(r);this._markersNeedUpdate=!0}_reloadColorTheme(){let r=()=>{for(let _ in this._layers)this._layers[_].lut=this._styleColorTheme.lut;for(let _ in this._sourceCaches)this._sourceCaches[_].clearTiles()},c=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!c)return this._styleColorTheme.lut=null,void r();let p=this._evaluateColorThemeData(c);this._loadColorTheme(p).then(()=>{this.fire(new o.z("colorthemeset")),r()}).catch(_=>{o.w(`Couldn't set color theme: ${_}`)})}setColorTheme(r){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&o.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=r,this._reloadColorTheme()}setImportColorTheme(r,c){let p=this.getFragmentStyle(r);p&&(p._styleColorTheme.colorThemeOverride=c,p._reloadColorTheme())}_getTransitionParameters(r){return{now:o.o.now(),transition:Object.assign(this.transition,r)}}updateDrapeFirstLayers(){if(!this.terrain)return;let r=[],c=[];for(let p of this._mergedOrder)this.isLayerDraped(this._mergedLayers[p])?r.push(p):c.push(p);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...c)}_createTerrain(r,c){let p=this.terrain=new De(r,c,this.scope,this.options,this.map.getWorldview());c===1&&(this.stylesheet.terrain=r),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();let _=this._getTransitionParameters({duration:0});p.updateTransitions(_)}_force3DLayerUpdate(){for(let r in this._layers){let c=this._layers[r];c.type==="fill-extrusion"&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(let r in this._layers){let c=this._layers[r];c.type==="symbol"&&this._updateLayer(c)}}_validate(r,c,p,_,y={}){if(y&&y.validate===!1)return!1;let x=Object.assign({},this.serialize());return yc(this,r.call(ha,Object.assign({key:c,style:x,value:p,styleSpec:o.a6},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.dx.off("pluginStateChange",this._rtlTextPluginCallback);for(let r in this._mergedLayers)this._mergedLayers[r].setEventedParent(null);for(let r in this._mergedSourceCaches)this._mergedSourceCaches[r].clearTiles(),this._mergedSourceCaches[r].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(r){let c=this.getSourceCaches(r);for(let p of c)p.clearTiles()}clearSources(){for(let r in this._mergedSourceCaches)this._mergedSourceCaches[r].clearTiles()}clearLayers(){for(let r in this._mergedLayers){let c=this._mergedLayers[r];c._clear&&c._clear()}}reloadSource(r){let c=this.getSourceCaches(r);for(let p of c)p.resume(),p.reload()}reloadSources(){for(let r of this.getSources())r.reload&&r.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(r=>{r.modelManager.reloadModels(r.scope)})}updateSources(r){let c;this.directionalLight&&(c=Yp(this.directionalLight));let p=new Set;for(let _ in this._mergedLayers){let y=this._mergedLayers[_];y.hasElevation()&&!p.has(y.source)&&p.add(y.source)}for(let _ in this._mergedSourceCaches){let y=this._mergedSourceCaches[_],x=p.has(y._source.id);y.update(r,void 0,void 0,c,x)}}_generateCollisionBoxes(){for(let r in this._sourceCaches){let c=this._sourceCaches[r];c.resume(),c.reload()}}_updatePlacement(r,c,p,_,y,x,C=!1){let T=!1,M=!1,P={},F={};for(let O of this._mergedOrder){let z=this._mergedLayers[O];if(z.type!=="symbol")continue;let V=o.B(z.source,z.scope),H=P[V];if(!H){let Z=this.getLayerSourceCache(z);if(!Z)continue;let Q=Z.getRenderableIds(!0).map(ae=>Z.getTileByID(ae));F[V]=Q.slice(),H=P[V]=Q.sort((ae,re)=>re.tileID.overscaledZ-ae.tileID.overscaledZ||(ae.tileID.isLessThan(re.tileID)?-1:1))}let K=this.crossTileSymbolIndex.addLayer(z,H,c.center.lng,c.projection);T=T||K}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),C=C||this._layerOrderChanged||_===0,this._layerOrderChanged&&this.fire(new o.z("neworder")),(C||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.o.now(),c.zoom))&&(this.pauseablePlacement=new xs(c,this._mergedOrder,C,p,_,y,this.placement,this.fog&&c.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,P,F,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.o.now()),M=!0),T&&this.pauseablePlacement.placement.setStale()),M||T){this._buildingIndex.onNewFrame(c.zoom);for(let O=0;O<this._mergedOrder.length;O++){let z=this._mergedLayers[this._mergedOrder[O]];if(z.type!=="symbol")continue;let V=this.isLayerClipped(z);this.placement.updateLayerOpacities(z,P[o.B(z.source,z.scope)],O,V?x:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.o.now())}}_releaseSymbolFadeTiles(){for(let r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}addImport(r,c){this._checkLoaded();let p=this.stylesheet.imports=this.stylesheet.imports||[];if(p.findIndex(({id:y})=>y===r.id)!==-1)return void this.fire(new o.y(new Error(`Import with id '${r.id}' already exists in the map's style.`)));if(!c)return p.push(r),this._loadImports([r],!0);let _=p.findIndex(({id:y})=>y===c);return _===-1&&this.fire(new o.y(new Error(`Import with id "${c}" does not exist on this map.`))),this.stylesheet.imports=p.slice(0,_).concat(r).concat(p.slice(_)),this._loadImports([r],!0,c)}updateImport(r,c){this._checkLoaded();let p=this.stylesheet.imports||[],_=this.getImportIndex(r);return _===-1?this:typeof c=="string"?(this.setImportUrl(r,c),this):(c.url&&c.url!==p[_].url&&this.setImportUrl(r,c.url),o.bx(c.config,p[_].config)||this.setImportConfig(r,c.config,c.data.schema),o.bx(c.data,p[_].data)||this.setImportData(r,c.data),this)}moveImport(r,c){this._checkLoaded();let p=this.stylesheet.imports||[],_=this.getImportIndex(r);if(_===-1)return this;let y=this.getImportIndex(c);if(y===-1)return this;let x=p[_],C=this.fragments[_];return p=p.filter(({id:T})=>T!==r),this.fragments=this.fragments.filter(({id:T})=>T!==r),this.stylesheet.imports=p.slice(0,y).concat(x).concat(p.slice(y)),this.fragments=this.fragments.slice(0,y).concat(C).concat(this.fragments.slice(y)),this.mergeLayers(),this}setImportUrl(r,c){this._checkLoaded();let p=this.stylesheet.imports||[],_=this.getImportIndex(r);if(_===-1)return this;p[_].url=c;let y=this.fragments[_];return y.style=this._createFragmentStyle(p[_]),y.style.on("style.import.load",()=>this.mergeAll()),y.style.loadURL(c),this}setImportData(r,c){this._checkLoaded();let p=this.getImportIndex(r),_=this.stylesheet.imports||[];return p===-1?this:c?(this.fragments[p].style.setState(c),this._reloadImports(),this):(delete _[p].data,this.setImportUrl(r,_[p].url))}setImportConfig(r,c,p){this._checkLoaded();let _=this.getImportIndex(r),y=this.stylesheet.imports||[];if(_===-1)return this;c?y[_].config=c:delete y[_].config;let x=this.fragments[_];p&&x.style.stylesheet&&(x.style.stylesheet.schema=p);let C=x.style.stylesheet&&x.style.stylesheet.schema;return x.config=c,x.style.updateConfig(c,C),this.updateConfigDependencies(),this}removeImport(r){this._checkLoaded();let c=this.stylesheet.imports||[],p=this.getImportIndex(r);p!==-1&&(c.splice(p,1),this.fragments[p].style._remove(),this.fragments.splice(p,1),this._reloadImports())}getImportIndex(r){let c=(this.stylesheet.imports||[]).findIndex(p=>p.id===r);return c===-1&&this.fire(new o.y(new Error(`Import '${r}' does not exist in the map's style and cannot be updated.`))),c}getLayer(r){return this._mergedLayers[r]}getSources(){let r=[];for(let c in this._mergedOtherSourceCaches){let p=this._mergedOtherSourceCaches[c];p&&r.push(p.getSource())}return r}getSource(r,c){let p=this.getSourceCache(r,c);return p&&p.getSource()}getLayerSource(r){let c=this.getLayerSourceCache(r);return c&&c.getSource()}getSourceCache(r,c){let p=o.B(r,c);return this._mergedOtherSourceCaches[p]}getLayerSourceCache(r){let c=o.B(r.source,r.scope);return r.type==="symbol"?this._mergedSymbolSourceCaches[c]:this._mergedOtherSourceCaches[c]}getSourceCaches(r){if(r==null)return Object.values(this._mergedSourceCaches);let c=[];return this._mergedOtherSourceCaches[r]&&c.push(this._mergedOtherSourceCaches[r]),this._mergedSymbolSourceCaches[r]&&c.push(this._mergedSymbolSourceCaches[r]),c}updateSourceCaches(){let r=this._changes.getUpdatedSourceCaches();for(let c in r){let p=r[c];p==="reload"?this.reloadSource(c):p==="clear"&&this.clearSource(c)}}updateLayers(r){let c=this._changes.getUpdatedPaintProperties();for(let p of c){let _=this.getLayer(p);_&&_.updateTransitions(r)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(r){this.stylesheet.glyphs=r,this.glyphManager.setURL(r)}getImages(r,c,p){this.imageManager.getImages(c.images,c.scope,p),this._updateTilesForChangedImages();let _=x=>{if(x){let C=c.images.map(T=>o.I.toString(T));x.setDependencies(c.tileID.key,c.type,C)}},y=o.B(c.source,c.scope);_(this._mergedOtherSourceCaches[y]),_(this._mergedSymbolSourceCaches[y]),c.images.some(x=>x.iconsetId)&&this.fire(new o.z("data",{dataType:"style"}))}rasterizeImages(r,c,p){this.imageManager.rasterizeImages(c,p)}getGlyphs(r,c,p){this.glyphManager.getGlyphs(c.stacks,p)}getResource(r,c,p){return o.dy(c,p)}getOwnSourceCache(r){return this._otherSourceCaches[r]}getOwnLayerSourceCache(r){return r.type==="symbol"?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}getOwnSourceCaches(r){let c=[];return this._otherSourceCaches[r]&&c.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&c.push(this._symbolSourceCaches[r]),c}_isSourceCacheLoaded(r){let c=this.getOwnSourceCaches(r);return c.length===0?(this.fire(new o.y(new Error(`There is no source with ID '${r}'`))),!1):c.every(p=>p.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(r,c){if(!this._clipLayerPresent&&r.type!=="fill-extrusion"&&r.type!=="building")return!1;let p=r.type==="fill-extrusion"&&(r.sourceLayer==="building"||r.sourceLayer==="procedural_buildings"),_=r.type==="building";if(r.is3D(!!this.terrain)){if(p||_||c&&c.type==="batched-model"||r.type==="model")return!0}else if(r.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(r=>{r.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Xa.getSourceType=function(f){return zs[f]},Xa.setSourceType=function(f,r){zs[f]=r},Xa.registerForPluginStateChange=o.dz;class Ku extends o.E{constructor(r){super(),this._style=r,this._buildings={},this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},o.aX(["_updateUI"],this)}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null}selectFloor(r){r===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=r,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(r){this._activeFloorsVisible=r,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(r){for(let[c,p]of Object.entries(r.buildings))if(this._buildings[c])for(let _ of p.floorIds)this._buildings[c].floors[_]||(this._buildings[c].floors[_]=p.floors[_]);else this._buildings[c]=p;for(let c of r.activeFloors)this._activeFloors.add(c);this._updateIndoorSelector()}getIndoorTileOptions(r,c){let p=this._style.getIndoorSourceLayers(r,c);return p&&this._indoorState?{sourceLayers:p,indoorState:this._indoorState}:null}_updateUI(r,c,p){let _=(function(y,x,C,T){let M=null,P=Number.MAX_SAFE_INTEGER;if(T<16)return null;for(let[F,O]of Object.entries(y)){let z=O.center;if(z){let V=x.distanceTo(o.aS.convert(z));V<P&&C.contains(z)&&(P=V,M=F)}}return M})(this._buildings,c,p,r);_!==this._closestBuildingId&&(this._closestBuildingId=_,this._updateIndoorSelector())}_updateIndoorSelector(){let r=this._buildings,c=this._closestBuildingId,p=c&&r?r[c]:void 0;if(!p)return void this.fire(new o.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));let _=null;for(let x of p.floorIds)if(this._activeFloors&&this._activeFloors.has(x)){_=x;break}let y=Array.from(p.floorIds).map(x=>({id:x,name:p.floors[x].name,zIndex:p.floors[x].zIndex})).sort((x,C)=>C.zIndex-x.zIndex);this.fire(new o.z("selector-update",{selectedFloorId:_,activeFloorsVisible:this._activeFloorsVisible,floors:y}))}_updateActiveFloors(){let r=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:r,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}var yf=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Qp=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,em=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,Jc="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Ju=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,tm=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,xf=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,ga=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,bf=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,yt=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,nm=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;let Qu=[];Ra(yf,Qu),Ra(em,Qu),Ra(Qp,Qu);let ed={"_prelude_fog.vertex.glsl":tm,"_prelude_terrain.vertex.glsl":Ju,"_prelude_shadow.vertex.glsl":yt,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":xf,"_prelude_shadow.fragment.glsl":nm,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":ga,"_prelude_raster_particle.glsl":bf},Ya={};Un("",Ju),Un(xf,tm),Un(nm,yt),Un(ga,""),Un(bf,"");let td=Un(Qp,em),El=yf;var Qc={background:Un(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Un(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:Un(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}`),buildingBloom:Un(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);}`),buildingDepth:Un(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:Un(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Un("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Un(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Un(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Un("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Un("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Un("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Un(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Un(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Un(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Un(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Un(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Un(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Un(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Un(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Un(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Un(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Un(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Un(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Un(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Un(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Un(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Un(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Un(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Un(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Un("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Un("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Un(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Un(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define APPEARANCE_ICON 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance_icon=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance_icon==APPEARANCE_ICON) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:Un(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Un("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Un(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Jc),skyboxGradient:Un(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Jc),skyboxCapture:Un(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Un(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Un(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Un(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Un(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Un(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Un("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Un("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Un("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Un("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Ra(f,r){let c=f.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let p of c)if(p=p.trim(),p[0]==="#"&&p.includes("if")&&!p.includes("endif")){p=p.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();let _=p.split(" ");for(let y of _)r.includes(y)||r.push(y)}}function Un(f,r){let c=/#include\s+"([^"]+)"/g,p=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,_={},y=[],x=[];if(f=f.replace(c,(T,M)=>(x.push(M),"")),(r=r.replace(c,(T,M)=>(y.push(M),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let C=[...Qu];Ra(f,C),Ra(r,C);for(let T of[...y,...x])ed[T]||console.error(`Undefined include: ${T}`),Ya[T]||(Ya[T]=[],Ra(ed[T],Ya[T])),C=[...C,...Ya[T]];return{fragmentSource:f=f.replace(p,(T,M,P,F,O)=>(_[O]=!0,M==="define"?`
#ifndef HAS_UNIFORM_u_${O}
in ${P} ${F} ${O};
#else
uniform ${P} ${F} u_${O};
#endif
`:M==="initialize"?`
#ifdef HAS_UNIFORM_u_${O}
    ${P} ${F} ${O} = u_${O};
#endif
`:M==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${O}
    in ${P} ${F} ${O};
#endif
`:M==="initialize-attribute"?"":void 0)),vertexSource:r=r.replace(p,(T,M,P,F,O)=>{let z=`MATERIAL_ATTRIBUTE_OFFSET_${O}`,V=F==="float"?"vec2":F,H=`GET_ATTRIBUTE_${V}(a_${O}, materialInfo, ${z})`,K=O.match(/color/)?"color":V;return M==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${O}
in ${P} ${F} a_${O};
#endif
`:_[O]?M==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
    #if !defined(${z})
        in ${P} ${V} a_${O};
    #endif
out ${P} ${F} ${O};
#else
uniform ${P} ${F} u_${O};
#endif
`:M==="initialize"?K==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = a_${O};
#else
    ${P} ${F} ${O} = u_${O};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${O}) 
    #ifdef ${z}
        ${O} = unpack_mix_${K}(${H}, u_${O}_t);
    #else
        ${O} = unpack_mix_${K}(a_${O}, u_${O}_t);
    #endif
#else
    ${P} ${F} ${O} = u_${O};
#endif
`:M==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${O}
    in ${P} ${F} a_${O};
    out ${P} ${F} ${O};
#endif
`:M==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${O}
    ${O} = a_${O};
#endif
`:void 0:M==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
    #if !defined(${z})
        in ${P} ${V} a_${O};
    #endif  
#else
uniform ${P} ${F} u_${O};
#endif
`:M==="define-instanced"?K==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${O}0;
in vec4 a_${O}1;
in vec4 a_${O}2;
in vec4 a_${O}3;
#else
uniform ${P} ${F} u_${O};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${P} ${V} a_${O};
#else
uniform ${P} ${F} u_${O};
#endif
`:M==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${O}
    ${P} ${F} ${O} = a_${O};
#endif
`:K==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    #ifdef ${z}
        ${P} ${F} ${O} = ${H};
    #else
        ${P} ${F} ${O} = a_${O};
    #endif
#else
    ${P} ${F} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    #ifdef ${z}
        ${P} ${F} ${O} = unpack_mix_${K}(${H}, u_${O}_t);
    #else
        ${P} ${F} ${O} = unpack_mix_${K}(a_${O}, u_${O}_t);
    #endif
#else
    ${P} ${F} ${O} = u_${O};
#endif
`}),usedDefines:C,vertexIncludes:y,fragmentIncludes:x}}class nd{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(r,c,p,_,y,x,C,T){this.context=r;let M=this.boundPaintVertexBuffers.length!==_.length;for(let F=0;!M&&F<_.length;F++)this.boundPaintVertexBuffers[F]!==_[F]&&(M=!0);let P=this.boundDynamicVertexBuffers.length!==C.length;for(let F=0;!P&&F<C.length;F++)this.boundDynamicVertexBuffers[F]!==C[F]&&(P=!0);if(!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==p||M||P||this.boundIndexBuffer!==y||this.boundVertexOffset!==x)this.freshBind(c,p,_,y,x,C,T);else{r.bindVertexArrayOES.set(this.vao);for(let F of C)F&&(F.bind(),T&&F.instanceCount&&F.setVertexAttribDivisor(r.gl,c,T));y&&y.dynamicDraw&&y.bind()}}freshBind(r,c,p,_,y,x,C){let T=this.context,M=T.gl;this.vao&&this.destroy(),this.vao=T.gl.createVertexArray(),T.bindVertexArrayOES.set(this.vao),this.boundProgram=r,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=_,this.boundVertexOffset=y,this.boundDynamicVertexBuffers=x,c.enableAttributes(M,r),c.bind(),c.setVertexAttribPointers(M,r,y);for(let P of p)P.enableAttributes(M,r),P.bind(),P.setVertexAttribPointers(M,r,y);for(let P of x)P&&(P.enableAttributes(M,r),P.bind(),P.setVertexAttribPointers(M,r,y),C&&P.instanceCount&&P.setVertexAttribDivisor(M,r,C));_&&_.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Lg(f,r){let c=Math.pow(2,r.canonical.z),p=r.canonical.y;return[new o.ae(0,p/c).toLngLat().lat,new o.ae(0,(p+1)/c).toLngLat().lat]}function Dv(f,r,c,p,_,y,x){let C=f.context,T=C.gl,M=c.hillshadeFBO;if(!M)return;f.prepareDrawTile();let P=f.isTileAffectedByFog(r),F=f.getOrCreateProgram("hillshade",{overrideFog:P});C.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,M.colorAttachment.get());let O=((K,Z,Q,ae)=>{let re=Q.paint.get("hillshade-shadow-color"),ge=Q.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",ce=Q.paint.get("hillshade-highlight-color"),ve=Q.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",me=Q.paint.get("hillshade-accent-color"),he=Q.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",xe=Q.paint.get("hillshade-emissive-strength"),Re=o.an(Q.paint.get("hillshade-illumination-direction"));if(Q.paint.get("hillshade-illumination-anchor")==="viewport")Re-=K.transform.angle;else if(K.style&&K.style.enable3dLights()&&K.style.directionalLight){let qe=K.style.directionalLight.properties.get("direction"),je=o.d3(qe.x,qe.y,qe.z);Re=o.an(je[1])}let Ie=!K.options.moving;return{u_matrix:ae||K.transform.calculateProjMatrix(Z.tileID.toUnwrapped(),Ie),u_image:0,u_latrange:Lg(0,Z.tileID),u_light:[Q.paint.get("hillshade-exaggeration"),Re],u_shadow:re.toPremultipliedRenderColor(ge?null:Q.lut),u_highlight:ce.toPremultipliedRenderColor(ve?null:Q.lut),u_emissive_strength:xe,u_accent:me.toPremultipliedRenderColor(he?null:Q.lut)}})(f,c,p,f.terrain?r.projMatrix:null);f.uploadCommonUniforms(C,F,r.toUnwrapped());let{tileBoundsBuffer:z,tileBoundsIndexBuffer:V,tileBoundsSegments:H}=f.getTileBoundsBuffers(c);F.draw(f,T.TRIANGLES,_,y,x,dn.disabled,O,p.id,z,V,H)}function wf(f,r,c){if(!r.needsDEMTextureUpload)return;let p=f.context,_=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||f.getTileTexture(c.stride);let y=c.getPixels();r.demTexture?r.demTexture.update(y,{premultiply:!1}):r.demTexture=new o.T(p,y,_.R32F,{premultiply:!1}),r.needsDEMTextureUpload=!1}function Iv(f,r,c){let p=f.context,_=p.gl;if(!r.dem)return;let y=r.dem;if(p.activeTexture.set(_.TEXTURE1),wf(f,r,y),!r.demTexture)return;r.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE);let x=y.dim;p.activeTexture.set(_.TEXTURE0);let C=r.hillshadeFBO;if(!C){let O=new o.T(p,{width:x,height:x,data:null},_.RGBA8);O.bind(_.LINEAR,_.CLAMP_TO_EDGE),C=r.hillshadeFBO=p.createFramebuffer(x,x,!0,"renderbuffer"),C.colorAttachment.set(O.texture)}p.bindFramebuffer.set(C.framebuffer),p.viewport.set([0,0,x,x]);let{tileBoundsBuffer:T,tileBoundsIndexBuffer:M,tileBoundsSegments:P}=f.getMercatorTileBoundsBuffers(),F=[];f.linearFloatFilteringSupported()&&F.push("TERRAIN_DEM_FLOAT_FORMAT"),f.getOrCreateProgram("hillshadePrepare",{defines:F}).draw(f,_.TRIANGLES,Vt.disabled,mn.disabled,In.unblended,dn.disabled,((O,z)=>{let V=z.stride,H=o.bB();return o.cd(H,0,o.al,-o.al,0,0,1),o.bq(H,H,[0,-o.al,0]),{u_matrix:H,u_image:1,u_dimension:[V,V],u_zoom:O.overscaledZ}})(r.tileID,y),c.id,T,M,P),r.needsHillshadePrepare=!1}class Pi{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class hh extends Pi{getDefault(){return o.ao.transparent.toNonPremultipliedRenderColor(null)}set(r){let c=this.current;(r.r!==c.r||r.g!==c.g||r.b!==c.b||r.a!==c.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class fo extends Pi{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class Mv extends Pi{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class Av extends Pi{getDefault(){return[!0,!0,!0,!0]}set(r){let c=this.current;(r[0]!==c[0]||r[1]!==c[1]||r[2]!==c[2]||r[3]!==c[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Pv extends Pi{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class Ov extends Pi{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class Ng extends Pi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){let c=this.current;(r.func!==c.func||r.ref!==c.ref||r.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class Rv extends Pi{getDefault(){let r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){let c=this.current;(r[0]!==c[0]||r[1]!==c[1]||r[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class Cf extends Pi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;let c=this.gl;r?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=r,this.dirty=!1}}class kv extends Pi{getDefault(){return[0,1]}set(r){let c=this.current;(r[0]!==c[0]||r[1]!==c[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class fh extends Pi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;let c=this.gl;r?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=r,this.dirty=!1}}class N extends Pi{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class j extends Pi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;let c=this.gl;r?c.enable(c.BLEND):c.disable(c.BLEND),this.current=r,this.dirty=!1}}class oe extends Pi{getDefault(){let r=this.gl;return[r.ONE,r.ZERO,r.ONE,r.ZERO]}set(r){let c=this.current;(r[0]!==c[0]||r[1]!==c[1]||r[2]!==c[2]||r[3]!==c[3]||this.dirty)&&(this.gl.blendFuncSeparate(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Me extends Pi{getDefault(){return o.ao.transparent.toNonPremultipliedRenderColor(null)}set(r){let c=this.current;(r.r!==c.r||r.g!==c.g||r.b!==c.b||r.a!==c.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Ct extends Pi{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(r,r),this.current=r,this.dirty=!1)}}class _n extends Pi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;let c=this.gl;r?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=r,this.dirty=!1}}class Hi extends Pi{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class Tr extends Pi{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}let no=class extends Pi{getDefault(){return null}set(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)}};class eu extends Pi{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class xc extends Pi{getDefault(){let r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){let c=this.current;(r[0]!==c[0]||r[1]!==c[1]||r[2]!==c[2]||r[3]!==c[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class zg extends Pi{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;let c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class Bg extends Pi{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;let c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Fv extends Pi{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;let c=this.gl;c.bindTexture(c.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class jg extends Pi{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;let c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class im extends Pi{getDefault(){return null}set(r){let c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class P1 extends Pi{getDefault(){return null}set(r){this.gl&&(r!==this.current||this.dirty)&&(this.gl.bindVertexArray(r),this.current=r,this.dirty=!1)}}class O1 extends Pi{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;let c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class R1 extends Pi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;let c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class Ef extends Pi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;let c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class Vg extends Pi{constructor(r,c){super(r),this.context=r,this.parent=c}getDefault(){return null}}class OD extends Vg{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class k1 extends Vg{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class RD extends Vg{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,this.attachment(),c.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class Lv extends k1{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}let Nv=(f,r,c)=>({u_matrix:f,u_image0:0,u_skirt_height:r,u_ground_shadow_factor:c}),Ug=(f,r,c,p,_,y,x,C,T,M,P,F,O,z,V,H)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:c,u_zoom_transition:_,u_merc_center:y,u_image0:0,u_frustum_tl:x,u_frustum_tr:C,u_frustum_br:T,u_frustum_bl:M,u_globe_pos:P,u_globe_radius:F,u_viewport:O,u_grid_matrix:H?Float32Array.from(H):new Float32Array(9),u_skirt_height:z,u_far_z_cutoff:V});function Hg(f,r){return f!=null&&r!=null&&!(!f.hasData()||!r.hasData())&&f.demTexture!=null&&r.demTexture!=null&&f.tileID.key!==r.tileID.key}let ph=new class{constructor(){this.operations={}}newMorphing(f,r,c,p,_){if(f in this.operations){let y=this.operations[f];y.to.tileID.key!==c.tileID.key&&(y.queued=c)}else this.operations[f]={startTime:p,phase:0,duration:_,from:r,to:c,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;let r=this.operations[f];return{from:r.from,to:r.to,phase:r.phase}}update(f){for(let r in this.operations){let c=this.operations[r];for(c.phase=(f-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,f)){delete this.operations[r];break}}}_nextOp(f,r){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=r,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},zv={0:null,1:"TERRAIN_VERTEX_MORPHING"};function F1(f,r,c){if(r===0)return 0;let p=r<1&&c===514?.25/r:1;return 6*Math.pow(1.5,22-f)*Math.max(r,1)*p}function rm(f,r){let c=1<<f.z;return!r&&(f.x===0||f.x===c-1)||f.y===0||f.y===c-1}let mh=f=>({u_matrix:f});function $g(f,r,c,p,_){if(_>0){let y=o.o.now(),x=(y-f.timeAdded)/_,C=r?(y-r.timeAdded)/_:-1,T=c.getSource(),M=p.coveringZoomLevel({tileSize:T.tileSize,roundZoom:T.roundZoom}),P=!r||Math.abs(r.tileID.overscaledZ-M)>Math.abs(f.tileID.overscaledZ-M),F=P&&f.refreshedUponExpiration?1:o.aA(P?x:1-C,0,1);return r?{opacity:1,mix:1-F,isFading:x<1}:{opacity:F,mix:0,isFading:x<1}}return{opacity:1,mix:0,isFading:!1}}class Ka extends Ia{constructor(r){let c=Bo("mock-dem",{type:"raster-dem",maxzoom:r.transform.maxZoom},r.style.dispatcher,r.style);super("mock-dem",c,!1),c.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,c){r.state="loaded",c(null)}}class Bv extends Ia{constructor(r){let c=Bo("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},r.style.dispatcher,r.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,c,p){if(r.freezeTileCoverage)return;this.transform=r;let _=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((y,x)=>{if(y[x.key]="",!this._tiles[x.key]){let C=new vl(x,this._source.tileSize*x.overscaleFactor(),r.tileZoom,void 0,void 0,this._source.worldview);C.state="loaded",this._tiles[x.key]=C}return y},{});for(let y in this._tiles)y in _||(this.freeFBO(y),this._tiles[y].unloadVectorData(),delete this._tiles[y])}freeFBO(r){let c=this.proxyCachedFBO[r];if(c!==void 0){let p=Object.values(c);this.renderCachePool.push(...p),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class om extends o.aP{constructor(r,c,p){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=c,this.projMatrix=p}}class sm extends o.bU{constructor(r,c){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},r.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),r.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),r.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[p,_,y]=(function(T){let M=new o.bc,P=new o.b0,F=131;M.reserve(17161),P.reserve(33800);let O=o.al/128,z=o.al+O/2,V=z+O;for(let K=-O;K<V;K+=O)for(let Z=-O;Z<V;Z+=O){let Q=Z<0||Z>z||K<0||K>z?24575:0,ae=o.aA(Math.round(Z),0,o.al),re=o.aA(Math.round(K),0,o.al);M.emplaceBack(ae+Q,re)}let H=(K,Z)=>{let Q=Z*F+K;P.emplaceBack(Q+1,Q,Q+F),P.emplaceBack(Q+F,Q+F+1,Q+1)};for(let K=1;K<129;K++)for(let Z=1;Z<129;Z++)H(Z,K);return[0,129].forEach(K=>{for(let Z=0;Z<130;Z++)H(Z,K),H(K,Z)}),[M,P,32768]})(),x=r.context;this.gridBuffer=x.createVertexBuffer(p,o.be.members),this.gridIndexBuffer=x.createIndexBuffer(_),this.gridSegments=o.bf.simpleSegment(0,0,p.length,_.length),this.gridNoSkirtSegments=o.bf.simpleSegment(0,0,p.length,y),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Bv(c.map),this.orthoMatrix=o.bB(),o.cd(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.al,0,o.al,0,1);let C=x.gl;this._overlapStencilMode=new mn({func:C.GEQUAL,mask:255},0,255,C.KEEP,C.KEEP,C.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Ka(c.map),this._pendingGroundEffectLayers=[]}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),this._style=r,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(r,c,p){if(r&&r.terrain){this._style!==r&&(this.style=r,this._evaluationZoom=void 0);let _=r.terrain.properties,y=r.terrain.drapeRenderMode===0,x=r.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=o.o.now();let C=r.terrain&&r.terrain.scope,T=_.get("source"),M=y?this._mockSourceCache:r.getSourceCache(T,C);if(!M)return void o.w(`Couldn't find terrain source "${T}".`);if(this.sourceCache=M,this._attenuationRange=r.terrain.getAttenuationRange(),this._exaggeration=x?this.calculateExaggeration(c):_.get("exaggeration"),!c.projection.requiresDraping&&x&&this._exaggeration===0)return void this._disable();this.enabled=!0;let P=()=>{this.sourceCache.used&&o.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let F=this.getScaledDemTileSize();this.sourceCache.update(c,F,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,P(),this._initializing=!0),P(),c.updateElevation(!0,p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0,this._previousZoom=c.zoom}else this._disable()}calculateExaggeration(r){if(this._attenuationRange&&r.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(r.zoom);let c=this._previousCameraAltitude,p=r.getFreeCameraOptions().position.z/r.pixelsPerMeter*r.worldSize;this._previousCameraAltitude=p;let _=c!=null?p-c:Number.MAX_VALUE;if(Math.abs(_)<2)return this._exaggeration;let y=r.zoom,x=this._style.terrain;if(!this._previousUpdateTimestamp)return x.getExaggeration(y);let C=y-this._previousZoom,T=this._previousUpdateTimestamp,M=y;this._evaluationZoom!=null&&(M=this._evaluationZoom,Math.abs(y-M)>.5&&(C=.5*(y-M+C)),C*_<0&&(M+=C)),this._evaluationZoom=M;let P=x.getExaggeration(M),F=P===x.getExaggeration(Math.max(0,M-.1));if(F&&Math.abs(P-this._exaggeration)<.01)return P;let O=Math.min(.1,.00375*(this._updateTimestamp-T));return(F||P<.1||Math.abs(C)<1e-4)&&(O=Math.min(.2,4*O)),o.ak(this._exaggeration,P,O)}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(r){r.dataType==="source"&&r.coord?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):r.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let r in this._style._mergedSourceCaches)this._style._mergedSourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let c=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=p._centerAltitude===0&&this.getAtPointOrZero(o.ae.fromLngLat(p.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let _=this.proxyCoords=c.getIds().map(T=>{let M=c.getTileByID(T).tileID;return M.projMatrix=p.calculateProjMatrix(M.toUnwrapped()),M});(function(T,M){let P=M.transform.pointCoordinate(M.transform.getCameraPoint()),F=new o.P(P.x,P.y);T.sort((O,z)=>{if(z.overscaledZ-O.overscaledZ)return z.overscaledZ-O.overscaledZ;let V=new o.P(O.canonical.x+(1<<O.canonical.z)*O.wrap,O.canonical.y),H=new o.P(z.canonical.x+(1<<z.canonical.z)*z.wrap,z.canonical.y),K=F.mult(1<<O.canonical.z);return K.x-=.5,K.y-=.5,K.distSqr(V)-K.distSqr(H)})})(_,this.painter);let y=this.proxyToSource||{};this.proxyToSource={},_.forEach(T=>{this.proxyToSource[T.key]={}}),this.terrainTileForTile={};let x=this._style._mergedSourceCaches;for(let T in x){let M=x[T];if(!M.used||(M!==this.sourceCache&&this.resetTileLookupCache(M.id),this._setupProxiedCoordsForOrtho(M,r[T],y),M.usedForTerrain))continue;let P=r[T];M.getSource().reparseOverscaled&&this._assignTerrainTiles(P)}this.proxiedCoords[c.id]=_.map(T=>new om(T,T.key,this.orthoMatrix)),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(y),this.renderingToTexture=!1;let C={};this._visibleDemTiles=[];for(let T of this.proxyCoords){let M=this.terrainTileForTile[T.key];if(!M)continue;let P=M.tileID.key;P in C||(this._visibleDemTiles.push(M),C[P]=P)}}_assignTerrainTiles(r){this._initializing||r.forEach(c=>{if(this.terrainTileForTile[c.key])return;let p=this._findTileCoveringTileID(c,this.sourceCache);p&&(this.terrainTileForTile[c.key]=p)})}_prepareDEMTextures(){let r=this.painter.context,c=r.gl;for(let p in this.terrainTileForTile){let _=this.terrainTileForTile[p],y=_.dem;!y||_.demTexture&&!_.needsDEMTextureUpload||(r.activeTexture.set(c.TEXTURE1),wf(this.painter,_,y))}}_prepareDemTileUniforms(r,c,p,_){if(!c||c.demTexture==null)return!1;let y=r.tileID.canonical,x=Math.pow(2,c.tileID.canonical.z-y.z),C=_||"";return p[`u_dem_tl${C}`]=[y.x*x%1,y.y*x%1],p[`u_dem_scale${C}`]=x,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let r=0,c=this._visibleDemTiles.reduce((p,_)=>{if(!_.dem)return p;let y=_.dem.tree.minimums[0];return y>0&&r++,p+y},0);return r?c/r:0}_updateEmptyDEMTexture(){let r=this.painter.context,c=r.gl;r.activeTexture.set(c.TEXTURE2);let p=this._getLoadedAreaMinimum(),_=new o.dK({width:1,height:1},new Float32Array([p]));this._emptyDEMTextureDirty=!1;let y=this._emptyDEMTexture;return y?y.update(_,{premultiply:!1}):y=this._emptyDEMTexture=new o.T(r,_,c.R32F,{premultiply:!1}),y}setupElevationDraw(r,c,p){let _=this.painter.context,y=_.gl,x={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};x.u_exaggeration=this.exaggeration();let C=null,T=null,M=1;if(p&&p.morphing&&this._useVertexMorphing){let z=p.morphing.srcDemTile,V=p.morphing.dstDemTile;M=p.morphing.phase,z&&V&&(this._prepareDemTileUniforms(r,z,x,"_prev")&&(T=z),this._prepareDemTileUniforms(r,V,x)&&(C=V))}let P=z=>z&&z.demTexture&&this.painter.linearFloatFilteringSupported()?y.LINEAR:y.NEAREST,F=null;var O;if(this.enabled?T&&C?(F=C.demTexture,_.activeTexture.set(y.TEXTURE4),T.demTexture.bind(P(T),y.CLAMP_TO_EDGE),x.u_dem_lerp=M):(C=this.terrainTileForTile[r.tileID.key],F=this._prepareDemTileUniforms(r,C,x)?C.demTexture:this.emptyDEMTexture):F=this.emptyDEMTexture,_.activeTexture.set(y.TEXTURE2),F&&(x.u_dem_size=(O=F).size[0]===1?1:O.size[0]-2,F.bind(P(C),y.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(p&&p.useDepthForOcclusion,c,x),p&&p.useMeterToDem&&C){let z=(1<<C.tileID.canonical.z)*o.ce(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;x.u_meter_to_dem=z}if(p&&p.labelPlaneMatrixInv&&(x.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),c.setTerrainUniformValues(_,x),this.painter.transform.projection.name==="globe"){let z=this.globeUniformValues(this.painter.transform,r.tileID.canonical,p&&p.useDenormalizedUpVectorScale);c.setGlobeUniformValues(_,z)}}globeUniformValues(r,c,p){let _=r.projection;return{u_tile_tl_up:_.upVector(c,0,0),u_tile_tr_up:_.upVector(c,o.al,0),u_tile_br_up:_.upVector(c,o.al,o.al),u_tile_bl_up:_.upVector(c,0,o.al),u_tile_up_scale:p?o.dL(1):_.upVectorScale(c,r.center.lat,r.worldSize).metersToTile}}renderToBackBuffer(r){let c=this.painter,p=this.painter.context;r.length!==0&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,c.width,c.height]),c.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,(function(_,y,x,C,T){if(_.transform.projection.name==="globe")(function(M,P,F,O,z){let V=M.context,H=V.gl,K,Z,Q=M.transform,ae=o.dD(M,V,Q),re=(qe,je)=>{if(Z===je)return;let Ke=[zv[je],"PROJECTION_GLOBE_VIEW"];ae&&Ke.push("CUSTOM_ANTIALIASING");let _t=M.isTileAffectedByFog(qe);K=M.getOrCreateProgram("globeRaster",{defines:Ke,overrideFog:_t}),Z=je},ge=M.colorModeForRenderPass(),ce=new Vt(H.LEQUAL,Vt.ReadWrite,M.depthRangeFor3D);ph.update(z);let ve=o.dE(Q),me=[o.aF(Q.center.lng),o.aJ(Q.center.lat)],he=M.globeSharedBuffers,xe=[Q.width*o.o.devicePixelRatio,Q.height*o.o.devicePixelRatio],Re=Float32Array.from(Q.globeMatrix),Ie={useDenormalizedUpVectorScale:!0};{let qe=M.transform,je=F1(qe.zoom,P.exaggeration(),P.sourceCache._source.tileSize);Z=-1;let Ke=H.TRIANGLES;for(let _t of O){let Le=F.getTile(_t),Te=mn.disabled,Je=P.prevTerrainTileForTile[_t.key],Ue=P.terrainTileForTile[_t.key];Hg(Je,Ue)&&ph.newMorphing(_t.key,Je,Ue,z,250),V.activeTexture.set(H.TEXTURE0),Le.texture&&Le.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE);let at=ph.getMorphValuesForProxy(_t.key),bt=at?1:0;at&&Object.assign(Ie,{morphing:{srcDemTile:at.from,dstDemTile:at.to,phase:o.dC(at.phase)}});let jt=o.dF(_t.canonical),mt=o.dG(jt.getCenter().lat),xt=o.dH(_t.canonical,jt,mt,qe.worldSize/qe._pixelsPerMercatorPixel),$t=o.bj(o.dI(_t.canonical)),Ft=Ug(qe.expandedFarZProjMatrix,Re,ve,$t,o.aj(qe.zoom),me,qe.frustumCorners.TL,qe.frustumCorners.TR,qe.frustumCorners.BR,qe.frustumCorners.BL,qe.globeCenterInViewSpace,qe.globeRadius,xe,je,qe._farZ,xt);if(re(_t,bt),K&&(P.setupElevationDraw(Le,K,Ie),M.uploadCommonUniforms(V,K,_t.toUnwrapped()),he)){let[At,Lt,sn]=he.getGridBuffers(mt,je!==0);K.draw(M,Ke,ce,Te,ge,dn.backCCW,Ft,"globe_raster",At,Lt,sn)}}}if(he&&(M.renderDefaultNorthPole||M.renderDefaultSouthPole)){let qe=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ae&&qe.push("CUSTOM_ANTIALIASING"),K=M.getOrCreateProgram("globeRaster",{defines:qe});for(let je of O){let{x:Ke,y:_t,z:Le}=je.canonical,Te=_t===0,Je=_t===(1<<Le)-1,[Ue,at,bt,jt]=he.getPoleBuffers(Le,!1);if(jt&&(Te||Je)){let mt=F.getTile(je);V.activeTexture.set(H.TEXTURE0),mt.texture&&mt.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE);let xt=o.dJ(Le,Ke,Q),$t=o.bj(o.dI(je.canonical)),Ft=(At,Lt)=>At.draw(M,H.TRIANGLES,ce,mn.disabled,ge,dn.disabled,Ug(Q.expandedFarZProjMatrix,xt,xt,$t,0,me,Q.frustumCorners.TL,Q.frustumCorners.TR,Q.frustumCorners.BR,Q.frustumCorners.BL,Q.globeCenterInViewSpace,Q.globeRadius,xe,0,Q._farZ),"globe_pole_raster",Lt,bt,jt);P.setupElevationDraw(mt,K,Ie),M.uploadCommonUniforms(V,K,je.toUnwrapped()),Te&&M.renderDefaultNorthPole&&Ft(K,Ue),Je&&M.renderDefaultSouthPole&&(xt=o.cR(o.bB(),xt,[1,-1,1]),Ft(K,at))}}}})(_,y,x,C,T);else{let M=_.context,P=M.gl,F,O,z=_.shadowRenderer,V=ql(_,_.longestCutoffRange),H=ge=>{if(O===ge)return;let ce=[];ce.push(zv[ge]),V.shouldRenderCutoff&&ce.push("RENDER_CUTOFF"),z&&(ce.push("RENDER_SHADOWS","DEPTH_TEXTURE"),z.useNormalOffset&&ce.push("NORMAL_OFFSET")),F=_.getOrCreateProgram("terrainRaster",{defines:ce}),O=ge},K=_.colorModeForRenderPass(),Z=new Vt(P.LEQUAL,Vt.ReadWrite,_.depthRangeFor3D);ph.update(T);let Q=_.transform,ae=F1(Q.zoom,y.exaggeration(),y.sourceCache._source.tileSize),re=[0,0,0];if(z){let ge=_.style.directionalLight,ce=_.style.ambientLight;ge&&ce&&(re=Oa(_.style,ge,ce))}{O=-1;let ge=P.TRIANGLES,[ce,ve]=[y.gridIndexBuffer,y.gridSegments];for(let me of C){let he=x.getTile(me),xe=mn.disabled,Re=y.prevTerrainTileForTile[me.key],Ie=y.terrainTileForTile[me.key];Hg(Re,Ie)&&ph.newMorphing(me.key,Re,Ie,T,250),M.activeTexture.set(P.TEXTURE0),he.texture&&he.texture.bind(P.LINEAR,P.CLAMP_TO_EDGE);let qe=ph.getMorphValuesForProxy(me.key),je=qe?1:0,Ke;qe&&(Ke={morphing:{srcDemTile:qe.from,dstDemTile:qe.to,phase:o.dC(qe.phase)}});let _t=Nv(me.projMatrix,rm(me.canonical,Q.renderWorldCopies)?ae/10:ae,re);if(H(je),!F)continue;y.setupElevationDraw(he,F,Ke);let Le=me.toUnwrapped();z&&z.setupShadows(Le,F),_.uploadCommonUniforms(M,F,Le,null,V),F.draw(_,ge,Z,xe,K,dn.backCCW,_t,"terrain_raster",y.gridBuffer,ce,ve)}}}})(c,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,c.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(this._drapedRenderBatches.length===0)return r+1;this.renderingToTexture=!0;let c=this.painter,p=this.painter.context,_=this.proxySourceCache,y=this.proxiedCoords[_.id],x=this._drapedRenderBatches.shift(),C=c.style.order,T=[],M=0;for(let P of y){let F=_.getTileByID(P.proxyTileKey),O=_.proxyCachedFBO[P.key]?_.proxyCachedFBO[P.key][r]:void 0,z=O!==void 0?_.renderCache[O]:this.pool[M++],V=O!==void 0;if(F.texture=z.tex,V&&!z.dirty){T.push(F.tileID);continue}let H;p.bindFramebuffer.set(z.fb.framebuffer),this.renderedToTile=!1,z.dirty&&(p.clear({color:o.ao.transparent,stencil:0}),z.dirty=!1);for(let K=x.start;K<=x.end;++K){let Z=c.style._mergedLayers[C[K]];if(Z.isHidden(c.transform.zoom))continue;let Q=c.style.getLayerSourceCache(Z),ae=Q?this.proxyToSource[P.key][Q.id]:[P];if(!ae)continue;let re=ae;p.viewport.set([0,0,z.fb.width,z.fb.height]),H!==(Q?Q.id:null)&&(this._setupStencil(z,ae,Z,Q),H=Q?Q.id:null),c.renderLayer(c,Q,Z,re)}if(this._drapedRenderBatches.length===0)for(let K of this._pendingGroundEffectLayers){let Z=c.style._mergedLayers[C[K]];if(Z.isHidden(c.transform.zoom))continue;let Q=c.style.getLayerSourceCache(Z),ae=Q?this.proxyToSource[P.key][Q.id]:[P];if(!ae)continue;let re=ae;p.viewport.set([0,0,z.fb.width,z.fb.height]),H!==(Q?Q.id:null)&&(this._setupStencil(z,ae,Z,Q),H=Q?Q.id:null),c.renderLayer(c,Q,Z,re)}this.renderedToTile?(z.dirty=!0,T.push(F.tileID)):V||--M,M===5&&(M=0,this.renderToBackBuffer(T))}return this.renderToBackBuffer(T),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,c.width,c.height]),x.end+1}postRender(){}isLayerOrderingCorrect(r){let c=r.order.length,p=-1,_=c;for(let y=0;y<c;++y)this._style.isLayerDraped(r._mergedLayers[r.order[y]])?p=Math.max(p,y):_=Math.min(_,y);return _>p}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{r=Math.min(r,c.dem.tree.minimums[0])}),r===0?r:(r-30)*this._exaggeration}raycast(r,c,p){if(!this._visibleDemTiles)return null;let _=this._visibleDemTiles.filter(y=>y.dem).map(y=>{let x=y.tileID,C=1<<x.overscaledZ,{x:T,y:M}=x.canonical,P=T/C,F=(T+1)/C,O=M/C,z=(M+1)/C;return{minx:P,miny:O,maxx:F,maxy:z,t:y.dem.tree.raycastRoot(P,O,F,z,r,c,p),tile:y}});_.sort((y,x)=>(y.t!==null?y.t:Number.MAX_VALUE)-(x.t!==null?x.t:Number.MAX_VALUE));for(let y of _){if(y.t==null)return null;let x=y.tile.dem.tree.raycast(y.minx,y.miny,y.maxx,y.maxy,r,c,p);if(x!=null)return x}return null}_createFBO(){let r=this.painter.context,c=r.gl,p=this.drapeBufferSize;r.activeTexture.set(c.TEXTURE0);let _=new o.T(r,{width:p[0],height:p[1],data:null},c.RGBA8);_.bind(c.LINEAR,c.CLAMP_TO_EDGE);let y=r.createFramebuffer(p[0],p[1],!0,null);return y.colorAttachment.set(_.texture),y.depthAttachment=new Lv(r,y.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,y.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):y.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&c.texParameterf(c.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:y,tex:_,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(let r in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{let c=this._style._mergedLayers[r],p=c.isHidden(this.painter.transform.zoom);return c.type==="hillshade"||c.type==="custom"?!p&&c.shouldRedrape():!p&&c.hasTransition()})}_clearLineLayersFromRenderCache(){let r=!1;for(let p of this._style.getSources())if(p instanceof Xo){r=!0;break}if(!r)return;let c={};for(let p=0;p<this._style.order.length;++p){let _=this._style._mergedLayers[this._style.order[p]],y=this._style.getLayerSourceCache(_);if(y&&!c[y.id]&&!_.isHidden(this.painter.transform.zoom)&&_.type==="line"&&_.widthExpression()instanceof o.ad){c[y.id]=!0;for(let x of this.proxyCoords){let C=this.proxyToSource[x.key][y.id];if(C)for(let T of C)this._clearRenderCacheForTile(y.id,T)}}}}_clearRasterLayersFromRenderCache(){let r=!1;for(let p in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[p]._source instanceof fa){r=!0;break}if(!r)return;let c={};for(let p=0;p<this._style.order.length;++p){let _=this._style._mergedLayers[this._style.order[p]],y=this._style.getLayerSourceCache(_);if(!y||c[y.id]||_.isHidden(this.painter.transform.zoom)||_.type!=="raster")continue;let x=_.paint.get("raster-fade-duration");for(let C of this.proxyCoords){let T=this.proxyToSource[C.key][y.id];if(T)for(let M of T){let P=$g(y.getTile(M),y.findLoadedParent(M,0),y,this.painter.transform,x);(P.opacity!==1||P.mix!==0)&&this._clearRenderCacheForTile(y.id,M)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();let r=this._style.order,c=r.length;if(c===0)return;let p=[];this._pendingGroundEffectLayers=[];let _,y=0,x=this._style._mergedLayers[r[y]];for(;!this._style.isLayerDraped(x)&&x.isHidden(this.painter.transform.zoom)&&++y<c;)x=this._style._mergedLayers[r[y]];for(;y<c;++y){let C=this._style._mergedLayers[r[y]];C.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(C)?_===void 0&&(_=y):(C.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(y),_!==void 0&&(p.push({start:_,end:y-1}),_=void 0)))}if(_!==void 0&&p.push({start:_,end:y-1}),p.length!==0){let C=p[p.length-1];this._pendingGroundEffectLayers.every(T=>T>C.end)||o.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=p}_setupRenderCache(r){let c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){let x=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let C=0;C<x.length;++C){let T=Object.values(x[C]);c.renderCachePool.push(...T)}}return}this._clearRasterLayersFromRenderCache();let p=this.proxyCoords,_=this._tilesDirty;for(let x=p.length-1;x>=0;x--){let C=p[x];if(c.getTileByID(C.key),c.proxyCachedFBO[C.key]!==void 0){let T=r[C.key],M=this.proxyToSource[C.key],P=0;for(let F in M){let O=M[F],z=T[F];if(!z||z.length!==O.length||O.some((V,H)=>V!==z[H]||_[F]&&_[F].hasOwnProperty(V.key))){P=-1;break}++P}for(let F in c.proxyCachedFBO[C.key])c.renderCache[c.proxyCachedFBO[C.key][F]].dirty=P<0||P!==Object.values(T).length}}let y=[...this._drapedRenderBatches];y.sort((x,C)=>C.end-C.start-(x.end-x.start));for(let x of y)for(let C of p){if(c.proxyCachedFBO[C.key])continue;let T=c.renderCachePool.pop();T===void 0&&c.renderCache.length<50&&(T=c.renderCache.length,c.renderCache.push(this._createFBO())),T!==void 0&&(c.proxyCachedFBO[C.key]={},c.proxyCachedFBO[C.key][x.start]=T,c.renderCache[T].dirty=!0)}this._tilesDirty={}}_setupStencil(r,c,p,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let y=this.painter.context,x=y.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let C;if(p.isTileClipped())C=c.length,this._overlapStencilMode.test={func:x.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);C=1,this._overlapStencilMode.test={func:x.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+C>255&&(y.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=C,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):mn.disabled}_renderTileClippingMasks(r,c){let p=this.painter,_=this.painter.context,y=_.gl;p._tileClippingMaskIDs={},_.setColorMode(In.disabled),_.setDepthMode(Vt.disabled);let x=p.getOrCreateProgram("clippingMask");for(let C of r){let T=p._tileClippingMaskIDs[C.key]=--c;x.draw(p,y.TRIANGLES,Vt.disabled,new mn({func:y.ALWAYS,mask:0},T,255,y.KEEP,y.KEEP,y.REPLACE),In.disabled,dn.disabled,mh(C.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(r){let c=this.painter.transform;if(r.x<0||r.x>c.width||r.y<0||r.y>c.height)return null;let p=[r.x,r.y,1,1];o.aC(p,p,c.pixelMatrixInverse),o.cJ(p,p,1/p[3]),p[0]/=c.worldSize,p[1]/=c.worldSize;let _=c._camera.position,y=o.ce(1,c.center.lat),x=[_[0],_[1],_[2]/y,0],C=o.d9([],p.slice(0,3),x);o.aw(C,C);let T=this.raycast(x,C,this._exaggeration);return T!==null&&T?(o.bG(x,x,C,T),x[3]=x[2],x[2]*=y,x):null}_setupProxiedCoordsForOrtho(r,c,p){if(r.getSource()instanceof o.aT)return this._setupProxiedCoordsForImageSource(r,c,p);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};let _=this.proxiedCoords[r.id]=[],y=this.proxyCoords;for(let T=0;T<y.length;T++){let M=y[T],P=this._findTileCoveringTileID(M,r);if(P){let F=this._createProxiedId(M,P,p[M.key]&&p[M.key][r.id]);_.push(F),this.proxyToSource[M.key][r.id]=[F]}}let x=!1,C=new Set;for(let T=0;T<c.length;T++){let M=r.getTile(c[T]);if(!M||!M.hasData())continue;let P=this._findTileCoveringTileID(M.tileID,this.proxySourceCache);if(P&&P.tileID.canonical.z!==M.tileID.canonical.z){let F=this.proxyToSource[P.tileID.key][r.id],O=this._createProxiedId(P.tileID,M,p[P.tileID.key]&&p[P.tileID.key][r.id]);F?F.splice(F.length-1,0,O):this.proxyToSource[P.tileID.key][r.id]=[O];let z=this.proxyToSource[P.tileID.key][r.id];C.has(z)||C.add(z),_.push(O),x=!0}}if(this._sourceTilesOverlap[r.id]=x,x&&this._debugParams.sortTilesHiZFirst)for(let T of C)T.sort((M,P)=>P.overscaledZ-M.overscaledZ)}_setupProxiedCoordsForImageSource(r,c,p){if(!r.getSource().loaded())return;let _=this.proxiedCoords[r.id]=[],y=this.proxyCoords,x=r.getSource(),C=x.tileID;if(!C)return;let T=new o.P(C.x,C.y)._div(1<<C.z),M=x.coordinates.map(o.ae.fromLngLat).reduce((F,O)=>(F.min.x=Math.min(F.min.x,O.x-T.x),F.min.y=Math.min(F.min.y,O.y-T.y),F.max.x=Math.max(F.max.x,O.x-T.x),F.max.y=Math.max(F.max.y,O.y-T.y),F),{min:new o.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),P=(F,O)=>{let z=F.wrap+F.canonical.x/(1<<F.canonical.z),V=F.canonical.y/(1<<F.canonical.z),H=o.al/(1<<F.canonical.z),K=O.wrap+O.canonical.x/(1<<O.canonical.z),Z=O.canonical.y/(1<<O.canonical.z);return z+H<K+M.min.x||z>K+M.max.x||V+H<Z+M.min.y||V>Z+M.max.y};for(let F=0;F<y.length;F++){let O=y[F];for(let z=0;z<c.length;z++){let V=r.getTile(c[z]);if(!V||!V.hasData()||P(O,V.tileID))continue;let H=this._createProxiedId(O,V,p[O.key]&&p[O.key][r.id]),K=this.proxyToSource[O.key][r.id];K?K.push(H):this.proxyToSource[O.key][r.id]=[H],_.push(H)}}}_createProxiedId(r,c,p){let _=this.orthoMatrix;if(p){let y=p.find(x=>x.key===c.tileID.key);if(y)return y}if(c.tileID.key!==r.key){let y=r.canonical.z-c.tileID.canonical.z,x,C,T;_=o.bB();let M=c.tileID.wrap-r.wrap<<r.overscaledZ;y>0?(x=o.al>>y,C=x*((c.tileID.canonical.x<<y)-r.canonical.x+M),T=x*((c.tileID.canonical.y<<y)-r.canonical.y)):(x=o.al<<-y,C=o.al*(c.tileID.canonical.x-(r.canonical.x+M<<-y)),T=o.al*(c.tileID.canonical.y-(r.canonical.y<<-y))),o.cd(_,0,x,0,x,0,1),o.bq(_,_,[C,T,0])}return new om(c.tileID,r.key,_)}_findTileCoveringTileID(r,c){let p=c.getTile(r);if(p&&p.hasData())return p;let _=this._findCoveringTileCache[c.id],y=_[r.key];if(p=y?c.getTileByID(y):null,p&&p.hasData()||y===null)return p;let x=p?p.tileID:r,C=x.overscaledZ,T=c.getSource().minzoom,M=[];if(!y){let F=c.getSource().maxzoom;if(r.canonical.z>=F){let O=r.canonical.z-F;c.getSource().reparseOverscaled?(C=Math.max(r.canonical.z+2,c.transform.tileZoom),x=new o.aP(C,r.wrap,F,r.canonical.x>>O,r.canonical.y>>O)):O!==0&&(C=F,x=new o.aP(C,r.wrap,F,r.canonical.x>>O,r.canonical.y>>O))}x.key!==r.key&&(M.push(x.key),p=c.getTile(x))}let P=F=>{M.forEach(O=>{_[O]=F}),M.length=0};for(C-=1;C>=T&&(!p||!p.hasData());C--){p&&P(p.tileID.key);let F=x.calculateScaledKey(C);if(p=c.getTileByID(F),p&&p.hasData())break;let O=_[F];if(O===null)break;O===void 0?M.push(F):p=c.getTileByID(O)}return P(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,c){let p=this._tilesDirty[r];p||(p=this._tilesDirty[r]={}),p[c.key]=!0}}function jv(f,r,c){let p=(function(C,T,M){let P=o.bI(T,C),F=o.bI(M,[.2126,.7152,.0722]),O=(V,H,K)=>(1-K)*V+K*H,z=O(1-.3*Math.min(F,1),1,Math.min(P+1,1));return O(.92,1,Math.asin(o.aA(T[2],-1,1))/Math.PI+.5)*z})(f,[0,0,1],r),_=[0,0,0];o.c4(_,c.slice(0,3),p);let y=[0,0,0];o.c4(y,r.slice(0,3),f[2]);let x=[0,0,0];return o.d7(x,_,y),o.da(x)}let Vv=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Uv=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class am{static cacheKey(r,c,p,_){let y=`${c}${_?_.cacheKey:""}`;for(let x of p)r.usedDefines.includes(x)&&(y+=`/${x}`);return y}constructor(r,c,p,_,y,x){let C=r.gl;this.program=C.createProgram(),this.configuration=_,this.name=c,this.fixedDefines=[...x];let T=_?_.defines():[];T=T.concat(x.map(V=>`#define ${V}`));let M=`#version 300 es
`,P=M+T.concat("precision mediump float;",El,td.fragmentSource).join(`
`);for(let V of p.fragmentIncludes)P+=`
${ed[V]}`;P+=`
${p.fragmentSource}`;let F=M+T.concat("precision highp float;",El,td.vertexSource).join(`
`);for(let V of p.vertexIncludes)F+=`
${ed[V]}`;this.forceManualRenderingForInstanceIDShaders=r.forceManualRenderingForInstanceIDShaders&&p.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(F+=`
uniform int u_instanceID;
`),F+=`
${p.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(F=F.replaceAll("gl_InstanceID","u_instanceID"));let O=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(O,P),C.compileShader(O),C.attachShader(this.program,O);let z=C.createShader(C.VERTEX_SHADER);C.isContextLost()?this.failedToCreate=!0:(C.shaderSource(z,F),C.compileShader(z),C.attachShader(this.program,z),this.attributes={},C.linkProgram(this.program),C.deleteShader(z),C.deleteShader(O),this.fixedUniforms=y(r),this.binderUniforms=_?_.getUniforms(r):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(V=>({u_instanceID:new o.cg(V)}))(r)),(x.includes("TERRAIN")||c.indexOf("symbol")!==-1||c.indexOf("circle")!==-1)&&(this.terrainUniforms=(V=>({u_dem:new o.cg(V),u_dem_prev:new o.cg(V),u_dem_tl:new o.cj(V),u_dem_scale:new o.ci(V),u_dem_tl_prev:new o.cj(V),u_dem_scale_prev:new o.ci(V),u_dem_size:new o.ci(V),u_dem_lerp:new o.ci(V),u_exaggeration:new o.ci(V),u_depth:new o.cg(V),u_depth_size_inv:new o.cj(V),u_depth_range_unpack:new o.cj(V),u_occluder_half_size:new o.ci(V),u_occlusion_depth_offset:new o.ci(V),u_meter_to_dem:new o.ci(V),u_label_plane_matrix_inv:new o.ck(V)}))(r)),x.includes("GLOBE")&&(this.globeUniforms=(V=>({u_tile_tl_up:new o.ch(V),u_tile_tr_up:new o.ch(V),u_tile_br_up:new o.ch(V),u_tile_bl_up:new o.ch(V),u_tile_up_scale:new o.ci(V)}))(r)),x.includes("FOG")&&(this.fogUniforms=(V=>({u_fog_matrix:new o.ck(V),u_fog_range:new o.cj(V),u_fog_color:new o.d2(V),u_fog_horizon_blend:new o.ci(V),u_fog_vertical_limit:new o.cj(V),u_fog_temporal_offset:new o.ci(V),u_frustum_tl:new o.ch(V),u_frustum_tr:new o.ch(V),u_frustum_br:new o.ch(V),u_frustum_bl:new o.ch(V),u_globe_pos:new o.ch(V),u_globe_radius:new o.ci(V),u_globe_transition:new o.ci(V),u_is_globe:new o.cg(V),u_viewport:new o.cj(V)}))(r)),x.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(V=>({u_cutoff_params:new o.d2(V)}))(r)),x.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(V=>({u_lighting_ambient_color:new o.ch(V),u_lighting_directional_dir:new o.ch(V),u_lighting_directional_color:new o.ch(V),u_ground_radiance:new o.ch(V)}))(r)),x.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(V=>({u_light_matrix_0:new o.ck(V),u_light_matrix_1:new o.ck(V),u_fade_range:new o.cj(V),u_shadow_normal_offset:new o.ch(V),u_shadow_intensity:new o.ci(V),u_shadow_texel_size:new o.ci(V),u_shadow_map_resolution:new o.ci(V),u_shadow_direction:new o.ch(V),u_shadow_bias:new o.ch(V),u_shadowmap_0:new o.cg(V),u_shadowmap_1:new o.cg(V)}))(r)))}getAttributeLocation(r,c){let p=this.attributes[c];return p===void 0&&(p=this.attributes[c]=r.getAttribLocation(this.program,c)),p}setTerrainUniformValues(r,c){if(!this.terrainUniforms)return;let p=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(let _ in c)p[_]&&p[_].set(this.program,_,c[_])}}setGlobeUniformValues(r,c){if(!this.globeUniforms)return;let p=this.globeUniforms;if(!this.failedToCreate){r.program.set(this.program);for(let _ in c)p[_]&&p[_].set(this.program,_,c[_])}}setFogUniformValues(r,c){if(!this.fogUniforms)return;let p=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(let _ in c)p[_].set(this.program,_,c[_])}}setCutoffUniformValues(r,c){if(!this.cutoffUniforms)return;let p=this.cutoffUniforms;if(!this.failedToCreate){r.program.set(this.program);for(let _ in c)p[_].set(this.program,_,c[_])}}setLightsUniformValues(r,c){if(!this.lightsUniforms)return;let p=this.lightsUniforms;if(!this.failedToCreate){r.program.set(this.program);for(let _ in c)p[_].set(this.program,_,c[_])}}setShadowUniformValues(r,c){if(this.failedToCreate||!this.shadowUniforms)return;let p=this.shadowUniforms;r.program.set(this.program);for(let _ in c)p[_].set(this.program,_,c[_])}_drawDebugWireframe(r,c,p,_,y,x,C,T,M,P){let F=r.options.wireframe;if(F.terrain===!1&&F.layers2D===!1&&F.layers3D===!1)return;let O=r.context;if(!(!(!F.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!F.layers2D||r._terrain&&r._terrain.renderingToTexture||!Vv.includes(this.name))||!(!F.layers3D||!Uv.includes(this.name))))return;let z=O.gl,V=r.wireframeDebugCache.getLinesFromTrianglesBuffer(r.frameCounter,y,O);if(!V)return;let H=[...this.fixedDefines];H.push("DEBUG_WIREFRAME");let K=r.getOrCreateProgram(this.name,{config:this.configuration,defines:H});O.program.set(K.program);let Z=(re,ge,ce)=>{if(ge[re]&&ce[re])for(let ve in ge[re])ce[re][ve]&&ce[re][ve].set(ce.program,ve,ge[re][ve].current)};M&&M.setUniforms(K.program,O,K.binderUniforms,C,{zoom:T}),Z("fixedUniforms",this,K),Z("terrainUniforms",this,K),Z("globeUniforms",this,K),Z("fogUniforms",this,K),Z("lightsUniforms",this,K),Z("shadowUniforms",this,K),V.bind(),O.setColorMode(new In([z.ONE,z.ONE_MINUS_SRC_ALPHA,z.ZERO,z.ONE],o.ao.transparent,[!0,!0,!0,!1])),O.setDepthMode(new Vt(c.func===z.LESS?z.LEQUAL:c.func,Vt.ReadOnly,c.range)),O.setStencilMode(mn.disabled);let Q=3*x.primitiveLength*2,ae=3*x.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){let re=P||1;for(let ge=0;ge<re;++ge)K.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ge),z.drawElements(z.LINES,Q,z.UNSIGNED_SHORT,ae)}else P&&P>1?z.drawElementsInstanced(z.LINES,Q,z.UNSIGNED_SHORT,ae,P):z.drawElements(z.LINES,Q,z.UNSIGNED_SHORT,ae);y.bind(),O.program.set(this.program),O.setDepthMode(c),O.setStencilMode(p),O.setColorMode(_)}checkUniforms(r,c,p){if(this.fixedDefines.includes(c)){for(let _ of Object.keys(p))if(!p[_].initialized)throw new Error(`Program '${this.name}', from draw '${r}': uniform ${_} not set but required by ${c} being defined`)}}draw(r,c,p,_,y,x,C,T,M,P,F,O,z,V,H,K){let Z=r.context,Q=Z.gl;if(this.failedToCreate)return;Z.program.set(this.program),Z.setDepthMode(p),Z.setStencilMode(_),Z.setColorMode(y),Z.setCullFace(x);for(let ge of Object.keys(this.fixedUniforms))this.fixedUniforms[ge].set(this.program,ge,C[ge]);V&&V.setUniforms(this.program,Z,this.binderUniforms,O,{zoom:z});let ae={[Q.POINTS]:1,[Q.LINES]:2,[Q.TRIANGLES]:3,[Q.LINE_STRIP]:1}[c];this.checkUniforms(T,"RENDER_SHADOWS",this.shadowUniforms);let re=K&&K>0?1:void 0;for(let ge of F.get()){let ce=ge.vaos||(ge.vaos={});if((ce[T]||(ce[T]=new nd)).bind(Z,this,M,V?V.getPaintVertexBuffers():[],P,ge.vertexOffset,H||[],re),this.forceManualRenderingForInstanceIDShaders){let ve=K||1;for(let me=0;me<ve;++me)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",me),P?Q.drawElements(c,ge.primitiveLength*ae,Q.UNSIGNED_SHORT,ge.primitiveOffset*ae*2):Q.drawArrays(c,ge.vertexOffset,ge.vertexLength)}else K&&K>1?Q.drawElementsInstanced(c,ge.primitiveLength*ae,Q.UNSIGNED_SHORT,ge.primitiveOffset*ae*2,K):P?Q.drawElements(c,ge.primitiveLength*ae,Q.UNSIGNED_SHORT,ge.primitiveOffset*ae*2):Q.drawArrays(c,ge.vertexOffset,ge.vertexLength);c===Q.TRIANGLES&&P&&this._drawDebugWireframe(r,p,_,y,P,ge,O,z,V,K)}}}function Gg(f,r,c=0){let p=Math.pow(2,r.tileID.overscaledZ),_=r.tileSize*Math.pow(2,f.transform.tileZoom)/p,y=_*(r.tileID.canonical.x+r.tileID.wrap*p),x=_*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/o.ay(r,1,f.transform.tileZoom),u_pixel_coord_upper:[y>>16,x>>16],u_pixel_coord_lower:[65535&y,65535&x],u_pattern_transition:c}}let Tf={terrain:0,flat:1},qg=o.bB(),Wg=(f,r,c,p,_,y,x,C,T,M,P,F,O,z,V,H,K,Z)=>{let Q=r.style.light,ae=Q.properties.get("position"),re=[ae.x,ae.y,ae.z],ge=o.dN();Q.properties.get("anchor")==="viewport"&&(o.dO(ge,-r.transform.angle),o.dP(re,re,ge));let ce=Q.properties.get("color").toPremultipliedRenderColor(null),ve=r.transform,me={u_matrix:f,u_lightpos:re,u_lightintensity:Q.properties.get("intensity"),u_lightcolor:[ce.r,ce.g,ce.b],u_vertical_gradient:+c,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:qg,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Tf[M],u_base_type:Tf[P],u_ao:_,u_edge_radius:y,u_width_scale:x,u_flood_light_color:V,u_vertical_scale:H,u_flood_light_intensity:K,u_ground_shadow_factor:Z};return ve.projection.name==="globe"&&(me.u_tile_id=[C.canonical.x,C.canonical.y,1<<C.canonical.z],me.u_zoom_transition=F,me.u_inv_rot_matrix=z,me.u_merc_center=O,me.u_up_dir=ve.projection.upVector(new o.cC(0,0,0),O[0]*o.al,O[1]*o.al),me.u_height_lift=T),me},L1=(f,r,c,p,_,y)=>({u_matrix:f,u_edge_radius:r,u_width_scale:c,u_vertical_scale:p,u_height_type:Tf[_],u_base_type:Tf[y]}),N1=(f,r,c,p,_,y,x,C,T,M,P,F,O,z,V,H,K,Z)=>{let Q=Wg(f,r,c,p,_,y,x,C,M,P,F,O,z,V,H,K,1,[0,0,0]),ae={u_height_factor:-Math.pow(2,C.overscaledZ)/T.tileSize/8};return Object.assign(Q,Gg(r,T,Z),ae)},Sf=(f,r,c,p,_,y,x,C,T,M,P)=>({u_matrix:r,u_opacity:c,u_ao_pass:p?1:0,u_meter_to_tile:_,u_ao:y,u_flood_light_intensity:x,u_flood_light_color:C,u_attenuation:T,u_edge_radius:M,u_fb:0,u_fb_size:P,u_dynamic_offset:1}),z1=(f,r,c)=>({u_matrix:f,u_emissive_strength:r,u_ground_shadow_factor:c}),B1=(f,r,c,p,_,y=0)=>Object.assign(z1(f,r,_),Gg(c,p,y)),kD=(f,r,c,p)=>({u_matrix:f,u_world:c,u_emissive_strength:r,u_ground_shadow_factor:p}),FD=(f,r,c,p,_,y,x=0)=>Object.assign(B1(f,r,c,p,y,x),{u_world:_}),LD=(f,r)=>({u_matrix:f,u_ground_shadow_factor:r}),Zg=(f,r,c,p,_)=>({u_matrix:f,u_camera_pos:[r[0],r[1],r[2]],u_depth_bias:c,u_height_scale:p,u_reset_depth:_}),Hv=(f,r,c,p,_,y,x,C,T)=>({u_matrix:f,u_normal_matrix:r,u_opacity:c,u_faux_facade_ao_intensity:p,u_camera_pos:_,u_tile_to_meter:y,u_facade_emissive_chance:x,u_flood_light_color:C,u_flood_light_intensity:T}),$v=f=>({u_matrix:f}),j1=f=>({u_matrix:f}),Df=(f,r,c,p,_,y,x,C)=>{let T=o.al/y.tileSize;return{u_matrix:f,u_inv_rot_matrix:r,u_camera_to_center_distance:c.getCameraToCenterDistance(C),u_extrude_scale:[c.pixelsToGLUnits[0]/T,c.pixelsToGLUnits[1]/T],u_zoom_transition:p,u_tile_id:x,u_merc_center:_}},Gv=(f,r,c=1)=>({u_matrix:f,u_color:r,u_overlay:0,u_overlay_scale:c}),V1=o.bB(),U1=(f,r,c,p,_,y,x)=>{let C=f.transform,T=C.projection.name==="globe",M=T?o.dQ(C.zoom,r.canonical)*C._pixelsPerMercatorPixel:o.ay(c,1,y),P={u_matrix:r.projMatrix,u_extrude_scale:M,u_intensity:x,u_inv_rot_matrix:V1,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(T){P.u_inv_rot_matrix=p,P.u_merc_center=_,P.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],P.u_zoom_transition=o.aj(C.zoom);let F=_[0]*o.al,O=_[1]*o.al;P.u_up_dir=C.projection.upVector(new o.cC(0,0,0),F,O)}return P};function Xg(f,[r,c,p,_],[y,x]){if(y===x)return[0,0,0,0];let C=255*(f-1)/(f*(x-y));return[r*C,c*C,p*C,_*C]}function tu(f,r,[c,p]){return c===p?0:.5/f+(r-c)*(f-1)/(f*(p-c))}let lm=(f,r,c,p,_,y,x,C,T,M,P,F,O,z,V,H,K,Z,Q,ae,re)=>({u_matrix:f,u_normalize_matrix:r,u_globe_matrix:c,u_merc_matrix:p,u_grid_matrix:_,u_tl_parent:y,u_scale_parent:M,u_fade_t:P.mix,u_opacity:P.opacity*F.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:F.paint.get("raster-brightness-min"),u_brightness_high:F.paint.get("raster-brightness-max"),u_saturation_factor:o.dS(F.paint.get("raster-saturation")),u_contrast_factor:o.dR(F.paint.get("raster-contrast")),u_spin_weights:Yg(F.paint.get("raster-hue-rotate")),u_perspective_transform:O,u_raster_elevation:z,u_zoom_transition:x,u_merc_center:C,u_cutoff_params:T,u_colorization_mix:Xg(o.dT,H,Z),u_colorization_offset:tu(o.dT,K,Z),u_color_ramp:V,u_texture_offset:[ae/(Q+2*ae),Q/(Q+2*ae)],u_texture_res:[Q+2*ae,Q+2*ae],u_emissive_strength:re});function Yg(f){f*=Math.PI/180;let r=Math.sin(f),c=Math.cos(f);return[(2*c+1)/3,(-Math.sqrt(3)*r-c+1)/3,(Math.sqrt(3)*r-c+1)/3]}let gh=.05,id=(f,r,c,p,_,y,x,C,T,M,P,F)=>({u_matrix:f,u_normalize_matrix:r,u_globe_matrix:c,u_merc_matrix:p,u_grid_matrix:_,u_tl_parent:y,u_scale_parent:M,u_fade_t:P.mix,u_opacity:P.opacity,u_image0:0,u_image1:1,u_raster_elevation:F,u_zoom_transition:x,u_merc_center:C,u_cutoff_params:T}),qv=(f,r,c,p,_,y,x,C,T,M)=>({u_particle_texture:f,u_particle_texture_side_len:r,u_tile_offset:c,u_velocity:p,u_color_ramp:y,u_velocity_res:_,u_max_speed:x,u_uv_offset:C,u_data_scale:[255*T[0],255*T[1]],u_data_offset:M,u_particle_pos_scale:1.1,u_particle_pos_offset:[gh,gh]}),Kg=(f,r,c,p,_,y,x,C,T,M)=>({u_particle_texture:f,u_particle_texture_side_len:r,u_velocity:c,u_velocity_res:p,u_max_speed:_,u_speed_factor:y,u_reset_rate:x,u_rand_seed:Math.random(),u_uv_offset:C,u_data_scale:[255*T[0],255*T[1]],u_data_offset:M,u_particle_pos_scale:1.1,u_particle_pos_offset:[gh,gh]}),Wv=o.bB(),Zv=(f,r,c,p,_,y,x,C,T,M,P,F,O,z,V,H,K,Z,Q,ae,re,ge,ce,ve)=>{let me=_.transform,he={u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:me.getCameraToCenterDistance(Q),u_rotate_symbol:+c,u_aspect_ratio:me.width/me.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:x,u_coord_matrix:C,u_is_text:+M,u_elevation_from_sea:T?1:0,u_pitch_with_map:+p,u_texsize:P,u_texsize_icon:F,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Wv,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Wv,u_up_vector:[0,-1,0],u_color_adj_mat:ge,u_icon_transition:ce||0,u_gamma_scale:p?_.transform.getCameraToCenterDistance(Q)*Math.cos(_.terrain?0:_.transform._pitch):1,u_device_pixel_ratio:o.o.devicePixelRatio,u_is_halo:1,u_scale_factor:ve||1,u_ground_shadow_factor:ae,u_inv_matrix:o.bk(o.bB(),x),u_normal_scale:re,u_lutTexture:bo.LUT};return Q.name==="globe"&&(he.u_tile_id=[z.canonical.x,z.canonical.y,1<<z.canonical.z],he.u_zoom_transition=V,he.u_inv_rot_matrix=K,he.u_merc_center=H,he.u_camera_forward=me._camera.forward(),he.u_ecef_origin=o.dU(me.globeMatrix,z.toUnwrapped()),he.u_tile_matrix=Float32Array.from(me.globeMatrix),he.u_up_vector=Z),he},Jg=(f,r,c,p)=>({u_matrix:f,u_emissive_strength:r,u_opacity:c,u_color:p}),Qg=(f,r,c,p,_,y,x,C,T)=>Object.assign((function(M,P,F,O,z,V){let{width:H,height:K}=O.imageManager.getPixelSize(P),Z=Math.pow(2,V.tileID.overscaledZ),Q=V.tileSize*Math.pow(2,O.transform.tileZoom)/Z,ae=Q*(V.tileID.canonical.x+V.tileID.wrap*Z),re=Q*V.tileID.canonical.y;return{u_image:0,u_pattern_tl:F.tl,u_pattern_br:F.br,u_texsize:[H,K],u_pattern_size:F.displaySize,u_pattern_units_to_pixels:z?[O.transform.width,-1*O.transform.height]:[1/o.ay(V,1,O.transform.tileZoom),1/o.ay(V,1,O.transform.tileZoom)],u_pixel_coord_upper:[ae>>16,re>>16],u_pixel_coord_lower:[65535&ae,65535&re]}})(0,y,x,p,C,T),{u_matrix:f,u_emissive_strength:r,u_opacity:c}),Xv=new Float32Array(o.bz([])),e_=(f,r,c,p,_,y,x,C,T,M,P,F,O,z=[0,0,0],V,H,K)=>{let Z=_.style.light,Q=Z.properties.get("position"),ae=[-Q.x,-Q.y,Q.z],re=o.dN();Z.properties.get("anchor")==="viewport"&&(o.dO(re,-_.transform.angle),o.dP(ae,ae,re));let ge=P.alphaMode==="MASK",ce=Z.properties.get("color").toNonPremultipliedRenderColor(null),ve=O.paint.get("model-ambient-occlusion-intensity"),me=O.paint.get("model-color").constantOr(o.ao.white).toNonPremultipliedRenderColor(null);return me.a=O.paint.get("model-color-mix-intensity").constantOr(0),K&&(me.r=K[0],me.g=K[1],me.b=K[2],me.a=K[3]),H&&(me.r=H.color.r,me.g=H.color.g,me.b=H.color.b,me.a=H.colorMix,F=H.emissionStrength,y=H.opacity),{u_matrix:f,u_lighting_matrix:r,u_normal_matrix:c,u_node_matrix:p||Xv,u_lightpos:ae,u_lightintensity:Z.properties.get("intensity"),u_lightcolor:[ce.r,ce.g,ce.b],u_camera_pos:z,u_opacity:y,u_baseTextureIsAlpha:0,u_alphaMask:+ge,u_alphaCutoff:P.alphaCutoff,u_baseColorFactor:x.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:C.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:T,u_roughnessFactor:M,u_baseColorTexture:bo.BaseColor,u_metallicRoughnessTexture:bo.MetallicRoughness,u_normalTexture:bo.Normal,u_occlusionTexture:bo.Occlusion,u_emissionTexture:bo.Emission,u_lutTexture:bo.LUT,u_color_mix:me.toArray01(),u_aoIntensity:ve,u_emissive_strength:F,u_occlusionTextureTransform:V||[0,0,0,0]}},If=(f,r=Xv,c=Xv)=>({u_matrix:f,u_instance:r,u_node_matrix:c}),ND={fillExtrusion:f=>({u_matrix:new o.ck(f),u_lightpos:new o.ch(f),u_lightintensity:new o.ci(f),u_lightcolor:new o.ch(f),u_vertical_gradient:new o.ci(f),u_opacity:new o.ci(f),u_edge_radius:new o.ci(f),u_width_scale:new o.ci(f),u_ao:new o.cj(f),u_height_type:new o.cg(f),u_base_type:new o.cg(f),u_tile_id:new o.ch(f),u_zoom_transition:new o.ci(f),u_inv_rot_matrix:new o.ck(f),u_merc_center:new o.cj(f),u_up_dir:new o.ch(f),u_height_lift:new o.ci(f),u_flood_light_color:new o.ch(f),u_vertical_scale:new o.ci(f),u_flood_light_intensity:new o.ci(f),u_ground_shadow_factor:new o.ch(f)}),fillExtrusionDepth:f=>({u_matrix:new o.ck(f),u_edge_radius:new o.ci(f),u_width_scale:new o.ci(f),u_vertical_scale:new o.ci(f),u_height_type:new o.cg(f),u_base_type:new o.cg(f)}),fillExtrusionPattern:f=>({u_matrix:new o.ck(f),u_lightpos:new o.ch(f),u_lightintensity:new o.ci(f),u_lightcolor:new o.ch(f),u_vertical_gradient:new o.ci(f),u_height_factor:new o.ci(f),u_edge_radius:new o.ci(f),u_width_scale:new o.ci(f),u_ao:new o.cj(f),u_height_type:new o.cg(f),u_base_type:new o.cg(f),u_tile_id:new o.ch(f),u_zoom_transition:new o.ci(f),u_inv_rot_matrix:new o.ck(f),u_merc_center:new o.cj(f),u_up_dir:new o.ch(f),u_height_lift:new o.ci(f),u_image:new o.cg(f),u_texsize:new o.cj(f),u_pixel_coord_upper:new o.cj(f),u_pixel_coord_lower:new o.cj(f),u_tile_units_to_pixels:new o.ci(f),u_opacity:new o.ci(f),u_pattern_transition:new o.ci(f)}),fillExtrusionGroundEffect:f=>({u_matrix:new o.ck(f),u_opacity:new o.ci(f),u_ao_pass:new o.ci(f),u_meter_to_tile:new o.ci(f),u_ao:new o.cj(f),u_flood_light_intensity:new o.ci(f),u_flood_light_color:new o.ch(f),u_attenuation:new o.ci(f),u_edge_radius:new o.ci(f),u_fb:new o.cg(f),u_fb_size:new o.ci(f),u_dynamic_offset:new o.ci(f)}),fill:f=>({u_matrix:new o.ck(f),u_emissive_strength:new o.ci(f),u_ground_shadow_factor:new o.ch(f)}),fillPattern:f=>({u_matrix:new o.ck(f),u_emissive_strength:new o.ci(f),u_image:new o.cg(f),u_texsize:new o.cj(f),u_pixel_coord_upper:new o.cj(f),u_pixel_coord_lower:new o.cj(f),u_tile_units_to_pixels:new o.ci(f),u_ground_shadow_factor:new o.ch(f),u_pattern_transition:new o.ci(f)}),fillOutline:f=>({u_matrix:new o.ck(f),u_emissive_strength:new o.ci(f),u_world:new o.cj(f),u_ground_shadow_factor:new o.ch(f)}),fillOutlinePattern:f=>({u_matrix:new o.ck(f),u_emissive_strength:new o.ci(f),u_world:new o.cj(f),u_image:new o.cg(f),u_texsize:new o.cj(f),u_pixel_coord_upper:new o.cj(f),u_pixel_coord_lower:new o.cj(f),u_tile_units_to_pixels:new o.ci(f),u_ground_shadow_factor:new o.ch(f),u_pattern_transition:new o.ci(f)}),building:f=>({u_matrix:new o.ck(f),u_normal_matrix:new o.ck(f),u_opacity:new o.ci(f),u_faux_facade_ao_intensity:new o.ci(f),u_camera_pos:new o.ch(f),u_tile_to_meter:new o.ci(f),u_facade_emissive_chance:new o.ci(f),u_flood_light_color:new o.ch(f),u_flood_light_intensity:new o.ci(f)}),buildingBloom:f=>({u_matrix:new o.ck(f)}),buildingDepth:f=>({u_matrix:new o.ck(f)}),elevatedStructuresDepth:f=>({u_matrix:new o.ck(f),u_depth_bias:new o.ci(f)}),elevatedStructures:f=>({u_matrix:new o.ck(f),u_ground_shadow_factor:new o.ch(f)}),elevatedStructuresDepthReconstruct:f=>({u_matrix:new o.ck(f),u_camera_pos:new o.ch(f),u_depth_bias:new o.ci(f),u_height_scale:new o.ci(f),u_reset_depth:new o.ci(f)}),circle:o.dX,collisionBox:f=>({u_matrix:new o.ck(f),u_inv_rot_matrix:new o.ck(f),u_camera_to_center_distance:new o.ci(f),u_extrude_scale:new o.cj(f),u_zoom_transition:new o.ci(f),u_merc_center:new o.cj(f),u_tile_id:new o.ch(f)}),collisionCircle:f=>({u_matrix:new o.ck(f),u_inv_matrix:new o.ck(f),u_camera_to_center_distance:new o.ci(f),u_viewport_size:new o.cj(f)}),debug:f=>({u_color:new o.dA(f),u_matrix:new o.ck(f),u_overlay:new o.cg(f),u_overlay_scale:new o.ci(f)}),clippingMask:f=>({u_matrix:new o.ck(f)}),heatmap:f=>({u_extrude_scale:new o.ci(f),u_intensity:new o.ci(f),u_matrix:new o.ck(f),u_inv_rot_matrix:new o.ck(f),u_merc_center:new o.cj(f),u_tile_id:new o.ch(f),u_zoom_transition:new o.ci(f),u_up_dir:new o.ch(f)}),heatmapTexture:f=>({u_image:new o.cg(f),u_color_ramp:new o.cg(f),u_opacity:new o.ci(f)}),hillshade:f=>({u_matrix:new o.ck(f),u_image:new o.cg(f),u_latrange:new o.cj(f),u_light:new o.cj(f),u_shadow:new o.dA(f),u_highlight:new o.dA(f),u_emissive_strength:new o.ci(f),u_accent:new o.dA(f)}),hillshadePrepare:f=>({u_matrix:new o.ck(f),u_image:new o.cg(f),u_dimension:new o.cj(f),u_zoom:new o.ci(f)}),line:o.dW,linePattern:o.dV,raster:f=>({u_matrix:new o.ck(f),u_normalize_matrix:new o.ck(f),u_globe_matrix:new o.ck(f),u_merc_matrix:new o.ck(f),u_grid_matrix:new o.dB(f),u_tl_parent:new o.cj(f),u_scale_parent:new o.ci(f),u_fade_t:new o.ci(f),u_opacity:new o.ci(f),u_image0:new o.cg(f),u_image1:new o.cg(f),u_brightness_low:new o.ci(f),u_brightness_high:new o.ci(f),u_saturation_factor:new o.ci(f),u_contrast_factor:new o.ci(f),u_spin_weights:new o.ch(f),u_perspective_transform:new o.cj(f),u_raster_elevation:new o.ci(f),u_zoom_transition:new o.ci(f),u_merc_center:new o.cj(f),u_cutoff_params:new o.d2(f),u_colorization_mix:new o.d2(f),u_colorization_offset:new o.ci(f),u_color_ramp:new o.cg(f),u_texture_offset:new o.cj(f),u_texture_res:new o.cj(f),u_emissive_strength:new o.ci(f)}),rasterParticle:f=>({u_matrix:new o.ck(f),u_normalize_matrix:new o.ck(f),u_globe_matrix:new o.ck(f),u_merc_matrix:new o.ck(f),u_grid_matrix:new o.dB(f),u_tl_parent:new o.cj(f),u_scale_parent:new o.ci(f),u_fade_t:new o.ci(f),u_opacity:new o.ci(f),u_image0:new o.cg(f),u_image1:new o.cg(f),u_raster_elevation:new o.ci(f),u_zoom_transition:new o.ci(f),u_merc_center:new o.cj(f),u_cutoff_params:new o.d2(f)}),rasterParticleTexture:f=>({u_texture:new o.cg(f),u_opacity:new o.ci(f)}),rasterParticleDraw:f=>({u_particle_texture:new o.cg(f),u_particle_texture_side_len:new o.ci(f),u_tile_offset:new o.cj(f),u_velocity:new o.cg(f),u_color_ramp:new o.cg(f),u_velocity_res:new o.cj(f),u_max_speed:new o.ci(f),u_uv_offset:new o.cj(f),u_data_scale:new o.cj(f),u_data_offset:new o.ci(f),u_particle_pos_scale:new o.ci(f),u_particle_pos_offset:new o.cj(f)}),rasterParticleUpdate:f=>({u_particle_texture:new o.cg(f),u_particle_texture_side_len:new o.ci(f),u_velocity:new o.cg(f),u_velocity_res:new o.cj(f),u_max_speed:new o.ci(f),u_speed_factor:new o.ci(f),u_reset_rate:new o.ci(f),u_rand_seed:new o.ci(f),u_uv_offset:new o.cj(f),u_data_scale:new o.cj(f),u_data_offset:new o.ci(f),u_particle_pos_scale:new o.ci(f),u_particle_pos_offset:new o.cj(f)}),symbol:f=>({u_is_size_zoom_constant:new o.cg(f),u_is_size_feature_constant:new o.cg(f),u_size_t:new o.ci(f),u_size:new o.ci(f),u_camera_to_center_distance:new o.ci(f),u_rotate_symbol:new o.cg(f),u_aspect_ratio:new o.ci(f),u_fade_change:new o.ci(f),u_matrix:new o.ck(f),u_label_plane_matrix:new o.ck(f),u_coord_matrix:new o.ck(f),u_is_text:new o.cg(f),u_elevation_from_sea:new o.cg(f),u_pitch_with_map:new o.cg(f),u_texsize:new o.cj(f),u_texsize_icon:new o.cj(f),u_texture:new o.cg(f),u_texture_icon:new o.cg(f),u_gamma_scale:new o.ci(f),u_device_pixel_ratio:new o.ci(f),u_tile_id:new o.ch(f),u_zoom_transition:new o.ci(f),u_inv_rot_matrix:new o.ck(f),u_merc_center:new o.cj(f),u_camera_forward:new o.ch(f),u_tile_matrix:new o.ck(f),u_up_vector:new o.ch(f),u_ecef_origin:new o.ch(f),u_is_halo:new o.cg(f),u_icon_transition:new o.ci(f),u_color_adj_mat:new o.ck(f),u_scale_factor:new o.ci(f),u_ground_shadow_factor:new o.ch(f),u_inv_matrix:new o.ck(f),u_normal_scale:new o.ci(f),u_lutTexture:new o.cg(f)}),background:f=>({u_matrix:new o.ck(f),u_emissive_strength:new o.ci(f),u_opacity:new o.ci(f),u_color:new o.dA(f)}),backgroundPattern:f=>({u_matrix:new o.ck(f),u_emissive_strength:new o.ci(f),u_opacity:new o.ci(f),u_image:new o.cg(f),u_pattern_tl:new o.cj(f),u_pattern_br:new o.cj(f),u_texsize:new o.cj(f),u_pattern_size:new o.cj(f),u_pixel_coord_upper:new o.cj(f),u_pixel_coord_lower:new o.cj(f),u_pattern_units_to_pixels:new o.cj(f)}),terrainRaster:f=>({u_matrix:new o.ck(f),u_image0:new o.cg(f),u_skirt_height:new o.ci(f),u_ground_shadow_factor:new o.ch(f)}),skybox:f=>({u_matrix:new o.ck(f),u_sun_direction:new o.ch(f),u_cubemap:new o.cg(f),u_opacity:new o.ci(f),u_temporal_offset:new o.ci(f)}),skyboxGradient:f=>({u_matrix:new o.ck(f),u_color_ramp:new o.cg(f),u_center_direction:new o.ch(f),u_radius:new o.ci(f),u_opacity:new o.ci(f),u_temporal_offset:new o.ci(f)}),skyboxCapture:f=>({u_matrix_3f:new o.dB(f),u_sun_direction:new o.ch(f),u_sun_intensity:new o.ci(f),u_color_tint_r:new o.d2(f),u_color_tint_m:new o.d2(f),u_luminance:new o.ci(f)}),globeRaster:f=>({u_proj_matrix:new o.ck(f),u_globe_matrix:new o.ck(f),u_normalize_matrix:new o.ck(f),u_merc_matrix:new o.ck(f),u_zoom_transition:new o.ci(f),u_merc_center:new o.cj(f),u_image0:new o.cg(f),u_grid_matrix:new o.dB(f),u_skirt_height:new o.ci(f),u_far_z_cutoff:new o.ci(f),u_frustum_tl:new o.ch(f),u_frustum_tr:new o.ch(f),u_frustum_br:new o.ch(f),u_frustum_bl:new o.ch(f),u_globe_pos:new o.ch(f),u_globe_radius:new o.ci(f),u_viewport:new o.cj(f)}),globeAtmosphere:f=>({u_frustum_tl:new o.ch(f),u_frustum_tr:new o.ch(f),u_frustum_br:new o.ch(f),u_frustum_bl:new o.ch(f),u_horizon:new o.ci(f),u_transition:new o.ci(f),u_fadeout_range:new o.ci(f),u_atmosphere_fog_color:new o.d2(f),u_high_color:new o.d2(f),u_space_color:new o.d2(f),u_temporal_offset:new o.ci(f),u_horizon_angle:new o.ci(f)}),model:f=>({u_matrix:new o.ck(f),u_lighting_matrix:new o.ck(f),u_normal_matrix:new o.ck(f),u_node_matrix:new o.ck(f),u_lightpos:new o.ch(f),u_lightintensity:new o.ci(f),u_lightcolor:new o.ch(f),u_camera_pos:new o.ch(f),u_opacity:new o.ci(f),u_baseColorFactor:new o.d2(f),u_emissiveFactor:new o.d2(f),u_metallicFactor:new o.ci(f),u_roughnessFactor:new o.ci(f),u_baseTextureIsAlpha:new o.cg(f),u_alphaMask:new o.cg(f),u_alphaCutoff:new o.ci(f),u_baseColorTexture:new o.cg(f),u_metallicRoughnessTexture:new o.cg(f),u_normalTexture:new o.cg(f),u_occlusionTexture:new o.cg(f),u_emissionTexture:new o.cg(f),u_lutTexture:new o.cg(f),u_color_mix:new o.d2(f),u_aoIntensity:new o.ci(f),u_emissive_strength:new o.ci(f),u_occlusionTextureTransform:new o.d2(f)}),modelDepth:f=>({u_matrix:new o.ck(f),u_instance:new o.ck(f),u_node_matrix:new o.ck(f)}),groundShadow:f=>({u_matrix:new o.ck(f),u_ground_shadow_factor:new o.ch(f)}),stars:f=>({u_matrix:new o.ck(f),u_up:new o.ch(f),u_right:new o.ch(f),u_intensity_multiplier:new o.ci(f)}),snowParticle:f=>({u_modelview:new o.ck(f),u_projection:new o.ck(f),u_time:new o.ci(f),u_cam_pos:new o.ch(f),u_velocityConeAperture:new o.ci(f),u_velocity:new o.ci(f),u_horizontalOscillationRadius:new o.ci(f),u_horizontalOscillationRate:new o.ci(f),u_boxSize:new o.ci(f),u_billboardSize:new o.ci(f),u_simpleShapeParameters:new o.cj(f),u_screenSize:new o.cj(f),u_thinningCenterPos:new o.cj(f),u_thinningShape:new o.ch(f),u_thinningAffectedRatio:new o.ci(f),u_thinningParticleOffset:new o.ci(f),u_particleColor:new o.d2(f),u_direction:new o.ch(f)}),rainParticle:f=>({u_modelview:new o.ck(f),u_projection:new o.ck(f),u_time:new o.ci(f),u_cam_pos:new o.ch(f),u_texScreen:new o.cg(f),u_velocityConeAperture:new o.ci(f),u_velocity:new o.ci(f),u_boxSize:new o.ci(f),u_rainDropletSize:new o.cj(f),u_distortionStrength:new o.ci(f),u_rainDirection:new o.ch(f),u_color:new o.d2(f),u_screenSize:new o.cj(f),u_thinningCenterPos:new o.cj(f),u_thinningShape:new o.ch(f),u_thinningAffectedRatio:new o.ci(f),u_thinningParticleOffset:new o.ci(f),u_shapeDirectionalPower:new o.ci(f),u_shapeNormalPower:new o.ci(f),u_mode:new o.ci(f)}),vignette:f=>({u_vignetteShape:new o.ch(f),u_vignetteColor:new o.d2(f)}),occlusion:f=>({u_matrix:new o.ck(f),u_anchorPos:new o.ch(f),u_screenSizePx:new o.cj(f),u_occluderSizePx:new o.cj(f),u_color:new o.d2(f)})},H1=(()=>{class f{constructor(c,p,_,y){this.id=f.uniqueIdxCounter,f.uniqueIdxCounter++,this.context=c;let x=c.gl;this.buffer=x.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),c.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,p.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||y||p.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(c){this.id=f.uniqueIdxCounter,f.uniqueIdxCounter++;let p=this.context.gl;this.context.unbindVAO(),this.bind(),p.bufferSubData(p.ELEMENT_ARRAY_BUFFER,0,c.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return f.uniqueIdxCounter=0,f})(),$1={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class zD{constructor(r,c,p,_,y,x){this.length=c.length,this.attributes=p,this.itemSize=c.bytesPerElement,this.dynamicDraw=_,this.instanceCount=x,this.context=r;let C=r.gl;this.buffer=C.createBuffer(),r.bindVertexBuffer.set(this.buffer),C.bufferData(C.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||y||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){let c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,c){for(let p=0;p<this.attributes.length;p++){let _=c.getAttributeLocation(r,this.attributes[p].name);_!==-1&&r.enableVertexAttribArray(_)}}setVertexAttribPointers(r,c,p){for(let _=0;_<this.attributes.length;_++){let y=this.attributes[_],x=c.getAttributeLocation(r,y.name);x!==-1&&r.vertexAttribPointer(x,y.components,r[$1[y.type]],!1,this.itemSize,y.offset+this.itemSize*(p||0))}}setVertexAttribDivisor(r,c,p){for(let _=0;_<this.attributes.length;_++){let y=c.getAttributeLocation(r,this.attributes[_].name);y!==-1&&this.instanceCount&&this.instanceCount>0&&r.vertexAttribDivisor(y,p)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class t_{constructor(r,c,p,_,y){this.context=r,this.width=c,this.height=p;let x=this.framebuffer=r.gl.createFramebuffer();_&&(this.colorAttachment=new OD(r,x)),y&&(this.depthAttachmentType=y,this.depthAttachment=y==="renderbuffer"?new k1(r,x):new RD(r,x))}destroy(){let r=this.context.gl;if(this.colorAttachment){let c=this.colorAttachment.get();c&&r.deleteTexture(c)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){let c=this.depthAttachment.get();c&&r.deleteRenderbuffer(c)}else{let c=this.depthAttachment.get();c&&r.deleteTexture(c)}r.deleteFramebuffer(this.framebuffer)}}class n_{constructor(r,c){this.gl=r,this.clearColor=new hh(this),this.clearDepth=new fo(this),this.clearStencil=new Mv(this),this.colorMask=new Av(this),this.depthMask=new Pv(this),this.stencilMask=new Ov(this),this.stencilFunc=new Ng(this),this.stencilOp=new Rv(this),this.stencilTest=new Cf(this),this.depthRange=new kv(this),this.depthTest=new fh(this),this.depthFunc=new N(this),this.blend=new j(this),this.blendFunc=new oe(this),this.blendColor=new Me(this),this.blendEquation=new Ct(this),this.cullFace=new _n(this),this.cullFaceSide=new Hi(this),this.frontFace=new Tr(this),this.program=new no(this),this.activeTexture=new eu(this),this.viewport=new xc(this),this.bindFramebuffer=new zg(this),this.bindRenderbuffer=new Bg(this),this.bindTexture=new Fv(this),this.bindVertexBuffer=new jg(this),this.bindElementBuffer=new im(this),this.bindVertexArrayOES=new P1(this),this.pixelStoreUnpack=new O1(this),this.pixelStoreUnpackPremultiplyAlpha=new R1(this),this.pixelStoreUnpackFlipY=new Ef(this),this.options=c?Object.assign({},c):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=r.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=r.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=r.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=c&&!!c.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=r.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),this.maxPointSize=r.getParameter(r.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,c,p){return new H1(this,r,c,p)}createVertexBuffer(r,c,p,_,y){return new zD(this,r,c,p,_,y)}createRenderbuffer(r,c,p){let _=this.gl,y=_.createRenderbuffer();return this.bindRenderbuffer.set(y),_.renderbufferStorage(_.RENDERBUFFER,r,c,p),this.bindRenderbuffer.set(null),y}createFramebuffer(r,c,p,_){return new t_(this,r,c,p,_)}clear({color:r,depth:c,stencil:p,colorMask:_}){let y=this.gl,x=0;r&&(x|=y.COLOR_BUFFER_BIT,this.clearColor.set(r.toNonPremultipliedRenderColor(null)),this.colorMask.set(_||[!0,!0,!0,!0])),c!==void 0&&(x|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),p!==void 0&&(x|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),y.clear(x)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){o.bx(r.blendFunction,In.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor),r.blendEquation?this.blendEquation.set(r.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(r.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let bc;function cm(f,r,c,p,_,y,x){let C=f.context,T=C.gl,M=f.transform,P=[o.aF(M.center.lng),o.aJ(M.center.lat)],F=c.layout.get("symbol-placement"),O=c.layout.get("text-variable-anchor"),z=c.layout.get("icon-rotation-alignment")==="map",V=c.layout.get("text-rotation-alignment")==="map",H=F!=="point",K=[],Z=0,Q=0;for(let he=0;he<p.length;he++){let xe=p[he],Re=r.getTile(xe),Ie=Re.getBucket(c);if(!Ie)continue;let qe=Ie.getProjection().createInversionMatrix(M,xe.canonical),je=[],Ke=Wc(xe,Ie,M),_t=!x&&z&&H,Le=x&&V&&H,Te=O&&Ie.hasTextData(),Je=Ie.hasIconTextFit()&&Te&&Ie.hasIconData(),Ue=_t||Le||x&&Te||Je,at=Ie.projection.name==="globe",bt=at?o.aj(M.zoom):0;at&&(je.push("PROJECTION_GLOBE_VIEW"),Ue&&je.push("PROJECTED_POS_ON_VIEWPORT"));let jt=f.getOrCreateProgram("collisionBox",{defines:je}),mt=Ke;_[0]===0&&_[1]===0||(mt=f.translatePosMatrix(Ke,Re,_,y));let xt=x?Ie.textCollisionBox:Ie.iconCollisionBox,$t=Ie.collisionCircleArray;if($t.length>0){let At=o.bB(),Lt=mt;o.cO(At,Ie.placementInvProjMatrix,M.glCoordMatrix),o.cO(At,At,Ie.placementViewportMatrix),K.push({circleArray:$t,circleOffset:Q,transform:Lt,invTransform:At,projection:Ie.getProjection()}),Z+=$t.length/4,Q=Z}if(!xt)continue;f.terrain&&f.terrain.setupElevationDraw(Re,jt);let Ft=at?[xe.canonical.x,xe.canonical.y,1<<xe.canonical.z]:[0,0,0];jt.draw(f,T.LINES,Vt.disabled,mn.disabled,f.colorModeForRenderPass(),dn.disabled,Df(mt,qe,M,bt,P,Re,Ft,Ie.getProjection()),c.id,xt.layoutVertexBuffer,xt.indexBuffer,xt.segments,null,M.zoom,null,[xt.collisionVertexBuffer,xt.collisionVertexBufferExt])}if(!x||!K.length)return;let ae=f.getOrCreateProgram("collisionCircle"),re=new o.dY;re.resize(4*Z),re._trim();let ge=0;for(let he of K)for(let xe=0;xe<he.circleArray.length/4;xe++){let Re=4*xe,Ie=he.circleArray[Re+0],qe=he.circleArray[Re+1],je=he.circleArray[Re+2],Ke=he.circleArray[Re+3];re.emplace(ge++,Ie,qe,je,Ke,0),re.emplace(ge++,Ie,qe,je,Ke,1),re.emplace(ge++,Ie,qe,je,Ke,2),re.emplace(ge++,Ie,qe,je,Ke,3)}(!bc||bc.length<2*Z)&&(bc=(function(he){let xe=2*he,Re=new o.b0;Re.resize(xe),Re._trim();for(let Ie=0;Ie<xe;Ie++){let qe=6*Ie;Re.uint16[qe+0]=4*Ie+0,Re.uint16[qe+1]=4*Ie+1,Re.uint16[qe+2]=4*Ie+2,Re.uint16[qe+3]=4*Ie+2,Re.uint16[qe+4]=4*Ie+3,Re.uint16[qe+5]=4*Ie+0}return Re})(Z));let ce=C.createIndexBuffer(bc,!0),ve=C.createVertexBuffer(re,o.dZ.members,!0);for(let he of K){let xe={u_matrix:he.transform,u_inv_matrix:he.invTransform,u_camera_to_center_distance:(me=M).getCameraToCenterDistance(he.projection),u_viewport_size:[me.width,me.height]};ae.draw(f,T.TRIANGLES,Vt.disabled,mn.disabled,f.colorModeForRenderPass(),dn.disabled,xe,c.id,ve,ce,o.bf.simpleSegment(0,2*he.circleOffset,he.circleArray.length,he.circleArray.length/2),null,M.zoom)}var me;ve.destroy(),ce.destroy()}let rd=o.bB();function Yv(f){let r=f._camera.getWorldToCamera(f.worldSize,1),c=o.aB([],r,f.globeMatrix);o.bk(c,c);let p=[0,0,0],_=[0,1,0,0];return o.aC(_,_,c),p[0]=_[0],p[1]=_[1],p[2]=_[2],o.aw(p,p),p}function i_({width:f,height:r,anchor:c,textOffset:p,textScale:_},y){let{horizontalAlign:x,verticalAlign:C}=o.c0(c),T=-(x-.5)*f,M=-(C-.5)*r,P=o.c1(c,p);return new o.P((T/_+P[0])*y,(M/_+P[1])*y)}function r_(f,r,c,p,_,y,x,C,T,M){let P=f.text.placedSymbolArray,F=f.text.dynamicLayoutVertexArray,O=f.icon.dynamicLayoutVertexArray,z={},V=f.getProjection(),H=hf(x,V,_),K=_.elevation,Z=V.upVectorScale(x.canonical,_.center.lat,_.worldSize).metersToTile;F.clear();for(let Q=0;Q<P.length;Q++){let ae=P.get(Q),{tileAnchorX:re,tileAnchorY:ge,numGlyphs:ce}=ae,ve=ae.hidden||!ae.crossTileID||f.allowVerticalPlacement&&!ae.placedOrientation?null:p[ae.crossTileID];if(ve){let me=0,he=0,xe=0,Re=f.elevationType==="road";if(K||Re){let Ue=Re?f.getElevationFeatureForText(Q):null,at=o.bU.getAtTileOffset(x,new o.P(re,ge),K,Ue),[bt,jt,mt]=V.upVector(x.canonical,re,ge);me=at*bt*Z,he=at*jt*Z,xe=at*mt*Z}let[Ie,qe,je,Ke]=uo(ae.projectedAnchorX+me,ae.projectedAnchorY+he,ae.projectedAnchorZ+xe,c?H:y),_t=$p(_.getCameraToCenterDistance(V),Ke),Le=o.bL(f.textSizeData,T,ae)*_t/o.bX;c&&(Le*=f.tilePixelRatio/C);let Te=i_(ve,Le);c?({x:Ie,y:qe,z:je}=V.projectTilePoint(re+Te.x,ge+Te.y,x.canonical),[Ie,qe,je]=uo(Ie+me,qe+he,je+xe,y)):(r&&Te._rotate(-_.angle),Ie+=Te.x,qe+=Te.y,je=0);let Je=f.allowVerticalPlacement&&ae.placedOrientation===o.bK.vertical?Math.PI/2:0;for(let Ue=0;Ue<ce;Ue++)o.bN(F,Ie,qe,je,Je);M&&ae.associatedIconIndex>=0&&(z[ae.associatedIconIndex]={x:Ie,y:qe,z:je,angle:Je})}else $l(ce,F)}if(M){O.clear();let Q=f.icon.placedSymbolArray;for(let ae=0;ae<Q.length;ae++){let re=Q.get(ae),{numGlyphs:ge}=re,ce=z[ae];if(re.hidden||!ce)$l(ge,O);else{let{x:ve,y:me,z:he,angle:xe}=ce;for(let Re=0;Re<ge;Re++)o.bN(O,ve,me,he,xe)}}f.icon.dynamicLayoutVertexBuffer.updateData(O)}f.text.dynamicLayoutVertexBuffer.updateData(F)}function um(f,r,c,p,_,y,x={}){let C=c.paint.get("icon-translate"),T=c.paint.get("text-translate"),M=c.paint.get("icon-translate-anchor"),P=c.paint.get("text-translate-anchor"),F=c.layout.get("icon-rotation-alignment"),O=c.layout.get("text-rotation-alignment"),z=c.layout.get("icon-pitch-alignment"),V=c.layout.get("text-pitch-alignment"),H=c.layout.get("icon-keep-upright"),K=c.layout.get("text-keep-upright"),Z=c.paint.get("icon-color-saturation"),Q=c.paint.get("icon-color-contrast"),ae=c.paint.get("icon-color-brightness-min"),re=c.paint.get("icon-color-brightness-max"),ge=c.layout.get("symbol-elevation-reference")==="sea",ce=c.layout.get("icon-image-use-theme")==="none",ve=f.context,me=ve.gl,he=f.transform,xe=F==="map",Re=O==="map",Ie=z==="map",qe=V==="map",je=c.layout.get("symbol-sort-key").constantOr(1)!==void 0,Ke=!1,_t=f.depthModeForSublayer(0,Vt.ReadOnly),Le=new Vt(f.context.gl.LEQUAL,Vt.ReadOnly,f.depthRangeFor3D),Te=[o.aF(he.center.lng),o.aJ(he.center.lat)],Je=c.layout.get("text-variable-anchor"),Ue=he.projection.name==="globe",at=[],bt=[0,-1,0];for(let jt of p){let mt=r.getTile(jt),xt=mt.getBucket(c);if(!xt||xt.projection.name==="mercator"&&Ue||xt.fullyClipped)continue;let $t=xt.projection.name==="globe",Ft=$t?o.aj(he.zoom):0,At=hf(jt,xt.getProjection(),he),Lt=he.calculatePixelsToTileUnitsMatrix(mt),sn=Je&&xt.hasTextData(),jn=xt.hasIconTextFit()&&sn&&xt.hasIconData(),ei=xt.getProjection().createInversionMatrix(he,jt.canonical),Ni=(1<<mt.tileID.canonical.z)*o.al/f.transform.worldSize,pn=Ci=>{let vn=[0,0,0];if(Ci){let ii=f.style.directionalLight,yr=f.style.ambientLight;ii&&yr&&(vn=Oa(f.style,ii,yr))}return vn},Kn=Ci=>{he.depthOcclusionForSymbolsAndCircles&&(c.hasOcclusionOpacityProperties||f.terrain)&&(Ci.push("DEPTH_D24"),Ci.push("DEPTH_OCCLUSION"))},Mn=Ci=>{c.lut&&!ce&&(c.lut.texture||(c.lut.texture=new o.d_(f.context,c.lut.image,[c.lut.image.height,c.lut.image.height,c.lut.image.height],ve.gl.RGBA8)),ve.activeTexture.set(ve.gl.TEXTURE0+bo.LUT),c.lut.texture&&c.lut.texture.bind(ve.gl.LINEAR,ve.gl.CLAMP_TO_EDGE),Ci.push("APPLY_LUT_ON_GPU"))},Ii=()=>{let Ci=xe&&c.layout.get("symbol-placement")!=="point",vn=[];Kn(vn),Mn(vn);let ii=Ci||jn,yr=xt.elevationType==="road",Gr=f.shadowRenderer,Cr=yr&&Ie&&!!Gr&&Gr.enabled,kr=pn(Cr),ya=yr&&Ie&&!f.terrain?Le:_t,Js=c.paint.get("icon-image-cross-fade");f.terrainRenderModeElevated()&&Ie&&vn.push("PITCH_WITH_MAP_TERRAIN"),$t&&(vn.push("PROJECTION_GLOBE_VIEW"),ii&&vn.push("PROJECTED_POS_ON_VIEWPORT")),Js>0&&xt.hasAnySecondaryIcon&&vn.push("ICON_TRANSITION"),!xt.icon.zOffsetVertexBuffer||yr&&f.terrain||vn.push("Z_OFFSET"),Z===0&&Q===0&&ae===0&&re===1||vn.push("COLOR_ADJUSTMENT"),xt.sdfIcons&&vn.push("RENDER_SDF"),Cr&&vn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),yr&&Ie&&!f.terrain&&xt.icon.orientationVertexBuffer&&vn.push("ELEVATED_ROADS");let ls=xt.icon.programConfigurations.get(c.id),ws=f.getOrCreateProgram("symbol",{config:ls,defines:vn}),el=mt.imageAtlasTexture?mt.imageAtlasTexture.size:[0,0],cs=xt.iconSizeData,tl=o.bJ(cs,he.zoom),Il=Ie||!he.isOrthographic,jo=Vu(At,mt.tileID.canonical,Ie,xe,he,xt.getProjection(),Lt),Sr=ma(At,mt.tileID.canonical,Ie,xe,he,xt.getProjection(),Lt),qr=f.translatePosMatrix(Sr,mt,C,M,!0),Zi=f.translatePosMatrix(At,mt,C,M),Kr=ii?rd:jo,Vo=xe&&!Ie&&!Ci,Dr=bt;!Ue&&!he.mercatorFromTransition||xe||(Dr=Yv(he));let nl=$t?Dr:bt,Hf=c.getColorAdjustmentMatrix(Z,Q,ae,re),au=Zv(cs.kind,tl,Vo,Ie,f,Zi,Kr,qr,ge,!1,el,[0,0],0,jt,Ft,Te,ei,nl,xt.getProjection(),kr,Ni,Hf,Js,null),$f=mt.imageAtlasTexture?mt.imageAtlasTexture:null,Gf=c.layout.get("icon-size").constantOr(0)!==1||xt.iconsNeedLinear,il=xt.sdfIcons||f.options.rotating||f.options.zooming||Gf||Il?me.LINEAR:me.NEAREST,Cc=xt.sdfIcons&&c.paint.get("icon-halo-width").constantOr(1)!==0,ko=f.terrain&&Ie&&Ci?o.bk(o.bB(),jo):rd;if(Ci&&xt.icon){let rl=o.bU.getAtTileOffsetFunc(jt,he.center.lat,he.worldSize,xt.getProjection()),Ch=Uu(At,mt.tileID.canonical,Ie,xe,he,xt.getProjection(),Lt),pw=c.layout.get("icon-size-scale-range"),T_=o.aA(f.scaleFactor,pw[0],pw[1]);ff(xt,At,f,!1,Ch,Sr,Ie,H,rl,jt,T_)}return{program:ws,buffers:xt.icon,uniformValues:au,atlasTexture:$f,atlasTextureIcon:null,atlasInterpolation:il,atlasInterpolationIcon:null,isSDF:xt.sdfIcons,hasHalo:Cc,depthMode:ya,tile:mt,renderWithShadows:Cr,labelPlaneMatrixInv:ko}},ti=()=>{let Ci=Re&&c.layout.get("symbol-placement")!=="point",vn=[],ii=Ci||Je||jn,yr=xt.elevationType==="road",Gr=f.shadowRenderer,Cr=yr&&qe&&!!Gr&&Gr.enabled,kr=pn(Cr),ya=yr&&qe&&!f.terrain?Le:_t;f.terrainRenderModeElevated()&&qe&&vn.push("PITCH_WITH_MAP_TERRAIN"),$t&&(vn.push("PROJECTION_GLOBE_VIEW"),ii&&vn.push("PROJECTED_POS_ON_VIEWPORT")),!xt.text.zOffsetVertexBuffer||yr&&f.terrain||vn.push("Z_OFFSET"),xt.iconsInText&&vn.push("RENDER_TEXT_AND_SYMBOL"),vn.push("RENDER_SDF"),Cr&&vn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),yr&&qe&&!f.terrain&&xt.text.orientationVertexBuffer&&vn.push("ELEVATED_ROADS"),Kn(vn);let Js=xt.text.programConfigurations.get(c.id),ls=f.getOrCreateProgram("symbol",{config:Js,defines:vn}),ws,el=[0,0],cs=null,tl=xt.textSizeData;xt.iconsInText&&(el=mt.imageAtlasTexture?mt.imageAtlasTexture.size:[0,0],cs=mt.imageAtlasTexture?mt.imageAtlasTexture:null,ws=qe||!he.isOrthographic||f.options.rotating||f.options.zooming||tl.kind==="composite"||tl.kind==="camera"?me.LINEAR:me.NEAREST);let Il=mt.glyphAtlasTexture?mt.glyphAtlasTexture.size:[0,0],jo=c.layout.get("text-size-scale-range"),Sr=o.aA(f.scaleFactor,jo[0],jo[1]),qr=o.bJ(tl,he.zoom,Sr),Zi=Vu(At,mt.tileID.canonical,qe,Re,he,xt.getProjection(),Lt),Kr=ma(At,mt.tileID.canonical,qe,Re,he,xt.getProjection(),Lt),Vo=f.translatePosMatrix(Kr,mt,T,P,!0),Dr=f.translatePosMatrix(At,mt,T,P),nl=ii?rd:Zi,Hf=Re&&!qe&&!Ci,au=bt;!Ue&&!he.mercatorFromTransition||Re||(au=Yv(he));let $f=Zv(tl.kind,qr,Hf,qe,f,Dr,nl,Vo,ge,!0,Il,el,0,jt,Ft,Te,ei,$t?au:bt,xt.getProjection(),kr,Ni,null,null,Sr),Gf=mt.glyphAtlasTexture?mt.glyphAtlasTexture:null,il=me.LINEAR,Cc=c.paint.get("text-halo-width").constantOr(1)!==0,ko=f.terrain&&qe&&Ci?o.bk(o.bB(),Zi):rd;if(Ci&&xt.text){let rl=o.bU.getAtTileOffsetFunc(jt,he.center.lat,he.worldSize,xt.getProjection()),Ch=Uu(At,mt.tileID.canonical,qe,Re,he,xt.getProjection(),Lt);ff(xt,At,f,!0,Ch,Kr,qe,K,rl,jt,Sr)}return{program:ls,buffers:xt.text,uniformValues:$f,atlasTexture:Gf,atlasTextureIcon:cs,atlasInterpolation:il,atlasInterpolationIcon:ws,isSDF:!0,hasHalo:Cc,depthMode:ya,tile:mt,renderWithShadows:Cr,labelPlaneMatrixInv:ko}},Xi=xt.icon.segments.get().length,ci=xt.text.segments.get().length,An=Xi&&!x.onlyText?Ii():null,yi=ci&&!x.onlyIcons?ti():null,kn=c.paint.get("icon-opacity").constantOr(1),cr=c.paint.get("text-opacity").constantOr(1);if(je&&xt.canOverlap){Ke=!0;let Ci=kn&&!x.onlyText?xt.icon.segments.get():[],vn=cr&&!x.onlyIcons?xt.text.segments.get():[];for(let ii of Ci)at.push({segments:new o.bf([ii]),sortKey:ii.sortKey,state:An});for(let ii of vn)at.push({segments:new o.bf([ii]),sortKey:ii.sortKey,state:yi})}else x.onlyText||at.push({segments:kn?xt.icon.segments:new o.bf([]),sortKey:0,state:An}),x.onlyIcons||at.push({segments:cr?xt.text.segments:new o.bf([]),sortKey:0,state:yi})}Ke&&at.sort((jt,mt)=>jt.sortKey-mt.sortKey);for(let jt of at){let mt=jt.state;if(mt)if(f.terrain?f.terrain.setupElevationDraw(mt.tile,mt.program,{useDepthForOcclusion:he.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:mt.labelPlaneMatrixInv}):f.setupDepthForOcclusion(he.depthOcclusionForSymbolsAndCircles,mt.program),ve.activeTexture.set(me.TEXTURE0),mt.atlasTexture&&mt.atlasTexture.bind(mt.atlasInterpolation,me.CLAMP_TO_EDGE,!0),mt.atlasTextureIcon&&(ve.activeTexture.set(me.TEXTURE1),mt.atlasTextureIcon&&mt.atlasTextureIcon.bind(mt.atlasInterpolationIcon,me.CLAMP_TO_EDGE,!0)),mt.renderWithShadows&&f.shadowRenderer.setupShadows(mt.tile.tileID.toUnwrapped(),mt.program,"vector-tile"),f.uploadCommonLightUniforms(f.context,mt.program),mt.hasHalo){let xt=mt.uniformValues;xt.u_is_halo=1,o_(mt.buffers,jt.segments,c,f,mt.program,mt.depthMode,_,y,xt,2),xt.u_is_halo=0}else{if(mt.isSDF){let xt=mt.uniformValues;mt.hasHalo&&(xt.u_is_halo=1,o_(mt.buffers,jt.segments,c,f,mt.program,mt.depthMode,_,y,xt,1)),xt.u_is_halo=0}o_(mt.buffers,jt.segments,c,f,mt.program,mt.depthMode,_,y,mt.uniformValues,1)}}}function o_(f,r,c,p,_,y,x,C,T,M){let P=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.iconTransitioningVertexBuffer,f.globeExtVertexBuffer,f.zOffsetVertexBuffer,f.orientationVertexBuffer];_.draw(p,p.context.gl.TRIANGLES,y,x,C,dn.disabled,T,c.id,f.layoutVertexBuffer,f.indexBuffer,r,c.paint,p.transform.zoom,f.programConfigurations.get(c.id),P,M)}function G1(f,r){let c=1<<f.canonical.z,p=(r.x*c-f.canonical.x-f.wrap*c)*o.al,_=(r.y*c-f.canonical.y)*o.al,y=o.e7(r.z,r.y);return o.d4(p,_,y)}function _h(f,r,c,p,_){if(!c.layout||c.layout.get("fill-elevation-reference")==="none"||c.paint.get("fill-opacity").constantOr(1)===0)return;let y=f.context.gl,x=new Vt(f.context.gl.LEQUAL,Vt.ReadWrite,f.depthRangeFor3D),C=new Vt(f.context.gl.GREATER,Vt.ReadWrite,f.depthRangeFor3D),T=(function(z){let V=.01;return z.isOrthographic&&(V=o.ak(1e-4,V,o.c$(z.pitch>=Kc?1:z.pitch/Kc))),2*V})(f.transform),M=f.transform.getFreeCameraOptions().position,P="elevatedStructuresDepthReconstruct",F=f.getOrCreateProgram(P,{defines:["DEPTH_RECONSTRUCTION"]}),O=f.getOrCreateProgram(P);for(let z of p){let V=r.getTile(z),H=V.getBucket(c);if(!H)continue;let K=H.elevatedStructures;if(!K)continue;let Z=H.elevationBufferData.heightRange,Q=G1(z.toUnwrapped(),M),ae=f.translatePosMatrix(z.projMatrix,V,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor")),re,ge,ce,ve;if(_==="initialize"){if(!Z||Z.min>=1||K.depthSegments.segments[0].primitiveLength===0)continue;re=Zg(ae,Q,T,1,0),ge=x,ce=K.depthSegments,ve=F}else if(_==="reset"){if(!Z||Z.min>=0||K.maskSegments.segments[0].primitiveLength===0)continue;re=Zg(ae,Q,0,0,1),ge=C,ce=K.maskSegments,ve=F}else if(_==="geometry"){if(K.depthSegments.segments[0].primitiveLength===0)continue;re=Zg(ae,Q,T,1,0),ge=x,ce=K.depthSegments,ve=O}ve.draw(f,y.TRIANGLES,ge,mn.disabled,In.disabled,dn.disabled,re,c.id,K.vertexBuffer,K.indexBuffer,ce,c.paint,f.transform.zoom)}}function Mf(f,r,c){let{painter:p,sourceCache:_,layer:y,coords:x,colorMode:C,elevationType:T,terrainEnabled:M,pass:P}=f,F=p.context.gl,O=y.paint.get("fill-pattern"),z=y.paint.get("fill-pattern-cross-fade"),V=O.constantOr(null),H=T;T!=="road"||r&&!M||(H="none");let K=H==="road",Z=f.painter.shadowRenderer,Q=K&&!!Z&&Z.enabled,ae=new Vt(p.context.gl.LEQUAL,Vt.ReadOnly,p.depthRangeFor3D),re=[0,0,0];if(Q){let ve=p.style.directionalLight,me=p.style.ambientLight;ve&&me&&(re=Oa(p.style,ve,me))}let ge=O&&O.constantOr(1),ce=(ve,me)=>{let he,xe,Re,Ie,qe;me?(he=ge&&!y.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Re=F.LINES):(he=ge?"fillPattern":"fill",Re=F.TRIANGLES);for(let je of x){let Ke=_.getTile(je);if(ge&&!Ke.patternsLoaded())continue;let _t=Ke.getBucket(y);if(!_t)continue;let Le=r?_t.elevationBufferData:_t.bufferData;if(Le.isEmpty())continue;p.prepareDrawTile();let Te=Le.programConfigurations.get(y.id),Je=p.isTileAffectedByFog(je),Ue=[],at=[];K&&(Ue.push("ELEVATED_ROADS"),at.push(Le.elevatedLayoutVertexBuffer)),Q&&Ue.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),ge&&(p.context.activeTexture.set(F.TEXTURE0),Ke.imageAtlasTexture&&Ke.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),Te.updatePaintBuffers());let bt=!1;if(V&&Ke.imageAtlas){let Ft=Ke.imageAtlas,At=o.e2.from(V),Lt=At.getPrimary().scaleSelf(o.o.devicePixelRatio).toString(),sn=At.getSecondary(),jn=Ft.patternPositions.get(Lt),ei=sn?Ft.patternPositions.get(sn.scaleSelf(o.o.devicePixelRatio).toString()):null;bt=!!jn&&!!ei,jn&&Te.setConstantPatternPositions(jn,ei)}z>0&&(bt||Te.getPatternTransitionVertexBuffer("fill-pattern"))&&Ue.push("FILL_PATTERN_TRANSITION");let jt=p.getOrCreateProgram(he,{config:Te,overrideFog:Je,defines:Ue}),mt=p.translatePosMatrix(je.projMatrix,Ke,y.paint.get("fill-translate"),y.paint.get("fill-translate-anchor"));Q&&Z.setupShadows(Ke.tileID.toUnwrapped(),jt,"vector-tile");let xt=y.paint.get("fill-emissive-strength");if(me){Ie=Le.lineIndexBuffer,qe=Le.lineSegments;let Ft=p.terrain&&p.terrain.renderingToTexture?p.terrain.drapeBufferSize:[F.drawingBufferWidth,F.drawingBufferHeight];xe=he==="fillOutlinePattern"&&ge?FD(mt,xt,p,Ke,Ft,re,z):kD(mt,xt,Ft,re)}else Ie=Le.indexBuffer,qe=Le.triangleSegments,xe=ge?B1(mt,xt,p,Ke,re,z):z1(mt,xt,re);p.uploadCommonUniforms(p.context,jt,je.toUnwrapped());let $t=ve;(T==="road"&&!M||T==="offset")&&($t=ae),jt.draw(p,Re,$t,c||p.stencilModeForClipping(je),C,dn.disabled,xe,y.id,Le.layoutVertexBuffer,Ie,qe,y.paint,p.transform.zoom,Te,at)}};p.renderPass===P&&ce(p.depthModeForSublayer(1,p.renderPass==="opaque"?Vt.ReadWrite:Vt.ReadOnly),!1),H==="none"&&p.renderPass==="translucent"&&y.paint.get("fill-antialias")&&ce(p.depthModeForSublayer(y.getPaintProperty("fill-outline-color")?2:0,Vt.ReadOnly),!0)}function Bt(f,r,c,p,_,y,x,C){c.resetLayerRenderingStats(f);let T=f.context,M=T.gl,P=f.transform,F=c.paint.get("fill-extrusion-pattern"),O=c.paint.get("fill-extrusion-pattern-cross-fade"),z=F.constantOr(null),V=F.constantOr(1),H=c.paint.get("fill-extrusion-opacity"),K=f.style.enable3dLights(),Z=c.paint.get(K&&!V?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),Q=[c.paint.get("fill-extrusion-ambient-occlusion-intensity"),Z],ae=c.layout.get("fill-extrusion-edge-radius"),re=ae>0&&!c.paint.get("fill-extrusion-rounded-roof"),ge=re?0:ae,ce=P.projection.name==="globe"?o.ea():0,ve=P.projection.name==="globe",me=ve?o.aj(P.zoom):0,he=[o.aF(P.center.lng),o.aJ(P.center.lat)],xe=c.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Re=c.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(xe?null:c.lut).toArray01().slice(0,3),Ie=c.paint.get("fill-extrusion-flood-light-intensity"),qe=c.paint.get("fill-extrusion-vertical-scale"),je=c.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Ke=c.paint.get("fill-extrusion-height-alignment"),_t=c.paint.get("fill-extrusion-base-alignment"),Le=ql(f,c.paint.get("fill-extrusion-cutoff-fade-range")),Te=[],Je;ve&&Te.push("PROJECTION_GLOBE_VIEW"),Q[0]>0&&Te.push("FAUX_AO"),re&&Te.push("ZERO_ROOF_RADIUS"),C&&Te.push("HAS_CENTROID"),Ie>0&&Te.push("FLOOD_LIGHT"),Le.shouldRenderCutoff&&Te.push("RENDER_CUTOFF"),je&&Te.push("RENDER_WALL_MODE");let Ue=f.renderPass==="shadow",at=f.shadowRenderer,bt=Ue&&!!at,jt=Ue?dn.disabled:dn.backCCW;f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0);let mt=[0,0,0];if(at){let Ft=f.style.directionalLight,At=f.style.ambientLight;Ft&&At&&(mt=Oa(f.style,Ft,At)),Ue||(Te.push("RENDER_SHADOWS","DEPTH_TEXTURE"),at.useNormalOffset&&Te.push("NORMAL_OFFSET")),Je=Te.concat(["SHADOWS_SINGLE_CASCADE"])}let xt=bt?"fillExtrusionDepth":V?"fillExtrusionPattern":"fillExtrusion",$t=c.getLayerRenderingStats();for(let Ft of p){let At=r.getTile(Ft),Lt=At.getBucket(c);if(!Lt||Lt.projection.name!==P.projection.name)continue;let sn=!1;at&&(sn=at.getMaxCascadeForTile(Ft.toUnwrapped())===0);let jn=f.isTileAffectedByFog(Ft),ei=Lt.programConfigurations.get(c.id),Ni=!1;if(z&&At.imageAtlas){let ci=At.imageAtlas,An=o.e2.from(z),yi=An.getPrimary().scaleSelf(o.o.devicePixelRatio).toString(),kn=An.getSecondary(),cr=ci.patternPositions.get(yi),Ci=kn?ci.patternPositions.get(kn.scaleSelf(o.o.devicePixelRatio).toString()):null;Ni=!!cr&&!!Ci,cr&&ei.setConstantPatternPositions(cr,Ci)}O>0&&(Ni||ei.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Te.push("FILL_EXTRUSION_PATTERN_TRANSITION");let pn=f.getOrCreateProgram(xt,{config:ei,defines:sn?Je:Te,overrideFog:jn});if(f.terrain&&f.terrain.setupElevationDraw(At,pn,{useMeterToDem:!0}),!Lt.centroidVertexBuffer){let ci=pn.getAttributeLocation(M,"a_centroid_pos");ci!==-1&&M.vertexAttrib2f(ci,0,0)}!Ue&&at&&at.setupShadows(At.tileID.toUnwrapped(),pn,"vector-tile"),V&&(f.context.activeTexture.set(M.TEXTURE0),At.imageAtlasTexture&&At.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),ei.updatePaintBuffers());let Kn=c.paint.get("fill-extrusion-vertical-gradient"),Mn=1/Lt.tileToMeter,Ii;if(Ue&&at){if(q1(At.tileID,Lt.maxHeight,f))continue;let ci=at.calculateShadowPassMatrixFromTile(At.tileID.toUnwrapped());Ii=L1(ci,ge,Mn,qe,Ke,_t)}else{let ci=f.translatePosMatrix(Ft.expandedProjMatrix,At,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),An=P.projection.createInversionMatrix(P,Ft.canonical);Ii=V?N1(ci,f,Kn,H,Q,ge,Mn,Ft,At,ce,Ke,_t,me,he,An,Re,qe,O):Wg(ci,f,Kn,H,Q,ge,Mn,Ft,ce,Ke,_t,me,he,An,Re,qe,Ie,mt)}f.uploadCommonUniforms(T,pn,Ft.toUnwrapped(),null,Le);let ti=Lt.segments;if(P.projection.name==="mercator"&&!Ue&&(ti=Lt.getVisibleSegments(At.tileID,f.terrain,f.transform.getFrustum(0)),!ti.get().length))continue;if($t)if(Ue)for(let ci of ti.get())$t.numRenderedVerticesInShadowPass+=ci.primitiveLength;else for(let ci of ti.get())$t.numRenderedVerticesInTransparentPass+=ci.primitiveLength;let Xi=[];(f.terrain||C)&&Xi.push(Lt.centroidVertexBuffer),ve&&Xi.push(Lt.layoutVertexExtBuffer),je&&Xi.push(Lt.wallVertexBuffer),pn.draw(f,T.gl.TRIANGLES,_,y,x,jt,Ii,c.id,Lt.layoutVertexBuffer,Lt.indexBuffer,ti,c.paint,f.transform.zoom,ei,Xi)}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1)}class Kv{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function nu(f,r,c,p,_,y,x,C,T,M,P,F,O,z,V,H,K,Z,Q,ae){let re=r.context,ge=re.gl,ce=r.transform,ve=r.transform.zoom,me=[],he=f.translate,xe=f.translateAnchor,Re=f.edgeRadius,Ie=ql(r,f.cutoffFadeRange);P==="clear"?(me.push("CLEAR_SUBPASS"),ae&&(me.push("CLEAR_FROM_TEXTURE"),re.activeTexture.set(ge.TEXTURE0),ae.bind(ge.LINEAR,ge.CLAMP_TO_EDGE))):P==="sdf"&&me.push("SDF_SUBPASS"),Z&&me.push("HAS_CENTROID"),Ie.shouldRenderCutoff&&me.push("RENDER_CUTOFF");let qe=(je,Ke,_t,Le,Te)=>{let Je=me;Ke.groundRadiusBuffer!=null&&(Je=me.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));let Ue=Ke.programConfigurations.get(p.id),at=r.isTileAffectedByFog(je),bt=r.getOrCreateProgram("fillExtrusionGroundEffect",{config:Ue,defines:Je,overrideFog:at}),jt=Sf(r,Le,F,M,Te,[O,z*Te],V,H,K,ve>=17?0:Re*Te,ae?ae.size[0]:0),mt=[];Z&&mt.push(Ke.hiddenByLandmarkVertexBuffer),Ke.groundRadiusBuffer!=null&&mt.push(Ke.groundRadiusBuffer),r.uploadCommonUniforms(re,bt,je.toUnwrapped(),null,Ie),bt.draw(r,re.gl.TRIANGLES,y,x,C,T,jt,p.id,Ke.vertexBuffer,Ke.indexBuffer,_t,p.paint,ve,Ue,mt)};for(let je of _){let Ke=c.getTile(je),_t=Ke.getBucket(p);if(!_t||_t.projection.name!==ce.projection.name||!_t.groundEffect||_t.groundEffect&&!_t.groundEffect.hasData())continue;let Le=_t.groundEffect,Te=1/_t.tileToMeter;{let Je=r.translatePosMatrix(je.projMatrix,Ke,he,xe),Ue=Le.getDefaultSegment();qe(je,Le,Ue,Je,Te)}if(Q)for(let Je=0;Je<4;Je++){let Ue=o.e8[Je](je),at=c.getTile(Ue);if(!at)continue;let bt=at.getBucket(p);if(!bt||bt.projection.name!==ce.projection.name||!bt.groundEffect||bt.groundEffect&&!bt.groundEffect.hasData())continue;let jt=bt.groundEffect,mt,xt;Je===0?(mt=[-o.al,0,0],xt=1):Je===1?(mt=[o.al,0,0],xt=0):Je===2?(mt=[0,-o.al,0],xt=3):(mt=[0,o.al,0],xt=2);let $t=jt.regionSegments[xt];if(!$t)continue;let Ft=new Float32Array(16);o.bq(Ft,je.projMatrix,mt),qe(je,jt,$t,r.translatePosMatrix(Ft,Ke,he,xe),Te)}}}function od(f,r,c,p,_,y,x){p.centroidVertexArray.length===0&&p.createCentroidsBuffer();let C=y?y.findDEMTileFor(c):null;if(!(C&&C.dem||x))return;y&&C&&C.dem&&p.selfDEMTileTimestamp!==C.dem._timestamp&&(p.borderDoneWithNeighborZ=[-1,-1,-1,-1],p.selfDEMTileTimestamp=C.dem._timestamp);let T=Z=>new o.P(Math.ceil((Z+o.ec)*o.ed),0),M=Z=>{let Q=r.getSource().minzoom,ae=ge=>{let ce=r.getTileByID(ge);if(ce&&ce.hasData())return ce.getBucket(_)},re=[0,-1,1];for(let ge of re){if(Z.overscaledZ+ge<Q)continue;let ce=ae(Z.calculateScaledKey(Z.overscaledZ+ge));if(ce)return ce}},P=[0,0,0],F=(Z,Q)=>(P[0]=Math.min(Z.min.y,Q.min.y),P[1]=Math.max(Z.max.y,Q.max.y),P[2]=o.al-Q.min.x>Z.max.x?Q.min.x-o.al:Z.max.x,P),O=(Z,Q)=>(P[0]=Math.min(Z.min.x,Q.min.x),P[1]=Math.max(Z.max.x,Q.max.x),P[2]=o.al-Q.min.y>Z.max.y?Q.min.y-o.al:Z.max.y,P),z=[(Z,Q)=>F(Z,Q),(Z,Q)=>F(Q,Z),(Z,Q)=>O(Z,Q),(Z,Q)=>O(Q,Z)],V=(Z,Q,ae,re,ge,ce,ve)=>{if(!y)return 0;let me=[[ce?ae:Z,ce?Z:ae,0],[ce?ae:Q,ce?Q:ae,0]],he=ve<0?o.al+ve:ve,xe=[ce?he:(Z+Q)/2,ce?(Z+Q)/2:he,0];return ae===0&&ve<0||ae!==0&&ve>0?y.getForTilePoints(ge,[xe],!0,re):me.push(xe),y.getForTilePoints(c,me,!0,C),Math.max(me[0][2],me[1][2],xe[2])/y.exaggeration()};for(let Z=0;Z<4;Z++){let Q=p.borderFeatureIndices[Z];if(Q.length===0)continue;let ae=o.e8[Z](c),re=M(ae);if(!(re&&re instanceof o.e9))continue;let ge=y?y.findDEMTileFor(ae):null;if(!(ge&&ge.dem||x)||(y&&ge&&ge.dem&&p.borderDEMTileTimestamp[Z]!==ge.dem._timestamp&&(p.borderDoneWithNeighborZ[Z]=-1,p.borderDEMTileTimestamp[Z]=ge.dem._timestamp),p.borderDoneWithNeighborZ[Z]===re.canonical.z))continue;re.centroidVertexArray.length===0&&re.createCentroidsBuffer();let ce=(Z<2?1:5)-Z,ve=re.borderDoneWithNeighborZ[ce]!==p.canonical.z,me=re.borderFeatureIndices[ce],he=0;if(p.canonical.z!==re.canonical.z){for(let xe of Q)p.showCentroid(p.featuresOnBorder[xe]);if(ve)for(let xe of me)re.showCentroid(re.featuresOnBorder[xe]);p.borderDoneWithNeighborZ[Z]=re.canonical.z,re.borderDoneWithNeighborZ[ce]=p.canonical.z}for(let xe of Q){let Re=p.featuresOnBorder[xe],Ie=p.centroidData[Re.centroidDataIndex],qe=Re.borders[Z],je;for(;he<me.length;){je=re.featuresOnBorder[me[he]];let Ke=je.borders[ce];if(Ke[1]>qe[0]+3||Ke[0]>qe[0]-3)break;re.showCentroid(je),he++}if(je&&he<me.length){let Ke=he,_t=0;for(;!(je.borders[ce][0]>qe[1]-3)&&(_t++,++he!==me.length);)je=re.featuresOnBorder[me[he]];je=re.featuresOnBorder[me[Ke]];let Le=!1;if(_t>=1){let Ue=je.borders[ce];Math.abs(qe[0]-Ue[0])<3&&Math.abs(qe[1]-Ue[1])<3&&(_t=1,Le=!0,he=Ke+1)}else if(_t===0){p.showCentroid(Re);continue}let Te=re.centroidData[je.centroidDataIndex];x&&Le&&(((H=Ie).flags|(K=Te).flags)&o.eb?(H.flags|=o.eb,K.flags|=o.eb):(H.flags&=~o.eb,K.flags&=~o.eb));let Je=Re.intersectsCount()>1||je.intersectsCount()>1;if(_t>1)he=Ke,Ie.centroidXY=Te.centroidXY=new o.P(0,0);else if(ge&&ge.dem&&!Je){let Ue=z[Z](Ie,Te),at=Z%2?o.al-1:0,bt=V(Ue[0],Math.min(o.al-1,Ue[1]),at,ge,ae,Z<2,Ue[2]);Ie.centroidXY=Te.centroidXY=T(bt)}else Je?Ie.centroidXY=Te.centroidXY=new o.P(0,0):(Ie.centroidXY=p.encodeBorderCentroid(Re),Te.centroidXY=re.encodeBorderCentroid(je));p.writeCentroidToBuffer(Ie),re.writeCentroidToBuffer(Te)}else p.showCentroid(Re)}p.borderDoneWithNeighborZ[Z]=re.canonical.z,re.borderDoneWithNeighborZ[ce]=p.canonical.z}var H,K;(p.needsCentroidUpdate||!p.centroidVertexBuffer&&p.centroidVertexArray.length!==0)&&p.uploadCentroid(f)}let sd=[1,0,0],on=[0,1,0],Jv=[0,0,1];function q1(f,r,c){let p=c.transform,_=c.shadowRenderer;if(!_)return!0;let y=f.toUnwrapped(),x=p.tileSize*_._cascades[c.currentShadowCascade].scale,C=r;if(p.elevation){let H=p.elevation.getMinMaxForTile(f);H&&(C+=H.max)}let T=[..._.shadowDirection];T[2]=-T[2];let M=_.computeSimplifiedTileShadowVolume(y,C,x,T);if(!M)return!1;let P=[sd,on,Jv,T,[T[0],0,T[2]],[0,T[1],T[2]]],F=p.projection.name==="globe",O=p.scaleZoom(x),z=o.cA.fromInvProjectionMatrix(p.invProjMatrix,p.worldSize,O,!F),V=_.getCurrentCascadeFrustum();return z.intersectsPrecise(M.vertices,M.planes,P)===0||V.intersectsPrecise(M.vertices,M.planes,P)===0}function s_(f){let{painter:r,source:c,layer:p,coords:_}=f,y=f.defines,x=r.context,C=r.renderPass==="shadow",T=r.renderPass==="light-beam",M=r.shadowRenderer,P=o.ee(r.transform.center.lat,r.transform.zoom),F=ql(r,p.paint.get("building-cutoff-fade-range"));F.shouldRenderCutoff&&(y=y.concat("RENDER_CUTOFF")),f.floodLightIntensity>0&&(y=y.concat("FLOOD_LIGHT"));for(let O of _){let z=c.getTile(O),V=z.getBucket(p);if(!V)continue;M&&M.getMaxCascadeForTile(O.toUnwrapped())===0&&(y=y.concat("SHADOWS_SINGLE_CASCADE"));let H=V.programConfigurations.get(p.id),K,Z,Q,ae=r.translatePosMatrix(O.expandedProjMatrix,z,[0,0],"map");if(ae=o.cR(o.bB(),ae,[1,1,f.verticalScale]),C&&M){if(q1(z.tileID,V.maxHeight*P,r))continue;let ge=M.calculateShadowPassMatrixFromTile(z.tileID.toUnwrapped());ge=o.cR(o.bB(),ge,[1,1,f.verticalScale]),Q=j1(ge),K=Z=r.getOrCreateProgram("buildingDepth",{config:H,defines:y,overrideFog:!1})}else if(T)K=Z=r.getOrCreateProgram("buildingBloom",{config:H,defines:y,overrideFog:!1}),Q=$v(ae);else{let ge=r.transform.calculatePosMatrix(O.toUnwrapped(),r.transform.worldSize);o.cR(ge,ge,[1,1,f.verticalScale]);let ce=o.bB();o.cR(ce,ge,[1,-1,1/P]),o.bk(ce,ce),o.ef(ce,ce);let ve=r.transform.getFreeCameraOptions().position,me=1<<O.canonical.z;if(Q=Hv(ae,ce,f.opacity,f.facadeAOIntensity,[((ve.x-O.wrap)*me-O.canonical.x)*o.al,(ve.y*me-O.canonical.y)*o.al,ve.z*me*o.al],V.tileToMeter,f.facadeEmissiveChance,f.floodLightColor,f.floodLightIntensity),Z=r.getOrCreateProgram("building",{config:H,defines:y,overrideFog:!1}),f.depthOnly===!0)K=Z;else{let he=y.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);K=r.getOrCreateProgram("building",{config:H,defines:he,overrideFog:!1})}M&&(M.setupShadowsFromMatrix(ge,Z,!0),K!==Z&&M.setupShadowsFromMatrix(ge,K,!0))}let re=(ge,ce)=>{if(T){let ve=ge.entranceBloom;ce.draw(r,x.gl.TRIANGLES,f.depthMode,mn.disabled,f.blendMode,dn.disabled,Q,p.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segmentsBucket,p.paint,r.transform.zoom,H,[ve.layoutAttenuationBuffer,ve.layoutColorBuffer])}else{let ve=ge.segmentsBucket,me=[ge.layoutNormalBuffer,ge.layoutCentroidBuffer,ge.layoutColorBuffer,ge.layoutFloodLightDataBuffer];ge.layoutFacadePaintBuffer&&(me=me.concat([ge.layoutFacadeDataBuffer,ge.layoutFacadeVerticalRangeBuffer,ge.layoutFacadePaintBuffer])),ce.draw(r,x.gl.TRIANGLES,f.depthMode,mn.disabled,f.blendMode,C?dn.disabled:dn.backCW,Q,p.id,ge.layoutVertexBuffer,ge.indexBuffer,ve,p.paint,r.transform.zoom,H,me)}};r.uploadCommonUniforms(x,Z,O.toUnwrapped(),null,F),V.buildingWithoutFacade&&re(V.buildingWithoutFacade,Z),V.buildingWithFacade&&(K!==Z&&r.uploadCommonUniforms(x,K,O.toUnwrapped(),null,F),re(V.buildingWithFacade,K))}}function a_(f,r,c,p,_,y,x,C,T,M,P,F,O){let z=f.context.gl,V=f.depthModeForSublayer(1,Vt.ReadOnly,z.LEQUAL,!0),H=.1*(1-(K=P))+3*K;var K;let Z=f._showOverdrawInspector,Q=F,ae=new Kv;Z||nu(ae,f,r,c,p,V,new mn({func:z.ALWAYS,mask:255},255,255,z.KEEP,z.KEEP,z.REPLACE),new In([z.ONE,z.ONE,z.ONE,z.ONE],o.ao.transparent,[!1,!1,!1,!0],z.MIN),dn.disabled,_,"sdf",y,x,C,T,M,H,Q,!1);{let re=Z?mn.disabled:new mn({func:z.EQUAL,mask:255},255,255,z.KEEP,z.DECR,z.DECR),ge=Z?f.colorModeForRenderPass():new In([z.ONE_MINUS_DST_ALPHA,z.DST_ALPHA,z.ONE,z.ONE],o.ao.transparent,[!0,!0,!0,!0]);nu(ae,f,r,c,p,V,re,ge,dn.disabled,_,"color",y,x,C,T,M,H,Q,!1)}}function Qv(f){return[f[0]*o.eg,f[1]*o.eg,f[2]*o.eg,0]}function ey(f,r,c,p,_,y,x,C,T){let M=p.getSource(),P=c.globeSharedBuffers;if(!P)return;let F,O,z;if(r&&(F=p.getTile(r)),M instanceof o.aT?(O=M.texture,z=o.dJ(0,0,c.transform)):F&&r&&(O=F.texture,z=o.dJ(r.canonical.z,r.canonical.x,c.transform)),!O||!z)return;f||(z=o.cR(o.bB(),z,[1,-1,1]));let V=c.context,H=V.gl,K=_.paint.get("raster-resampling")==="nearest"?H.NEAREST:H.LINEAR,Z=c.colorModeForDrapableLayerRenderPass(y),Q=x.defines;Q.push("GLOBE_POLES");let ae=new Vt(H.LEQUAL,Vt.ReadWrite,c.depthRangeFor3D),re=Float32Array.from(c.transform.expandedFarZProjMatrix),ge=Float32Array.from(o.bj(o.dI(new o.cC(0,0,0))));c.terrain&&c.terrain.prepareDrawTile(),V.activeTexture.set(H.TEXTURE0),O.bind(K,H.CLAMP_TO_EDGE),V.activeTexture.set(H.TEXTURE1),O.bind(K,H.CLAMP_TO_EDGE),"useMipmap"in O&&V.extTextureFilterAnisotropic&&c.transform.pitch>20&&H.texParameterf(H.TEXTURE_2D,V.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,V.extTextureFilterAnisotropicMax);let[ce,ve,me,he]=r?P.getPoleBuffers(r.canonical.z,!1):P.getPoleBuffers(0,!0),xe=_.paint.get("raster-elevation"),Re;f?(Re=ce,c.renderDefaultNorthPole=xe!==0):(Re=ve,c.renderDefaultSouthPole=xe!==0);let Ie=Qv(x.mix),qe=((Ke,_t,Le,Te,Je,Ue,at,bt,jt,mt,xt,$t,Ft)=>lm(Ke,_t,Le,new Float32Array(16),new Float32Array(9),[0,0],Te,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ue,[0,0],bt,2,mt,xt,$t,1,0,Ft))(re,ge,z,o.aj(c.transform.zoom),0,_,0,xe,0,Ie,x.offset,x.range,y),je=c.getOrCreateProgram("raster",{defines:Q});c.uploadCommonUniforms(V,je,null),je.draw(c,H.TRIANGLES,ae,T,Z,C,qe,_.id,Re,me,he)}function W1(f){let r=f._nearZ,c=f.projection.farthestPixelDistance(f),p=c-r,_=.2*f.height,y=r+_;return[r,c,(y-_-r)/p,(y-r)/p]}function BD(f,r,c,p){if(f)return r instanceof yo&&f instanceof yl?r.getTextureDescriptor(f,c,!0):{texture:f.texture,mix:Qv(p.mix),offset:p.offset,buffer:0,tileSize:1}}var jD=o.eh([{name:"a_index",type:"Int16",components:1}]);class ka{constructor(r,c,p,_){let y={width:p[0],height:p[1],data:null},x=r.gl;this.targetColorTexture=new o.T(r,y,x.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new o.T(r,y,x.RGBA8,{useMipmap:!1}),this.context=r,this.updateParticleTexture(c,_),this.lastInvalidatedAt=0}updateParticleTexture(r,c){if(this.particleTextureDimension===c.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());let p=this.context.gl,_=c.width*c.height;this.particleTexture0=new o.T(this.context,c,p.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new o.T(this.context,c,p.RGBA8,{premultiply:!1,useMipmap:!1});let y=new o.ei;y.reserve(_);for(let x=0;x<_;x++)y.emplaceBack(x);this.particleIndexBuffer=this.context.createVertexBuffer(y,jD.members,!0),this.particleSegment=o.bf.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=c.width}update(r){return!(this.lastInvalidatedAt<r&&(this.lastInvalidatedAt=o.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function ty(f,r,c){if(!f)return null;let p=r.getTextureDescriptor(f,c,!0);if(!p)return null;let{texture:_,mix:y,offset:x,tileSize:C,buffer:T,format:M}=p;if(!_||!M)return null;let P=!1;return M==="uint32"&&(P=!0,y[3]=0,y=Xg(o.ej,y,[0,c.paint.get("raster-particle-max-speed")]),x=tu(o.ej,x,[0,c.paint.get("raster-particle-max-speed")])),{texture:_,textureOffset:[T/(C+2*T),C/(C+2*T)],tileSize:C,scalarData:P,scale:y,offset:x,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[M]]}}function Ks(f){let r=f._nearZ,c=f.projection.farthestPixelDistance(f),p=c-r,_=.2*f.height,y=r+_;return[r,c,(y-_-r)/p,(y-r)/p]}let ad=new o.ao(1,0,0,1),Z1=new o.ao(0,1,0,1),ny=new o.ao(0,0,1,1),iy=new o.ao(1,0,1,1),ry=new o.ao(0,1,1,1);function oy(f,r,c,p,_,y){for(let x=0;x<c.length;x++)if(_){let M=new o.ao(p.r*.8,p.g*.8,p.b*.8,1);Fa(f,r,c[x],p,-1,-1,y),Fa(f,r,c[x],p,-1,1,y),Fa(f,r,c[x],p,1,1,y),Fa(f,r,c[x],p,1,-1,y),Fa(f,r,c[x],M,0,0,y)}else Fa(f,r,c[x],p,0,0,y)}function Fa(f,r,c,p,_,y,x){let C=f.context,T=f.transform,M=C.gl,P=T.projection.name==="globe",F=P?["PROJECTION_GLOBE_VIEW"]:[],O=o.by(c.projMatrix);if(P&&o.aj(T.zoom)>0){let Ie=o.bi(c.canonical,T),qe=o.ek(Ie);O=o.aB(new Float32Array(16),T.globeMatrix,qe),o.aB(O,T.projMatrix,O)}let z=o.bB();z[12]+=2*_/(o.o.devicePixelRatio*T.width),z[13]+=2*y/(o.o.devicePixelRatio*T.height),o.aB(O,z,O);let V=f.getOrCreateProgram("debug",{defines:F}),H=r.getTileByID(c.key);f.terrain&&f.terrain.setupElevationDraw(H,V);let K=Vt.disabled,Z=mn.disabled,Q=f.colorModeForRenderPass(),ae="$debug";C.activeTexture.set(M.TEXTURE0),f.emptyTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),P?H._makeGlobeTileDebugBuffers(f.context,T):H._makeDebugTileBoundsBuffers(f.context,T.projection);let re=H._tileDebugBuffer||f.debugBuffer,ge=H._tileDebugIndexBuffer||f.debugIndexBuffer,ce=H._tileDebugSegments||f.debugSegments;if(V.draw(f,M.LINE_STRIP,K,Z,Q,dn.disabled,Gv(O,p.toPremultipliedRenderColor(null)),ae,re,ge,ce,null,null,null,[H._globeTileDebugBorderBuffer]),x){let Ie=H.latestRawTileData,qe=Math.floor((Ie&&Ie.byteLength||0)/1024),je=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(je+=` => ${c.overscaledZ}`),je+=` ${H.state}`,je+=` ${qe}kb`,(function(Ke,_t){Ke.initDebugOverlayCanvas();let Le=Ke.debugOverlayCanvas,Te=Ke.context.gl,Je=Ke.debugOverlayCanvas.getContext("2d");Je.clearRect(0,0,Le.width,Le.height),Je.shadowColor="white",Je.shadowBlur=2,Je.lineWidth=1.5,Je.strokeStyle="white",Je.textBaseline="top",Je.font="bold 36px Open Sans, sans-serif",Je.fillText(_t,5,5),Je.strokeText(_t,5,5),Ke.debugOverlayTexture.update(Le),Ke.debugOverlayTexture.bind(Te.LINEAR,Te.CLAMP_TO_EDGE)})(f,je)}let ve=r.getTile(c).tileSize,me=512/Math.min(ve,512)*(c.overscaledZ/T.zoom)*.5,he=H._tileDebugTextBuffer||f.debugBuffer,xe=H._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,Re=H._tileDebugTextSegments||f.debugSegments;V.draw(f,M.TRIANGLES,K,Z,In.alphaBlended,dn.disabled,Gv(O,o.ao.transparent.toPremultipliedRenderColor(null),me),ae,he,xe,Re,null,null,null,[H._globeTileDebugTextBuffer])}function or(f,r,c,p){Af(f,0,r+c/2,f.transform.width,c,p)}function dm(f,r,c,p){Af(f,r-c/2,0,c,f.transform.height,p)}function Af(f,r,c,p,_,y){let x=f.context,C=x.gl;C.enable(C.SCISSOR_TEST),C.scissor(r*o.o.devicePixelRatio,c*o.o.devicePixelRatio,p*o.o.devicePixelRatio,_*o.o.devicePixelRatio),x.clear({color:y}),C.disable(C.SCISSOR_TEST)}let X1=o.eh([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Y1}=X1;function iu(f,r,c,p){f.emplaceBack(r,c,p)}class sy{constructor(r){this.vertexArray=new o.el,this.indices=new o.b0,iu(this.vertexArray,-1,-1,1),iu(this.vertexArray,1,-1,1),iu(this.vertexArray,-1,1,1),iu(this.vertexArray,1,1,1),iu(this.vertexArray,-1,-1,-1),iu(this.vertexArray,1,-1,-1),iu(this.vertexArray,-1,1,-1),iu(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,Y1),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=o.bf.simpleSegment(0,0,36,12)}}function Tl(f,r,c,p,_,y){let x=f.context.gl,C=r.paint.get("sky-atmosphere-color"),T=r.paint.get("sky-atmosphere-halo-color"),M=r.paint.get("sky-atmosphere-sun-intensity"),P=((F,O,z,V,H)=>({u_matrix_3f:F,u_sun_direction:O,u_sun_intensity:z,u_color_tint_r:[V.r,V.g,V.b,V.a],u_color_tint_m:[H.r,H.g,H.b,H.a],u_luminance:5e-5}))(o.en(o.dN(),p),_,M,C.toPremultipliedRenderColor(null),T.toPremultipliedRenderColor(null));x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_CUBE_MAP_POSITIVE_X+y,r.skyboxTexture,0),c.draw(f,x.TRIANGLES,Vt.disabled,mn.disabled,In.unblended,dn.frontCW,P,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}let vh=o.eh([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class pt{constructor(r){let c=new o.eo;c.emplaceBack(-1,1,1,0,0),c.emplaceBack(1,1,1,1,0),c.emplaceBack(1,-1,1,1,1),c.emplaceBack(-1,-1,1,0,1);let p=new o.b0;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(c,vh.members),this.indexBuffer=r.createIndexBuffer(p),this.segments=o.bf.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let Mt=o.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Pf{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Rr{constructor(r){this.colorModeAlphaBlendedWriteRGB=new In([1,Lr,1,Lr],o.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new In([1,0,1,0],o.ao.transparent,[!1,!1,!1,!0]),this.params=new Pf,this.updateNeeded=!0,r.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),r.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),r.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),r.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(r){let c=r.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new pt(c);let p=this.params.sizeRange,_=this.params.intensityRange,y=(function(P){let F=o.eq(30),O=[];for(let z=0;z<P;++z){let V=2*Math.PI*F(),H=Math.acos(1-2*F())-.5*Math.PI;O.push(o.d4(Math.cos(H)*Math.cos(V),Math.cos(H)*Math.sin(V),Math.sin(H)))}return O})(this.params.starsCount),x=o.eq(300),C=new o.ep,T=new o.b0,M=0;for(let P=0;P<y.length;++P){let F=o.c4([],y[P],200),O=Math.max(0,1+.01*p*(1*x()-.5)),z=Math.max(0,1+.01*_*(1*x()-.5));C.emplaceBack(F[0],F[1],F[2],-1,-1,O,z),C.emplaceBack(F[0],F[1],F[2],1,-1,O,z),C.emplaceBack(F[0],F[1],F[2],1,1,O,z),C.emplaceBack(F[0],F[1],F[2],-1,1,O,z),T.emplaceBack(M+0,M+1,M+2),T.emplaceBack(M+0,M+2,M+3),M+=4}this.starsVx=c.createVertexBuffer(C,Mt.members),this.starsIdx=c.createIndexBuffer(T),this.starsSegments=o.bf.simpleSegment(0,0,C.length,T.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(r,c){let p=r.context,_=p.gl,y=r.transform,x=new Vt(_.LEQUAL,Vt.ReadOnly,[0,1]),C=o.aj(y.zoom),T=r.style.getLut(c.scope),M=c.properties.get("color-use-theme")==="none",P=c.properties.get("color").toNonPremultipliedRenderColor(M?null:T),F=c.properties.get("high-color-use-theme")==="none",O=c.properties.get("high-color").toNonPremultipliedRenderColor(F?null:T),z=c.properties.get("space-color-use-theme")==="none",V=c.properties.get("space-color").toNonPremultipliedRenderColor(z?null:T),H=5e-4,K=o.er(c.properties.get("horizon-blend"),0,1,H,.25),Z=o.dD(r,p,y)&&K===H?y.worldSize/(2*Math.PI*1.025)-1:y.globeRadius,Q=r.frameCounter/1e3%1,ae=o.ag(y.globeCenterInViewSpace),re=Math.sqrt(Math.pow(ae,2)-Math.pow(Z,2)),ge=Math.acos(re/ae),ce=ve=>{let me=y.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ve&&me.push("ALPHA_PASS");let he=r.getOrCreateProgram("globeAtmosphere",{defines:me}),xe=((Ie,qe,je,Ke,_t,Le,Te,Je,Ue,at,bt,jt)=>({u_frustum_tl:Ie,u_frustum_tr:qe,u_frustum_br:je,u_frustum_bl:Ke,u_horizon:_t,u_transition:Le,u_fadeout_range:Te,u_atmosphere_fog_color:Je.toArray01(),u_high_color:Ue.toArray01(),u_space_color:at.toArray01(),u_temporal_offset:bt,u_horizon_angle:jt}))(y.frustumCorners.TL,y.frustumCorners.TR,y.frustumCorners.BR,y.frustumCorners.BL,y.frustumCorners.horizon,C,K,P,O,V,Q,ge);r.uploadCommonUniforms(p,he);let Re=this.atmosphereBuffer;Re&&he.draw(r,_.TRIANGLES,x,mn.disabled,ve?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,dn.backCW,xe,ve?"atmosphere_glow_alpha":"atmosphere_glow",Re.vertexBuffer,Re.indexBuffer,Re.segments)};ce(!1),ce(!0)}drawStars(r,c){let p=o.aA(c.properties.get("star-intensity"),0,1);if(p===0)return;let _=r.context,y=_.gl,x=r.transform,C=r.getOrCreateProgram("stars"),T=o.c6([]);o.c8(T,T,-x._pitch),o.c7(T,T,-x.angle),o.c8(T,T,o.an(x._center.lat)),o.es(T,T,-o.an(x._center.lng));let M=o.cb(new Float32Array(16),T),P=o.aB([],x.starsProjMatrix,M),F=o.en([],M),O=o.et([],F),z=[0,1,0];o.dP(z,z,O),o.c4(z,z,this.params.sizeMultiplier);let V=[1,0,0];o.dP(V,V,O),o.c4(V,V,this.params.sizeMultiplier);let H=(K=z,Z=V,Q=p,{u_matrix:Float32Array.from(P),u_up:K,u_right:Z,u_intensity_multiplier:Q});var K,Z,Q;r.uploadCommonUniforms(_,C),this.starsVx&&this.starsIdx&&C.draw(r,y.TRIANGLES,Vt.disabled,mn.disabled,this.colorModeAlphaBlendedWriteRGB,dn.disabled,H,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class ke{constructor(){this.visibleTiles=[]}updateBorders(r,c){let p=[],_=[],y=r._getRenderableCoordinates(!1,!0);for(let T of y){let M=r.getTile(T);if(!M.hasData())continue;let P=M.getBucket(c);P&&(P.isEmpty()||(p.push(T.key),_.push({bucket:P,tileID:T.canonical})))}let x=p.length!==this.visibleTiles.length;if(!x){p.sort();for(let T=0;T<p.length;T++)if(p[T]!==this.visibleTiles[T]){x=!0;break}}if(!x)return;let C=new Set;this.visibleTiles=p,_.sort((T,M)=>T.tileID.z-M.tileID.z||T.tileID.x-M.tileID.x||T.tileID.y-M.tileID.y);for(let T of _){let M=new Array,P=new Array,F=T.bucket;for(let O of F.featuresOnBorder)C.has(O.featureId)?P.push(O.footprintIndex):(C.add(O.featureId),M.push(O.footprintIndex));F.updateFootprintHiddenFlags(M,o.eu,!1),F.updateFootprintHiddenFlags(P,o.eu,!0)}}}function ay(f,r){let c=[...f],p=r.cameraWorldSizeForFog/r.worldSize,_=o.bz([]);return o.cR(_,_,[p,p,1]),o.aB(c,_,c),o.aB(c,r.worldToFogMatrix,c),c}function Of(f,r,c,p,_){let y=c.material,x=p.context,{baseColorTexture:C,metallicRoughnessTexture:T}=y.pbrMetallicRoughness,{normalTexture:M,occlusionTexture:P,emissionTexture:F}=y;function O(V,H,K){if(V&&(f.push(H),x.activeTexture.set(x.gl.TEXTURE0+K),V.gfxTexture)){let{minFilter:Z,magFilter:Q,wrapS:ae,wrapT:re}=V.sampler;V.gfxTexture.bindExtraParam(Z,Q,ae,re)}}O(C,"HAS_TEXTURE_u_baseColorTexture",bo.BaseColor),O(T,"HAS_TEXTURE_u_metallicRoughnessTexture",bo.MetallicRoughness),O(M,"HAS_TEXTURE_u_normalTexture",bo.Normal),O(P,"HAS_TEXTURE_u_occlusionTexture",bo.Occlusion),O(F,"HAS_TEXTURE_u_emissionTexture",bo.Emission),_&&(_.texture||(_.texture=new o.d_(p.context,_.image,[_.image.height,_.image.height,_.image.height],x.gl.RGBA8)),x.activeTexture.set(x.gl.TEXTURE0+bo.LUT),_.texture&&_.texture.bind(x.gl.LINEAR,x.gl.CLAMP_TO_EDGE),f.push("APPLY_LUT_ON_GPU")),c.texcoordBuffer&&(f.push("HAS_ATTRIBUTE_a_uv_2f"),r.push(c.texcoordBuffer)),c.colorBuffer&&(f.push(c.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),r.push(c.colorBuffer)),c.normalBuffer&&(f.push("HAS_ATTRIBUTE_a_normal_3f"),r.push(c.normalBuffer)),c.pbrBuffer&&(f.push("HAS_ATTRIBUTE_a_pbr"),f.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),r.push(c.pbrBuffer)),y.alphaMode!=="OPAQUE"&&y.alphaMode!=="MASK"||f.push("UNPREMULT_TEXTURE_IN_SHADER"),y.defined||f.push("DIFFUSE_SHADED");let z=p.shadowRenderer;z&&(f.push("RENDER_SHADOWS","DEPTH_TEXTURE"),z.useNormalOffset&&f.push("NORMAL_OFFSET"))}function Rf(f,r,c,p,_,y){let x=c.paint.get("model-opacity").constantOr(1),C=r.context,T=new Vt(r.context.gl.LEQUAL,f.isLightMesh?Vt.ReadOnly:Vt.ReadWrite,r.depthRangeFor3D),M=r.transform,P=f.mesh,F=P.material,O=F.pbrMetallicRoughness,z=r.style.fog,V;V=r.transform.projection.zAxisUnit==="pixels"?[...f.nodeModelMatrix]:o.aB([],p.zScaleMatrix,f.nodeModelMatrix),o.aB(V,p.negCameraPosMatrix,V);let H=o.bk([],V);o.ef(H,H);let K=c.paint.get("model-color-use-theme").constantOr("default")==="none",Z=c.paint.get("model-emissive-strength").constantOr(0),Q=e_(new Float32Array(f.worldViewProjection),new Float32Array(V),new Float32Array(H),null,r,x,O.baseColorFactor,F.emissiveFactor,O.metallicFactor,O.roughnessFactor,F,Z,c,void 0,void 0,f.materialOverride,f.modelColor),ae={defines:[]},re=[],ge=r.shadowRenderer;ge&&(ge.useNormalOffset=!1),Of(ae.defines,re,P,r,K?null:c.lut);let ce=null;if(z){let he=ay(f.nodeModelMatrix,r.transform);if(ce=new Float32Array(he),M.projection.name!=="globe"){let xe=P.aabb.min,Re=P.aabb.max,[Ie,qe]=z.getOpacityForBounds(he,xe[0],xe[1],Re[0],Re[1]);ae.overrideFog=Ie>=Ve||qe>=Ve}}let ve=ql(r,c.paint.get("model-cutoff-fade-range"));ve.shouldRenderCutoff&&ae.defines.push("RENDER_CUTOFF");let me=r.getOrCreateProgram("model",ae);r.uploadCommonUniforms(C,me,null,ce,ve),r.renderPass!=="shadow"&&ge&&ge.setupShadowsFromMatrix(f.nodeModelMatrix,me),me.draw(r,C.gl.TRIANGLES,T,_,y,P.material.doubleSided?dn.disabled:dn.backCCW,Q,c.id,P.vertexBuffer,P.indexBuffer,P.segments,c.paint,r.transform.zoom,void 0,re)}function l_(f,r,c){return f.type==="vector"?r.scope:c?"basemap":""}function c_(f,r,c,p,_,y,x,C,T){let M=f.transform,P=!!r.isGeometryBloom&&r.isGeometryBloom;if(P&&f.renderPass==="shadow")return;let F=M.projection.name==="globe"?o.eC(c,M):[...c];o.aB(F,F,r.globalMatrix);let O=o.aB([],p,F);if(r.meshes)for(let z of r.meshes){let V=C.get(z.material.name);if(V&&V.opacity<=0)continue;if(z.material.alphaMode!=="BLEND"){x.push({mesh:z,depth:0,modelIndex:_,worldViewProjection:O,nodeModelMatrix:F,isLightMesh:P,materialOverride:V,modelColor:T});continue}let H=o.af([],z.centroid,O);!M.isOrthographic&&H[2]<=0||y.push({mesh:z,depth:H[2],modelIndex:_,worldViewProjection:O,nodeModelMatrix:F,isLightMesh:P,materialOverride:V,modelColor:T})}if(r.children)for(let z of r.children)c_(f,z,c,p,_,y,x,C,T)}function kf(f,r,c,p){let _=c.shadowRenderer;if(!_)return;let y=_.getShadowPassDepthMode(),x=_.getShadowPassColorMode(),C=_.calculateShadowPassMatrixFromMatrix(r),T=If(C);c.getOrCreateProgram("modelDepth",{defines:c._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(c,c.context.gl.TRIANGLES,y,mn.disabled,x,dn.disabled,T,p.id,f.vertexBuffer,f.indexBuffer,f.segments,p.paint,c.transform.zoom,void 0,void 0)}function Ff(f,r,c,p,_,y){for(let x of _){let C=Object.assign({},p);C.part=x;let T={type:"Unknown",id:r,properties:C},M={orientation:f.paint.get("model-rotation").evaluate(T,c)};y.set(x,M)}}function VD(f,r,c,p,_,y){for(let x of _){let C=Object.assign({},p);C.part=x;let T={type:"Unknown",id:r,properties:C},M={color:f.paint.get("model-color").evaluate(T,c),colorMix:f.paint.get("model-color-mix-intensity").evaluate(T,c),opacity:f.paint.get("model-opacity").evaluate(T,c),emissionStrength:f.paint.get("model-emissive-strength").evaluate(T,c)};y.set(x,M)}}function K1(f,r,c,p,_,y){if(c===1)for(let C of _)Rf(C,f,r,y[C.modelIndex],mn.disabled,f.colorModeForRenderPass());else{for(let C of _)Rf(C,f,r,y[C.modelIndex],mn.disabled,In.disabled);for(let C of _)Rf(C,f,r,y[C.modelIndex],f.stencilModeFor3D(),f.colorModeForRenderPass());f.resetStencilClippingMasks()}let x=In.additive;for(let C of p)Rf(C,f,r,y[C.modelIndex],mn.disabled,C.isLightMesh?x:f.colorModeForRenderPass())}function J1(f,r,c){let p=r.updateZoomBasedPaintProperties(),_=(function(y,x,C){let T,M,P,F=y.terrain?y.terrain.exaggeration():0;if(y.terrain&&F>0){let O=y.terrain,z=O.findDEMTileFor(C);z&&z.dem?T=o.eE.create(O,C,z):F=0}if(F===0&&(x.terrainElevationMin=0,x.terrainElevationMax=0),F===x.validForExaggeration&&(F===0||T&&T._demTile&&T._demTile.tileID===x.validForDEMTile.id&&T._dem._timestamp===x.validForDEMTile.timestamp))return!1;for(let O in x.instancesPerModel){let z=x.instancesPerModel[O];for(let V=0;V<z.instancedDataArray.length;++V){let H=(T?F*T.getElevationAt(0|z.instancedDataArray.float32[16*V],0|z.instancedDataArray.float32[16*V+1],!0,!0):0)+z.instancesEvaluatedElevation[V];z.instancedDataArray.float32[16*V+6]=H,M=M?Math.min(x.terrainElevationMin,H):H,P=P?Math.max(x.terrainElevationMax,H):H}}return x.terrainElevationMin=M||0,x.terrainElevationMax=P||0,x.validForExaggeration=F,x.validForDEMTile=T&&T._demTile?{id:T._demTile.tileID,timestamp:T._dem._timestamp}:{id:void 0,timestamp:0},!0})(f,r,c);(p||_)&&(r.uploaded=!1,r.upload(f.context))}let Ja={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new o.d8([0,0,0],[o.al,o.al,0])};function ly(f,r){let c=1<<f.canonical.z,p=r.getFreeCameraOptions().position,_=r.elevation,y=f.canonical.x/c,x=(f.canonical.x+1)/c,C=f.canonical.y/c,T=(f.canonical.y+1)/c,M=r._centerAltitude;if(_){let z=_.getMinMaxForTile(f);z&&z.max>M&&(M=z.max)}let P=o.aA(p.x,y,x)-p.x,F=o.aA(p.y,C,T)-p.y,O=o.ce(M,r.center.lat)-p.z;return r._zoomFromMercatorZ(Math.sqrt(P*P+F*F+O*O))}function cy(f,r,c,p,_,y,x){let C=f.context,T=f.renderPass==="shadow",M=f.shadowRenderer,P=T&&M?M.getShadowPassDepthMode():new Vt(C.gl.LEQUAL,Vt.ReadWrite,f.depthRangeFor3D),F=f.isTileAffectedByFog(y),O=f.transform.projection.name==="globe";if(c.meshes)for(let z of c.meshes){let V=O?[]:["MODEL_POSITION_ON_GPU"],H=[],K,Z,Q,ae=!O&&p.instancedDataArray.length>20;ae&&V.push("INSTANCED_ARRAYS");let re=ql(f,r.paint.get("model-cutoff-fade-range"));if(re.shouldRenderCutoff&&V.push("RENDER_CUTOFF"),T&&M)K=f.getOrCreateProgram("modelDepth",{defines:V}),Z=If(x.shadowTileMatrix,x.shadowTileMatrix,Float32Array.from(c.globalMatrix)),Q=M.getShadowPassColorMode();else{Of(V,H,z,f,r.paint.get("model-color-use-theme").constantOr("default")==="none"?null:r.lut),K=f.getOrCreateProgram("model",{defines:V,overrideFog:F});let ce=z.material,ve=ce.pbrMetallicRoughness,me=r.paint.get("model-opacity").constantOr(1),he=r.paint.get("model-emissive-strength").constantOr(0);Z=e_(y.expandedProjMatrix,Float32Array.from(c.globalMatrix),new Float32Array(16),null,f,me,ve.baseColorFactor,ce.emissiveFactor,ve.metallicFactor,ve.roughnessFactor,ce,he,r,_),M&&(x.shadowUniformsInitialized?K.setShadowUniformValues(C,M.getShadowUniformValues()):(M.setupShadows(y.toUnwrapped(),K,"model-tile"),x.shadowUniformsInitialized=!0)),Q=re.shouldRenderCutoff||me<1||ce.alphaMode!=="OPAQUE"?In.alphaBlended:In.unblended}f.uploadCommonUniforms(C,K,y.toUnwrapped(),null,re);let ge=z.material.doubleSided?dn.disabled:dn.backCCW;if(ae)H.push(p.instancedDataBuffer),K.draw(f,C.gl.TRIANGLES,P,mn.disabled,Q,ge,Z,r.id,z.vertexBuffer,z.indexBuffer,z.segments,r.paint,f.transform.zoom,void 0,H,p.instancedDataArray.length);else{let ce=T?"u_instance":"u_normal_matrix";for(let ve=0;ve<p.instancedDataArray.length;++ve)Z[ce]=new Float32Array(p.instancedDataArray.arrayBuffer,64*ve,16),K.draw(f,C.gl.TRIANGLES,P,mn.disabled,Q,ge,Z,r.id,z.vertexBuffer,z.indexBuffer,z.segments,r.paint,f.transform.zoom,void 0,H)}}if(c.children)for(let z of c.children)cy(f,r,z,p,_,y,x)}let Q1=[1,-1,1];function u_(f,r,c,p){if(!c.modelManager)return!0;let _=c.modelManager;if(!c.shadowRenderer)return!0;let y=c.shadowRenderer,x=r.aabb,C=!0,T=f.maxHeight;if(T===0){let P=0;for(let F in f.instancesPerModel){let O=_.getModel(F,p);O?P=Math.max(P,Math.max(Math.max(O.aabb.max[0],O.aabb.max[1]),O.aabb.max[2])):C=!1}T=f.maxScale*P*1.41+f.maxVerticalOffset,C&&(f.maxHeight=T)}x.max[2]=T,x.min[2]+=f.terrainElevationMin,x.max[2]+=f.terrainElevationMax,o.af(x.min,x.min,r.tileMatrix),o.af(x.max,x.max,r.tileMatrix);let M=x.intersects(y.getCurrentCascadeFrustum());return c.currentShadowCascade===0&&(f.isInsideFirstShadowMapFrustum=M===2),M===0}function hm(f,r){let c=f.uniformValues.u_cutoff_params[0],p=f.uniformValues.u_cutoff_params[1],_=f.uniformValues.u_cutoff_params[2],y=f.uniformValues.u_cutoff_params[3];return p===c||y===_?1:o.aA(((r-c)/(p-c)-_)/(y-_),0,1)}function yh(f,r,c,p){if(r.pitch<20)return 1;let _=r.getWorldToCameraMatrix();o.aB(_,_,f);let y=o.bT(c.min[0],c.min[1],c.min[2],1),x=o.aC(o.eF(),y,_),C=x,T=x;y[1]=c.max[1],x=o.aC(o.eF(),y,_),C=x[1]<C[1]?x:C,T=x[1]>T[1]?x:T,y[0]=c.max[0],x=o.aC(o.eF(),y,_),C=x[1]<C[1]?x:C,T=x[1]>T[1]?x:T,y[1]=c.min[1],x=o.aC(o.eF(),y,_),C=x[1]<C[1]?x:C,T=x[1]>T[1]?x:T;let M=o.aA(p[0],0,1),P=100*r.pixelsPerMeter*o.aA(p[1],0,1),F=o.aA(p[2],0,1),O=o.eG(o.eF(),C,T,M),z=Math.tan(.5*r.fovX),V=-O[2]*z;if(P===0)return O[1]<-Math.abs(V)?F:1;let H=(-Math.abs(V)-O[1])/P,K=(Q,ae,re)=>(1-re)*Q+re*ae,Z=o.aA(K(1,F,H),F,1);return K(1,Z,o.aA((r.pitch-20)/20,0,1))}class ew{}class tw{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(r,c,p){{let F=this._storage.get(c.id);if(F)return F.lastUsedFrameIdx=r,F.buf}let _=p.gl,y=_.getBufferParameter(_.ELEMENT_ARRAY_BUFFER,_.BUFFER_SIZE),x=new ArrayBuffer(y),C=new Int16Array(x);_.getBufferSubData(_.ELEMENT_ARRAY_BUFFER,0,new Int16Array(x));let T=new o.eI;for(let F=0;F<y/2;F+=3){let O=C[F],z=C[F+1],V=C[F+2];T.emplaceBack(O,z),T.emplaceBack(z,V),T.emplaceBack(V,O)}let M=p.bindVertexArrayOES.current,P=new ew;return P.buf=new H1(p,T),P.lastUsedFrameIdx=r,this._storage.set(c.id,P),p.bindVertexArrayOES.set(M),P.buf}update(r){for(let[c,p]of this._storage)r-p.lastUsedFrameIdx>30&&(p.buf.destroy(),this._storage.delete(c))}destroy(){for(let[r,c]of this._storage)c.buf.destroy(),this._storage.delete(r)}}class UD{constructor(r){this.occluderSize=30,this.depthOffset=-1e-4,r.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),r.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}let nw=o.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class HD{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Vs{constructor(r,c){this.revealStart=11,this.revealRange=2,r.registerParameter(this,[...c,"Reveal"],"revealStart",{min:0,max:17,step:.05}),r.registerParameter(this,[...c,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}let $D=o.eh([{type:"Float32",name:"a_pos_2f",components:2}]);class fm{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(r,c){let p=r.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){let x=new o.eJ,C=new o.b0;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(1,1),x.emplaceBack(-1,1),C.emplaceBack(0,1,2),C.emplaceBack(0,2,3),this.vignetteVx=r.context.createVertexBuffer(x,$D.members),this.vignetteIdx=r.context.createIndexBuffer(C)}let _=o.bf.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){r.uploadCommonUniforms(r.context,p);let x={u_vignetteShape:(y={vignetteShape:[c.start,c.range,Math.pow(10,c.fadePower)],vignetteColor:[c.color.r,c.color.g,c.color.b,c.color.a*c.strength]}).vignetteShape,u_vignetteColor:y.vignetteColor};p.draw(r,r.context.gl.TRIANGLES,Vt.disabled,mn.disabled,In.alphaBlended,dn.disabled,x,"vignette",this.vignetteVx,this.vignetteIdx,_)}var y}}class ur{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(r,c){let p=r.getFreeCameraOptions().position,_=p.toAltitude(),y=p.toLngLat(),x=o.an(y.lng),C=o.an(y.lat),T=r.pixelsPerMeter/c,M=x*o.eL,P=o.eL*Math.log(Math.tan(Math.PI/4+C/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{let F=-this._offsetYPrev+P,O=-this._elevationPrev+_;this._accumulatedOffsetX+=(-this._offsetXPrev+M)*T,this._accumulatedOffsetY+=F*T,this._accumulatedElevation+=O*T,this._offsetXPrev=M,this._offsetYPrev=P,this._elevationPrev=_}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Bn(f,r){return[-(f[0]-Math.floor(f[0]/r)*r),-(f[1]-Math.floor(f[1]/r)*r),-(f[2]-Math.floor(f[2]/r)*r)]}function uy(f){let r=o.eq(1323123451230),c=[];for(let p=0;p<f;++p){let _=2*r()-1,y=2*r()-1,x=2*r()-1;c.push(o.d4(_,y,x))}return c}function _a(f,r,c,p,_){let y=o.aA((_-c)/(p-c),0,1);return(1-y)*f+y*r}class xh{constructor(r){this._movement=new ur,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new fm,this._ppmScaleFactor=r}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(r,c){let p=r.transform;this._movement.update(p,this._ppmScaleFactor);let _=p.starsProjMatrix,y=o.c6([]);o.c8(y,y,o.an(90)-p._pitch),o.c7(y,y,-p.angle);let x=o.cb(new Float32Array(16),y),C=o.eK(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),T=o.ef([],C),M=o.aB([],T,x),P=Date.now()/1e3;return this._accumulatedTimeFromStart+=(P-this._prevTime)*c,this._prevTime=P,{projectionMatrix:_,modelviewMatrix:M}}}class Lf extends xh{constructor(r){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Vs(r.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(r){let c=r.context;if(!this.particlesVx){let p=uy(this.particlesCount),_=new o.eM,y=new o.b0,x=0,C=o.eq(1323123451230);for(let T=0;T<p.length;++T){let M=p[T],P=[2*C()-1,C(),C(),C()];_.emplaceBack(M[0],M[1],M[2],-1,-1,...P),_.emplaceBack(M[0],M[1],M[2],1,-1,...P),_.emplaceBack(M[0],M[1],M[2],1,1,...P),_.emplaceBack(M[0],M[1],M[2],-1,1,...P),y.emplaceBack(x+0,x+1,x+2),y.emplaceBack(x+0,x+2,x+3),x+=4}this.particlesVx=c.createVertexBuffer(_,nw.members),this.particlesIdx=c.createIndexBuffer(y)}}draw(r){if(!this._params.overrideStyleParameters&&!r.style.rain)return;let c=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},p=r.transform.zoom;if(c.revealStart>p)return;let _=_a(0,1,c.revealStart,c.revealStart+c.revealRange,p);if(!this.particlesVx||!this.particlesIdx)return;let y=structuredClone(this._params),x=[-y.direction.x,y.direction.y,-100];o.aw(x,x);let C=structuredClone(this._vignetteParams);C.strength*=_,y.overrideStyleParameters||(y.intensity=r.style.rain.state.density,y.timeFactor=r.style.rain.state.intensity,y.color=structuredClone(r.style.rain.state.color),x=structuredClone(r.style.rain.state.direction),y.screenThinning.intensity=r.style.rain.state.centerThinning,y.dropletSizeX=r.style.rain.state.dropletSize[0],y.dropletSizeYScale=r.style.rain.state.dropletSize[1]/r.style.rain.state.dropletSize[0],y.distortionStrength=100*r.style.rain.state.distortionStrength,C.strength=1,C.color=structuredClone(r.style.rain.state.vignetteColor));let T=this.updateOnRender(r,y.timeFactor),M=r.context,P=M.gl,F=r.transform;this.screenTexture&&this.screenTexture.size[0]===r.width&&this.screenTexture.size[1]===r.height||(this.screenTexture=new o.T(M,{width:r.width,height:r.height,data:null},P.RGBA8)),y.distortionStrength>0&&(M.activeTexture.set(P.TEXTURE0),this.screenTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),P.copyTexSubImage2D(P.TEXTURE_2D,0,0,0,0,0,r.width,r.height));let O=r.getOrCreateProgram("rainParticle");r.uploadCommonUniforms(M,O),M.activeTexture.set(P.TEXTURE0),this.screenTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE);let z=[y.color.r,y.color.g,y.color.b,y.color.a],V=(H,K)=>{let Z=Bn(this._movement.getPosition(),H),Q=y.dropletSizeX,ae=y.dropletSizeX*y.dropletSizeYScale,re=r.width/2,ge=r.height/2,ce=_a(0,y.screenThinning.start,0,1,y.screenThinning.intensity),ve=_a(.001,y.screenThinning.range,0,1,y.screenThinning.intensity),me=_a(0,y.screenThinning.particleOffset,0,1,y.screenThinning.intensity),he=(xe={modelview:T.modelviewMatrix,projection:T.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:Z,velocityConeAperture:y.velocityConeAperture,velocity:y.velocity,boxSize:H,rainDropletSize:[Q,ae],distortionStrength:y.distortionStrength,rainDirection:x,color:z,screenSize:[F.width,F.height],thinningCenterPos:[re,ge],thinningShape:[ce,ve,Math.pow(10,y.screenThinning.fadePower)],thinningAffectedRatio:y.screenThinning.affectedRatio,thinningParticleOffset:me,shapeDirectionalPower:y.shapeDirPower,shapeNormalPower:y.shapeNormalPower,mode:K?0:1},{u_modelview:Float32Array.from(xe.modelview),u_projection:Float32Array.from(xe.projection),u_time:xe.time,u_cam_pos:xe.camPos,u_texScreen:0,u_velocityConeAperture:xe.velocityConeAperture,u_velocity:xe.velocity,u_boxSize:xe.boxSize,u_rainDropletSize:xe.rainDropletSize,u_distortionStrength:xe.distortionStrength,u_rainDirection:xe.rainDirection,u_color:xe.color,u_screenSize:xe.screenSize,u_thinningCenterPos:xe.thinningCenterPos,u_thinningShape:xe.thinningShape,u_thinningAffectedRatio:xe.thinningAffectedRatio,u_thinningParticleOffset:xe.thinningParticleOffset,u_shapeDirectionalPower:xe.shapeDirectionalPower,u_shapeNormalPower:xe.shapeNormalPower,u_mode:xe.mode});var xe;let Re=Math.round(y.intensity*this.particlesCount),Ie=o.bf.simpleSegment(0,0,4*Re,2*Re);O.draw(r,P.TRIANGLES,Vt.disabled,mn.disabled,In.alphaBlended,dn.disabled,he,"rain_particles",this.particlesVx,this.particlesIdx,Ie)};y.distortionStrength>0&&V(y.boxSize,!0),V(y.boxSize,!1),this._vignette.draw(r,C)}}let ru=o.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class dy extends xh{constructor(r){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Vs(r.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(r){let c=r.context;if(!this.particlesVx){let p=uy(this.particlesCount),_=new o.eN,y=new o.b0,x=0,C=o.eq(1323123451230);for(let T=0;T<p.length;++T){let M=p[T],P=C(),F=C(),O=C(),z=[T/p.length,P,F,O],V=[C(),C()];_.emplaceBack(M[0],M[1],M[2],-1,-1,...z,...V),_.emplaceBack(M[0],M[1],M[2],1,-1,...z,...V),_.emplaceBack(M[0],M[1],M[2],1,1,...z,...V),_.emplaceBack(M[0],M[1],M[2],-1,1,...z,...V),y.emplaceBack(x+0,x+1,x+2),y.emplaceBack(x+0,x+2,x+3),x+=4}this.particlesVx=c.createVertexBuffer(_,ru.members),this.particlesIdx=c.createIndexBuffer(y)}}draw(r){if(!this._params.overrideStyleParameters&&!r.style.snow)return;let c=structuredClone(this._params),p=[-c.direction.x,c.direction.y,-100];o.aw(p,p);let _=structuredClone(this._vignetteParams),y=c.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},x=r.transform.zoom;if(y.revealStart>x)return;let C=_a(0,1,y.revealStart,y.revealStart+y.revealRange,x);_.strength*=C,c.overrideStyleParameters||(c.intensity=r.style.snow.state.density,c.timeFactor=r.style.snow.state.intensity,c.color=structuredClone(r.style.snow.state.color),p=structuredClone(r.style.snow.state.direction),c.screenThinning.intensity=r.style.snow.state.centerThinning,c.billboardSize=2.79*r.style.snow.state.flakeSize,_.strength=1,_.color=structuredClone(r.style.snow.state.vignetteColor));let T=this.updateOnRender(r,c.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;let M=r.context,P=M.gl,F=r.transform,O=r.getOrCreateProgram("snowParticle");r.uploadCommonUniforms(M,O),((z,V,H)=>{let K=Bn(this._movement.getPosition(),z),Z=F.width/2,Q=F.height/2,ae=_a(0,H.screenThinning.start,0,1,H.screenThinning.intensity),re=_a(.001,H.screenThinning.range,0,1,H.screenThinning.intensity),ge=_a(0,H.screenThinning.particleOffset,0,1,H.screenThinning.intensity),ce=(ve={modelview:T.modelviewMatrix,projection:T.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:K,velocityConeAperture:H.velocityConeAperture,velocity:H.velocity,horizontalOscillationRadius:H.horizontalOscillationRadius,horizontalOscillationRate:H.horizontalOscillationRate,boxSize:z,billboardSize:1*H.billboardSize,simpleShapeParameters:[H.shapeFadeStart,H.shapeFadePower],screenSize:[F.width,F.height],thinningCenterPos:[Z,Q],thinningShape:[ae,re,Math.pow(10,H.screenThinning.fadePower)],thinningAffectedRatio:H.screenThinning.affectedRatio,thinningParticleOffset:ge,color:[H.color.r,H.color.g,H.color.b,H.color.a],direction:p},{u_modelview:Float32Array.from(ve.modelview),u_projection:Float32Array.from(ve.projection),u_time:ve.time,u_cam_pos:ve.camPos,u_velocityConeAperture:ve.velocityConeAperture,u_velocity:ve.velocity,u_horizontalOscillationRadius:ve.horizontalOscillationRadius,u_horizontalOscillationRate:ve.horizontalOscillationRate,u_boxSize:ve.boxSize,u_billboardSize:ve.billboardSize,u_simpleShapeParameters:ve.simpleShapeParameters,u_screenSize:ve.screenSize,u_thinningCenterPos:ve.thinningCenterPos,u_thinningShape:ve.thinningShape,u_thinningAffectedRatio:ve.thinningAffectedRatio,u_thinningParticleOffset:ve.thinningParticleOffset,u_particleColor:ve.color,u_direction:ve.direction});var ve;let me=Math.round(H.intensity*this.particlesCount),he=o.bf.simpleSegment(0,0,4*me,2*me);this.particlesVx&&this.particlesIdx&&O.draw(r,P.TRIANGLES,Vt.disabled,mn.disabled,In.alphaBlended,dn.disabled,ce,"snow_particles",this.particlesVx,this.particlesIdx,he)})(c.boxSize,0,c),this._vignette.draw(r,_)}}let hy={symbol:function(f,r,c,p,_){if(f.renderPass!=="translucent")return;let y=mn.disabled,x=f.colorModeForRenderPass(),C=c.layout.get("text-variable-anchor"),T=c.layout.get("text-size-scale-range"),M=o.aA(f.scaleFactor,T[0],T[1]);C&&(function(O,z,V,H,K,Z,Q,ae){let re=z.transform,ge=K==="map",ce=Z==="map";for(let ve of O){let me=H.getTile(ve),he=me.getBucket(V);if(!he||!he.text||!he.text.segments.get().length)continue;let xe=o.bJ(he.textSizeData,re.zoom,ae),Re=hf(ve,he.getProjection(),re),Ie=re.calculatePixelsToTileUnitsMatrix(me),qe=Vu(Re,me.tileID.canonical,ce,ge,re,he.getProjection(),Ie),je=he.hasIconTextFit()&&he.hasIconData();xe&&r_(he,ge,ce,Q,re,qe,ve,Math.pow(2,re.zoom-me.tileID.overscaledZ),xe,je)}})(p,f,c,r,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),_,M);let P=c.paint.get("icon-opacity").constantOr(1)!==0,F=c.paint.get("text-opacity").constantOr(1)!==0;c.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(P||F)?um(f,r,c,p,y,x):(P&&um(f,r,c,p,y,x,{onlyIcons:!0}),F&&um(f,r,c,p,y,x,{onlyText:!0})),r.map.showCollisionBoxes&&(cm(f,r,c,p,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),cm(f,r,c,p,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(f,r,c,p){if(f.renderPass!=="translucent")return;let _=c.paint.get("circle-opacity"),y=c.paint.get("circle-stroke-width"),x=c.paint.get("circle-stroke-opacity"),C=c.layout.get("circle-sort-key").constantOr(1)!==void 0,T=c.paint.get("circle-emissive-strength");if(_.constantOr(1)===0&&(y.constantOr(1)===0||x.constantOr(1)===0))return;let M=f.context,P=M.gl,F=f.transform,O=!(!f.terrain||!f.terrain.enabled),z=c.layout.get("circle-elevation-reference"),V=f.depthModeForSublayer(0,Vt.ReadOnly),H=new Vt(f.context.gl.LEQUAL,Vt.ReadOnly,f.depthRangeFor3D),K=z==="none"||O?V:H,Z=mn.disabled,Q=f.colorModeForDrapableLayerRenderPass(T),ae=F.projection.name==="globe",re=[o.aF(F.center.lng),o.aJ(F.center.lat)],ge=[];for(let ve=0;ve<p.length;ve++){let me=p[ve],he=r.getTile(me),xe=he.getBucket(c);if(!xe||xe.projection.name!==F.projection.name)continue;let Re=xe.programConfigurations.get(c.id),Ie=xe.layoutVertexBuffer,qe=xe.globeExtVertexBuffer,je=xe.indexBuffer,Ke=o.d$(c),_t=[qe],Le=f.isTileAffectedByFog(me);ae&&Ke.push("PROJECTION_GLOBE_VIEW"),Ke.push("DEPTH_D24"),f.terrain&&F.depthOcclusionForSymbolsAndCircles&&Ke.push("DEPTH_OCCLUSION"),xe.hasElevation&&!f.terrain&&(Ke.push("ELEVATED_ROADS"),_t.push(xe.elevatedLayoutVertexBuffer));let Te=f.getOrCreateProgram("circle",{config:Re,defines:Ke,overrideFog:Le}),Je=F.projection.createInversionMatrix(F,me.canonical),Ue={programConfiguration:Re,program:Te,layoutVertexBuffer:Ie,dynamicBuffers:_t,indexBuffer:je,uniformValues:o.e0(f,me,he,Je,re,c),tile:he};if(C){let at=xe.segments.get();for(let bt of at)ge.push({segments:new o.bf([bt]),sortKey:bt.sortKey,state:Ue})}else ge.push({segments:xe.segments,sortKey:0,state:Ue})}C&&ge.sort((ve,me)=>ve.sortKey-me.sortKey);let ce={useDepthForOcclusion:F.depthOcclusionForSymbolsAndCircles};for(let ve of ge){let{programConfiguration:me,program:he,layoutVertexBuffer:xe,dynamicBuffers:Re,indexBuffer:Ie,uniformValues:qe,tile:je}=ve.state,Ke=ve.segments;f.terrain&&f.terrain.setupElevationDraw(je,he,ce),f.uploadCommonUniforms(M,he,je.tileID.toUnwrapped()),he.draw(f,P.TRIANGLES,K,Z,Q,dn.disabled,qe,c.id,xe,Ie,Ke,c.paint,F.zoom,me,Re)}},heatmap:function(f,r,c,p){if(c.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){let _=f.context,y=_.gl,x=mn.disabled,C=new In([y.ONE,y.ONE,y.ONE,y.ONE],o.ao.transparent,[!0,!0,!0,!0]);(function(z,V,H,K){let Z=z.gl,Q=V.width*K,ae=V.height*K;z.activeTexture.set(Z.TEXTURE1),z.viewport.set([0,0,Q,ae]);let re=H.heatmapFbo;if(!re||re&&(re.width!==Q||re.height!==ae)){re&&re.destroy();let ge=Z.createTexture();Z.bindTexture(Z.TEXTURE_2D,ge),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MIN_FILTER,Z.LINEAR),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MAG_FILTER,Z.LINEAR),re=H.heatmapFbo=z.createFramebuffer(Q,ae,!0,null),(function(ce,ve,me,he,xe,Re){let Ie=ce.gl;Ie.texImage2D(Ie.TEXTURE_2D,0,ce.extRenderToTextureHalfFloat?Ie.RGBA16F:Ie.RGBA,xe,Re,0,Ie.RGBA,ce.extRenderToTextureHalfFloat?Ie.HALF_FLOAT:Ie.UNSIGNED_BYTE,null),he.colorAttachment.set(me)})(z,0,ge,re,Q,ae)}else Z.bindTexture(Z.TEXTURE_2D,re.colorAttachment.get()),z.bindFramebuffer.set(re.framebuffer)})(_,f,c,f.transform.projection.name==="globe"?.5:.25),_.clear({color:o.ao.transparent});let T=f.transform,M=T.projection.name==="globe",P=M?["PROJECTION_GLOBE_VIEW"]:[],F=M?dn.frontCCW:dn.disabled,O=[o.aF(T.center.lng),o.aJ(T.center.lat)];for(let z=0;z<p.length;z++){let V=p[z];if(r.hasRenderableParent(V))continue;let H=r.getTile(V),K=H.getBucket(c);if(!K||K.projection.name!==T.projection.name)continue;let Z=f.isTileAffectedByFog(V),Q=K.programConfigurations.get(c.id),ae=f.getOrCreateProgram("heatmap",{config:Q,defines:P,overrideFog:Z}),{zoom:re}=f.transform;f.terrain&&f.terrain.setupElevationDraw(H,ae),f.uploadCommonUniforms(_,ae,V.toUnwrapped());let ge=T.projection.createInversionMatrix(T,V.canonical);ae.draw(f,y.TRIANGLES,Vt.disabled,x,C,F,U1(f,V,H,ge,O,re,c.paint.get("heatmap-intensity")),c.id,K.layoutVertexBuffer,K.indexBuffer,K.segments,c.paint,f.transform.zoom,Q,M?[K.globeExtVertexBuffer]:null)}_.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),(function(_,y){let x=_.context,C=x.gl,T=y.heatmapFbo;if(!T)return;x.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,T.colorAttachment.get()),x.activeTexture.set(C.TEXTURE1);let M=y.colorRampTexture;M||(M=y.colorRampTexture=new o.T(x,y.colorRamp,C.RGBA8)),M.bind(C.LINEAR,C.CLAMP_TO_EDGE),_.getOrCreateProgram("heatmapTexture").draw(_,C.TRIANGLES,Vt.disabled,mn.disabled,_.colorModeForRenderPass(),dn.disabled,((P,F,O,z)=>({u_image:0,u_color_ramp:1,u_opacity:F.paint.get("heatmap-opacity")}))(0,y),y.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,y.paint,_.transform.zoom)})(f,c))},line:function(f,r,c,p){if(f.renderPass!=="translucent")return;let _=c.paint.get("line-opacity"),y=c.paint.get("line-width");if(_.constantOr(1)===0||y.constantOr(1)===0)return;let x=c.paint.get("line-emissive-strength"),C=c.paint.get("line-occlusion-opacity"),T=c.layout.get("line-elevation-reference"),M=c.layout.get("line-width-unit")==="meters",P=T==="sea",F=!(!f.terrain||!f.terrain.enabled),O=f.context,z=O.gl;if(c.hasElevatedBuckets&&f.transform.projection.name==="globe")return;let V=c.layout.get("line-cross-slope"),H=V!==void 0,K=V<1,Z=f.colorModeForDrapableLayerRenderPass(x),Q=f.terrain&&f.terrain.renderingToTexture,ae=Q?1:o.o.devicePixelRatio,re=c.paint.get("line-dasharray"),ge=re.constantOr(1),ce=c.layout.get("line-cap"),ve=re.constantOr(null),me=ce.constantOr(null),he=c.paint.get("line-pattern"),xe=he.constantOr(1),Re=c.paint.get("line-pattern-cross-fade"),Ie=he.constantOr(null),qe=c.paint.get("line-opacity").constantOr(1),je=!xe&&qe!==1||f.depthOcclusion&&C>0&&C<1,Ke=c.paint.get("line-gradient"),_t=xe?"linePattern":"line",Le=o.e1(c),Te;if(Q&&f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(je=!1),C!==0&&f.depthOcclusion){let bt=c.paint._values["line-opacity"];bt&&bt.value&&bt.value.kind==="constant"?Te=bt.value:o.w(`Occlusion opacity for layer ${c.id} is supported only when line-opacity isn't data-driven.`)}y.value.kind!=="constant"&&y.value.isLineProgressConstant===!1&&Le.push("VARIABLE_LINE_WIDTH");let Je=(bt,jt,mt,xt,$t,Ft)=>{for(let At of bt){let Lt=r.getTile(At);if(xe&&!Lt.patternsLoaded())continue;let sn=Lt.getBucket(c);if(!sn||sn.elevationType!=="none"&&!$t||sn.elevationType==="none"&&$t)continue;f.prepareDrawTile();let jn=[...jt],ei=f.shadowRenderer,Ni=sn.elevationType==="road"&&!!ei&&ei.enabled,pn=[0,0,0];if(Ni){let vn=f.style.directionalLight,ii=f.style.ambientLight;vn&&ii&&(pn=Oa(f.style,vn,ii)),jn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}let Kn=sn.programConfigurations.get(c.id),Mn=!1;if(Ie&&Lt.imageAtlas){let vn=o.e2.from(Ie),ii=vn.getPrimary().scaleSelf(ae).toString(),yr=Lt.imageAtlas.patternPositions.get(ii),Gr=vn.getSecondary(),Cr=Gr?Lt.imageAtlas.patternPositions.get(Gr.scaleSelf(ae).toString()):null;Mn=!!yr&&!!Cr,yr&&Kn.setConstantPatternPositions(yr,Cr)}Re>0&&(Mn||Kn.getPatternTransitionVertexBuffer("line-pattern"))&&jn.push("LINE_PATTERN_TRANSITION");let Ii=f.isTileAffectedByFog(At),ti=f.getOrCreateProgram(_t,{config:Kn,defines:jn,overrideFog:Ii});if(!xe&&ve&&me&&Lt.lineAtlas){let vn=Lt.lineAtlas.getDash(ve,me);vn&&Kn.setConstantPatternPositions(vn)}Ni&&ei.setupShadows(Lt.tileID.toUnwrapped(),ti,"vector-tile");let[Xi,ci]=c.paint.get("line-trim-offset");(me==="round"||me==="square")&&Xi!==ci&&(Xi===0&&(Xi-=1),ci===1&&(ci+=1));let An=Q?At.projMatrix:null,yi=M?1/sn.tileToMeter/o.ay(Lt,1,f.transform.zoom):1,kn=M?1/sn.tileToMeter/o.ay(Lt,1,Math.floor(f.transform.zoom)):1,cr=xe?o.e3(f,Lt,c,An,ae,yi,kn,[Xi,ci],pn,Re):o.e4(f,Lt,c,An,sn.lineClipsArray.length,ae,yi,kn,[Xi,ci],pn);if(Ke){let vn=sn.gradients[c.id],ii=vn.texture;if(c.gradientVersion!==vn.version){let yr=256;if(c.stepInterpolant){let Gr=r.getSource().maxzoom,Cr=At.canonical.z===Gr?Math.ceil(1<<f.transform.maxZoom-At.canonical.z):1;yr=o.aA(o.e5(sn.maxLineLength/o.al*1024*Cr),256,O.maxTextureSize)}vn.gradient=o.e6({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:yr,image:vn.gradient||void 0,clips:sn.lineClipsArray}),vn.texture?vn.texture.update(vn.gradient):vn.texture=new o.T(O,vn.gradient,z.RGBA8),vn.version=c.gradientVersion,ii=vn.texture}O.activeTexture.set(z.TEXTURE1),ii.bind(c.stepInterpolant?z.NEAREST:z.LINEAR,z.CLAMP_TO_EDGE)}ge&&(O.activeTexture.set(z.TEXTURE0),Lt.lineAtlasTexture&&Lt.lineAtlasTexture.bind(z.LINEAR,z.REPEAT),Kn.updatePaintBuffers()),xe&&(O.activeTexture.set(z.TEXTURE0),Lt.imageAtlasTexture&&Lt.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Kn.updatePaintBuffers()),$t&&!P&&f.terrain.setupElevationDraw(Lt,ti),f.uploadCommonUniforms(O,ti,At.toUnwrapped());let Ci=vn=>{Te!=null&&(Te.value=qe*C),ti.draw(f,z.TRIANGLES,mt,vn,Z,dn.disabled,cr,c.id,sn.layoutVertexBuffer,sn.indexBuffer,sn.segments,c.paint,f.transform.zoom,Kn,[sn.layoutVertexBuffer2,sn.patternVertexBuffer,sn.zOffsetVertexBuffer]),Te!=null&&(Te.value=qe)};if(je&&!$t){let vn=f.stencilModeForClipping(At).ref;vn===0&&Q&&O.clear({stencil:0});let ii={func:z.EQUAL,mask:255};cr.u_alpha_discard_threshold=.8,Ci(new mn(ii,vn,255,z.KEEP,z.KEEP,z.INVERT)),cr.u_alpha_discard_threshold=0,Ci(new mn(ii,vn,255,z.KEEP,z.KEEP,z.KEEP))}else cr.u_alpha_discard_threshold=je&&$t&&Ft?.8:0,Ci($t?xt:f.stencilModeForClipping(At))}},Ue=f.depthModeForSublayer(0,Vt.ReadOnly),at=new Vt(f.depthOcclusion?z.GREATER:z.LEQUAL,Vt.ReadOnly,f.depthRangeFor3D);if(c.hasNonElevatedBuckets){let bt=!Q&&f.terrain;C!==0&&bt?o.w(`Occlusion opacity for layer ${c.id} is supported on terrain only if the layer has line-z-offset enabled.`):bt?o.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${c.id}.`):Je(p,Le,Ue,mn.disabled,!1,!0)}if(c.hasElevatedBuckets){T==="hd-road-markup"?F||(Ue=at,Le.push("ELEVATED_ROADS")):(Le.push("ELEVATED"),Ue=at,H&&Le.push(K?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),P&&Le.push("ELEVATION_REFERENCE_SEA"));let bt=je?f.stencilModeFor3D():mn.disabled;f.forceTerrainMode=!0,Je(p,Le,Ue,bt,!0,!0),je&&Je(p,Le,Ue,bt,!0,!1),f.forceTerrainMode=!1}je&&(f.resetStencilClippingMasks(),Q&&O.clear({stencil:0})),C===0||f.depthOcclusion||Q||f.layersWithOcclusionOpacity.push(f.currentLayer)},fill:function(f,r,c,p){let _=c.paint.get("fill-color"),y=c.paint.get("fill-opacity");if(y.constantOr(1)===0)return;let x=c.paint.get("fill-emissive-strength"),C=f.colorModeForDrapableLayerRenderPass(x),T=c.paint.get("fill-pattern"),M=f.opaquePassEnabledForLayer()&&!T.constantOr(1)&&_.constantOr(o.ao.transparent).a===1&&y.constantOr(0)===1?"opaque":"translucent",P="none";c.layout.get("fill-elevation-reference")!=="none"?P="road":c.paint.get("fill-z-offset").constantOr(1)!==0&&(P="offset");let F=!(!f.terrain||!f.terrain.enabled),O={painter:f,sourceCache:r,layer:c,coords:p,colorMode:C,elevationType:P,terrainEnabled:F,pass:M};if(f.renderPass!=="shadow")if(P!=="offset"){if(Mf(O,!1),P==="road"){let z=!F&&f.renderPass==="translucent";z&&_h(f,r,c,p,"geometry"),Mf(O,!0,mn.disabled),z&&(function(V){let{painter:H,sourceCache:K,layer:Z,coords:Q,colorMode:ae}=V,re=H.context.gl,ge=V.painter.shadowRenderer,ce=!!ge&&ge.enabled,ve=new Vt(H.context.gl.LEQUAL,Vt.ReadOnly,H.depthRangeFor3D),me=[0,0,0];if(ce){let xe=H.style.directionalLight,Re=H.style.ambientLight;xe&&Re&&(me=Oa(H.style,xe,Re))}let he=xe=>{for(let Re of Q){let Ie=K.getTile(Re),qe=Ie.getBucket(Z);if(!qe)continue;let je=qe.elevatedStructures;if(!je)continue;let Ke,_t;if(xe?(Ke=je.renderableBridgeSegments,_t=je.bridgeProgramConfigurations.get(Z.id)):(Ke=je.renderableTunnelSegments,_t=je.tunnelProgramConfigurations.get(Z.id)),!Ke||Ke.segments[0].primitiveLength===0)continue;_t.updatePaintBuffers(),H.prepareDrawTile();let Le=H.isTileAffectedByFog(Re),Te=[];ce&&Te.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");let Je=H.getOrCreateProgram("elevatedStructures",{config:_t,overrideFog:Le,defines:Te}),Ue=H.translatePosMatrix(Re.projMatrix,Ie,Z.paint.get("fill-translate"),Z.paint.get("fill-translate-anchor"));ce&&ge.setupShadows(Ie.tileID.toUnwrapped(),Je,"vector-tile");let at=LD(Ue,me);H.uploadCommonUniforms(H.context,Je,Re.toUnwrapped()),Je.draw(H,re.TRIANGLES,ve,mn.disabled,ae,dn.backCCW,at,Z.id,je.vertexBuffer,je.indexBuffer,Ke,Z.paint,H.transform.zoom,_t,[je.vertexBufferNormal])}};he(!0),he(!1)})(O)}}else Mf(O,!1,f.stencilModeFor3D());else f.shadowRenderer&&P==="road"&&!F&&(function(z){let{painter:V,sourceCache:H,layer:K,coords:Z}=z,Q=V.context.gl,ae=z.painter.shadowRenderer;for(let re of Z){let ge=H.getTile(re),ce=ge.getBucket(K);if(!ce)continue;let ve=ce.elevatedStructures;if(!ve||!ve.shadowCasterSegments||ve.shadowCasterSegments.segments[0].primitiveLength===0)continue;V.prepareDrawTile();let me=ce.bufferData.programConfigurations.get(K.id),he=V.isTileAffectedByFog(re),xe=V.getOrCreateProgram("elevatedStructuresDepth",{config:me,overrideFog:he}),Re=ae.calculateShadowPassMatrixFromTile(ge.tileID.toUnwrapped());V.uploadCommonUniforms(V.context,xe,re.toUnwrapped());let Ie={u_matrix:Re,u_depth_bias:0};xe.draw(V,Q.TRIANGLES,ae.getShadowPassDepthMode(),mn.disabled,ae.getShadowPassColorMode(),dn.disabled,Ie,K.id,ve.vertexBuffer,ve.indexBuffer,ve.shadowCasterSegments,K.paint,V.transform.zoom,me)}})(O)},"fill-extrusion":function(f,r,c,p){let _=c.paint.get("fill-extrusion-opacity"),y=f.context,x=y.gl,C=f.terrain,T=C&&C.renderingToTexture;if(_===0)return;let M=f.conflationActive&&f.style.isLayerClipped(c,r.getSource()),P=f.style.order.indexOf(c.fqid);if(M&&(function(F,O,z,V,H){for(let K of V){let Z=O.getTile(K).getBucket(z);Z&&(Z.updateReplacement(K,F.replacementSource,H),Z.uploadCentroid(F.context))}})(f,r,c,p,P),C||M)for(let F of p){let O=r.getTile(F).getBucket(c);O&&od(f.context,r,F,O,c,C,M)}if(f.renderPass==="shadow"&&f.shadowRenderer){let F=f.shadowRenderer;if(C&&_<.65&&c._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof o.ad)return;let O=F.getShadowPassDepthMode(),z=F.getShadowPassColorMode();Bt(f,r,c,p,O,mn.disabled,z,M)}else if(f.renderPass==="translucent"){let F=!c.paint.get("fill-extrusion-pattern").constantOr(1),O=c.paint.get("fill-extrusion-color").constantOr(o.ao.white);if(!T&&O.a!==0){let z=new Vt(f.context.gl.LEQUAL,Vt.ReadWrite,f.depthRangeFor3D);_===1&&F?Bt(f,r,c,p,z,mn.disabled,In.unblended,M):(Bt(f,r,c,p,z,mn.disabled,In.disabled,M),Bt(f,r,c,p,z,f.stencilModeFor3D(),f.colorModeForRenderPass(),M),f.resetStencilClippingMasks())}if(f.style.enable3dLights()&&F&&(!C&&f.transform.projection.name!=="globe"||T)){let z=c.paint.get("fill-extrusion-opacity"),V=c.paint.get("fill-extrusion-ambient-occlusion-intensity"),H=c.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),K=c.paint.get("fill-extrusion-flood-light-intensity"),Z=c.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Q=c.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Z?null:c.lut).toArray01().slice(0,3),ae=V>0&&H>0,re=K>0,ge=(me,he,xe)=>(1-xe)*me+xe*he,ce=new Kv;ce.translate=c.paint.get("fill-extrusion-translate"),ce.translateAnchor=c.paint.get("fill-extrusion-translate-anchor"),ce.edgeRadius=c.layout.get("fill-extrusion-edge-radius"),ce.cutoffFadeRange=c.paint.get("fill-extrusion-cutoff-fade-range");let ve=me=>{let he=f.depthModeForSublayer(1,Vt.ReadOnly,x.LEQUAL,!0),xe=c.paint.get(me?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Re=ge(.1,3,xe),Ie=f._showOverdrawInspector;if(!Ie){let qe=new mn({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),je=new In([x.ONE,x.ONE,x.ONE,x.ONE],o.ao.transparent,[!1,!1,!1,!0],x.MIN);nu(ce,f,r,c,p,he,qe,je,dn.disabled,me,"sdf",z,V,H,K,Q,Re,M,!1)}{let qe=Ie?mn.disabled:new mn({func:x.EQUAL,mask:255},255,255,x.KEEP,x.DECR,x.DECR),je=Ie?f.colorModeForRenderPass():new In([x.ONE_MINUS_DST_ALPHA,x.DST_ALPHA,x.ONE,x.ONE],o.ao.transparent,[!0,!0,!0,!0]);nu(ce,f,r,c,p,he,qe,je,dn.disabled,me,"color",z,V,H,K,Q,Re,M,!1)}};if(T){let me=(he,xe,Re)=>{let Ie=f.depthModeForSublayer(1,Vt.ReadOnly,x.LEQUAL,!1),qe=c.paint.get(he?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),je=ge(.1,3,qe);{let Ke=new In([x.ONE,x.ONE,x.ONE,x.ONE],o.ao.transparent,[!1,!1,!1,!0]);nu(ce,f,r,c,p,Ie,mn.disabled,Ke,dn.disabled,he,"clear",z,V,H,K,Q,je,M,xe)}{let Ke=new mn({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),_t=new In([x.ONE,x.ONE,x.ONE,x.ONE],o.ao.transparent,[!1,!1,!1,!0],x.MIN);nu(ce,f,r,c,p,Ie,Ke,_t,dn.disabled,he,"sdf",z,V,H,K,Q,je,M,xe)}{let Ke=he?x.ZERO:x.ONE_MINUS_DST_ALPHA,_t=new mn({func:x.EQUAL,mask:255},255,255,x.KEEP,x.DECR,x.DECR),Le=new In([Ke,x.DST_ALPHA,x.ONE_MINUS_DST_ALPHA,x.ZERO],o.ao.transparent,[!0,!0,!0,!0]);nu(ce,f,r,c,p,Ie,_t,Le,dn.disabled,he,"color",z,V,H,K,Q,je,M,xe)}{let Ke=new In([x.ONE,x.ONE,x.ONE,he?x.ZERO:x.ONE],o.ao.transparent,[!1,!1,!1,!0],he?x.FUNC_ADD:x.MAX);nu(ce,f,r,c,p,Ie,mn.disabled,Ke,dn.disabled,he,"clear",z,V,H,K,Q,je,M,xe,Re)}};if(ae||re){let he;if(f.prepareDrawTile(),C){let xe=C.drapeBufferSize[0],Re=C.drapeBufferSize[1];he=C.framebufferCopyTexture,he&&(!he||he.size[0]===xe&&he.size[1]===Re)||(he&&he.destroy(),he=C.framebufferCopyTexture=new o.T(y,new o.q({width:xe,height:Re}),x.RGBA8)),he.bind(x.LINEAR,x.CLAMP_TO_EDGE),x.copyTexSubImage2D(x.TEXTURE_2D,0,0,0,0,0,xe,Re)}ae&&me(!0,!1,he),re&&me(!1,!0,he)}}else ae&&ve(!0),re&&ve(!1),(ae||re)&&f.resetStencilClippingMasks()}}},building:function(f,r,c,p){f.currentLayer<f.firstLightBeamLayer&&(f.firstLightBeamLayer=f.currentLayer);let _=c.paint.get("building-ambient-occlusion-ground-intensity"),y=c.paint.get("building-ambient-occlusion-ground-radius"),x=c.paint.get("building-ambient-occlusion-ground-attenuation"),C=c.paint.get("building-opacity");if(C<=0)return;let T=_>0&&y>0,M=!0,P=c.paint.get("building-vertical-scale");if(P<=0)return;(!f.shadowRenderer||P<1)&&(M=!1);let F=f.conflationActive&&f.style.isLayerClipped(c,r.getSource()),O=f.style.order.indexOf(c.fqid);if((function(z,V,H,K,Z,Q){for(let ae of Q){let re=V.getTile(ae).getBucket(H);re&&(Z&&re.updateReplacement(ae,z.replacementSource,K),re.uploadUpdatedIndexBuffer(z.context))}})(f,r,c,O,F,p),(function(z,V,H,K){for(let Z of K){let Q=V.getTile(Z).getBucket(H);Q&&Q.needsEvaluation()&&Q.uploadUpdatedColorBuffer(z.context)}})(f,r,c,p),c.resetLayerRenderingStats(f),f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0),f.renderPass==="shadow"&&f.shadowRenderer){let z=f.shadowRenderer,V=[],H=z.getShadowPassDepthMode();s_({painter:f,source:r,layer:c,coords:p,defines:V,blendMode:z.getShadowPassColorMode(),depthMode:H,opacity:C,verticalScale:P,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(f.renderPass==="translucent"){let z=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];M&&(z=z.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),f.shadowRenderer&&f.shadowRenderer.useNormalOffset&&(z=z.concat("NORMAL_OFFSET"));let V=c.paint.get("building-facade-emissive-chance"),H=c.paint.get("building-ambient-occlusion-intensity"),K=c.paint.get("building-flood-light-intensity"),Z=c.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",Q=c.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(Z?null:c.lut).toArray01().slice(0,3),ae=c.paint.get("building-flood-light-ground-attenuation"),re=K>0,ge=new Vt(f.context.gl.LEQUAL,Vt.ReadWrite,f.depthRangeFor3D);C<1&&s_({painter:f,source:r,layer:c,coords:p,defines:z,blendMode:In.disabled,depthMode:ge,opacity:C,verticalScale:P,facadeEmissiveChance:V,facadeAOIntensity:H,floodLightIntensity:K,floodLightColor:Q,depthOnly:!0});let ce=f.colorModeForRenderPass();s_({painter:f,source:r,layer:c,coords:p,defines:z,blendMode:ce,depthMode:ge,opacity:C,verticalScale:P,facadeEmissiveChance:V,facadeAOIntensity:H,floodLightIntensity:K,floodLightColor:Q}),T&&a_(f,r,c,p,!0,C,_,y,K,Q,x,F),re&&a_(f,r,c,p,!1,C,_,y,K,Q,ae,F)}else if(f.renderPass==="light-beam"){let z=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],V=new Vt(f.context.gl.LEQUAL,Vt.ReadOnly,f.depthRangeFor3D);s_({painter:f,source:r,layer:c,coords:p,defines:z,blendMode:In.alphaBlended,depthMode:V,opacity:C,verticalScale:P,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1),f.resetStencilClippingMasks()},hillshade:function(f,r,c,p){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent"||f.style.disableElevatedTerrain)return;let _=f.context,y=f.terrain&&f.terrain.renderingToTexture,[x,C]=f.renderPass!=="translucent"||y?[{},p]:f.stencilConfigForOverlap(p);for(let T of C){let M=r.getTile(T);if(M.needsHillshadePrepare&&f.renderPass==="offscreen")Iv(f,M,c);else if(f.renderPass==="translucent"){let P=f.depthModeForSublayer(0,Vt.ReadOnly),F=c.paint.get("hillshade-emissive-strength"),O=f.colorModeForDrapableLayerRenderPass(F),z=y&&f.terrain?f.terrain.stencilModeForRTTOverlap(T):x[T.overscaledZ];Dv(f,T,M,c,P,z,O)}}_.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,r,c,p,_,y){if(f.renderPass!=="translucent"||c.paint.get("raster-opacity")===0)return;let x=f.transform.projection.name==="globe",C=c.paint.get("raster-elevation")!==0,T=C&&x;if(f.renderElevatedRasterBackface&&!T)return;let M=f.context,P=M.gl,F=r.getSource(),O=(function(ce,ve,me,he){let xe=ve.paint.get("raster-color"),Re=ce.type==="raster-array",Ie=[],qe=ve.paint.get("raster-resampling"),je=ve.paint.get("raster-color-mix"),Ke=ve.paint.get("raster-color-range"),_t=[je[0],je[1],je[2],0],Le=je[3],Te=qe==="nearest"?he.NEAREST:he.LINEAR;if(Re&&(Ie.push("RASTER_ARRAY"),xe||Ie.push("RASTER_COLOR"),qe==="linear"&&Ie.push("RASTER_ARRAY_LINEAR"),Te=he.NEAREST,!Ke&&ce.rasterLayers)){let Je=ce.rasterLayers.find(({id:Ue})=>Ue===ve.sourceLayer);Je&&Je.fields&&Je.fields.range&&(Ke=Je.fields.range)}if(Ke=Ke||[0,1],xe){Ie.push("RASTER_COLOR"),me.activeTexture.set(he.TEXTURE2),ve.updateColorRamp(Ke);let Je=ve.colorRampTexture;Je||(Je=ve.colorRampTexture=new o.T(me,ve.colorRamp,he.RGBA8)),Je.bind(he.LINEAR,he.CLAMP_TO_EDGE)}return{mix:_t,range:Ke,offset:Le,defines:Ie,resampling:Te}})(F,c,M,P);if(F instanceof o.aT&&!p.length&&!x)return;let z=c.paint.get("raster-emissive-strength"),V=f.colorModeForDrapableLayerRenderPass(z),H=f.terrain&&f.terrain.renderingToTexture,K=!f.options.moving,Z=c.paint.get("raster-resampling")==="nearest"?P.NEAREST:P.LINEAR;if(F instanceof o.aT&&!p.length&&(F.onNorthPole||F.onSouthPole)){let ce=C?f.stencilModeFor3D():mn.disabled;return void ey(!!F.onNorthPole,null,f,r,c,z,O,dn.disabled,ce)}if(!p.length)return;let[Q,ae]=F instanceof o.aT||H?[{},p]:f.stencilConfigForOverlap(p),re=ae[ae.length-1].overscaledZ;T&&O.defines.push("PROJECTION_GLOBE_VIEW"),C&&O.defines.push("RENDER_CUTOFF");let ge=(ce,ve,me)=>{for(let he of ce){let xe=he.toUnwrapped(),Re=r.getTile(he);if(H&&(!Re||!Re.hasData()))continue;M.activeTexture.set(P.TEXTURE0);let Ie=BD(Re,F,c,O);if(!Ie||!Ie.texture)continue;let{texture:qe,mix:je,offset:Ke,tileSize:_t,buffer:Le}=Ie,Te,Je;H?(Te=Vt.disabled,Je=he.projMatrix):C?(Te=new Vt(P.LEQUAL,Vt.ReadWrite,f.depthRangeFor3D),Je=x?Float32Array.from(f.transform.expandedFarZProjMatrix):f.transform.calculateProjMatrix(xe,K)):(Te=f.depthModeForSublayer(he.overscaledZ-re,c.paint.get("raster-opacity")===1?Vt.ReadWrite:Vt.ReadOnly,P.LESS),Je=f.transform.calculateProjMatrix(xe,K));let Ue=f.terrain&&H?f.terrain.stencilModeForRTTOverlap(he):Q[he.overscaledZ],at=y?0:c.paint.get("raster-fade-duration");Re.registerFadeDuration(at);let bt=r.findLoadedParent(he,0),jt=$g(Re,bt,r,f.transform,at),mt,xt;!jt.isFading&&Re.refreshedUponExpiration&&(Re.refreshedUponExpiration=!1),f.terrain&&f.terrain.prepareDrawTile(),M.activeTexture.set(P.TEXTURE0),qe.bind(Z,P.CLAMP_TO_EDGE),M.activeTexture.set(P.TEXTURE1),bt?(bt.texture&&bt.texture.bind(Z,P.CLAMP_TO_EDGE),mt=Math.pow(2,bt.tileID.overscaledZ-Re.tileID.overscaledZ),xt=[Re.tileID.canonical.x*mt%1,Re.tileID.canonical.y*mt%1]):qe.bind(Z,P.CLAMP_TO_EDGE),"useMipmap"in qe&&M.extTextureFilterAnisotropic&&f.transform.pitch>20&&P.texParameterf(P.TEXTURE_2D,M.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,M.extTextureFilterAnisotropicMax);let $t=f.transform,Ft,At=C?W1($t):[0,0,0,0],Lt,sn,jn,ei,Ni,pn=0;if(T&&F instanceof o.aT&&F.coordinates.length>3)Lt=Float32Array.from(o.bj(o.dI(new o.cC(0,0,0)))),sn=Float32Array.from($t.globeMatrix),jn=Float32Array.from(o.dE($t)),ei=[o.aF($t.center.lng),o.aJ($t.center.lat)],Ft=F.elevatedGlobePerspectiveTransform,Ni=F.elevatedGlobeGridMatrix||new Float32Array(9);else if(T){let ti=o.dF(he.canonical);pn=o.dG(ti.getCenter().lat),Lt=Float32Array.from(o.bj(o.dI(he.canonical))),sn=Float32Array.from($t.globeMatrix),jn=Float32Array.from(o.dE($t)),ei=[o.aF($t.center.lng),o.aJ($t.center.lat)],Ft=[0,0],Ni=Float32Array.from(o.dH(he.canonical,ti,pn,$t.worldSize/$t._pixelsPerMercatorPixel))}else Ft=F instanceof o.aT?F.perspectiveTransform:[0,0],Lt=new Float32Array(16),sn=new Float32Array(9),jn=new Float32Array(16),ei=[0,0],Ni=new Float32Array(9);let Kn=lm(Je,Lt,sn,jn,Ni,xt||[0,0],o.aj(f.transform.zoom),ei,At,mt||1,jt,c,Ft,C?c.paint.get("raster-elevation"):0,2,je,Ke,O.range,_t,Le,z),Mn=f.isTileAffectedByFog(he),Ii=f.getOrCreateProgram("raster",{defines:O.defines,overrideFog:Mn});if(f.uploadCommonUniforms(M,Ii,xe),F instanceof o.aT){let ti=F.elevatedGlobeVertexBuffer,Xi=F.elevatedGlobeIndexBuffer;if(H||!x)F.boundsBuffer&&F.boundsSegments&&Ii.draw(f,P.TRIANGLES,Te,mn.disabled,V,dn.disabled,Kn,c.id,F.boundsBuffer,f.quadTriangleIndexBuffer,F.boundsSegments);else if(ti&&Xi){let ci=$t.zoom<=o.cZ?F.elevatedGlobeSegments:F.getSegmentsForLongitude($t.center.lng);ci&&Ii.draw(f,P.TRIANGLES,Te,mn.disabled,V,ve,Kn,c.id,ti,Xi,ci)}}else if(T){Te=new Vt(P.LEQUAL,Vt.ReadOnly,f.depthRangeFor3D);let ti=f.globeSharedBuffers;if(ti){let[Xi,ci,An]=ti.getGridBuffers(pn,!1);Ii.draw(f,P.TRIANGLES,Te,me||Ue,f.colorModeForRenderPass(),ve,Kn,c.id,Xi,ci,An)}}else{let{tileBoundsBuffer:ti,tileBoundsIndexBuffer:Xi,tileBoundsSegments:ci}=f.getTileBoundsBuffers(Re);Ii.draw(f,P.TRIANGLES,Te,Ue,V,dn.disabled,Kn,c.id,ti,Xi,ci)}}if(!(F instanceof o.aT)&&T)for(let he of ce){let xe=he.canonical.y===(1<<he.canonical.z)-1;he.canonical.y===0&&ey(!0,he,f,r,c,z,O,ve,me||mn.disabled),xe&&ey(!1,he,f,r,c,z,O,ve===dn.frontCW?dn.backCW:dn.frontCW,me||mn.disabled)}};T?ge(ae,f.renderElevatedRasterBackface?dn.backCW:dn.frontCW,f.stencilModeFor3D()):ge(ae,dn.disabled,void 0),f.resetStencilClippingMasks()},"raster-particle":function(f,r,c,p,_,y){f.renderPass==="offscreen"&&(function(x,C,T,M){if(!M.length)return;let P=x.context,F=P.gl,O=C.getSource();if(!(O instanceof yo))return;let z=Math.ceil(Math.sqrt(T.paint.get("raster-particle-count"))),V=T.particlePositionRGBAImage;if(!V||V.width!==z){let ae=(function(re){let ge=re*re,ce=new Uint8Array(4*ge),ve=function(he){return he|=0,he=Math.imul(2747636419^he,2654435769),he=Math.imul(he^he>>>16,2654435769),((he=Math.imul(he^he>>>16,2654435769))>>>0)/4294967296},me=1/1.1;for(let he=0;he<ge;he++){let xe=me*(ve(2*he+0)+gh),Re=me*(ve(2*he+1)+gh),Ie=255*xe%1,qe=255*Re%1,je=Ie,Ke=Re-qe/255,_t=qe;ce[4*he+0]=255*(xe-Ie/255),ce[4*he+1]=255*je,ce[4*he+2]=255*Ke,ce[4*he+3]=255*_t}return ce})(z);V=T.particlePositionRGBAImage=new o.q({width:z,height:z},ae)}let H=T.particleFramebuffer;H?H.width!==z&&(H.destroy(),H=T.particleFramebuffer=P.createFramebuffer(z,z,!0,null)):H=T.particleFramebuffer=P.createFramebuffer(z,z,!0,null);let K=[];for(let ae of M){let re=C.getTile(ae);if(!(re instanceof yl))continue;let ge=ty(re,O,T);if(!ge)continue;let ce=[re.tileSize,re.tileSize],ve=T.tileFramebuffer;ve||(ve=T.tileFramebuffer=P.createFramebuffer(ce[0],ce[1],!0,null));let me=re.rasterParticleState;me||(me=re.rasterParticleState=new ka(P,ae,ce,V));let he=me.update(T.lastInvalidatedAt);me.particleTextureDimension!==z&&me.updateParticleTexture(ae,V);let xe=me.targetColorTexture;me.targetColorTexture=me.backgroundColorTexture,me.backgroundColorTexture=xe;let Re=me.particleTexture0;me.particleTexture0=me.particleTexture1,me.particleTexture1=Re,K.push([ae,ge,me,he])}if(K.length===0)return;let Z=o.o.now(),Q=T.previousDrawTimestamp?.001*(Z-T.previousDrawTimestamp):.0167;if(T.previousDrawTimestamp=Z,T.hasColorMap()){P.activeTexture.set(F.TEXTURE0+2);let ae=T.colorRampTexture;ae||(ae=T.colorRampTexture=new o.T(P,T.colorRamp,F.RGBA8)),ae.bind(F.LINEAR,F.CLAMP_TO_EDGE)}P.bindFramebuffer.set(T.tileFramebuffer.framebuffer),(function(ae,re,ge){let ce=ae.context,ve=ce.gl,me=re.tileFramebuffer;ce.activeTexture.set(ve.TEXTURE0);let he={u_texture:0,u_opacity:1.05*(Re=re.paint.get("raster-particle-fade-opacity-factor"))/(Re+.05)},xe=ae.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Re;for(let Ie of ge){let[,,qe,je]=Ie;me.colorAttachment.set(qe.targetColorTexture.texture),ce.viewport.set([0,0,me.width,me.height]),ce.clear({color:o.ao.transparent}),je&&(qe.backgroundColorTexture.bind(ve.NEAREST,ve.CLAMP_TO_EDGE),xe.draw(ae,ve.TRIANGLES,Vt.disabled,mn.disabled,In.alphaBlended,dn.disabled,he,re.id,ae.viewportBuffer,ae.quadTriangleIndexBuffer,ae.viewportSegments))}})(x,T,K),(function(ae,re,ge,ce){let ve=ae.context,me=ve.gl,he=ge.tileFramebuffer,xe=ae.transform.projection.name==="globe",Re=ge.paint.get("raster-particle-max-speed");for(let Ie of ce){let[qe,je,Ke]=Ie;ve.activeTexture.set(me.TEXTURE0+0),je.texture.bind(me.LINEAR,me.CLAMP_TO_EDGE),he.colorAttachment.set(Ke.targetColorTexture.texture);let _t=ae.getOrCreateProgram("rasterParticleDraw",{defines:je.defines,overrideFog:!1});ve.activeTexture.set(me.TEXTURE0+1);let Le=je.scalarData?[]:[0,1,2,3].map(Ue=>o.e8[Ue](qe));Le.push(qe);let Te=qe.canonical.x,Je=qe.canonical.y;for(let Ue of Le){let at=re.getTile(xe?Ue.wrapped():Ue);if(!at)continue;let bt=at.rasterParticleState;if(!bt)continue;let jt=Ue.canonical.x+(1<<Ue.canonical.z)*(Ue.wrap-qe.wrap),mt=Ue.canonical.y;bt.particleTexture0.bind(me.NEAREST,me.CLAMP_TO_EDGE);let xt=qv(1,bt.particleTexture0.size[0],[jt-Te,mt-Je],0,je.texture.size,2,Re,je.textureOffset,je.scale,je.offset);_t.draw(ae,me.POINTS,Vt.disabled,mn.disabled,In.alphaBlended,dn.disabled,xt,ge.id,bt.particleIndexBuffer,void 0,bt.particleSegment)}}})(x,C,T,K),P.bindFramebuffer.set(T.particleFramebuffer.framebuffer),(function(ae,re,ge,ce){let ve=ae.context,me=ve.gl,he=re.paint.get("raster-particle-max-speed"),xe=ce*re.paint.get("raster-particle-speed-factor")*.15,Re=(function(qe){return Math.pow(qe,6)})(.01+1*re.paint.get("raster-particle-reset-rate-factor")),Ie=re.particleFramebuffer;ve.viewport.set([0,0,Ie.width,Ie.height]);for(let qe of ge){let[,je,Ke]=qe;ve.activeTexture.set(me.TEXTURE0+0),je.texture.bind(me.LINEAR,me.CLAMP_TO_EDGE),ve.activeTexture.set(me.TEXTURE0+1);let _t=Ke.particleTexture0;_t.bind(me.NEAREST,me.CLAMP_TO_EDGE);let Le=Kg(1,_t.size[0],0,je.texture.size,he,xe,Re,je.textureOffset,je.scale,je.offset);Ie.colorAttachment.set(Ke.particleTexture1.texture),ve.clear({color:o.ao.transparent}),ae.getOrCreateProgram("rasterParticleUpdate",{defines:je.defines}).draw(ae,me.TRIANGLES,Vt.disabled,mn.disabled,In.unblended,dn.disabled,Le,re.id,ae.viewportBuffer,ae.quadTriangleIndexBuffer,ae.viewportSegments)}})(x,T,K,Q)})(f,r,c,p),f.renderPass==="translucent"&&((function(x,C,T,M,P){let F=x.context,O=F.gl,z=C.getSource().tileSize,V=5*(1-o.ah(o.cK,o.cK+1,x.transform.zoom))*z+T.paint.get("raster-particle-elevation"),H=!x.options.moving,K=x.transform.projection.name==="globe";if(!M.length)return;let[Z,Q]=x.stencilConfigForOverlap(M),ae=[];K&&ae.push("PROJECTION_GLOBE_VIEW");let re=x.stencilModeFor3D();for(let ge of Q){let ce=ge.toUnwrapped(),ve=C.getTile(ge);if(!ve.rasterParticleState)continue;let me=ve.rasterParticleState,he=100;ve.registerFadeDuration(he);let xe=C.findLoadedParent(ge,0),Re=$g(ve,xe,C,x.transform,he),Ie,qe;x.terrain&&x.terrain.prepareDrawTile(),F.activeTexture.set(O.TEXTURE0),me.targetColorTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),F.activeTexture.set(O.TEXTURE1),xe&&xe.rasterParticleState?(xe.rasterParticleState.targetColorTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),Ie=Math.pow(2,xe.tileID.overscaledZ-ve.tileID.overscaledZ),qe=[ve.tileID.canonical.x*Ie%1,ve.tileID.canonical.y*Ie%1]):me.targetColorTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE);let je=K?Float32Array.from(x.transform.expandedFarZProjMatrix):x.transform.calculateProjMatrix(ce,H),Ke=x.transform,_t=Ks(Ke),Le=o.dF(ge.canonical),Te=o.dG(Le.getCenter().lat),Je,Ue,at,bt,jt;K?(Je=Float32Array.from(o.bj(o.dI(ge.canonical))),Ue=Float32Array.from(Ke.globeMatrix),at=Float32Array.from(o.dE(Ke)),bt=[o.aF(Ke.center.lng),o.aJ(Ke.center.lat)],jt=Float32Array.from(o.dH(ge.canonical,Le,Te,Ke.worldSize/Ke._pixelsPerMercatorPixel))):(Je=new Float32Array(16),Ue=new Float32Array(9),at=new Float32Array(16),bt=[0,0],jt=new Float32Array(9));let mt=id(je,Je,Ue,at,jt,qe||[0,0],o.aj(x.transform.zoom),bt,_t,Ie||1,Re,V),xt=x.isTileAffectedByFog(ge),$t=x.getOrCreateProgram("rasterParticle",{defines:ae,overrideFog:xt});if(x.uploadCommonUniforms(F,$t,ce),K){let Ft=new Vt(O.LEQUAL,Vt.ReadOnly,x.depthRangeFor3D),At=0,Lt=x.globeSharedBuffers;if(Lt){let[sn,jn,ei]=Lt.getGridBuffers(Te,At!==0);$t.draw(x,O.TRIANGLES,Ft,re,In.alphaBlended,x.renderElevatedRasterBackface?dn.frontCCW:dn.backCCW,mt,T.id,sn,jn,ei)}}else{let Ft=x.depthModeForSublayer(0,Vt.ReadOnly),At=Z[ge.overscaledZ],{tileBoundsBuffer:Lt,tileBoundsIndexBuffer:sn,tileBoundsSegments:jn}=x.getTileBoundsBuffers(ve);$t.draw(x,O.TRIANGLES,Ft,At,In.alphaBlended,dn.disabled,mt,T.id,Lt,sn,jn)}}x.resetStencilClippingMasks()})(f,r,c,p),f.style.map.triggerRepaint())},background:function(f,r,c,p){let _=c.paint.get("background-color"),y=c.paint.get("background-color-use-theme").constantOr("default")==="none",x=c.paint.get("background-opacity"),C=c.paint.get("background-emissive-strength"),T=c.paint.get("background-pitch-alignment")==="viewport";if(x===0)return;let M=f.context,P=M.gl,F=f.transform,O=F.tileSize,z=c.paint.get("background-pattern"),V;if(z!==void 0&&(z===null||(V=f.imageManager.getPattern(o.I.from(z.toString()),c.scope,f.style.getLut(c.scope)),!V)))return;let H=!z&&_.a===1&&x===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==H)return;let K=mn.disabled,Z=f.depthModeForSublayer(0,H==="opaque"?Vt.ReadWrite:Vt.ReadOnly),Q=f.colorModeForDrapableLayerRenderPass(C),ae=z?"backgroundPattern":"background",re,ge=p;if(ge||(re=f.getBackgroundTiles(),ge=Object.values(re).map(ce=>ce.tileID)),z&&(M.activeTexture.set(P.TEXTURE0),f.imageManager.bind(f.context,c.scope)),T){let ce=f.getOrCreateProgram(ae,{overrideFog:!1,overrideRtt:!0}),ve=new Float32Array(o.bz([])),me=new o.aP(0,0,0,0,0),he=z?Qg(ve,C,x,f,0,c.scope,V,T,{tileID:me,tileSize:O}):Jg(ve,C,x,_.toPremultipliedRenderColor(y?null:c.lut));ce.draw(f,P.TRIANGLES,Z,K,Q,dn.disabled,he,c.id,f.viewportBuffer,f.quadTriangleIndexBuffer,f.viewportSegments)}else for(let ce of ge){let ve=f.isTileAffectedByFog(ce),me=f.getOrCreateProgram(ae,{overrideFog:ve}),he=ce.toUnwrapped(),xe=p?ce.projMatrix:f.transform.calculateProjMatrix(he);f.prepareDrawTile();let Re=r?r.getTile(ce):re?re[ce.key]:new vl(ce,O,F.zoom,f),Ie=z?Qg(xe,C,x,f,0,c.scope,V,T,{tileID:ce,tileSize:O}):Jg(xe,C,x,_.toPremultipliedRenderColor(y?null:c.lut));f.uploadCommonUniforms(M,me,he);let{tileBoundsBuffer:qe,tileBoundsIndexBuffer:je,tileBoundsSegments:Ke}=f.getTileBoundsBuffers(Re);me.draw(f,P.TRIANGLES,Z,K,Q,dn.disabled,Ie,c.id,qe,je,Ke)}},sky:function(f,r,c){let p=f._atmosphere?o.aj(f.transform.zoom):1,_=c.paint.get("sky-opacity")*p;if(_===0)return;let y=f.context,x=c.paint.get("sky-type"),C=new Vt(y.gl.LEQUAL,Vt.ReadOnly,[0,1]),T=f.frameCounter/1e3%1;x==="atmosphere"?f.renderPass==="offscreen"?c.needsSkyboxCapture(f)&&((function(M,P,F,O){let z=M.context,V=z.gl,H=P.skyboxFbo;if(!H){H=P.skyboxFbo=z.createFramebuffer(32,32,!0,null),P.skyboxGeometry=new sy(z),P.skyboxTexture=z.gl.createTexture(),V.bindTexture(V.TEXTURE_CUBE_MAP,P.skyboxTexture),V.texParameteri(V.TEXTURE_CUBE_MAP,V.TEXTURE_WRAP_S,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_CUBE_MAP,V.TEXTURE_WRAP_T,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_CUBE_MAP,V.TEXTURE_MIN_FILTER,V.LINEAR),V.texParameteri(V.TEXTURE_CUBE_MAP,V.TEXTURE_MAG_FILTER,V.LINEAR);for(let ae=0;ae<6;++ae)V.texImage2D(V.TEXTURE_CUBE_MAP_POSITIVE_X+ae,0,V.RGBA,32,32,0,V.RGBA,V.UNSIGNED_BYTE,null)}z.bindFramebuffer.set(H.framebuffer),z.viewport.set([0,0,32,32]);let K=P.getCenter(M,!0),Z=M.getOrCreateProgram("skyboxCapture"),Q=new Float64Array(16);o.bz(Q),o.em(Q,Q,.5*-Math.PI),Tl(M,P,Z,Q,K,0),o.bz(Q),o.em(Q,Q,.5*Math.PI),Tl(M,P,Z,Q,K,1),o.bz(Q),o.cT(Q,Q,.5*-Math.PI),Tl(M,P,Z,Q,K,2),o.bz(Q),o.cT(Q,Q,.5*Math.PI),Tl(M,P,Z,Q,K,3),o.bz(Q),Tl(M,P,Z,Q,K,4),o.bz(Q),o.em(Q,Q,Math.PI),Tl(M,P,Z,Q,K,5),z.viewport.set([0,0,M.width,M.height])})(f,c),c.markSkyboxValid(f)):f.renderPass==="sky"&&(function(M,P,F,O,z){let V=M.context,H=V.gl,K=M.transform,Z=M.getOrCreateProgram("skybox");V.activeTexture.set(H.TEXTURE0),H.bindTexture(H.TEXTURE_CUBE_MAP,P.skyboxTexture);let Q=((ae,re,ge,ce,ve)=>({u_matrix:ae,u_sun_direction:re,u_cubemap:0,u_opacity:ce,u_temporal_offset:ve}))(K.skyboxMatrix,P.getCenter(M,!1),0,O,z);M.uploadCommonUniforms(V,Z),Z.draw(M,H.TRIANGLES,F,mn.disabled,M.colorModeForRenderPass(),dn.backCW,Q,"skybox",P.skyboxGeometry.vertexBuffer,P.skyboxGeometry.indexBuffer,P.skyboxGeometry.segment)})(f,c,C,_,T):x==="gradient"&&f.renderPass==="sky"&&(function(M,P,F,O,z){let V=M.context,H=V.gl,K=M.transform,Z=M.getOrCreateProgram("skyboxGradient");P.skyboxGeometry||(P.skyboxGeometry=new sy(V)),V.activeTexture.set(H.TEXTURE0);let Q=P.colorRampTexture;Q||(Q=P.colorRampTexture=new o.T(V,P.colorRamp,H.RGBA8)),Q.bind(H.LINEAR,H.CLAMP_TO_EDGE);let ae=((re,ge,ce,ve,me)=>({u_matrix:re,u_color_ramp:0,u_center_direction:ge,u_radius:o.an(ce),u_opacity:ve,u_temporal_offset:me}))(K.skyboxMatrix,P.getCenter(M,!1),P.paint.get("sky-gradient-radius"),O,z);M.uploadCommonUniforms(V,Z),Z.draw(M,H.TRIANGLES,F,mn.disabled,M.colorModeForRenderPass(),dn.backCW,ae,"skyboxGradient",P.skyboxGeometry.vertexBuffer,P.skyboxGeometry.indexBuffer,P.skyboxGeometry.segment)})(f,c,C,_,T)},custom:function(f,r,c,p){let _=f.context,y=c.implementation;if(!f.transform.projection.unsupportedLayers||!f.transform.projection.unsupportedLayers.includes("custom")||f.terrain&&(f.terrain.renderingToTexture||f.renderPass==="offscreen")&&c.isDraped(r)){if(f.renderPass==="offscreen"){let x=y.prerender;if(x){if(f.setCustomLayerDefaults(),_.setColorMode(f.colorModeForRenderPass()),f.transform.projection.name==="globe"){let C=f.transform.pointMerc;x.call(y,_.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),o.aj(f.transform.zoom),[C.x,C.y],f.transform.pixelsPerMeterRatio)}else x.call(y,_.gl,f.transform.customLayerMatrix());_.setDirty(),f.setBaseState()}}else if(f.renderPass==="translucent"){if(f.terrain&&f.terrain.renderingToTexture){let C=y.renderToTile;if(C){let T=p[0].canonical,M={x:T.x+p[0].wrap*(y.wrapTileId?0:1<<T.z),y:T.y,z:T.z};_.setDepthMode(Vt.disabled),_.setStencilMode(mn.disabled),_.setColorMode(f.colorModeForRenderPass()),f.setCustomLayerDefaults(),C.call(y,_.gl,M),_.setDirty(),f.setBaseState()}return}f.setCustomLayerDefaults(),_.setColorMode(f.colorModeForRenderPass()),_.setStencilMode(mn.disabled);let x=y.renderingMode==="3d"?new Vt(f.context.gl.LEQUAL,Vt.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,Vt.ReadOnly);if(_.setDepthMode(x),f.transform.projection.name==="globe"){let C=f.transform.pointMerc;y.render(_.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),o.aj(f.transform.zoom),[C.x,C.y],f.transform.pixelsPerMeterRatio)}else y.render(_.gl,f.transform.customLayerMatrix());_.setDirty(),f.setBaseState(),_.bindFramebuffer.set(null)}}else o.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(f,r,c,p){if(f.renderPass==="opaque")return;let _=c.paint.get("model-opacity").constantOr(1),y=c.paint.get("model-elevation-reference"),x=y==="ground",C=y==="ground";if(_===0)return;let T=c.paint.get("model-cast-shadows");if(f.renderPass==="shadow"&&(!T||f.terrain&&_<.65&&c._transitionablePaint._values["model-opacity"].value.expression instanceof o.ad))return;let M=f.shadowRenderer,P=c.paint.get("model-receive-shadows");M&&(M.useNormalOffset=!0,P||(M.enabled=!1));let F=()=>{M&&(M.useNormalOffset=!0,P||(M.enabled=!0))},O=r.getSource();if(f.renderPass==="light-beam"&&O.type!=="batched-model")return;if(O.type==="vector"||O.type==="geojson")return(function(re,ge,ce,ve,me){let he=re.transform,xe=he.projection.name==="globe",Re=he.getFreeCameraOptions().position;if(!re.modelManager)return;let Ie=re.modelManager;ce.modelManager=Ie;let qe=re.shadowRenderer;if(!ce._unevaluatedLayout._values.hasOwnProperty("model-id"))return;let je=ce._unevaluatedLayout._values["model-id"],Ke=Object.assign({},ce.layout.get("model-id").parameters),_t=re.style.order.indexOf(ce.fqid);for(let Le of ve){let Te=ge.getTile(Le).getBucket(ce);if(!Te||Te.projection.name!==he.projection.name)continue;let Je=Te.getModelUris();if(Je&&!Te.modelsRequested&&(Ie.addModelsFromBucket(Je,me),Te.modelsRequested=!0),xe)Ke.zoom=Le.overscaledZ;else{let Ft=ly(Le,he);Ke.zoom=Ft}let Ue=je.possiblyEvaluate(Ke);if(J1(re,Te,Le),Ja.shadowUniformsInitialized=!1,Ja.useSingleShadowCascade=!!qe&&qe.getMaxCascadeForTile(Le.toUnwrapped())===0,re.renderPass==="shadow"&&qe){if(re.currentShadowCascade===1&&Te.isInsideFirstShadowMapFrustum)continue;let Ft=he.calculatePosMatrix(Le.toUnwrapped(),he.worldSize);if(Ja.tileMatrix.set(Ft),Ja.shadowTileMatrix=Float32Array.from(qe.calculateShadowPassMatrixFromMatrix(Ft)),Ja.aabb.min=[0,0,0],Ja.aabb.max[0]=Ja.aabb.max[1]=o.al,Ja.aabb.max[2]=0,u_(Te,Ja,re,ce.scope))continue}let at=1<<Le.canonical.z,bt=[((Re.x-Le.wrap)*at-Le.canonical.x)*o.al,(Re.y*at-Le.canonical.y)*o.al,Re.z*at*o.al];re.conflationActive&&Object.keys(Te.instancesPerModel).length>0&&re.style.isLayerClipped(ce,ge.getSource())&&Te.updateReplacement(Le,re.replacementSource,_t,me)&&(Te.uploaded=!1,Te.upload(re.context));let jt=0,mt=new Array,xt=new Array,$t=new Array;for(let Ft in Te.instancesPerModel){let At=Te.instancesPerModel[Ft];At.features.length>0&&!xe&&(Ft=Ue.evaluate(At.features[0].feature,{}));let Lt=Ie.getModel(Ft,me);if(Lt||Ie.hasURLBeenRequested(Ft)||Te.modelUris.includes(Ft)||(Te.modelUris.push(Ft),Te.modelsRequested=!1),Lt&&Lt.uploaded)if(xe){let sn=o.c4([],[Re.x,Re.y,Re.z],re.transform.worldSize);o.ev(sn,sn);for(let jn=0;jn<At.instancedDataArray.length;++jn){let ei=[0,0,0],Ni=[1,1,1],pn=o.ew(),Kn=At.tileCoordinatesForInstance(jn),Mn=At.transformForInstance(jn);o.ex(Ni,Mn),o.ey(pn,Mn),o.ez(ei,pn);let Ii=At.translationForInstance(jn),ti=new o.aS(0,0);o.eA(Te.canonical,ti,Kn.x,Kn.y);let Xi=o.bB();o.eB(Xi,Lt,re.transform,ti,ei,Ni,Ii,!0,!1,!1);let ci=At.colorForInstance(jn),An=o.bz([]),yi=o.ee(ti.lat,re.transform.zoom),kn=o.bp([],[1,1,1/yi]);o.bq(An,An,sn),$t.push({zScaleMatrix:kn,negCameraPosMatrix:An});for(let cr of Lt.nodes)c_(re,cr,Xi,re.transform.expandedFarZProjMatrix,jt,mt,xt,Lt.materialOverrides,ci);++jt}}else for(let sn of Lt.nodes)cy(re,ce,sn,At,bt,Le,Ja)}if(xe)if(re.renderPass==="shadow"){for(let Ft of xt)kf(Ft.mesh,Ft.nodeModelMatrix,re,ce);for(let Ft of mt)kf(Ft.mesh,Ft.nodeModelMatrix,re,ce)}else K1(re,ce,1,mt,xt,$t)}})(f,r,c,p,l_(O,c,f.style._importedAsBasemap)),void F();if(!O.loaded())return;if(O.type==="batched-model")return(function(re,ge,ce,ve){ce.resetLayerRenderingStats(re);let me=re.context,he=re.transform,xe=re.style.fog,Re=re.shadowRenderer;if(he.projection.name!=="mercator")return void o.w(`Drawing 3D landmark models for ${he.projection.name} projection is not yet implemented`);let Ie=re.transform.getFreeCameraOptions().position,qe=o.c4([],[Ie.x,Ie.y,Ie.z],re.transform.worldSize),je=o.ev([],qe),Ke=o.bz([]),_t=o.ee(he.center.lat,he.zoom),Le=o.bp([],[1,1,1/_t]);o.bq(Ke,Ke,je);let Te=ce.paint.get("model-opacity").constantOr(1),Je=new Vt(me.gl.LEQUAL,Vt.ReadWrite,re.depthRangeFor3D),Ue=new Vt(me.gl.LEQUAL,Vt.ReadOnly,re.depthRangeFor3D),at=new o.d8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),bt=re.renderPass==="shadow",jt=bt&&Re?Re.getCurrentCascadeFrustum():he.getFrustum(he.scaleZoom(he.worldSize)),mt=ce.paint.get("model-front-cutoff"),xt=mt[2]<1,$t=ql(re,ce.paint.get("model-cutoff-fade-range")),Ft=ce.getLayerRenderingStats();(function(At,Lt,sn,jn){let ei=At.terrain?At.terrain.exaggeration():0,Ni=At.transform.zoom;for(let pn of jn){let Kn=Lt.getTile(pn).getBucket(sn);Kn&&(Kn.setFilter(sn.filter),At.conflationActive&&Kn.updateReplacement(pn,At.replacementSource),Kn.evaluateTransform(At,sn),At.terrain&&ei>0&&Kn.elevationUpdate(At.terrain,ei,pn,sn.source),Kn.needsReEvaluation(At,Ni,sn)&&Kn.evaluate(sn))}})(re,ge,ce,ve),(function(){let At,Lt,sn;xt?(At=ve.length-1,Lt=-1,sn=-1):(At=0,Lt=ve.length,sn=1);let jn=new Float64Array(16),ei=o.cz(),Ni=new o.P(0,0);for(let pn=At;pn!==Lt;pn+=sn){let Kn=ve[pn],Mn=ge.getTile(Kn).getBucket(ce);if(!Mn||!Mn.uploaded)continue;let Ii=!1;Re&&(Ii=Re.getMaxCascadeForTile(Kn.toUnwrapped())===0);let ti=he.calculatePosMatrix(Kn.toUnwrapped(),he.worldSize),Xi=Mn.modelTraits;!bt&&xt&&(o.bk(jn,ti),o.af(ei,qe,jn),Ni.x=ei[0],Ni.y=ei[1]);let ci=[];Mn.setFilter(ce.filter);for(let An of Mn.getNodesInfo()){if(An.hiddenByReplacement||!An.node.meshes)continue;let yi=An.node,kn=0;re.terrain&&yi.elevation&&(kn=yi.elevation*re.terrain.exaggeration());let cr=(()=>{let ws=An.aabb;return at.min=[...ws.min],at.max=[...ws.max],at.min[2]+=kn,at.max[2]+=kn,o.af(at.min,at.min,ti),o.af(at.max,at.max,ti),at})(),Ci=An.evaluatedScale;if(Ci[0]<=1&&Ci[1]<=1&&Ci[2]<=1&&cr.intersects(jt)===0)continue;if(!bt&&xt){let ws=.16666666666666666;An.cameraCollisionOpacity=qe[0]>cr.min[0]&&qe[0]<cr.max[0]&&qe[1]>cr.min[1]&&qe[1]<cr.max[1]&&qe[2]*_t<cr.max[2]&&yi.footprint&&o.b$(Ni,yi.footprint)?Math.max(An.cameraCollisionOpacity-ws,0):Math.min(1,An.cameraCollisionOpacity+ws)}let vn=[...ti],ii=1/o.d6(Kn.canonical),yr=yi.anchor?yi.anchor[0]:0,Gr=yi.anchor?yi.anchor[1]:0;o.bq(vn,vn,[yr*(Ci[0]-1)+An.evaluatedTranslation[0]*ii,Gr*(Ci[1]-1)+An.evaluatedTranslation[1]*ii,kn+An.evaluatedTranslation[2]]),o.cp(Ci,o.eD)||o.cR(vn,vn,Ci);let Cr=o.aB([],vn,yi.globalMatrix),kr=o.aB([],he.expandedFarZProjMatrix,Cr),ya=o.aB([],he.expandedFarZProjMatrix,vn),Js=o.aC([],[yr,Gr,kn,1],kr)[2];yi.hidden=!1;let ls=Te;bt||(xt&&(ls*=An.cameraCollisionOpacity,ls*=yh(vn,he,An.aabb,mt)),ls*=hm($t,Js)),ls!==0?ci.push({nodeInfo:An,depth:Js,opacity:ls,wvpForNode:kr,wvpForTile:ya,nodeModelMatrix:Cr,tileModelMatrix:vn}):yi.hidden=!0}bt||ci.sort((An,yi)=>!xt||An.opacity===1&&yi.opacity===1?An.depth<yi.depth?-1:1:An.opacity===1?-1:yi.opacity===1?1:An.depth>yi.depth?-1:1);for(let An of ci){let yi=An.nodeInfo,kn=yi.node,cr=o.aB([],Le,An.tileModelMatrix);o.aB(cr,Ke,cr);let Ci=o.bk([],cr);o.ef(Ci,Ci),o.cR(Ci,Ci,Q1),cr=o.aB(cr,cr,kn.globalMatrix);let vn=re.renderPass==="light-beam",ii=ce.paint.get("model-color-use-theme").constantOr("default")==="none",yr=Xi&o.eH.HasMapboxMeshFeatures,Gr=yr?0:yi.evaluatedRMEA[0][2];for(let Cr=0;Cr<kn.meshes.length;++Cr){let kr=kn.meshes[Cr],ya=Cr===kn.lightMeshIndex,Js=An.wvpForNode;if(ya){if(!vn&&!re.terrain&&re.shadowRenderer){re.currentLayer<re.firstLightBeamLayer&&(re.firstLightBeamLayer=re.currentLayer);continue}Js=An.wvpForTile}else if(vn)continue;let ls={defines:[]},ws=[];if(!bt&&Re&&(Re.useNormalOffset=!!kr.normalBuffer),Of(ls.defines,ws,kr,re,ii?null:ce.lut),yr||ls.defines.push("DIFFUSE_SHADED"),Ii&&ls.defines.push("SHADOWS_SINGLE_CASCADE"),Ft&&(bt?Ft.numRenderedVerticesInShadowPass+=kr.vertexArray.length:Ft.numRenderedVerticesInTransparentPass+=kr.vertexArray.length),bt){kf(kr,An.nodeModelMatrix,re,ce);continue}let el=null;if(xe){let qr=ay(An.nodeModelMatrix,re.transform);if(el=new Float32Array(qr),he.projection.name!=="globe"){let Zi=kr.aabb.min,Kr=kr.aabb.max,[Vo,Dr]=xe.getOpacityForBounds(qr,Zi[0],Zi[1],Kr[0],Kr[1]);ls.overrideFog=Vo>=Ve||Dr>=Ve}}let cs=kr.material,tl;cs.occlusionTexture&&cs.occlusionTexture.offsetScale&&(tl=cs.occlusionTexture.offsetScale,ls.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));let Il=re.getOrCreateProgram("model",ls);!bt&&Re&&Re.setupShadowsFromMatrix(An.tileModelMatrix,Il,Re.useNormalOffset),re.uploadCommonUniforms(me,Il,null,el);let jo=cs.pbrMetallicRoughness;jo.metallicFactor=.9,jo.roughnessFactor=.5;let Sr=e_(new Float32Array(Js),new Float32Array(cr),new Float32Array(Ci),new Float32Array(kn.globalMatrix),re,An.opacity,jo.baseColorFactor,cs.emissiveFactor,jo.metallicFactor,jo.roughnessFactor,cs,Gr,ce,[0,0,0],tl);!ya&&(yi.hasTranslucentParts||An.opacity<1)&&Il.draw(re,me.gl.TRIANGLES,Je,mn.disabled,In.disabled,dn.backCCW,Sr,ce.id,kr.vertexBuffer,kr.indexBuffer,kr.segments,ce.paint,re.transform.zoom,void 0,ws),Il.draw(re,me.gl.TRIANGLES,ya?Ue:Je,mn.disabled,ya||An.opacity<1||yi.hasTranslucentParts?In.alphaBlended:In.unblended,dn.backCCW,Sr,ce.id,kr.vertexBuffer,kr.indexBuffer,kr.segments,ce.paint,re.transform.zoom,void 0,ws)}}}})()})(f,r,c,p),void F();if(O.type!=="model")return;let z=O.getModels(),V=[],H=f.transform.getFreeCameraOptions().position,K=o.c4([],[H.x,H.y,H.z],f.transform.worldSize);o.ev(K,K);let Z=[],Q=[],ae=0;for(let re of z){let ge=r.getFeatureState("",re.id),ce={type:"Unknown",id:re.id,properties:re.featureProperties},ve=c.paint.get("model-rotation").evaluate(ce,ge),me=c.paint.get("model-scale").evaluate(ce,ge),he=c.paint.get("model-translation").evaluate(ce,ge);Ff(c,re.id,ge,re.featureProperties,re.nodeOverrideNames,re.nodeOverrides),VD(c,re.id,ge,re.featureProperties,re.materialOverrideNames,re.materialOverrides),re.nodeOverrides.size>0&&re.computeBoundsAndApplyParent(),re.computeModelMatrix(f,ve,me,he,C,x,!1);let xe=o.bz([]),Re=o.ee(re.position.lat,f.transform.zoom),Ie=o.bp([],[1,1,1/Re]);o.bq(xe,xe,K),V.push({zScaleMatrix:Ie,negCameraPosMatrix:xe});for(let qe of re.nodes)c_(f,qe,re.matrix,f.transform.expandedFarZProjMatrix,ae,Z,Q,re.materialOverrides);ae++}if(Z.sort((re,ge)=>ge.depth-re.depth),f.renderPass!=="shadow")K1(f,c,_,Z,Q,V),F();else{for(let re of Q)kf(re.mesh,re.nodeModelMatrix,f,c);for(let re of Z)kf(re.mesh,re.nodeModelMatrix,f,c);F()}}},d_={line:function(f,r,c){if(f.hasElevatedBuckets=!1,f.hasNonElevatedBuckets=!1,f._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||f._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(r){let p=r.getVisibleCoordinates();for(let _ of p){let y=r.getTile(_).getBucket(f);if(y&&(y.elevationType!=="none"?f.hasElevatedBuckets=!0:f.hasNonElevatedBuckets=!0,f.hasElevatedBuckets&&f.hasNonElevatedBuckets))break}}}else f.hasNonElevatedBuckets=!0},model:function(f,r,c){let p=r.getSource();if(!p.loaded())return;if(p.type==="vector"||p.type==="geojson"){let y=l_(p,f,c.style._importedAsBasemap);return void(c.modelManager&&c.modelManager.upload(c,y))}if(p.type==="batched-model"||p.type!=="model")return;let _=p.getModels();for(let y of _)y.upload(c.context)},raster:function(f,r,c){let p=r.getSource();if(!(p instanceof yo&&p.loaded()))return;let _=f.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!_)return;let y=f.paint.get("raster-array-band")||p.getInitialBand(_);if(y==null)return;let x=r.getIds().map(C=>r.getTileByID(C));for(let C of x)C.updateNeeded(f.id,y)&&p.prepareTile(C,_,f.id,y)},"raster-particle":function(f,r,c){let p=r.getSource();if(!(p instanceof yo&&p.loaded()))return;let _=f.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!_)return;let y=f.paint.get("raster-particle-array-band")||p.getInitialBand(_);if(y==null)return;let x=r.getIds().map(C=>r.getTileByID(C));for(let C of x)C.updateNeeded(f.id,y)&&p.prepareTile(C,_,f.id,y)}},h_={fill:_h},Qa={fill:function(f,r,c,p){if(!c.layout||c.layout.get("fill-elevation-reference")==="none"||c.paint.get("fill-opacity").constantOr(1)===0)return;let _=f.context.gl,y=new Vt(_.LEQUAL,Vt.ReadOnly,f.depthRangeFor3D),x=new mn({func:_.ALWAYS,mask:255},255,255,_.KEEP,_.KEEP,_.REPLACE),C=f.transform.getFreeCameraOptions().position,T=f.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(let M of p){let P=r.getTile(M),F=P.getBucket(c);if(!F)continue;let O=F.elevatedStructures;if(!O||O.depthSegments.segments[0].primitiveLength===0)continue;let z=G1(M.toUnwrapped(),C),V=f.translatePosMatrix(M.projMatrix,P,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor")),H=Zg(V,z,0,1,0);T.draw(f,_.TRIANGLES,y,x,In.disabled,dn.disabled,H,c.id,O.vertexBuffer,O.indexBuffer,O.depthSegments,c.paint,f.transform.zoom)}}};class ld{constructor(r,c,p,_,y,x){this.context=new n_(r,c),this.transform=p,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=y,this._timeStamp=o.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};let C=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(let M of C)this._debugParams.enabledLayers[M]=!0;y.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),y.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),y.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),y.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),y.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),y.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(let M of C)y.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],M);this.occlusionParams=new UD(y),this.setup(),this.numSublayers=Ia.maxUnderzooming+Ia.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new o.eO,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new ch(this),this._wireframeDebugCache=new tw,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];let T=new o.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new o.T(this.context,T,r.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=_,this.worldview=x}updateTerrain(r,c){let p=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new sm(this,r));let _=this._terrain;this.transform.elevation=p?_:null,_.update(r,this.transform,c),this.transform.elevation&&!_.enabled&&(this.transform.elevation=null)}_updateFog(r){let c=r.fog;if(!c||this.transform.projection.name==="globe"||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[p,_]=c.getFovAdjustedRange(this.transform._fov);if(p>_)return void(this.transform.fogCullDistSq=null);let y=p+.78*(_-p);this.transform.fogCullDistSq=y*y}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(r){r&&!this._terrain&&(this._terrain=new sm(this,this.style)),this._forceTerrainMode=r}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(r,c){if(this.width=r*o.o.devicePixelRatio,this.height=c*o.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let p of this.style.order)this.style._mergedLayers[p].resize()}setup(){let r=this.context,c=new o.bc;c.emplaceBack(0,0),c.emplaceBack(o.al,0),c.emplaceBack(0,o.al),c.emplaceBack(o.al,o.al),this.tileExtentBuffer=r.createVertexBuffer(c,o.be.members),this.tileExtentSegments=o.bf.simpleSegment(0,0,4,2);let p=new o.bc;p.emplaceBack(0,0),p.emplaceBack(o.al,0),p.emplaceBack(0,o.al),p.emplaceBack(o.al,o.al),this.debugBuffer=r.createVertexBuffer(p,o.be.members),this.debugSegments=o.bf.simpleSegment(0,0,4,5);let _=new o.bc;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(_,o.be.members),this.viewportSegments=o.bf.simpleSegment(0,0,4,2);let y=new o.a$;y.emplaceBack(0,0,0,0),y.emplaceBack(o.al,0,o.al,0),y.emplaceBack(0,o.al,0,o.al),y.emplaceBack(o.al,o.al,o.al,o.al),this.mercatorBoundsBuffer=r.createVertexBuffer(y,o.bh.members),this.mercatorBoundsSegments=o.bf.simpleSegment(0,0,4,2);let x=new o.b0;x.emplaceBack(0,1,2),x.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(x);let C=new o.bd;for(let M of[0,1,3,2,0])C.emplaceBack(M);this.debugIndexBuffer=r.createIndexBuffer(C),this.emptyTexture=new o.T(r,new o.q({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA8),this.identityMat=o.bB();let T=this.context.gl;this.stencilClearMode=new mn({func:T.ALWAYS,mask:0},0,255,T.ZERO,T.ZERO,T.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let r=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,r.TRIANGLES,Vt.disabled,this.stencilClearMode,In.disabled,dn.disabled,mh(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,c,p){if(!c||this.currentStencilSource===c.id||!r.isTileClipped()||!p||p.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let C=!1;for(let T of p)if(this._tileClippingMaskIDs[T.key]===void 0){C=!0;break}if(!C)return}this.currentStencilSource=c.id;let _=this.context,y=_.gl;this.nextStencilID+p.length>256&&this.clearStencil(),_.setColorMode(In.disabled),_.setDepthMode(Vt.disabled);let x=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(let C of p){let T=c.getTile(C),M=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,{tileBoundsBuffer:P,tileBoundsIndexBuffer:F,tileBoundsSegments:O}=this.getTileBoundsBuffers(T);x.draw(this,y.TRIANGLES,Vt.disabled,new mn({func:y.ALWAYS,mask:0},M,255,y.KEEP,y.KEEP,y.REPLACE),In.disabled,dn.disabled,mh(C.projMatrix),"$clipping",P,F,O)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let r=this.nextStencilID++,c=this.context.gl;return new mn({func:c.NOTEQUAL,mask:255},r,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);let c=this.context.gl;return new mn({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(r){let c=this.context.gl,p=r.sort((x,C)=>C.overscaledZ-x.overscaledZ),_=p[p.length-1].overscaledZ,y=p[0].overscaledZ-_+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();let x={};for(let C=0;C<y;C++)x[C+_]=new mn({func:c.GEQUAL,mask:255},C+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=y,[x,p]}return[{[_]:mn.disabled},p]}colorModeForRenderPass(){let r=this.context.gl;return this._showOverdrawInspector?new In([r.CONSTANT_COLOR,r.ONE,r.CONSTANT_COLOR,r.ONE],new o.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?In.unblended:In.alphaBlended}colorModeForDrapableLayerRenderPass(r){let c=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new In([c.ONE,c.ONE_MINUS_SRC_ALPHA,c.CONSTANT_ALPHA,c.ONE_MINUS_SRC_ALPHA],new o.ao(0,0,0,r===void 0?0:r),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(r,c,p,_=!1){if(this.depthOcclusion)return new Vt(this.context.gl.GREATER,Vt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!_)return Vt.disabled;let y=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new Vt(p||this.context.gl.LEQUAL,c,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){let r=this.context.gl,c=Math.ceil(this.width),p=Math.ceil(this.height),_=this.context.bindFramebuffer.get(),y=r.getParameter(r.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===c&&this.depthFBO.height===p||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),c!==0&&p!==0&&(this.depthFBO=new t_(this.context,c,p,!1,"texture"),this.depthTexture=new o.T(this.context,{width:c,height:p,data:null},r.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(_),r.bindTexture(r.TEXTURE_2D,y),this.depthFBO&&(r.bindFramebuffer(r.READ_FRAMEBUFFER,null),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),r.blitFramebuffer(0,0,c,p,0,0,c,p,r.DEPTH_BUFFER_BIT,r.NEAREST),r.bindFramebuffer(r.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((r,c)=>r+c/this._fpsHistory.length,0))}render(r,c){let p=o.o.now();this._dt=p-this._timeStamp,this._timeStamp=p,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=r.map.repaint,this.style=r,this.options=c;let _=this.style._mergedLayers,y=!(!this.terrain||!this.terrain.enabled),x=()=>this.style._getOrder(y).filter(Le=>{let Te=_[Le];return!(Te.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Te.type]}),C=x(),T=!1,M=!1,P=null;for(let Le of C){let Te=_[Le];Te.type==="circle"?T=!0:Te.type==="building"?P=Te:Te.type==="symbol"&&(Te.hasOcclusionOpacityProperties?M=!0:T=!0)}let F=C.map(Le=>_[Le]),O=this.style._mergedSourceCaches;this.imageManager=r.imageManager,this.modelManager=r.modelManager,this.symbolFadeChange=r.placement.symbolFadeChange(o.o.now()),this.imageManager.beginFrame();let z=0,V=!1;for(let Le in O){let Te=O[Le];Te.used&&(Te.prepare(this.context),Te.getSource().usedInConflation&&++z)}let H=!1;for(let Le of F)Le.isHidden(this.transform.zoom)||(Le.type==="clip"&&(H=!0),this.prepareLayer(Le));let K={},Z={},Q={},ae={},re={};for(let Le in O){let Te=O[Le];K[Le]=Te.getVisibleCoordinates(),Z[Le]=K[Le].slice().reverse(),Q[Le]=Te.getVisibleCoordinates(!0).reverse(),ae[Le]=Te.getShadowCasterCoordinates(),re[Le]=Te.sortCoordinatesByDistance(K[Le])}let ge=Le=>{let Te=this.style.getLayerSourceCache(Le);return Te&&Te.used?Te.getSource():null};if(z||H||this._clippingActiveLastFrame){let Le=[],Te=[],Je=0;for(let Ue of F)this.isSourceForClippingOrConflation(Ue,ge(Ue))&&(Le.push(Ue),Te.push(Je)),Je++;if(Le&&(H||Le.length>1)||this._clippingActiveLastFrame){H=!1;let Ue=[];for(let at=0;at<Le.length;at++){let bt=Le[at],jt=Te[at],mt=this.style.getLayerSourceCache(bt);if(!mt||!mt.used||!mt.getSource().usedInConflation&&bt.type!=="clip"&&bt.type!=="building")continue;let xt=o.eP,$t=o.bZ.None,Ft=[],At=!0;if(bt.type==="building")xt=o.eR;else if(bt.type==="clip"){xt=jt;for(let Lt of bt.layout.get("clip-layer-types"))$t|=Lt==="model"?o.bZ.Model:Lt==="symbol"?o.bZ.Symbol:o.bZ.FillExtrusion;for(let Lt of bt.layout.get("clip-layer-scope"))Ft.push(Lt);bt.isHidden(this.transform.zoom)?At=!1:H=!0}At&&Ue.push({layer:bt.fqid,cache:mt,order:xt,clipMask:$t,clipScope:Ft})}this.replacementSource.setSources(Ue),V=!0}}this._clippingActiveLastFrame=H,V||this.replacementSource.clear(),this.conflationActive=V,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Le=0;Le<F.length;Le++){let Te=F[Le],Je=Te.cutoffRange();if(this.longestCutoffRange=Math.max(Je,this.longestCutoffRange),Je>0){let Ue=ge(Te);Ue&&(this.minCutoffZoom=Math.max(Ue.minzoom,this.minCutoffZoom)),Te.minzoom&&(this.minCutoffZoom=Math.max(Te.minzoom,this.minCutoffZoom))}Te.is3D(y)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Le),this._lastOcclusionLayer=Le)}let ce=this.style&&this.style.fog;ce?(this._fogVisible=ce.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=ce.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(Q),this.opaquePassCutoff=0,C=x(),F=C.map(Le=>_[Le]));let ve=this._shadowRenderer;if(ve){ve.updateShadowParameters(this.transform,this.style.directionalLight);for(let Le in O)for(let Te of K[Le]){let Je={min:0,max:0};this.terrain&&(Je=this.terrain.getMinMaxForTile(Te)||Je),ve.addShadowReceiver(Te.toUnwrapped(),Je.min,Je.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.eQ(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Rr(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);let me=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),he=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(me&&!this._snow&&(this._snow=new dy(this)),!me&&this._snow&&(this._snow.destroy(),delete this._snow),he&&!this._rain&&(this._rain=new Lf(this)),!he&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),P){this.buildingTileBorderManager||(this.buildingTileBorderManager=new ke);let Le=this.style.getLayerSourceCache(P);this.buildingTileBorderManager.updateBorders(Le,P)}if(!pr.has(this.context.gl))return;this.renderPass="offscreen";for(let Le of F){let Te=r.getLayerSourceCache(Le);if(!Le.hasOffscreenPass()||Le.isHidden(this.transform.zoom))continue;let Je=Te?Z[Te.id]:void 0;(Le.type==="custom"||Le.type==="raster"||Le.type==="raster-particle"||Le.isSky()||Je&&Je.length)&&this.renderLayer(this,Te,Le,Je)}this.depthRangeFor3D=[0,1-(F.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,ae)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let xe=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Re=(()=>{if(c.showOverdrawInspector)return o.ao.black;let Le=this.style.fog;if(Le&&this.transform.projection.supportsFog){let Te=this.style.getLut(Le.scope);if(!xe){let Je=Le.properties.get("color-use-theme")==="none",Ue=Le.properties.get("color").toNonPremultipliedRenderColor(Je?null:Te).toArray01();return new o.ao(...Ue)}if(xe){let Je=Le.properties.get("space-color-use-theme")==="none",Ue=Le.properties.get("space-color").toNonPremultipliedRenderColor(Je?null:Te).toArray01();return new o.ao(...Ue)}}return o.ao.transparent})();if(this.context.clear({color:Re,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&xe&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=C.length-1;this.currentLayer>=0;this.currentLayer--){let Le=F[this.currentLayer],Te=r.getLayerSourceCache(Le);if(Le.isSky())continue;let Je=Te?(Le.is3D(y)?re:Z)[Te.id]:void 0;this._renderTileClippingMasks(Le,Te,Je),this.renderLayer(this,Te,Le,Je)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&xe&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||o.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<C.length;this.currentLayer++){let Le=F[this.currentLayer],Te=r.getLayerSourceCache(Le);Le.isSky()&&this.renderLayer(this,Te,Le,Te?Z[Te.id]:void 0)}function Ie(Le,Te){let Je;return Te&&(Je=(Le.type==="symbol"?Q:Le.is3D(y)?re:Z)[Te.id]),Je}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<C.length;){let Le=F[this.currentLayer];if(Le.type==="raster"||Le.type==="raster-particle"){let Te=r.getLayerSourceCache(Le);this.renderLayer(this,Te,Le,Ie(Le,Te))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let qe=0;ve&&(qe=ve.getShadowCastingLayerCount());let je=!1,Ke=-1;for(let Le=0;Le<C.length;++Le){let Te=F[Le];Te.isHidden(this.transform.zoom)||Te.is3D(y)&&(Ke=Le)}M&&Ke===-1&&(T=!0);let _t=!1;for(;this.currentLayer<C.length;){let Le=F[this.currentLayer],Te=r.getLayerSourceCache(Le);if(Le.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Le)){if(Le.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!_t&&Le.is3D(y)&&!y){let Je=this.currentLayer,Ue=at=>{for(this.currentLayer=0;this.currentLayer<F.length;this.currentLayer++){let bt=F[this.currentLayer];if(h_[bt.type]){let jt=this.style.getLayerSourceCache(bt);h_[bt.type](this,jt,bt,Ie(bt,jt),at)}}};Ue("initialize"),Ue("reset"),this.currentLayer=Je,_t=!0}if(T&&!je&&this.terrain&&!this.transform.isOrthographic&&(je=!0,this.blitDepth()),M&&Ke!==-1&&this.currentLayer===Ke+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Le,Te,Te?K[Te.id]:void 0),this.renderLayer(this,Te,Le,Ie(Le,Te)),!this.terrain&&ve&&qe>0&&Le.hasShadowPass()&&--qe==0){{this.clearStencil(),this.resetStencilClippingMasks();let Je=this.currentLayer;for(this.currentLayer=0;this.currentLayer<F.length;this.currentLayer++){let Ue=F[this.currentLayer];if(Qa[Ue.type]){let at=this.style.getLayerSourceCache(Ue);Qa[Ue.type](this,at,Ue,Ie(Ue,at))}}this.currentLayer=Je}if(ve.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){let Je=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Je;this.currentLayer++){let Ue=F[this.currentLayer];if(!Ue.hasLightBeamPass())continue;let at=r.getLayerSourceCache(Ue);this.renderLayer(this,at,Ue,at?Z[at.id]:void 0)}this.currentLayer=Je,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){let Je=this.currentLayer;this.depthOcclusion=!0;for(let Ue of this.layersWithOcclusionOpacity){this.currentLayer=Ue;let at=F[this.currentLayer],bt=r.getLayerSourceCache(at),jt=bt?Z[bt.id]:void 0;this.terrain||this._renderTileClippingMasks(at,bt,bt?K[bt.id]:void 0),this.renderLayer(this,bt,at,jt)}this.depthOcclusion=!1,this.currentLayer=Je,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Le=null;F.forEach(Te=>{let Je=r.getLayerSourceCache(Te);Je&&!Te.isHidden(this.transform.zoom)&&Je.getVisibleCoordinates().length&&(!Le||Le.getSource().maxzoom<Je.getSource().maxzoom)&&(Le=Je)}),Le&&this.options.showTileBoundaries&&oy(this,Le,Le.getVisibleCoordinates(),o.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&oy(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new o.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&(function(Le){let Te=Le.transform.padding;or(Le,Le.transform.height-(Te.top||0),3,ad),or(Le,Te.bottom||0,3,Z1),dm(Le,Te.left||0,3,ny),dm(Le,Le.transform.width-(Te.right||0),3,iy);let Je=Le.transform.centerPoint;(function(Ue,at,bt,jt){Af(Ue,at-1,bt-10,2,20,jt),Af(Ue,at-10,bt-1,20,2,jt)})(Le,Je.x,Le.transform.height-Je.y,ry)})(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),V||(this.conflationActive=!1)}prepareLayer(r){this.gpuTimingStart(r);let{unsupportedLayers:c}=this.transform.projection,p=!c||!c.includes(r.type);if(d_[r.type]&&(p||this.terrain&&r.type==="custom")){let _=this.style.getLayerSourceCache(r);d_[r.type](r,_,this)}this.gpuTimingEnd()}renderLayer(r,c,p,_){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="sky"||p.type==="custom"||p.type==="model"||p.type==="raster"||p.type==="raster-particle"||_&&_.length)&&(this.id=p.id,this.gpuTimingStart(p),r.transform.projection.unsupportedLayers&&r.transform.projection.unsupportedLayers.includes(p.type)&&(!r.terrain||p.type!=="custom")||p.type==="clip"||hy[p.type](r,c,p,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;let c=this.context.extTimerQuery,p=this.context.gl,_=this.gpuTimers[r.id];_||(_=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:p.createQuery()}),_.calls++,p.beginQuery(c.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let r=this.context.extTimerQuery,c=this.context.gl,p=c.createQuery();this.deferredRenderGpuTimeQueries.push(p),c.beginQuery(r.TIME_ELAPSED_EXT,p)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){let r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){let r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){let c={};for(let p in r){let _=r[p],y=this.context.extTimerQuery,x=y.getQueryParameter(_.query,this.context.gl.QUERY_RESULT)/1e6;y.deleteQueryEXT(_.query),c[p]=x}return c}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;let c=this.context.gl,p=0;for(let _ of r)p+=c.getQueryParameter(_,c.QUERY_RESULT)/1e6,c.deleteQuery(_);return p}translatePosMatrix(r,c,p,_,y){if(!p[0]&&!p[1])return r;let x=y?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(x){let M=Math.sin(x),P=Math.cos(x);p=[p[0]*P-p[1]*M,p[0]*M+p[1]*P]}let C=[y?p[0]:o.ay(c,p[0],this.transform.zoom),y?p[1]:o.ay(c,p[1],this.transform.zoom),0],T=new Float32Array(16);return o.bq(T,r,C),T}saveTileTexture(r){if(r.context!==this.context)return;let c=r.size[0],p=this._tileTextures[c];p?p.push(r):this._tileTextures[c]=[r]}getTileTexture(r){let c=this._tileTextures[r];return c&&c.length>0?c.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(r,c,p){let _=p===void 0?this.terrain&&this.terrain.renderingToTexture:p,y=[];return this.style&&this.style.enable3dLights()&&(r==="globeRaster"||r==="terrainRaster"?(y.push("LIGHTING_3D_MODE"),y.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):_||y.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||y.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(y.push("TERRAIN"),this.linearFloatFilteringSupported()&&y.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&y.push("GLOBE"),!this._fogVisible||_||c!==void 0&&!c||y.push("FOG","FOG_DITHERING"),_&&y.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&y.push("OVERDRAW_INSPECTOR"),y}getOrCreateProgram(r,c){this.cache=this.cache||{};let p=c&&c.defines||[],_=c&&c.config,y=this.currentGlobalDefines(r,c&&c.overrideFog,c&&c.overrideRtt).concat(p),x=am.cacheKey(Qc[r],r,y,_);return this.cache[x]||(this.cache[x]=new am(this.context,r,Qc[r],_,ND[r],y)),this.cache[x]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(r,c){if(this.style.enable3dLights()){let p=this.style.directionalLight,_=this.style.ambientLight;if(p&&_){let y=((x,C,T)=>{let M=x.properties.get("direction"),P=x.properties.get("color-use-theme")==="none",F=x.properties.get("color").toNonPremultipliedRenderColor(P?null:T.getLut(x.scope)).toArray01(),O=x.properties.get("intensity"),z=C.properties.get("color-use-theme")==="none",V=C.properties.get("color").toNonPremultipliedRenderColor(z?null:T.getLut(C.scope)).toArray01(),H=C.properties.get("intensity"),K=[M.x,M.y,M.z],Z=o.dM(V,H),Q=o.dM(F,O);return{u_lighting_ambient_color:Z,u_lighting_directional_dir:K,u_lighting_directional_color:Q,u_ground_radiance:jv(K,Q,Z)}})(p,_,this.style);c.setLightsUniformValues(r,y)}}}uploadCommonUniforms(r,c,p,_,y){if(this.uploadCommonLightUniforms(r,c),this.terrain&&this.terrain.renderingToTexture)return;let x=this.style.fog;if(x){let C=x.getOpacity(this.transform.pitch),T=((M,P,F,O,z,V,H,K,Z,Q,ae,re)=>{let ge=M.transform,ce=P.properties.get("color-use-theme")==="none",ve=P.properties.get("color").toNonPremultipliedRenderColor(ce?null:M.style.getLut(P.scope)).toArray01();ve[3]=O;let me=M.frameCounter/1e3%1,[he,xe]=P.properties.get("vertical-range");return{u_fog_matrix:F?ge.calculateFogTileMatrix(F):re||M.identityMat,u_fog_range:P.getFovAdjustedRange(ge._fov),u_fog_color:ve,u_fog_horizon_blend:P.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(he,xe),xe],u_fog_temporal_offset:me,u_frustum_tl:z,u_frustum_tr:V,u_frustum_br:H,u_frustum_bl:K,u_globe_pos:Z,u_globe_radius:Q,u_viewport:ae,u_globe_transition:o.aj(ge.zoom),u_is_globe:+(ge.projection.name==="globe")}})(this,x,p,C,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.o.devicePixelRatio,this.transform.height*o.o.devicePixelRatio],_);c.setFogUniformValues(r,T)}y&&c.setCutoffUniformValues(r,y.uniformValues)}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){let r=this.canvasCopy();r&&(this.frameCopies.push(r),this.tileLoaded=!1)}canvasCopy(){let r=this.context.gl,c=r.createTexture();return r.bindTexture(r.TEXTURE_2D,c),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let r=this.style&&this.style.fog;return!!r&&r.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let r=this._backgroundTiles,c=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(let _ of p)c[_.key]=r[_.key]||new vl(_,512,this.transform.tileZoom,this,void 0,this.worldview);return c}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(r,c){return!(!r.is3D(!(!this.terrain||!this.terrain.enabled))||r.type!=="clip"&&r.type!=="building"&&(r.minzoom&&r.minzoom>this.transform.zoom||(this.style._clipLayerPresent||r.sourceLayer!=="building"&&r.sourceLayer!=="procedural_buildings")&&(!c||c.type!=="batched-model")))}isTileAffectedByFog(r){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let c=this._cachedTileFogOpacities[r.key];return c||(this._cachedTileFogOpacities[r.key]=c=this.style.fog.getOpacityForTile(r)),c[0]>=Ve||c[1]>=Ve}setupDepthForOcclusion(r,c,p){let _=this.context,y=_.gl,x=!!p;var C;p||(p={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),_.activeTexture.set(y.TEXTURE3),r&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),p.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],p.u_depth_range_unpack=[2/((C=this.depthRangeFor3D)[1]-C[0]),-1-2*C[0]/(C[1]-C[0])],p.u_occluder_half_size=.5*this.occlusionParams.occluderSize,p.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),_.activeTexture.set(y.TEXTURE0),x||c.setTerrainUniformValues(_,p)}}function bh(f,r){let c=!1,p=null,_=()=>{p=null,c&&(f(),p=setTimeout(_,r),c=!1)};return()=>(c=!0,p||_(),p)}class f_{constructor(r){this._hashName=r&&encodeURIComponent(r),o.aX(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=bh(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let r=this._map;if(!r)return"";let c=p_(r);if(this._hashName){let p=this._hashName,_=!1,y=location.hash.slice(1).split("&").map(x=>{let C=x.split("=")[0];return C===p?(_=!0,`${C}=${c}`):x}).filter(x=>x);return _||y.push(`${p}=${c}`),`#${y.join("&")}`}return`#${c}`}_getCurrentHash(){let r=location.hash.replace("#","");if(this._hashName){let c;return r.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(c=p)}),(c&&c[1]||"").split("/")}return r.split("/")}_onHashChange(){let r=this._map;if(!r)return!1;let c=this._getCurrentHash();if(c.length>=3&&!c.some(p=>isNaN(Number(p)))){let p=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(c[3]||0):r.getBearing();return r.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:p,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function p_(f,r){let c=f.getCenter(),p=Math.round(100*f.getZoom())/100,_=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,_),x=Math.round(c.lng*y)/y,C=Math.round(c.lat*y)/y,T=f.getBearing(),M=f.getPitch(),P=r?`/${x}/${C}/${p}`:`${p}/${C}/${x}`;return(T||M)&&(P+="/"+Math.round(10*T)/10),M&&(P+=`/${Math.round(M)}`),P}let Nf={linearity:.3,easing:o.eS(0,0,.3,1)},cd=Object.assign({deceleration:2500,maxSpeed:1400},Nf),fy=Object.assign({deceleration:20,maxSpeed:1400},Nf),Sl=Object.assign({deceleration:1e3,maxSpeed:360},Nf),py=Object.assign({deceleration:1e3,maxSpeed:90},Nf);class m_{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.o.now(),settings:r})}_drainInertiaBuffer(){let r=this._inertiaBuffer,c=o.o.now();for(;r.length>0&&c-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let c={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:y}of this._inertiaBuffer)c.zoom+=y.zoomDelta||0,c.bearing+=y.bearingDelta||0,c.pitch+=y.pitchDelta||0,y.panDelta&&c.pan._add(y.panDelta),y.around&&(c.around=y.around),y.pinchAround&&(c.pinchAround=y.pinchAround);let p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(c.pan.mag()){let y=Bf(c.pan.mag(),p,Object.assign({},cd,r||{}));_.offset=c.pan.mult(y.amount/c.pan.mag()),_.center=this._map.transform.center,zf(_,y)}if(c.zoom){let y=Bf(c.zoom,p,fy);_.zoom=this._map.transform.zoom+y.amount,zf(_,y)}if(c.bearing){let y=Bf(c.bearing,p,Sl);_.bearing=this._map.transform.bearing+o.aA(y.amount,-179,179),zf(_,y)}if(c.pitch){let y=Bf(c.pitch,p,py);_.pitch=this._map.transform.pitch+y.amount,zf(_,y)}if(_.zoom||_.bearing){let y=c.pinchAround===void 0?c.around:c.pinchAround;_.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),_.noMoveStart=!0,_}}function zf(f,r){(!f.duration||f.duration<r.duration)&&(f.duration=r.duration,f.easing=r.easing)}function Bf(f,r,c){let{maxSpeed:p,linearity:_,deceleration:y}=c,x=o.aA(f*_/(r/1e3),-p,p),C=Math.abs(x)/(y*_);return{easing:c.easing,duration:1e3*C,amount:x*(C/2)}}class mr extends o.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,c,p,_={}){let y=rr(c.getCanvasContainer(),p),x=c.unproject(y);super(r,Object.assign({point:y,lngLat:x,originalEvent:p},_)),this._defaultPrevented=!1,this.target=c}}class jf extends o.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,c,p){let _=r==="touchend"?p.changedTouches:p.touches,y=Vi(c.getCanvasContainer(),_),x=y.map(T=>c.unproject(T)),C=y.reduce((T,M,P,F)=>T.add(M.div(F.length)),new o.P(0,0));super(r,{points:y,point:C,lngLats:x,lngLat:c.unproject(C),originalEvent:p}),this._defaultPrevented=!1}}class my extends o.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,c){super("wheel",{originalEvent:c}),this._defaultPrevented=!1}}class gy{constructor(r,c){this._map=r,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new my(this._map,r))}mousedown(r,c){return this._mousedownPos=c,this._firePreventable(new mr(r.type,this._map,r))}mouseup(r){this._map.fire(new mr(r.type,this._map,r))}preclick(r){let c=new MouseEvent("preclick",r);this._map.fire(new mr(c.type,this._map,c))}click(r,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(r),this._map.fire(new mr(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new mr(r.type,this._map,r))}mouseover(r){this._map.fire(new mr(r.type,this._map,r))}mouseout(r){this._map.fire(new mr(r.type,this._map,r))}touchstart(r){return this._firePreventable(new jf(r.type,this._map,r))}touchmove(r){this._map.fire(new jf(r.type,this._map,r))}touchend(r){this._map.fire(new jf(r.type,this._map,r))}touchcancel(r){this._map.fire(new jf(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class wh{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new mr(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new mr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new mr(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class _y{constructor(r,c){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,c){this.isEnabled()&&r.shiftKey&&r.button===0&&(Cn(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(r,c){if(!this._active)return;let p=c,_=this._startPos,y=this._lastPos;if(!_||!y||y.equals(p)||!this._box&&p.dist(_)<this._clickTolerance)return;this._lastPos=p,this._box||(this._box=Ae("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));let x=Math.min(_.x,p.x),C=Math.max(_.x,p.x),T=Math.min(_.y,p.y),M=Math.max(_.y,p.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${x}px,${T}px)`,this._box.style.width=C-x+"px",this._box.style.height=M-T+"px")})}mouseupWindow(r,c){if(!this._active)return;let p=this._startPos,_=c;if(p&&r.button===0){if(this.reset(),Vn(),p.x!==_.x||p.y!==_.y)return this._map.fire(new o.z("boxzoomend",{originalEvent:r})),{cameraAnimation:y=>y.fitScreenCoordinates(p,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Xn(),delete this._startPos,delete this._lastPos}_fireEvent(r,c){return this._map.fire(new o.z(r,{originalEvent:c}))}}function pm(f,r){let c={};for(let p=0;p<f.length;p++)c[f[p].identifier]=r[p];return c}class vy{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,c,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=r.timeStamp),p.length===this.numTouches&&(this.centroid=(function(_){let y=new o.P(0,0);for(let x of _)y._add(x);return y.div(_.length)})(c),this.touches=pm(p,c)))}touchmove(r,c,p){if(this.aborted||!this.centroid)return;let _=pm(p,c);for(let y in this.touches){let x=_[y];(!x||x.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(r,c,p){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){let _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class ud{constructor(r){this.singleTap=new vy(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,c,p){this.singleTap.touchstart(r,c,p)}touchmove(r,c,p){this.singleTap.touchmove(r,c,p)}touchend(r,c,p){let _=this.singleTap.touchend(r,c,p);if(_){let y=r.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(_)<30;if(y&&x||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class yy{constructor(){this._zoomIn=new ud({numTouches:1,numTaps:2}),this._zoomOut=new ud({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,c,p){this._zoomIn.touchstart(r,c,p),this._zoomOut.touchstart(r,c,p)}touchmove(r,c,p){this._zoomIn.touchmove(r,c,p),this._zoomOut.touchmove(r,c,p)}touchend(r,c,p){let _=this._zoomIn.touchend(r,c,p),y=this._zoomOut.touchend(r,c,p);return _?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()+1,around:x.unproject(_)},{originalEvent:r})}):y?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()-1,around:x.unproject(y)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let g_={0:1,2:2},__={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Vf{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,c){return!1}_move(r,c){return{}}mousedown(r,c){if(this._lastPoint)return;let p=Er(r);this._correctButton(r,p)&&(this._lastPoint=c,this._eventButton=p)}mousemoveWindow(r,c){let p=this._lastPoint;if(p){if(r.preventDefault(),this._eventButton!=null&&(function(_,y){let x=g_[y];return _.buttons===void 0||(_.buttons&x)!==x})(r,this._eventButton))this.reset();else if(this._moved||!(c.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(p,c)}}mouseupWindow(r){this._lastPoint&&Er(r)===this._eventButton&&(this._moved&&Vn(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xy extends Vf{mousedown(r,c){super.mousedown(r,c),this._lastPoint&&(this._active=!0)}_correctButton(r,c){return c===0&&!r.ctrlKey}_move(r,c){return{around:c,panDelta:c.sub(r)}}}class v_ extends Vf{constructor(r){super(r),this._pitchRotateKey=r.pitchRotateKey?__[r.pitchRotateKey]:void 0}_correctButton(r,c){return this._pitchRotateKey?c===0&&r[this._pitchRotateKey]:c===0&&r.ctrlKey||c===2}_move(r,c){let p=.8*(c.x-r.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(r){this._pitchRotateKey||r.preventDefault()}}class by extends Vf{constructor(r){super(r),this._pitchRotateKey=r.pitchRotateKey?__[r.pitchRotateKey]:void 0}_correctButton(r,c){return this._pitchRotateKey?c===0&&r[this._pitchRotateKey]:c===0&&r.ctrlKey||c===2}_move(r,c){let p=-.5*(c.y-r.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(r){this._pitchRotateKey||r.preventDefault()}}class iw{constructor(r,c){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),o.aX(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}touchstart(r,c,p){return this._calculateTransform(r,c,p)}touchmove(r,c,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(p.length===1&&!o.eT())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.cancelable&&r.preventDefault(),this._calculateTransform(r,c,p)}}touchend(r,c,p){this._calculateTransform(r,c,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,c,p){p.length>0&&(this._active=!0);let _=pm(p,c),y=new o.P(0,0),x=new o.P(0,0),C=0;for(let M in _){let P=_[M],F=this._touches[M];F&&(y._add(P),x._add(P.sub(F)),C++,_[M]=P)}if(this._touches=_,C<this._minTouches||!x.mag())return;let T=x.div(C);return this._sum._add(T),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(C),panDelta:T}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ae("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class y_{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,c,p){return{}}touchstart(r,c,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([c[0],c[1]]))}touchmove(r,c,p){let _=this._firstTwoTouches;if(!_)return;r.preventDefault();let[y,x]=_,C=mm(p,c,y),T=mm(p,c,x);if(!C||!T)return;let M=this._aroundCenter?null:C.add(T).div(2);return this._move([C,T],M,r)}touchend(r,c,p){if(!this._firstTwoTouches)return;let[_,y]=this._firstTwoTouches,x=mm(p,c,_),C=mm(p,c,y);x&&C||(this._active&&Vn(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function mm(f,r,c){for(let p=0;p<f.length;p++)if(f[p].identifier===c)return r[p]}function wy(f,r){return Math.log2(f/r)}class rw extends y_{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,c){let p=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(wy(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:wy(this._distance,p),pinchAround:c}}}function Cy(f,r){return 180*f.angleWith(r)/Math.PI}class ow extends y_{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,c){let p=this._vector;if(this._vector=r[0].sub(r[1]),p&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Cy(this._vector,p),pinchAround:c}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());let c=25/(Math.PI*this._minDiameter)*360,p=this._startVector;if(!p)return!1;let _=Cy(r,p);return Math.abs(_)<c}}function x_(f){return Math.abs(f.y)>Math.abs(f.x)}class sw extends y_{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,x_(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,c,p){let _=this._lastPoints;if(!_)return;let y=r[0].sub(_[0]),x=r[1].sub(_[1]);return this._map._cooperativeGestures&&!o.eT()&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(y,x,p.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(y.y+x.y)/2*-.5})}gestureBeginsVertically(r,c,p){if(this._valid!==void 0)return this._valid;let _=r.mag()>=2,y=c.mag()>=2;if(!_&&!y)return;if(!_||!y)return this._firstMove==null&&(this._firstMove=p),p-this._firstMove<100&&void 0;let x=r.y>0==c.y>0;return x_(r)&&x_(c)&&x}}let aw={panStep:100,bearingStep:15,pitchStep:10};class lw{constructor(){let r=aw;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let c=0,p=0,_=0,y=0,x=0;switch(r.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:r.shiftKey?p=-1:(r.preventDefault(),y=-1);break;case 39:r.shiftKey?p=1:(r.preventDefault(),y=1);break;case 38:r.shiftKey?_=1:(r.preventDefault(),x=-1);break;case 40:r.shiftKey?_=-1:(r.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(p=0,_=0),{cameraAnimation:C=>{let T=C.getZoom();C.easeTo({duration:300,easeId:"keyboardHandler",easing:cw,zoom:c?Math.round(T)+c*(r.shiftKey?2:1):T,bearing:C.getBearing()+p*this._bearingStep,pitch:C.getPitch()+_*this._pitchStep,offset:[-y*this._panStep,-x*this._panStep],center:C.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function cw(f){return f*(2-f)}let uw=4.000244140625,GD=1/450;class qD{constructor(r,c){this._map=r,this._el=r.getCanvasContainer(),this._handler=c,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=GD,o.aX(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||o.eT()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=r.deltaMode===WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY,p=o.o.now(),_=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,c!==0&&c%uw==0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=c,this._timeout=window.setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(_*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),r.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=r,this._delta-=c,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let c=rr(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let r=this._map.transform;this._type==="wheel"&&r.projection.wrap&&(r._center.lng>=180||r._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let c=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(this._delta!==0){let M=this._type==="wheel"&&Math.abs(this._delta)>uw?this._wheelZoomRate:this._defaultZoomRate,P=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&P!==0&&(P=1/P);let F=c(),O=Math.pow(2,F),z=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):O;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(z*P))),this._type==="wheel"&&(this._startZoom=F,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}let p=typeof this._targetZoom=="number"?this._targetZoom:c(),_=this._startZoom,y=this._easing,x,C=!1;if(this._type==="wheel"&&_&&y){let M=Math.min((o.o.now()-this._lastWheelEventTime)/200,1),P=y(M);x=o.ak(_,p,P),M<1?this._frameId||(this._frameId=!0):C=!0}else x=p,C=!0;this._active=!0,C&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let T=x-c();return T*this._lastDelta<0&&(T=0),{noInertia:!0,needsRenderFrame:!C,zoomDelta:T,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let c=o.eU;if(this._prevEase){let p=this._prevEase,_=(o.o.now()-p.start)/p.duration,y=p.easing(_+.01)-p.easing(_),x=.27/Math.sqrt(y*y+1e-4)*.01,C=Math.sqrt(.0729-x*x);c=o.eS(x,C,.25,1)}return this._prevEase={start:o.o.now(),duration:r,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ae("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class wr{constructor(r,c){this._clickZoom=r,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class dw{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,c){return r.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(r.shiftKey?-1:1),around:p.unproject(c)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class WD{constructor(){this._tap=new ud({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,c,p){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=c[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(r,c,p))}touchmove(r,c,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;let _=c[0],y=_.y-this._swipePoint.y;return this._swipePoint=_,r.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(r,c,p)}touchend(r,c,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(r,c,p)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ZD{constructor(r,c,p){this._el=r,this._mousePan=c,this._touchPan=p}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class XD{constructor(r,c,p){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=c,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class gm{constructor(r,c,p,_){this._el=r,this._touchZoom=c,this._touchRotate=p,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let _m=f=>f.zoom||f.drag||f.pitch||f.rotate;class Ey extends o.z{}class b_{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,c){let p=o.av([],c,r);this.radius=o.ag(p[2]<0?o.eW([],p,this.constants):[p[0],p[1],0])}projectRay(r){o.eW(r,r,this.constants),o.aw(r,r),o.eX(r,r,this.constants);let c=o.c4([],r,this.radius);if(c[2]>0){let p=o.c4([],[0,0,1],o.bI(c,[0,0,1])),_=o.c4([],o.aw([],[c[0],c[1],0]),this.radius),y=o.d7([],c,o.c4([],o.av([],o.d7([],_,p),c),2));c[0]=y[0],c[1]=y[1]}return c}}function Dl(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class w_{constructor(r,c){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new m_(r),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new b_,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),o.aX(["handleEvent","handleWindowEvent"],this);let p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(let[_,y,x]of this._listeners){let C=_===document?this.handleWindowEvent:this.handleEvent;_.addEventListener(y,C,x)}}destroy(){for(let[r,c,p]of this._listeners){let _=r===document?this.handleWindowEvent:this.handleEvent;r.removeEventListener(c,_,p)}}_addDefaultHandlers(r){let c=this._map,p=c.getCanvasContainer();this._add("mapEvent",new gy(c,r));let _=c.boxZoom=new _y(c,r);this._add("boxZoom",_);let y=new yy,x=new dw;c.doubleClickZoom=new wr(x,y),this._add("tapZoom",y),this._add("clickZoom",x);let C=new WD;this._add("tapDragZoom",C);let T=c.touchPitch=new sw(c);this._add("touchPitch",T);let M=new v_(r),P=new by(r);c.dragRotate=new XD(r,M,P),this._add("mouseRotate",M,["mousePitch"]),this._add("mousePitch",P,["mouseRotate"]);let F=new xy(r),O=new iw(c,r);c.dragPan=new ZD(p,F,O),this._add("mousePan",F),this._add("touchPan",O,["touchZoom","touchRotate"]);let z=new ow,V=new rw;c.touchZoomRotate=new gm(p,V,z,C),this._add("touchRotate",z,["touchPan","touchZoom"]),this._add("touchZoom",V,["touchPan","touchRotate"]),this._add("blockableMapEvent",new wh(c));let H=c.scrollZoom=new qD(c,this);this._add("scrollZoom",H,["mousePan"]);let K=c.keyboard=new lw;this._add("keyboard",K);for(let Z of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[Z]&&c[Z].enable(r[Z])}_add(r,c,p){this._handlers.push({handlerName:r,handler:c,allowed:p}),this._handlersById[r]=c}stop(r){if(!this._updatingCamera){for(let{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[],this._originalZoom=void 0}}isActive(){for(let{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!_m(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(r,c,p){for(let _ in r)if(_!==p&&(!c||c.indexOf(_)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){let c=[];for(let p of r)this._el.contains(p.target)&&c.push(p);return c}handleEvent(r,c){this._updatingCamera=!0;let p=r.type==="renderFrame",_=p?void 0:r,y={needsRenderFrame:!1},x={},C={},T=r.touches?this._getMapTouches(r.touches):void 0,M=T?Vi(this._el,T):p?void 0:rr(this._el,r);for(let{handlerName:O,handler:z,allowed:V}of this._handlers){if(!z.isEnabled())continue;let H;this._blockedByActive(C,V,O)?z.reset():z[c||r.type]&&(H=z[c||r.type](r,M,T),this.mergeHandlerResult(y,x,H,O,_),H&&H.needsRenderFrame&&this._triggerRenderFrame()),(H||z.isActive())&&(C[O]=z)}let P={};for(let O in this._previousActiveHandlers)C[O]||(P[O]=_);this._previousActiveHandlers=C,(Object.keys(P).length||Dl(y))&&(this._changes.push([y,x,P]),this._triggerRenderFrame()),(Object.keys(C).length||Dl(y))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:F}=y;F&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],F(this._map))}mergeHandlerResult(r,c,p,_,y){if(!p)return;Object.assign(r,p);let x={handlerName:_,originalEvent:p.originalEvent||y};p.zoomDelta!==void 0&&(c.zoom=x),p.panDelta!==void 0&&(c.drag=x),p.pitchDelta!==void 0&&(c.pitch=x),p.bearingDelta!==void 0&&(c.rotate=x)}_applyChanges(){let r={},c={},p={};for(let[_,y,x]of this._changes)_.panDelta&&(r.panDelta=(r.panDelta||new o.P(0,0))._add(_.panDelta)),_.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(r.around=_.around),_.aroundCoord!==void 0&&(r.aroundCoord=_.aroundCoord),_.pinchAround!==void 0&&(r.pinchAround=_.pinchAround),_.noInertia&&(r.noInertia=_.noInertia),Object.assign(c,y),Object.assign(p,x);this._updateMapTransform(r,c,p),this._changes=[]}_updateMapTransform(r,c,p){let _=this._map,y=_.transform,x=Q=>[Q.x,Q.y,Q.z];if((Q=>{let ae=this._eventsInProgress.drag;return ae&&!this._handlersById[ae.handlerName].isActive()})()&&!Dl(r)){let Q=y.zoom;y.cameraElevationReference="sea",this._originalZoom!=null&&y._orthographicProjectionAtLowPitch&&y.projection.name!=="globe"&&y.pitch===0?(y.cameraElevationReference="ground",y.zoom=this._originalZoom):(y.recenterOnTerrain(),y.cameraElevationReference="ground"),Q!==y.zoom&&this._map._update(!0)}if(y._isCameraConstrained&&_._stop(!0),!Dl(r))return void this._fireEvents(c,p,!0);let{panDelta:C,zoomDelta:T,bearingDelta:M,pitchDelta:P,around:F,aroundCoord:O,pinchAround:z}=r;y._isCameraConstrained&&(T>0&&(T=0),y._isCameraConstrained=!1),z!==void 0&&(F=z),(T||(Q=>c[Q]&&!this._eventsInProgress[Q])("drag"))&&F&&(this._dragOrigin=x(y.pointCoordinate3D(F)),this._originalZoom=y.zoom,this._trackingEllipsoid.setup(y._camera.position,this._dragOrigin)),y.cameraElevationReference="sea",_._stop(!0),F=F||_.transform.centerPoint,M&&(y.bearing+=M),P&&(y.pitch+=P),y._updateCameraState();let V=[0,0,0];if(C)if(y.projection.name==="mercator"){let Q=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(F).dir),ae=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(F.sub(C)).dir);V[0]=ae[0]-Q[0],V[1]=ae[1]-Q[1]}else{let Q=y.pointCoordinate(F);if(y.projection.name==="globe"){C=C.rotate(-y.angle);let ae=y._pixelsPerMercatorPixel/y.worldSize;V[0]=-C.x*o.eV(o.a_(Q.y))*ae,V[1]=-C.y*o.eV(y.center.lat)*ae}else{let ae=y.pointCoordinate(F.sub(C));Q&&ae&&(V[0]=ae.x-Q.x,V[1]=ae.y-Q.y)}}let H=y.zoom,K=[0,0,0];if(T){let Q=x(O||y.pointCoordinate3D(F)),ae={dir:o.aw([],o.av([],Q,y._camera.position))};if(ae.dir[2]<0){let re=y.zoomDeltaToMovement(Q,T);o.c4(K,ae.dir,re)}}let Z=o.d7(V,V,K);y._translateCameraConstrained(Z),T&&Math.abs(y.zoom-H)>1e-4&&y.recenterOnTerrain(),y.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(c,p,!0)}_fireEvents(r,c,p){let _=_m(this._eventsInProgress),y=_m(r),x={};for(let P in r){let{originalEvent:F}=r[P];this._eventsInProgress[P]||(x[`${P}start`]=F),this._eventsInProgress[P]=r[P]}!_&&y&&this._fireEvent("movestart",y.originalEvent);for(let P in x)this._fireEvent(P,x[P]);y&&this._fireEvent("move",y.originalEvent);for(let P in r){let{originalEvent:F}=r[P];this._fireEvent(P,F)}let C={},T;for(let P in this._eventsInProgress){let{handlerName:F,originalEvent:O}=this._eventsInProgress[P];this._handlersById[F].isActive()||(delete this._eventsInProgress[P],T=c[F]||O,C[`${P}end`]=T)}for(let P in C)this._fireEvent(P,C[P]);let M=_m(this._eventsInProgress);if(p&&(_||y)&&!M){this._updatingCamera=!0;let P=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=O=>O!==0&&-this._bearingSnap<O&&O<this._bearingSnap;P?(F(P.bearing||this._map.getBearing())&&(P.bearing=0),this._map.easeTo(P,{originalEvent:T})):(this._map.fire(new o.z("moveend",{originalEvent:T})),F(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,c){this._map.fire(new o.z(r,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new Ey("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let io="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class wc extends o.E{constructor(r,c){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=c.bearingSnap,this._respectPrefersReducedMotion=c.respectPrefersReducedMotion!==!1,o.aX(["_renderFrameCallback"],this)}getCenter(){return new o.aS(this.transform.center.lng,this.transform.center.lat)}setCenter(r,c){return this.jumpTo({center:r},c)}panBy(r,c,p){return r=o.P.convert(r).mult(-1),this.panTo(this.transform.center,Object.assign({offset:r},c),p)}panTo(r,c,p){return this.easeTo(Object.assign({center:r},c),p)}getZoom(){return this.transform.zoom}setZoom(r,c){return this.jumpTo({zoom:r},c),this}zoomTo(r,c,p){return this.easeTo(Object.assign({zoom:r},c),p)}zoomIn(r,c){return this.zoomTo(this.getZoom()+1,r,c),this}zoomOut(r,c){return this.zoomTo(this.getZoom()-1,r,c),this}getBearing(){return this.transform.bearing}setBearing(r,c){return this.jumpTo({bearing:r},c),this}getPadding(){return this.transform.padding}setPadding(r,c){return this.jumpTo({padding:r},c),this}rotateTo(r,c,p){return this.easeTo(Object.assign({bearing:r},c),p)}resetNorth(r,c){return this.rotateTo(0,Object.assign({duration:1e3},r),c),this}resetNorthPitch(r,c){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},r),c),this}snapToNorth(r,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,c):this}getPitch(){return this.transform.pitch}setPitch(r,c){return this.jumpTo({pitch:r},c),this}cameraForBounds(r,c){r=o.aI.convert(r);let p=c&&c.bearing||0,_=c&&c.pitch||0,y=r.getNorthWest(),x=r.getSouthEast();return this._cameraForBounds(this.transform,y,x,p,_,c)}_extendPadding(r){let c={top:0,right:0,bottom:0,left:0};return r==null?Object.assign({},c,this.transform.padding):typeof r=="number"?{top:r,bottom:r,right:r,left:r}:Object.assign({},c,r)}_extendCameraOptions(r){return(r=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding=this._extendPadding(r.padding),r}_minimumAABBFrustumDistance(r,c){let p=c.max[0]-c.min[0],_=c.max[1]-c.min[1];return p/_>r.aspect?p/(2*Math.tan(.5*r.fovX)*r.aspect):_/(2*Math.tan(.5*r.fovY)*r.aspect)}_cameraForBoundsOnGlobe(r,c,p,_,y,x){let C=r.clone(),T=this._extendCameraOptions(x);C.bearing=_,C.pitch=y;let M=o.aS.convert(c),P=o.aS.convert(p),F=.5*(M.lat+P.lat),O=.5*(M.lng+P.lng),z=o.eY(F,O),V=o.aw([],z),H=o.aw([],o.bH([],V,[0,1,0])),K=o.bH([],H,V),Z=[H[0],H[1],H[2],0,K[0],K[1],K[2],0,V[0],V[1],V[2],0,0,0,0,1],Q=[z,o.eY(M.lat,M.lng),o.eY(P.lat,M.lng),o.eY(P.lat,P.lng),o.eY(M.lat,P.lng),o.eY(F,M.lng),o.eY(F,P.lng),o.eY(M.lat,O),o.eY(P.lat,O)],ae=o.d8.fromPoints(Q.map(Ue=>[o.bI(H,Ue),o.bI(K,Ue),o.bI(V,Ue)])),re=o.af([],ae.center,Z);o.eZ(re)===0&&o.e_(re,0,0,1),o.aw(re,re),o.c4(re,re,o.aD),C.center=o.e$(re);let ge=C.getWorldToCameraMatrix(),ce=o.bk(new Float64Array(16),ge);ae=o.d8.applyTransform(ae,o.aB([],ge,Z));let ve=this._extendAABB(ae,C,T,_);if(!ve)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ae=ve,o.af(re,re,ge);let me=.5*(ae.max[2]-ae.min[2]),he=this._minimumAABBFrustumDistance(C,ae),xe=o.c4([],[0,0,1],me),Re=o.d7(xe,re,xe),Ie=he+(C.pitch===0?0:o.bF(re,Re)),qe=C.globeCenterInViewSpace,je=o.av([],re,[qe[0],qe[1],qe[2]]);o.aw(je,je),o.c4(je,je,Ie);let Ke=o.d7([],re,je);o.af(Ke,Ke,ce);let _t=o.eL/o.aD,Le=o.ag(Ke),Te=o.ce(Math.max(Le*_t-o.eL,Number.EPSILON),0),Je=Math.min(C.zoomFromMercatorZAdjusted(Te),T.maxZoom);return Je>.5*(o.cZ+o.cK)?(C.setProjection({name:"mercator"}),C.zoom=Je,this._cameraForBounds(C,c,p,_,y,x)):{center:C.center,zoom:Je,bearing:_,pitch:y}}_extendAABB(r,c,p,_){let y=.5*((p.padding.left||0)+(p.padding.right||0)),x=.5*((p.padding.top||0)+(p.padding.bottom||0)),C=x,T=y,M=y,P=x,F=c.width-(T+M),O=c.height-(C+P),z=o.av([],r.max,r.min),V=Math.min(F/z[0],O/z[1]),H=Math.min(c.scaleZoom(c.scale*V),p.maxZoom);if(isNaN(H))return null;let K=c.scale/c.zoomScale(H),Z=new o.d8([r.min[0]-T*K,r.min[1]-P*K,r.min[2]],[r.max[0]+M*K,r.max[1]+C*K,r.max[2]]),Q=(typeof p.offset.x=="number"&&typeof p.offset.y=="number"?new o.P(p.offset.x,p.offset.y):o.P.convert(p.offset)).rotate(-o.an(_));return Z.center[0]-=Q.x*K,Z.center[1]+=Q.y*K,Z}queryTerrainElevation(r,c){let p=this.transform.elevation;return p?(c=Object.assign({},{exaggerated:!0},c),p.getAtPoint(o.ae.fromLngLat(r),null,c.exaggerated)):null}_cameraForBounds(r,c,p,_,y,x){if(r.projection.name==="globe")return this._cameraForBoundsOnGlobe(r,c,p,_,y,x);let C=r.clone(),T=this._extendCameraOptions(x);C.bearing=_,C.pitch=y;let M=o.aS.convert(c),P=o.aS.convert(p),F=new o.aS(M.lng,P.lat),O=new o.aS(P.lng,M.lat),z=C.project(M),V=C.project(P),H=this.queryTerrainElevation(M),K=this.queryTerrainElevation(P),Z=this.queryTerrainElevation(F),Q=this.queryTerrainElevation(O),ae=[[z.x,z.y,Math.min(H||0,K||0,Z||0,Q||0)],[V.x,V.y,Math.max(H||0,K||0,Z||0,Q||0)]],re=o.d8.fromPoints(ae),ge=C.getWorldToCameraMatrix(),ce=o.bk(new Float64Array(16),ge);re=o.d8.applyTransform(re,ge);let ve=this._extendAABB(re,C,T,_);if(!ve)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");re=ve;let me=.5*o.av([],re.max,re.min)[2],he=this._minimumAABBFrustumDistance(C,re),xe=[0,0,1,0];o.aC(xe,xe,ge),o.f0(xe,xe);let Re=o.c4([],xe,he+me),Ie=o.d7([],re.center,Re);o.af(re.center,re.center,ce),o.af(Ie,Ie,ce);let qe=C.unproject(new o.P(re.center[0],re.center[1])),je=o.f1(C.projection,qe),Ke=Math.pow(2,je),_t=Math.min(C._zoomFromMercatorZ(Ie[2]*C.pixelsPerMeter*Ke/C.worldSize),T.maxZoom);return C.mercatorFromTransition&&_t<.5*(o.cZ+o.cK)?(C.setProjection({name:"globe"}),C.zoom=_t,this._cameraForBounds(C,c,p,_,y,x)):{center:qe,zoom:_t,bearing:_,pitch:y}}fitBounds(r,c,p){let _=this.cameraForBounds(r,c);return this._fitInternal(_,c,p)}fitScreenCoordinates(r,c,p,_,y){let x=o.P.convert(r),C=o.P.convert(c),T=new o.P(Math.min(x.x,C.x),Math.min(x.y,C.y)),M=new o.P(Math.max(x.x,C.x),Math.max(x.y,C.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(x,C))return this;let P=this.transform.pointLocation3D(T),F=this.transform.pointLocation3D(M),O=this.transform.pointLocation3D(new o.P(T.x,M.y)),z=this.transform.pointLocation3D(new o.P(M.x,T.y)),V=[Math.min(P.lng,F.lng,O.lng,z.lng),Math.min(P.lat,F.lat,O.lat,z.lat)],H=[Math.max(P.lng,F.lng,O.lng,z.lng),Math.max(P.lat,F.lat,O.lat,z.lat)],K=_&&_.pitch?_.pitch:this.getPitch(),Z=this._cameraForBounds(this.transform,V,H,p,K,_);return this._fitInternal(Z,_,y)}_fitInternal(r,c,p){return r?(c=Object.assign(r,c)).linear?this.easeTo(c,p):this.flyTo(c,p):this}jumpTo(r,c){this.stop();let p=r.preloadOnly?this.transform.clone():this.transform,_=!1,y=!1,x=!1;"zoom"in r&&p.zoom!==+r.zoom&&(_=!0,p.zoom=+r.zoom),r.center!==void 0&&(p.center=o.aS.convert(r.center)),"bearing"in r&&p.bearing!==+r.bearing&&(y=!0,p.bearing=+r.bearing),"pitch"in r&&p.pitch!==+r.pitch&&(x=!0,p.pitch=+r.pitch);let C=typeof r.padding=="number"?this._extendPadding(r.padding):r.padding;if(r.padding!=null&&!p.isPaddingEqual(C))if(r.retainPadding===!1){let T=p.clone();T.padding=C,p.setLocationAtPoint(p.center,T.centerPoint)}else p.padding=C;return r.preloadOnly?(this._preloadTiles(p),this):(this.fire(new o.z("movestart",c)).fire(new o.z("move",c)),_&&this.fire(new o.z("zoomstart",c)).fire(new o.z("zoom",c)).fire(new o.z("zoomend",c)),y&&this.fire(new o.z("rotatestart",c)).fire(new o.z("rotate",c)).fire(new o.z("rotateend",c)),x&&this.fire(new o.z("pitchstart",c)).fire(new o.z("pitch",c)).fire(new o.z("pitchend",c)),this.fire(new o.z("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.w(io),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,c){let p=this.transform;if(!p.projection.supportsFreeCamera)return o.w(io),this;this.stop();let _=p.zoom,y=p.pitch,x=p.bearing;p.setFreeCameraOptions(r);let C=_!==p.zoom,T=y!==p.pitch,M=x!==p.bearing;return this.fire(new o.z("movestart",c)).fire(new o.z("move",c)),C&&this.fire(new o.z("zoomstart",c)).fire(new o.z("zoom",c)).fire(new o.z("zoomend",c)),M&&this.fire(new o.z("rotatestart",c)).fire(new o.z("rotate",c)).fire(new o.z("rotateend",c)),T&&this.fire(new o.z("pitchstart",c)).fire(new o.z("pitch",c)).fire(new o.z("pitchend",c)),this.fire(new o.z("moveend",c)),this}easeTo(r,c){this._stop(!1,r.easeId),((r=Object.assign({offset:[0,0],duration:500,easing:o.eU},r)).animate===!1||this._prefersReducedMotion(r))&&(r.duration=0);let p=this.transform,_=this.getZoom(),y=this.getBearing(),x=this.getPitch(),C=this.getPadding(),T="zoom"in r?+r.zoom:_,M="bearing"in r?this._normalizeBearing(r.bearing,y):y,P="pitch"in r?+r.pitch:x,F=this._extendPadding(r.padding),O=o.P.convert(r.offset),z,V,H;if(p.projection.name==="globe"){let xe=o.ae.fromLngLat(p.center),Re=O.rotate(-p.angle);xe.x+=Re.x/p.worldSize,xe.y+=Re.y/p.worldSize;let Ie=xe.toLngLat(),qe=o.aS.convert(r.center||Ie);this._normalizeCenter(qe),z=p.centerPoint.add(Re),V=new o.P(xe.x,xe.y).mult(p.worldSize),H=new o.P(o.aF(qe.lng),o.aJ(qe.lat)).mult(p.worldSize).sub(V)}else{z=p.centerPoint.add(O);let xe=p.pointLocation(z),Re=o.aS.convert(r.center||xe);this._normalizeCenter(Re),V=p.project(xe),H=p.project(Re).sub(V)}let K=p.zoomScale(T-_),Z,Q;r.around&&(Z=o.aS.convert(r.around),Q=p.locationPoint(Z));let ae=this._zooming||T!==_,re=this._rotating||y!==M,ge=this._pitching||P!==x,ce=!p.isPaddingEqual(F),ve=r.retainPadding===!1?p.clone():p,me=xe=>Re=>{if(ae&&(xe.zoom=o.ak(_,T,Re)),re&&(xe.bearing=o.ak(y,M,Re)),ge&&(xe.pitch=o.ak(x,P,Re)),ce&&(ve.interpolatePadding(C,F,Re),z=ve.centerPoint.add(O)),Z)xe.setLocationAtPoint(Z,Q);else{let Ie=xe.zoomScale(xe.zoom-_),qe=T>_?Math.min(2,K):Math.max(.5,K),je=Math.pow(qe,1-Re),Ke=xe.unproject(V.add(H.mult(Re*je)).mult(Ie));xe.setLocationAtPoint(xe.renderWorldCopies?Ke.wrap():Ke,z)}return r.preloadOnly||this._fireMoveEvents(c),xe};if(r.preloadOnly){let xe=this._emulate(me,r.duration,p);return this._preloadTiles(xe),this}let he={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ae,this._rotating=re,this._pitching=ge,this._padding=ce,this._easeId=r.easeId,this._prepareEase(c,r.noMoveStart,he),this._ease(me(p),xe=>{p.cameraElevationReference==="sea"&&p.recenterOnTerrain(),this._afterEase(c,xe)},r),this}_prepareEase(r,c,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),c||p.moving||this.fire(new o.z("movestart",r)),this._zooming&&!p.zooming&&this.fire(new o.z("zoomstart",r)),this._rotating&&!p.rotating&&this.fire(new o.z("rotatestart",r)),this._pitching&&!p.pitching&&this.fire(new o.z("pitchstart",r))}_fireMoveEvents(r){this.fire(new o.z("move",r)),this._zooming&&this.fire(new o.z("zoom",r)),this._rotating&&this.fire(new o.z("rotate",r)),this._pitching&&this.fire(new o.z("pitch",r))}_afterEase(r,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let p=this._zooming,_=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new o.z("zoomend",r)),_&&this.fire(new o.z("rotateend",r)),y&&this.fire(new o.z("pitchend",r)),this.fire(new o.z("moveend",r))}flyTo(r,c){if(this._prefersReducedMotion(r)){let Ue=o.aH(r,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Ue,c)}this.stop(),r=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:o.eU},r);let p=this.transform,_=this.getZoom(),y=this.getBearing(),x=this.getPitch(),C=this.getPadding(),T="zoom"in r?o.aA(+r.zoom,p.minZoom,p.maxZoom):_,M="bearing"in r?this._normalizeBearing(r.bearing,y):y,P="pitch"in r?+r.pitch:x,F=this._extendPadding(r.padding),O=p.zoomScale(T-_),z=o.P.convert(r.offset),V=p.centerPoint.add(z),H=p.pointLocation(V),K=o.aS.convert(r.center||H);this._normalizeCenter(K);let Z=p.project(H),Q=p.project(K).sub(Z),ae=r.curve,re=Math.max(p.width,p.height),ge=re/O,ce=Q.mag();if("minZoom"in r){let Ue=o.aA(Math.min(r.minZoom,_,T),p.minZoom,p.maxZoom),at=re/p.zoomScale(Ue-_);ae=Math.sqrt(at/ce*2)}let ve=ae*ae;function me(Ue){let at=(ge*ge-re*re+(Ue?-1:1)*ve*ve*ce*ce)/(2*(Ue?ge:re)*ve*ce);return Math.log(Math.sqrt(at*at+1)-at)}function he(Ue){return(Math.exp(Ue)-Math.exp(-Ue))/2}function xe(Ue){return(Math.exp(Ue)+Math.exp(-Ue))/2}let Re=me(0),Ie=function(Ue){return xe(Re)/xe(Re+ae*Ue)},qe=function(Ue){return re*((xe(Re)*(he(at=Re+ae*Ue)/xe(at))-he(Re))/ve)/ce;var at},je=(me(1)-Re)/ae;if(Math.abs(ce)<1e-6||!isFinite(je)){if(Math.abs(re-ge)<1e-6)return this.easeTo(r,c);let Ue=ge<re?-1:1;je=Math.abs(Math.log(ge/re))/ae,qe=function(){return 0},Ie=function(at){return Math.exp(Ue*ae*at)}}r.duration="duration"in r?+r.duration:1e3*je/("screenSpeed"in r?+r.screenSpeed/ae:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);let Ke=y!==M,_t=P!==x,Le=!p.isPaddingEqual(F),Te=r.retainPadding===!1?p.clone():p,Je=Ue=>at=>{let bt=at*je,jt=1/Ie(bt);Ue.zoom=at===1?T:_+Ue.scaleZoom(jt),Ke&&(Ue.bearing=o.ak(y,M,at)),_t&&(Ue.pitch=o.ak(x,P,at)),Le&&(Te.interpolatePadding(C,F,at),V=Te.centerPoint.add(z));let mt=at===1?K:Ue.unproject(Z.add(Q.mult(qe(bt))).mult(jt));return Ue.setLocationAtPoint(Ue.renderWorldCopies?mt.wrap():mt,V),Ue._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(c),Ue};if(r.preloadOnly){let Ue=this._emulate(Je,r.duration,p);return this._preloadTiles(Ue),this}return this._zooming=!0,this._rotating=Ke,this._pitching=_t,this._padding=Le,this._prepareEase(c,!1),this._ease(Je(p),()=>this._afterEase(c),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(r){}_cancelRenderFrame(r){}_stop(r,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,c)}if(!r){let p=this.handlers;p&&p.stop(!1)}return this}_ease(r,c,p){p.animate===!1||p.duration===0?(r(1),c()):(this._easeStart=o.o.now(),this._easeOptions=p,this._onEaseFrame=r,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let r=Math.min((o.o.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,c){r=o.bS(r,-180,180);let p=Math.abs(r-c);return Math.abs(r-360-c)<p&&(r-=360),Math.abs(r+360-c)<p&&(r+=360),r}_normalizeCenter(r){let c=this.transform;if(c.maxBounds||c.projection.name!=="globe"&&!c.renderWorldCopies)return;let p=r.lng-c.center.lng;r.lng+=p>180?-360:p<-180?360:0}_prefersReducedMotion(r){return this._respectPrefersReducedMotion&&o.o.prefersReducedMotion&&!(r&&r.essential)}_emulate(r,c,p){let _=Math.ceil(15*c/1e3),y=[],x=r(p.clone());for(let C=0;C<=_;C++){let T=x(C/_);y.push(T.clone())}return y}_preloadTiles(r,c){}}class Uf{constructor(r={}){this.options=r,o.aX(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){let c=this.options&&this.options.compact,p=r._getUIString("AttributionControl.ToggleAttribution");this._map=r,this._container=Ae("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Ae("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",p);let _=Ae("span","mapboxgl-ctrl-icon",this._compactButton);return _.setAttribute("aria-hidden","true"),_.setAttribute("title",p),this._innerContainer=Ae("div","mapboxgl-ctrl-attrib-inner",this._container),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),c===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));let c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.e.ACCESS_TOKEN}];if(r){let p=c.reduce((_,y,x)=>(y.value&&(_+=`${y.key}=${y.value}${x<c.length-1?"&":""}`),_),"?");r.href=`${o.e.FEEDBACK_URL}/${p}#${p_(this._map,!0)}`,r.rel="noopener nofollow"}}_updateData(r){!r||(r.dataType!=="source"||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility")&&r.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){let _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}let c=this._map.style._mergedSourceCaches;for(let _ in c){let y=c[_];if(y.used){let x=y.getSource();x.attribution&&r.indexOf(x.attribution)<0&&r.push(x.attribution)}}r.sort((_,y)=>_.length-y.length),r=r.filter((_,y)=>{for(let x=y+1;x<r.length;x++)if(r[x].indexOf(_)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));let p=r.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,r.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class vm{constructor(){o.aX(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=Ae("div","mapboxgl-ctrl");let c=Ae("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&r.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let r=this._map.style._sourceCaches;if(Object.entries(r).length===0)return!0;for(let c in r){let p=r[c].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){let r=this._container.children;if(r.length){let c=r[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class Ty{constructor(){o.aX(["_onIndoorUpdate"],this)}onAdd(r){return this._map=r,this._container=Ae("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("selector-update",c=>this._onIndoorUpdate(c)),this._container}_createButton(r,c){let p=Ae("button",r,this._container);return p.type="button",p.addEventListener("click",c),p}_createSeparator(){return Ae("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(r,c){this._map&&(r.setAttribute("aria-label",c),r.textContent=c)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(r){if(!r||!r.floors)return this._model=r,void(this._container.style.display="none");let c=this._model;this._model=r,this._container.style.display="inline-block",this._container.style.borderRadius="8px",c&&Array.from(this._container.children).forEach(p=>p.remove()),r.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(r.floors,r.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){let r=this._createButton("mapboxgl-ctrl-buildings-toggle",()=>{let c=this._map;this._model&&c&&c._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)});Ae("span","mapboxgl-ctrl-icon",r).setAttribute("aria-hidden","true"),r.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&r.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(r),this._createSeparator()}_updateBuildingsButtonState(){let r=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");r&&this._model&&(this._model.activeFloorsVisible?r.classList.remove("mapboxgl-ctrl-level-button-selected"):r.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(r,c){for(let p=0;p<r.length;p++){let _=r[p],y=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(_.id)});this._setButtonTitle(y,_.zIndex.toString()),this._model&&_.id===this._model.selectedFloorId&&c&&y.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(y),p<r.length-1&&this._createSeparator()}}}class hw{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){let c=++this._id;return this._queue.push({callback:r,id:c,cancelled:!1}),c}remove(r){let c=this._currentlyRunning,p=c?this._queue.concat(c):this._queue;for(let _ of p)if(_.id===r)return void(_.cancelled=!0)}run(r=0){let c=this._currentlyRunning=this._queue;this._queue=[];for(let p of c)if(!p.cancelled&&(p.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class ym{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;let c=o.dC((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,c,p){this._start=this.getValue(c),this._end=r,this._startTime=c,this._endTime=c+p}}let YD={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class fw extends o.z{constructor(r,c,p,_){let{point:y,lngLat:x,originalEvent:C,target:T}=r;super(r.type,{point:y,lngLat:x,originalEvent:C,target:T}),this.preventDefault=()=>{r.preventDefault()},this.id=c,this.interaction=p,this.feature=_}}class Sy{constructor(r){this.map=r,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(r,c){if(this.typeById.has(r))throw new Error(`Interaction id "${r}" already exists.`);let p=c.filter,_=c.type;p&&this.filters.set(r,o.b5(p)),_==="mouseover"&&(_="mouseenter"),_==="mouseout"&&(_="mouseleave");let y=this.interactionsByType.get(_)||new Map;_==="mouseenter"||_==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(r,c)):y.size===0&&this.map.on(_,this.handleType),y.size===0&&this.interactionsByType.set(_,y),y.set(r,c),this.typeById.set(r,_)}get(r){let c=this.typeById.get(r);if(!c)return;let p=this.interactionsByType.get(c);return p?p.get(r):void 0}remove(r){let c=this.typeById.get(r);if(!c)return;this.typeById.delete(r),this.filters.delete(r);let p=this.interactionsByType.get(c);p&&(p.delete(r),c==="mouseenter"||c==="mouseleave"?(this.delegatedInteractions.delete(r),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):p.size===0&&this.map.off(c,this.handleType))}queryTargets(r,c){let p=[];for(let[_,y]of c)y.target&&p.push({targetId:_,target:y.target,filter:this.filters.get(_)});return this.map.style.queryRenderedTargets(r,p,this.map.transform)}handleMove(r){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;let c=this.queryTargets(r.point,Array.from(this.delegatedInteractions).reverse());c.length&&(r.type="mouseenter",this.handleType(r,c));let p=new Map;for(let[_,{feature:y}]of this.prevHoveredFeatures)this.hoveredFeatures.has(_)||p.set(y.id,y);p.size&&(r.type="mouseleave",this.handleType(r,Array.from(p.values())))}handleOut(r){let c=Array.from(this.hoveredFeatures.values()).map(({feature:p})=>p);c.length&&(r.type="mouseleave",this.handleType(r,c)),this.hoveredFeatures.clear()}handleType(r,c){let p=r.type==="mouseenter";if(p&&!this.interactionsByType.has(r.type))return void o.w("mouseenter interaction required for mouseleave to work.");let _=Array.from(this.interactionsByType.get(r.type)).reverse(),y=!!c;c=c||this.queryTargets(r.point,_);let x=!1,C=new Set;for(let T of c){for(let[M,P]of _){if(!P.target)continue;let F=T.variants?T.variants[M]:null;if(F){for(let O of F){if(Bs(O,T,C,M))continue;let z=new o.dw(T,O),V=Ws(O,T,M);y&&z.id!==void 0&&(z.state=this.map.getFeatureState(z));let H=p?this.prevHoveredFeatures.get(V):null,K=new fw(r,M,P,z),Z=H?H.stop:P.handler(K);if(p&&this.hoveredFeatures.set(V,{feature:T,stop:Z}),Z!==!1){x=!0;break}}if(x)break}}if(x)break}if(!x)for(let[T,M]of _){let{handler:P,target:F}=M;if(!F&&P(new fw(r,T,M,null))!==!1)break}}}function Dy(f,r){if(Array.isArray(f)&&Array.isArray(r)){let c=new Set(f),p=new Set(r);return c.size===p.size&&f.every(_=>p.has(_))}return o.bx(f,r)}let C_={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},E_={showCompass:!0,showZoom:!0,visualizePitch:!1};class xm{constructor(r,c,p=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new v_({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,p&&(this.mousePitch=new by({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),o.aX(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(r,c){this.mouseRotate.mousedown(r,c),this.mousePitch&&this.mousePitch.mousedown(r,c),Cn()}move(r,c){let p=this.map,_=this.mouseRotate.mousemoveWindow(r,c),y=_&&_.bearingDelta;if(y&&p.setBearing(p.getBearing()+y),this.mousePitch){let x=this.mousePitch.mousemoveWindow(r,c),C=x&&x.pitchDelta;C&&p.setPitch(p.getPitch()+C)}}off(){let r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Xn(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(Object.assign({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),rr(this.element,r)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,rr(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){r.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Vi(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){r.targetTouches.length!==1?this.reset():(this._lastPos=Vi(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){r.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function ou(f,r,c){if(f=new o.aS(f.lng,f.lat),r){let p=new o.aS(f.lng-360,f.lat),_=new o.aS(f.lng+360,f.lat),y=360*Math.ceil(Math.abs(f.lng-c.center.lng)/360),x=c.locationPoint3D(f).distSqr(r),C=r.x<0||r.y<0||r.x>c.width||r.y>c.height;c.locationPoint3D(p).distSqr(r)<x&&(C||Math.abs(p.lng-c.center.lng)<y)?f=p:c.locationPoint3D(_).distSqr(r)<x&&(C||Math.abs(_.lng-c.center.lng)<y)&&(f=_)}for(;Math.abs(f.lng-c.center.lng)>180;){let p=c.locationPoint3D(f);if(p.x>=0&&p.y>=0&&p.x<=c.width&&p.y<=c.height)break;f.lng>c.center.lng?f.lng-=360:f.lng+=360}return f}let Zl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},bs={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class su extends o.E{constructor(r,c){super(),(r instanceof HTMLElement||c)&&(r=Object.assign({element:r},c)),o.aX(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);let{anchor:p="center",color:_="#3FB1CE",scale:y=1,draggable:x=!1,clickTolerance:C=0,rotation:T=bs.rotation,rotationAlignment:M=bs.rotationAlignment,pitchAlignment:P=bs.pitchAlignment,occludedOpacity:F=bs.occludedOpacity,altitude:O=bs.altitude}=r||{};this._anchor=p,this._color=_,this._scale=y,this._draggable=x,this._clickTolerance=C,this._rotation=T,this._rotationAlignment=M,this._pitchAlignment=P,this._occludedOpacity=F,this._altitude=O,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),r&&r.element?(this._element=r.element,this._offset=o.P.convert(r&&r.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=o.P.convert(r&&r.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",H=>{H.preventDefault()}),this._element.addEventListener("mousedown",H=>{H.preventDefault()});let z=this._element.classList;for(let H in Zl)z.remove(`mapboxgl-marker-anchor-${H}`);z.add(`mapboxgl-marker-anchor-${this._anchor}`);let V=r&&r.className?r.className.trim().split(/\s+/):[];z.add(...V),this._popup=null}_createDefaultMarker(){let r=Ae("div"),c=Be("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},r);if(this._altitude===0){let p=Be("radialGradient",{id:"shadowGradient"},Be("defs",{},c));Be("stop",{offset:"10%","stop-opacity":.4},p),Be("stop",{offset:"100%","stop-opacity":.05},p),Be("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},c)}return Be("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},c),Be("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},c),Be("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},c),r}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){let r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=o.aS.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(r){return r===this._altitude||(this._defaultMarker&&(this._altitude===0&&r!==0||this._altitude!==0&&r===0)&&(this._element=this._createDefaultMarker()),this._altitude=r||bs.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){let _=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,r._marker=this,r._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){let c=r.code,p=r.charCode||r.keyCode;c!=="Space"&&c!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(r){let c=r.originalEvent.target,p=this._element;this._popup&&(c===p||p.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let r=this._map,c=this._pos;if(!r||!c)return!1;let p=r.unproject(c,this._altitude),_=r.getFreeCameraOptions();if(!_.position)return!1;let y=_.position.toLngLat();return y.distanceTo(p)<.9*y.distanceTo(this._lngLat)}_evaluateOpacity(){let r=this._map;if(!r)return;let c=this._pos;if(!c||c.x<0||c.x>r.transform.width||c.y<0||c.y>r.transform.height)return void this._clearFadeTimer();let p=r.unproject(c,this._altitude),_;r._showingGlobe()&&o.f4(r.transform,this._lngLat)?_=0:(_=1-r._queryFogOpacity(p),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(_*=this._occludedOpacity)),this._element.style.opacity=`${_}`,this._element.style.pointerEvents=_>0?"auto":"none",this._popup&&this._popup._setOpacity(_),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let r=this._pos;if(!r||!this._map)return;let c=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${r.x}px,${r.y}px)
            ${Zl[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${c.x}px,${c.y}px)
        `}_calculateXYTransform(){let r=this._pos,c=this._map,p=this.getPitchAlignment();if(!c||!r||p!=="map")return"";if(!c._showingGlobe()){let T=c.getPitch();return T?`rotateX(${T}deg)`:""}let _=o.cW(o.f5(c.transform,this._lngLat)),y=r.sub(o.f6(c.transform)),x=Math.abs(y.x)+Math.abs(y.y);if(x===0)return"";let C=_/x;return`rotateX(${-y.y*C}deg) rotateY(${y.x*C}deg)`}_calculateZTransform(){let r=this._pos,c=this._map;if(!c||!r)return"";let p=0,_=this.getRotationAlignment();if(_==="map")if(c._showingGlobe()){let y=c.project(new o.aS(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),x=c.project(new o.aS(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(y);p=o.cW(Math.atan2(x.y,x.x))-90}else p=-c.getBearing();else if(_==="horizon"){let y=o.ah(4,6,c.getZoom()),x=o.f6(c.transform);x.y+=y*c.transform.height;let C=r.sub(x),T=o.cW(Math.atan2(C.y,C.x));p=(T>90?T-270:T+90)*(1-y)}return p+=this._rotation,p?`rotateZ(${p}deg)`:""}_update(r){cancelAnimationFrame(this._updateFrameId);let c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=ou(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat,this._altitude),r===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),c._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(c._showingGlobe()||c.getTerrain()||c.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=o.P.convert(r),this._update(),this}addClassName(r){return this._element.classList.add(r),this}removeClassName(r){return this._element.classList.remove(r),this}toggleClassName(r){return this._element.classList.toggle(r)}_onMove(r){let c=this._map;if(!c)return;let p=this._pointerdownPos,_=this._positionDelta;if(p&&_){if(!this._isDragging){let y=this._clickTolerance||c._clickTolerance;if(r.point.dist(p)<y)return;this._isDragging=!0}this._pos=r.point.sub(_),this._lngLat=c.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.z("dragstart"))),this.fire(new o.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.z("dragend")),this._state="inactive"}_addDragHandler(r){let c=this._map,p=this._pos;c&&p&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(p),this._pointerdownPos=r.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;let c=this._map;return c&&(r?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||bs.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||bs.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||bs.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(r){return this._occludedOpacity=r||bs.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let Xl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},KD={maxWidth:100,unit:"metric"},JD={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},QD={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},eI=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Iy(f=new o.P(0,0),r="bottom"){if(typeof f=="number"){let c=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(r){case"top":return new o.P(0,f);case"top-left":return new o.P(c,c);case"top-right":return new o.P(-c,c);case"bottom":return new o.P(0,-f);case"bottom-left":return new o.P(c,-c);case"bottom-right":return new o.P(-c,-c);case"left":return new o.P(f,0);case"right":return new o.P(-f,0)}return new o.P(0,0)}return f instanceof o.P||Array.isArray(f)?o.P.convert(f):o.P.convert(f[r]||[0,0])}return{version:E,supported:ze.supported,setRTLTextPlugin:o.fa,getRTLTextPluginStatus:o.f9,Map:class extends wc{constructor(f){L.mark(A.create);let r=f;if((f=Object.assign({},C_,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&o.f2(window)&&(f.antialias=!1,o.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Yu(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies,null,null),f),this._repaint=!!f.repaint,this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._collectResourceTiming=f.collectResourceTiming,this._language=this._parseLanguage(f.language),this._worldview=f.worldview,this._renderTaskQueue=new hw,this._domRenderTaskQueue=new hw,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.b1(),this._locale=Object.assign({},YD,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._performanceMetricsCollection=f.performanceMetricsCollection,this._tessellationStep=f.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=f.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new ym(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=f.scaleFactor,this._requestManager=new en(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,this._contextCreateOptions=f.contextCreateOptions?Object.assign({},f.contextCreateOptions):{},typeof f.container=="string"){let c=document.getElementById(f.container);if(!c)throw new Error(`Container '${f.container.toString()}' not found.`);this._container=c}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&o.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),this._spriteFormat=f.spriteFormat,o.aX(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new HD),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new w_(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,(f.style||!f.testMode)&&this.setStyle(f.style||o.e.DEFAULT_STYLE,{config:f.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),f.hash&&(this._hash=new f_(typeof f.hash=="string"&&f.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){r.center==null&&r.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch});let c=f.bounds;c&&(this.resize(),this.fitBounds(c,Object.assign({},f.fitBoundsOptions,{duration:0})))}this.resize(),f.attributionControl&&this.addControl(new Uf({customAttribution:f.customAttribution})),this._logoControl=new vm,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent(),this._setupIndoor()}),this.on("data",c=>{this._update(c.dataType==="style"),this.fire(new o.z(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new o.z(`${c.dataType}dataloading`,c))}),this._interactions=new Sy(this)}_getMapId(){return this._mapId}addControl(f,r){if(r===void 0&&(r=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new o.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let c=f.onAdd(this);this._controls.push(f);let p=this._controlPositions[r];return r.indexOf("bottom")!==-1?p.insertBefore(c,p.firstChild):p.appendChild(c),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new o.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let r=this._controls.indexOf(f);return r>-1&&this._controls.splice(r,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let r=!this._moving;return r&&this.fire(new o.z("movestart",f)).fire(new o.z("move",f)),this.fire(new o.z("resize",f)),r&&this.fire(new o.z("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(o.aI.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new o.z("zoomstart")).fire(new o.z("zoom")).fire(new o.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new o.z("zoomstart")).fire(new o.z("zoom")).fire(new o.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new o.z("pitchstart")).fire(new o.z("pitch")).fire(new o.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new o.z("pitchstart")).fire(new o.z("pitch")).fire(new o.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(f){return this._scaleFactor=f,this.painter.scaleFactor=f,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(r=>r.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(f){return f==="auto"?navigator.language:Array.isArray(f)?f.length===0?void 0:f.map(r=>r==="auto"?navigator.language:r):f}setLanguage(f){let r=this._parseLanguage(f);if(!this.style||r===this._language)return this;this._language=r,this.style.reloadSources();for(let c of this._controls)c._setLanguage&&c._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){return this.style&&f!==this._worldview?(this._worldview=f,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(f){return this._lazyInitEmptyStyle(),f?typeof f=="string"&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let f=this.transform,r=f.projection.name,c;r==="globe"&&f.zoom>=o.cK?(f.setMercatorFromTransition(),c=!0):r==="mercator"&&f.zoom<o.cK&&(f.setProjection({name:"globe"}),c=!0),c&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(f,r){return this._updateProjection(f||r||{name:"mercator"})}_updateProjection(f){let r,c=this.transform.mercatorFromTransition;r=f.name==="globe"&&this.transform.zoom>=o.cK?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate();let p=this.transform.getProjection().name==="mercator"&&c!==this.transform.mercatorFromTransition;return(r||p)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(f,r){return this.transform.locationPoint3D(o.aS.convert(f),r)}unproject(f,r){return this.transform.pointLocation3D(o.P.convert(f),r)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(f,r,c){let p=_=>{let y=[];if(Array.isArray(r)){let x=r.filter(C=>this.getLayer(C));y=x.length?this.queryRenderedFeatures(_,{layers:x}):[]}else y=this.queryRenderedFeatures(_,{target:r});return y};if(f==="mouseenter"||f==="mouseover"){let _=!1;return{listener:c,targets:r,delegates:{mousemove:x=>{let C=p(x.point);C.length?_||(_=!0,c.call(this,new mr(f,this,x.originalEvent,{features:C}))):_=!1},mouseout:()=>{_=!1}}}}if(f==="mouseleave"||f==="mouseout"){let _=!1;return{listener:c,targets:r,delegates:{mousemove:C=>{p(C.point).length?_=!0:_&&(_=!1,c.call(this,new mr(f,this,C.originalEvent)))},mouseout:C=>{_&&(_=!1,c.call(this,new mr(f,this,C.originalEvent)))}}}}{let _=y=>{let x=p(y.point);x.length&&(y.features=x,c.call(this,y),delete y.features)};return{listener:c,targets:r,delegates:{[f]:_}}}}on(f,r,c){if(typeof r=="function"||c===void 0)return super.on(f,r);if(typeof r=="string"&&(r=[r]),!this._areTargetsValid(r))return this;let p=this._createDelegatedListener(f,r,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(p);for(let _ in p.delegates)this.on(_,p.delegates[_]);return this}once(f,r,c){if(typeof r=="function"||c===void 0)return super.once(f,r);if(typeof r=="string"&&(r=[r]),!this._areTargetsValid(r))return this;let p=this._createDelegatedListener(f,r,c);for(let _ in p.delegates)this.once(_,p.delegates[_]);return this}off(f,r,c){if(typeof r=="function"||c===void 0)return super.off(f,r);if(typeof r=="string"&&(r=[r]),!this._areTargetsValid(r))return this;let p=this._delegatedListeners?this._delegatedListeners[f]:void 0;return p&&(_=>{for(let y=0;y<_.length;y++){let x=_[y];if(x.listener===c&&Dy(x.targets,r)){for(let C in x.delegates)this.off(C,x.delegates[C]);return _.splice(y,1),this}}})(p),this}queryRenderedFeatures(f,r){if(!this.style)return[];if(f===void 0||f instanceof o.P||Array.isArray(f)||r!==void 0||(r=f,f=void 0),f=f||[[0,0],[this.transform.width,this.transform.height]],!r){let y=this.style.queryRenderedFeatures(f,void 0,this.transform),x=this.style.queryRenderedFeatureset(f,void 0,this.transform);return y.concat(x)}let c=!0;if(r.target&&(c=this._isTargetValid(r.target),c&&!r.layers))return this.style.queryRenderedFeatureset(f,r,this.transform);let p=!0;if(r.layers&&Array.isArray(r.layers)){for(let y of r.layers)if(!this._isValidId(y)){p=!1;break}if(p&&!r.target)return this.style.queryRenderedFeatures(f,r,this.transform)}let _=[];return p&&(_=_.concat(this.style.queryRenderedFeatures(f,r,this.transform))),c&&(_=_.concat(this.style.queryRenderedFeatureset(f,r,this.transform))),_}querySourceFeatures(f,r){return!f||typeof f=="string"&&!this._isValidId(f)?[]:this.style.querySourceFeatures(f,r)}queryRasterValue(f,r,c){return this._isValidId(f)?this.style.queryRasterValue(f,r,c):Promise.resolve(null)}isPointOnSurface(f){let{name:r}=this.transform.projection;return r!=="globe"&&r!=="mercator"&&o.w(`${r} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(o.P.convert(f))}addInteraction(f,r){return this._interactions.add(f,r),this}removeInteraction(f){return this._interactions.remove(f),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(f){return this._cooperativeGestures=f,this}setStyle(f,r){return r=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r),this.style&&f&&r.diff!==!1&&r.localFontFamily===this._localFontFamily&&r.localIdeographFontFamily===this._localIdeographFontFamily&&!r.config?(this.style._diffStyle(f,(c,p)=>{if(c){let _=typeof c=="string"?c:c instanceof Error?c.message:c.error;o.w(`Unable to perform style diff: ${_}. Rebuilding the style from scratch.`),this._updateStyle(f,r)}else p&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(f,r))}_getUIString(f){let r=this._locale[f];if(r==null)throw new Error(`Missing UI string '${f}'`);return r}_updateStyle(f,r){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f){let c=Object.assign({},r);r&&r.config&&(c.initialConfig=r.config,delete c.config),this.style=new Xa(this,c).load(f),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Xa(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.w("There is no style added to the map."),!1)}_isValidId(f){return f==null?(this.fire(new o.y(new Error("IDs can't be empty."))),!1):!o.dq(f)||(this.fire(new o.y(new Error(`IDs can't contain special symbols: "${f}".`))),!1)}_isTargetValid(f){return"featuresetId"in f?this._isValidId("importId"in f?f.importId:f.featuresetId):"layerId"in f&&this._isValidId(f.layerId)}_areTargetsValid(f){if(Array.isArray(f)){for(let r of f)if(!this._isValidId(r))return!1;return!0}return this._isTargetValid(f)}addSource(f,r){return this._isValidId(f)?(this._lazyInitEmptyStyle(),this.style.addSource(f,r),this._update(!0)):this}isSourceLoaded(f){return!!this._isValidId(f)&&!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(f,r,c){this._lazyInitEmptyStyle(),this.style.addSourceType(f,r,c)}removeSource(f){return this._isValidId(f)?(this.style.removeSource(f),this._updateTerrain(),this._update(!0)):this}getSource(f){return this._isValidId(f)?this.style.getOwnSource(f):null}addImage(f,r,{pixelRatio:c=1,sdf:p=!1,stretchX:_,stretchY:y,content:x}={}){this._lazyInitEmptyStyle();let C=o.I.from(f);if(r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap){let{width:T,height:M,data:P}=o.o.getImageData(r);this.style.addImage(C,{data:new o.q({width:T,height:M},P),pixelRatio:c,stretchX:_,stretchY:y,content:x,sdf:p,version:0,usvg:!1})}else if(r.width===void 0||r.height===void 0)this.fire(new o.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:T,height:M}=r,P=r;this.style.addImage(C,{data:new o.q({width:T,height:M},new Uint8Array(P.data)),pixelRatio:c,stretchX:_,stretchY:y,content:x,sdf:p,usvg:!1,version:0,userImage:P}),P.onAdd&&P.onAdd(this,f)}}updateImage(f,r){this._lazyInitEmptyStyle();let c=o.I.from(f),p=this.style.getImage(c);if(!p)return void this.fire(new o.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let _=r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap?o.o.getImageData(r):r,{width:y,height:x,data:C}=_;if(y===void 0||x===void 0)return void this.fire(new o.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(y!==(p.usvg?p.icon.usvg_tree.width:p.data.width)||x!==(p.usvg?p.icon.usvg_tree.height:p.data.height))return void this.fire(new o.y(new Error(`The width and height of the updated image (${y}, ${x})
                must be that same as the previous version of the image
                (${p.data.width}, ${p.data.height})`)));let T=!(r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap),M=!1;p.usvg?(p.data=new o.q({width:y,height:x},new Uint8Array(C)),p.usvg=!1,p.icon=void 0,M=!0):p.data.replace(C,T),this.style.updateImage(c,p,M)}hasImage(f){return f?!!this.style&&!!this.style.getImage(o.I.from(f)):(this.fire(new o.y(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(o.I.from(f))}loadImage(f,r){o.n(this._requestManager.transformRequest(f,o.R.Image),(c,p)=>{r(c,p instanceof HTMLImageElement?o.o.getImageData(p):p)})}listImages(){return this.style.listImages().map(f=>f.name)}addModel(f,r){this._lazyInitEmptyStyle(),this.style.addModel(f,r)}hasModel(f){return f?this.style.hasModel(f):(this.fire(new o.y(new Error("Missing required model id"))),!1)}removeModel(f){this.style.removeModel(f)}listModels(){return this.style.listModels()}addLayer(f,r){return this._isValidId(f.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(f,r),this._update(!0)):this}getSlot(f){let r=this.getLayer(f);return r&&r.slot||null}setSlot(f,r){return this.style.setSlot(f,r),this.style.mergeLayers(),this._update(!0)}addImport(f,r){return this.style.addImport(f,r).catch(c=>this.fire(new o.y(new Error("Failed to add import",c)))),this}updateImport(f,r){return typeof r!="string"&&r.id!==f?(this.removeImport(f),this.addImport(r)):(this.style.updateImport(f,r),this._update(!0))}removeImport(f){return this.style.removeImport(f),this}moveImport(f,r){return this.style.moveImport(f,r),this._update(!0)}moveLayer(f,r){return this._isValidId(f)?(this.style.moveLayer(f,r),this._update(!0)):this}removeLayer(f){return this._isValidId(f)?(this.style.removeLayer(f),this._update(!0)):this}getLayer(f){if(!this._isValidId(f))return null;let r=this.style.getOwnLayer(f);return r?r.type==="custom"?r.implementation:r.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(f,r,c){return this._isValidId(f)?(this.style.setLayerZoomRange(f,r,c),this._update(!0)):this}setFilter(f,r,c={}){return this._isValidId(f)?(this.style.setFilter(f,r,c),this._update(!0)):this}getFilter(f){return this._isValidId(f)?this.style.getFilter(f):null}setPaintProperty(f,r,c,p={}){return this._isValidId(f)?(this.style.setPaintProperty(f,r,c,p),this._update(!0)):this}getPaintProperty(f,r){return this._isValidId(f)?this.style.getPaintProperty(f,r):null}setLayoutProperty(f,r,c,p={}){return this._isValidId(f)?(this.style.setLayoutProperty(f,r,c,p),this._update(!0)):this}getLayoutProperty(f,r){return this._isValidId(f)?this.style.getLayoutProperty(f,r):null}setLayerProperty(f,r,c,p={}){return this._isValidId(f)?(this.style.setLayerProperty(f,r,c,p),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(f){return this.style.setGlyphsUrl(f),this._update(!0)}getSchema(f){return this.style.getSchema(f)}setSchema(f,r){return this.style.setSchema(f,r),this._update(!0)}getConfig(f){return this.style.getConfig(f)}setConfig(f,r){return this.style.setConfig(f,r),this._update(!0)}getConfigProperty(f,r){return this.style.getConfigProperty(f,r)}setConfigProperty(f,r,c){return this.style.setConfigProperty(f,r,c),this._update(!0)}getFeaturesetDescriptors(f){return this.style.getFeaturesetDescriptors(f)}setLights(f){if(this._lazyInitEmptyStyle(),f&&f.length===1&&f[0].type==="flat"){let r=f[0];r.properties?this.style.setFlatLight(r.properties,r.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(f),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){let f=this.style.getLights()||[];return f.length===0&&f.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),f}setLight(f,r={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:f}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(f){return this._lazyInitEmptyStyle(),this.style.setSnow(f),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(f){return this._lazyInitEmptyStyle(),this.style.setRain(f),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(f){return this._lazyInitEmptyStyle(),this.style.setColorTheme(f),this._update(!0)}setImportColorTheme(f,r){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(f,r),this._update(!0)}setCamera(f){return this.style.setCamera(f),this._triggerCameraUpdate(f)}_triggerCameraUpdate(f){return this._update(this.transform.setOrthographicProjectionAtLowPitch(f["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.aS.convert(f),this.transform):0}setFeatureState(f,r){return f.source&&!this._isValidId(f.source)?this:(this.style.setFeatureState(f,r),this._update())}removeFeatureState(f,r){return f.source&&!this._isValidId(f.source)?this:(this.style.removeFeatureState(f,r),this._update())}getFeatureState(f){return f.source&&!this._isValidId(f.source)?null:this.style.getFeatureState(f)}_selectIndoorFloor(f){this.indoor.selectFloor(f)}_setIndoorActiveFloorsVisibility(f){this.indoor.setActiveFloorsVisibility(f)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new Ty),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;let f=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300,c,p,_,y=this._container;for(;y&&(!p||!_);){let x=window.getComputedStyle(y).transform;x&&x!=="none"&&(c=x.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&c[0]!=="0"&&c[0]!=="1"&&(p=c[0]),c[3]&&c[3]!=="0"&&c[3]!=="1"&&(_=c[3])),y=y.parentElement}this._containerWidth=p?Math.abs(f/p):f,this._containerHeight=_?Math.abs(r/_):r}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupIndoor(){this.style.isIndoorEnabled()&&(this.indoor=new Ku(this.style),this.on("load",()=>{this._addIndoorControl(),this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds()),this.on("move",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())}),this.on("idle",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())})}))}_setupContainer(){let f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=Ae("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();let r=this._canvasContainer=Ae("div","mapboxgl-canvas-container",f);this._canvas=Ae("canvas","mapboxgl-canvas",r),this._interactive&&(r.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let c=this._controlContainer=Ae("div","mapboxgl-control-container",f),p=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(_=>{p[_]=Ae("div",`mapboxgl-ctrl-${_}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,r){let c=o.o.devicePixelRatio||1;this._canvas.width=c*Math.ceil(f),this._canvas.height=c*Math.ceil(r),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${r}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){let r=this._markers.indexOf(f);r!==-1&&this._markers.splice(r,1)}_addPopup(f){this._popups.push(f)}_removePopup(f){let r=this._popups.indexOf(f);r!==-1&&this._popups.splice(r,1)}_setupPainter(){let f=Object.assign({},ze.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl2",f);r?(qa(r,!0),this.painter=new ld(r,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",c=>{c.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.k.testSupport(r)):this.fire(new o.y(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.z("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new o.z("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let r;this.fire(new o.z("renderstart")),++this._frameId;let c=this.painter.context.extTimerQuery,p=o.o.now(),_=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(r=_.createQuery(),_.beginQuery(c.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();let y=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let M=this.transform.zoom,P=this.transform.pitch,F=o.o.now(),O=new o.ac(M,{now:F,fadeDuration:y,pitch:P,transition:this.style.transition,worldview:this._worldview});this.style.update(O)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let x=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),x=this._updateAverageElevation(p),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):x=this._updateAverageElevation(p);let C=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,y,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),C&&(this._placementDirty=C.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,L.mark(A.load),this.fire(new o.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){let M=o.o.now()-p;_.endQuery(c.TIME_ELAPSED_EXT),setTimeout(()=>{let P=_.getQueryParameter(r,_.QUERY_RESULT)/1e6;_.deleteQuery(r),this.fire(new o.z("gpu-timing-frame",{cpuTime:M,gpuTime:P}))},50)}if(this.listens("gpu-timing-layer")){let M=this.painter.collectGpuTimers();setTimeout(()=>{let P=this.painter.queryGpuTimers(M);this.fire(new o.z("gpu-timing-layer",{layerTimes:P}))},50)}if(this.listens("gpu-timing-deferred-render")){let M=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let P=this.painter.queryGpuTimeDeferredRender(M);this.fire(new o.z("gpu-timing-deferred-render",{gpuTime:P}))},50)}let T=this._sourcesDirty||this._styleDirty||this._placementDirty||x;if(T||this._repaint)this.triggerRepaint();else{let M=this.idle();if(M&&(x=this._updateAverageElevation(p,!0)),x)this.triggerRepaint();else if(this._triggerFrame(!1),M&&(this.fire(new o.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let P=this._calculateSpeedIndex();this.fire(new o.z("speedindexcompleted",{speedIndex:P})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||T||(this._fullyLoaded=!0,L.mark(A.fullLoad),this._performanceMetricsCollection&&Vr(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(f){for(let r of this._markers)f&&!this.getRenderWorldCopies()&&(r._lngLat=r._lngLat.wrap()),r._update();for(let r of this._popups)!f||this.getRenderWorldCopies()||r._trackPointer||(r._lngLat=r._lngLat.wrap()),r._update()}_updateAverageElevation(f,r=!1){let c=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&c(0);let p=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(p||(r||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){let _=this.transform.averageElevation,y=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(y)?y=0:this._averageElevationLastSampledAt=f;let x=Math.abs(_-y);if(x>1){if(this._isInitialLoad||p)return this._averageElevation.jumpTo(y),c(y);this._averageElevation.easeTo(y,f,300)}else if(x>1e-4)return this._averageElevation.jumpTo(y),c(y)}return!!this._averageElevation.isEasing(f)&&c(this._averageElevation.getValue(f))}_authenticate(){hc(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===Rt||f.status===401)){let r=this.painter.context.gl;qa(r,!1),this._logoControl instanceof vm&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Do(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&$a(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&Ga(this._requestManager._customAccessToken)}_updateTerrain(){let f=this._isDragging();this.painter.updateTerrain(this.style,f)}_calculateSpeedIndex(){let f=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());let c=this.painter.context.gl,p=c.createFramebuffer();function _(y){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,y,0);let x=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,x),x}return c.bindFramebuffer(c.FRAMEBUFFER,p),this._canvasPixelComparison(_(f),r.canvasCopies.map(_),r.timeStamps)}_canvasPixelComparison(f,r,c){let p=c[1]-c[0],_=f.length/4;for(let y=0;y<r.length;y++){let x=r[y],C=0;for(let T=0;T<x.length;T+=4)x[T]===f[T]&&x[T+1]===f[T+1]&&x[T+2]===f[T+2]&&x[T+3]===f[T+3]&&(C+=1);p+=(c[y+2]-c[y+1])*(1-C/_)}return p}remove(){this._hash&&this._hash.remove();for(let r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor&&this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);let f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),pr.delete(this.painter.context.gl),Ro.remove(),Ui.remove(),this._removed=!0,this.fire(new o.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=o.o.frame(r=>{let c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(r)}))}_preloadTiles(f){let r=this.style?this.style.getSourceCaches():[];return o.bv(r,(c,p)=>c._preloadTiles(f,p),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(f){this._showParseStatus!==f&&(this._showParseStatus=f,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(f){this._showLayers2DWireframe!==f&&(this._showLayers2DWireframe=f,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(f){this._showLayers3DWireframe!==f&&(this._showLayers3DWireframe=f,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,this._tp.refreshUI(),f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(f){this._showTileAABBs!==f&&(this._showTileAABBs=f,this._tp.refreshUI(),f&&this._update())}_setCacheLimits(f,r){o.f3(f,r)}get version(){return E}},NavigationControl:class{constructor(f={}){this.options=Object.assign({},E_,f),this._container=Ae("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(o.aX(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),Ae("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),Ae("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.aX(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{let c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:r}):c.resetNorth({},{originalEvent:r}))}),this._compassIcon=Ae("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let f=this._map;if(!f)return;let r=f.getZoom(),c=r===f.getMaxZoom(),p=r===f.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){let f=this._map;if(!f)return;let r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new xm(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){let f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,r){let c=Ae("button",f,this._container);return c.type="button",c.addEventListener("click",r),c}_setButtonTitle(f,r){if(!this._map)return;let c=this._map._getUIString(`NavigationControl.${r}`);f.setAttribute("aria-label",c),f.firstElementChild&&f.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends o.E{constructor(f={}){super();let r=navigator.geolocation;this.options=Object.assign({geolocation:r},Xl,f),o.aX(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=bh(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=Ae("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){let r=(c=!!this.options.geolocation)=>{this._supportsGeolocation=c,f(c)};this._supportsGeolocation!==void 0?f(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(c=>r(c.state!=="denied")).catch(()=>r()):r()}_isOutOfMapMaxBounds(f){let r=this._map.getMaxBounds(),c=f.coords;return!!r&&(c.longitude<r.getWest()||c.longitude>r.getEast()||c.latitude<r.getSouth()||c.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new o.z("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.z("geolocate",Object.assign({coords:f.coords,timestamp:f.timestamp},f.toJSON?{toJSON:f.toJSON.bind(f)}:{}))),this._finish()}}_updateCamera(f){let r=new o.aS(f.coords.longitude,f.coords.latitude),c=f.coords.accuracy,p=this._map.getBearing(),_=Object.assign({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(c),_,{geolocateSource:!0})}_updateMarker(f){if(f){let r=new o.aS(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let f=this._map.transform,r=o.ce(1,f._center.lat)*f.worldSize,c=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.z("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=Ae("button","mapboxgl-ctrl-geolocate",this._container),Ae("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",f===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");let r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{let r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Ae("div","mapboxgl-user-location"),this._dotElement.appendChild(Ae("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Ae("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new su({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Ae("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new su({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.z("trackuserlocationend")))})}}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:f.absolute===!0&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let f=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(r=>{r==="granted"&&f()}).catch(console.error):f()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Uf,ScaleControl:class{constructor(f={}){this.options=Object.assign({},KD,f),this._isNumberFormatSupported=(function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}})(),o.aX(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let f=this.options.maxWidth||100,r=this._map,c=r._containerHeight/2,p=r._containerWidth/2-f/2,_=r.unproject([p,c]),y=r.unproject([p+f,c]),x=_.distanceTo(y);if(this.options.unit==="imperial"){let C=3.2808*x;C>5280?this._setScale(f,C/5280,"mile"):this._setScale(f,C,"foot")}else this.options.unit==="nautical"?this._setScale(f,x/1852,"nautical-mile"):x>=1e3?this._setScale(f,x/1e3,"kilometer"):this._setScale(f,x,"meter")}_setScale(f,r,c){this._map._requestDomTask(()=>{let p=(function(y){let x=Math.pow(10,`${Math.floor(y)}`.length-1),C=y/x;return C=C>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:(function(T){let M=Math.pow(10,Math.ceil(-Math.log(T)/Math.LN10));return Math.round(T*M)/M})(C),x*C})(r),_=p/r;this._container.innerHTML=this._isNumberFormatSupported&&c!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:c}).format(p):`${p}&nbsp;${JD[c]}`,this._container.style.width=f*_+"px"})}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=Ae("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f={}){this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:o.w("Full screen control 'container' must be a DOM element.")),o.aX(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=Ae("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){let f=this._fullscreenButton=Ae("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Ae("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:Ty,Popup:class extends o.E{constructor(f){super(),this.options=Object.assign(Object.create(QD),f),this._altitude=this.options.altitude,o.aX(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),f._addPopup(this),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new o.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),f._canvasContainer&&f._canvasContainer.classList.remove("mapboxgl-track-pointer"),f._removePopup(this),this._map=void 0),this.fire(new o.z("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=o.aS.convert(f),this._pos=null,this._trackPointer=!1,this._update();let r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(f){return this._altitude=f,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){let r=document.createDocumentFragment(),c=document.createElement("body"),p;for(c.innerHTML=f;p=c.firstChild,p;)r.appendChild(p);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=Ae("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(f),this.options.closeButton){let c=this._closeButton=Ae("button","mapboxgl-popup-close-button",r);c.type="button",c.setAttribute("aria-label","Close popup"),c.innerHTML='<span aria-hidden="true">&#215;</span>',c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let r;return this._classList.delete(f)?r=!1:(this._classList.add(f),r=!0),this._updateClassList(),r}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;let r=this._map,c=this._container,p=this._pos;if(!r||!c||!p)return"bottom";let _=c.offsetWidth,y=c.offsetHeight,x=p.x<_/2,C=p.x>r.transform.width-_/2;if(p.y+f<y)return x?"top-left":C?"top-right":"top";if(p.y>r.transform.height-y){if(x)return"bottom-left";if(C)return"bottom-right"}return x?"left":C?"right":"bottom"}_updateClassList(){let f=this._container;if(!f)return;let r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),f.className=r.join(" ")}_update(f){let r=this._map,c=this._content;if(!r||!this._lngLat&&!this._trackPointer||!c)return;let p=this._container;if(p||(p=this._container=Ae("div","mapboxgl-popup",r.getContainer()),this._tip=Ae("div","mapboxgl-popup-tip",p),p.appendChild(c)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ou(this._lngLat,this._pos,r.transform)),!this._trackPointer||f){let _=this._pos=this._trackPointer&&f instanceof o.P?f:r.project(this._lngLat,this._altitude),y=Iy(this.options.offset),x=this._anchor=this._getAnchor(y.y),C=Iy(this.options.offset,x),T=_.add(C).round();r._requestDomTask(()=>{this._container&&x&&(this._container.style.transform=`${Zl[x]} translate(${T.x}px,${T.y}px)`)})}if(!this._marker&&r._showingGlobe()){let _=o.f4(r.transform,this._lngLat)?0:1;this._setOpacity(_)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let f=this._container.querySelector(eI);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:su,Style:Xa,LngLat:o.aS,LngLatBounds:o.aI,Point:o.P,MercatorCoordinate:o.ae,FreeCameraOptions:Cl,Evented:o.E,config:o.e,prewarm:o.f8,clearPrewarmedResources:o.f7,get accessToken(){return o.e.ACCESS_TOKEN},set accessToken(f){o.e.ACCESS_TOKEN=f},get baseApiUrl(){return o.e.API_URL},set baseApiUrl(f){o.e.API_URL=f},get workerCount(){return o.fh.workerCount},set workerCount(f){o.fh.workerCount=f},get maxParallelImageRequests(){return o.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){o.e.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){o.fg(f)},get workerUrl(){return o.ff.workerUrl},set workerUrl(f){o.ff.workerUrl=f},get workerClass(){return o.ff.workerClass},set workerClass(f){o.ff.workerClass=f},get workerParams(){return o.ff.workerParams},set workerParams(f){o.ff.workerParams=f},get dracoUrl(){return o.fe()},set dracoUrl(f){o.fd(f)},get meshoptUrl(){return o.fc()},set meshoptUrl(f){o.fb(f)},setNow:o.o.setNow,restoreNow:o.o.restoreNow}});var h=i;return h})});var H6=Gn((COe,kR)=>{"use strict";global.crypto&&global.crypto.getRandomValues?kR.exports.randomBytes=function(t){var n=new Uint8Array(t);return global.crypto.getRandomValues(n),n}:kR.exports.randomBytes=function(t){for(var n=new Array(t),i=0;i<t;i++)n[i]=Math.floor(Math.random()*256);return n}});var bg=Gn((EOe,G6)=>{"use strict";var Uae=H6(),$6="abcdefghijklmnopqrstuvwxyz012345";G6.exports={string:function(t){for(var n=$6.length,i=Uae.randomBytes(t),l=[],h=0;h<t;h++)l.push($6.substr(i[h]%n,1));return l.join("")},number:function(t){return Math.floor(Math.random()*t)},numberString:function(t){var n=(""+(t-1)).length,i=new Array(n+1).join("0");return(i+this.number(t)).slice(-n)}}});var Jh=Gn((TOe,sD)=>{"use strict";var Hae=bg(),mv={},FR=!1,q6=global.chrome&&global.chrome.app&&global.chrome.app.runtime;sD.exports={attachEvent:function(t,n){typeof global.addEventListener<"u"?global.addEventListener(t,n,!1):global.document&&global.attachEvent&&(global.document.attachEvent("on"+t,n),global.attachEvent("on"+t,n))},detachEvent:function(t,n){typeof global.addEventListener<"u"?global.removeEventListener(t,n,!1):global.document&&global.detachEvent&&(global.document.detachEvent("on"+t,n),global.detachEvent("on"+t,n))},unloadAdd:function(t){if(q6)return null;var n=Hae.string(8);return mv[n]=t,FR&&setTimeout(this.triggerUnloadCallbacks,0),n},unloadDel:function(t){t in mv&&delete mv[t]},triggerUnloadCallbacks:function(){for(var t in mv)mv[t](),delete mv[t]}};var $ae=function(){FR||(FR=!0,sD.exports.triggerUnloadCallbacks())};q6||sD.exports.attachEvent("unload",$ae)});var Z6=Gn((SOe,W6)=>{"use strict";W6.exports=function(n,i){if(i=i.split(":")[0],n=+n,!n)return!1;switch(i){case"http":case"ws":return n!==80;case"https":case"wss":return n!==443;case"ftp":return n!==21;case"gopher":return n!==70;case"file":return!1}return n!==0}});var K6=Gn(LR=>{"use strict";var Gae=Object.prototype.hasOwnProperty,qae;function X6(t){try{return decodeURIComponent(t.replace(/\+/g," "))}catch{return null}}function Y6(t){try{return encodeURIComponent(t)}catch{return null}}function Wae(t){for(var n=/([^=?#&]+)=?([^&]*)/g,i={},l;l=n.exec(t);){var h=X6(l[1]),o=X6(l[2]);h===null||o===null||h in i||(i[h]=o)}return i}function Zae(t,n){n=n||"";var i=[],l,h;typeof n!="string"&&(n="?");for(h in t)if(Gae.call(t,h)){if(l=t[h],!l&&(l===null||l===qae||isNaN(l))&&(l=""),h=Y6(h),l=Y6(l),h===null||l===null)continue;i.push(h+"="+l)}return i.length?n+i.join("&"):""}LR.stringify=Zae;LR.parse=Wae});var BR=Gn((IOe,rH)=>{"use strict";var Q6=Z6(),aD=K6(),Xae=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,eH=/[\n\r\t]/g,Yae=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,tH=/:\d+$/,Kae=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,Jae=/^[a-zA-Z]:/;function zR(t){return(t||"").toString().replace(Xae,"")}var NR=[["#","hash"],["?","query"],function(n,i){return jd(i.protocol)?n.replace(/\\/g,"/"):n},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],J6={hash:1,query:1};function nH(t){var n;typeof window<"u"?n=window:typeof global<"u"?n=global:typeof self<"u"?n=self:n={};var i=n.location||{};t=t||i;var l={},h=typeof t,o;if(t.protocol==="blob:")l=new Vd(unescape(t.pathname),{});else if(h==="string"){l=new Vd(t,{});for(o in J6)delete l[o]}else if(h==="object"){for(o in t)o in J6||(l[o]=t[o]);l.slashes===void 0&&(l.slashes=Yae.test(t.href))}return l}function jd(t){return t==="file:"||t==="ftp:"||t==="http:"||t==="https:"||t==="ws:"||t==="wss:"}function iH(t,n){t=zR(t),t=t.replace(eH,""),n=n||{};var i=Kae.exec(t),l=i[1]?i[1].toLowerCase():"",h=!!i[2],o=!!i[3],E=0,A;return h?o?(A=i[2]+i[3]+i[4],E=i[2].length+i[3].length):(A=i[2]+i[4],E=i[2].length):o?(A=i[3]+i[4],E=i[3].length):A=i[4],l==="file:"?E>=2&&(A=A.slice(2)):jd(l)?A=i[4]:l?h&&(A=A.slice(2)):E>=2&&jd(n.protocol)&&(A=i[4]),{protocol:l,slashes:h||jd(l),slashesCount:E,rest:A}}function Qae(t,n){if(t==="")return n;for(var i=(n||"/").split("/").slice(0,-1).concat(t.split("/")),l=i.length,h=i[l-1],o=!1,E=0;l--;)i[l]==="."?i.splice(l,1):i[l]===".."?(i.splice(l,1),E++):E&&(l===0&&(o=!0),i.splice(l,1),E--);return o&&i.unshift(""),(h==="."||h==="..")&&i.push(""),i.join("/")}function Vd(t,n,i){if(t=zR(t),t=t.replace(eH,""),!(this instanceof Vd))return new Vd(t,n,i);var l,h,o,E,A,L,Y=NR.slice(),le=typeof n,te=this,ze=0;for(le!=="object"&&le!=="string"&&(i=n,n=null),i&&typeof i!="function"&&(i=aD.parse),n=nH(n),h=iH(t||"",n),l=!h.protocol&&!h.slashes,te.slashes=h.slashes||l&&n.slashes,te.protocol=h.protocol||n.protocol||"",t=h.rest,(h.protocol==="file:"&&(h.slashesCount!==2||Jae.test(t))||!h.slashes&&(h.protocol||h.slashesCount<2||!jd(te.protocol)))&&(Y[3]=[/(.*)/,"pathname"]);ze<Y.length;ze++){if(E=Y[ze],typeof E=="function"){t=E(t,te);continue}o=E[0],L=E[1],o!==o?te[L]=t:typeof o=="string"?(A=o==="@"?t.lastIndexOf(o):t.indexOf(o),~A&&(typeof E[2]=="number"?(te[L]=t.slice(0,A),t=t.slice(A+E[2])):(te[L]=t.slice(A),t=t.slice(0,A)))):(A=o.exec(t))&&(te[L]=A[1],t=t.slice(0,A.index)),te[L]=te[L]||l&&E[3]&&n[L]||"",E[4]&&(te[L]=te[L].toLowerCase())}i&&(te.query=i(te.query)),l&&n.slashes&&te.pathname.charAt(0)!=="/"&&(te.pathname!==""||n.pathname!=="")&&(te.pathname=Qae(te.pathname,n.pathname)),te.pathname.charAt(0)!=="/"&&jd(te.protocol)&&(te.pathname="/"+te.pathname),Q6(te.port,te.protocol)||(te.host=te.hostname,te.port=""),te.username=te.password="",te.auth&&(A=te.auth.indexOf(":"),~A?(te.username=te.auth.slice(0,A),te.username=encodeURIComponent(decodeURIComponent(te.username)),te.password=te.auth.slice(A+1),te.password=encodeURIComponent(decodeURIComponent(te.password))):te.username=encodeURIComponent(decodeURIComponent(te.auth)),te.auth=te.password?te.username+":"+te.password:te.username),te.origin=te.protocol!=="file:"&&jd(te.protocol)&&te.host?te.protocol+"//"+te.host:"null",te.href=te.toString()}function ele(t,n,i){var l=this;switch(t){case"query":typeof n=="string"&&n.length&&(n=(i||aD.parse)(n)),l[t]=n;break;case"port":l[t]=n,Q6(n,l.protocol)?n&&(l.host=l.hostname+":"+n):(l.host=l.hostname,l[t]="");break;case"hostname":l[t]=n,l.port&&(n+=":"+l.port),l.host=n;break;case"host":l[t]=n,tH.test(n)?(n=n.split(":"),l.port=n.pop(),l.hostname=n.join(":")):(l.hostname=n,l.port="");break;case"protocol":l.protocol=n.toLowerCase(),l.slashes=!i;break;case"pathname":case"hash":if(n){var h=t==="pathname"?"/":"#";l[t]=n.charAt(0)!==h?h+n:n}else l[t]=n;break;case"username":case"password":l[t]=encodeURIComponent(n);break;case"auth":var o=n.indexOf(":");~o?(l.username=n.slice(0,o),l.username=encodeURIComponent(decodeURIComponent(l.username)),l.password=n.slice(o+1),l.password=encodeURIComponent(decodeURIComponent(l.password))):l.username=encodeURIComponent(decodeURIComponent(n))}for(var E=0;E<NR.length;E++){var A=NR[E];A[4]&&(l[A[1]]=l[A[1]].toLowerCase())}return l.auth=l.password?l.username+":"+l.password:l.username,l.origin=l.protocol!=="file:"&&jd(l.protocol)&&l.host?l.protocol+"//"+l.host:"null",l.href=l.toString(),l}function tle(t){(!t||typeof t!="function")&&(t=aD.stringify);var n,i=this,l=i.host,h=i.protocol;h&&h.charAt(h.length-1)!==":"&&(h+=":");var o=h+(i.protocol&&i.slashes||jd(i.protocol)?"//":"");return i.username?(o+=i.username,i.password&&(o+=":"+i.password),o+="@"):i.password?(o+=":"+i.password,o+="@"):i.protocol!=="file:"&&jd(i.protocol)&&!l&&i.pathname!=="/"&&(o+="@"),(l[l.length-1]===":"||tH.test(i.hostname)&&!i.port)&&(l+=":"),o+=l+i.pathname,n=typeof i.query=="object"?t(i.query):i.query,n&&(o+=n.charAt(0)!=="?"?"?"+n:n),i.hash&&(o+=i.hash),o}Vd.prototype={set:ele,toString:tle};Vd.extractProtocol=iH;Vd.location=nH;Vd.trimLeft=zR;Vd.qs=aD;rH.exports=Vd});var uc=Gn((MOe,oH)=>{"use strict";var nle=BR(),ile=function(){};oH.exports={getOrigin:function(t){if(!t)return null;var n=new nle(t);if(n.protocol==="file:")return null;var i=n.port;return i||(i=n.protocol==="https:"?"443":"80"),n.protocol+"//"+n.hostname+":"+i},isOriginEqual:function(t,n){var i=this.getOrigin(t)===this.getOrigin(n);return ile("same",t,n,i),i},isSchemeEqual:function(t,n){return t.split(":")[0]===n.split(":")[0]},addPath:function(t,n){var i=t.split("?");return i[0]+n+(i[1]?"?"+i[1]:"")},addQuery:function(t,n){return t+(t.indexOf("?")===-1?"?"+n:"&"+n)},isLoopbackAddr:function(t){return/^127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(t)||/^\[::1\]$/.test(t)}}});var Br=Gn((AOe,jR)=>{"use strict";typeof Object.create=="function"?jR.exports=function(n,i){i&&(n.super_=i,n.prototype=Object.create(i.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}))}:jR.exports=function(n,i){if(i){n.super_=i;var l=function(){};l.prototype=i.prototype,n.prototype=new l,n.prototype.constructor=n}}});var VR=Gn((POe,sH)=>{"use strict";function lD(){this._listeners={}}lD.prototype.addEventListener=function(t,n){t in this._listeners||(this._listeners[t]=[]);var i=this._listeners[t];i.indexOf(n)===-1&&(i=i.concat([n])),this._listeners[t]=i};lD.prototype.removeEventListener=function(t,n){var i=this._listeners[t];if(i){var l=i.indexOf(n);if(l!==-1){i.length>1?this._listeners[t]=i.slice(0,l).concat(i.slice(l+1)):delete this._listeners[t];return}}};lD.prototype.dispatchEvent=function(){var t=arguments[0],n=t.type,i=arguments.length===1?[t]:Array.apply(null,arguments);if(this["on"+n]&&this["on"+n].apply(this,i),n in this._listeners)for(var l=this._listeners[n],h=0;h<l.length;h++)l[h].apply(this,i)};sH.exports=lD});var Ha=Gn((OOe,aH)=>{"use strict";var rle=Br(),cD=VR();function Np(){cD.call(this)}rle(Np,cD);Np.prototype.removeAllListeners=function(t){t?delete this._listeners[t]:this._listeners={}};Np.prototype.once=function(t,n){var i=this,l=!1;function h(){i.removeListener(t,h),l||(l=!0,n.apply(this,arguments))}this.on(t,h)};Np.prototype.emit=function(){var t=arguments[0],n=this._listeners[t];if(n){for(var i=arguments.length,l=new Array(i-1),h=1;h<i;h++)l[h-1]=arguments[h];for(var o=0;o<n.length;o++)n[o].apply(this,l)}};Np.prototype.on=Np.prototype.addListener=cD.prototype.addEventListener;Np.prototype.removeListener=cD.prototype.removeEventListener;aH.exports.EventEmitter=Np});var cH=Gn((ROe,UR)=>{"use strict";var lH=global.WebSocket||global.MozWebSocket;lH?UR.exports=function(n){return new lH(n)}:UR.exports=void 0});var pH=Gn((kOe,fH)=>{"use strict";var uH=Jh(),ole=uc(),sle=Br(),dH=Ha().EventEmitter,hH=cH(),Qh=function(){};function ef(t,n,i){if(!ef.enabled())throw new Error("Transport created when disabled");dH.call(this),Qh("constructor",t);var l=this,h=ole.addPath(t,"/websocket");h.slice(0,5)==="https"?h="wss"+h.slice(5):h="ws"+h.slice(4),this.url=h,this.ws=new hH(this.url,[],i),this.ws.onmessage=function(o){Qh("message event",o.data),l.emit("message",o.data)},this.unloadRef=uH.unloadAdd(function(){Qh("unload"),l.ws.close()}),this.ws.onclose=function(o){Qh("close event",o.code,o.reason),l.emit("close",o.code,o.reason),l._cleanup()},this.ws.onerror=function(o){Qh("error event",o),l.emit("close",1006,"WebSocket connection broken"),l._cleanup()}}sle(ef,dH);ef.prototype.send=function(t){var n="["+t+"]";Qh("send",n),this.ws.send(n)};ef.prototype.close=function(){Qh("close");var t=this.ws;this._cleanup(),t&&t.close()};ef.prototype._cleanup=function(){Qh("_cleanup");var t=this.ws;t&&(t.onmessage=t.onclose=t.onerror=null),uH.unloadDel(this.unloadRef),this.unloadRef=this.ws=null,this.removeAllListeners()};ef.enabled=function(){return Qh("enabled"),!!hH};ef.transportName="websocket";ef.roundTrips=2;fH.exports=ef});var _H=Gn((FOe,gH)=>{"use strict";var ale=Br(),mH=Ha().EventEmitter,tf=function(){};function wg(t,n){tf(t),mH.call(this),this.sendBuffer=[],this.sender=n,this.url=t}ale(wg,mH);wg.prototype.send=function(t){tf("send",t),this.sendBuffer.push(t),this.sendStop||this.sendSchedule()};wg.prototype.sendScheduleWait=function(){tf("sendScheduleWait");var t=this,n;this.sendStop=function(){tf("sendStop"),t.sendStop=null,clearTimeout(n)},n=setTimeout(function(){tf("timeout"),t.sendStop=null,t.sendSchedule()},25)};wg.prototype.sendSchedule=function(){tf("sendSchedule",this.sendBuffer.length);var t=this;if(this.sendBuffer.length>0){var n="["+this.sendBuffer.join(",")+"]";this.sendStop=this.sender(this.url,n,function(i){t.sendStop=null,i?(tf("error",i),t.emit("close",i.code||1006,"Sending error: "+i),t.close()):t.sendScheduleWait()}),this.sendBuffer=[]}};wg.prototype._cleanup=function(){tf("_cleanup"),this.removeAllListeners()};wg.prototype.close=function(){tf("close"),this._cleanup(),this.sendStop&&(this.sendStop(),this.sendStop=null)};gH.exports=wg});var xH=Gn((LOe,yH)=>{"use strict";var lle=Br(),vH=Ha().EventEmitter,f1=function(){};function uD(t,n,i){f1(n),vH.call(this),this.Receiver=t,this.receiveUrl=n,this.AjaxObject=i,this._scheduleReceiver()}lle(uD,vH);uD.prototype._scheduleReceiver=function(){f1("_scheduleReceiver");var t=this,n=this.poll=new this.Receiver(this.receiveUrl,this.AjaxObject);n.on("message",function(i){f1("message",i),t.emit("message",i)}),n.once("close",function(i,l){f1("close",i,l,t.pollIsClosing),t.poll=n=null,t.pollIsClosing||(l==="network"?t._scheduleReceiver():(t.emit("close",i||1006,l),t.removeAllListeners()))})};uD.prototype.abort=function(){f1("abort"),this.removeAllListeners(),this.pollIsClosing=!0,this.poll&&this.poll.abort()};yH.exports=uD});var GR=Gn((NOe,bH)=>{"use strict";var cle=Br(),ule=uc(),HR=_H(),dle=xH(),dD=function(){};function $R(t,n,i,l,h){var o=ule.addPath(t,n);dD(o);var E=this;HR.call(this,t,i),this.poll=new dle(l,o,h),this.poll.on("message",function(A){dD("poll message",A),E.emit("message",A)}),this.poll.once("close",function(A,L){dD("poll close",A,L),E.poll=null,E.emit("close",A,L),E.close()})}cle($R,HR);$R.prototype.close=function(){HR.prototype.close.call(this),dD("close"),this.removeAllListeners(),this.poll&&(this.poll.abort(),this.poll=null)};bH.exports=$R});var Cg=Gn((zOe,EH)=>{"use strict";var hle=Br(),fle=uc(),wH=GR(),qR=function(){};function ple(t){return function(n,i,l){qR("create ajax sender",n,i);var h={};typeof i=="string"&&(h.headers={"Content-type":"text/plain"});var o=fle.addPath(n,"/xhr_send"),E=new t("POST",o,i,h);return E.once("finish",function(A){if(qR("finish",A),E=null,A!==200&&A!==204)return l(new Error("http status "+A));l()}),function(){qR("abort"),E.close(),E=null;var A=new Error("Aborted");A.code=1e3,l(A)}}}function CH(t,n,i,l){wH.call(this,t,n,ple(l),i,l)}hle(CH,wH);EH.exports=CH});var m1=Gn((BOe,SH)=>{"use strict";var mle=Br(),TH=Ha().EventEmitter,zp=function(){};function p1(t,n){zp(t),TH.call(this);var i=this;this.bufferPosition=0,this.xo=new n("POST",t,null),this.xo.on("chunk",this._chunkHandler.bind(this)),this.xo.once("finish",function(l,h){zp("finish",l,h),i._chunkHandler(l,h),i.xo=null;var o=l===200?"network":"permanent";zp("close",o),i.emit("close",null,o),i._cleanup()})}mle(p1,TH);p1.prototype._chunkHandler=function(t,n){if(zp("_chunkHandler",t),!(t!==200||!n))for(var i=-1;;this.bufferPosition+=i+1){var l=n.slice(this.bufferPosition);if(i=l.indexOf(`
`),i===-1)break;var h=l.slice(0,i);h&&(zp("message",h),this.emit("message",h))}};p1.prototype._cleanup=function(){zp("_cleanup"),this.removeAllListeners()};p1.prototype.abort=function(){zp("abort"),this.xo&&(this.xo.close(),zp("close"),this.emit("close",null,"user"),this.xo=null),this._cleanup()};SH.exports=p1});var WR=Gn((jOe,PH)=>{"use strict";var IH=Ha().EventEmitter,gle=Br(),MH=Jh(),_le=uc(),g1=global.XMLHttpRequest,zl=function(){};function Ud(t,n,i,l){zl(t,n);var h=this;IH.call(this),setTimeout(function(){h._start(t,n,i,l)},0)}gle(Ud,IH);Ud.prototype._start=function(t,n,i,l){var h=this;try{this.xhr=new g1}catch{}if(!this.xhr){zl("no xhr"),this.emit("finish",0,"no xhr support"),this._cleanup();return}n=_le.addQuery(n,"t="+ +new Date),this.unloadRef=MH.unloadAdd(function(){zl("unload cleanup"),h._cleanup(!0)});try{this.xhr.open(t,n,!0),this.timeout&&"timeout"in this.xhr&&(this.xhr.timeout=this.timeout,this.xhr.ontimeout=function(){zl("xhr timeout"),h.emit("finish",0,""),h._cleanup(!1)})}catch(E){zl("exception",E),this.emit("finish",0,""),this._cleanup(!1);return}if((!l||!l.noCredentials)&&Ud.supportsCORS&&(zl("withCredentials"),this.xhr.withCredentials=!0),l&&l.headers)for(var o in l.headers)this.xhr.setRequestHeader(o,l.headers[o]);this.xhr.onreadystatechange=function(){if(h.xhr){var E=h.xhr,A,L;switch(zl("readyState",E.readyState),E.readyState){case 3:try{L=E.status,A=E.responseText}catch{}zl("status",L),L===1223&&(L=204),L===200&&A&&A.length>0&&(zl("chunk"),h.emit("chunk",L,A));break;case 4:L=E.status,zl("status",L),L===1223&&(L=204),(L===12005||L===12029)&&(L=0),zl("finish",L,E.responseText),h.emit("finish",L,E.responseText),h._cleanup(!1);break}}};try{h.xhr.send(i)}catch{h.emit("finish",0,""),h._cleanup(!1)}};Ud.prototype._cleanup=function(t){if(zl("cleanup"),!!this.xhr){if(this.removeAllListeners(),MH.unloadDel(this.unloadRef),this.xhr.onreadystatechange=function(){},this.xhr.ontimeout&&(this.xhr.ontimeout=null),t)try{this.xhr.abort()}catch{}this.unloadRef=this.xhr=null}};Ud.prototype.close=function(){zl("close"),this._cleanup(!0)};Ud.enabled=!!g1;var DH=["Active"].concat("Object").join("X");!Ud.enabled&&DH in global&&(zl("overriding xmlhttprequest"),g1=function(){try{return new global[DH]("Microsoft.XMLHTTP")}catch{return null}},Ud.enabled=!!new g1);var AH=!1;try{AH="withCredentials"in new g1}catch{}Ud.supportsCORS=AH;PH.exports=Ud});var _1=Gn((VOe,OH)=>{"use strict";var vle=Br(),hD=WR();function ZR(t,n,i,l){hD.call(this,t,n,i,l)}vle(ZR,hD);ZR.enabled=hD.enabled&&hD.supportsCORS;OH.exports=ZR});var gv=Gn((UOe,RH)=>{"use strict";var yle=Br(),XR=WR();function YR(t,n,i){XR.call(this,t,n,i,{noCredentials:!0})}yle(YR,XR);YR.enabled=XR.enabled;RH.exports=YR});var _v=Gn((HOe,kH)=>{"use strict";kH.exports={isOpera:function(){return global.navigator&&/opera/i.test(global.navigator.userAgent)},isKonqueror:function(){return global.navigator&&/konqueror/i.test(global.navigator.userAgent)},hasDomain:function(){if(!global.document)return!0;try{return!!global.document.domain}catch{return!1}}}});var NH=Gn(($Oe,LH)=>{"use strict";var xle=Br(),FH=Cg(),ble=m1(),KR=_1(),wle=gv(),Cle=_v();function vv(t){if(!wle.enabled&&!KR.enabled)throw new Error("Transport created when disabled");FH.call(this,t,"/xhr_streaming",ble,KR)}xle(vv,FH);vv.enabled=function(t){return t.nullOrigin||Cle.isOpera()?!1:KR.enabled};vv.transportName="xhr-streaming";vv.roundTrips=2;vv.needBody=!!global.document;LH.exports=vv});var fD=Gn((GOe,jH)=>{"use strict";var zH=Ha().EventEmitter,Ele=Br(),BH=Jh(),Tle=_v(),Sle=uc(),Bp=function(){};function Eg(t,n,i){Bp(t,n);var l=this;zH.call(this),setTimeout(function(){l._start(t,n,i)},0)}Ele(Eg,zH);Eg.prototype._start=function(t,n,i){Bp("_start");var l=this,h=new global.XDomainRequest;n=Sle.addQuery(n,"t="+ +new Date),h.onerror=function(){Bp("onerror"),l._error()},h.ontimeout=function(){Bp("ontimeout"),l._error()},h.onprogress=function(){Bp("progress",h.responseText),l.emit("chunk",200,h.responseText)},h.onload=function(){Bp("load"),l.emit("finish",200,h.responseText),l._cleanup(!1)},this.xdr=h,this.unloadRef=BH.unloadAdd(function(){l._cleanup(!0)});try{this.xdr.open(t,n),this.timeout&&(this.xdr.timeout=this.timeout),this.xdr.send(i)}catch{this._error()}};Eg.prototype._error=function(){this.emit("finish",0,""),this._cleanup(!1)};Eg.prototype._cleanup=function(t){if(Bp("cleanup",t),!!this.xdr){if(this.removeAllListeners(),BH.unloadDel(this.unloadRef),this.xdr.ontimeout=this.xdr.onerror=this.xdr.onprogress=this.xdr.onload=null,t)try{this.xdr.abort()}catch{}this.unloadRef=this.xdr=null}};Eg.prototype.close=function(){Bp("close"),this._cleanup(!0)};Eg.enabled=!!(global.XDomainRequest&&Tle.hasDomain());jH.exports=Eg});var QR=Gn((qOe,UH)=>{"use strict";var Dle=Br(),VH=Cg(),Ile=m1(),JR=fD();function v1(t){if(!JR.enabled)throw new Error("Transport created when disabled");VH.call(this,t,"/xhr_streaming",Ile,JR)}Dle(v1,VH);v1.enabled=function(t){return t.cookie_needed||t.nullOrigin?!1:JR.enabled&&t.sameScheme};v1.transportName="xdr-streaming";v1.roundTrips=2;UH.exports=v1});var ek=Gn((WOe,HH)=>{"use strict";HH.exports=global.EventSource});var qH=Gn((ZOe,GH)=>{"use strict";var Mle=Br(),$H=Ha().EventEmitter,Ale=ek(),yv=function(){};function y1(t){yv(t),$H.call(this);var n=this,i=this.es=new Ale(t);i.onmessage=function(l){yv("message",l.data),n.emit("message",decodeURI(l.data))},i.onerror=function(l){yv("error",i.readyState,l);var h=i.readyState!==2?"network":"permanent";n._cleanup(),n._close(h)}}Mle(y1,$H);y1.prototype.abort=function(){yv("abort"),this._cleanup(),this._close("user")};y1.prototype._cleanup=function(){yv("cleanup");var t=this.es;t&&(t.onmessage=t.onerror=null,t.close(),this.es=null)};y1.prototype._close=function(t){yv("close",t);var n=this;setTimeout(function(){n.emit("close",null,t),n.removeAllListeners()},200)};GH.exports=y1});var tk=Gn((XOe,ZH)=>{"use strict";var Ple=Br(),WH=Cg(),Ole=qH(),Rle=_1(),kle=ek();function xv(t){if(!xv.enabled())throw new Error("Transport created when disabled");WH.call(this,t,"/eventsource",Ole,Rle)}Ple(xv,WH);xv.enabled=function(){return!!kle};xv.transportName="eventsource";xv.roundTrips=2;ZH.exports=xv});var nk=Gn((YOe,XH)=>{"use strict";XH.exports="1.6.1"});var bv=Gn((KOe,nf)=>{"use strict";var pD=Jh(),Fle=_v(),Tg=function(){};nf.exports={WPrefix:"_jp",currentWindowId:null,polluteGlobalNamespace:function(){nf.exports.WPrefix in global||(global[nf.exports.WPrefix]={})},postMessage:function(t,n){global.parent!==global?global.parent.postMessage(JSON.stringify({windowId:nf.exports.currentWindowId,type:t,data:n||""}),"*"):Tg("Cannot postMessage, no parent window.",t,n)},createIframe:function(t,n){var i=global.document.createElement("iframe"),l,h,o=function(){Tg("unattach"),clearTimeout(l);try{i.onload=null}catch{}i.onerror=null},E=function(){Tg("cleanup"),i&&(o(),setTimeout(function(){i&&i.parentNode.removeChild(i),i=null},0),pD.unloadDel(h))},A=function(Y){Tg("onerror",Y),i&&(E(),n(Y))},L=function(Y,le){Tg("post",Y,le),setTimeout(function(){try{i&&i.contentWindow&&i.contentWindow.postMessage(Y,le)}catch{}},0)};return i.src=t,i.style.display="none",i.style.position="absolute",i.onerror=function(){A("onerror")},i.onload=function(){Tg("onload"),clearTimeout(l),l=setTimeout(function(){A("onload timeout")},2e3)},global.document.body.appendChild(i),l=setTimeout(function(){A("timeout")},15e3),h=pD.unloadAdd(E),{post:L,cleanup:E,loaded:o}},createHtmlfile:function(t,n){var i=["Active"].concat("Object").join("X"),l=new global[i]("htmlfile"),h,o,E,A=function(){clearTimeout(h),E.onerror=null},L=function(){l&&(A(),pD.unloadDel(o),E.parentNode.removeChild(E),E=l=null,CollectGarbage())},Y=function(ze){Tg("onerror",ze),l&&(L(),n(ze))},le=function(ze,Ae){try{setTimeout(function(){E&&E.contentWindow&&E.contentWindow.postMessage(ze,Ae)},0)}catch{}};l.open(),l.write('<html><script>document.domain="'+global.document.domain+'";<\/script></html>'),l.close(),l.parentWindow[nf.exports.WPrefix]=global[nf.exports.WPrefix];var te=l.createElement("div");return l.body.appendChild(te),E=l.createElement("iframe"),te.appendChild(E),E.src=t,E.onerror=function(){Y("onerror")},h=setTimeout(function(){Y("timeout")},15e3),o=pD.unloadAdd(L),{post:le,cleanup:L,loaded:A}}};nf.exports.iframeEnabled=!1;global.document&&(nf.exports.iframeEnabled=(typeof global.postMessage=="function"||typeof global.postMessage=="object")&&!Fle.isKonqueror())});var rk=Gn((JOe,QH)=>{"use strict";var Lle=Br(),YH=Ha().EventEmitter,Nle=nk(),ik=uc(),KH=bv(),JH=Jh(),zle=bg(),Hd=function(){};function $d(t,n,i){if(!$d.enabled())throw new Error("Transport created when disabled");YH.call(this);var l=this;this.origin=ik.getOrigin(i),this.baseUrl=i,this.transUrl=n,this.transport=t,this.windowId=zle.string(8);var h=ik.addPath(i,"/iframe.html")+"#"+this.windowId;Hd(t,n,h),this.iframeObj=KH.createIframe(h,function(o){Hd("err callback"),l.emit("close",1006,"Unable to load an iframe ("+o+")"),l.close()}),this.onmessageCallback=this._message.bind(this),JH.attachEvent("message",this.onmessageCallback)}Lle($d,YH);$d.prototype.close=function(){if(Hd("close"),this.removeAllListeners(),this.iframeObj){JH.detachEvent("message",this.onmessageCallback);try{this.postMessage("c")}catch{}this.iframeObj.cleanup(),this.iframeObj=null,this.onmessageCallback=this.iframeObj=null}};$d.prototype._message=function(t){if(Hd("message",t.data),!ik.isOriginEqual(t.origin,this.origin)){Hd("not same origin",t.origin,this.origin);return}var n;try{n=JSON.parse(t.data)}catch{Hd("bad json",t.data);return}if(n.windowId!==this.windowId){Hd("mismatched window id",n.windowId,this.windowId);return}switch(n.type){case"s":this.iframeObj.loaded(),this.postMessage("s",JSON.stringify([Nle,this.transport,this.transUrl,this.baseUrl]));break;case"t":this.emit("message",n.data);break;case"c":var i;try{i=JSON.parse(n.data)}catch{Hd("bad json",n.data);return}this.emit("close",i[0],i[1]),this.close();break}};$d.prototype.postMessage=function(t,n){Hd("postMessage",t,n),this.iframeObj.post(JSON.stringify({windowId:this.windowId,type:t,data:n||""}),this.origin)};$d.prototype.send=function(t){Hd("send",t),this.postMessage("m",t)};$d.enabled=function(){return KH.iframeEnabled};$d.transportName="iframe";$d.roundTrips=2;QH.exports=$d});var mD=Gn((QOe,e8)=>{"use strict";e8.exports={isObject:function(t){var n=typeof t;return n==="function"||n==="object"&&!!t},extend:function(t){if(!this.isObject(t))return t;for(var n,i,l=1,h=arguments.length;l<h;l++){n=arguments[l];for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}}});var _D=Gn((eRe,t8)=>{"use strict";var Ble=Br(),gD=rk(),jle=mD();t8.exports=function(t){function n(i,l){gD.call(this,t.transportName,i,l)}return Ble(n,gD),n.enabled=function(i,l){if(!global.document)return!1;var h=jle.extend({},l);return h.sameOrigin=!0,t.enabled(h)&&gD.enabled()},n.transportName="iframe-"+t.transportName,n.needBody=!0,n.roundTrips=gD.roundTrips+t.roundTrips-1,n.facadeTransport=t,n}});var o8=Gn((tRe,r8)=>{"use strict";var Vle=Br(),Sg=bv(),Ule=uc(),i8=Ha().EventEmitter,Hle=bg(),rf=function(){};function Fu(t){rf(t),i8.call(this);var n=this;Sg.polluteGlobalNamespace(),this.id="a"+Hle.string(6),t=Ule.addQuery(t,"c="+decodeURIComponent(Sg.WPrefix+"."+this.id)),rf("using htmlfile",Fu.htmlfileEnabled);var i=Fu.htmlfileEnabled?Sg.createHtmlfile:Sg.createIframe;global[Sg.WPrefix][this.id]={start:function(){rf("start"),n.iframeObj.loaded()},message:function(l){rf("message",l),n.emit("message",l)},stop:function(){rf("stop"),n._cleanup(),n._close("network")}},this.iframeObj=i(t,function(){rf("callback"),n._cleanup(),n._close("permanent")})}Vle(Fu,i8);Fu.prototype.abort=function(){rf("abort"),this._cleanup(),this._close("user")};Fu.prototype._cleanup=function(){rf("_cleanup"),this.iframeObj&&(this.iframeObj.cleanup(),this.iframeObj=null),delete global[Sg.WPrefix][this.id]};Fu.prototype._close=function(t){rf("_close",t),this.emit("close",null,t),this.removeAllListeners()};Fu.htmlfileEnabled=!1;var n8=["Active"].concat("Object").join("X");if(n8 in global)try{Fu.htmlfileEnabled=!!new global[n8]("htmlfile")}catch{}Fu.enabled=Fu.htmlfileEnabled||Sg.iframeEnabled;r8.exports=Fu});var sk=Gn((nRe,a8)=>{"use strict";var $le=Br(),ok=o8(),Gle=gv(),s8=Cg();function x1(t){if(!ok.enabled)throw new Error("Transport created when disabled");s8.call(this,t,"/htmlfile",ok,Gle)}$le(x1,s8);x1.enabled=function(t){return ok.enabled&&t.sameOrigin};x1.transportName="htmlfile";x1.roundTrips=2;a8.exports=x1});var lk=Gn((iRe,u8)=>{"use strict";var qle=Br(),l8=Cg(),Wle=m1(),ak=_1(),c8=gv();function b1(t){if(!c8.enabled&&!ak.enabled)throw new Error("Transport created when disabled");l8.call(this,t,"/xhr",Wle,ak)}qle(b1,l8);b1.enabled=function(t){return t.nullOrigin?!1:c8.enabled&&t.sameOrigin?!0:ak.enabled};b1.transportName="xhr-polling";b1.roundTrips=2;u8.exports=b1});var p8=Gn((rRe,f8)=>{"use strict";var Zle=Br(),h8=Cg(),Xle=QR(),Yle=m1(),d8=fD();function w1(t){if(!d8.enabled)throw new Error("Transport created when disabled");h8.call(this,t,"/xhr",Yle,d8)}Zle(w1,h8);w1.enabled=Xle.enabled;w1.transportName="xdr-polling";w1.roundTrips=2;f8.exports=w1});var v8=Gn((oRe,_8)=>{"use strict";var C1=bv(),m8=bg(),Kle=_v(),Jle=uc(),Qle=Br(),g8=Ha().EventEmitter,Lu=function(){};function Bc(t){Lu(t);var n=this;g8.call(this),C1.polluteGlobalNamespace(),this.id="a"+m8.string(6);var i=Jle.addQuery(t,"c="+encodeURIComponent(C1.WPrefix+"."+this.id));global[C1.WPrefix][this.id]=this._callback.bind(this),this._createScript(i),this.timeoutId=setTimeout(function(){Lu("timeout"),n._abort(new Error("JSONP script loaded abnormally (timeout)"))},Bc.timeout)}Qle(Bc,g8);Bc.prototype.abort=function(){if(Lu("abort"),global[C1.WPrefix][this.id]){var t=new Error("JSONP user aborted read");t.code=1e3,this._abort(t)}};Bc.timeout=35e3;Bc.scriptErrorTimeout=1e3;Bc.prototype._callback=function(t){Lu("_callback",t),this._cleanup(),!this.aborting&&(t&&(Lu("message",t),this.emit("message",t)),this.emit("close",null,"network"),this.removeAllListeners())};Bc.prototype._abort=function(t){Lu("_abort",t),this._cleanup(),this.aborting=!0,this.emit("close",t.code,t.message),this.removeAllListeners()};Bc.prototype._cleanup=function(){if(Lu("_cleanup"),clearTimeout(this.timeoutId),this.script2&&(this.script2.parentNode.removeChild(this.script2),this.script2=null),this.script){var t=this.script;t.parentNode.removeChild(t),t.onreadystatechange=t.onerror=t.onload=t.onclick=null,this.script=null}delete global[C1.WPrefix][this.id]};Bc.prototype._scriptError=function(){Lu("_scriptError");var t=this;this.errorTimer||(this.errorTimer=setTimeout(function(){t.loadedOkay||t._abort(new Error("JSONP script loaded abnormally (onerror)"))},Bc.scriptErrorTimeout))};Bc.prototype._createScript=function(t){Lu("_createScript",t);var n=this,i=this.script=global.document.createElement("script"),l;if(i.id="a"+m8.string(8),i.src=t,i.type="text/javascript",i.charset="UTF-8",i.onerror=this._scriptError.bind(this),i.onload=function(){Lu("onload"),n._abort(new Error("JSONP script loaded abnormally (onload)"))},i.onreadystatechange=function(){if(Lu("onreadystatechange",i.readyState),/loaded|closed/.test(i.readyState)){if(i&&i.htmlFor&&i.onclick){n.loadedOkay=!0;try{i.onclick()}catch{}}i&&n._abort(new Error("JSONP script loaded abnormally (onreadystatechange)"))}},typeof i.async>"u"&&global.document.attachEvent)if(Kle.isOpera())l=this.script2=global.document.createElement("script"),l.text="try{var a = document.getElementById('"+i.id+"'); if(a)a.onerror();}catch(x){};",i.async=l.async=!1;else{try{i.htmlFor=i.id,i.event="onclick"}catch{}i.async=!0}typeof i.async<"u"&&(i.async=!0);var h=global.document.getElementsByTagName("head")[0];h.insertBefore(i,h.firstChild),l&&h.insertBefore(l,h.firstChild)};_8.exports=Bc});var b8=Gn((sRe,x8)=>{"use strict";var ece=bg(),y8=uc(),of=function(){},dc,E1;function tce(t){of("createIframe",t);try{return global.document.createElement('<iframe name="'+t+'">')}catch{var n=global.document.createElement("iframe");return n.name=t,n}}function nce(){of("createForm"),dc=global.document.createElement("form"),dc.style.display="none",dc.style.position="absolute",dc.method="POST",dc.enctype="application/x-www-form-urlencoded",dc.acceptCharset="UTF-8",E1=global.document.createElement("textarea"),E1.name="d",dc.appendChild(E1),global.document.body.appendChild(dc)}x8.exports=function(t,n,i){of(t,n),dc||nce();var l="a"+ece.string(8);dc.target=l,dc.action=y8.addQuery(y8.addPath(t,"/jsonp_send"),"i="+l);var h=tce(l);h.id=l,h.style.display="none",dc.appendChild(h);try{E1.value=n}catch{}dc.submit();var o=function(E){of("completed",l,E),h.onerror&&(h.onreadystatechange=h.onerror=h.onload=null,setTimeout(function(){of("cleaning up",l),h.parentNode.removeChild(h),h=null},500),E1.value="",i(E))};return h.onerror=function(){of("onerror",l),o()},h.onload=function(){of("onload",l),o()},h.onreadystatechange=function(E){of("onreadystatechange",l,h.readyState,E),h.readyState==="complete"&&o()},function(){of("aborted",l),o(new Error("Aborted"))}}});var E8=Gn((aRe,C8)=>{"use strict";var ice=Br(),w8=GR(),rce=v8(),oce=b8();function Dg(t){if(!Dg.enabled())throw new Error("Transport created when disabled");w8.call(this,t,"/jsonp",oce,rce)}ice(Dg,w8);Dg.enabled=function(){return!!global.document};Dg.transportName="jsonp-polling";Dg.roundTrips=1;Dg.needBody=!0;C8.exports=Dg});var S8=Gn((lRe,T8)=>{"use strict";T8.exports=[pH(),NH(),QR(),tk(),_D()(tk()),sk(),_D()(sk()),lk(),p8(),_D()(lk()),E8()]});var R8=Gn(()=>{"use strict";var T1=Array.prototype,hk=Object.prototype,sce=Function.prototype,S1=String.prototype,ck=T1.slice,fk=hk.toString,M8=function(t){return hk.toString.call(t)==="[object Function]"},ace=function(n){return fk.call(n)==="[object Array]"},A8=function(n){return fk.call(n)==="[object String]"},lce=Object.defineProperty&&(function(){try{return Object.defineProperty({},"x",{}),!0}catch{return!1}})(),dk;lce?dk=function(t,n,i,l){!l&&n in t||Object.defineProperty(t,n,{configurable:!0,enumerable:!1,writable:!0,value:i})}:dk=function(t,n,i,l){!l&&n in t||(t[n]=i)};var D1=function(t,n,i){for(var l in n)hk.hasOwnProperty.call(n,l)&&dk(t,l,n[l],i)},P8=function(t){if(t==null)throw new TypeError("can't convert "+t+" to object");return Object(t)};function cce(t){var n=+t;return n!==n?n=0:n!==0&&n!==1/0&&n!==-1/0&&(n=(n>0||-1)*Math.floor(Math.abs(n))),n}function uce(t){return t>>>0}function uk(){}D1(sce,{bind:function(n){var i=this;if(!M8(i))throw new TypeError("Function.prototype.bind called on incompatible "+i);for(var l=ck.call(arguments,1),h=function(){if(this instanceof L){var Y=i.apply(this,l.concat(ck.call(arguments)));return Object(Y)===Y?Y:this}else return i.apply(n,l.concat(ck.call(arguments)))},o=Math.max(0,i.length-l.length),E=[],A=0;A<o;A++)E.push("$"+A);var L=Function("binder","return function ("+E.join(",")+"){ return binder.apply(this, arguments); }")(h);return i.prototype&&(uk.prototype=i.prototype,L.prototype=new uk,uk.prototype=null),L}});D1(Array,{isArray:ace});var D8=Object("a"),O8=D8[0]!=="a"||!(0 in D8),dce=function(n){var i=!0,l=!0;return n&&(n.call("foo",function(h,o,E){typeof E!="object"&&(i=!1)}),n.call([1],function(){"use strict";l=typeof this=="string"},"x")),!!n&&i&&l};D1(T1,{forEach:function(n){var i=P8(this),l=O8&&A8(this)?this.split(""):i,h=arguments[1],o=-1,E=l.length>>>0;if(!M8(n))throw new TypeError;for(;++o<E;)o in l&&n.call(h,l[o],o,i)}},!dce(T1.forEach));var hce=Array.prototype.indexOf&&[0,1].indexOf(1,2)!==-1;D1(T1,{indexOf:function(n){var i=O8&&A8(this)?this.split(""):P8(this),l=i.length>>>0;if(!l)return-1;var h=0;for(arguments.length>1&&(h=cce(arguments[1])),h=h>=0?h:Math.max(0,l+h);h<l;h++)if(h in i&&i[h]===n)return h;return-1}},hce);var I8=S1.split;"ab".split(/(?:ab)*/).length!==2||".".split(/(.?)(.?)/).length!==4||"tesst".split(/(s)*/)[1]==="t"||"test".split(/(?:)/,-1).length!==4||"".split(/.?/).length||".".split(/()()/).length>1?(function(){var t=/()??/.exec("")[1]===void 0;S1.split=function(n,i){var l=this;if(n===void 0&&i===0)return[];if(fk.call(n)!=="[object RegExp]")return I8.call(this,n,i);var h=[],o=(n.ignoreCase?"i":"")+(n.multiline?"m":"")+(n.extended?"x":"")+(n.sticky?"y":""),E=0,A,L,Y,le;for(n=new RegExp(n.source,o+"g"),l+="",t||(A=new RegExp("^"+n.source+"$(?!\\s)",o)),i=i===void 0?-1>>>0:uce(i);(L=n.exec(l))&&(Y=L.index+L[0].length,!(Y>E&&(h.push(l.slice(E,L.index)),!t&&L.length>1&&L[0].replace(A,function(){for(var te=1;te<arguments.length-2;te++)arguments[te]===void 0&&(L[te]=void 0)}),L.length>1&&L.index<l.length&&T1.push.apply(h,L.slice(1)),le=L[0].length,E=Y,h.length>=i)));)n.lastIndex===L.index&&n.lastIndex++;return E===l.length?(le||!n.test(""))&&h.push(""):h.push(l.slice(E)),h.length>i?h.slice(0,i):h}})():"0".split(void 0,0).length&&(S1.split=function(n,i){return n===void 0&&i===0?[]:I8.call(this,n,i)});var fce=S1.substr,pce="".substr&&"0b".substr(-1)!=="b";D1(S1,{substr:function(n,i){return fce.call(this,n<0&&(n=this.length+n)<0?0:n,i)}},pce)});var F8=Gn((dRe,k8)=>{"use strict";var vD=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,pk,mce=function(t){var n,i={},l=[];for(n=0;n<65536;n++)l.push(String.fromCharCode(n));return t.lastIndex=0,l.join("").replace(t,function(h){return i[h]="\\u"+("0000"+h.charCodeAt(0).toString(16)).slice(-4),""}),t.lastIndex=0,i};k8.exports={quote:function(t){var n=JSON.stringify(t);return vD.lastIndex=0,vD.test(n)?(pk||(pk=mce(vD)),n.replace(vD,function(i){return pk[i]})):n}}});var N8=Gn((hRe,L8)=>{"use strict";var yD=function(){};L8.exports=function(t){return{filterToEnabled:function(n,i){var l={main:[],facade:[]};return n?typeof n=="string"&&(n=[n]):n=[],t.forEach(function(h){if(h){if(h.transportName==="websocket"&&i.websocket===!1){yD("disabled from server","websocket");return}if(n.length&&n.indexOf(h.transportName)===-1){yD("not in whitelist",h.transportName);return}h.enabled(i)?(yD("enabled",h.transportName),l.main.push(h),h.facadeTransport&&l.facade.push(h.facadeTransport)):yD("disabled",h.transportName)}}),l}}}});var B8=Gn((fRe,z8)=>{"use strict";var mk={};["log","debug","warn"].forEach(function(t){var n;try{n=global.console&&global.console[t]&&global.console[t].apply}catch{}mk[t]=n?function(){return global.console[t].apply(global.console,arguments)}:t==="log"?function(){}:mk.log});z8.exports=mk});var xD=Gn((pRe,j8)=>{"use strict";function Ig(t){this.type=t}Ig.prototype.initEvent=function(t,n,i){return this.type=t,this.bubbles=n,this.cancelable=i,this.timeStamp=+new Date,this};Ig.prototype.stopPropagation=function(){};Ig.prototype.preventDefault=function(){};Ig.CAPTURING_PHASE=1;Ig.AT_TARGET=2;Ig.BUBBLING_PHASE=3;j8.exports=Ig});var gk=Gn((mRe,V8)=>{"use strict";V8.exports=global.location||{origin:"http://localhost:80",protocol:"http:",host:"localhost",port:80,href:"http://localhost/",hash:""}});var G8=Gn((gRe,$8)=>{"use strict";var gce=Br(),U8=xD();function H8(){U8.call(this),this.initEvent("close",!1,!1),this.wasClean=!1,this.code=0,this.reason=""}gce(H8,U8);$8.exports=H8});var X8=Gn((_Re,Z8)=>{"use strict";var _ce=Br(),q8=xD();function W8(t){q8.call(this),this.initEvent("message",!1,!1),this.data=t}_ce(W8,q8);Z8.exports=W8});var J8=Gn((vRe,K8)=>{"use strict";var Y8=Ha().EventEmitter,vce=Br();function I1(){var t=this;Y8.call(this),this.to=setTimeout(function(){t.emit("finish",200,"{}")},I1.timeout)}vce(I1,Y8);I1.prototype.close=function(){clearTimeout(this.to)};I1.timeout=2e3;K8.exports=I1});var vk=Gn((yRe,e$)=>{"use strict";var Q8=Ha().EventEmitter,yce=Br(),xce=mD(),bce=function(){};function _k(t,n){Q8.call(this);var i=this,l=+new Date;this.xo=new n("GET",t),this.xo.once("finish",function(h,o){var E,A;if(h===200){if(A=+new Date-l,o)try{E=JSON.parse(o)}catch{bce("bad json",o)}xce.isObject(E)||(E={})}i.emit("finish",E,A),i.removeAllListeners()})}yce(_k,Q8);_k.prototype.close=function(){this.removeAllListeners(),this.xo.close()};e$.exports=_k});var yk=Gn((xRe,n$)=>{"use strict";var wce=Br(),t$=Ha().EventEmitter,Cce=gv(),Ece=vk();function bD(t){var n=this;t$.call(this),this.ir=new Ece(t,Cce),this.ir.once("finish",function(i,l){n.ir=null,n.emit("message",JSON.stringify([i,l]))})}wce(bD,t$);bD.transportName="iframe-info-receiver";bD.prototype.close=function(){this.ir&&(this.ir.close(),this.ir=null),this.removeAllListeners()};n$.exports=bD});var s$=Gn((bRe,o$)=>{"use strict";var i$=Ha().EventEmitter,Tce=Br(),Sce=Jh(),r$=rk(),Dce=yk(),Ice=function(){};function wD(t,n){var i=this;i$.call(this);var l=function(){var h=i.ifr=new r$(Dce.transportName,n,t);h.once("message",function(o){if(o){var E;try{E=JSON.parse(o)}catch{Ice("bad json",o),i.emit("finish"),i.close();return}var A=E[0],L=E[1];i.emit("finish",A,L)}i.close()}),h.once("close",function(){i.emit("finish"),i.close()})};global.document.body?l():Sce.attachEvent("load",l)}Tce(wD,i$);wD.enabled=function(){return r$.enabled()};wD.prototype.close=function(){this.ifr&&this.ifr.close(),this.removeAllListeners(),this.ifr=null};o$.exports=wD});var h$=Gn((wRe,d$)=>{"use strict";var u$=Ha().EventEmitter,Mce=Br(),Ace=uc(),a$=fD(),l$=_1(),Pce=gv(),Oce=J8(),c$=s$(),CD=vk(),wv=function(){};function sf(t,n){wv(t);var i=this;u$.call(this),setTimeout(function(){i.doXhr(t,n)},0)}Mce(sf,u$);sf._getReceiver=function(t,n,i){return i.sameOrigin?new CD(n,Pce):l$.enabled?new CD(n,l$):a$.enabled&&i.sameScheme?new CD(n,a$):c$.enabled()?new c$(t,n):new CD(n,Oce)};sf.prototype.doXhr=function(t,n){var i=this,l=Ace.addPath(t,"/info");wv("doXhr",l),this.xo=sf._getReceiver(t,l,n),this.timeoutRef=setTimeout(function(){wv("timeout"),i._cleanup(!1),i.emit("finish")},sf.timeout),this.xo.once("finish",function(h,o){wv("finish",h,o),i._cleanup(!0),i.emit("finish",h,o)})};sf.prototype._cleanup=function(t){wv("_cleanup"),clearTimeout(this.timeoutRef),this.timeoutRef=null,!t&&this.xo&&this.xo.close(),this.xo=null};sf.prototype.close=function(){wv("close"),this.removeAllListeners(),this._cleanup(!1)};sf.timeout=8e3;d$.exports=sf});var m$=Gn((CRe,p$)=>{"use strict";var f$=bv();function M1(t){this._transport=t,t.on("message",this._transportMessage.bind(this)),t.on("close",this._transportClose.bind(this))}M1.prototype._transportClose=function(t,n){f$.postMessage("c",JSON.stringify([t,n]))};M1.prototype._transportMessage=function(t){f$.postMessage("t",t)};M1.prototype._send=function(t){this._transport.send(t)};M1.prototype._close=function(){this._transport.close(),this._transport.removeAllListeners()};p$.exports=M1});var y$=Gn((ERe,v$)=>{"use strict";var g$=uc(),Rce=Jh(),kce=m$(),_$=yk(),xk=bv(),ED=gk(),bk=function(){};v$.exports=function(t,n){var i={};n.forEach(function(h){h.facadeTransport&&(i[h.facadeTransport.transportName]=h.facadeTransport)}),i[_$.transportName]=_$;var l;t.bootstrap_iframe=function(){var h;xk.currentWindowId=ED.hash.slice(1);var o=function(E){if(E.source===parent&&(typeof l>"u"&&(l=E.origin),E.origin===l)){var A;try{A=JSON.parse(E.data)}catch{bk("bad json",E.data);return}if(A.windowId===xk.currentWindowId)switch(A.type){case"s":var L;try{L=JSON.parse(A.data)}catch{bk("bad json",A.data);break}var Y=L[0],le=L[1],te=L[2],ze=L[3];if(bk(Y,le,te,ze),Y!==t.version)throw new Error('Incompatible SockJS! Main site uses: "'+Y+'", the iframe: "'+t.version+'".');if(!g$.isOriginEqual(te,ED.href)||!g$.isOriginEqual(ze,ED.href))throw new Error("Can't connect to different domain from within an iframe. ("+ED.href+", "+te+", "+ze+")");h=new kce(new i[le](te,ze));break;case"m":h._send(A.data);break;case"c":h&&h._close(),h=null;break}}};Rce.attachEvent("message",o),xk.postMessage("s")}}});var S$=Gn((TRe,T$)=>{"use strict";R8();var Fce=BR(),Lce=Br(),x$=bg(),Nce=F8(),A1=uc(),zce=Jh(),Bce=N8(),jce=mD(),Vce=_v(),Uce=B8(),wk=xD(),w$=VR(),TD=gk(),Hce=G8(),b$=X8(),$ce=h$(),Rs=function(){},C$;function jr(t,n,i){if(!(this instanceof jr))return new jr(t,n,i);if(arguments.length<1)throw new TypeError("Failed to construct 'SockJS: 1 argument required, but only 0 present");w$.call(this),this.readyState=jr.CONNECTING,this.extensions="",this.protocol="",i=i||{},i.protocols_whitelist&&Uce.warn("'protocols_whitelist' is DEPRECATED. Use 'transports' instead."),this._transportsWhitelist=i.transports,this._transportOptions=i.transportOptions||{},this._timeout=i.timeout||0;var l=i.sessionId||8;if(typeof l=="function")this._generateSessionId=l;else if(typeof l=="number")this._generateSessionId=function(){return x$.string(l)};else throw new TypeError("If sessionId is used in the options, it needs to be a number or a function.");this._server=i.server||x$.numberString(1e3);var h=new Fce(t);if(!h.host||!h.protocol)throw new SyntaxError("The URL '"+t+"' is invalid");if(h.hash)throw new SyntaxError("The URL must not contain a fragment");if(h.protocol!=="http:"&&h.protocol!=="https:")throw new SyntaxError("The URL's scheme must be either 'http:' or 'https:'. '"+h.protocol+"' is not allowed.");var o=h.protocol==="https:";if(TD.protocol==="https:"&&!o&&!A1.isLoopbackAddr(h.hostname))throw new Error("SecurityError: An insecure SockJS connection may not be initiated from a page loaded over HTTPS");n?Array.isArray(n)||(n=[n]):n=[];var E=n.sort();E.forEach(function(L,Y){if(!L)throw new SyntaxError("The protocols entry '"+L+"' is invalid.");if(Y<E.length-1&&L===E[Y+1])throw new SyntaxError("The protocols entry '"+L+"' is duplicated.")});var A=A1.getOrigin(TD.href);this._origin=A?A.toLowerCase():null,h.set("pathname",h.pathname.replace(/\/+$/,"")),this.url=h.href,Rs("using url",this.url),this._urlInfo={nullOrigin:!Vce.hasDomain(),sameOrigin:A1.isOriginEqual(this.url,TD.href),sameScheme:A1.isSchemeEqual(this.url,TD.href)},this._ir=new $ce(this.url,this._urlInfo),this._ir.once("finish",this._receiveInfo.bind(this))}Lce(jr,w$);function E$(t){return t===1e3||t>=3e3&&t<=4999}jr.prototype.close=function(t,n){if(t&&!E$(t))throw new Error("InvalidAccessError: Invalid code");if(n&&n.length>123)throw new SyntaxError("reason argument has an invalid length");if(!(this.readyState===jr.CLOSING||this.readyState===jr.CLOSED)){var i=!0;this._close(t||1e3,n||"Normal closure",i)}};jr.prototype.send=function(t){if(typeof t!="string"&&(t=""+t),this.readyState===jr.CONNECTING)throw new Error("InvalidStateError: The connection has not been established yet");this.readyState===jr.OPEN&&this._transport.send(Nce.quote(t))};jr.version=nk();jr.CONNECTING=0;jr.OPEN=1;jr.CLOSING=2;jr.CLOSED=3;jr.prototype._receiveInfo=function(t,n){if(Rs("_receiveInfo",n),this._ir=null,!t){this._close(1002,"Cannot connect to server");return}this._rto=this.countRTO(n),this._transUrl=t.base_url?t.base_url:this.url,t=jce.extend(t,this._urlInfo),Rs("info",t);var i=C$.filterToEnabled(this._transportsWhitelist,t);this._transports=i.main,Rs(this._transports.length+" enabled transports"),this._connect()};jr.prototype._connect=function(){for(var t=this._transports.shift();t;t=this._transports.shift()){if(Rs("attempt",t.transportName),t.needBody&&(!global.document.body||typeof global.document.readyState<"u"&&global.document.readyState!=="complete"&&global.document.readyState!=="interactive")){Rs("waiting for body"),this._transports.unshift(t),zce.attachEvent("load",this._connect.bind(this));return}var n=Math.max(this._timeout,this._rto*t.roundTrips||5e3);this._transportTimeoutId=setTimeout(this._transportTimeout.bind(this),n),Rs("using timeout",n);var i=A1.addPath(this._transUrl,"/"+this._server+"/"+this._generateSessionId()),l=this._transportOptions[t.transportName];Rs("transport url",i);var h=new t(i,this._transUrl,l);h.on("message",this._transportMessage.bind(this)),h.once("close",this._transportClose.bind(this)),h.transportName=t.transportName,this._transport=h;return}this._close(2e3,"All transports failed",!1)};jr.prototype._transportTimeout=function(){Rs("_transportTimeout"),this.readyState===jr.CONNECTING&&(this._transport&&this._transport.close(),this._transportClose(2007,"Transport timed out"))};jr.prototype._transportMessage=function(t){Rs("_transportMessage",t);var n=this,i=t.slice(0,1),l=t.slice(1),h;switch(i){case"o":this._open();return;case"h":this.dispatchEvent(new wk("heartbeat")),Rs("heartbeat",this.transport);return}if(l)try{h=JSON.parse(l)}catch{Rs("bad json",l)}if(typeof h>"u"){Rs("empty payload",l);return}switch(i){case"a":Array.isArray(h)&&h.forEach(function(o){Rs("message",n.transport,o),n.dispatchEvent(new b$(o))});break;case"m":Rs("message",this.transport,h),this.dispatchEvent(new b$(h));break;case"c":Array.isArray(h)&&h.length===2&&this._close(h[0],h[1],!0);break}};jr.prototype._transportClose=function(t,n){if(Rs("_transportClose",this.transport,t,n),this._transport&&(this._transport.removeAllListeners(),this._transport=null,this.transport=null),!E$(t)&&t!==2e3&&this.readyState===jr.CONNECTING){this._connect();return}this._close(t,n)};jr.prototype._open=function(){Rs("_open",this._transport&&this._transport.transportName,this.readyState),this.readyState===jr.CONNECTING?(this._transportTimeoutId&&(clearTimeout(this._transportTimeoutId),this._transportTimeoutId=null),this.readyState=jr.OPEN,this.transport=this._transport.transportName,this.dispatchEvent(new wk("open")),Rs("connected",this.transport)):this._close(1006,"Server lost session")};jr.prototype._close=function(t,n,i){Rs("_close",this.transport,t,n,i,this.readyState);var l=!1;if(this._ir&&(l=!0,this._ir.close(),this._ir=null),this._transport&&(this._transport.close(),this._transport=null,this.transport=null),this.readyState===jr.CLOSED)throw new Error("InvalidStateError: SockJS has already been closed");this.readyState=jr.CLOSING,setTimeout((function(){this.readyState=jr.CLOSED,l&&this.dispatchEvent(new wk("error"));var h=new Hce("close");h.wasClean=i||!1,h.code=t||1e3,h.reason=n,this.dispatchEvent(h),this.onmessage=this.onclose=this.onerror=null,Rs("disconnected")}).bind(this),0)};jr.prototype.countRTO=function(t){return t>100?4*t:300+t};T$.exports=function(t){return C$=Bce(t),y$()(jr,t),jr}});var I$=Gn((SRe,D$)=>{"use strict";var Gce=S8();D$.exports=S$()(Gce);"_sockjs_onload"in global&&setTimeout(global._sockjs_onload,1)});var b2;function hC(){return b2}function gd(t){let n=b2;return b2=t,n}var S3=Symbol("NotFound");function Z_(t){return t===S3||t?.name==="\u0275NotFound"}var za=null,fC=!1,w2=1,IW=null,Ba=Symbol("SIGNAL");function zi(t){let n=za;return za=t,n}function _C(){return za}var X_={version:0,lastCleanEpoch:0,dirty:!1,producers:void 0,producersTail:void 0,consumers:void 0,consumersTail:void 0,recomputing:!1,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,kind:"unknown",producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function Y_(t){if(fC)throw new Error("");if(za===null)return;za.consumerOnSignalRead(t);let n=za.producersTail;if(n!==void 0&&n.producer===t)return;let i,l=za.recomputing;if(l&&(i=n!==void 0?n.nextProducer:za.producers,i!==void 0&&i.producer===t)){za.producersTail=i,i.lastReadVersion=t.version;return}let h=t.consumersTail;if(h!==void 0&&h.consumer===za&&(!l||AW(h,za)))return;let o=J_(za),E={producer:t,consumer:za,nextProducer:i,prevConsumer:h,lastReadVersion:t.version,nextConsumer:void 0};za.producersTail=E,n!==void 0?n.nextProducer=E:za.producers=E,o&&A3(t,E)}function D3(){w2++}function vC(t){if(!(J_(t)&&!t.dirty)&&!(!t.dirty&&t.lastCleanEpoch===w2)){if(!t.producerMustRecompute(t)&&!vx(t)){gC(t);return}t.producerRecomputeValue(t),gC(t)}}function C2(t){if(t.consumers===void 0)return;let n=fC;fC=!0;try{for(let i=t.consumers;i!==void 0;i=i.nextConsumer){let l=i.consumer;l.dirty||MW(l)}}finally{fC=n}}function E2(){return za?.consumerAllowSignalWrites!==!1}function MW(t){t.dirty=!0,C2(t),t.consumerMarkedDirty?.(t)}function gC(t){t.dirty=!1,t.lastCleanEpoch=w2}function K_(t){return t&&I3(t),zi(t)}function I3(t){t.producersTail=void 0,t.recomputing=!0}function _x(t,n){zi(n),t&&M3(t)}function M3(t){t.recomputing=!1;let n=t.producersTail,i=n!==void 0?n.nextProducer:t.producers;if(i!==void 0){if(J_(t))do i=T2(i);while(i!==void 0);n!==void 0?n.nextProducer=void 0:t.producers=void 0}}function vx(t){for(let n=t.producers;n!==void 0;n=n.nextProducer){let i=n.producer,l=n.lastReadVersion;if(l!==i.version||(vC(i),l!==i.version))return!0}return!1}function yx(t){if(J_(t)){let n=t.producers;for(;n!==void 0;)n=T2(n)}t.producers=void 0,t.producersTail=void 0,t.consumers=void 0,t.consumersTail=void 0}function A3(t,n){let i=t.consumersTail,l=J_(t);if(i!==void 0?(n.nextConsumer=i.nextConsumer,i.nextConsumer=n):(n.nextConsumer=void 0,t.consumers=n),n.prevConsumer=i,t.consumersTail=n,!l)for(let h=t.producers;h!==void 0;h=h.nextProducer)A3(h.producer,h)}function T2(t){let n=t.producer,i=t.nextProducer,l=t.nextConsumer,h=t.prevConsumer;if(t.nextConsumer=void 0,t.prevConsumer=void 0,l!==void 0?l.prevConsumer=h:n.consumersTail=h,h!==void 0)h.nextConsumer=l;else if(n.consumers=l,!J_(n)){let o=n.producers;for(;o!==void 0;)o=T2(o)}return i}function J_(t){return t.consumerIsAlwaysLive||t.consumers!==void 0}function yC(t){IW?.(t)}function AW(t,n){let i=n.producersTail;if(i!==void 0){let l=n.producers;do{if(l===t)return!0;if(l===i)break;l=l.nextProducer}while(l!==void 0)}return!1}function xC(t,n){return Object.is(t,n)}function bC(t,n){let i=Object.create(PW);i.computation=t,n!==void 0&&(i.equal=n);let l=()=>{if(vC(i),Y_(i),i.value===gx)throw i.error;return i.value};return l[Ba]=i,yC(i),l}var pC=Symbol("UNSET"),mC=Symbol("COMPUTING"),gx=Symbol("ERRORED"),PW=Mi(Jt({},X_),{value:pC,dirty:!0,error:null,equal:xC,kind:"computed",producerMustRecompute(t){return t.value===pC||t.value===mC},producerRecomputeValue(t){if(t.value===mC)throw new Error("");let n=t.value;t.value=mC;let i=K_(t),l,h=!1;try{l=t.computation(),zi(null),h=n!==pC&&n!==gx&&l!==gx&&t.equal(n,l)}catch(o){l=gx,t.error=o}finally{_x(t,i)}if(h){t.value=n;return}t.value=l,t.version++}});function OW(){throw new Error}var P3=OW;function O3(t){P3(t)}function S2(t){P3=t}var RW=null;function D2(t,n){let i=Object.create(wC);i.value=t,n!==void 0&&(i.equal=n);let l=()=>R3(i);return l[Ba]=i,yC(i),[l,E=>Q_(i,E),E=>I2(i,E)]}function R3(t){return Y_(t),t.value}function Q_(t,n){E2()||O3(t),t.equal(t.value,n)||(t.value=n,kW(t))}function I2(t,n){E2()||O3(t),Q_(t,n(t.value))}var wC=Mi(Jt({},X_),{equal:xC,value:void 0,kind:"signal"});function kW(t){t.version++,D3(),C2(t),RW?.(t)}function _i(t){return typeof t=="function"}function e0(t){let i=t(l=>{Error.call(l),l.stack=new Error().stack});return i.prototype=Object.create(Error.prototype),i.prototype.constructor=i,i}var CC=e0(t=>function(i){t(this),this.message=i?`${i.length} errors occurred during unsubscription:
${i.map((l,h)=>`${h+1}) ${l.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=i});function Mm(t,n){if(t){let i=t.indexOf(n);0<=i&&t.splice(i,1)}}var Jo=class t{constructor(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let n;if(!this.closed){this.closed=!0;let{_parentage:i}=this;if(i)if(this._parentage=null,Array.isArray(i))for(let o of i)o.remove(this);else i.remove(this);let{initialTeardown:l}=this;if(_i(l))try{l()}catch(o){n=o instanceof CC?o.errors:[o]}let{_finalizers:h}=this;if(h){this._finalizers=null;for(let o of h)try{k3(o)}catch(E){n=n??[],E instanceof CC?n=[...n,...E.errors]:n.push(E)}}if(n)throw new CC(n)}}add(n){var i;if(n&&n!==this)if(this.closed)k3(n);else{if(n instanceof t){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=(i=this._finalizers)!==null&&i!==void 0?i:[]).push(n)}}_hasParent(n){let{_parentage:i}=this;return i===n||Array.isArray(i)&&i.includes(n)}_addParent(n){let{_parentage:i}=this;this._parentage=Array.isArray(i)?(i.push(n),i):i?[i,n]:n}_removeParent(n){let{_parentage:i}=this;i===n?this._parentage=null:Array.isArray(i)&&Mm(i,n)}remove(n){let{_finalizers:i}=this;i&&Mm(i,n),n instanceof t&&n._removeParent(this)}};Jo.EMPTY=(()=>{let t=new Jo;return t.closed=!0,t})();var M2=Jo.EMPTY;function EC(t){return t instanceof Jo||t&&"closed"in t&&_i(t.remove)&&_i(t.add)&&_i(t.unsubscribe)}function k3(t){_i(t)?t():t.unsubscribe()}var fu={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var t0={setTimeout(t,n,...i){let{delegate:l}=t0;return l?.setTimeout?l.setTimeout(t,n,...i):setTimeout(t,n,...i)},clearTimeout(t){let{delegate:n}=t0;return(n?.clearTimeout||clearTimeout)(t)},delegate:void 0};function TC(t){t0.setTimeout(()=>{let{onUnhandledError:n}=fu;if(n)n(t);else throw t})}function xx(){}var F3=A2("C",void 0,void 0);function L3(t){return A2("E",void 0,t)}function N3(t){return A2("N",t,void 0)}function A2(t,n,i){return{kind:t,value:n,error:i}}var Am=null;function n0(t){if(fu.useDeprecatedSynchronousErrorHandling){let n=!Am;if(n&&(Am={errorThrown:!1,error:null}),t(),n){let{errorThrown:i,error:l}=Am;if(Am=null,i)throw l}}else t()}function z3(t){fu.useDeprecatedSynchronousErrorHandling&&Am&&(Am.errorThrown=!0,Am.error=t)}var Pm=class extends Jo{constructor(n){super(),this.isStopped=!1,n?(this.destination=n,EC(n)&&n.add(this)):this.destination=NW}static create(n,i,l){return new Ih(n,i,l)}next(n){this.isStopped?O2(N3(n),this):this._next(n)}error(n){this.isStopped?O2(L3(n),this):(this.isStopped=!0,this._error(n))}complete(){this.isStopped?O2(F3,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(n){this.destination.next(n)}_error(n){try{this.destination.error(n)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},FW=Function.prototype.bind;function P2(t,n){return FW.call(t,n)}var R2=class{constructor(n){this.partialObserver=n}next(n){let{partialObserver:i}=this;if(i.next)try{i.next(n)}catch(l){SC(l)}}error(n){let{partialObserver:i}=this;if(i.error)try{i.error(n)}catch(l){SC(l)}else SC(n)}complete(){let{partialObserver:n}=this;if(n.complete)try{n.complete()}catch(i){SC(i)}}},Ih=class extends Pm{constructor(n,i,l){super();let h;if(_i(n)||!n)h={next:n??void 0,error:i??void 0,complete:l??void 0};else{let o;this&&fu.useDeprecatedNextContext?(o=Object.create(n),o.unsubscribe=()=>this.unsubscribe(),h={next:n.next&&P2(n.next,o),error:n.error&&P2(n.error,o),complete:n.complete&&P2(n.complete,o)}):h=n}this.destination=new R2(h)}};function SC(t){fu.useDeprecatedSynchronousErrorHandling?z3(t):TC(t)}function LW(t){throw t}function O2(t,n){let{onStoppedNotification:i}=fu;i&&t0.setTimeout(()=>i(t,n))}var NW={closed:!0,next:xx,error:LW,complete:xx};var i0=typeof Symbol=="function"&&Symbol.observable||"@@observable";function ul(t){return t}function k2(...t){return F2(t)}function F2(t){return t.length===0?ul:t.length===1?t[0]:function(i){return t.reduce((l,h)=>h(l),i)}}var xi=(()=>{class t{constructor(i){i&&(this._subscribe=i)}lift(i){let l=new t;return l.source=this,l.operator=i,l}subscribe(i,l,h){let o=BW(i)?i:new Ih(i,l,h);return n0(()=>{let{operator:E,source:A}=this;o.add(E?E.call(o,A):A?this._subscribe(o):this._trySubscribe(o))}),o}_trySubscribe(i){try{return this._subscribe(i)}catch(l){i.error(l)}}forEach(i,l){return l=B3(l),new l((h,o)=>{let E=new Ih({next:A=>{try{i(A)}catch(L){o(L),E.unsubscribe()}},error:o,complete:h});this.subscribe(E)})}_subscribe(i){var l;return(l=this.source)===null||l===void 0?void 0:l.subscribe(i)}[i0](){return this}pipe(...i){return F2(i)(this)}toPromise(i){return i=B3(i),new i((l,h)=>{let o;this.subscribe(E=>o=E,E=>h(E),()=>l(o))})}}return t.create=n=>new t(n),t})();function B3(t){var n;return(n=t??fu.Promise)!==null&&n!==void 0?n:Promise}function zW(t){return t&&_i(t.next)&&_i(t.error)&&_i(t.complete)}function BW(t){return t&&t instanceof Pm||zW(t)&&EC(t)}function L2(t){return _i(t?.lift)}function Yi(t){return n=>{if(L2(n))return n.lift(function(i){try{return t(i,this)}catch(l){this.error(l)}});throw new TypeError("Unable to lift unknown Observable type")}}function sr(t,n,i,l,h){return new N2(t,n,i,l,h)}var N2=class extends Pm{constructor(n,i,l,h,o,E){super(n),this.onFinalize=o,this.shouldUnsubscribe=E,this._next=i?function(A){try{i(A)}catch(L){n.error(L)}}:super._next,this._error=h?function(A){try{h(A)}catch(L){n.error(L)}finally{this.unsubscribe()}}:super._error,this._complete=l?function(){try{l()}catch(A){n.error(A)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:i}=this;super.unsubscribe(),!i&&((n=this.onFinalize)===null||n===void 0||n.call(this))}}};function r0(){return Yi((t,n)=>{let i=null;t._refCount++;let l=sr(n,void 0,void 0,void 0,()=>{if(!t||t._refCount<=0||0<--t._refCount){i=null;return}let h=t._connection,o=i;i=null,h&&(!o||h===o)&&h.unsubscribe(),n.unsubscribe()});t.subscribe(l),l.closed||(i=t.connect())})}var o0=class extends xi{constructor(n,i){super(),this.source=n,this.subjectFactory=i,this._subject=null,this._refCount=0,this._connection=null,L2(n)&&(this.lift=n.lift)}_subscribe(n){return this.getSubject().subscribe(n)}getSubject(){let n=this._subject;return(!n||n.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:n}=this;this._subject=this._connection=null,n?.unsubscribe()}connect(){let n=this._connection;if(!n){n=this._connection=new Jo;let i=this.getSubject();n.add(this.source.subscribe(sr(i,void 0,()=>{this._teardown(),i.complete()},l=>{this._teardown(),i.error(l)},()=>this._teardown()))),n.closed&&(this._connection=null,n=Jo.EMPTY)}return n}refCount(){return r0()(this)}};var j3=e0(t=>function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var Fn=(()=>{class t extends xi{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(i){let l=new DC(this,this);return l.operator=i,l}_throwIfClosed(){if(this.closed)throw new j3}next(i){n0(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let l of this.currentObservers)l.next(i)}})}error(i){n0(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=i;let{observers:l}=this;for(;l.length;)l.shift().error(i)}})}complete(){n0(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:i}=this;for(;i.length;)i.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var i;return((i=this.observers)===null||i===void 0?void 0:i.length)>0}_trySubscribe(i){return this._throwIfClosed(),super._trySubscribe(i)}_subscribe(i){return this._throwIfClosed(),this._checkFinalizedStatuses(i),this._innerSubscribe(i)}_innerSubscribe(i){let{hasError:l,isStopped:h,observers:o}=this;return l||h?M2:(this.currentObservers=null,o.push(i),new Jo(()=>{this.currentObservers=null,Mm(o,i)}))}_checkFinalizedStatuses(i){let{hasError:l,thrownError:h,isStopped:o}=this;l?i.error(h):o&&i.complete()}asObservable(){let i=new xi;return i.source=this,i}}return t.create=(n,i)=>new DC(n,i),t})(),DC=class extends Fn{constructor(n,i){super(),this.destination=n,this.source=i}next(n){var i,l;(l=(i=this.destination)===null||i===void 0?void 0:i.next)===null||l===void 0||l.call(i,n)}error(n){var i,l;(l=(i=this.destination)===null||i===void 0?void 0:i.error)===null||l===void 0||l.call(i,n)}complete(){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||i===void 0||i.call(n)}_subscribe(n){var i,l;return(l=(i=this.source)===null||i===void 0?void 0:i.subscribe(n))!==null&&l!==void 0?l:M2}};var Ho=class extends Fn{constructor(n){super(),this._value=n}get value(){return this.getValue()}_subscribe(n){let i=super._subscribe(n);return!i.closed&&n.next(this._value),i}getValue(){let{hasError:n,thrownError:i,_value:l}=this;if(n)throw i;return this._throwIfClosed(),l}next(n){super.next(this._value=n)}};var bx={now(){return(bx.delegate||Date).now()},delegate:void 0};var tp=class extends Fn{constructor(n=1/0,i=1/0,l=bx){super(),this._bufferSize=n,this._windowTime=i,this._timestampProvider=l,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=i===1/0,this._bufferSize=Math.max(1,n),this._windowTime=Math.max(1,i)}next(n){let{isStopped:i,_buffer:l,_infiniteTimeWindow:h,_timestampProvider:o,_windowTime:E}=this;i||(l.push(n),!h&&l.push(o.now()+E)),this._trimBuffer(),super.next(n)}_subscribe(n){this._throwIfClosed(),this._trimBuffer();let i=this._innerSubscribe(n),{_infiniteTimeWindow:l,_buffer:h}=this,o=h.slice();for(let E=0;E<o.length&&!n.closed;E+=l?1:2)n.next(o[E]);return this._checkFinalizedStatuses(n),i}_trimBuffer(){let{_bufferSize:n,_timestampProvider:i,_buffer:l,_infiniteTimeWindow:h}=this,o=(h?1:2)*n;if(n<1/0&&o<l.length&&l.splice(0,l.length-o),!h){let E=i.now(),A=0;for(let L=1;L<l.length&&l[L]<=E;L+=2)A=L;A&&l.splice(0,A+1)}}};var IC=class extends Jo{constructor(n,i){super()}schedule(n,i=0){return this}};var wx={setInterval(t,n,...i){let{delegate:l}=wx;return l?.setInterval?l.setInterval(t,n,...i):setInterval(t,n,...i)},clearInterval(t){let{delegate:n}=wx;return(n?.clearInterval||clearInterval)(t)},delegate:void 0};var MC=class extends IC{constructor(n,i){super(n,i),this.scheduler=n,this.work=i,this.pending=!1}schedule(n,i=0){var l;if(this.closed)return this;this.state=n;let h=this.id,o=this.scheduler;return h!=null&&(this.id=this.recycleAsyncId(o,h,i)),this.pending=!0,this.delay=i,this.id=(l=this.id)!==null&&l!==void 0?l:this.requestAsyncId(o,this.id,i),this}requestAsyncId(n,i,l=0){return wx.setInterval(n.flush.bind(n,this),l)}recycleAsyncId(n,i,l=0){if(l!=null&&this.delay===l&&this.pending===!1)return i;i!=null&&wx.clearInterval(i)}execute(n,i){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;let l=this._execute(n,i);if(l)return l;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(n,i){let l=!1,h;try{this.work(n)}catch(o){l=!0,h=o||new Error("Scheduled action threw falsy error")}if(l)return this.unsubscribe(),h}unsubscribe(){if(!this.closed){let{id:n,scheduler:i}=this,{actions:l}=i;this.work=this.state=this.scheduler=null,this.pending=!1,Mm(l,this),n!=null&&(this.id=this.recycleAsyncId(i,n,null)),this.delay=null,super.unsubscribe()}}};var s0=class t{constructor(n,i=t.now){this.schedulerActionCtor=n,this.now=i}schedule(n,i=0,l){return new this.schedulerActionCtor(this,n).schedule(l,i)}};s0.now=bx.now;var AC=class extends s0{constructor(n,i=s0.now){super(n,i),this.actions=[],this._active=!1}flush(n){let{actions:i}=this;if(this._active){i.push(n);return}let l;this._active=!0;do if(l=n.execute(n.state,n.delay))break;while(n=i.shift());if(this._active=!1,l){for(;n=i.shift();)n.unsubscribe();throw l}}};var jW=new AC(MC),V3=jW;var ja=new xi(t=>t.complete());function PC(t){return t&&_i(t.schedule)}function z2(t){return t[t.length-1]}function OC(t){return _i(z2(t))?t.pop():void 0}function _d(t){return PC(z2(t))?t.pop():void 0}function U3(t,n){return typeof z2(t)=="number"?t.pop():n}function $3(t,n,i,l){function h(o){return o instanceof i?o:new i(function(E){E(o)})}return new(i||(i=Promise))(function(o,E){function A(le){try{Y(l.next(le))}catch(te){E(te)}}function L(le){try{Y(l.throw(le))}catch(te){E(te)}}function Y(le){le.done?o(le.value):h(le.value).then(A,L)}Y((l=l.apply(t,n||[])).next())})}function H3(t){var n=typeof Symbol=="function"&&Symbol.iterator,i=n&&t[n],l=0;if(i)return i.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&l>=t.length&&(t=void 0),{value:t&&t[l++],done:!t}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}function Om(t){return this instanceof Om?(this.v=t,this):new Om(t)}function G3(t,n,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var l=i.apply(t,n||[]),h,o=[];return h=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),A("next"),A("throw"),A("return",E),h[Symbol.asyncIterator]=function(){return this},h;function E(Ae){return function(Be){return Promise.resolve(Be).then(Ae,te)}}function A(Ae,Be){l[Ae]&&(h[Ae]=function(Tt){return new Promise(function(ot,kt){o.push([Ae,Tt,ot,kt])>1||L(Ae,Tt)})},Be&&(h[Ae]=Be(h[Ae])))}function L(Ae,Be){try{Y(l[Ae](Be))}catch(Tt){ze(o[0][3],Tt)}}function Y(Ae){Ae.value instanceof Om?Promise.resolve(Ae.value.v).then(le,te):ze(o[0][2],Ae)}function le(Ae){L("next",Ae)}function te(Ae){L("throw",Ae)}function ze(Ae,Be){Ae(Be),o.shift(),o.length&&L(o[0][0],o[0][1])}}function q3(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t[Symbol.asyncIterator],i;return n?n.call(t):(t=typeof H3=="function"?H3(t):t[Symbol.iterator](),i={},l("next"),l("throw"),l("return"),i[Symbol.asyncIterator]=function(){return this},i);function l(o){i[o]=t[o]&&function(E){return new Promise(function(A,L){E=t[o](E),h(A,L,E.done,E.value)})}}function h(o,E,A,L){Promise.resolve(L).then(function(Y){o({value:Y,done:A})},E)}}var a0=t=>t&&typeof t.length=="number"&&typeof t!="function";function RC(t){return _i(t?.then)}function kC(t){return _i(t[i0])}function FC(t){return Symbol.asyncIterator&&_i(t?.[Symbol.asyncIterator])}function LC(t){return new TypeError(`You provided ${t!==null&&typeof t=="object"?"an invalid object":`'${t}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function VW(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var NC=VW();function zC(t){return _i(t?.[NC])}function BC(t){return G3(this,arguments,function*(){let i=t.getReader();try{for(;;){let{value:l,done:h}=yield Om(i.read());if(h)return yield Om(void 0);yield yield Om(l)}}finally{i.releaseLock()}})}function jC(t){return _i(t?.getReader)}function go(t){if(t instanceof xi)return t;if(t!=null){if(kC(t))return UW(t);if(a0(t))return HW(t);if(RC(t))return $W(t);if(FC(t))return W3(t);if(zC(t))return GW(t);if(jC(t))return qW(t)}throw LC(t)}function UW(t){return new xi(n=>{let i=t[i0]();if(_i(i.subscribe))return i.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function HW(t){return new xi(n=>{for(let i=0;i<t.length&&!n.closed;i++)n.next(t[i]);n.complete()})}function $W(t){return new xi(n=>{t.then(i=>{n.closed||(n.next(i),n.complete())},i=>n.error(i)).then(null,TC)})}function GW(t){return new xi(n=>{for(let i of t)if(n.next(i),n.closed)return;n.complete()})}function W3(t){return new xi(n=>{WW(t,n).catch(i=>n.error(i))})}function qW(t){return W3(BC(t))}function WW(t,n){var i,l,h,o;return $3(this,void 0,void 0,function*(){try{for(i=q3(t);l=yield i.next(),!l.done;){let E=l.value;if(n.next(E),n.closed)return}}catch(E){h={error:E}}finally{try{l&&!l.done&&(o=i.return)&&(yield o.call(i))}finally{if(h)throw h.error}}n.complete()})}function Ml(t,n,i,l=0,h=!1){let o=n.schedule(function(){i(),h?t.add(this.schedule(null,l)):this.unsubscribe()},l);if(t.add(o),!h)return o}function VC(t,n=0){return Yi((i,l)=>{i.subscribe(sr(l,h=>Ml(l,t,()=>l.next(h),n),()=>Ml(l,t,()=>l.complete(),n),h=>Ml(l,t,()=>l.error(h),n)))})}function UC(t,n=0){return Yi((i,l)=>{l.add(t.schedule(()=>i.subscribe(l),n))})}function Z3(t,n){return go(t).pipe(UC(n),VC(n))}function X3(t,n){return go(t).pipe(UC(n),VC(n))}function Y3(t,n){return new xi(i=>{let l=0;return n.schedule(function(){l===t.length?i.complete():(i.next(t[l++]),i.closed||this.schedule())})})}function K3(t,n){return new xi(i=>{let l;return Ml(i,n,()=>{l=t[NC](),Ml(i,n,()=>{let h,o;try{({value:h,done:o}=l.next())}catch(E){i.error(E);return}o?i.complete():i.next(h)},0,!0)}),()=>_i(l?.return)&&l.return()})}function HC(t,n){if(!t)throw new Error("Iterable cannot be null");return new xi(i=>{Ml(i,n,()=>{let l=t[Symbol.asyncIterator]();Ml(i,n,()=>{l.next().then(h=>{h.done?i.complete():i.next(h.value)})},0,!0)})})}function J3(t,n){return HC(BC(t),n)}function Q3(t,n){if(t!=null){if(kC(t))return Z3(t,n);if(a0(t))return Y3(t,n);if(RC(t))return X3(t,n);if(FC(t))return HC(t,n);if(zC(t))return K3(t,n);if(jC(t))return J3(t,n)}throw LC(t)}function Co(t,n){return n?Q3(t,n):go(t)}function Jn(...t){let n=_d(t);return Co(t,n)}function vd(t,n){let i=_i(t)?t:()=>t,l=h=>h.error(i());return new xi(n?h=>n.schedule(l,0,h):l)}function B2(t){return!!t&&(t instanceof xi||_i(t.lift)&&_i(t.subscribe))}var Mh=e0(t=>function(){t(this),this.name="EmptyError",this.message="no elements in sequence"});function ez(t){return t instanceof Date&&!isNaN(t)}function di(t,n){return Yi((i,l)=>{let h=0;i.subscribe(sr(l,o=>{l.next(t.call(n,o,h++))}))})}var{isArray:ZW}=Array;function XW(t,n){return ZW(n)?t(...n):t(n)}function l0(t){return di(n=>XW(t,n))}var{isArray:YW}=Array,{getPrototypeOf:KW,prototype:JW,keys:QW}=Object;function $C(t){if(t.length===1){let n=t[0];if(YW(n))return{args:n,keys:null};if(e9(n)){let i=QW(n);return{args:i.map(l=>n[l]),keys:i}}}return{args:t,keys:null}}function e9(t){return t&&typeof t=="object"&&KW(t)===JW}function GC(t,n){return t.reduce((i,l,h)=>(i[l]=n[h],i),{})}function Rm(...t){let n=_d(t),i=OC(t),{args:l,keys:h}=$C(t);if(l.length===0)return Co([],n);let o=new xi(t9(l,n,h?E=>GC(h,E):ul));return i?o.pipe(l0(i)):o}function t9(t,n,i=ul){return l=>{tz(n,()=>{let{length:h}=t,o=new Array(h),E=h,A=h;for(let L=0;L<h;L++)tz(n,()=>{let Y=Co(t[L],n),le=!1;Y.subscribe(sr(l,te=>{o[L]=te,le||(le=!0,A--),A||l.next(i(o.slice()))},()=>{--E||l.complete()}))},l)},l)}}function tz(t,n,i){t?Ml(i,t,n):n()}function nz(t,n,i,l,h,o,E,A){let L=[],Y=0,le=0,te=!1,ze=()=>{te&&!L.length&&!Y&&n.complete()},Ae=Tt=>Y<l?Be(Tt):L.push(Tt),Be=Tt=>{o&&n.next(Tt),Y++;let ot=!1;go(i(Tt,le++)).subscribe(sr(n,kt=>{h?.(kt),o?Ae(kt):n.next(kt)},()=>{ot=!0},void 0,()=>{if(ot)try{for(Y--;L.length&&Y<l;){let kt=L.shift();E?Ml(n,E,()=>Be(kt)):Be(kt)}ze()}catch(kt){n.error(kt)}}))};return t.subscribe(sr(n,Ae,()=>{te=!0,ze()})),()=>{A?.()}}function Eo(t,n,i=1/0){return _i(n)?Eo((l,h)=>di((o,E)=>n(l,o,h,E))(go(t(l,h))),i):(typeof n=="number"&&(i=n),Yi((l,h)=>nz(l,h,t,i)))}function np(t=1/0){return Eo(ul,t)}function iz(){return np(1)}function c0(...t){return iz()(Co(t,_d(t)))}function Cx(t){return new xi(n=>{go(t()).subscribe(n)})}function yd(...t){let n=OC(t),{args:i,keys:l}=$C(t),h=new xi(o=>{let{length:E}=i;if(!E){o.complete();return}let A=new Array(E),L=E,Y=E;for(let le=0;le<E;le++){let te=!1;go(i[le]).subscribe(sr(o,ze=>{te||(te=!0,Y--),A[le]=ze},()=>L--,void 0,()=>{(!L||!te)&&(Y||o.next(l?GC(l,A):A),o.complete())}))}});return n?h.pipe(l0(n)):h}var n9=["addListener","removeListener"],i9=["addEventListener","removeEventListener"],r9=["on","off"];function u0(t,n,i,l){if(_i(i)&&(l=i,i=void 0),l)return u0(t,n,i).pipe(l0(l));let[h,o]=a9(t)?i9.map(E=>A=>t[E](n,A,i)):o9(t)?n9.map(rz(t,n)):s9(t)?r9.map(rz(t,n)):[];if(!h&&a0(t))return Eo(E=>u0(E,n,i))(go(t));if(!h)throw new TypeError("Invalid event target");return new xi(E=>{let A=(...L)=>E.next(1<L.length?L:L[0]);return h(A),()=>o(A)})}function rz(t,n){return i=>l=>t[i](n,l)}function o9(t){return _i(t.addListener)&&_i(t.removeListener)}function s9(t){return _i(t.on)&&_i(t.off)}function a9(t){return _i(t.addEventListener)&&_i(t.removeEventListener)}function j2(t=0,n,i=V3){let l=-1;return n!=null&&(PC(n)?i=n:l=n),new xi(h=>{let o=ez(t)?+t-i.now():t;o<0&&(o=0);let E=0;return i.schedule(function(){h.closed||(h.next(E++),0<=l?this.schedule(void 0,l):h.complete())},o)})}function Ex(...t){let n=_d(t),i=U3(t,1/0),l=t;return l.length?l.length===1?go(l[0]):np(i)(Co(l,n)):ja}function To(t,n){return Yi((i,l)=>{let h=0;i.subscribe(sr(l,o=>t.call(n,o,h++)&&l.next(o)))})}function dl(t){return Yi((n,i)=>{let l=null,h=!1,o;l=n.subscribe(sr(i,void 0,void 0,E=>{o=go(t(E,dl(t)(n))),l?(l.unsubscribe(),l=null,o.subscribe(i)):h=!0})),h&&(l.unsubscribe(),l=null,o.subscribe(i))})}function qC(t,n,i,l,h){return(o,E)=>{let A=i,L=n,Y=0;o.subscribe(sr(E,le=>{let te=Y++;L=A?t(L,le,te):(A=!0,le),l&&E.next(L)},h&&(()=>{A&&E.next(L),E.complete()})))}}function oz(t,n){return Yi(qC(t,n,arguments.length>=2,!1,!0))}function xd(t,n){return _i(n)?Eo(t,n,1):Eo(t,1)}function V2(t){return oz((n,i,l)=>!t||t(i,l)?n+1:n,0)}function ip(t){return Yi((n,i)=>{let l=!1;n.subscribe(sr(i,h=>{l=!0,i.next(h)},()=>{l||i.next(t),i.complete()}))})}function Al(t){return t<=0?()=>ja:Yi((n,i)=>{let l=0;n.subscribe(sr(i,h=>{++l<=t&&(i.next(h),t<=l&&i.complete())}))})}function U2(t,n=ul){return t=t??l9,Yi((i,l)=>{let h,o=!0;i.subscribe(sr(l,E=>{let A=n(E);(o||!t(h,A))&&(o=!1,h=A,l.next(E))}))})}function l9(t,n){return t===n}function WC(t=c9){return Yi((n,i)=>{let l=!1;n.subscribe(sr(i,h=>{l=!0,i.next(h)},()=>l?i.complete():i.error(t())))})}function c9(){return new Mh}function Si(t){return Yi((n,i)=>{try{n.subscribe(i)}finally{i.add(t)}})}function Ah(t,n){let i=arguments.length>=2;return l=>l.pipe(t?To((h,o)=>t(h,o,l)):ul,Al(1),i?ip(n):WC(()=>new Mh))}function rp(t){return t<=0?()=>ja:Yi((n,i)=>{let l=[];n.subscribe(sr(i,h=>{l.push(h),t<l.length&&l.shift()},()=>{for(let h of l)i.next(h);i.complete()},void 0,()=>{l=null}))})}function H2(t,n){let i=arguments.length>=2;return l=>l.pipe(t?To((h,o)=>t(h,o,l)):ul,rp(1),i?ip(n):WC(()=>new Mh))}function ZC(){return Yi((t,n)=>{let i,l=!1;t.subscribe(sr(n,h=>{let o=i;i=h,l&&n.next([o,h]),l=!0}))})}function $2(t,n){return Yi(qC(t,n,arguments.length>=2,!0))}function km(t={}){let{connector:n=()=>new Fn,resetOnError:i=!0,resetOnComplete:l=!0,resetOnRefCountZero:h=!0}=t;return o=>{let E,A,L,Y=0,le=!1,te=!1,ze=()=>{A?.unsubscribe(),A=void 0},Ae=()=>{ze(),E=L=void 0,le=te=!1},Be=()=>{let Tt=E;Ae(),Tt?.unsubscribe()};return Yi((Tt,ot)=>{Y++,!te&&!le&&ze();let kt=L=L??n();ot.add(()=>{Y--,Y===0&&!te&&!le&&(A=G2(Be,h))}),kt.subscribe(ot),!E&&Y>0&&(E=new Ih({next:Cn=>kt.next(Cn),error:Cn=>{te=!0,ze(),A=G2(Ae,i,Cn),kt.error(Cn)},complete:()=>{le=!0,ze(),A=G2(Ae,l),kt.complete()}}),go(Tt).subscribe(E))})(o)}}function G2(t,n,...i){if(n===!0){t();return}if(n===!1)return;let l=new Ih({next:()=>{l.unsubscribe(),t()}});return go(n(...i)).subscribe(l)}function d0(...t){let n=_d(t);return Yi((i,l)=>{(n?c0(t,i,n):c0(t,i)).subscribe(l)})}function us(t,n){return Yi((i,l)=>{let h=null,o=0,E=!1,A=()=>E&&!h&&l.complete();i.subscribe(sr(l,L=>{h?.unsubscribe();let Y=0,le=o++;go(t(L,le)).subscribe(h=sr(l,te=>l.next(n?n(L,te,le,Y++):te),()=>{h=null,A()}))},()=>{E=!0,A()}))})}function tn(t){return Yi((n,i)=>{go(t).subscribe(sr(i,()=>i.complete(),xx)),!i.closed&&n.subscribe(i)})}function ea(t,n,i){let l=_i(t)||n||i?{next:t,error:n,complete:i}:t;return l?Yi((h,o)=>{var E;(E=l.subscribe)===null||E===void 0||E.call(l);let A=!0;h.subscribe(sr(o,L=>{var Y;(Y=l.next)===null||Y===void 0||Y.call(l,L),o.next(L)},()=>{var L;A=!1,(L=l.complete)===null||L===void 0||L.call(l),o.complete()},L=>{var Y;A=!1,(Y=l.error)===null||Y===void 0||Y.call(l,L),o.error(L)},()=>{var L,Y;A&&((L=l.unsubscribe)===null||L===void 0||L.call(l)),(Y=l.finalize)===null||Y===void 0||Y.call(l)}))}):ul}function sz(t){let n=zi(null);try{return t()}finally{zi(n)}}var JC="https://angular.dev/best-practices/security#preventing-cross-site-scripting-xss",bn=class extends Error{code;constructor(n,i){super(Bm(n,i)),this.code=n}};function u9(t){return`NG0${Math.abs(t)}`}function Bm(t,n){return`${u9(t)}${n?": "+n:""}`}var mu=globalThis;function Qr(t){for(let n in t)if(t[n]===Qr)return n;throw Error("")}function cz(t,n){for(let i in n)n.hasOwnProperty(i)&&!t.hasOwnProperty(i)&&(t[i]=n[i])}function Oh(t){if(typeof t=="string")return t;if(Array.isArray(t))return`[${t.map(Oh).join(", ")}]`;if(t==null)return""+t;let n=t.overriddenName||t.name;if(n)return`${n}`;let i=t.toString();if(i==null)return""+i;let l=i.indexOf(`
`);return l>=0?i.slice(0,l):i}function QC(t,n){return t?n?`${t} ${n}`:t:n||""}var d9=Qr({__forward_ref__:Qr});function Hs(t){return t.__forward_ref__=Hs,t.toString=function(){return Oh(this())},t}function xa(t){return iM(t)?t():t}function iM(t){return typeof t=="function"&&t.hasOwnProperty(d9)&&t.__forward_ref__===Hs}function Qt(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function $o(t){return{providers:t.providers||[],imports:t.imports||[]}}function Ix(t){return h9(t,eE)}function rM(t){return Ix(t)!==null}function h9(t,n){return t.hasOwnProperty(n)&&t[n]||null}function f9(t){let n=t?.[eE]??null;return n||null}function W2(t){return t&&t.hasOwnProperty(YC)?t[YC]:null}var eE=Qr({\u0275prov:Qr}),YC=Qr({\u0275inj:Qr}),Sn=class{_desc;ngMetadataName="InjectionToken";\u0275prov;constructor(n,i){this._desc=n,this.\u0275prov=void 0,typeof i=="number"?this.__NG_ELEMENT_ID__=i:i!==void 0&&(this.\u0275prov=Qt({token:this,providedIn:i.providedIn||"root",factory:i.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function oM(t){return t&&!!t.\u0275providers}var sM=Qr({\u0275cmp:Qr}),aM=Qr({\u0275dir:Qr}),lM=Qr({\u0275pipe:Qr}),cM=Qr({\u0275mod:Qr}),Sx=Qr({\u0275fac:Qr}),jm=Qr({__NG_ELEMENT_ID__:Qr}),az=Qr({__NG_ENV_ID__:Qr});function gu(t){return typeof t=="string"?t:t==null?"":String(t)}function uz(t){return typeof t=="function"?t.name||t.toString():typeof t=="object"&&t!=null&&typeof t.type=="function"?t.type.name||t.type.toString():gu(t)}var dz=Qr({ngErrorCode:Qr}),p9=Qr({ngErrorMessage:Qr}),m9=Qr({ngTokenPath:Qr});function uM(t,n){return hz("",-200,n)}function tE(t,n){throw new bn(-201,!1)}function hz(t,n,i){let l=new bn(n,t);return l[dz]=n,l[p9]=t,i&&(l[m9]=i),l}function g9(t){return t[dz]}var Z2;function fz(){return Z2}function hl(t){let n=Z2;return Z2=t,n}function dM(t,n,i){let l=Ix(t);if(l&&l.providedIn=="root")return l.value===void 0?l.value=l.factory():l.value;if(i&8)return null;if(n!==void 0)return n;tE(t,"Injector")}var _9={},Fm=_9,v9="__NG_DI_FLAG__",X2=class{injector;constructor(n){this.injector=n}retrieve(n,i){let l=Lm(i)||0;try{return this.injector.get(n,l&8?null:Fm,l)}catch(h){if(Z_(h))return h;throw h}}};function y9(t,n=0){let i=hC();if(i===void 0)throw new bn(-203,!1);if(i===null)return dM(t,void 0,n);{let l=x9(n),h=i.retrieve(t,l);if(Z_(h)){if(l.optional)return null;throw h}return h}}function gn(t,n=0){return(fz()||y9)(xa(t),n)}function ft(t,n){return gn(t,Lm(n))}function Lm(t){return typeof t>"u"||typeof t=="number"?t:0|(t.optional&&8)|(t.host&&1)|(t.self&&2)|(t.skipSelf&&4)}function x9(t){return{optional:!!(t&8),host:!!(t&1),self:!!(t&2),skipSelf:!!(t&4)}}function Y2(t){let n=[];for(let i=0;i<t.length;i++){let l=xa(t[i]);if(Array.isArray(l)){if(l.length===0)throw new bn(900,!1);let h,o=0;for(let E=0;E<l.length;E++){let A=l[E],L=b9(A);typeof L=="number"?L===-1?h=A.token:o|=L:h=A}n.push(gn(h,o))}else n.push(gn(l))}return n}function b9(t){return t[v9]}function op(t,n){let i=t.hasOwnProperty(Sx);return i?t[Sx]:null}function pz(t,n,i){if(t.length!==n.length)return!1;for(let l=0;l<t.length;l++){let h=t[l],o=n[l];if(i&&(h=i(h),o=i(o)),o!==h)return!1}return!0}function mz(t){return t.flat(Number.POSITIVE_INFINITY)}function nE(t,n){t.forEach(i=>Array.isArray(i)?nE(i,n):n(i))}function hM(t,n,i){n>=t.length?t.push(i):t.splice(n,0,i)}function Mx(t,n){return n>=t.length-1?t.pop():t.splice(n,1)[0]}function gz(t,n,i,l){let h=t.length;if(h==n)t.push(i,l);else if(h===1)t.push(l,t[0]),t[0]=i;else{for(h--,t.push(t[h-1],t[h]);h>n;){let o=h-2;t[h]=t[o],h--}t[n]=i,t[n+1]=l}}function iE(t,n,i){let l=f0(t,n);return l>=0?t[l|1]=i:(l=~l,gz(t,l,n,i)),l}function rE(t,n){let i=f0(t,n);if(i>=0)return t[i|1]}function f0(t,n){return w9(t,n,1)}function w9(t,n,i){let l=0,h=t.length>>i;for(;h!==l;){let o=l+(h-l>>1),E=t[o<<i];if(n===E)return o<<i;E>n?h=o:l=o+1}return~(h<<i)}var ap={},fl=[],kh=new Sn(""),fM=new Sn("",-1),pM=new Sn(""),Dx=class{get(n,i=Fm){if(i===Fm){let h=hz("",-201);throw h.name="\u0275NotFound",h}return i}};function mM(t){return t[cM]||null}function Fh(t){return t[sM]||null}function gM(t){return t[aM]||null}function _z(t){return t[lM]||null}function bd(t){return{\u0275providers:t}}function vz(t){return bd([{provide:kh,multi:!0,useValue:t}])}function oE(...t){return{\u0275providers:_M(!0,t),\u0275fromNgModule:!0}}function _M(t,...n){let i=[],l=new Set,h,o=E=>{i.push(E)};return nE(n,E=>{let A=E;KC(A,o,[],l)&&(h||=[],h.push(A))}),h!==void 0&&yz(h,o),i}function yz(t,n){for(let i=0;i<t.length;i++){let{ngModule:l,providers:h}=t[i];vM(h,o=>{n(o,l)})}}function KC(t,n,i,l){if(t=xa(t),!t)return!1;let h=null,o=W2(t),E=!o&&Fh(t);if(!o&&!E){let L=t.ngModule;if(o=W2(L),o)h=L;else return!1}else{if(E&&!E.standalone)return!1;h=t}let A=l.has(h);if(E){if(A)return!1;if(l.add(h),E.dependencies){let L=typeof E.dependencies=="function"?E.dependencies():E.dependencies;for(let Y of L)KC(Y,n,i,l)}}else if(o){if(o.imports!=null&&!A){l.add(h);let Y;try{nE(o.imports,le=>{KC(le,n,i,l)&&(Y||=[],Y.push(le))})}finally{}Y!==void 0&&yz(Y,n)}if(!A){let Y=op(h)||(()=>new h);n({provide:h,useFactory:Y,deps:fl},h),n({provide:pM,useValue:h,multi:!0},h),n({provide:kh,useValue:()=>gn(h),multi:!0},h)}let L=o.providers;if(L!=null&&!A){let Y=t;vM(L,le=>{n(le,Y)})}}else return!1;return h!==t&&t.providers!==void 0}function vM(t,n){for(let i of t)oM(i)&&(i=i.\u0275providers),Array.isArray(i)?vM(i,n):n(i)}var C9=Qr({provide:String,useValue:Qr});function xz(t){return t!==null&&typeof t=="object"&&C9 in t}function E9(t){return!!(t&&t.useExisting)}function T9(t){return!!(t&&t.useFactory)}function Nm(t){return typeof t=="function"}function bz(t){return!!t.useClass}var Ax=new Sn(""),XC={},lz={},q2;function Px(){return q2===void 0&&(q2=new Dx),q2}var ds=class{},zm=class extends ds{parent;source;scopes;records=new Map;_ngOnDestroyHooks=new Set;_onDestroyHooks=[];get destroyed(){return this._destroyed}_destroyed=!1;injectorDefTypes;constructor(n,i,l,h){super(),this.parent=i,this.source=l,this.scopes=h,J2(n,E=>this.processProvider(E)),this.records.set(fM,h0(void 0,this)),h.has("environment")&&this.records.set(ds,h0(void 0,this));let o=this.records.get(Ax);o!=null&&typeof o.value=="string"&&this.scopes.add(o.value),this.injectorDefTypes=new Set(this.get(pM,fl,{self:!0}))}retrieve(n,i){let l=Lm(i)||0;try{return this.get(n,Fm,l)}catch(h){if(Z_(h))return h;throw h}}destroy(){Tx(this),this._destroyed=!0;let n=zi(null);try{for(let l of this._ngOnDestroyHooks)l.ngOnDestroy();let i=this._onDestroyHooks;this._onDestroyHooks=[];for(let l of i)l()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),zi(n)}}onDestroy(n){return Tx(this),this._onDestroyHooks.push(n),()=>this.removeOnDestroy(n)}runInContext(n){Tx(this);let i=gd(this),l=hl(void 0),h;try{return n()}finally{gd(i),hl(l)}}get(n,i=Fm,l){if(Tx(this),n.hasOwnProperty(az))return n[az](this);let h=Lm(l),o,E=gd(this),A=hl(void 0);try{if(!(h&4)){let Y=this.records.get(n);if(Y===void 0){let le=A9(n)&&Ix(n);le&&this.injectableDefInScope(le)?Y=h0(K2(n),XC):Y=null,this.records.set(n,Y)}if(Y!=null)return this.hydrate(n,Y,h)}let L=h&2?Px():this.parent;return i=h&8&&i===Fm?null:i,L.get(n,i)}catch(L){let Y=g9(L);throw Y===-200||Y===-201?new bn(Y,null):L}finally{hl(A),gd(E)}}resolveInjectorInitializers(){let n=zi(null),i=gd(this),l=hl(void 0),h;try{let o=this.get(kh,fl,{self:!0});for(let E of o)E()}finally{gd(i),hl(l),zi(n)}}toString(){let n=[],i=this.records;for(let l of i.keys())n.push(Oh(l));return`R3Injector[${n.join(", ")}]`}processProvider(n){n=xa(n);let i=Nm(n)?n:xa(n&&n.provide),l=D9(n);if(!Nm(n)&&n.multi===!0){let h=this.records.get(i);h||(h=h0(void 0,XC,!0),h.factory=()=>Y2(h.multi),this.records.set(i,h)),i=n,h.multi.push(n)}this.records.set(i,l)}hydrate(n,i,l){let h=zi(null);try{if(i.value===lz)throw uM(Oh(n));return i.value===XC&&(i.value=lz,i.value=i.factory(void 0,l)),typeof i.value=="object"&&i.value&&M9(i.value)&&this._ngOnDestroyHooks.add(i.value),i.value}finally{zi(h)}}injectableDefInScope(n){if(!n.providedIn)return!1;let i=xa(n.providedIn);return typeof i=="string"?i==="any"||this.scopes.has(i):this.injectorDefTypes.has(i)}removeOnDestroy(n){let i=this._onDestroyHooks.indexOf(n);i!==-1&&this._onDestroyHooks.splice(i,1)}};function K2(t){let n=Ix(t),i=n!==null?n.factory:op(t);if(i!==null)return i;if(t instanceof Sn)throw new bn(204,!1);if(t instanceof Function)return S9(t);throw new bn(204,!1)}function S9(t){if(t.length>0)throw new bn(204,!1);let i=f9(t);return i!==null?()=>i.factory(t):()=>new t}function D9(t){if(xz(t))return h0(void 0,t.useValue);{let n=yM(t);return h0(n,XC)}}function yM(t,n,i){let l;if(Nm(t)){let h=xa(t);return op(h)||K2(h)}else if(xz(t))l=()=>xa(t.useValue);else if(T9(t))l=()=>t.useFactory(...Y2(t.deps||[]));else if(E9(t))l=(h,o)=>gn(xa(t.useExisting),o!==void 0&&o&8?8:void 0);else{let h=xa(t&&(t.useClass||t.provide));if(I9(t))l=()=>new h(...Y2(t.deps));else return op(h)||K2(h)}return l}function Tx(t){if(t.destroyed)throw new bn(205,!1)}function h0(t,n,i=!1){return{factory:t,value:n,multi:i?[]:void 0}}function I9(t){return!!t.deps}function M9(t){return t!==null&&typeof t=="object"&&typeof t.ngOnDestroy=="function"}function A9(t){return typeof t=="function"||typeof t=="object"&&t.ngMetadataName==="InjectionToken"}function J2(t,n){for(let i of t)Array.isArray(i)?J2(i,n):i&&oM(i)?J2(i.\u0275providers,n):n(i)}function ta(t,n){let i;t instanceof zm?(Tx(t),i=t):i=new X2(t);let l,h=gd(i),o=hl(void 0);try{return n()}finally{gd(h),hl(o)}}function wz(){return fz()!==void 0||hC()!=null}var _u=0,vi=1,Bi=2,Us=3,Sc=4,Dc=5,p0=6,m0=7,hs=8,vu=9,wd=10,Ao=11,g0=12,xM=13,Vm=14,Ql=15,lp=16,Um=17,Cd=18,Ox=19,bM=20,Ph=21,sE=22,Rx=23,ec=24,Hm=25,cp=26,Go=27,Cz=1,wM=6,up=7,kx=8,$m=9,Ss=10;function Ed(t){return Array.isArray(t)&&typeof t[Cz]=="object"}function yu(t){return Array.isArray(t)&&t[Cz]===!0}function CM(t){return(t.flags&4)!==0}function dp(t){return t.componentOffset>-1}function Fx(t){return(t.flags&1)===1}function Td(t){return!!t.template}function _0(t){return(t[Bi]&512)!==0}function Gm(t){return(t[Bi]&256)===256}var Ez="svg",Tz="math";function Ic(t){for(;Array.isArray(t);)t=t[_u];return t}function EM(t,n){return Ic(n[t])}function Mc(t,n){return Ic(n[t.index])}function Lx(t,n){return t.data[n]}function Nx(t,n){return t[n]}function TM(t,n,i,l){i>=t.data.length&&(t.data[i]=null,t.blueprint[i]=null),n[i]=l}function Ac(t,n){let i=n[t];return Ed(i)?i:i[_u]}function Sz(t){return(t[Bi]&4)===4}function aE(t){return(t[Bi]&128)===128}function Dz(t){return yu(t[Us])}function Pc(t,n){return n==null?null:t[n]}function SM(t){t[Um]=0}function DM(t){t[Bi]&1024||(t[Bi]|=1024,aE(t)&&v0(t))}function Iz(t,n){for(;t>0;)n=n[Vm],t--;return n}function zx(t){return!!(t[Bi]&9216||t[ec]?.dirty)}function lE(t){t[wd].changeDetectionScheduler?.notify(8),t[Bi]&64&&(t[Bi]|=1024),zx(t)&&v0(t)}function v0(t){t[wd].changeDetectionScheduler?.notify(0);let n=sp(t);for(;n!==null&&!(n[Bi]&8192||(n[Bi]|=8192,!aE(n)));)n=sp(n)}function IM(t,n){if(Gm(t))throw new bn(911,!1);t[Ph]===null&&(t[Ph]=[]),t[Ph].push(n)}function Mz(t,n){if(t[Ph]===null)return;let i=t[Ph].indexOf(n);i!==-1&&t[Ph].splice(i,1)}function sp(t){let n=t[Us];return yu(n)?n[Us]:n}function MM(t){return t[m0]??=[]}function AM(t){return t.cleanup??=[]}function Az(t,n,i,l){let h=MM(n);h.push(i),t.firstCreatePass&&AM(t).push(l,h.length-1)}var ar={lFrame:Hz(null),bindingsEnabled:!0,skipHydrationRootTNode:null};var Q2=!1;function Pz(){return ar.lFrame.elementDepthCount}function Oz(){ar.lFrame.elementDepthCount++}function PM(){ar.lFrame.elementDepthCount--}function OM(){return ar.bindingsEnabled}function Rz(){return ar.skipHydrationRootTNode!==null}function RM(t){return ar.skipHydrationRootTNode===t}function kM(){ar.skipHydrationRootTNode=null}function hi(){return ar.lFrame.lView}function Ds(){return ar.lFrame.tView}function Wt(t){return ar.lFrame.contextLView=t,t[hs]}function Zt(t){return ar.lFrame.contextLView=null,t}function na(){let t=FM();for(;t!==null&&t.type===64;)t=t.parent;return t}function FM(){return ar.lFrame.currentTNode}function kz(){let t=ar.lFrame,n=t.currentTNode;return t.isParent?n:n.parent}function y0(t,n){let i=ar.lFrame;i.currentTNode=t,i.isParent=n}function LM(){return ar.lFrame.isParent}function Fz(){ar.lFrame.isParent=!1}function Lz(){return ar.lFrame.contextLView}function NM(){return Q2}function zM(t){let n=Q2;return Q2=t,n}function Sd(){let t=ar.lFrame,n=t.bindingRootIndex;return n===-1&&(n=t.bindingRootIndex=t.tView.bindingStartIndex),n}function BM(){return ar.lFrame.bindingIndex}function Nz(t){return ar.lFrame.bindingIndex=t}function qm(){return ar.lFrame.bindingIndex++}function Bx(t){let n=ar.lFrame,i=n.bindingIndex;return n.bindingIndex=n.bindingIndex+t,i}function zz(){return ar.lFrame.inI18n}function Bz(t,n){let i=ar.lFrame;i.bindingIndex=i.bindingRootIndex=t,cE(n)}function jz(){return ar.lFrame.currentDirectiveIndex}function cE(t){ar.lFrame.currentDirectiveIndex=t}function Vz(t){let n=ar.lFrame.currentDirectiveIndex;return n===-1?null:t[n]}function jM(){return ar.lFrame.currentQueryIndex}function uE(t){ar.lFrame.currentQueryIndex=t}function P9(t){let n=t[vi];return n.type===2?n.declTNode:n.type===1?t[Dc]:null}function VM(t,n,i){if(i&4){let h=n,o=t;for(;h=h.parent,h===null&&!(i&1);)if(h=P9(o),h===null||(o=o[Vm],h.type&10))break;if(h===null)return!1;n=h,t=o}let l=ar.lFrame=Uz();return l.currentTNode=n,l.lView=t,!0}function dE(t){let n=Uz(),i=t[vi];ar.lFrame=n,n.currentTNode=i.firstChild,n.lView=t,n.tView=i,n.contextLView=t,n.bindingIndex=i.bindingStartIndex,n.inI18n=!1}function Uz(){let t=ar.lFrame,n=t===null?null:t.child;return n===null?Hz(t):n}function Hz(t){let n={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return t!==null&&(t.child=n),n}function $z(){let t=ar.lFrame;return ar.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}var UM=$z;function hE(){let t=$z();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function Gz(t){return(ar.lFrame.contextLView=Iz(t,ar.lFrame.contextLView))[hs]}function xu(){return ar.lFrame.selectedIndex}function hp(t){ar.lFrame.selectedIndex=t}function fE(){let t=ar.lFrame;return Lx(t.tView,t.selectedIndex)}function qz(){return ar.lFrame.currentNamespace}var Wz=!0;function pE(){return Wz}function mE(t){Wz=t}function eM(t,n=null,i=null,l){let h=HM(t,n,i,l);return h.resolveInjectorInitializers(),h}function HM(t,n=null,i=null,l,h=new Set){let o=[i||fl,oE(t)];return l=l||(typeof t=="object"?void 0:Oh(t)),new zm(o,n||Px(),l||null,h)}var ba=class t{static THROW_IF_NOT_FOUND=Fm;static NULL=new Dx;static create(n,i){if(Array.isArray(n))return eM({name:""},i,n,"");{let l=n.name??"";return eM({name:l},n.parent,n.providers,l)}}static \u0275prov=Qt({token:t,providedIn:"any",factory:()=>gn(fM)});static __NG_ELEMENT_ID__=-1},_o=new Sn(""),bu=(()=>{class t{static __NG_ELEMENT_ID__=O9;static __NG_ENV_ID__=i=>i}return t})(),tM=class extends bu{_lView;constructor(n){super(),this._lView=n}get destroyed(){return Gm(this._lView)}onDestroy(n){let i=this._lView;return IM(i,n),()=>Mz(i,n)}};function O9(){return new tM(hi())}var pu=class{_console=console;handleError(n){this._console.error("ERROR",n)}},pl=new Sn("",{providedIn:"root",factory:()=>{let t=ft(ds),n;return i=>{t.destroyed&&!n?setTimeout(()=>{throw i}):(n??=t.get(pu),n.handleError(i))}}}),Zz={provide:kh,useValue:()=>void ft(pu),multi:!0},R9=new Sn("",{providedIn:"root",factory:()=>{let t=ft(_o).defaultView;if(!t)return;let n=ft(pl),i=o=>{n(o.reason),o.preventDefault()},l=o=>{o.error?n(o.error):n(new Error(o.message,{cause:o})),o.preventDefault()},h=()=>{t.addEventListener("unhandledrejection",i),t.addEventListener("error",l)};typeof Zone<"u"?Zone.root.run(h):h(),ft(bu).onDestroy(()=>{t.removeEventListener("error",l),t.removeEventListener("unhandledrejection",i)})}});function $M(){return bd([vz(()=>void ft(R9))])}function GM(t){return typeof t=="function"&&t[Ba]!==void 0}function tc(t,n){let[i,l,h]=D2(t,n?.equal),o=i,E=o[Ba];return o.set=l,o.update=h,o.asReadonly=Xz.bind(o),o}function Xz(){let t=this[Ba];if(t.readonlyFn===void 0){let n=()=>this();n[Ba]=t,t.readonlyFn=n}return t.readonlyFn}function qM(t){return GM(t)&&typeof t.set=="function"}var Rh=class{},jx=new Sn("",{providedIn:"root",factory:()=>!1});var WM=new Sn(""),ZM=new Sn("");var gE=(()=>{class t{view;node;constructor(i,l){this.view=i,this.node=l}static __NG_ELEMENT_ID__=k9}return t})();function k9(){return new gE(hi(),na())}var Dd=(()=>{class t{taskId=0;pendingTasks=new Set;destroyed=!1;pendingTask=new Ho(!1);get hasPendingTasks(){return this.destroyed?!1:this.pendingTask.value}get hasPendingTasksObservable(){return this.destroyed?new xi(i=>{i.next(!1),i.complete()}):this.pendingTask}add(){!this.hasPendingTasks&&!this.destroyed&&this.pendingTask.next(!0);let i=this.taskId++;return this.pendingTasks.add(i),i}has(i){return this.pendingTasks.has(i)}remove(i){this.pendingTasks.delete(i),this.pendingTasks.size===0&&this.hasPendingTasks&&this.pendingTask.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks&&this.pendingTask.next(!1),this.destroyed=!0,this.pendingTask.unsubscribe()}static \u0275prov=Qt({token:t,providedIn:"root",factory:()=>new t})}return t})(),_E=(()=>{class t{internalPendingTasks=ft(Dd);scheduler=ft(Rh);errorHandler=ft(pl);add(){let i=this.internalPendingTasks.add();return()=>{this.internalPendingTasks.has(i)&&(this.scheduler.notify(11),this.internalPendingTasks.remove(i))}}run(i){let l=this.add();i().catch(this.errorHandler).finally(l)}static \u0275prov=Qt({token:t,providedIn:"root",factory:()=>new t})}return t})();function Vx(...t){}var XM=(()=>{class t{static \u0275prov=Qt({token:t,providedIn:"root",factory:()=>new nM})}return t})(),nM=class{dirtyEffectCount=0;queues=new Map;add(n){this.enqueue(n),this.schedule(n)}schedule(n){n.dirty&&this.dirtyEffectCount++}remove(n){let i=n.zone,l=this.queues.get(i);l.has(n)&&(l.delete(n),n.dirty&&this.dirtyEffectCount--)}enqueue(n){let i=n.zone;this.queues.has(i)||this.queues.set(i,new Set);let l=this.queues.get(i);l.has(n)||l.add(n)}flush(){for(;this.dirtyEffectCount>0;){let n=!1;for(let[i,l]of this.queues)i===null?n||=this.flushQueue(l):n||=i.run(()=>this.flushQueue(l));n||(this.dirtyEffectCount=0)}}flushQueue(n){let i=!1;for(let l of n)l.dirty&&(this.dirtyEffectCount--,i=!0,l.run());return i}};function eb(t){return{toString:t}.toString()}function U9(t){return typeof t=="function"}var DE=class{previousValue;currentValue;firstChange;constructor(n,i,l){this.previousValue=n,this.currentValue=i,this.firstChange=l}isFirstChange(){return this.firstChange}};function kB(t,n,i,l){n!==null?n.applyValueToInputSignal(n,l):t[i]=l}var wa=(()=>{let t=()=>FB;return t.ngInherit=!0,t})();function FB(t){return t.type.prototype.ngOnChanges&&(t.setInput=$9),H9}function H9(){let t=NB(this),n=t?.current;if(n){let i=t.previous;if(i===ap)t.previous=n;else for(let l in n)i[l]=n[l];t.current=null,this.ngOnChanges(n)}}function $9(t,n,i,l,h){let o=this.declaredInputs[l],E=NB(t)||G9(t,{previous:ap,current:null}),A=E.current||(E.current={}),L=E.previous,Y=L[o];A[o]=new DE(Y&&Y.currentValue,i,L===ap),kB(t,n,h,i)}var LB="__ngSimpleChanges__";function NB(t){return t[LB]||null}function G9(t,n){return t[LB]=n}var Yz=[];var ro=function(t,n=null,i){for(let l=0;l<Yz.length;l++){let h=Yz[l];h(t,n,i)}};function q9(t,n,i){let{ngOnChanges:l,ngOnInit:h,ngDoCheck:o}=n.type.prototype;if(l){let E=FB(n);(i.preOrderHooks??=[]).push(t,E),(i.preOrderCheckHooks??=[]).push(t,E)}h&&(i.preOrderHooks??=[]).push(0-t,h),o&&((i.preOrderHooks??=[]).push(t,o),(i.preOrderCheckHooks??=[]).push(t,o))}function zB(t,n){for(let i=n.directiveStart,l=n.directiveEnd;i<l;i++){let o=t.data[i].type.prototype,{ngAfterContentInit:E,ngAfterContentChecked:A,ngAfterViewInit:L,ngAfterViewChecked:Y,ngOnDestroy:le}=o;E&&(t.contentHooks??=[]).push(-i,E),A&&((t.contentHooks??=[]).push(i,A),(t.contentCheckHooks??=[]).push(i,A)),L&&(t.viewHooks??=[]).push(-i,L),Y&&((t.viewHooks??=[]).push(i,Y),(t.viewCheckHooks??=[]).push(i,Y)),le!=null&&(t.destroyHooks??=[]).push(i,le)}}function CE(t,n,i){BB(t,n,3,i)}function EE(t,n,i,l){(t[Bi]&3)===i&&BB(t,n,i,l)}function YM(t,n){let i=t[Bi];(i&3)===n&&(i&=16383,i+=1,t[Bi]=i)}function BB(t,n,i,l){let h=l!==void 0?t[Um]&65535:0,o=l??-1,E=n.length-1,A=0;for(let L=h;L<E;L++)if(typeof n[L+1]=="number"){if(A=n[L],l!=null&&A>=l)break}else n[L]<0&&(t[Um]+=65536),(A<o||o==-1)&&(W9(t,i,n,L),t[Um]=(t[Um]&4294901760)+L+2),L++}function Kz(t,n){ro(4,t,n);let i=zi(null);try{n.call(t)}finally{zi(i),ro(5,t,n)}}function W9(t,n,i,l){let h=i[l]<0,o=i[l+1],E=h?-i[l]:i[l],A=t[E];h?t[Bi]>>14<t[Um]>>16&&(t[Bi]&3)===n&&(t[Bi]+=16384,Kz(A,o)):Kz(A,o)}var b0=-1,Zm=class{factory;name;injectImpl;resolving=!1;canSeeViewProviders;multi;componentProviders;index;providerFactory;constructor(n,i,l,h){this.factory=n,this.name=h,this.canSeeViewProviders=i,this.injectImpl=l}};function Z9(t){return(t.flags&8)!==0}function X9(t){return(t.flags&16)!==0}function Y9(t,n,i){let l=0;for(;l<i.length;){let h=i[l];if(typeof h=="number"){if(h!==0)break;l++;let o=i[l++],E=i[l++],A=i[l++];t.setAttribute(n,E,A,o)}else{let o=h,E=i[++l];K9(o)?t.setProperty(n,o,E):t.setAttribute(n,o,E),l++}}return l}function jB(t){return t===3||t===4||t===6}function K9(t){return t.charCodeAt(0)===64}function E0(t,n){if(!(n===null||n.length===0))if(t===null||t.length===0)t=n.slice();else{let i=-1;for(let l=0;l<n.length;l++){let h=n[l];typeof h=="number"?i=h:i===0||(i===-1||i===2?Jz(t,i,h,null,n[++l]):Jz(t,i,h,null,null))}}return t}function Jz(t,n,i,l,h){let o=0,E=t.length;if(n===-1)E=-1;else for(;o<t.length;){let A=t[o++];if(typeof A=="number"){if(A===n){E=-1;break}else if(A>n){E=o-1;break}}}for(;o<t.length;){let A=t[o];if(typeof A=="number")break;if(A===i){h!==null&&(t[o+1]=h);return}o++,h!==null&&o++}E!==-1&&(t.splice(E,0,n),o=E+1),t.splice(o++,0,i),h!==null&&t.splice(o++,0,h)}function VB(t){return t!==b0}function IE(t){return t&32767}function J9(t){return t>>16}function ME(t,n){let i=J9(t),l=n;for(;i>0;)l=l[Vm],i--;return l}var aA=!0;function AE(t){let n=aA;return aA=t,n}var Q9=256,UB=Q9-1,HB=5,eZ=0,Id={};function tZ(t,n,i){let l;typeof i=="string"?l=i.charCodeAt(0)||0:i.hasOwnProperty(jm)&&(l=i[jm]),l==null&&(l=i[jm]=eZ++);let h=l&UB,o=1<<h;n.data[t+(h>>HB)]|=o}function PE(t,n){let i=$B(t,n);if(i!==-1)return i;let l=n[vi];l.firstCreatePass&&(t.injectorIndex=n.length,KM(l.data,t),KM(n,null),KM(l.blueprint,null));let h=HA(t,n),o=t.injectorIndex;if(VB(h)){let E=IE(h),A=ME(h,n),L=A[vi].data;for(let Y=0;Y<8;Y++)n[o+Y]=A[E+Y]|L[E+Y]}return n[o+8]=h,o}function KM(t,n){t.push(0,0,0,0,0,0,0,0,n)}function $B(t,n){return t.injectorIndex===-1||t.parent&&t.parent.injectorIndex===t.injectorIndex||n[t.injectorIndex+8]===null?-1:t.injectorIndex}function HA(t,n){if(t.parent&&t.parent.injectorIndex!==-1)return t.parent.injectorIndex;let i=0,l=null,h=n;for(;h!==null;){if(l=XB(h),l===null)return b0;if(i++,h=h[Vm],l.injectorIndex!==-1)return l.injectorIndex|i<<16}return b0}function lA(t,n,i){tZ(t,n,i)}function nZ(t,n){if(n==="class")return t.classes;if(n==="style")return t.styles;let i=t.attrs;if(i){let l=i.length,h=0;for(;h<l;){let o=i[h];if(jB(o))break;if(o===0)h=h+2;else if(typeof o=="number")for(h++;h<l&&typeof i[h]=="string";)h++;else{if(o===n)return i[h+1];h=h+2}}}return null}function GB(t,n,i){if(i&8||t!==void 0)return t;tE(n,"NodeInjector")}function qB(t,n,i,l){if(i&8&&l===void 0&&(l=null),(i&3)===0){let h=t[vu],o=hl(void 0);try{return h?h.get(n,l,i&8):dM(n,l,i&8)}finally{hl(o)}}return GB(l,n,i)}function WB(t,n,i,l=0,h){if(t!==null){if(n[Bi]&2048&&!(l&2)){let E=sZ(t,n,i,l,Id);if(E!==Id)return E}let o=ZB(t,n,i,l,Id);if(o!==Id)return o}return qB(n,i,l,h)}function ZB(t,n,i,l,h){let o=rZ(i);if(typeof o=="function"){if(!VM(n,t,l))return l&1?GB(h,i,l):qB(n,i,l,h);try{let E;if(E=o(l),E==null&&!(l&8))tE(i);else return E}finally{UM()}}else if(typeof o=="number"){let E=null,A=$B(t,n),L=b0,Y=l&1?n[Ql][Dc]:null;for((A===-1||l&4)&&(L=A===-1?HA(t,n):n[A+8],L===b0||!eB(l,!1)?A=-1:(E=n[vi],A=IE(L),n=ME(L,n)));A!==-1;){let le=n[vi];if(Qz(o,A,le.data)){let te=iZ(A,n,i,E,l,Y);if(te!==Id)return te}L=n[A+8],L!==b0&&eB(l,n[vi].data[A+8]===Y)&&Qz(o,A,n)?(E=le,A=IE(L),n=ME(L,n)):A=-1}}return h}function iZ(t,n,i,l,h,o){let E=n[vi],A=E.data[t+8],L=l==null?dp(A)&&aA:l!=E&&(A.type&3)!==0,Y=h&1&&o===A,le=TE(A,E,i,L,Y);return le!==null?Wx(n,E,le,A,h):Id}function TE(t,n,i,l,h){let o=t.providerIndexes,E=n.data,A=o&1048575,L=t.directiveStart,Y=t.directiveEnd,le=o>>20,te=l?A:A+le,ze=h?A+le:Y;for(let Ae=te;Ae<ze;Ae++){let Be=E[Ae];if(Ae<L&&i===Be||Ae>=L&&Be.type===i)return Ae}if(h){let Ae=E[L];if(Ae&&Td(Ae)&&Ae.type===i)return L}return null}function Wx(t,n,i,l,h){let o=t[i],E=n.data;if(o instanceof Zm){let A=o;if(A.resolving){let Ae=uz(E[i]);throw uM(Ae)}let L=AE(A.canSeeViewProviders);A.resolving=!0;let Y=E[i].type||E[i],le,te=A.injectImpl?hl(A.injectImpl):null,ze=VM(t,l,0);try{o=t[i]=A.factory(void 0,h,E,t,l),n.firstCreatePass&&i>=l.directiveStart&&q9(i,E[i],n)}finally{te!==null&&hl(te),AE(L),A.resolving=!1,UM()}}return o}function rZ(t){if(typeof t=="string")return t.charCodeAt(0)||0;let n=t.hasOwnProperty(jm)?t[jm]:void 0;return typeof n=="number"?n>=0?n&UB:oZ:n}function Qz(t,n,i){let l=1<<t;return!!(i[n+(t>>HB)]&l)}function eB(t,n){return!(t&2)&&!(t&1&&n)}var Wm=class{_tNode;_lView;constructor(n,i){this._tNode=n,this._lView=i}get(n,i,l){return WB(this._tNode,this._lView,n,Lm(l),i)}};function oZ(){return new Wm(na(),hi())}function Ca(t){return eb(()=>{let n=t.prototype.constructor,i=n[Sx]||cA(n),l=Object.prototype,h=Object.getPrototypeOf(t.prototype).constructor;for(;h&&h!==l;){let o=h[Sx]||cA(h);if(o&&o!==i)return o;h=Object.getPrototypeOf(h)}return o=>new o})}function cA(t){return iM(t)?()=>{let n=cA(xa(t));return n&&n()}:op(t)}function sZ(t,n,i,l,h){let o=t,E=n;for(;o!==null&&E!==null&&E[Bi]&2048&&!_0(E);){let A=ZB(o,E,i,l|2,Id);if(A!==Id)return A;let L=o.parent;if(!L){let Y=E[bM];if(Y){let le=Y.get(i,Id,l);if(le!==Id)return le}L=XB(E),E=E[Vm]}o=L}return h}function XB(t){let n=t[vi],i=n.type;return i===2?n.declTNode:i===1?t[Dc]:null}function tb(t){return nZ(na(),t)}function aZ(){return I0(na(),hi())}function I0(t,n){return new Fo(Mc(t,n))}var Fo=(()=>{class t{nativeElement;constructor(i){this.nativeElement=i}static __NG_ELEMENT_ID__=aZ}return t})();function lZ(t){return t instanceof Fo?t.nativeElement:t}function cZ(){return this._results[Symbol.iterator]()}var OE=class{_emitDistinctChangesOnly;dirty=!0;_onDirty=void 0;_results=[];_changesDetected=!1;_changes=void 0;length=0;first=void 0;last=void 0;get changes(){return this._changes??=new Fn}constructor(n=!1){this._emitDistinctChangesOnly=n}get(n){return this._results[n]}map(n){return this._results.map(n)}filter(n){return this._results.filter(n)}find(n){return this._results.find(n)}reduce(n,i){return this._results.reduce(n,i)}forEach(n){this._results.forEach(n)}some(n){return this._results.some(n)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(n,i){this.dirty=!1;let l=mz(n);(this._changesDetected=!pz(this._results,l,i))&&(this._results=l,this.length=l.length,this.last=l[this.length-1],this.first=l[0])}notifyOnChanges(){this._changes!==void 0&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.next(this)}onDirty(n){this._onDirty=n}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){this._changes!==void 0&&(this._changes.complete(),this._changes.unsubscribe())}[Symbol.iterator]=cZ};function YB(t){return(t.flags&128)===128}var $A=(function(t){return t[t.OnPush=0]="OnPush",t[t.Default=1]="Default",t})($A||{}),KB=new Map,uZ=0;function dZ(){return uZ++}function hZ(t){KB.set(t[Ox],t)}function uA(t){KB.delete(t[Ox])}var tB="__ngContext__";function T0(t,n){Ed(n)?(t[tB]=n[Ox],hZ(n)):t[tB]=n}function JB(t){return ej(t[g0])}function QB(t){return ej(t[Sc])}function ej(t){for(;t!==null&&!yu(t);)t=t[Sc];return t}var dA;function GA(t){dA=t}function qA(){if(dA!==void 0)return dA;if(typeof document<"u")return document;throw new bn(210,!1)}var XE=new Sn("",{providedIn:"root",factory:()=>fZ}),fZ="ng",YE=new Sn(""),M0=new Sn("",{providedIn:"platform",factory:()=>"unknown"});var KE=new Sn("",{providedIn:"root",factory:()=>qA().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var pZ="h",mZ="b";var tj="r";var nj="di";var ij=!1,rj=new Sn("",{providedIn:"root",factory:()=>ij});var WA=new Sn("");var gZ=(t,n,i,l)=>{};function _Z(t,n,i,l){gZ(t,n,i,l)}function ZA(t){return(t.flags&32)===32}var vZ=()=>null;function oj(t,n,i=!1){return vZ(t,n,i)}function sj(t,n){let i=t.contentQueries;if(i!==null){let l=zi(null);try{for(let h=0;h<i.length;h+=2){let o=i[h],E=i[h+1];if(E!==-1){let A=t.data[E];uE(o),A.contentQueries(2,n[E],E)}}}finally{zi(l)}}}function hA(t,n,i){uE(0);let l=zi(null);try{n(t,i)}finally{zi(l)}}function aj(t,n,i){if(CM(n)){let l=zi(null);try{let h=n.directiveStart,o=n.directiveEnd;for(let E=h;E<o;E++){let A=t.data[E];if(A.contentQueries){let L=i[E];A.contentQueries(1,L,E)}}}finally{zi(l)}}}var Lh=(function(t){return t[t.Emulated=0]="Emulated",t[t.None=2]="None",t[t.ShadowDom=3]="ShadowDom",t})(Lh||{}),vE;function yZ(){if(vE===void 0&&(vE=null,mu.trustedTypes))try{vE=mu.trustedTypes.createPolicy("angular",{createHTML:t=>t,createScript:t=>t,createScriptURL:t=>t})}catch{}return vE}function JE(t){return yZ()?.createHTML(t)||t}var yE;function lj(){if(yE===void 0&&(yE=null,mu.trustedTypes))try{yE=mu.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:t=>t,createScript:t=>t,createScriptURL:t=>t})}catch{}return yE}function nB(t){return lj()?.createHTML(t)||t}function iB(t){return lj()?.createScriptURL(t)||t}var RE=class{changingThisBreaksApplicationSecurity;constructor(n){this.changingThisBreaksApplicationSecurity=n}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${JC})`}};function eg(t){return t instanceof RE?t.changingThisBreaksApplicationSecurity:t}function QE(t,n){let i=cj(t);if(i!=null&&i!==n){if(i==="ResourceURL"&&n==="URL")return!0;throw new Error(`Required a safe ${n}, got a ${i} (see ${JC})`)}return i===n}function cj(t){return t instanceof RE&&t.getTypeName()||null}function xZ(t){let n=new pA(t);return bZ()?new fA(n):n}var fA=class{inertDocumentHelper;constructor(n){this.inertDocumentHelper=n}getInertBodyElement(n){n="<body><remove></remove>"+n;try{let i=new window.DOMParser().parseFromString(JE(n),"text/html").body;return i===null?this.inertDocumentHelper.getInertBodyElement(n):(i.firstChild?.remove(),i)}catch{return null}}},pA=class{defaultDoc;inertDocument;constructor(n){this.defaultDoc=n,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert")}getInertBodyElement(n){let i=this.inertDocument.createElement("template");return i.innerHTML=JE(n),i}};function bZ(){try{return!!new window.DOMParser().parseFromString(JE(""),"text/html")}catch{return!1}}var wZ=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function XA(t){return t=String(t),t.match(wZ)?t:"unsafe:"+t}function Nh(t){let n={};for(let i of t.split(","))n[i]=!0;return n}function nb(...t){let n={};for(let i of t)for(let l in i)i.hasOwnProperty(l)&&(n[l]=!0);return n}var uj=Nh("area,br,col,hr,img,wbr"),dj=Nh("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),hj=Nh("rp,rt"),CZ=nb(hj,dj),EZ=nb(dj,Nh("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),TZ=nb(hj,Nh("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),rB=nb(uj,EZ,TZ,CZ),fj=Nh("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),SZ=Nh("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,srcset,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),DZ=Nh("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext"),IZ=nb(fj,SZ,DZ),MZ=Nh("script,style,template"),mA=class{sanitizedSomething=!1;buf=[];sanitizeChildren(n){let i=n.firstChild,l=!0,h=[];for(;i;){if(i.nodeType===Node.ELEMENT_NODE?l=this.startElement(i):i.nodeType===Node.TEXT_NODE?this.chars(i.nodeValue):this.sanitizedSomething=!0,l&&i.firstChild){h.push(i),i=OZ(i);continue}for(;i;){i.nodeType===Node.ELEMENT_NODE&&this.endElement(i);let o=PZ(i);if(o){i=o;break}i=h.pop()}}return this.buf.join("")}startElement(n){let i=oB(n).toLowerCase();if(!rB.hasOwnProperty(i))return this.sanitizedSomething=!0,!MZ.hasOwnProperty(i);this.buf.push("<"),this.buf.push(i);let l=n.attributes;for(let h=0;h<l.length;h++){let o=l.item(h),E=o.name,A=E.toLowerCase();if(!IZ.hasOwnProperty(A)){this.sanitizedSomething=!0;continue}let L=o.value;fj[A]&&(L=XA(L)),this.buf.push(" ",E,'="',sB(L),'"')}return this.buf.push(">"),!0}endElement(n){let i=oB(n).toLowerCase();rB.hasOwnProperty(i)&&!uj.hasOwnProperty(i)&&(this.buf.push("</"),this.buf.push(i),this.buf.push(">"))}chars(n){this.buf.push(sB(n))}};function AZ(t,n){return(t.compareDocumentPosition(n)&Node.DOCUMENT_POSITION_CONTAINED_BY)!==Node.DOCUMENT_POSITION_CONTAINED_BY}function PZ(t){let n=t.nextSibling;if(n&&t!==n.previousSibling)throw pj(n);return n}function OZ(t){let n=t.firstChild;if(n&&AZ(t,n))throw pj(n);return n}function oB(t){let n=t.nodeName;return typeof n=="string"?n:"FORM"}function pj(t){return new Error(`Failed to sanitize html because the element is clobbered: ${t.outerHTML}`)}var RZ=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,kZ=/([^\#-~ |!])/g;function sB(t){return t.replace(/&/g,"&amp;").replace(RZ,function(n){let i=n.charCodeAt(0),l=n.charCodeAt(1);return"&#"+((i-55296)*1024+(l-56320)+65536)+";"}).replace(kZ,function(n){return"&#"+n.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}var xE;function mj(t,n){let i=null;try{xE=xE||xZ(t);let l=n?String(n):"";i=xE.getInertBodyElement(l);let h=5,o=l;do{if(h===0)throw new Error("Failed to sanitize html because the input is unstable");h--,l=o,o=i.innerHTML,i=xE.getInertBodyElement(l)}while(l!==o);let A=new mA().sanitizeChildren(aB(i)||i);return JE(A)}finally{if(i){let l=aB(i)||i;for(;l.firstChild;)l.firstChild.remove()}}}function aB(t){return"content"in t&&FZ(t)?t.content:null}function FZ(t){return t.nodeType===Node.ELEMENT_NODE&&t.nodeName==="TEMPLATE"}var ib=(function(t){return t[t.NONE=0]="NONE",t[t.HTML=1]="HTML",t[t.STYLE=2]="STYLE",t[t.SCRIPT=3]="SCRIPT",t[t.URL=4]="URL",t[t.RESOURCE_URL=5]="RESOURCE_URL",t})(ib||{});function rb(t){let n=KA();return n?nB(n.sanitize(ib.HTML,t)||""):QE(t,"HTML")?nB(eg(t)):mj(qA(),gu(t))}function zr(t){let n=KA();return n?n.sanitize(ib.URL,t)||"":QE(t,"URL")?eg(t):XA(gu(t))}function gj(t){let n=KA();if(n)return iB(n.sanitize(ib.RESOURCE_URL,t)||"");if(QE(t,"ResourceURL"))return iB(eg(t));throw new bn(904,!1)}function LZ(t,n){return n==="src"&&(t==="embed"||t==="frame"||t==="iframe"||t==="media"||t==="script")||n==="href"&&(t==="base"||t==="link")?gj:zr}function YA(t,n,i){return LZ(n,i)(t)}function KA(){let t=hi();return t&&t[wd].sanitizer}function JA(t){return t.ownerDocument}function _j(t){return t instanceof Function?t():t}function NZ(t,n,i){let l=t.length;for(;;){let h=t.indexOf(n,i);if(h===-1)return h;if(h===0||t.charCodeAt(h-1)<=32){let o=n.length;if(h+o===l||t.charCodeAt(h+o)<=32)return h}i=h+1}}var vj="ng-template";function zZ(t,n,i,l){let h=0;if(l){for(;h<n.length&&typeof n[h]=="string";h+=2)if(n[h]==="class"&&NZ(n[h+1].toLowerCase(),i,0)!==-1)return!0}else if(QA(t))return!1;if(h=n.indexOf(1,h),h>-1){let o;for(;++h<n.length&&typeof(o=n[h])=="string";)if(o.toLowerCase()===i)return!0}return!1}function QA(t){return t.type===4&&t.value!==vj}function BZ(t,n,i){let l=t.type===4&&!i?vj:t.value;return n===l}function jZ(t,n,i){let l=4,h=t.attrs,o=h!==null?HZ(h):0,E=!1;for(let A=0;A<n.length;A++){let L=n[A];if(typeof L=="number"){if(!E&&!wu(l)&&!wu(L))return!1;if(E&&wu(L))continue;E=!1,l=L|l&1;continue}if(!E)if(l&4){if(l=2|l&1,L!==""&&!BZ(t,L,i)||L===""&&n.length===1){if(wu(l))return!1;E=!0}}else if(l&8){if(h===null||!zZ(t,h,L,i)){if(wu(l))return!1;E=!0}}else{let Y=n[++A],le=VZ(L,h,QA(t),i);if(le===-1){if(wu(l))return!1;E=!0;continue}if(Y!==""){let te;if(le>o?te="":te=h[le+1].toLowerCase(),l&2&&Y!==te){if(wu(l))return!1;E=!0}}}}return wu(l)||E}function wu(t){return(t&1)===0}function VZ(t,n,i,l){if(n===null)return-1;let h=0;if(l||!i){let o=!1;for(;h<n.length;){let E=n[h];if(E===t)return h;if(E===3||E===6)o=!0;else if(E===1||E===2){let A=n[++h];for(;typeof A=="string";)A=n[++h];continue}else{if(E===4)break;if(E===0){h+=4;continue}}h+=o?1:2}return-1}else return $Z(n,t)}function UZ(t,n,i=!1){for(let l=0;l<n.length;l++)if(jZ(t,n[l],i))return!0;return!1}function HZ(t){for(let n=0;n<t.length;n++){let i=t[n];if(jB(i))return n}return t.length}function $Z(t,n){let i=t.indexOf(4);if(i>-1)for(i++;i<t.length;){let l=t[i];if(typeof l=="number")return-1;if(l===n)return i;i++}return-1}function lB(t,n){return t?":not("+n.trim()+")":n}function GZ(t){let n=t[0],i=1,l=2,h="",o=!1;for(;i<t.length;){let E=t[i];if(typeof E=="string")if(l&2){let A=t[++i];h+="["+E+(A.length>0?'="'+A+'"':"")+"]"}else l&8?h+="."+E:l&4&&(h+=" "+E);else h!==""&&!wu(E)&&(n+=lB(o,h),h=""),l=E,o=o||!wu(l);i++}return h!==""&&(n+=lB(o,h)),n}function qZ(t){return t.map(GZ).join(",")}function WZ(t){let n=[],i=[],l=1,h=2;for(;l<t.length;){let o=t[l];if(typeof o=="string")h===2?o!==""&&n.push(o,t[++l]):h===8&&i.push(o);else{if(!wu(h))break;h=o}l++}return i.length&&n.push(1,...i),n}var Ea={};function ZZ(t,n){return t.createText(n)}function XZ(t,n,i){t.setValue(n,i)}function yj(t,n,i){return t.createElement(n,i)}function kE(t,n,i,l,h){t.insertBefore(n,i,l,h)}function xj(t,n,i){t.appendChild(n,i)}function cB(t,n,i,l,h){l!==null?kE(t,n,i,l,h):xj(t,n,i)}function bj(t,n,i,l){t.removeChild(null,n,i,l)}function YZ(t,n,i){t.setAttribute(n,"style",i)}function KZ(t,n,i){i===""?t.removeAttribute(n,"class"):t.setAttribute(n,"class",i)}function wj(t,n,i){let{mergedAttrs:l,classes:h,styles:o}=i;l!==null&&Y9(t,n,l),h!==null&&KZ(t,n,h),o!==null&&YZ(t,n,o)}function eP(t,n,i,l,h,o,E,A,L,Y,le){let te=Go+l,ze=te+h,Ae=JZ(te,ze),Be=typeof Y=="function"?Y():Y;return Ae[vi]={type:t,blueprint:Ae,template:i,queries:null,viewQuery:A,declTNode:n,data:Ae.slice().fill(null,te),bindingStartIndex:te,expandoStartIndex:ze,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof o=="function"?o():o,pipeRegistry:typeof E=="function"?E():E,firstChild:null,schemas:L,consts:Be,incompleteFirstPass:!1,ssrId:le}}function JZ(t,n){let i=[];for(let l=0;l<n;l++)i.push(l<t?null:Ea);return i}function QZ(t){let n=t.tView;return n===null||n.incompleteFirstPass?t.tView=eP(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts,t.id):n}function tP(t,n,i,l,h,o,E,A,L,Y,le){let te=n.blueprint.slice();return te[_u]=h,te[Bi]=l|4|128|8|64|1024,(Y!==null||t&&t[Bi]&2048)&&(te[Bi]|=2048),SM(te),te[Us]=te[Vm]=t,te[hs]=i,te[wd]=E||t&&t[wd],te[Ao]=A||t&&t[Ao],te[vu]=L||t&&t[vu]||null,te[Dc]=o,te[Ox]=dZ(),te[p0]=le,te[bM]=Y,te[Ql]=n.type==2?t[Ql]:te,te}function eX(t,n,i){let l=Mc(n,t),h=QZ(i),o=t[wd].rendererFactory,E=nP(t,tP(t,h,null,Cj(i),l,n,null,o.createRenderer(l,i),null,null,null));return t[n.index]=E}function Cj(t){let n=16;return t.signals?n=4096:t.onPush&&(n=64),n}function Ej(t,n,i,l){if(i===0)return-1;let h=n.length;for(let o=0;o<i;o++)n.push(l),t.blueprint.push(l),t.data.push(null);return h}function nP(t,n){return t[g0]?t[xM][Sc]=n:t[g0]=n,t[xM]=n,n}function ie(t=1){Tj(Ds(),hi(),xu()+t,!1)}function Tj(t,n,i,l){if(!l)if((n[Bi]&3)===3){let o=t.preOrderCheckHooks;o!==null&&CE(n,o,i)}else{let o=t.preOrderHooks;o!==null&&EE(n,o,0,i)}hp(i)}var eT=(function(t){return t[t.None=0]="None",t[t.SignalBased=1]="SignalBased",t[t.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",t})(eT||{});function gA(t,n,i,l){let h=zi(null);try{let[o,E,A]=t.inputs[i],L=null;(E&eT.SignalBased)!==0&&(L=n[o][Ba]),L!==null&&L.transformFn!==void 0?l=L.transformFn(l):A!==null&&(l=A.call(n,l)),t.setInput!==null?t.setInput(n,L,l,i,o):kB(n,L,o,l)}finally{zi(h)}}var Eu=(function(t){return t[t.Important=1]="Important",t[t.DashCase=2]="DashCase",t})(Eu||{}),tX;function iP(t,n){return tX(t,n)}function FE(t){if(!t)return 0;let n=t.toLowerCase().indexOf("ms")>-1?1:1e3;return parseFloat(t)*n}function w0(t,n){return t.getPropertyValue(n).split(",").map(l=>l.trim())}function nX(t){let n=w0(t,"transition-property"),i=w0(t,"transition-duration"),l=w0(t,"transition-delay"),h={propertyName:"",duration:0,animationName:void 0};for(let o=0;o<n.length;o++){let E=FE(l[o])+FE(i[o]);E>h.duration&&(h.propertyName=n[o],h.duration=E)}return h}function iX(t){let n=w0(t,"animation-name"),i=w0(t,"animation-delay"),l=w0(t,"animation-duration"),h={animationName:"",propertyName:void 0,duration:0};for(let o=0;o<n.length;o++){let E=FE(i[o])+FE(l[o]);E>h.duration&&(h.animationName=n[o],h.duration=E)}return h}function Sj(t,n){return t!==void 0&&t.duration>n.duration}function Dj(t){return(t.animationName!=null||t.propertyName!=null)&&t.duration>0}function rX(t,n){let i=getComputedStyle(t),l=iX(i),h=nX(i),o=l.duration>h.duration?l:h;Sj(n.get(t),o)||Dj(o)&&n.set(t,o)}function oX(t,n,i){if(!i)return;let l=t.getAnimations();return l.length===0?rX(t,n):sX(t,n,l)}function sX(t,n,i){let l={animationName:void 0,propertyName:void 0,duration:0};for(let h of i){let o=h.effect?.getTiming(),E=typeof o?.duration=="number"?o.duration:0,A=(o?.delay??0)+E,L,Y;h.animationName?Y=h.animationName:L=h.transitionProperty,A>=l.duration&&(l={animationName:Y,propertyName:L,duration:A})}Sj(n.get(t),l)||Dj(l)&&n.set(t,l)}var Xm=new Set,Ij=new Sn("",{providedIn:"root",factory:()=>!1}),tT=new Sn("",{providedIn:"root",factory:()=>({queue:new Set,isScheduled:!1})});function uB(t,n,i,l){let h=t?.[cp]?.enter;if(n!==null&&h&&h.has(i.index)){let o=l.get(tT);for(let E of h.get(i.index).animateFns)o.queue.add(E)}}function x0(t,n,i,l,h,o,E,A){if(h!=null){let L,Y=!1;yu(h)?L=h:Ed(h)&&(Y=!0,h=h[_u]);let le=Ic(h);t===0&&l!==null?(uB(A,l,o,i),E==null?xj(n,l,le):kE(n,l,le,E||null,!0)):t===1&&l!==null?(uB(A,l,o,i),kE(n,l,le,E||null,!0)):t===2?dB(A,o,i,te=>{bj(n,le,Y,te)}):t===3&&dB(A,o,i,()=>{n.destroyNode(le)}),L!=null&&xX(n,t,i,L,o,l,E)}}function aX(t,n){let i=t.get(tT);if(Array.isArray(n))for(let l of n)i.queue.add(l);else i.queue.add(n)}function lX(t,n){Mj(t,n),n[_u]=null,n[Dc]=null}function cX(t,n,i,l,h,o){l[_u]=h,l[Dc]=n,iT(t,l,i,1,h,o)}function Mj(t,n){n[wd].changeDetectionScheduler?.notify(9),iT(t,n,n[Ao],2,null,null)}function uX(t){let n=t[g0];if(!n)return JM(t[vi],t);for(;n;){let i=null;if(Ed(n))i=n[g0];else{let l=n[Ss];l&&(i=l)}if(!i){for(;n&&!n[Sc]&&n!==t;)Ed(n)&&JM(n[vi],n),n=n[Us];n===null&&(n=t),Ed(n)&&JM(n[vi],n),i=n&&n[Sc]}n=i}}function rP(t,n){let i=t[$m],l=i.indexOf(n);i.splice(l,1)}function nT(t,n){if(Gm(n))return;let i=n[Ao];i.destroyNode&&iT(t,n,i,3,null,null),uX(n)}function JM(t,n){if(Gm(n))return;let i=zi(null);try{n[Bi]&=-129,n[Bi]|=256,n[ec]&&yx(n[ec]),fX(t,n),hX(t,n),n[vi].type===1&&n[Ao].destroy();let l=n[lp];if(l!==null&&yu(n[Us])){l!==n[Us]&&rP(l,n);let h=n[Cd];h!==null&&h.detachView(t)}uA(n)}finally{zi(i)}}function dB(t,n,i,l){let h=t?.[cp];if(h==null||h.leave==null||!h.leave.has(n.index))return l(!1);if(h.skipLeaveAnimations)return h.skipLeaveAnimations=!1,l(!1);t&&Xm.add(t),aX(i,()=>{if(h.leave&&h.leave.has(n.index)){let E=h.leave.get(n.index),A=[];if(E)for(let L=0;L<E.animateFns.length;L++){let Y=E.animateFns[L],{promise:le}=Y();A.push(le)}h.running=Promise.allSettled(A),dX(t,l)}else t&&Xm.delete(t),l(!1)})}function dX(t,n){let i=t[cp]?.running;if(i){i.then(()=>{t[cp].running=void 0,Xm.delete(t),n(!0)});return}n(!1)}function hX(t,n){let i=t.cleanup,l=n[m0];if(i!==null)for(let E=0;E<i.length-1;E+=2)if(typeof i[E]=="string"){let A=i[E+3];A>=0?l[A]():l[-A].unsubscribe(),E+=2}else{let A=l[i[E+1]];i[E].call(A)}l!==null&&(n[m0]=null);let h=n[Ph];if(h!==null){n[Ph]=null;for(let E=0;E<h.length;E++){let A=h[E];A()}}let o=n[Rx];if(o!==null){n[Rx]=null;for(let E of o)E.destroy()}}function fX(t,n){let i;if(t!=null&&(i=t.destroyHooks)!=null)for(let l=0;l<i.length;l+=2){let h=n[i[l]];if(!(h instanceof Zm)){let o=i[l+1];if(Array.isArray(o))for(let E=0;E<o.length;E+=2){let A=h[o[E]],L=o[E+1];ro(4,A,L);try{L.call(A)}finally{ro(5,A,L)}}else{ro(4,h,o);try{o.call(h)}finally{ro(5,h,o)}}}}}function pX(t,n,i){return mX(t,n.parent,i)}function mX(t,n,i){let l=n;for(;l!==null&&l.type&168;)n=l,l=n.parent;if(l===null)return i[_u];if(dp(l)){let{encapsulation:h}=t.data[l.directiveStart+l.componentOffset];if(h===Lh.None||h===Lh.Emulated)return null}return Mc(l,i)}function gX(t,n,i){return vX(t,n,i)}function _X(t,n,i){return t.type&40?Mc(t,i):null}var vX=_X,hB;function oP(t,n,i,l){let h=pX(t,l,n),o=n[Ao],E=l.parent||n[Dc],A=gX(E,l,n);if(h!=null)if(Array.isArray(i))for(let L=0;L<i.length;L++)cB(o,h,i[L],A,!1);else cB(o,h,i,A,!1);hB!==void 0&&hB(o,l,n,i,h)}function Ux(t,n){if(n!==null){let i=n.type;if(i&3)return Mc(n,t);if(i&4)return _A(-1,t[n.index]);if(i&8){let l=n.child;if(l!==null)return Ux(t,l);{let h=t[n.index];return yu(h)?_A(-1,h):Ic(h)}}else{if(i&128)return Ux(t,n.next);if(i&32)return iP(n,t)()||Ic(t[n.index]);{let l=Aj(t,n);if(l!==null){if(Array.isArray(l))return l[0];let h=sp(t[Ql]);return Ux(h,l)}else return Ux(t,n.next)}}}return null}function Aj(t,n){if(n!==null){let l=t[Ql][Dc],h=n.projection;return l.projection[h]}return null}function _A(t,n){let i=Ss+t+1;if(i<n.length){let l=n[i],h=l[vi].firstChild;if(h!==null)return Ux(l,h)}return n[up]}function sP(t,n,i,l,h,o,E){for(;i!=null;){let A=l[vu];if(i.type===128){i=i.next;continue}let L=l[i.index],Y=i.type;if(E&&n===0&&(L&&T0(Ic(L),l),i.flags|=2),!ZA(i))if(Y&8)sP(t,n,i.child,l,h,o,!1),x0(n,t,A,h,L,i,o,l);else if(Y&32){let le=iP(i,l),te;for(;te=le();)x0(n,t,A,h,te,i,o,l);x0(n,t,A,h,L,i,o,l)}else Y&16?yX(t,n,l,i,h,o):x0(n,t,A,h,L,i,o,l);i=E?i.projectionNext:i.next}}function iT(t,n,i,l,h,o){sP(i,l,t.firstChild,n,h,o,!1)}function yX(t,n,i,l,h,o){let E=i[Ql],L=E[Dc].projection[l.projection];if(Array.isArray(L))for(let Y=0;Y<L.length;Y++){let le=L[Y];x0(n,t,i[vu],h,le,l,o,i)}else{let Y=L,le=E[Us];YB(l)&&(Y.flags|=128),sP(t,n,Y,le,h,o,!0)}}function xX(t,n,i,l,h,o,E){let A=l[up],L=Ic(l);A!==L&&x0(n,t,i,o,A,h,E);for(let Y=Ss;Y<l.length;Y++){let le=l[Y];iT(le[vi],le,t,n,o,A)}}function bX(t,n,i,l,h){if(n)h?t.addClass(i,l):t.removeClass(i,l);else{let o=l.indexOf("-")===-1?void 0:Eu.DashCase;h==null?t.removeStyle(i,l,o):(typeof h=="string"&&h.endsWith("!important")&&(h=h.slice(0,-10),o|=Eu.Important),t.setStyle(i,l,h,o))}}function Pj(t,n,i,l,h){let o=xu(),E=l&2;try{hp(-1),E&&n.length>Go&&Tj(t,n,Go,!1),ro(E?2:0,h,i),i(l,h)}finally{hp(o),ro(E?3:1,h,i)}}function aP(t,n,i){IX(t,n,i),(i.flags&64)===64&&MX(t,n,i)}function rT(t,n,i=Mc){let l=n.localNames;if(l!==null){let h=n.index+1;for(let o=0;o<l.length;o+=2){let E=l[o+1],A=E===-1?i(n,t):t[E];t[h++]=A}}}function wX(t,n,i,l){let o=l.get(rj,ij)||i===Lh.ShadowDom,E=t.selectRootElement(n,o);return CX(E),E}function CX(t){EX(t)}var EX=()=>null;function TX(t){return t==="class"?"className":t==="for"?"htmlFor":t==="formaction"?"formAction":t==="innerHtml"?"innerHTML":t==="readonly"?"readOnly":t==="tabindex"?"tabIndex":t}function Oj(t,n,i,l,h,o){let E=n[vi];if(lP(t,E,n,i,l)){dp(t)&&DX(n,t.index);return}t.type&3&&(i=TX(i)),SX(t,n,i,l,h,o)}function SX(t,n,i,l,h,o){if(t.type&3){let E=Mc(t,n);l=o!=null?o(l,t.value||"",i):l,h.setProperty(E,i,l)}else t.type&12}function DX(t,n){let i=Ac(n,t);i[Bi]&16||(i[Bi]|=64)}function IX(t,n,i){let l=i.directiveStart,h=i.directiveEnd;dp(i)&&eX(n,i,t.data[l+i.componentOffset]),t.firstCreatePass||PE(i,n);let o=i.initialInputs;for(let E=l;E<h;E++){let A=t.data[E],L=Wx(n,t,E,i);if(T0(L,n),o!==null&&RX(n,E-l,L,A,i,o),Td(A)){let Y=Ac(i.index,n);Y[hs]=Wx(n,t,E,i)}}}function MX(t,n,i){let l=i.directiveStart,h=i.directiveEnd,o=i.index,E=jz();try{hp(o);for(let A=l;A<h;A++){let L=t.data[A],Y=n[A];cE(A),(L.hostBindings!==null||L.hostVars!==0||L.hostAttrs!==null)&&AX(L,Y)}}finally{hp(-1),cE(E)}}function AX(t,n){t.hostBindings!==null&&t.hostBindings(1,n)}function Rj(t,n){let i=t.directiveRegistry,l=null;if(i)for(let h=0;h<i.length;h++){let o=i[h];UZ(n,o.selectors,!1)&&(l??=[],Td(o)?l.unshift(o):l.push(o))}return l}function PX(t,n,i,l,h,o){let E=Mc(t,n);OX(n[Ao],E,o,t.value,i,l,h)}function OX(t,n,i,l,h,o,E){if(o==null)t.removeAttribute(n,h,i);else{let A=E==null?gu(o):E(o,l||"",h);t.setAttribute(n,h,A,i)}}function RX(t,n,i,l,h,o){let E=o[n];if(E!==null)for(let A=0;A<E.length;A+=2){let L=E[A],Y=E[A+1];gA(l,i,L,Y)}}function kj(t,n,i,l,h){let o=Go+i,E=n[vi],A=h(E,n,t,l,i);n[o]=A,y0(t,!0);let L=t.type===2;return L?(wj(n[Ao],A,t),(Pz()===0||Fx(t))&&T0(A,n),Oz()):T0(A,n),pE()&&(!L||!ZA(t))&&oP(E,n,A,t),t}function Fj(t){let n=t;return LM()?Fz():(n=n.parent,y0(n,!1)),n}function kX(t,n){let i=t[vu];if(!i)return;let l;try{l=i.get(pl,null)}catch{l=null}l?.(n)}function lP(t,n,i,l,h){let o=t.inputs?.[l],E=t.hostDirectiveInputs?.[l],A=!1;if(E)for(let L=0;L<E.length;L+=2){let Y=E[L],le=E[L+1],te=n.data[Y];gA(te,i[Y],le,h),A=!0}if(o)for(let L of o){let Y=i[L],le=n.data[L];gA(le,Y,l,h),A=!0}return A}function FX(t,n){let i=Ac(n,t),l=i[vi];LX(l,i);let h=i[_u];h!==null&&i[p0]===null&&(i[p0]=oj(h,i[vu])),ro(18),cP(l,i,i[hs]),ro(19,i[hs])}function LX(t,n){for(let i=n.length;i<t.blueprint.length;i++)n.push(t.blueprint[i])}function cP(t,n,i){dE(n);try{let l=t.viewQuery;l!==null&&hA(1,l,i);let h=t.template;h!==null&&Pj(t,n,h,1,i),t.firstCreatePass&&(t.firstCreatePass=!1),n[Cd]?.finishViewCreation(t),t.staticContentQueries&&sj(t,n),t.staticViewQueries&&hA(2,t.viewQuery,i);let o=t.components;o!==null&&NX(n,o)}catch(l){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),l}finally{n[Bi]&=-5,hE()}}function NX(t,n){for(let i=0;i<n.length;i++)FX(t,n[i])}function oT(t,n,i,l){let h=zi(null);try{let o=n.tView,A=t[Bi]&4096?4096:16,L=tP(t,o,i,A,null,n,null,null,l?.injector??null,l?.embeddedViewInjector??null,l?.dehydratedView??null),Y=t[n.index];L[lp]=Y;let le=t[Cd];return le!==null&&(L[Cd]=le.createEmbeddedView(o)),cP(o,L,i),L}finally{zi(h)}}function Zx(t,n){return!n||n.firstChild===null||YB(t)}function Xx(t,n,i,l,h=!1){for(;i!==null;){if(i.type===128){i=h?i.projectionNext:i.next;continue}let o=n[i.index];o!==null&&l.push(Ic(o)),yu(o)&&Lj(o,l);let E=i.type;if(E&8)Xx(t,n,i.child,l);else if(E&32){let A=iP(i,n),L;for(;L=A();)l.push(L)}else if(E&16){let A=Aj(n,i);if(Array.isArray(A))l.push(...A);else{let L=sp(n[Ql]);Xx(L[vi],L,A,l,!0)}}i=h?i.projectionNext:i.next}return l}function Lj(t,n){for(let i=Ss;i<t.length;i++){let l=t[i],h=l[vi].firstChild;h!==null&&Xx(l[vi],l,h,n)}t[up]!==t[_u]&&n.push(t[up])}function Nj(t){if(t[Hm]!==null){for(let n of t[Hm])n.impl.addSequence(n);t[Hm].length=0}}var zj=[];function zX(t){return t[ec]??BX(t)}function BX(t){let n=zj.pop()??Object.create(VX);return n.lView=t,n}function jX(t){t.lView[ec]!==t&&(t.lView=null,zj.push(t))}var VX=Mi(Jt({},X_),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:t=>{v0(t.lView)},consumerOnSignalRead(){this.lView[ec]=this}});function UX(t){let n=t[ec]??Object.create(HX);return n.lView=t,n}var HX=Mi(Jt({},X_),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:t=>{let n=sp(t.lView);for(;n&&!Bj(n[vi]);)n=sp(n);n&&DM(n)},consumerOnSignalRead(){this.lView[ec]=this}});function Bj(t){return t.type!==2}function jj(t){if(t[Rx]===null)return;let n=!0;for(;n;){let i=!1;for(let l of t[Rx])l.dirty&&(i=!0,l.zone===null||Zone.current===l.zone?l.run():l.zone.run(()=>l.run()));n=i&&!!(t[Bi]&8192)}}var $X=100;function Vj(t,n=0){let l=t[wd].rendererFactory,h=!1;h||l.begin?.();try{GX(t,n)}finally{h||l.end?.()}}function GX(t,n){let i=NM();try{zM(!0),vA(t,n);let l=0;for(;zx(t);){if(l===$X)throw new bn(103,!1);l++,vA(t,1)}}finally{zM(i)}}function qX(t,n,i,l){if(Gm(n))return;let h=n[Bi],o=!1,E=!1;dE(n);let A=!0,L=null,Y=null;o||(Bj(t)?(Y=zX(n),L=K_(Y)):_C()===null?(A=!1,Y=UX(n),L=K_(Y)):n[ec]&&(yx(n[ec]),n[ec]=null));try{SM(n),Nz(t.bindingStartIndex),i!==null&&Pj(t,n,i,2,l);let le=(h&3)===3;if(!o)if(le){let Ae=t.preOrderCheckHooks;Ae!==null&&CE(n,Ae,null)}else{let Ae=t.preOrderHooks;Ae!==null&&EE(n,Ae,0,null),YM(n,0)}if(E||WX(n),jj(n),Uj(n,0),t.contentQueries!==null&&sj(t,n),!o)if(le){let Ae=t.contentCheckHooks;Ae!==null&&CE(n,Ae)}else{let Ae=t.contentHooks;Ae!==null&&EE(n,Ae,1),YM(n,1)}XX(t,n);let te=t.components;te!==null&&$j(n,te,0);let ze=t.viewQuery;if(ze!==null&&hA(2,ze,l),!o)if(le){let Ae=t.viewCheckHooks;Ae!==null&&CE(n,Ae)}else{let Ae=t.viewHooks;Ae!==null&&EE(n,Ae,2),YM(n,2)}if(t.firstUpdatePass===!0&&(t.firstUpdatePass=!1),n[sE]){for(let Ae of n[sE])Ae();n[sE]=null}o||(Nj(n),n[Bi]&=-73)}catch(le){throw o||v0(n),le}finally{Y!==null&&(_x(Y,L),A&&jX(Y)),hE()}}function Uj(t,n){for(let i=JB(t);i!==null;i=QB(i))for(let l=Ss;l<i.length;l++){let h=i[l];Hj(h,n)}}function WX(t){for(let n=JB(t);n!==null;n=QB(n)){if(!(n[Bi]&2))continue;let i=n[$m];for(let l=0;l<i.length;l++){let h=i[l];DM(h)}}}function ZX(t,n,i){ro(18);let l=Ac(n,t);Hj(l,i),ro(19,l[hs])}function Hj(t,n){aE(t)&&vA(t,n)}function vA(t,n){let l=t[vi],h=t[Bi],o=t[ec],E=!!(n===0&&h&16);if(E||=!!(h&64&&n===0),E||=!!(h&1024),E||=!!(o?.dirty&&vx(o)),E||=!1,o&&(o.dirty=!1),t[Bi]&=-9217,E)qX(l,t,l.template,t[hs]);else if(h&8192){let A=zi(null);try{jj(t),Uj(t,1);let L=l.components;L!==null&&$j(t,L,1),Nj(t)}finally{zi(A)}}}function $j(t,n,i){for(let l=0;l<n.length;l++)ZX(t,n[l],i)}function XX(t,n){let i=t.hostBindingOpCodes;if(i!==null)try{for(let l=0;l<i.length;l++){let h=i[l];if(h<0)hp(~h);else{let o=h,E=i[++l],A=i[++l];Bz(E,o);let L=n[o];ro(24,L),A(2,L),ro(25,L)}}}finally{hp(-1)}}function uP(t,n){let i=NM()?64:1088;for(t[wd].changeDetectionScheduler?.notify(n);t;){t[Bi]|=i;let l=sp(t);if(_0(t)&&!l)return t;t=l}return null}function Gj(t,n,i,l){return[t,!0,0,n,null,l,null,i,null,null]}function qj(t,n){let i=Ss+n;if(i<t.length)return t[i]}function sT(t,n,i,l=!0){let h=n[vi];if(YX(h,n,t,i),l){let E=_A(i,t),A=n[Ao],L=A.parentNode(t[up]);L!==null&&cX(h,t[Dc],A,n,L,E)}let o=n[p0];o!==null&&o.firstChild!==null&&(o.firstChild=null)}function Wj(t,n){let i=Yx(t,n);return i!==void 0&&nT(i[vi],i),i}function Yx(t,n){if(t.length<=Ss)return;let i=Ss+n,l=t[i];if(l){let h=l[lp];h!==null&&h!==t&&rP(h,l),n>0&&(t[i-1][Sc]=l[Sc]);let o=Mx(t,Ss+n);lX(l[vi],l);let E=o[Cd];E!==null&&E.detachView(o[vi]),l[Us]=null,l[Sc]=null,l[Bi]&=-129}return l}function YX(t,n,i,l){let h=Ss+l,o=i.length;l>0&&(i[h-1][Sc]=n),l<o-Ss?(n[Sc]=i[h],hM(i,Ss+l,n)):(i.push(n),n[Sc]=null),n[Us]=i;let E=n[lp];E!==null&&i!==E&&Zj(E,n);let A=n[Cd];A!==null&&A.insertView(t),lE(n),n[Bi]|=128}function Zj(t,n){let i=t[$m],l=n[Us];if(Ed(l))t[Bi]|=2;else{let h=l[Us][Ql];n[Ql]!==h&&(t[Bi]|=2)}i===null?t[$m]=[n]:i.push(n)}var fp=class{_lView;_cdRefInjectingView;_appRef=null;_attachedToViewContainer=!1;exhaustive;get rootNodes(){let n=this._lView,i=n[vi];return Xx(i,n,i.firstChild,[])}constructor(n,i){this._lView=n,this._cdRefInjectingView=i}get context(){return this._lView[hs]}set context(n){this._lView[hs]=n}get destroyed(){return Gm(this._lView)}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let n=this._lView[Us];if(yu(n)){let i=n[kx],l=i?i.indexOf(this):-1;l>-1&&(Yx(n,l),Mx(i,l))}this._attachedToViewContainer=!1}nT(this._lView[vi],this._lView)}onDestroy(n){IM(this._lView,n)}markForCheck(){uP(this._cdRefInjectingView||this._lView,4)}detach(){this._lView[Bi]&=-129}reattach(){lE(this._lView),this._lView[Bi]|=128}detectChanges(){this._lView[Bi]|=1024,Vj(this._lView)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new bn(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;let n=_0(this._lView),i=this._lView[lp];i!==null&&!n&&rP(i,this._lView),Mj(this._lView[vi],this._lView)}attachToAppRef(n){if(this._attachedToViewContainer)throw new bn(902,!1);this._appRef=n;let i=_0(this._lView),l=this._lView[lp];l!==null&&!i&&Zj(l,this._lView),lE(this._lView)}};var S0=(()=>{class t{_declarationLView;_declarationTContainer;elementRef;static __NG_ELEMENT_ID__=KX;constructor(i,l,h){this._declarationLView=i,this._declarationTContainer=l,this.elementRef=h}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(i,l){return this.createEmbeddedViewImpl(i,l)}createEmbeddedViewImpl(i,l,h){let o=oT(this._declarationLView,this._declarationTContainer,i,{embeddedViewInjector:l,dehydratedView:h});return new fp(o)}}return t})();function KX(){return aT(na(),hi())}function aT(t,n){return t.type&4?new S0(n,t,I0(t,n)):null}function ob(t,n,i,l,h){let o=t.data[n];if(o===null)o=JX(t,n,i,l,h),zz()&&(o.flags|=32);else if(o.type&64){o.type=i,o.value=l,o.attrs=h;let E=kz();o.injectorIndex=E===null?-1:E.injectorIndex}return y0(o,!0),o}function JX(t,n,i,l,h){let o=FM(),E=LM(),A=E?o:o&&o.parent,L=t.data[n]=eY(t,A,i,n,l,h);return QX(t,L,o,E),L}function QX(t,n,i,l){t.firstChild===null&&(t.firstChild=n),i!==null&&(l?i.child==null&&n.parent!==null&&(i.child=n):i.next===null&&(i.next=n,n.prev=i))}function eY(t,n,i,l,h,o){let E=n?n.injectorIndex:-1,A=0;return Rz()&&(A|=128),{type:i,index:l,insertBeforeIndex:null,injectorIndex:E,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:A,providerIndexes:0,value:h,attrs:o,mergedAttrs:null,localNames:null,initialInputs:null,inputs:null,hostDirectiveInputs:null,outputs:null,hostDirectiveOutputs:null,directiveToIndex:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:n,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}var q0e=new RegExp(`^(\\d+)*(${mZ}|${pZ})*(.*)`);function tY(t){let n=t[wM]??[],l=t[Us][Ao],h=[];for(let o of n)o.data[nj]!==void 0?h.push(o):nY(o,l);t[wM]=h}function nY(t,n){let i=0,l=t.firstChild;if(l){let h=t.data[tj];for(;i<h;){let o=l.nextSibling;bj(n,l,!1),l=o,i++}}}var iY=()=>null,rY=()=>null;function yA(t,n){return iY(t,n)}function Xj(t,n,i){return rY(t,n,i)}var Yj=class{},lT=class{},xA=class{resolveComponentFactory(n){throw new bn(917,!1)}},sb=class{static NULL=new xA},Ym=class{},ia=(()=>{class t{destroyNode=null;static __NG_ELEMENT_ID__=()=>oY()}return t})();function oY(){let t=hi(),n=na(),i=Ac(n.index,t);return(Ed(i)?i:t)[Ao]}var Kj=(()=>{class t{static \u0275prov=Qt({token:t,providedIn:"root",factory:()=>null})}return t})();var SE={},bA=class{injector;parentInjector;constructor(n,i){this.injector=n,this.parentInjector=i}get(n,i,l){let h=this.injector.get(n,SE,l);return h!==SE||i===SE?h:this.parentInjector.get(n,i,l)}};function LE(t,n,i){let l=i?t.styles:null,h=i?t.classes:null,o=0;if(n!==null)for(let E=0;E<n.length;E++){let A=n[E];if(typeof A=="number")o=A;else if(o==1)h=QC(h,A);else if(o==2){let L=A,Y=n[++E];l=QC(l,L+": "+Y+";")}}i?t.styles=l:t.stylesWithoutHost=l,i?t.classes=h:t.classesWithoutHost=h}function wt(t,n=0){let i=hi();if(i===null)return gn(t,n);let l=na();return WB(l,i,xa(t),n)}function dP(){let t="invalid";throw new Error(t)}function Jj(t,n,i,l,h){let o=l===null?null:{"":-1},E=h(t,i);if(E!==null){let A=E,L=null,Y=null;for(let le of E)if(le.resolveHostDirectives!==null){[A,L,Y]=le.resolveHostDirectives(E);break}lY(t,n,i,A,o,L,Y)}o!==null&&l!==null&&sY(i,l,o)}function sY(t,n,i){let l=t.localNames=[];for(let h=0;h<n.length;h+=2){let o=i[n[h+1]];if(o==null)throw new bn(-301,!1);l.push(n[h],o)}}function aY(t,n,i){n.componentOffset=i,(t.components??=[]).push(n.index)}function lY(t,n,i,l,h,o,E){let A=l.length,L=!1;for(let ze=0;ze<A;ze++){let Ae=l[ze];!L&&Td(Ae)&&(L=!0,aY(t,i,ze)),lA(PE(i,n),t,Ae.type)}pY(i,t.data.length,A);for(let ze=0;ze<A;ze++){let Ae=l[ze];Ae.providersResolver&&Ae.providersResolver(Ae)}let Y=!1,le=!1,te=Ej(t,n,A,null);A>0&&(i.directiveToIndex=new Map);for(let ze=0;ze<A;ze++){let Ae=l[ze];if(i.mergedAttrs=E0(i.mergedAttrs,Ae.hostAttrs),uY(t,i,n,te,Ae),fY(te,Ae,h),E!==null&&E.has(Ae)){let[Tt,ot]=E.get(Ae);i.directiveToIndex.set(Ae.type,[te,Tt+i.directiveStart,ot+i.directiveStart])}else(o===null||!o.has(Ae))&&i.directiveToIndex.set(Ae.type,te);Ae.contentQueries!==null&&(i.flags|=4),(Ae.hostBindings!==null||Ae.hostAttrs!==null||Ae.hostVars!==0)&&(i.flags|=64);let Be=Ae.type.prototype;!Y&&(Be.ngOnChanges||Be.ngOnInit||Be.ngDoCheck)&&((t.preOrderHooks??=[]).push(i.index),Y=!0),!le&&(Be.ngOnChanges||Be.ngDoCheck)&&((t.preOrderCheckHooks??=[]).push(i.index),le=!0),te++}cY(t,i,o)}function cY(t,n,i){for(let l=n.directiveStart;l<n.directiveEnd;l++){let h=t.data[l];if(i===null||!i.has(h))fB(0,n,h,l),fB(1,n,h,l),mB(n,l,!1);else{let o=i.get(h);pB(0,n,o,l),pB(1,n,o,l),mB(n,l,!0)}}}function fB(t,n,i,l){let h=t===0?i.inputs:i.outputs;for(let o in h)if(h.hasOwnProperty(o)){let E;t===0?E=n.inputs??={}:E=n.outputs??={},E[o]??=[],E[o].push(l),Qj(n,o)}}function pB(t,n,i,l){let h=t===0?i.inputs:i.outputs;for(let o in h)if(h.hasOwnProperty(o)){let E=h[o],A;t===0?A=n.hostDirectiveInputs??={}:A=n.hostDirectiveOutputs??={},A[E]??=[],A[E].push(l,o),Qj(n,E)}}function Qj(t,n){n==="class"?t.flags|=8:n==="style"&&(t.flags|=16)}function mB(t,n,i){let{attrs:l,inputs:h,hostDirectiveInputs:o}=t;if(l===null||!i&&h===null||i&&o===null||QA(t)){t.initialInputs??=[],t.initialInputs.push(null);return}let E=null,A=0;for(;A<l.length;){let L=l[A];if(L===0){A+=4;continue}else if(L===5){A+=2;continue}else if(typeof L=="number")break;if(!i&&h.hasOwnProperty(L)){let Y=h[L];for(let le of Y)if(le===n){E??=[],E.push(L,l[A+1]);break}}else if(i&&o.hasOwnProperty(L)){let Y=o[L];for(let le=0;le<Y.length;le+=2)if(Y[le]===n){E??=[],E.push(Y[le+1],l[A+1]);break}}A+=2}t.initialInputs??=[],t.initialInputs.push(E)}function uY(t,n,i,l,h){t.data[l]=h;let o=h.factory||(h.factory=op(h.type,!0)),E=new Zm(o,Td(h),wt,null);t.blueprint[l]=E,i[l]=E,dY(t,n,l,Ej(t,i,h.hostVars,Ea),h)}function dY(t,n,i,l,h){let o=h.hostBindings;if(o){let E=t.hostBindingOpCodes;E===null&&(E=t.hostBindingOpCodes=[]);let A=~n.index;hY(E)!=A&&E.push(A),E.push(i,l,o)}}function hY(t){let n=t.length;for(;n>0;){let i=t[--n];if(typeof i=="number"&&i<0)return i}return 0}function fY(t,n,i){if(i){if(n.exportAs)for(let l=0;l<n.exportAs.length;l++)i[n.exportAs[l]]=t;Td(n)&&(i[""]=t)}}function pY(t,n,i){t.flags|=1,t.directiveStart=n,t.directiveEnd=n+i,t.providerIndexes=n}function eV(t,n,i,l,h,o,E,A){let L=n[vi],Y=L.consts,le=Pc(Y,E),te=ob(L,t,i,l,le);return o&&Jj(L,n,te,Pc(Y,A),h),te.mergedAttrs=E0(te.mergedAttrs,te.attrs),te.attrs!==null&&LE(te,te.attrs,!1),te.mergedAttrs!==null&&LE(te,te.mergedAttrs,!0),L.queries!==null&&L.queries.elementStart(L,te),te}function tV(t,n){zB(t,n),CM(n)&&t.queries.elementEnd(n)}function mY(t,n,i,l,h,o){let E=n.consts,A=Pc(E,h),L=ob(n,t,i,l,A);if(L.mergedAttrs=E0(L.mergedAttrs,L.attrs),o!=null){let Y=Pc(E,o);L.localNames=[];for(let le=0;le<Y.length;le+=2)L.localNames.push(Y[le],-1)}return L.attrs!==null&&LE(L,L.attrs,!1),L.mergedAttrs!==null&&LE(L,L.mergedAttrs,!0),n.queries!==null&&n.queries.elementStart(n,L),L}function hP(t){return t!==null&&(typeof t=="function"||typeof t=="object")}function A0(t,n,i){return t[n]=i}function gY(t,n){return t[n]}function nc(t,n,i){if(i===Ea)return!1;let l=t[n];return Object.is(l,i)?!1:(t[n]=i,!0)}function Kx(t,n,i,l){let h=nc(t,n,i);return nc(t,n+1,l)||h}function nV(t,n,i,l,h){let o=Kx(t,n,i,l);return nc(t,n+2,h)||o}function _Y(t,n,i,l,h,o){let E=Kx(t,n,i,l);return Kx(t,n+2,h,o)||E}function QM(t,n,i){return function l(h){let o=dp(t)?Ac(t.index,n):n;uP(o,5);let E=n[hs],A=gB(n,E,i,h),L=l.__ngNextListenerFn__;for(;L;)A=gB(n,E,L,h)&&A,L=L.__ngNextListenerFn__;return A}}function gB(t,n,i,l){let h=zi(null);try{return ro(6,n,i),i(l)!==!1}catch(o){return kX(t,o),!1}finally{ro(7,n,i),zi(h)}}function vY(t,n,i,l,h,o,E,A){let L=Fx(t),Y=!1,le=null;if(!l&&L&&(le=xY(n,i,o,t.index)),le!==null){let te=le.__ngLastListenerFn__||le;te.__ngNextListenerFn__=E,le.__ngLastListenerFn__=E,Y=!0}else{let te=Mc(t,i),ze=l?l(te):te;_Z(i,ze,o,A);let Ae=h.listen(ze,o,A);if(!yY(o)){let Be=l?Tt=>l(Ic(Tt[t.index])):t.index;iV(Be,n,i,o,A,Ae,!1)}}return Y}function yY(t){return t.startsWith("animation")||t.startsWith("transition")}function xY(t,n,i,l){let h=t.cleanup;if(h!=null)for(let o=0;o<h.length-1;o+=2){let E=h[o];if(E===i&&h[o+1]===l){let A=n[m0],L=h[o+2];return A&&A.length>L?A[L]:null}typeof E=="string"&&(o+=2)}return null}function iV(t,n,i,l,h,o,E){let A=n.firstCreatePass?AM(n):null,L=MM(i),Y=L.length;L.push(h,o),A&&A.push(l,t,Y,(Y+1)*(E?-1:1))}function _B(t,n,i,l,h,o){let E=n[i],A=n[vi],Y=A.data[i].outputs[l],te=E[Y].subscribe(o);iV(t.index,A,n,h,o,te,!0)}var wA=Symbol("BINDING");var NE=class extends sb{ngModule;constructor(n){super(),this.ngModule=n}resolveComponentFactory(n){let i=Fh(n);return new Km(i,this.ngModule)}};function bY(t){return Object.keys(t).map(n=>{let[i,l,h]=t[n],o={propName:i,templateName:n,isSignal:(l&eT.SignalBased)!==0};return h&&(o.transform=h),o})}function wY(t){return Object.keys(t).map(n=>({propName:t[n],templateName:n}))}function CY(t,n,i){let l=n instanceof ds?n:n?.injector;return l&&t.getStandaloneInjector!==null&&(l=t.getStandaloneInjector(l)||l),l?new bA(i,l):i}function EY(t){let n=t.get(Ym,null);if(n===null)throw new bn(407,!1);let i=t.get(Kj,null),l=t.get(Rh,null);return{rendererFactory:n,sanitizer:i,changeDetectionScheduler:l,ngReflect:!1}}function TY(t,n){let i=rV(t);return yj(n,i,i==="svg"?Ez:i==="math"?Tz:null)}function rV(t){return(t.selectors[0][0]||"div").toLowerCase()}var Km=class extends lT{componentDef;ngModule;selector;componentType;ngContentSelectors;isBoundToModule;cachedInputs=null;cachedOutputs=null;get inputs(){return this.cachedInputs??=bY(this.componentDef.inputs),this.cachedInputs}get outputs(){return this.cachedOutputs??=wY(this.componentDef.outputs),this.cachedOutputs}constructor(n,i){super(),this.componentDef=n,this.ngModule=i,this.componentType=n.type,this.selector=qZ(n.selectors),this.ngContentSelectors=n.ngContentSelectors??[],this.isBoundToModule=!!i}create(n,i,l,h,o,E){ro(22);let A=zi(null);try{let L=this.componentDef,Y=SY(l,L,E,o),le=CY(L,h||this.ngModule,n),te=EY(le),ze=te.rendererFactory.createRenderer(null,L),Ae=l?wX(ze,l,L.encapsulation,le):TY(L,ze),Be=E?.some(vB)||o?.some(kt=>typeof kt!="function"&&kt.bindings.some(vB)),Tt=tP(null,Y,null,512|Cj(L),null,null,te,ze,le,null,oj(Ae,le,!0));Tt[Go]=Ae,dE(Tt);let ot=null;try{let kt=eV(Go,Tt,2,"#host",()=>Y.directiveRegistry,!0,0);wj(ze,Ae,kt),T0(Ae,Tt),aP(Y,Tt,kt),aj(Y,kt,Tt),tV(Y,kt),i!==void 0&&IY(kt,this.ngContentSelectors,i),ot=Ac(kt.index,Tt),Tt[hs]=ot[hs],cP(Y,Tt,null)}catch(kt){throw ot!==null&&uA(ot),uA(Tt),kt}finally{ro(23),hE()}return new zE(this.componentType,Tt,!!Be)}finally{zi(A)}}};function SY(t,n,i,l){let h=t?["ng-version","20.3.5"]:WZ(n.selectors[0]),o=null,E=null,A=0;if(i)for(let le of i)A+=le[wA].requiredVars,le.create&&(le.targetIdx=0,(o??=[]).push(le)),le.update&&(le.targetIdx=0,(E??=[]).push(le));if(l)for(let le=0;le<l.length;le++){let te=l[le];if(typeof te!="function")for(let ze of te.bindings){A+=ze[wA].requiredVars;let Ae=le+1;ze.create&&(ze.targetIdx=Ae,(o??=[]).push(ze)),ze.update&&(ze.targetIdx=Ae,(E??=[]).push(ze))}}let L=[n];if(l)for(let le of l){let te=typeof le=="function"?le:le.type,ze=gM(te);L.push(ze)}return eP(0,null,DY(o,E),1,A,L,null,null,null,[h],null)}function DY(t,n){return!t&&!n?null:i=>{if(i&1&&t)for(let l of t)l.create();if(i&2&&n)for(let l of n)l.update()}}function vB(t){let n=t[wA].kind;return n==="input"||n==="twoWay"}var zE=class extends Yj{_rootLView;_hasInputBindings;instance;hostView;changeDetectorRef;componentType;location;previousInputValues=null;_tNode;constructor(n,i,l){super(),this._rootLView=i,this._hasInputBindings=l,this._tNode=Lx(i[vi],Go),this.location=I0(this._tNode,i),this.instance=Ac(this._tNode.index,i)[hs],this.hostView=this.changeDetectorRef=new fp(i,void 0),this.componentType=n}setInput(n,i){this._hasInputBindings;let l=this._tNode;if(this.previousInputValues??=new Map,this.previousInputValues.has(n)&&Object.is(this.previousInputValues.get(n),i))return;let h=this._rootLView,o=lP(l,h[vi],h,n,i);this.previousInputValues.set(n,i);let E=Ac(l.index,h);uP(E,1)}get injector(){return new Wm(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(n){this.hostView.onDestroy(n)}};function IY(t,n,i){let l=t.projection=[];for(let h=0;h<n.length;h++){let o=i[h];l.push(o!=null&&o.length?Array.from(o):null)}}var Oc=(()=>{class t{static __NG_ELEMENT_ID__=MY}return t})();function MY(){let t=na();return sV(t,hi())}var AY=Oc,oV=class extends AY{_lContainer;_hostTNode;_hostLView;constructor(n,i,l){super(),this._lContainer=n,this._hostTNode=i,this._hostLView=l}get element(){return I0(this._hostTNode,this._hostLView)}get injector(){return new Wm(this._hostTNode,this._hostLView)}get parentInjector(){let n=HA(this._hostTNode,this._hostLView);if(VB(n)){let i=ME(n,this._hostLView),l=IE(n),h=i[vi].data[l+8];return new Wm(h,i)}else return new Wm(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(n){let i=yB(this._lContainer);return i!==null&&i[n]||null}get length(){return this._lContainer.length-Ss}createEmbeddedView(n,i,l){let h,o;typeof l=="number"?h=l:l!=null&&(h=l.index,o=l.injector);let E=yA(this._lContainer,n.ssrId),A=n.createEmbeddedViewImpl(i||{},o,E);return this.insertImpl(A,h,Zx(this._hostTNode,E)),A}createComponent(n,i,l,h,o,E,A){let L=n&&!U9(n),Y;if(L)Y=i;else{let ot=i||{};Y=ot.index,l=ot.injector,h=ot.projectableNodes,o=ot.environmentInjector||ot.ngModuleRef,E=ot.directives,A=ot.bindings}let le=L?n:new Km(Fh(n)),te=l||this.parentInjector;if(!o&&le.ngModule==null){let kt=(L?te:this.parentInjector).get(ds,null);kt&&(o=kt)}let ze=Fh(le.componentType??{}),Ae=yA(this._lContainer,ze?.id??null),Be=Ae?.firstChild??null,Tt=le.create(te,h,Be,o,E,A);return this.insertImpl(Tt.hostView,Y,Zx(this._hostTNode,Ae)),Tt}insert(n,i){return this.insertImpl(n,i,!0)}insertImpl(n,i,l){let h=n._lView;if(Dz(h)){let A=this.indexOf(n);if(A!==-1)this.detach(A);else{let L=h[Us],Y=new oV(L,L[Dc],L[Us]);Y.detach(Y.indexOf(n))}}let o=this._adjustIndex(i),E=this._lContainer;return sT(E,h,o,l),n.attachToViewContainerRef(),hM(eA(E),o,n),n}move(n,i){return this.insert(n,i)}indexOf(n){let i=yB(this._lContainer);return i!==null?i.indexOf(n):-1}remove(n){let i=this._adjustIndex(n,-1),l=Yx(this._lContainer,i);l&&(Mx(eA(this._lContainer),i),nT(l[vi],l))}detach(n){let i=this._adjustIndex(n,-1),l=Yx(this._lContainer,i);return l&&Mx(eA(this._lContainer),i)!=null?new fp(l):null}_adjustIndex(n,i=0){return n??this.length+i}};function yB(t){return t[kx]}function eA(t){return t[kx]||(t[kx]=[])}function sV(t,n){let i,l=n[t.index];return yu(l)?i=l:(i=Gj(l,n,null,t),n[t.index]=i,nP(n,i)),OY(i,n,t,l),new oV(i,t,n)}function PY(t,n){let i=t[Ao],l=i.createComment(""),h=Mc(n,t),o=i.parentNode(h);return kE(i,o,l,i.nextSibling(h),!1),l}var OY=FY,RY=()=>!1;function kY(t,n,i){return RY(t,n,i)}function FY(t,n,i,l){if(t[up])return;let h;i.type&8?h=Ic(l):h=PY(n,i),t[up]=h}var CA=class t{queryList;matches=null;constructor(n){this.queryList=n}clone(){return new t(this.queryList)}setDirty(){this.queryList.setDirty()}},EA=class t{queries;constructor(n=[]){this.queries=n}createEmbeddedView(n){let i=n.queries;if(i!==null){let l=n.contentQueries!==null?n.contentQueries[0]:i.length,h=[];for(let o=0;o<l;o++){let E=i.getByIndex(o),A=this.queries[E.indexInDeclarationView];h.push(A.clone())}return new t(h)}return null}insertView(n){this.dirtyQueriesWithMatches(n)}detachView(n){this.dirtyQueriesWithMatches(n)}finishViewCreation(n){this.dirtyQueriesWithMatches(n)}dirtyQueriesWithMatches(n){for(let i=0;i<this.queries.length;i++)fP(n,i).matches!==null&&this.queries[i].setDirty()}},TA=class{flags;read;predicate;constructor(n,i,l=null){this.flags=i,this.read=l,typeof n=="string"?this.predicate=HY(n):this.predicate=n}},SA=class t{queries;constructor(n=[]){this.queries=n}elementStart(n,i){for(let l=0;l<this.queries.length;l++)this.queries[l].elementStart(n,i)}elementEnd(n){for(let i=0;i<this.queries.length;i++)this.queries[i].elementEnd(n)}embeddedTView(n){let i=null;for(let l=0;l<this.length;l++){let h=i!==null?i.length:0,o=this.getByIndex(l).embeddedTView(n,h);o&&(o.indexInDeclarationView=l,i!==null?i.push(o):i=[o])}return i!==null?new t(i):null}template(n,i){for(let l=0;l<this.queries.length;l++)this.queries[l].template(n,i)}getByIndex(n){return this.queries[n]}get length(){return this.queries.length}track(n){this.queries.push(n)}},DA=class t{metadata;matches=null;indexInDeclarationView=-1;crossesNgTemplate=!1;_declarationNodeIndex;_appliesToNextNode=!0;constructor(n,i=-1){this.metadata=n,this._declarationNodeIndex=i}elementStart(n,i){this.isApplyingToNode(i)&&this.matchTNode(n,i)}elementEnd(n){this._declarationNodeIndex===n.index&&(this._appliesToNextNode=!1)}template(n,i){this.elementStart(n,i)}embeddedTView(n,i){return this.isApplyingToNode(n)?(this.crossesNgTemplate=!0,this.addMatch(-n.index,i),new t(this.metadata)):null}isApplyingToNode(n){if(this._appliesToNextNode&&(this.metadata.flags&1)!==1){let i=this._declarationNodeIndex,l=n.parent;for(;l!==null&&l.type&8&&l.index!==i;)l=l.parent;return i===(l!==null?l.index:-1)}return this._appliesToNextNode}matchTNode(n,i){let l=this.metadata.predicate;if(Array.isArray(l))for(let h=0;h<l.length;h++){let o=l[h];this.matchTNodeWithReadOption(n,i,LY(i,o)),this.matchTNodeWithReadOption(n,i,TE(i,n,o,!1,!1))}else l===S0?i.type&4&&this.matchTNodeWithReadOption(n,i,-1):this.matchTNodeWithReadOption(n,i,TE(i,n,l,!1,!1))}matchTNodeWithReadOption(n,i,l){if(l!==null){let h=this.metadata.read;if(h!==null)if(h===Fo||h===Oc||h===S0&&i.type&4)this.addMatch(i.index,-2);else{let o=TE(i,n,h,!1,!1);o!==null&&this.addMatch(i.index,o)}else this.addMatch(i.index,l)}}addMatch(n,i){this.matches===null?this.matches=[n,i]:this.matches.push(n,i)}};function LY(t,n){let i=t.localNames;if(i!==null){for(let l=0;l<i.length;l+=2)if(i[l]===n)return i[l+1]}return null}function NY(t,n){return t.type&11?I0(t,n):t.type&4?aT(t,n):null}function zY(t,n,i,l){return i===-1?NY(n,t):i===-2?BY(t,n,l):Wx(t,t[vi],i,n)}function BY(t,n,i){if(i===Fo)return I0(n,t);if(i===S0)return aT(n,t);if(i===Oc)return sV(n,t)}function aV(t,n,i,l){let h=n[Cd].queries[l];if(h.matches===null){let o=t.data,E=i.matches,A=[];for(let L=0;E!==null&&L<E.length;L+=2){let Y=E[L];if(Y<0)A.push(null);else{let le=o[Y];A.push(zY(n,le,E[L+1],i.metadata.read))}}h.matches=A}return h.matches}function IA(t,n,i,l){let h=t.queries.getByIndex(i),o=h.matches;if(o!==null){let E=aV(t,n,h,i);for(let A=0;A<o.length;A+=2){let L=o[A];if(L>0)l.push(E[A/2]);else{let Y=o[A+1],le=n[-L];for(let te=Ss;te<le.length;te++){let ze=le[te];ze[lp]===ze[Us]&&IA(ze[vi],ze,Y,l)}if(le[$m]!==null){let te=le[$m];for(let ze=0;ze<te.length;ze++){let Ae=te[ze];IA(Ae[vi],Ae,Y,l)}}}}}return l}function jY(t,n){return t[Cd].queries[n].queryList}function VY(t,n,i){let l=new OE((i&4)===4);return Az(t,n,l,l.destroy),(n[Cd]??=new EA).queries.push(new CA(l))-1}function UY(t,n,i){let l=Ds();return l.firstCreatePass&&($Y(l,new TA(t,n,i),-1),(n&2)===2&&(l.staticViewQueries=!0)),VY(l,hi(),n)}function HY(t){return t.split(",").map(n=>n.trim())}function $Y(t,n,i){t.queries===null&&(t.queries=new SA),t.queries.track(new DA(n,i))}function fP(t,n){return t.queries.getByIndex(n)}function GY(t,n){let i=t[vi],l=fP(i,n);return l.crossesNgTemplate?IA(i,t,n,[]):aV(i,t,l,n)}var xB=new Set;function ic(t){xB.has(t)||(xB.add(t),performance?.mark?.("mark_feature_usage",{detail:{feature:t}}))}var Jm=class{},cT=class{};var BE=class extends Jm{ngModuleType;_parent;_bootstrapComponents=[];_r3Injector;instance;destroyCbs=[];componentFactoryResolver=new NE(this);constructor(n,i,l,h=!0){super(),this.ngModuleType=n,this._parent=i;let o=mM(n);this._bootstrapComponents=_j(o.bootstrap),this._r3Injector=HM(n,i,[{provide:Jm,useValue:this},{provide:sb,useValue:this.componentFactoryResolver},...l],Oh(n),new Set(["environment"])),h&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){let n=this._r3Injector;!n.destroyed&&n.destroy(),this.destroyCbs.forEach(i=>i()),this.destroyCbs=null}onDestroy(n){this.destroyCbs.push(n)}},jE=class extends cT{moduleType;constructor(n){super(),this.moduleType=n}create(n){return new BE(this.moduleType,n,[])}};var Jx=class extends Jm{injector;componentFactoryResolver=new NE(this);instance=null;constructor(n){super();let i=new zm([...n.providers,{provide:Jm,useValue:this},{provide:sb,useValue:this.componentFactoryResolver}],n.parent||Px(),n.debugName,new Set(["environment"]));this.injector=i,n.runEnvironmentInitializers&&i.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(n){this.injector.onDestroy(n)}};function P0(t,n,i=null){return new Jx({providers:t,parent:n,debugName:i,runEnvironmentInitializers:!0}).injector}var qY=(()=>{class t{_injector;cachedInjectors=new Map;constructor(i){this._injector=i}getOrCreateStandaloneInjector(i){if(!i.standalone)return null;if(!this.cachedInjectors.has(i)){let l=_M(!1,i.type),h=l.length>0?P0([l],this._injector,`Standalone[${i.type.name}]`):null;this.cachedInjectors.set(i,h)}return this.cachedInjectors.get(i)}ngOnDestroy(){try{for(let i of this.cachedInjectors.values())i!==null&&i.destroy()}finally{this.cachedInjectors.clear()}}static \u0275prov=Qt({token:t,providedIn:"environment",factory:()=>new t(gn(ds))})}return t})();function Ai(t){return eb(()=>{let n=lV(t),i=Mi(Jt({},n),{decls:t.decls,vars:t.vars,template:t.template,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,onPush:t.changeDetection===$A.OnPush,directiveDefs:null,pipeDefs:null,dependencies:n.standalone&&t.dependencies||null,getStandaloneInjector:n.standalone?h=>h.get(qY).getOrCreateStandaloneInjector(i):null,getExternalStyles:null,signals:t.signals??!1,data:t.data||{},encapsulation:t.encapsulation||Lh.Emulated,styles:t.styles||fl,_:null,schemas:t.schemas||null,tView:null,id:""});n.standalone&&ic("NgStandalone"),cV(i);let l=t.dependencies;return i.directiveDefs=bB(l,WY),i.pipeDefs=bB(l,_z),i.id=YY(i),i})}function WY(t){return Fh(t)||gM(t)}function Qo(t){return eb(()=>({type:t.type,bootstrap:t.bootstrap||fl,declarations:t.declarations||fl,imports:t.imports||fl,exports:t.exports||fl,transitiveCompileScopes:null,schemas:t.schemas||null,id:t.id||null}))}function ZY(t,n){if(t==null)return ap;let i={};for(let l in t)if(t.hasOwnProperty(l)){let h=t[l],o,E,A,L;Array.isArray(h)?(A=h[0],o=h[1],E=h[2]??o,L=h[3]||null):(o=h,E=h,A=eT.None,L=null),i[o]=[l,A,L],n[o]=E}return i}function XY(t){if(t==null)return ap;let n={};for(let i in t)t.hasOwnProperty(i)&&(n[t[i]]=i);return n}function Ki(t){return eb(()=>{let n=lV(t);return cV(n),n})}function zh(t){return{type:t.type,name:t.name,factory:null,pure:t.pure!==!1,standalone:t.standalone??!0,onDestroy:t.type.prototype.ngOnDestroy||null}}function lV(t){let n={};return{type:t.type,providersResolver:null,factory:null,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:n,inputConfig:t.inputs||ap,exportAs:t.exportAs||null,standalone:t.standalone??!0,signals:t.signals===!0,selectors:t.selectors||fl,viewQuery:t.viewQuery||null,features:t.features||null,setInput:null,resolveHostDirectives:null,hostDirectives:null,inputs:ZY(t.inputs,n),outputs:XY(t.outputs),debugInfo:null}}function cV(t){t.features?.forEach(n=>n(t))}function bB(t,n){return t?()=>{let i=typeof t=="function"?t():t,l=[];for(let h of i){let o=n(h);o!==null&&l.push(o)}return l}:null}function YY(t){let n=0,i=typeof t.consts=="function"?"":t.consts,l=[t.selectors,t.ngContentSelectors,t.hostVars,t.hostAttrs,i,t.vars,t.decls,t.encapsulation,t.standalone,t.signals,t.exportAs,JSON.stringify(t.inputs),JSON.stringify(t.outputs),Object.getOwnPropertyNames(t.type.prototype),!!t.contentQueries,!!t.viewQuery];for(let o of l.join("|"))n=Math.imul(31,n)+o.charCodeAt(0)<<0;return n+=2147483648,"c"+n}function KY(t){return Object.getPrototypeOf(t.prototype).constructor}function fs(t){let n=KY(t.type),i=!0,l=[t];for(;n;){let h;if(Td(t))h=n.\u0275cmp||n.\u0275dir;else{if(n.\u0275cmp)throw new bn(903,!1);h=n.\u0275dir}if(h){if(i){l.push(h);let E=t;E.inputs=tA(t.inputs),E.declaredInputs=tA(t.declaredInputs),E.outputs=tA(t.outputs);let A=h.hostBindings;A&&nK(t,A);let L=h.viewQuery,Y=h.contentQueries;if(L&&eK(t,L),Y&&tK(t,Y),JY(t,h),cz(t.outputs,h.outputs),Td(h)&&h.data.animation){let le=t.data;le.animation=(le.animation||[]).concat(h.data.animation)}}let o=h.features;if(o)for(let E=0;E<o.length;E++){let A=o[E];A&&A.ngInherit&&A(t),A===fs&&(i=!1)}}n=Object.getPrototypeOf(n)}QY(l)}function JY(t,n){for(let i in n.inputs){if(!n.inputs.hasOwnProperty(i)||t.inputs.hasOwnProperty(i))continue;let l=n.inputs[i];l!==void 0&&(t.inputs[i]=l,t.declaredInputs[i]=n.declaredInputs[i])}}function QY(t){let n=0,i=null;for(let l=t.length-1;l>=0;l--){let h=t[l];h.hostVars=n+=h.hostVars,h.hostAttrs=E0(h.hostAttrs,i=E0(i,h.hostAttrs))}}function tA(t){return t===ap?{}:t===fl?[]:t}function eK(t,n){let i=t.viewQuery;i?t.viewQuery=(l,h)=>{n(l,h),i(l,h)}:t.viewQuery=n}function tK(t,n){let i=t.contentQueries;i?t.contentQueries=(l,h,o)=>{n(l,h,o),i(l,h,o)}:t.contentQueries=n}function nK(t,n){let i=t.hostBindings;i?t.hostBindings=(l,h)=>{n(l,h),i(l,h)}:t.hostBindings=n}function uV(t,n,i,l,h,o,E,A){if(i.firstCreatePass){t.mergedAttrs=E0(t.mergedAttrs,t.attrs);let le=t.tView=eP(2,t,h,o,E,i.directiveRegistry,i.pipeRegistry,null,i.schemas,i.consts,null);i.queries!==null&&(i.queries.template(i,t),le.queries=i.queries.embeddedTView(t))}A&&(t.flags|=A),y0(t,!1);let L=rK(i,n,t,l);pE()&&oP(i,n,L,t),T0(L,n);let Y=Gj(L,n,L,t);n[l+Go]=Y,nP(n,Y),kY(Y,t,n)}function iK(t,n,i,l,h,o,E,A,L,Y,le){let te=i+Go,ze;return n.firstCreatePass?(ze=ob(n,te,4,E||null,A||null),OM()&&Jj(n,t,ze,Pc(n.consts,Y),Rj),zB(n,ze)):ze=n.data[te],uV(ze,t,n,i,l,h,o,L),Fx(ze)&&aP(n,t,ze),Y!=null&&rT(t,ze,le),ze}function VE(t,n,i,l,h,o,E,A,L,Y,le){let te=i+Go,ze;if(n.firstCreatePass){if(ze=ob(n,te,4,E||null,A||null),Y!=null){let Ae=Pc(n.consts,Y);ze.localNames=[];for(let Be=0;Be<Ae.length;Be+=2)ze.localNames.push(Ae[Be],-1)}}else ze=n.data[te];return uV(ze,t,n,i,l,h,o,L),Y!=null&&rT(t,ze,le),ze}function Bh(t,n,i,l,h,o,E,A){let L=hi(),Y=Ds(),le=Pc(Y.consts,o);return iK(L,Y,t,n,i,l,h,le,void 0,E,A),Bh}var rK=oK;function oK(t,n,i,l){return mE(!0),n[Ao].createComment("")}var uT=(function(t){return t[t.CHANGE_DETECTION=0]="CHANGE_DETECTION",t[t.AFTER_NEXT_RENDER=1]="AFTER_NEXT_RENDER",t})(uT||{}),tg=new Sn(""),dV=!1,MA=class extends Fn{__isAsync;destroyRef=void 0;pendingTasks=void 0;constructor(n=!1){super(),this.__isAsync=n,wz()&&(this.destroyRef=ft(bu,{optional:!0})??void 0,this.pendingTasks=ft(Dd,{optional:!0})??void 0)}emit(n){let i=zi(null);try{super.next(n)}finally{zi(i)}}subscribe(n,i,l){let h=n,o=i||(()=>null),E=l;if(n&&typeof n=="object"){let L=n;h=L.next?.bind(L),o=L.error?.bind(L),E=L.complete?.bind(L)}this.__isAsync&&(o=this.wrapInTimeout(o),h&&(h=this.wrapInTimeout(h)),E&&(E=this.wrapInTimeout(E)));let A=super.subscribe({next:h,error:o,complete:E});return n instanceof Jo&&n.add(A),A}wrapInTimeout(n){return i=>{let l=this.pendingTasks?.add();setTimeout(()=>{try{n(i)}finally{l!==void 0&&this.pendingTasks?.remove(l)}})}}},qi=MA;function hV(t){let n,i;function l(){t=Vx;try{i!==void 0&&typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(i),n!==void 0&&clearTimeout(n)}catch{}}return n=setTimeout(()=>{t(),l()}),typeof requestAnimationFrame=="function"&&(i=requestAnimationFrame(()=>{t(),l()})),()=>l()}function wB(t){return queueMicrotask(()=>t()),()=>{t=Vx}}var pP="isAngularZone",UE=pP+"_ID",sK=0,so=class t{hasPendingMacrotasks=!1;hasPendingMicrotasks=!1;isStable=!0;onUnstable=new qi(!1);onMicrotaskEmpty=new qi(!1);onStable=new qi(!1);onError=new qi(!1);constructor(n){let{enableLongStackTrace:i=!1,shouldCoalesceEventChangeDetection:l=!1,shouldCoalesceRunChangeDetection:h=!1,scheduleInRootZone:o=dV}=n;if(typeof Zone>"u")throw new bn(908,!1);Zone.assertZonePatched();let E=this;E._nesting=0,E._outer=E._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(E._inner=E._inner.fork(new Zone.TaskTrackingZoneSpec)),i&&Zone.longStackTraceZoneSpec&&(E._inner=E._inner.fork(Zone.longStackTraceZoneSpec)),E.shouldCoalesceEventChangeDetection=!h&&l,E.shouldCoalesceRunChangeDetection=h,E.callbackScheduled=!1,E.scheduleInRootZone=o,cK(E)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get(pP)===!0}static assertInAngularZone(){if(!t.isInAngularZone())throw new bn(909,!1)}static assertNotInAngularZone(){if(t.isInAngularZone())throw new bn(909,!1)}run(n,i,l){return this._inner.run(n,i,l)}runTask(n,i,l,h){let o=this._inner,E=o.scheduleEventTask("NgZoneEvent: "+h,n,aK,Vx,Vx);try{return o.runTask(E,i,l)}finally{o.cancelTask(E)}}runGuarded(n,i,l){return this._inner.runGuarded(n,i,l)}runOutsideAngular(n){return this._outer.run(n)}},aK={};function mP(t){if(t._nesting==0&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function lK(t){if(t.isCheckStableRunning||t.callbackScheduled)return;t.callbackScheduled=!0;function n(){hV(()=>{t.callbackScheduled=!1,AA(t),t.isCheckStableRunning=!0,mP(t),t.isCheckStableRunning=!1})}t.scheduleInRootZone?Zone.root.run(()=>{n()}):t._outer.run(()=>{n()}),AA(t)}function cK(t){let n=()=>{lK(t)},i=sK++;t._inner=t._inner.fork({name:"angular",properties:{[pP]:!0,[UE]:i,[UE+i]:!0},onInvokeTask:(l,h,o,E,A,L)=>{if(uK(L))return l.invokeTask(o,E,A,L);try{return CB(t),l.invokeTask(o,E,A,L)}finally{(t.shouldCoalesceEventChangeDetection&&E.type==="eventTask"||t.shouldCoalesceRunChangeDetection)&&n(),EB(t)}},onInvoke:(l,h,o,E,A,L,Y)=>{try{return CB(t),l.invoke(o,E,A,L,Y)}finally{t.shouldCoalesceRunChangeDetection&&!t.callbackScheduled&&!dK(L)&&n(),EB(t)}},onHasTask:(l,h,o,E)=>{l.hasTask(o,E),h===o&&(E.change=="microTask"?(t._hasPendingMicrotasks=E.microTask,AA(t),mP(t)):E.change=="macroTask"&&(t.hasPendingMacrotasks=E.macroTask))},onHandleError:(l,h,o,E)=>(l.handleError(o,E),t.runOutsideAngular(()=>t.onError.emit(E)),!1)})}function AA(t){t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&t.callbackScheduled===!0?t.hasPendingMicrotasks=!0:t.hasPendingMicrotasks=!1}function CB(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function EB(t){t._nesting--,mP(t)}var HE=class{hasPendingMicrotasks=!1;hasPendingMacrotasks=!1;isStable=!0;onUnstable=new qi;onMicrotaskEmpty=new qi;onStable=new qi;onError=new qi;run(n,i,l){return n.apply(i,l)}runGuarded(n,i,l){return n.apply(i,l)}runOutsideAngular(n){return n()}runTask(n,i,l,h){return n.apply(i,l)}};function uK(t){return fV(t,"__ignore_ng_zone__")}function dK(t){return fV(t,"__scheduler_tick__")}function fV(t,n){return!Array.isArray(t)||t.length!==1?!1:t[0]?.data?.[n]===!0}var gP=(()=>{class t{impl=null;execute(){this.impl?.execute()}static \u0275prov=Qt({token:t,providedIn:"root",factory:()=>new t})}return t})(),pV=[0,1,2,3],mV=(()=>{class t{ngZone=ft(so);scheduler=ft(Rh);errorHandler=ft(pu,{optional:!0});sequences=new Set;deferredRegistrations=new Set;executing=!1;constructor(){ft(tg,{optional:!0})}execute(){let i=this.sequences.size>0;i&&ro(16),this.executing=!0;for(let l of pV)for(let h of this.sequences)if(!(h.erroredOrDestroyed||!h.hooks[l]))try{h.pipelinedValue=this.ngZone.runOutsideAngular(()=>this.maybeTrace(()=>{let o=h.hooks[l];return o(h.pipelinedValue)},h.snapshot))}catch(o){h.erroredOrDestroyed=!0,this.errorHandler?.handleError(o)}this.executing=!1;for(let l of this.sequences)l.afterRun(),l.once&&(this.sequences.delete(l),l.destroy());for(let l of this.deferredRegistrations)this.sequences.add(l);this.deferredRegistrations.size>0&&this.scheduler.notify(7),this.deferredRegistrations.clear(),i&&ro(17)}register(i){let{view:l}=i;l!==void 0?((l[Hm]??=[]).push(i),v0(l),l[Bi]|=8192):this.executing?this.deferredRegistrations.add(i):this.addSequence(i)}addSequence(i){this.sequences.add(i),this.scheduler.notify(7)}unregister(i){this.executing&&this.sequences.has(i)?(i.erroredOrDestroyed=!0,i.pipelinedValue=void 0,i.once=!0):(this.sequences.delete(i),this.deferredRegistrations.delete(i))}maybeTrace(i,l){return l?l.run(uT.AFTER_NEXT_RENDER,i):i()}static \u0275prov=Qt({token:t,providedIn:"root",factory:()=>new t})}return t})(),$E=class{impl;hooks;view;once;snapshot;erroredOrDestroyed=!1;pipelinedValue=void 0;unregisterOnDestroy;constructor(n,i,l,h,o,E=null){this.impl=n,this.hooks=i,this.view=l,this.once=h,this.snapshot=E,this.unregisterOnDestroy=o?.onDestroy(()=>this.destroy())}afterRun(){this.erroredOrDestroyed=!1,this.pipelinedValue=void 0,this.snapshot?.dispose(),this.snapshot=null}destroy(){this.impl.unregister(this),this.unregisterOnDestroy?.();let n=this.view?.[Hm];n&&(this.view[Hm]=n.filter(i=>i!==this))}};function gV(t,n){let i=n?.injector??ft(ba);return ic("NgAfterRender"),_V(t,i,n,!1)}function ab(t,n){let i=n?.injector??ft(ba);return ic("NgAfterNextRender"),_V(t,i,n,!0)}function hK(t){return t instanceof Function?[void 0,void 0,t,void 0]:[t.earlyRead,t.write,t.mixedReadWrite,t.read]}function _V(t,n,i,l){let h=n.get(gP);h.impl??=n.get(mV);let o=n.get(tg,null,{optional:!0}),E=i?.manualCleanup!==!0?n.get(bu):null,A=n.get(gE,null,{optional:!0}),L=new $E(h.impl,hK(t),A?.view,l,E,o?.snapshot(null));return h.impl.register(L),L}var _P=(()=>{class t{log(i){console.log(i)}warn(i){console.warn(i)}static \u0275fac=function(l){return new(l||t)};static \u0275prov=Qt({token:t,factory:t.\u0275fac,providedIn:"platform"})}return t})();var vP=new Sn("");function pp(t){return!!t&&typeof t.then=="function"}function yP(t){return!!t&&typeof t.subscribe=="function"}var xP=new Sn("");function dT(t){return bd([{provide:xP,multi:!0,useValue:t}])}var bP=(()=>{class t{resolve;reject;initialized=!1;done=!1;donePromise=new Promise((i,l)=>{this.resolve=i,this.reject=l});appInits=ft(xP,{optional:!0})??[];injector=ft(ba);constructor(){}runInitializers(){if(this.initialized)return;let i=[];for(let h of this.appInits){let o=ta(this.injector,h);if(pp(o))i.push(o);else if(yP(o)){let E=new Promise((A,L)=>{o.subscribe({complete:A,error:L})});i.push(E)}}let l=()=>{this.done=!0,this.resolve()};Promise.all(i).then(()=>{l()}).catch(h=>{this.reject(h)}),i.length===0&&l(),this.initialized=!0}static \u0275fac=function(l){return new(l||t)};static \u0275prov=Qt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),lb=new Sn("");function vV(){S2(()=>{let t="";throw new bn(600,t)})}function yV(t){return t.isBoundToModule}var fK=10;var jh=(()=>{class t{_runningTick=!1;_destroyed=!1;_destroyListeners=[];_views=[];internalErrorHandler=ft(pl);afterRenderManager=ft(gP);zonelessEnabled=ft(jx);rootEffectScheduler=ft(XM);dirtyFlags=0;tracingSnapshot=null;allTestViews=new Set;autoDetectTestViews=new Set;includeAllTestViews=!1;afterTick=new Fn;get allViews(){return[...(this.includeAllTestViews?this.allTestViews:this.autoDetectTestViews).keys(),...this._views]}get destroyed(){return this._destroyed}componentTypes=[];components=[];internalPendingTask=ft(Dd);get isStable(){return this.internalPendingTask.hasPendingTasksObservable.pipe(di(i=>!i))}constructor(){ft(tg,{optional:!0})}whenStable(){let i;return new Promise(l=>{i=this.isStable.subscribe({next:h=>{h&&l()}})}).finally(()=>{i.unsubscribe()})}_injector=ft(ds);_rendererFactory=null;get injector(){return this._injector}bootstrap(i,l){return this.bootstrapImpl(i,l)}bootstrapImpl(i,l,h=ba.NULL){return this._injector.get(so).run(()=>{ro(10);let E=i instanceof lT;if(!this._injector.get(bP).done){let Be="";throw new bn(405,Be)}let L;E?L=i:L=this._injector.get(sb).resolveComponentFactory(i),this.componentTypes.push(L.componentType);let Y=yV(L)?void 0:this._injector.get(Jm),le=l||L.selector,te=L.create(h,[],le,Y),ze=te.location.nativeElement,Ae=te.injector.get(vP,null);return Ae?.registerApplication(ze),te.onDestroy(()=>{this.detachView(te.hostView),Hx(this.components,te),Ae?.unregisterApplication(ze)}),this._loadComponent(te),ro(11,te),te})}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick(){ro(12),this.tracingSnapshot!==null?this.tracingSnapshot.run(uT.CHANGE_DETECTION,this.tickImpl):this.tickImpl()}tickImpl=()=>{if(this._runningTick)throw new bn(101,!1);let i=zi(null);try{this._runningTick=!0,this.synchronize()}finally{this._runningTick=!1,this.tracingSnapshot?.dispose(),this.tracingSnapshot=null,zi(i),this.afterTick.next(),ro(13)}};synchronize(){this._rendererFactory===null&&!this._injector.destroyed&&(this._rendererFactory=this._injector.get(Ym,null,{optional:!0}));let i=0;for(;this.dirtyFlags!==0&&i++<fK;)ro(14),this.synchronizeOnce(),ro(15)}synchronizeOnce(){this.dirtyFlags&16&&(this.dirtyFlags&=-17,this.rootEffectScheduler.flush());let i=!1;if(this.dirtyFlags&7){let l=!!(this.dirtyFlags&1);this.dirtyFlags&=-8,this.dirtyFlags|=8;for(let{_lView:h}of this.allViews){if(!l&&!zx(h))continue;let o=l&&!this.zonelessEnabled?0:1;Vj(h,o),i=!0}if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),this.dirtyFlags&23)return}i||(this._rendererFactory?.begin?.(),this._rendererFactory?.end?.()),this.dirtyFlags&8&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){if(this.allViews.some(({_lView:i})=>zx(i))){this.dirtyFlags|=2;return}else this.dirtyFlags&=-8}attachView(i){let l=i;this._views.push(l),l.attachToAppRef(this)}detachView(i){let l=i;Hx(this._views,l),l.detachFromAppRef()}_loadComponent(i){this.attachView(i.hostView);try{this.tick()}catch(h){this.internalErrorHandler(h)}this.components.push(i),this._injector.get(lb,[]).forEach(h=>h(i))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(i=>i()),this._views.slice().forEach(i=>i.destroy())}finally{this._destroyed=!0,this._views=[],this._destroyListeners=[]}}onDestroy(i){return this._destroyListeners.push(i),()=>Hx(this._destroyListeners,i)}destroy(){if(this._destroyed)throw new bn(406,!1);let i=this._injector;i.destroy&&!i.destroyed&&i.destroy()}get viewCount(){return this._views.length}static \u0275fac=function(l){return new(l||t)};static \u0275prov=Qt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function Hx(t,n){let i=t.indexOf(n);i>-1&&t.splice(i,1)}function pK(){let t,n;return{promise:new Promise((l,h)=>{t=l,n=h}),resolve:t,reject:n}}function Lo(t,n,i,l){let h=hi(),o=qm();if(nc(h,o,n)){let E=Ds(),A=fE();PX(A,h,t,n,i,l)}return Lo}var mK=!1,wP=typeof document<"u"&&typeof document?.documentElement?.getAnimations=="function";function gK(t){return t[vu].get(Ij,mK)}function _K(t){let n=PA.get(t);if(n){for(let i of n.cleanupFns)i();PA.delete(t)}$x.delete(t)}var PA=new WeakMap,$x=new WeakMap,Gx=new WeakMap;function TB(t,n){let i=Gx.get(t);if(i&&i.length>0){let l=i.findIndex(h=>h===n);l>-1&&i.splice(l,1)}i?.length===0&&Gx.delete(t)}function vK(t,n){Gx.has(t)?Gx.get(t)?.push(n):Gx.set(t,[n])}function hT(t){let n=t[cp]??={};return n.leave??=new Map}function yK(t){let n=typeof t=="function"?t():t,i=Array.isArray(n)?n:null;return typeof n=="string"&&(i=n.trim().split(/\s+/).filter(l=>l)),i}function xK(t,n){if(!wP)return;let i=PA.get(t);if(i&&i.classList.length>0&&bK(t,i.classList))for(let l of i.classList)n.removeClass(t,l);_K(t)}function bK(t,n){for(let i of n)if(t.classList.contains(i))return!0;return!1}function wK(t,n){let i=$x.get(n);return i===void 0?!0:n===t.target&&(i.animationName!==void 0&&t.animationName===i.animationName||i.propertyName!==void 0&&t.propertyName===i.propertyName)}function CK(t,n,i){let l=t.get(n.index)??{animateFns:[]};l.animateFns.push(i),t.set(n.index,l)}function SB(t,n){if(t)for(let i of t)i();for(let i of n)i()}function DB(t,n){let i=hT(t).get(n.index);i&&(i.resolvers=void 0)}function C0(t){if(ic("NgAnimateLeave"),!wP)return C0;let n=hi();if(gK(n))return C0;let l=na();return CK(hT(n),l,()=>EK(n,l,t)),SK(n[vu]),C0}function EK(t,n,i){let{promise:l,resolve:h}=pK(),o=Mc(n,t),E=t[Ao],A=t[vu].get(so);Xm.add(t),(hT(t).get(n.index).resolvers??=[]).push(h);let L=yK(i);return L&&L.length>0?TK(o,n,t,L,E,A):h(),{promise:l,resolve:h}}function TK(t,n,i,l,h,o){xK(t,h);let E=[],A=hT(i).get(n.index)?.resolvers,L=Y=>{if(Y.target===t&&(Y instanceof CustomEvent||wK(Y,t))){if(Y.stopImmediatePropagation(),$x.delete(t),TB(n,t),Array.isArray(n.projection))for(let le of l)h.removeClass(t,le);SB(A,E),DB(i,n)}};o.runOutsideAngular(()=>{E.push(h.listen(t,"animationend",L)),E.push(h.listen(t,"transitionend",L))}),vK(n,t);for(let Y of l)h.addClass(t,Y);o.runOutsideAngular(()=>{requestAnimationFrame(()=>{oX(t,$x,wP),$x.has(t)||(TB(n,t),SB(A,E),DB(i,n))})})}function SK(t){let n=t.get(tT);n.isScheduled||(gV(()=>{DK(t)},{injector:t}),n.isScheduled=!0)}function DK(t){let n=t.get(tT);for(let i of n.queue)i();n.queue.clear()}var OA=class{destroy(n){}updateValue(n,i){}swap(n,i){let l=Math.min(n,i),h=Math.max(n,i),o=this.detach(h);if(h-l>1){let E=this.detach(l);this.attach(l,o),this.attach(h,E)}else this.attach(l,o)}move(n,i){this.attach(i,this.detach(n,!0))}};function nA(t,n,i,l,h){return t===i&&Object.is(n,l)?1:Object.is(h(t,n),h(i,l))?-1:0}function IK(t,n,i){let l,h,o=0,E=t.length-1,A=void 0;if(Array.isArray(n)){let L=n.length-1;for(;o<=E&&o<=L;){let Y=t.at(o),le=n[o],te=nA(o,Y,o,le,i);if(te!==0){te<0&&t.updateValue(o,le),o++;continue}let ze=t.at(E),Ae=n[L],Be=nA(E,ze,L,Ae,i);if(Be!==0){Be<0&&t.updateValue(E,Ae),E--,L--;continue}let Tt=i(o,Y),ot=i(E,ze),kt=i(o,le);if(Object.is(kt,ot)){let Cn=i(L,Ae);Object.is(Cn,Tt)?(t.swap(o,E),t.updateValue(E,Ae),L--,E--):t.move(E,o),t.updateValue(o,le),o++;continue}if(l??=new GE,h??=MB(t,o,E,i),RA(t,l,o,kt))t.updateValue(o,le),o++,E++;else if(h.has(kt))l.set(Tt,t.detach(o)),E--;else{let Cn=t.create(o,n[o]);t.attach(o,Cn),o++,E++}}for(;o<=L;)IB(t,l,i,o,n[o]),o++}else if(n!=null){let L=n[Symbol.iterator](),Y=L.next();for(;!Y.done&&o<=E;){let le=t.at(o),te=Y.value,ze=nA(o,le,o,te,i);if(ze!==0)ze<0&&t.updateValue(o,te),o++,Y=L.next();else{l??=new GE,h??=MB(t,o,E,i);let Ae=i(o,te);if(RA(t,l,o,Ae))t.updateValue(o,te),o++,E++,Y=L.next();else if(!h.has(Ae))t.attach(o,t.create(o,te)),o++,E++,Y=L.next();else{let Be=i(o,le);l.set(Be,t.detach(o)),E--}}}for(;!Y.done;)IB(t,l,i,t.length,Y.value),Y=L.next()}for(;o<=E;)t.destroy(t.detach(E--));l?.forEach(L=>{t.destroy(L)})}function RA(t,n,i,l){return n!==void 0&&n.has(l)?(t.attach(i,n.get(l)),n.delete(l),!0):!1}function IB(t,n,i,l,h){if(RA(t,n,l,i(l,h)))t.updateValue(l,h);else{let o=t.create(l,h);t.attach(l,o)}}function MB(t,n,i,l){let h=new Set;for(let o=n;o<=i;o++)h.add(l(o,t.at(o)));return h}var GE=class{kvMap=new Map;_vMap=void 0;has(n){return this.kvMap.has(n)}delete(n){if(!this.has(n))return!1;let i=this.kvMap.get(n);return this._vMap!==void 0&&this._vMap.has(i)?(this.kvMap.set(n,this._vMap.get(i)),this._vMap.delete(i)):this.kvMap.delete(n),!0}get(n){return this.kvMap.get(n)}set(n,i){if(this.kvMap.has(n)){let l=this.kvMap.get(n);this._vMap===void 0&&(this._vMap=new Map);let h=this._vMap;for(;h.has(l);)l=h.get(l);h.set(l,i)}else this.kvMap.set(n,i)}forEach(n){for(let[i,l]of this.kvMap)if(n(l,i),this._vMap!==void 0){let h=this._vMap;for(;h.has(l);)l=h.get(l),n(l,i)}}};function tt(t,n,i,l,h,o,E,A){ic("NgControlFlow");let L=hi(),Y=Ds(),le=Pc(Y.consts,o);return VE(L,Y,t,n,i,l,h,le,256,E,A),CP}function CP(t,n,i,l,h,o,E,A){ic("NgControlFlow");let L=hi(),Y=Ds(),le=Pc(Y.consts,o);return VE(L,Y,t,n,i,l,h,le,512,E,A),CP}function nt(t,n){ic("NgControlFlow");let i=hi(),l=qm(),h=i[l]!==Ea?i[l]:-1,o=h!==-1?qE(i,Go+h):void 0,E=0;if(nc(i,l,t)){let A=zi(null);try{if(o!==void 0&&Wj(o,E),t!==-1){let L=Go+t,Y=qE(i,L),le=NA(i[vi],L),te=Xj(Y,le,i),ze=oT(i,le,n,{dehydratedView:te});sT(Y,ze,E,Zx(le,te))}}finally{zi(A)}}else if(o!==void 0){let A=qj(o,E);A!==void 0&&(A[hs]=n)}}var kA=class{lContainer;$implicit;$index;constructor(n,i,l){this.lContainer=n,this.$implicit=i,this.$index=l}get $count(){return this.lContainer.length-Ss}};function ng(t){return t}function ra(t,n){return n}var FA=class{hasEmptyBlock;trackByFn;liveCollection;constructor(n,i,l){this.hasEmptyBlock=n,this.trackByFn=i,this.liveCollection=l}};function Ri(t,n,i,l,h,o,E,A,L,Y,le,te,ze){ic("NgControlFlow");let Ae=hi(),Be=Ds(),Tt=L!==void 0,ot=hi(),kt=A?E.bind(ot[Ql][hs]):E,Cn=new FA(Tt,kt);ot[Go+t]=Cn,VE(Ae,Be,t+1,n,i,l,h,Pc(Be.consts,o),256),Tt&&VE(Ae,Be,t+2,L,Y,le,te,Pc(Be.consts,ze),512)}var LA=class extends OA{lContainer;hostLView;templateTNode;operationsCounter=void 0;needsIndexUpdate=!1;constructor(n,i,l){super(),this.lContainer=n,this.hostLView=i,this.templateTNode=l}get length(){return this.lContainer.length-Ss}at(n){return this.getLView(n)[hs].$implicit}attach(n,i){let l=i[p0];this.needsIndexUpdate||=n!==this.length,sT(this.lContainer,i,n,Zx(this.templateTNode,l))}detach(n,i){return this.needsIndexUpdate||=n!==this.length-1,i&&MK(this.lContainer,n),AK(this.lContainer,n)}create(n,i){let l=yA(this.lContainer,this.templateTNode.tView.ssrId),h=oT(this.hostLView,this.templateTNode,new kA(this.lContainer,i,n),{dehydratedView:l});return this.operationsCounter?.recordCreate(),h}destroy(n){nT(n[vi],n),this.operationsCounter?.recordDestroy()}updateValue(n,i){this.getLView(n)[hs].$implicit=i}reset(){this.needsIndexUpdate=!1,this.operationsCounter?.reset()}updateIndexes(){if(this.needsIndexUpdate)for(let n=0;n<this.length;n++)this.getLView(n)[hs].$index=n}getLView(n){return PK(this.lContainer,n)}};function ki(t){let n=zi(null),i=xu();try{let l=hi(),h=l[vi],o=l[i],E=i+1,A=qE(l,E);if(o.liveCollection===void 0){let Y=NA(h,E);o.liveCollection=new LA(A,l,Y)}else o.liveCollection.reset();let L=o.liveCollection;if(IK(L,t,o.trackByFn),L.updateIndexes(),o.hasEmptyBlock){let Y=qm(),le=L.length===0;if(nc(l,Y,le)){let te=i+2,ze=qE(l,te);if(le){let Ae=NA(h,te),Be=Xj(ze,Ae,l),Tt=oT(l,Ae,void 0,{dehydratedView:Be});sT(ze,Tt,0,Zx(Ae,Be))}else h.firstUpdatePass&&tY(ze),Wj(ze,0)}}}finally{zi(n)}}function qE(t,n){return t[n]}function MK(t,n){if(t.length<=Ss)return;let i=Ss+n,l=t[i];l&&l[cp]&&(l[cp].skipLeaveAnimations=!0)}function AK(t,n){return Yx(t,n)}function PK(t,n){return qj(t,n)}function NA(t,n){return Lx(t,n)}function zt(t,n,i){let l=hi(),h=qm();if(nc(l,h,n)){let o=Ds(),E=fE();Oj(E,l,t,n,l[Ao],i)}return zt}function zA(t,n,i,l,h){lP(n,t,i,h?"class":"style",l)}function $(t,n,i,l){let h=hi(),o=h[vi],E=t+Go,A=o.firstCreatePass?eV(E,h,2,n,Rj,OM(),i,l):o.data[E];if(kj(A,h,t,n,xV),Fx(A)){let L=h[vi];aP(L,h,A),aj(L,A,h)}return l!=null&&rT(h,A),$}function W(){let t=Ds(),n=na(),i=Fj(n);return t.firstCreatePass&&tV(t,i),RM(i)&&kM(),PM(),i.classesWithoutHost!=null&&Z9(i)&&zA(t,i,hi(),i.classesWithoutHost,!0),i.stylesWithoutHost!=null&&X9(i)&&zA(t,i,hi(),i.stylesWithoutHost,!1),W}function be(t,n,i,l){return $(t,n,i,l),W(),be}function es(t,n,i,l){let h=hi(),o=h[vi],E=t+Go,A=o.firstCreatePass?mY(E,o,2,n,i,l):o.data[E];return kj(A,h,t,n,xV),l!=null&&rT(h,A),es}function ts(){let t=na(),n=Fj(t);return RM(n)&&kM(),PM(),ts}function O0(t,n,i,l){return es(t,n,i,l),ts(),O0}var xV=(t,n,i,l,h)=>(mE(!0),yj(n[Ao],l,qz()));function Hn(){return hi()}var bE=void 0;function OK(t){let n=Math.floor(Math.abs(t)),i=t.toString().replace(/^[^.]*\.?/,"").length;return n===1&&i===0?1:5}var RK=["en",[["a","p"],["AM","PM"]],[["AM","PM"]],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],bE,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],bE,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",bE,"{1} 'at' {0}",bE],[".",",",";","%","+","-","E","\xD7","\u2030","\u221E","NaN",":"],["#,##0.###","#,##0%","\xA4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",OK],qx={};function EP(t,n,i){typeof n!="string"&&(i=n,n=t[qo.LocaleId]),n=n.toLowerCase().replace(/_/g,"-"),qx[n]=t,i&&(qx[n][qo.ExtraData]=i)}function rc(t){let n=kK(t),i=AB(n);if(i)return i;let l=n.split("-")[0];if(i=AB(l),i)return i;if(l==="en")return RK;throw new bn(701,!1)}function AB(t){return t in qx||(qx[t]=mu.ng&&mu.ng.common&&mu.ng.common.locales&&mu.ng.common.locales[t]),qx[t]}var qo=(function(t){return t[t.LocaleId=0]="LocaleId",t[t.DayPeriodsFormat=1]="DayPeriodsFormat",t[t.DayPeriodsStandalone=2]="DayPeriodsStandalone",t[t.DaysFormat=3]="DaysFormat",t[t.DaysStandalone=4]="DaysStandalone",t[t.MonthsFormat=5]="MonthsFormat",t[t.MonthsStandalone=6]="MonthsStandalone",t[t.Eras=7]="Eras",t[t.FirstDayOfWeek=8]="FirstDayOfWeek",t[t.WeekendRange=9]="WeekendRange",t[t.DateFormat=10]="DateFormat",t[t.TimeFormat=11]="TimeFormat",t[t.DateTimeFormat=12]="DateTimeFormat",t[t.NumberSymbols=13]="NumberSymbols",t[t.NumberFormats=14]="NumberFormats",t[t.CurrencyCode=15]="CurrencyCode",t[t.CurrencySymbol=16]="CurrencySymbol",t[t.CurrencyName=17]="CurrencyName",t[t.Currencies=18]="Currencies",t[t.Directionality=19]="Directionality",t[t.PluralCase=20]="PluralCase",t[t.ExtraData=21]="ExtraData",t})(qo||{});function kK(t){return t.toLowerCase().replace(/_/g,"-")}var cb="en-US";var FK=cb;function bV(t){typeof t=="string"&&(FK=t.toLowerCase().replace(/_/g,"-"))}function Ot(t,n,i){let l=hi(),h=Ds(),o=na();return wV(h,l,l[Ao],o,t,n,i),Ot}function wV(t,n,i,l,h,o,E){let A=!0,L=null;if((l.type&3||E)&&(L??=QM(l,n,o),vY(l,t,n,E,i,h,o,L)&&(A=!1)),A){let Y=l.outputs?.[h],le=l.hostDirectiveOutputs?.[h];if(le&&le.length)for(let te=0;te<le.length;te+=2){let ze=le[te],Ae=le[te+1];L??=QM(l,n,o),_B(l,n,ze,Ae,h,L)}if(Y&&Y.length)for(let te of Y)L??=QM(l,n,o),_B(l,n,te,h,h,L)}}function Ne(t=1){return Gz(t)}function TP(t,n,i){UY(t,n,i)}function fT(t){let n=hi(),i=Ds(),l=jM();uE(l+1);let h=fP(i,l);if(t.dirty&&Sz(n)===((h.metadata.flags&2)===2)){if(h.matches===null)t.reset([]);else{let o=GY(n,l);t.reset(o,lZ),t.notifyOnChanges()}return!0}return!1}function pT(){return jY(hi(),jM())}function Pl(t){let n=Lz();return Nx(n,Go+t)}function wE(t,n){return t<<17|n<<2}function Qm(t){return t>>17&32767}function LK(t){return(t&2)==2}function NK(t,n){return t&131071|n<<17}function BA(t){return t|2}function D0(t){return(t&131068)>>2}function iA(t,n){return t&-131069|n<<2}function zK(t){return(t&1)===1}function jA(t){return t|1}function BK(t,n,i,l,h,o){let E=o?n.classBindings:n.styleBindings,A=Qm(E),L=D0(E);t[l]=i;let Y=!1,le;if(Array.isArray(i)){let te=i;le=te[1],(le===null||f0(te,le)>0)&&(Y=!0)}else le=i;if(h)if(L!==0){let ze=Qm(t[A+1]);t[l+1]=wE(ze,A),ze!==0&&(t[ze+1]=iA(t[ze+1],l)),t[A+1]=NK(t[A+1],l)}else t[l+1]=wE(A,0),A!==0&&(t[A+1]=iA(t[A+1],l)),A=l;else t[l+1]=wE(L,0),A===0?A=l:t[L+1]=iA(t[L+1],l),L=l;Y&&(t[l+1]=BA(t[l+1])),PB(t,le,l,!0),PB(t,le,l,!1),jK(n,le,t,l,o),E=wE(A,L),o?n.classBindings=E:n.styleBindings=E}function jK(t,n,i,l,h){let o=h?t.residualClasses:t.residualStyles;o!=null&&typeof n=="string"&&f0(o,n)>=0&&(i[l+1]=jA(i[l+1]))}function PB(t,n,i,l){let h=t[i+1],o=n===null,E=l?Qm(h):D0(h),A=!1;for(;E!==0&&(A===!1||o);){let L=t[E],Y=t[E+1];VK(L,n)&&(A=!0,t[E+1]=l?jA(Y):BA(Y)),E=l?Qm(Y):D0(Y)}A&&(t[i+1]=l?BA(h):jA(h))}function VK(t,n){return t===null||n==null||(Array.isArray(t)?t[1]:t)===n?!0:Array.isArray(t)&&typeof n=="string"?f0(t,n)>=0:!1}var Cu={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function UK(t){return t.substring(Cu.key,Cu.keyEnd)}function HK(t){return $K(t),CV(t,EV(t,0,Cu.textEnd))}function CV(t,n){let i=Cu.textEnd;return i===n?-1:(n=Cu.keyEnd=GK(t,Cu.key=n,i),EV(t,n,i))}function $K(t){Cu.key=0,Cu.keyEnd=0,Cu.value=0,Cu.valueEnd=0,Cu.textEnd=t.length}function EV(t,n,i){for(;n<i&&t.charCodeAt(n)<=32;)n++;return n}function GK(t,n,i){for(;n<i&&t.charCodeAt(n)>32;)n++;return n}function ub(t,n,i){return TV(t,n,i,!1),ub}function Dn(t,n){return TV(t,n,null,!0),Dn}function Ta(t){WK(QK,qK,t,!0)}function qK(t,n){for(let i=HK(n);i>=0;i=CV(n,i))iE(t,UK(n),!0)}function TV(t,n,i,l){let h=hi(),o=Ds(),E=Bx(2);if(o.firstUpdatePass&&DV(o,t,E,l),n!==Ea&&nc(h,E,n)){let A=o.data[xu()];IV(o,A,h,h[Ao],t,h[E+1]=tJ(n,i),l,E)}}function WK(t,n,i,l){let h=Ds(),o=Bx(2);h.firstUpdatePass&&DV(h,null,o,l);let E=hi();if(i!==Ea&&nc(E,o,i)){let A=h.data[xu()];if(MV(A,l)&&!SV(h,o)){let L=l?A.classesWithoutHost:A.stylesWithoutHost;L!==null&&(i=QC(L,i||"")),zA(h,A,E,i,l)}else eJ(h,A,E,E[Ao],E[o+1],E[o+1]=JK(t,n,i),l,o)}}function SV(t,n){return n>=t.expandoStartIndex}function DV(t,n,i,l){let h=t.data;if(h[i+1]===null){let o=h[xu()],E=SV(t,i);MV(o,l)&&n===null&&!E&&(n=!1),n=ZK(h,o,n,l),BK(h,o,n,i,E,l)}}function ZK(t,n,i,l){let h=Vz(t),o=l?n.residualClasses:n.residualStyles;if(h===null)(l?n.classBindings:n.styleBindings)===0&&(i=rA(null,t,n,i,l),i=Qx(i,n.attrs,l),o=null);else{let E=n.directiveStylingLast;if(E===-1||t[E]!==h)if(i=rA(h,t,n,i,l),o===null){let L=XK(t,n,l);L!==void 0&&Array.isArray(L)&&(L=rA(null,t,n,L[1],l),L=Qx(L,n.attrs,l),YK(t,n,l,L))}else o=KK(t,n,l)}return o!==void 0&&(l?n.residualClasses=o:n.residualStyles=o),i}function XK(t,n,i){let l=i?n.classBindings:n.styleBindings;if(D0(l)!==0)return t[Qm(l)]}function YK(t,n,i,l){let h=i?n.classBindings:n.styleBindings;t[Qm(h)]=l}function KK(t,n,i){let l,h=n.directiveEnd;for(let o=1+n.directiveStylingLast;o<h;o++){let E=t[o].hostAttrs;l=Qx(l,E,i)}return Qx(l,n.attrs,i)}function rA(t,n,i,l,h){let o=null,E=i.directiveEnd,A=i.directiveStylingLast;for(A===-1?A=i.directiveStart:A++;A<E&&(o=n[A],l=Qx(l,o.hostAttrs,h),o!==t);)A++;return t!==null&&(i.directiveStylingLast=A),l}function Qx(t,n,i){let l=i?1:2,h=-1;if(n!==null)for(let o=0;o<n.length;o++){let E=n[o];typeof E=="number"?h=E:h===l&&(Array.isArray(t)||(t=t===void 0?[]:["",t]),iE(t,E,i?!0:n[++o]))}return t===void 0?null:t}function JK(t,n,i){if(i==null||i==="")return fl;let l=[],h=eg(i);if(Array.isArray(h))for(let o=0;o<h.length;o++)t(l,h[o],!0);else if(typeof h=="object")for(let o in h)h.hasOwnProperty(o)&&t(l,o,h[o]);else typeof h=="string"&&n(l,h);return l}function QK(t,n,i){let l=String(n);l!==""&&!l.includes(" ")&&iE(t,l,i)}function eJ(t,n,i,l,h,o,E,A){h===Ea&&(h=fl);let L=0,Y=0,le=0<h.length?h[0]:null,te=0<o.length?o[0]:null;for(;le!==null||te!==null;){let ze=L<h.length?h[L+1]:void 0,Ae=Y<o.length?o[Y+1]:void 0,Be=null,Tt;le===te?(L+=2,Y+=2,ze!==Ae&&(Be=te,Tt=Ae)):te===null||le!==null&&le<te?(L+=2,Be=le):(Y+=2,Be=te,Tt=Ae),Be!==null&&IV(t,n,i,l,Be,Tt,E,A),le=L<h.length?h[L]:null,te=Y<o.length?o[Y]:null}}function IV(t,n,i,l,h,o,E,A){if(!(n.type&3))return;let L=t.data,Y=L[A+1],le=zK(Y)?OB(L,n,i,h,D0(Y),E):void 0;if(!WE(le)){WE(o)||LK(Y)&&(o=OB(L,null,i,h,A,E));let te=EM(xu(),i);bX(l,E,te,h,o)}}function OB(t,n,i,l,h,o){let E=n===null,A;for(;h>0;){let L=t[h],Y=Array.isArray(L),le=Y?L[1]:L,te=le===null,ze=i[h+1];ze===Ea&&(ze=te?fl:void 0);let Ae=te?rE(ze,l):le===l?ze:void 0;if(Y&&!WE(Ae)&&(Ae=rE(L,l)),WE(Ae)&&(A=Ae,E))return A;let Be=t[h+1];h=E?Qm(Be):D0(Be)}if(n!==null){let L=o?n.residualClasses:n.residualStyles;L!=null&&(A=rE(L,l))}return A}function WE(t){return t!==void 0}function tJ(t,n){return t==null||t===""||(typeof n=="string"?t=t+n:typeof t=="object"&&(t=Oh(eg(t)))),t}function MV(t,n){return(t.flags&(n?8:16))!==0}function ne(t,n=""){let i=hi(),l=Ds(),h=t+Go,o=l.firstCreatePass?ob(l,h,1,n,null):l.data[h],E=nJ(l,i,o,n,t);i[h]=E,pE()&&oP(l,i,E,o),y0(o,!1)}var nJ=(t,n,i,l,h)=>(mE(!0),ZZ(n[Ao],l));function AV(t,n,i,l=""){return nc(t,qm(),i)?n+gu(i)+l:Ea}function iJ(t,n,i,l,h,o=""){let E=BM(),A=Kx(t,E,i,h);return Bx(2),A?n+gu(i)+l+gu(h)+o:Ea}function rJ(t,n,i,l,h,o,E,A=""){let L=BM(),Y=nV(t,L,i,h,E);return Bx(3),Y?n+gu(i)+l+gu(h)+o+gu(E)+A:Ea}function Ln(t){return nn("",t),Ln}function nn(t,n,i){let l=hi(),h=AV(l,t,n,i);return h!==Ea&&SP(l,xu(),h),nn}function ps(t,n,i,l,h){let o=hi(),E=iJ(o,t,n,i,l,h);return E!==Ea&&SP(o,xu(),E),ps}function mp(t,n,i,l,h,o,E){let A=hi(),L=rJ(A,t,n,i,l,h,o,E);return L!==Ea&&SP(A,xu(),L),mp}function SP(t,n,i){let l=EM(n,t);XZ(t[Ao],l,i)}function Ol(t,n,i){qM(n)&&(n=n());let l=hi(),h=qm();if(nc(l,h,n)){let o=Ds(),E=fE();Oj(E,l,t,n,l[Ao],i)}return Ol}function oc(t,n){let i=qM(t);return i&&t.set(n),i}function Rl(t,n){let i=hi(),l=Ds(),h=na();return wV(l,i,i[Ao],h,t,n),Rl}function Tu(t,n,i=""){return AV(hi(),t,n,i)}function oJ(t,n,i){let l=Ds();if(l.firstCreatePass){let h=Td(t);VA(i,l.data,l.blueprint,h,!0),VA(n,l.data,l.blueprint,h,!1)}}function VA(t,n,i,l,h){if(t=xa(t),Array.isArray(t))for(let o=0;o<t.length;o++)VA(t[o],n,i,l,h);else{let o=Ds(),E=hi(),A=na(),L=Nm(t)?t:xa(t.provide),Y=yM(t),le=A.providerIndexes&1048575,te=A.directiveStart,ze=A.providerIndexes>>20;if(Nm(t)||!t.multi){let Ae=new Zm(Y,h,wt,null),Be=sA(L,n,h?le:le+ze,te);Be===-1?(lA(PE(A,E),o,L),oA(o,t,n.length),n.push(L),A.directiveStart++,A.directiveEnd++,h&&(A.providerIndexes+=1048576),i.push(Ae),E.push(Ae)):(i[Be]=Ae,E[Be]=Ae)}else{let Ae=sA(L,n,le+ze,te),Be=sA(L,n,le,le+ze),Tt=Ae>=0&&i[Ae],ot=Be>=0&&i[Be];if(h&&!ot||!h&&!Tt){lA(PE(A,E),o,L);let kt=lJ(h?aJ:sJ,i.length,h,l,Y,t);!h&&ot&&(i[Be].providerFactory=kt),oA(o,t,n.length,0),n.push(L),A.directiveStart++,A.directiveEnd++,h&&(A.providerIndexes+=1048576),i.push(kt),E.push(kt)}else{let kt=PV(i[h?Be:Ae],Y,!h&&l);oA(o,t,Ae>-1?Ae:Be,kt)}!h&&l&&ot&&i[Be].componentProviders++}}}function oA(t,n,i,l){let h=Nm(n),o=bz(n);if(h||o){let L=(o?xa(n.useClass):n).prototype.ngOnDestroy;if(L){let Y=t.destroyHooks||(t.destroyHooks=[]);if(!h&&n.multi){let le=Y.indexOf(i);le===-1?Y.push(i,[l,L]):Y[le+1].push(l,L)}else Y.push(i,L)}}}function PV(t,n,i){return i&&t.componentProviders++,t.multi.push(n)-1}function sA(t,n,i,l){for(let h=i;h<l;h++)if(n[h]===t)return h;return-1}function sJ(t,n,i,l,h){return UA(this.multi,[])}function aJ(t,n,i,l,h){let o=this.multi,E;if(this.providerFactory){let A=this.providerFactory.componentProviders,L=Wx(l,l[vi],this.providerFactory.index,h);E=L.slice(0,A),UA(o,E);for(let Y=A;Y<L.length;Y++)E.push(L[Y])}else E=[],UA(o,E);return E}function UA(t,n){for(let i=0;i<t.length;i++){let l=t[i];n.push(l())}return n}function lJ(t,n,i,l,h,o){let E=new Zm(t,i,wt,null);return E.multi=[],E.index=n,E.componentProviders=0,PV(E,h,l&&!i),E}function Va(t,n=[]){return i=>{i.providersResolver=(l,h)=>oJ(l,h?h(t):t,n)}}function ms(t,n,i){let l=Sd()+t,h=hi();return h[l]===Ea?A0(h,l,i?n.call(i):n()):gY(h,l)}function ao(t,n,i,l){return OV(hi(),Sd(),t,n,i,l)}function Su(t,n,i,l,h){return RV(hi(),Sd(),t,n,i,l,h)}function DP(t,n,i,l,h,o){return kV(hi(),Sd(),t,n,i,l,h,o)}function IP(t,n,i,l,h,o,E){return cJ(hi(),Sd(),t,n,i,l,h,o,E)}function MP(t,n,i,l){return uJ(hi(),Sd(),t,n,i,l)}function db(t,n){let i=t[n];return i===Ea?void 0:i}function OV(t,n,i,l,h,o){let E=n+i;return nc(t,E,h)?A0(t,E+1,o?l.call(o,h):l(h)):db(t,E+1)}function RV(t,n,i,l,h,o,E){let A=n+i;return Kx(t,A,h,o)?A0(t,A+2,E?l.call(E,h,o):l(h,o)):db(t,A+2)}function kV(t,n,i,l,h,o,E,A){let L=n+i;return nV(t,L,h,o,E)?A0(t,L+3,A?l.call(A,h,o,E):l(h,o,E)):db(t,L+3)}function cJ(t,n,i,l,h,o,E,A,L){let Y=n+i;return _Y(t,Y,h,o,E,A)?A0(t,Y+4,L?l.call(L,h,o,E,A):l(h,o,E,A)):db(t,Y+4)}function uJ(t,n,i,l,h,o){let E=n+i,A=!1;for(let L=0;L<h.length;L++)nc(t,E++,h[L])&&(A=!0);return A?A0(t,E,l.apply(o,h)):db(t,E)}function gs(t,n){let i=Ds(),l,h=t+Go;i.firstCreatePass?(l=dJ(n,i.pipeRegistry),i.data[h]=l,l.onDestroy&&(i.destroyHooks??=[]).push(h,l.onDestroy)):l=i.data[h];let o=l.factory||(l.factory=op(l.type,!0)),E,A=hl(wt);try{let L=AE(!1),Y=o();return AE(L),TM(i,hi(),h,Y),Y}finally{hl(A)}}function dJ(t,n){if(n)for(let i=n.length-1;i>=0;i--){let l=n[i];if(t===l.name)return l}}function R0(t,n,i){let l=t+Go,h=hi(),o=Nx(h,l);return AP(h,l)?OV(h,Sd(),n,o.transform,i,o):o.transform(i)}function kl(t,n,i,l){let h=t+Go,o=hi(),E=Nx(o,h);return AP(o,h)?RV(o,Sd(),n,E.transform,i,l,E):E.transform(i,l)}function ig(t,n,i,l,h){let o=t+Go,E=hi(),A=Nx(E,o);return AP(E,o)?kV(E,Sd(),n,A.transform,i,l,h,A):A.transform(i,l,h)}function AP(t,n){return t[vi].data[n].pure}function gp(t,n){return aT(t,n)}var ZE=class{ngModuleFactory;componentFactories;constructor(n,i){this.ngModuleFactory=n,this.componentFactories=i}},PP=(()=>{class t{compileModuleSync(i){return new jE(i)}compileModuleAsync(i){return Promise.resolve(this.compileModuleSync(i))}compileModuleAndAllComponentsSync(i){let l=this.compileModuleSync(i),h=mM(i),o=_j(h.declarations).reduce((E,A)=>{let L=Fh(A);return L&&E.push(new Km(L)),E},[]);return new ZE(l,o)}compileModuleAndAllComponentsAsync(i){return Promise.resolve(this.compileModuleAndAllComponentsSync(i))}clearCache(){}clearCacheFor(i){}getModuleId(i){}static \u0275fac=function(l){return new(l||t)};static \u0275prov=Qt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var hJ=(()=>{class t{zone=ft(so);changeDetectionScheduler=ft(Rh);applicationRef=ft(jh);applicationErrorHandler=ft(pl);_onMicrotaskEmptySubscription;initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{try{this.applicationRef.dirtyFlags|=1,this.applicationRef._tick()}catch(i){this.applicationErrorHandler(i)}})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static \u0275fac=function(l){return new(l||t)};static \u0275prov=Qt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),FV=new Sn("",{factory:()=>!1});function OP({ngZoneFactory:t,ignoreChangesOutsideZone:n,scheduleInRootZone:i}){return t??=()=>new so(Mi(Jt({},kP()),{scheduleInRootZone:i})),[{provide:so,useFactory:t},{provide:kh,multi:!0,useFactory:()=>{let l=ft(hJ,{optional:!0});return()=>l.initialize()}},{provide:kh,multi:!0,useFactory:()=>{let l=ft(fJ);return()=>{l.initialize()}}},n===!0?{provide:WM,useValue:!0}:[],{provide:ZM,useValue:i??dV},{provide:pl,useFactory:()=>{let l=ft(so),h=ft(ds),o;return E=>{l.runOutsideAngular(()=>{h.destroyed&&!o?setTimeout(()=>{throw E}):(o??=h.get(pu),o.handleError(E))})}}}]}function RP(t){let n=t?.ignoreChangesOutsideZone,i=t?.scheduleInRootZone,l=OP({ngZoneFactory:()=>{let h=kP(t);return h.scheduleInRootZone=i,h.shouldCoalesceEventChangeDetection&&ic("NgZone_CoalesceEvent"),new so(h)},ignoreChangesOutsideZone:n,scheduleInRootZone:i});return bd([{provide:FV,useValue:!0},{provide:jx,useValue:!1},l])}function kP(t){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:t?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:t?.runCoalescing??!1}}var fJ=(()=>{class t{subscription=new Jo;initialized=!1;zone=ft(so);pendingTasks=ft(Dd);initialize(){if(this.initialized)return;this.initialized=!0;let i=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(i=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{so.assertNotInAngularZone(),queueMicrotask(()=>{i!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(i),i=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{so.assertInAngularZone(),i??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static \u0275fac=function(l){return new(l||t)};static \u0275prov=Qt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var LV=(()=>{class t{applicationErrorHandler=ft(pl);appRef=ft(jh);taskService=ft(Dd);ngZone=ft(so);zonelessEnabled=ft(jx);tracing=ft(tg,{optional:!0});disableScheduling=ft(WM,{optional:!0})??!1;zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run;schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}];subscriptions=new Jo;angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(UE):null;scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(ft(ZM,{optional:!0})??!1);cancelScheduledCallback=null;useMicrotaskScheduler=!1;runningTick=!1;pendingRenderTaskId=null;constructor(){this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof HE||!this.zoneIsDefined)}notify(i){if(!this.zonelessEnabled&&i===5)return;let l=!1;switch(i){case 0:{this.appRef.dirtyFlags|=2;break}case 3:case 2:case 4:case 5:case 1:{this.appRef.dirtyFlags|=4;break}case 6:{this.appRef.dirtyFlags|=2,l=!0;break}case 12:{this.appRef.dirtyFlags|=16,l=!0;break}case 13:{this.appRef.dirtyFlags|=2,l=!0;break}case 11:{l=!0;break}case 9:case 8:case 7:case 10:default:this.appRef.dirtyFlags|=8}if(this.appRef.tracingSnapshot=this.tracing?.snapshot(this.appRef.tracingSnapshot)??null,!this.shouldScheduleTick(l))return;let h=this.useMicrotaskScheduler?wB:hV;this.pendingRenderTaskId=this.taskService.add(),this.scheduleInRootZone?this.cancelScheduledCallback=Zone.root.run(()=>h(()=>this.tick())):this.cancelScheduledCallback=this.ngZone.runOutsideAngular(()=>h(()=>this.tick()))}shouldScheduleTick(i){return!(this.disableScheduling&&!i||this.appRef.destroyed||this.pendingRenderTaskId!==null||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(UE+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;if(this.appRef.dirtyFlags===0){this.cleanup();return}!this.zonelessEnabled&&this.appRef.dirtyFlags&7&&(this.appRef.dirtyFlags|=1);let i=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(l){this.taskService.remove(i),this.applicationErrorHandler(l)}finally{this.cleanup()}this.useMicrotaskScheduler=!0,wB(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(i)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,this.pendingRenderTaskId!==null){let i=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(i)}}static \u0275fac=function(l){return new(l||t)};static \u0275prov=Qt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function pJ(){return typeof $localize<"u"&&$localize.locale||cb}var Du=new Sn("",{providedIn:"root",factory:()=>ft(Du,{optional:!0,skipSelf:!0})||pJ()});function oa(t){return sz(t)}function k0(t,n){return bC(t,n?.equal)}var NV=class{[Ba];constructor(n){this[Ba]=n}destroy(){this[Ba].destroy()}};var UV=Symbol("InputSignalNode#UNSET"),MJ=Mi(Jt({},wC),{transformFn:void 0,applyValueToInputSignal(t,n){Q_(t,n)}});function HV(t,n){let i=Object.create(MJ);i.value=t,i.transformFn=n?.transform;function l(){if(Y_(i),i.value===UV){let h=null;throw new bn(-950,h)}return i.value}return l[Ba]=i,l}var gT=class{attributeName;constructor(n){this.attributeName=n}__NG_ELEMENT_ID__=()=>tb(this.attributeName);toString(){return`HostAttributeToken ${this.attributeName}`}},AJ=new Sn("");AJ.__NG_ELEMENT_ID__=t=>{let n=na();if(n===null)throw new bn(204,!1);if(n.type&2)return n.value;if(t&8)return null;throw new bn(204,!1)};function zV(t,n){return HV(t,n)}function PJ(t){return HV(UV,t)}var $V=(zV.required=PJ,zV);var FP=new Sn(""),OJ=new Sn("");function hb(t){return!t.moduleRef}function RJ(t){let n=hb(t)?t.r3Injector:t.moduleRef.injector,i=n.get(so);return i.run(()=>{hb(t)?t.r3Injector.resolveInjectorInitializers():t.moduleRef.resolveInjectorInitializers();let l=n.get(pl),h;if(i.runOutsideAngular(()=>{h=i.onError.subscribe({next:l})}),hb(t)){let o=()=>n.destroy(),E=t.platformInjector.get(FP);E.add(o),n.onDestroy(()=>{h.unsubscribe(),E.delete(o)})}else{let o=()=>t.moduleRef.destroy(),E=t.platformInjector.get(FP);E.add(o),t.moduleRef.onDestroy(()=>{Hx(t.allPlatformModules,t.moduleRef),h.unsubscribe(),E.delete(o)})}return FJ(l,i,()=>{let o=n.get(Dd),E=o.add(),A=n.get(bP);return A.runInitializers(),A.donePromise.then(()=>{let L=n.get(Du,cb);if(bV(L||cb),!n.get(OJ,!0))return hb(t)?n.get(jh):(t.allPlatformModules.push(t.moduleRef),t.moduleRef);if(hb(t)){let le=n.get(jh);return t.rootComponent!==void 0&&le.bootstrap(t.rootComponent),le}else return kJ?.(t.moduleRef,t.allPlatformModules),t.moduleRef}).finally(()=>void o.remove(E))})})}var kJ;function FJ(t,n,i){try{let l=i();return pp(l)?l.catch(h=>{throw n.runOutsideAngular(()=>t(h)),h}):l}catch(l){throw n.runOutsideAngular(()=>t(l)),l}}var mT=null;function LJ(t=[],n){return ba.create({name:n,providers:[{provide:Ax,useValue:"platform"},{provide:FP,useValue:new Set([()=>mT=null])},...t]})}function NJ(t=[]){if(mT)return mT;let n=LJ(t);return mT=n,vV(),zJ(n),n}function zJ(t){let n=t.get(YE,null);ta(t,()=>{n?.forEach(i=>i())})}var Md=(()=>{class t{static __NG_ELEMENT_ID__=BJ}return t})();function BJ(t){return jJ(na(),hi(),(t&16)===16)}function jJ(t,n,i){if(dp(t)&&!i){let l=Ac(t.index,n);return new fp(l,l)}else if(t.type&175){let l=n[Ql];return new fp(l,n)}return null}var LP=class{constructor(){}supports(n){return n instanceof Map||hP(n)}create(){return new NP}},NP=class{_records=new Map;_mapHead=null;_appendAfter=null;_previousMapHead=null;_changesHead=null;_changesTail=null;_additionsHead=null;_additionsTail=null;_removalsHead=null;_removalsTail=null;get isDirty(){return this._additionsHead!==null||this._changesHead!==null||this._removalsHead!==null}forEachItem(n){let i;for(i=this._mapHead;i!==null;i=i._next)n(i)}forEachPreviousItem(n){let i;for(i=this._previousMapHead;i!==null;i=i._nextPrevious)n(i)}forEachChangedItem(n){let i;for(i=this._changesHead;i!==null;i=i._nextChanged)n(i)}forEachAddedItem(n){let i;for(i=this._additionsHead;i!==null;i=i._nextAdded)n(i)}forEachRemovedItem(n){let i;for(i=this._removalsHead;i!==null;i=i._nextRemoved)n(i)}diff(n){if(!n)n=new Map;else if(!(n instanceof Map||hP(n)))throw new bn(900,!1);return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let i=this._mapHead;if(this._appendAfter=null,this._forEach(n,(l,h)=>{if(i&&i.key===h)this._maybeAddToChanges(i,l),this._appendAfter=i,i=i._next;else{let o=this._getOrCreateRecordForKey(h,l);i=this._insertBeforeOrAppend(i,o)}}),i){i._prev&&(i._prev._next=null),this._removalsHead=i;for(let l=i;l!==null;l=l._nextRemoved)l===this._mapHead&&(this._mapHead=null),this._records.delete(l.key),l._nextRemoved=l._next,l.previousValue=l.currentValue,l.currentValue=null,l._prev=null,l._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(n,i){if(n){let l=n._prev;return i._next=n,i._prev=l,n._prev=i,l&&(l._next=i),n===this._mapHead&&(this._mapHead=i),this._appendAfter=n,n}return this._appendAfter?(this._appendAfter._next=i,i._prev=this._appendAfter):this._mapHead=i,this._appendAfter=i,null}_getOrCreateRecordForKey(n,i){if(this._records.has(n)){let h=this._records.get(n);this._maybeAddToChanges(h,i);let o=h._prev,E=h._next;return o&&(o._next=E),E&&(E._prev=o),h._next=null,h._prev=null,h}let l=new zP(n);return this._records.set(n,l),l.currentValue=i,this._addToAdditions(l),l}_reset(){if(this.isDirty){let n;for(this._previousMapHead=this._mapHead,n=this._previousMapHead;n!==null;n=n._next)n._nextPrevious=n._next;for(n=this._changesHead;n!==null;n=n._nextChanged)n.previousValue=n.currentValue;for(n=this._additionsHead;n!=null;n=n._nextAdded)n.previousValue=n.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(n,i){Object.is(i,n.currentValue)||(n.previousValue=n.currentValue,n.currentValue=i,this._addToChanges(n))}_addToAdditions(n){this._additionsHead===null?this._additionsHead=this._additionsTail=n:(this._additionsTail._nextAdded=n,this._additionsTail=n)}_addToChanges(n){this._changesHead===null?this._changesHead=this._changesTail=n:(this._changesTail._nextChanged=n,this._changesTail=n)}_forEach(n,i){n instanceof Map?n.forEach(i):Object.keys(n).forEach(l=>i(n[l],l))}},zP=class{key;previousValue=null;currentValue=null;_nextPrevious=null;_next=null;_prev=null;_nextAdded=null;_nextRemoved=null;_nextChanged=null;constructor(n){this.key=n}};function BV(){return new BP([new LP])}var BP=(()=>{class t{static \u0275prov=Qt({token:t,providedIn:"root",factory:BV});factories;constructor(i){this.factories=i}static create(i,l){if(l){let h=l.factories.slice();i=i.concat(h)}return new t(i)}static extend(i){return{provide:t,useFactory:()=>{let l=ft(t,{optional:!0,skipSelf:!0});return t.create(i,l||BV())}}}find(i){let l=this.factories.find(h=>h.supports(i));if(l)return l;throw new bn(901,!1)}}return t})();function GV(t){let{rootComponent:n,appProviders:i,platformProviders:l,platformRef:h}=t;ro(8);try{let o=h?.injector??NJ(l),E=[OP({}),{provide:Rh,useExisting:LV},Zz,...i||[]],A=new Jx({providers:E,parent:o,debugName:"",runEnvironmentInitializers:!1});return RJ({r3Injector:A.injector,platformInjector:o,rootComponent:n})}catch(o){return Promise.reject(o)}finally{ro(9)}}function _p(t){return typeof t=="boolean"?t:t!=null&&t!=="false"}function qV(t){let n=Fh(t);if(!n)return null;let i=new Km(n);return{get selector(){return i.selector},get type(){return i.componentType},get inputs(){return i.inputs},get outputs(){return i.outputs},get ngContentSelectors(){return i.ngContentSelectors},get isStandalone(){return n.standalone},get isSignal(){return n.signals}}}var XV=null;function Rc(){return XV}function jP(t){XV??=t}var fb=class{},pb=(()=>{class t{historyGo(i){throw new Error("")}static \u0275fac=function(l){return new(l||t)};static \u0275prov=Qt({token:t,factory:()=>ft(YV),providedIn:"platform"})}return t})(),VP=new Sn(""),YV=(()=>{class t extends pb{_location;_history;_doc=ft(_o);constructor(){super(),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Rc().getBaseHref(this._doc)}onPopState(i){let l=Rc().getGlobalEventTarget(this._doc,"window");return l.addEventListener("popstate",i,!1),()=>l.removeEventListener("popstate",i)}onHashChange(i){let l=Rc().getGlobalEventTarget(this._doc,"window");return l.addEventListener("hashchange",i,!1),()=>l.removeEventListener("hashchange",i)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(i){this._location.pathname=i}pushState(i,l,h){this._history.pushState(i,l,h)}replaceState(i,l,h){this._history.replaceState(i,l,h)}forward(){this._history.forward()}back(){this._history.back()}historyGo(i=0){this._history.go(i)}getState(){return this._history.state}static \u0275fac=function(l){return new(l||t)};static \u0275prov=Qt({token:t,factory:()=>new t,providedIn:"platform"})}return t})();function _T(t,n){return t?n?t.endsWith("/")?n.startsWith("/")?t+n.slice(1):t+n:n.startsWith("/")?t+n:`${t}/${n}`:t:n}function WV(t){let n=t.search(/#|\?|$/);return t[n-1]==="/"?t.slice(0,n-1)+t.slice(n):t}function Iu(t){return t&&t[0]!=="?"?`?${t}`:t}var Mu=(()=>{class t{historyGo(i){throw new Error("")}static \u0275fac=function(l){return new(l||t)};static \u0275prov=Qt({token:t,factory:()=>ft(yT),providedIn:"root"})}return t})(),vT=new Sn(""),yT=(()=>{class t extends Mu{_platformLocation;_baseHref;_removeListenerFns=[];constructor(i,l){super(),this._platformLocation=i,this._baseHref=l??this._platformLocation.getBaseHrefFromDOM()??ft(_o).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(i){this._removeListenerFns.push(this._platformLocation.onPopState(i),this._platformLocation.onHashChange(i))}getBaseHref(){return this._baseHref}prepareExternalUrl(i){return _T(this._baseHref,i)}path(i=!1){let l=this._platformLocation.pathname+Iu(this._platformLocation.search),h=this._platformLocation.hash;return h&&i?`${l}${h}`:l}pushState(i,l,h,o){let E=this.prepareExternalUrl(h+Iu(o));this._platformLocation.pushState(i,l,E)}replaceState(i,l,h,o){let E=this.prepareExternalUrl(h+Iu(o));this._platformLocation.replaceState(i,l,E)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(i=0){this._platformLocation.historyGo?.(i)}static \u0275fac=function(l){return new(l||t)(gn(pb),gn(vT,8))};static \u0275prov=Qt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),Fl=(()=>{class t{_subject=new Fn;_basePath;_locationStrategy;_urlChangeListeners=[];_urlChangeSubscription=null;constructor(i){this._locationStrategy=i;let l=this._locationStrategy.getBaseHref();this._basePath=HJ(WV(ZV(l))),this._locationStrategy.onPopState(h=>{this._subject.next({url:this.path(!0),pop:!0,state:h.state,type:h.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(i=!1){return this.normalize(this._locationStrategy.path(i))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(i,l=""){return this.path()==this.normalize(i+Iu(l))}normalize(i){return t.stripTrailingSlash(UJ(this._basePath,ZV(i)))}prepareExternalUrl(i){return i&&i[0]!=="/"&&(i="/"+i),this._locationStrategy.prepareExternalUrl(i)}go(i,l="",h=null){this._locationStrategy.pushState(h,"",i,l),this._notifyUrlChangeListeners(this.prepareExternalUrl(i+Iu(l)),h)}replaceState(i,l="",h=null){this._locationStrategy.replaceState(h,"",i,l),this._notifyUrlChangeListeners(this.prepareExternalUrl(i+Iu(l)),h)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(i=0){this._locationStrategy.historyGo?.(i)}onUrlChange(i){return this._urlChangeListeners.push(i),this._urlChangeSubscription??=this.subscribe(l=>{this._notifyUrlChangeListeners(l.url,l.state)}),()=>{let l=this._urlChangeListeners.indexOf(i);this._urlChangeListeners.splice(l,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(i="",l){this._urlChangeListeners.forEach(h=>h(i,l))}subscribe(i,l,h){return this._subject.subscribe({next:i,error:l??void 0,complete:h??void 0})}static normalizeQueryParams=Iu;static joinWithSlash=_T;static stripTrailingSlash=WV;static \u0275fac=function(l){return new(l||t)(gn(Mu))};static \u0275prov=Qt({token:t,factory:()=>VJ(),providedIn:"root"})}return t})();function VJ(){return new Fl(gn(Mu))}function UJ(t,n){if(!t||!n.startsWith(t))return n;let i=n.substring(t.length);return i===""||["/",";","?","#"].includes(i[0])?i:n}function ZV(t){return t.replace(/\/index.html$/,"")}function HJ(t){if(new RegExp("^(https?:)?//").test(t)){let[,i]=t.split(/\/\/[^\/]+/);return i}return t}var qP=(()=>{class t extends Mu{_platformLocation;_baseHref="";_removeListenerFns=[];constructor(i,l){super(),this._platformLocation=i,l!=null&&(this._baseHref=l)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(i){this._removeListenerFns.push(this._platformLocation.onPopState(i),this._platformLocation.onHashChange(i))}getBaseHref(){return this._baseHref}path(i=!1){let l=this._platformLocation.hash??"#";return l.length>0?l.substring(1):l}prepareExternalUrl(i){let l=_T(this._baseHref,i);return l.length>0?"#"+l:l}pushState(i,l,h,o){let E=this.prepareExternalUrl(h+Iu(o))||this._platformLocation.pathname;this._platformLocation.pushState(i,l,E)}replaceState(i,l,h,o){let E=this.prepareExternalUrl(h+Iu(o))||this._platformLocation.pathname;this._platformLocation.replaceState(i,l,E)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(i=0){this._platformLocation.historyGo?.(i)}static \u0275fac=function(l){return new(l||t)(gn(pb),gn(vT,8))};static \u0275prov=Qt({token:t,factory:t.\u0275fac})}return t})();var Ua=(function(t){return t[t.Format=0]="Format",t[t.Standalone=1]="Standalone",t})(Ua||{}),lo=(function(t){return t[t.Narrow=0]="Narrow",t[t.Abbreviated=1]="Abbreviated",t[t.Wide=2]="Wide",t[t.Short=3]="Short",t})(lo||{}),Ll=(function(t){return t[t.Short=0]="Short",t[t.Medium=1]="Medium",t[t.Long=2]="Long",t[t.Full=3]="Full",t})(Ll||{}),Uh={Decimal:0,Group:1,List:2,PercentSign:3,PlusSign:4,MinusSign:5,Exponential:6,SuperscriptingExponent:7,PerMille:8,Infinity:9,NaN:10,TimeSeparator:11,CurrencyDecimal:12,CurrencyGroup:13};function QV(t){return rc(t)[qo.LocaleId]}function e5(t,n,i){let l=rc(t),h=[l[qo.DayPeriodsFormat],l[qo.DayPeriodsStandalone]],o=kc(h,n);return kc(o,i)}function t5(t,n,i){let l=rc(t),h=[l[qo.DaysFormat],l[qo.DaysStandalone]],o=kc(h,n);return kc(o,i)}function n5(t,n,i){let l=rc(t),h=[l[qo.MonthsFormat],l[qo.MonthsStandalone]],o=kc(h,n);return kc(o,i)}function i5(t,n){let l=rc(t)[qo.Eras];return kc(l,n)}function mb(t,n){let i=rc(t);return kc(i[qo.DateFormat],n)}function gb(t,n){let i=rc(t);return kc(i[qo.TimeFormat],n)}function _b(t,n){let l=rc(t)[qo.DateTimeFormat];return kc(l,n)}function vb(t,n){let i=rc(t),l=i[qo.NumberSymbols][n];if(typeof l>"u"){if(n===Uh.CurrencyDecimal)return i[qo.NumberSymbols][Uh.Decimal];if(n===Uh.CurrencyGroup)return i[qo.NumberSymbols][Uh.Group]}return l}function r5(t){if(!t[qo.ExtraData])throw new bn(2303,!1)}function o5(t){let n=rc(t);return r5(n),(n[qo.ExtraData][2]||[]).map(l=>typeof l=="string"?UP(l):[UP(l[0]),UP(l[1])])}function s5(t,n,i){let l=rc(t);r5(l);let h=[l[qo.ExtraData][0],l[qo.ExtraData][1]],o=kc(h,n)||[];return kc(o,i)||[]}function kc(t,n){for(let i=n;i>-1;i--)if(typeof t[i]<"u")return t[i];throw new bn(2304,!1)}function UP(t){let[n,i]=t.split(":");return{hours:+n,minutes:+i}}var $J=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,xT={},GJ=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;function _s(t,n,i,l){let h=eQ(t);n=Vh(i,n)||n;let E=[],A;for(;n;)if(A=GJ.exec(n),A){E=E.concat(A.slice(1));let le=E.pop();if(!le)break;n=le}else{E.push(n);break}let L=h.getTimezoneOffset();l&&(L=l5(l,L),h=QJ(h,l));let Y="";return E.forEach(le=>{let te=KJ(le);Y+=te?te(h,i,L):le==="''"?"'":le.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),Y}function TT(t,n,i){let l=new Date(0);return l.setFullYear(t,n,i),l.setHours(0,0,0),l}function Vh(t,n){let i=QV(t);if(xT[i]??={},xT[i][n])return xT[i][n];let l="";switch(n){case"shortDate":l=mb(t,Ll.Short);break;case"mediumDate":l=mb(t,Ll.Medium);break;case"longDate":l=mb(t,Ll.Long);break;case"fullDate":l=mb(t,Ll.Full);break;case"shortTime":l=gb(t,Ll.Short);break;case"mediumTime":l=gb(t,Ll.Medium);break;case"longTime":l=gb(t,Ll.Long);break;case"fullTime":l=gb(t,Ll.Full);break;case"short":let h=Vh(t,"shortTime"),o=Vh(t,"shortDate");l=bT(_b(t,Ll.Short),[h,o]);break;case"medium":let E=Vh(t,"mediumTime"),A=Vh(t,"mediumDate");l=bT(_b(t,Ll.Medium),[E,A]);break;case"long":let L=Vh(t,"longTime"),Y=Vh(t,"longDate");l=bT(_b(t,Ll.Long),[L,Y]);break;case"full":let le=Vh(t,"fullTime"),te=Vh(t,"fullDate");l=bT(_b(t,Ll.Full),[le,te]);break}return l&&(xT[i][n]=l),l}function bT(t,n){return n&&(t=t.replace(/\{([^}]+)}/g,function(i,l){return n!=null&&l in n?n[l]:i})),t}function Au(t,n,i="-",l,h){let o="";(t<0||h&&t<=0)&&(h?t=-t+1:(t=-t,o=i));let E=String(t);for(;E.length<n;)E="0"+E;return l&&(E=E.slice(E.length-n)),o+E}function qJ(t,n){return Au(t,3).substring(0,n)}function Is(t,n,i=0,l=!1,h=!1){return function(o,E){let A=WJ(t,o);if((i>0||A>-i)&&(A+=i),t===3)A===0&&i===-12&&(A=12);else if(t===6)return qJ(A,n);let L=vb(E,Uh.MinusSign);return Au(A,n,L,l,h)}}function WJ(t,n){switch(t){case 0:return n.getFullYear();case 1:return n.getMonth();case 2:return n.getDate();case 3:return n.getHours();case 4:return n.getMinutes();case 5:return n.getSeconds();case 6:return n.getMilliseconds();case 7:return n.getDay();default:throw new bn(2301,!1)}}function So(t,n,i=Ua.Format,l=!1){return function(h,o){return ZJ(h,o,t,n,i,l)}}function ZJ(t,n,i,l,h,o){switch(i){case 2:return n5(n,h,l)[t.getMonth()];case 1:return t5(n,h,l)[t.getDay()];case 0:let E=t.getHours(),A=t.getMinutes();if(o){let Y=o5(n),le=s5(n,h,l),te=Y.findIndex(ze=>{if(Array.isArray(ze)){let[Ae,Be]=ze,Tt=E>=Ae.hours&&A>=Ae.minutes,ot=E<Be.hours||E===Be.hours&&A<Be.minutes;if(Ae.hours<Be.hours){if(Tt&&ot)return!0}else if(Tt||ot)return!0}else if(ze.hours===E&&ze.minutes===A)return!0;return!1});if(te!==-1)return le[te]}return e5(n,h,l)[E<12?0:1];case 3:return i5(n,l)[t.getFullYear()<=0?0:1];default:let L=i;throw new bn(2302,!1)}}function wT(t){return function(n,i,l){let h=-1*l,o=vb(i,Uh.MinusSign),E=h>0?Math.floor(h/60):Math.ceil(h/60);switch(t){case 0:return(h>=0?"+":"")+Au(E,2,o)+Au(Math.abs(h%60),2,o);case 1:return"GMT"+(h>=0?"+":"")+Au(E,1,o);case 2:return"GMT"+(h>=0?"+":"")+Au(E,2,o)+":"+Au(Math.abs(h%60),2,o);case 3:return l===0?"Z":(h>=0?"+":"")+Au(E,2,o)+":"+Au(Math.abs(h%60),2,o);default:throw new bn(2310,!1)}}}var XJ=0,ET=4;function YJ(t){let n=TT(t,XJ,1).getDay();return TT(t,0,1+(n<=ET?ET:ET+7)-n)}function a5(t){let n=t.getDay(),i=n===0?-3:ET-n;return TT(t.getFullYear(),t.getMonth(),t.getDate()+i)}function HP(t,n=!1){return function(i,l){let h;if(n){let o=new Date(i.getFullYear(),i.getMonth(),1).getDay()-1,E=i.getDate();h=1+Math.floor((E+o)/7)}else{let o=a5(i),E=YJ(o.getFullYear()),A=o.getTime()-E.getTime();h=1+Math.round(A/6048e5)}return Au(h,t,vb(l,Uh.MinusSign))}}function CT(t,n=!1){return function(i,l){let o=a5(i).getFullYear();return Au(o,t,vb(l,Uh.MinusSign),n)}}var $P={};function KJ(t){if($P[t])return $P[t];let n;switch(t){case"G":case"GG":case"GGG":n=So(3,lo.Abbreviated);break;case"GGGG":n=So(3,lo.Wide);break;case"GGGGG":n=So(3,lo.Narrow);break;case"y":n=Is(0,1,0,!1,!0);break;case"yy":n=Is(0,2,0,!0,!0);break;case"yyy":n=Is(0,3,0,!1,!0);break;case"yyyy":n=Is(0,4,0,!1,!0);break;case"Y":n=CT(1);break;case"YY":n=CT(2,!0);break;case"YYY":n=CT(3);break;case"YYYY":n=CT(4);break;case"M":case"L":n=Is(1,1,1);break;case"MM":case"LL":n=Is(1,2,1);break;case"MMM":n=So(2,lo.Abbreviated);break;case"MMMM":n=So(2,lo.Wide);break;case"MMMMM":n=So(2,lo.Narrow);break;case"LLL":n=So(2,lo.Abbreviated,Ua.Standalone);break;case"LLLL":n=So(2,lo.Wide,Ua.Standalone);break;case"LLLLL":n=So(2,lo.Narrow,Ua.Standalone);break;case"w":n=HP(1);break;case"ww":n=HP(2);break;case"W":n=HP(1,!0);break;case"d":n=Is(2,1);break;case"dd":n=Is(2,2);break;case"c":case"cc":n=Is(7,1);break;case"ccc":n=So(1,lo.Abbreviated,Ua.Standalone);break;case"cccc":n=So(1,lo.Wide,Ua.Standalone);break;case"ccccc":n=So(1,lo.Narrow,Ua.Standalone);break;case"cccccc":n=So(1,lo.Short,Ua.Standalone);break;case"E":case"EE":case"EEE":n=So(1,lo.Abbreviated);break;case"EEEE":n=So(1,lo.Wide);break;case"EEEEE":n=So(1,lo.Narrow);break;case"EEEEEE":n=So(1,lo.Short);break;case"a":case"aa":case"aaa":n=So(0,lo.Abbreviated);break;case"aaaa":n=So(0,lo.Wide);break;case"aaaaa":n=So(0,lo.Narrow);break;case"b":case"bb":case"bbb":n=So(0,lo.Abbreviated,Ua.Standalone,!0);break;case"bbbb":n=So(0,lo.Wide,Ua.Standalone,!0);break;case"bbbbb":n=So(0,lo.Narrow,Ua.Standalone,!0);break;case"B":case"BB":case"BBB":n=So(0,lo.Abbreviated,Ua.Format,!0);break;case"BBBB":n=So(0,lo.Wide,Ua.Format,!0);break;case"BBBBB":n=So(0,lo.Narrow,Ua.Format,!0);break;case"h":n=Is(3,1,-12);break;case"hh":n=Is(3,2,-12);break;case"H":n=Is(3,1);break;case"HH":n=Is(3,2);break;case"m":n=Is(4,1);break;case"mm":n=Is(4,2);break;case"s":n=Is(5,1);break;case"ss":n=Is(5,2);break;case"S":n=Is(6,1);break;case"SS":n=Is(6,2);break;case"SSS":n=Is(6,3);break;case"Z":case"ZZ":case"ZZZ":n=wT(0);break;case"ZZZZZ":n=wT(3);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":n=wT(1);break;case"OOOO":case"ZZZZ":case"zzzz":n=wT(2);break;default:return null}return $P[t]=n,n}function l5(t,n){t=t.replace(/:/g,"");let i=Date.parse("Jan 01, 1970 00:00:00 "+t)/6e4;return isNaN(i)?n:i}function JJ(t,n){return t=new Date(t.getTime()),t.setMinutes(t.getMinutes()+n),t}function QJ(t,n,i){let h=t.getTimezoneOffset(),o=l5(n,h);return JJ(t,-1*(o-h))}function eQ(t){if(KV(t))return t;if(typeof t=="number"&&!isNaN(t))return new Date(t);if(typeof t=="string"){if(t=t.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(t)){let[h,o=1,E=1]=t.split("-").map(A=>+A);return TT(h,o-1,E)}let i=parseFloat(t);if(!isNaN(t-i))return new Date(i);let l;if(l=t.match($J))return tQ(l)}let n=new Date(t);if(!KV(n))throw new bn(2311,!1);return n}function tQ(t){let n=new Date(0),i=0,l=0,h=t[8]?n.setUTCFullYear:n.setFullYear,o=t[8]?n.setUTCHours:n.setHours;t[9]&&(i=Number(t[9]+t[10]),l=Number(t[9]+t[11])),h.call(n,Number(t[1]),Number(t[2])-1,Number(t[3]));let E=Number(t[4]||0)-i,A=Number(t[5]||0)-l,L=Number(t[6]||0),Y=Math.floor(parseFloat("0."+(t[7]||0))*1e3);return o.call(n,E,A,L,Y),n}function KV(t){return t instanceof Date&&!isNaN(t.valueOf())}var GP=/\s+/,JV=[],vp=(()=>{class t{_ngEl;_renderer;initialClasses=JV;rawClass;stateMap=new Map;constructor(i,l){this._ngEl=i,this._renderer=l}set klass(i){this.initialClasses=i!=null?i.trim().split(GP):JV}set ngClass(i){this.rawClass=typeof i=="string"?i.trim().split(GP):i}ngDoCheck(){for(let l of this.initialClasses)this._updateState(l,!0);let i=this.rawClass;if(Array.isArray(i)||i instanceof Set)for(let l of i)this._updateState(l,!0);else if(i!=null)for(let l of Object.keys(i))this._updateState(l,!!i[l]);this._applyStateDiff()}_updateState(i,l){let h=this.stateMap.get(i);h!==void 0?(h.enabled!==l&&(h.changed=!0,h.enabled=l),h.touched=!0):this.stateMap.set(i,{enabled:l,changed:!0,touched:!0})}_applyStateDiff(){for(let i of this.stateMap){let l=i[0],h=i[1];h.changed?(this._toggleClass(l,h.enabled),h.changed=!1):h.touched||(h.enabled&&this._toggleClass(l,!1),this.stateMap.delete(l)),h.touched=!1}}_toggleClass(i,l){i=i.trim(),i.length>0&&i.split(GP).forEach(h=>{l?this._renderer.addClass(this._ngEl.nativeElement,h):this._renderer.removeClass(this._ngEl.nativeElement,h)})}static \u0275fac=function(l){return new(l||t)(wt(Fo),wt(ia))};static \u0275dir=Ki({type:t,selectors:[["","ngClass",""]],inputs:{klass:[0,"class","klass"],ngClass:"ngClass"}})}return t})();var yb=(()=>{class t{_ngEl;_differs;_renderer;_ngStyle=null;_differ=null;constructor(i,l,h){this._ngEl=i,this._differs=l,this._renderer=h}set ngStyle(i){this._ngStyle=i,!this._differ&&i&&(this._differ=this._differs.find(i).create())}ngDoCheck(){if(this._differ){let i=this._differ.diff(this._ngStyle);i&&this._applyChanges(i)}}_setStyle(i,l){let[h,o]=i.split("."),E=h.indexOf("-")===-1?void 0:Eu.DashCase;l!=null?this._renderer.setStyle(this._ngEl.nativeElement,h,o?`${l}${o}`:l,E):this._renderer.removeStyle(this._ngEl.nativeElement,h,E)}_applyChanges(i){i.forEachRemovedItem(l=>this._setStyle(l.key,null)),i.forEachAddedItem(l=>this._setStyle(l.key,l.currentValue)),i.forEachChangedItem(l=>this._setStyle(l.key,l.currentValue))}static \u0275fac=function(l){return new(l||t)(wt(Fo),wt(BP),wt(ia))};static \u0275dir=Ki({type:t,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"}})}return t})(),yp=(()=>{class t{_viewContainerRef;_viewRef=null;ngTemplateOutletContext=null;ngTemplateOutlet=null;ngTemplateOutletInjector=null;constructor(i){this._viewContainerRef=i}ngOnChanges(i){if(this._shouldRecreateView(i)){let l=this._viewContainerRef;if(this._viewRef&&l.remove(l.indexOf(this._viewRef)),!this.ngTemplateOutlet){this._viewRef=null;return}let h=this._createContextForwardProxy();this._viewRef=l.createEmbeddedView(this.ngTemplateOutlet,h,{injector:this.ngTemplateOutletInjector??void 0})}}_shouldRecreateView(i){return!!i.ngTemplateOutlet||!!i.ngTemplateOutletInjector}_createContextForwardProxy(){return new Proxy({},{set:(i,l,h)=>this.ngTemplateOutletContext?Reflect.set(this.ngTemplateOutletContext,l,h):!1,get:(i,l,h)=>{if(this.ngTemplateOutletContext)return Reflect.get(this.ngTemplateOutletContext,l,h)}})}static \u0275fac=function(l){return new(l||t)(wt(Oc))};static \u0275dir=Ki({type:t,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},features:[wa]})}return t})();function WP(t,n){return new bn(2100,!1)}var nQ=/(?:[0-9A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088E\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5D\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CA\uA7D0\uA7D1\uA7D3\uA7D5-\uA7D9\uA7F2-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDF70-\uDF81\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC71\uDC72\uDC75\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A\uDF40-\uDF46]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEB0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE70-\uDEBE\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD837[\uDF00-\uDF1E]|\uD838[\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB]|\uD839[\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF38\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])\S*/g,xb=(()=>{class t{transform(i){if(i==null)return null;if(typeof i!="string")throw WP(t,i);return i.replace(nQ,l=>l[0].toUpperCase()+l.slice(1).toLowerCase())}static \u0275fac=function(l){return new(l||t)};static \u0275pipe=zh({name:"titlecase",type:t,pure:!0})}return t})();var iQ="mediumDate",c5=new Sn(""),u5=new Sn(""),bb=(()=>{class t{locale;defaultTimezone;defaultOptions;constructor(i,l,h){this.locale=i,this.defaultTimezone=l,this.defaultOptions=h}transform(i,l,h,o){if(i==null||i===""||i!==i)return null;try{let E=l??this.defaultOptions?.dateFormat??iQ,A=h??this.defaultOptions?.timezone??this.defaultTimezone??void 0;return _s(i,E,o||this.locale,A)}catch(E){throw WP(t,E.message)}}static \u0275fac=function(l){return new(l||t)(wt(Du,16),wt(c5,24),wt(u5,24))};static \u0275pipe=zh({name:"date",type:t,pure:!0})}return t})();var ZP=(()=>{class t{transform(i,l,h){if(i==null)return null;if(!(typeof i=="string"||Array.isArray(i)))throw WP(t,i);return i.slice(l,h)}static \u0275fac=function(l){return new(l||t)};static \u0275pipe=zh({name:"slice",type:t,pure:!1})}return t})();var Mr=(()=>{class t{static \u0275fac=function(l){return new(l||t)};static \u0275mod=Qo({type:t});static \u0275inj=$o({})}return t})();function wb(t,n){n=encodeURIComponent(n);for(let i of t.split(";")){let l=i.indexOf("="),[h,o]=l==-1?[i,""]:[i.slice(0,l),i.slice(l+1)];if(h.trim()===n)return decodeURIComponent(o)}return null}var rg=class{};function d5(t,n,i){return EP(t,n,i)}var h5="browser";var f5=(()=>{class t{static \u0275prov=Qt({token:t,providedIn:"root",factory:()=>new XP(ft(_o),window)})}return t})(),XP=class{document;window;offset=()=>[0,0];constructor(n,i){this.document=n,this.window=i}setOffset(n){Array.isArray(n)?this.offset=()=>n:this.offset=n}getScrollPosition(){return[this.window.scrollX,this.window.scrollY]}scrollToPosition(n,i){this.window.scrollTo(Mi(Jt({},i),{left:n[0],top:n[1]}))}scrollToAnchor(n,i){let l=sQ(this.document,n);l&&(this.scrollToElement(l,i),l.focus())}setHistoryScrollRestoration(n){try{this.window.history.scrollRestoration=n}catch{console.warn(Bm(2400,!1))}}scrollToElement(n,i){let l=n.getBoundingClientRect(),h=l.left+this.window.pageXOffset,o=l.top+this.window.pageYOffset,E=this.offset();this.window.scrollTo(Mi(Jt({},i),{left:h-E[0],top:o-E[1]}))}};function sQ(t,n){let i=t.getElementById(n)||t.getElementsByName(n)[0];if(i)return i;if(typeof t.createTreeWalker=="function"&&t.body&&typeof t.body.attachShadow=="function"){let l=t.createTreeWalker(t.body,NodeFilter.SHOW_ELEMENT),h=l.currentNode;for(;h;){let o=h.shadowRoot;if(o){let E=o.getElementById(n)||o.querySelector(`[name="${n}"]`);if(E)return E}h=l.nextNode()}}return null}var DT=new Sn(""),eO=(()=>{class t{_zone;_plugins;_eventNameToPlugin=new Map;constructor(i,l){this._zone=l,i.forEach(h=>{h.manager=this}),this._plugins=i.slice().reverse()}addEventListener(i,l,h,o){return this._findPluginFor(l).addEventListener(i,l,h,o)}getZone(){return this._zone}_findPluginFor(i){let l=this._eventNameToPlugin.get(i);if(l)return l;if(l=this._plugins.find(o=>o.supports(i)),!l)throw new bn(5101,!1);return this._eventNameToPlugin.set(i,l),l}static \u0275fac=function(l){return new(l||t)(gn(DT),gn(so))};static \u0275prov=Qt({token:t,factory:t.\u0275fac})}return t})(),Eb=class{_doc;constructor(n){this._doc=n}manager},YP="ng-app-id";function p5(t){for(let n of t)n.remove()}function m5(t,n){let i=n.createElement("style");return i.textContent=t,i}function aQ(t,n,i,l){let h=t.head?.querySelectorAll(`style[${YP}="${n}"],link[${YP}="${n}"]`);if(h)for(let o of h)o.removeAttribute(YP),o instanceof HTMLLinkElement?l.set(o.href.slice(o.href.lastIndexOf("/")+1),{usage:0,elements:[o]}):o.textContent&&i.set(o.textContent,{usage:0,elements:[o]})}function JP(t,n){let i=n.createElement("link");return i.setAttribute("rel","stylesheet"),i.setAttribute("href",t),i}var tO=(()=>{class t{doc;appId;nonce;inline=new Map;external=new Map;hosts=new Set;constructor(i,l,h,o={}){this.doc=i,this.appId=l,this.nonce=h,aQ(i,l,this.inline,this.external),this.hosts.add(i.head)}addStyles(i,l){for(let h of i)this.addUsage(h,this.inline,m5);l?.forEach(h=>this.addUsage(h,this.external,JP))}removeStyles(i,l){for(let h of i)this.removeUsage(h,this.inline);l?.forEach(h=>this.removeUsage(h,this.external))}addUsage(i,l,h){let o=l.get(i);o?o.usage++:l.set(i,{usage:1,elements:[...this.hosts].map(E=>this.addElement(E,h(i,this.doc)))})}removeUsage(i,l){let h=l.get(i);h&&(h.usage--,h.usage<=0&&(p5(h.elements),l.delete(i)))}ngOnDestroy(){for(let[,{elements:i}]of[...this.inline,...this.external])p5(i);this.hosts.clear()}addHost(i){this.hosts.add(i);for(let[l,{elements:h}]of this.inline)h.push(this.addElement(i,m5(l,this.doc)));for(let[l,{elements:h}]of this.external)h.push(this.addElement(i,JP(l,this.doc)))}removeHost(i){this.hosts.delete(i)}addElement(i,l){return this.nonce&&l.setAttribute("nonce",this.nonce),i.appendChild(l)}static \u0275fac=function(l){return new(l||t)(gn(_o),gn(XE),gn(KE,8),gn(M0))};static \u0275prov=Qt({token:t,factory:t.\u0275fac})}return t})(),KP={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},nO=/%COMP%/g;var _5="%COMP%",lQ=`_nghost-${_5}`,cQ=`_ngcontent-${_5}`,uQ=!0,dQ=new Sn("",{providedIn:"root",factory:()=>uQ});function hQ(t){return cQ.replace(nO,t)}function fQ(t){return lQ.replace(nO,t)}function v5(t,n){return n.map(i=>i.replace(nO,t))}var iO=(()=>{class t{eventManager;sharedStylesHost;appId;removeStylesOnCompDestroy;doc;platformId;ngZone;nonce;tracingService;rendererByCompId=new Map;defaultRenderer;platformIsServer;constructor(i,l,h,o,E,A,L,Y=null,le=null){this.eventManager=i,this.sharedStylesHost=l,this.appId=h,this.removeStylesOnCompDestroy=o,this.doc=E,this.platformId=A,this.ngZone=L,this.nonce=Y,this.tracingService=le,this.platformIsServer=!1,this.defaultRenderer=new Tb(i,E,L,this.platformIsServer,this.tracingService)}createRenderer(i,l){if(!i||!l)return this.defaultRenderer;let h=this.getOrCreateRenderer(i,l);return h instanceof ST?h.applyToHost(i):h instanceof Sb&&h.applyStyles(),h}getOrCreateRenderer(i,l){let h=this.rendererByCompId,o=h.get(l.id);if(!o){let E=this.doc,A=this.ngZone,L=this.eventManager,Y=this.sharedStylesHost,le=this.removeStylesOnCompDestroy,te=this.platformIsServer,ze=this.tracingService;switch(l.encapsulation){case Lh.Emulated:o=new ST(L,Y,l,this.appId,le,E,A,te,ze);break;case Lh.ShadowDom:return new QP(L,Y,i,l,E,A,this.nonce,te,ze);default:o=new Sb(L,Y,l,le,E,A,te,ze);break}h.set(l.id,o)}return o}ngOnDestroy(){this.rendererByCompId.clear()}componentReplaced(i){this.rendererByCompId.delete(i)}static \u0275fac=function(l){return new(l||t)(gn(eO),gn(tO),gn(XE),gn(dQ),gn(_o),gn(M0),gn(so),gn(KE),gn(tg,8))};static \u0275prov=Qt({token:t,factory:t.\u0275fac})}return t})(),Tb=class{eventManager;doc;ngZone;platformIsServer;tracingService;data=Object.create(null);throwOnSyntheticProps=!0;constructor(n,i,l,h,o){this.eventManager=n,this.doc=i,this.ngZone=l,this.platformIsServer=h,this.tracingService=o}destroy(){}destroyNode=null;createElement(n,i){return i?this.doc.createElementNS(KP[i]||i,n):this.doc.createElement(n)}createComment(n){return this.doc.createComment(n)}createText(n){return this.doc.createTextNode(n)}appendChild(n,i){(g5(n)?n.content:n).appendChild(i)}insertBefore(n,i,l){n&&(g5(n)?n.content:n).insertBefore(i,l)}removeChild(n,i){i.remove()}selectRootElement(n,i){let l=typeof n=="string"?this.doc.querySelector(n):n;if(!l)throw new bn(-5104,!1);return i||(l.textContent=""),l}parentNode(n){return n.parentNode}nextSibling(n){return n.nextSibling}setAttribute(n,i,l,h){if(h){i=h+":"+i;let o=KP[h];o?n.setAttributeNS(o,i,l):n.setAttribute(i,l)}else n.setAttribute(i,l)}removeAttribute(n,i,l){if(l){let h=KP[l];h?n.removeAttributeNS(h,i):n.removeAttribute(`${l}:${i}`)}else n.removeAttribute(i)}addClass(n,i){n.classList.add(i)}removeClass(n,i){n.classList.remove(i)}setStyle(n,i,l,h){h&(Eu.DashCase|Eu.Important)?n.style.setProperty(i,l,h&Eu.Important?"important":""):n.style[i]=l}removeStyle(n,i,l){l&Eu.DashCase?n.style.removeProperty(i):n.style[i]=""}setProperty(n,i,l){n!=null&&(n[i]=l)}setValue(n,i){n.nodeValue=i}listen(n,i,l,h){if(typeof n=="string"&&(n=Rc().getGlobalEventTarget(this.doc,n),!n))throw new bn(5102,!1);let o=this.decoratePreventDefault(l);return this.tracingService?.wrapEventListener&&(o=this.tracingService.wrapEventListener(n,i,o)),this.eventManager.addEventListener(n,i,o,h)}decoratePreventDefault(n){return i=>{if(i==="__ngUnwrap__")return n;n(i)===!1&&i.preventDefault()}}};function g5(t){return t.tagName==="TEMPLATE"&&t.content!==void 0}var QP=class extends Tb{sharedStylesHost;hostEl;shadowRoot;constructor(n,i,l,h,o,E,A,L,Y){super(n,o,E,L,Y),this.sharedStylesHost=i,this.hostEl=l,this.shadowRoot=l.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let le=h.styles;le=v5(h.id,le);for(let ze of le){let Ae=document.createElement("style");A&&Ae.setAttribute("nonce",A),Ae.textContent=ze,this.shadowRoot.appendChild(Ae)}let te=h.getExternalStyles?.();if(te)for(let ze of te){let Ae=JP(ze,o);A&&Ae.setAttribute("nonce",A),this.shadowRoot.appendChild(Ae)}}nodeOrShadowRoot(n){return n===this.hostEl?this.shadowRoot:n}appendChild(n,i){return super.appendChild(this.nodeOrShadowRoot(n),i)}insertBefore(n,i,l){return super.insertBefore(this.nodeOrShadowRoot(n),i,l)}removeChild(n,i){return super.removeChild(null,i)}parentNode(n){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(n)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},Sb=class extends Tb{sharedStylesHost;removeStylesOnCompDestroy;styles;styleUrls;constructor(n,i,l,h,o,E,A,L,Y){super(n,o,E,A,L),this.sharedStylesHost=i,this.removeStylesOnCompDestroy=h;let le=l.styles;this.styles=Y?v5(Y,le):le,this.styleUrls=l.getExternalStyles?.(Y)}applyStyles(){this.sharedStylesHost.addStyles(this.styles,this.styleUrls)}destroy(){this.removeStylesOnCompDestroy&&Xm.size===0&&this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)}},ST=class extends Sb{contentAttr;hostAttr;constructor(n,i,l,h,o,E,A,L,Y){let le=h+"-"+l.id;super(n,i,l,o,E,A,L,Y,le),this.contentAttr=hQ(le),this.hostAttr=fQ(le)}applyToHost(n){this.applyStyles(),this.setAttribute(n,this.hostAttr,"")}createElement(n,i){let l=super.createElement(n,i);return super.setAttribute(l,this.contentAttr,""),l}};var IT=class t extends fb{supportsDOMEvents=!0;static makeCurrent(){jP(new t)}onAndCancel(n,i,l,h){return n.addEventListener(i,l,h),()=>{n.removeEventListener(i,l,h)}}dispatchEvent(n,i){n.dispatchEvent(i)}remove(n){n.remove()}createElement(n,i){return i=i||this.getDefaultDocument(),i.createElement(n)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(n){return n.nodeType===Node.ELEMENT_NODE}isShadowRoot(n){return n instanceof DocumentFragment}getGlobalEventTarget(n,i){return i==="window"?window:i==="document"?n:i==="body"?n.body:null}getBaseHref(n){let i=pQ();return i==null?null:mQ(i)}resetBaseElement(){Db=null}getUserAgent(){return window.navigator.userAgent}getCookie(n){return wb(document.cookie,n)}},Db=null;function pQ(){return Db=Db||document.head.querySelector("base"),Db?Db.getAttribute("href"):null}function mQ(t){return new URL(t,document.baseURI).pathname}var gQ=(()=>{class t{build(){return new XMLHttpRequest}static \u0275fac=function(l){return new(l||t)};static \u0275prov=Qt({token:t,factory:t.\u0275fac})}return t})(),x5=(()=>{class t extends Eb{constructor(i){super(i)}supports(i){return!0}addEventListener(i,l,h,o){return i.addEventListener(l,h,o),()=>this.removeEventListener(i,l,h,o)}removeEventListener(i,l,h,o){return i.removeEventListener(l,h,o)}static \u0275fac=function(l){return new(l||t)(gn(_o))};static \u0275prov=Qt({token:t,factory:t.\u0275fac})}return t})(),y5=["alt","control","meta","shift"],_Q={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},vQ={alt:t=>t.altKey,control:t=>t.ctrlKey,meta:t=>t.metaKey,shift:t=>t.shiftKey},b5=(()=>{class t extends Eb{constructor(i){super(i)}supports(i){return t.parseEventName(i)!=null}addEventListener(i,l,h,o){let E=t.parseEventName(l),A=t.eventCallback(E.fullKey,h,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Rc().onAndCancel(i,E.domEventName,A,o))}static parseEventName(i){let l=i.toLowerCase().split("."),h=l.shift();if(l.length===0||!(h==="keydown"||h==="keyup"))return null;let o=t._normalizeKey(l.pop()),E="",A=l.indexOf("code");if(A>-1&&(l.splice(A,1),E="code."),y5.forEach(Y=>{let le=l.indexOf(Y);le>-1&&(l.splice(le,1),E+=Y+".")}),E+=o,l.length!=0||o.length===0)return null;let L={};return L.domEventName=h,L.fullKey=E,L}static matchEventFullKeyCode(i,l){let h=_Q[i.key]||i.key,o="";return l.indexOf("code.")>-1&&(h=i.code,o="code."),h==null||!h?!1:(h=h.toLowerCase(),h===" "?h="space":h==="."&&(h="dot"),y5.forEach(E=>{if(E!==h){let A=vQ[E];A(i)&&(o+=E+".")}}),o+=h,o===l)}static eventCallback(i,l,h){return o=>{t.matchEventFullKeyCode(o,i)&&h.runGuarded(()=>l(o))}}static _normalizeKey(i){return i==="esc"?"escape":i}static \u0275fac=function(l){return new(l||t)(gn(_o))};static \u0275prov=Qt({token:t,factory:t.\u0275fac})}return t})();function rO(t,n,i){let l=Jt({rootComponent:t,platformRef:i?.platformRef},yQ(n));return GV(l)}function yQ(t){return{appProviders:[...EQ,...t?.providers??[]],platformProviders:CQ}}function xQ(){IT.makeCurrent()}function bQ(){return new pu}function wQ(){return GA(document),document}var CQ=[{provide:M0,useValue:h5},{provide:YE,useValue:xQ,multi:!0},{provide:_o,useFactory:wQ}];var EQ=[{provide:Ax,useValue:"root"},{provide:pu,useFactory:bQ},{provide:DT,useClass:x5,multi:!0,deps:[_o]},{provide:DT,useClass:b5,multi:!0,deps:[_o]},iO,tO,eO,{provide:Ym,useExisting:iO},{provide:rg,useClass:gQ},[]];var L0=class{},Ib=class{},bp=class t{headers;normalizedNames=new Map;lazyInit;lazyUpdate=null;constructor(n){n?typeof n=="string"?this.lazyInit=()=>{this.headers=new Map,n.split(`
`).forEach(i=>{let l=i.indexOf(":");if(l>0){let h=i.slice(0,l),o=i.slice(l+1).trim();this.addHeaderEntry(h,o)}})}:typeof Headers<"u"&&n instanceof Headers?(this.headers=new Map,n.forEach((i,l)=>{this.addHeaderEntry(l,i)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(n).forEach(([i,l])=>{this.setHeaderEntries(i,l)})}:this.headers=new Map}has(n){return this.init(),this.headers.has(n.toLowerCase())}get(n){this.init();let i=this.headers.get(n.toLowerCase());return i&&i.length>0?i[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(n){return this.init(),this.headers.get(n.toLowerCase())||null}append(n,i){return this.clone({name:n,value:i,op:"a"})}set(n,i){return this.clone({name:n,value:i,op:"s"})}delete(n,i){return this.clone({name:n,value:i,op:"d"})}maybeSetNormalizedName(n,i){this.normalizedNames.has(i)||this.normalizedNames.set(i,n)}init(){this.lazyInit&&(this.lazyInit instanceof t?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(n=>this.applyUpdate(n)),this.lazyUpdate=null))}copyFrom(n){n.init(),Array.from(n.headers.keys()).forEach(i=>{this.headers.set(i,n.headers.get(i)),this.normalizedNames.set(i,n.normalizedNames.get(i))})}clone(n){let i=new t;return i.lazyInit=this.lazyInit&&this.lazyInit instanceof t?this.lazyInit:this,i.lazyUpdate=(this.lazyUpdate||[]).concat([n]),i}applyUpdate(n){let i=n.name.toLowerCase();switch(n.op){case"a":case"s":let l=n.value;if(typeof l=="string"&&(l=[l]),l.length===0)return;this.maybeSetNormalizedName(n.name,i);let h=(n.op==="a"?this.headers.get(i):void 0)||[];h.push(...l),this.headers.set(i,h);break;case"d":let o=n.value;if(!o)this.headers.delete(i),this.normalizedNames.delete(i);else{let E=this.headers.get(i);if(!E)return;E=E.filter(A=>o.indexOf(A)===-1),E.length===0?(this.headers.delete(i),this.normalizedNames.delete(i)):this.headers.set(i,E)}break}}addHeaderEntry(n,i){let l=n.toLowerCase();this.maybeSetNormalizedName(n,l),this.headers.has(l)?this.headers.get(l).push(i):this.headers.set(l,[i])}setHeaderEntries(n,i){let l=(Array.isArray(i)?i:[i]).map(o=>o.toString()),h=n.toLowerCase();this.headers.set(h,l),this.maybeSetNormalizedName(n,h)}forEach(n){this.init(),Array.from(this.normalizedNames.keys()).forEach(i=>n(this.normalizedNames.get(i),this.headers.get(i)))}};var AT=class{encodeKey(n){return w5(n)}encodeValue(n){return w5(n)}decodeKey(n){return decodeURIComponent(n)}decodeValue(n){return decodeURIComponent(n)}};function TQ(t,n){let i=new Map;return t.length>0&&t.replace(/^\?/,"").split("&").forEach(h=>{let o=h.indexOf("="),[E,A]=o==-1?[n.decodeKey(h),""]:[n.decodeKey(h.slice(0,o)),n.decodeValue(h.slice(o+1))],L=i.get(E)||[];L.push(A),i.set(E,L)}),i}var SQ=/%(\d[a-f0-9])/gi,DQ={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function w5(t){return encodeURIComponent(t).replace(SQ,(n,i)=>DQ[i]??n)}function MT(t){return`${t}`}var Ms=class t{map;encoder;updates=null;cloneFrom=null;constructor(n={}){if(this.encoder=n.encoder||new AT,n.fromString){if(n.fromObject)throw new bn(2805,!1);this.map=TQ(n.fromString,this.encoder)}else n.fromObject?(this.map=new Map,Object.keys(n.fromObject).forEach(i=>{let l=n.fromObject[i],h=Array.isArray(l)?l.map(MT):[MT(l)];this.map.set(i,h)})):this.map=null}has(n){return this.init(),this.map.has(n)}get(n){this.init();let i=this.map.get(n);return i?i[0]:null}getAll(n){return this.init(),this.map.get(n)||null}keys(){return this.init(),Array.from(this.map.keys())}append(n,i){return this.clone({param:n,value:i,op:"a"})}appendAll(n){let i=[];return Object.keys(n).forEach(l=>{let h=n[l];Array.isArray(h)?h.forEach(o=>{i.push({param:l,value:o,op:"a"})}):i.push({param:l,value:h,op:"a"})}),this.clone(i)}set(n,i){return this.clone({param:n,value:i,op:"s"})}delete(n,i){return this.clone({param:n,value:i,op:"d"})}toString(){return this.init(),this.keys().map(n=>{let i=this.encoder.encodeKey(n);return this.map.get(n).map(l=>i+"="+this.encoder.encodeValue(l)).join("&")}).filter(n=>n!=="").join("&")}clone(n){let i=new t({encoder:this.encoder});return i.cloneFrom=this.cloneFrom||this,i.updates=(this.updates||[]).concat(n),i}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(n=>this.map.set(n,this.cloneFrom.map.get(n))),this.updates.forEach(n=>{switch(n.op){case"a":case"s":let i=(n.op==="a"?this.map.get(n.param):void 0)||[];i.push(MT(n.value)),this.map.set(n.param,i);break;case"d":if(n.value!==void 0){let l=this.map.get(n.param)||[],h=l.indexOf(MT(n.value));h!==-1&&l.splice(h,1),l.length>0?this.map.set(n.param,l):this.map.delete(n.param)}else{this.map.delete(n.param);break}}}),this.cloneFrom=this.updates=null)}};var PT=class{map=new Map;set(n,i){return this.map.set(n,i),this}get(n){return this.map.has(n)||this.map.set(n,n.defaultValue()),this.map.get(n)}delete(n){return this.map.delete(n),this}has(n){return this.map.has(n)}keys(){return this.map.keys()}};function IQ(t){switch(t){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function C5(t){return typeof ArrayBuffer<"u"&&t instanceof ArrayBuffer}function E5(t){return typeof Blob<"u"&&t instanceof Blob}function T5(t){return typeof FormData<"u"&&t instanceof FormData}function MQ(t){return typeof URLSearchParams<"u"&&t instanceof URLSearchParams}var S5="Content-Type",D5="Accept",I5="X-Request-URL",M5="text/plain",A5="application/json",AQ=`${A5}, ${M5}, */*`,F0=class t{url;body=null;headers;context;reportProgress=!1;withCredentials=!1;credentials;keepalive=!1;cache;priority;mode;redirect;referrer;integrity;responseType="json";method;params;urlWithParams;transferCache;timeout;constructor(n,i,l,h){this.url=i,this.method=n.toUpperCase();let o;if(IQ(this.method)||h?(this.body=l!==void 0?l:null,o=h):o=l,o){if(this.reportProgress=!!o.reportProgress,this.withCredentials=!!o.withCredentials,this.keepalive=!!o.keepalive,o.responseType&&(this.responseType=o.responseType),o.headers&&(this.headers=o.headers),o.context&&(this.context=o.context),o.params&&(this.params=o.params),o.priority&&(this.priority=o.priority),o.cache&&(this.cache=o.cache),o.credentials&&(this.credentials=o.credentials),typeof o.timeout=="number"){if(o.timeout<1||!Number.isInteger(o.timeout))throw new bn(2822,"");this.timeout=o.timeout}o.mode&&(this.mode=o.mode),o.redirect&&(this.redirect=o.redirect),o.integrity&&(this.integrity=o.integrity),o.referrer&&(this.referrer=o.referrer),this.transferCache=o.transferCache}if(this.headers??=new bp,this.context??=new PT,!this.params)this.params=new Ms,this.urlWithParams=i;else{let E=this.params.toString();if(E.length===0)this.urlWithParams=i;else{let A=i.indexOf("?"),L=A===-1?"?":A<i.length-1?"&":"";this.urlWithParams=i+L+E}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||C5(this.body)||E5(this.body)||T5(this.body)||MQ(this.body)?this.body:this.body instanceof Ms?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||T5(this.body)?null:E5(this.body)?this.body.type||null:C5(this.body)?null:typeof this.body=="string"?M5:this.body instanceof Ms?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?A5:null}clone(n={}){let i=n.method||this.method,l=n.url||this.url,h=n.responseType||this.responseType,o=n.keepalive??this.keepalive,E=n.priority||this.priority,A=n.cache||this.cache,L=n.mode||this.mode,Y=n.redirect||this.redirect,le=n.credentials||this.credentials,te=n.referrer||this.referrer,ze=n.integrity||this.integrity,Ae=n.transferCache??this.transferCache,Be=n.timeout??this.timeout,Tt=n.body!==void 0?n.body:this.body,ot=n.withCredentials??this.withCredentials,kt=n.reportProgress??this.reportProgress,Cn=n.headers||this.headers,Xn=n.params||this.params,On=n.context??this.context;return n.setHeaders!==void 0&&(Cn=Object.keys(n.setHeaders).reduce((Vn,rr)=>Vn.set(rr,n.setHeaders[rr]),Cn)),n.setParams&&(Xn=Object.keys(n.setParams).reduce((Vn,rr)=>Vn.set(rr,n.setParams[rr]),Xn)),new t(i,l,Tt,{params:Xn,headers:Cn,context:On,reportProgress:kt,responseType:h,withCredentials:ot,transferCache:Ae,keepalive:o,cache:A,priority:E,timeout:Be,mode:L,redirect:Y,credentials:le,referrer:te,integrity:ze})}},og=(function(t){return t[t.Sent=0]="Sent",t[t.UploadProgress=1]="UploadProgress",t[t.ResponseHeader=2]="ResponseHeader",t[t.DownloadProgress=3]="DownloadProgress",t[t.Response=4]="Response",t[t.User=5]="User",t})(og||{}),N0=class{headers;status;statusText;url;ok;type;redirected;constructor(n,i=200,l="OK"){this.headers=n.headers||new bp,this.status=n.status!==void 0?n.status:i,this.statusText=n.statusText||l,this.url=n.url||null,this.redirected=n.redirected,this.ok=this.status>=200&&this.status<300}},OT=class t extends N0{constructor(n={}){super(n)}type=og.ResponseHeader;clone(n={}){return new t({headers:n.headers||this.headers,status:n.status!==void 0?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}},Mb=class t extends N0{body;constructor(n={}){super(n),this.body=n.body!==void 0?n.body:null}type=og.Response;clone(n={}){return new t({body:n.body!==void 0?n.body:this.body,headers:n.headers||this.headers,status:n.status!==void 0?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0,redirected:n.redirected??this.redirected})}},xp=class extends N0{name="HttpErrorResponse";message;error;ok=!1;constructor(n){super(n,0,"Unknown Error"),this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${n.url||"(unknown url)"}`:this.message=`Http failure response for ${n.url||"(unknown url)"}: ${n.status} ${n.statusText}`,this.error=n.error||null}},PQ=200,OQ=204;function oO(t,n){return{body:n,headers:t.headers,context:t.context,observe:t.observe,params:t.params,reportProgress:t.reportProgress,responseType:t.responseType,withCredentials:t.withCredentials,credentials:t.credentials,transferCache:t.transferCache,timeout:t.timeout,keepalive:t.keepalive,priority:t.priority,cache:t.cache,mode:t.mode,redirect:t.redirect,integrity:t.integrity,referrer:t.referrer}}var aa=(()=>{class t{handler;constructor(i){this.handler=i}request(i,l,h={}){let o;if(i instanceof F0)o=i;else{let L;h.headers instanceof bp?L=h.headers:L=new bp(h.headers);let Y;h.params&&(h.params instanceof Ms?Y=h.params:Y=new Ms({fromObject:h.params})),o=new F0(i,l,h.body!==void 0?h.body:null,{headers:L,context:h.context,params:Y,reportProgress:h.reportProgress,responseType:h.responseType||"json",withCredentials:h.withCredentials,transferCache:h.transferCache,keepalive:h.keepalive,priority:h.priority,cache:h.cache,mode:h.mode,redirect:h.redirect,credentials:h.credentials,referrer:h.referrer,integrity:h.integrity,timeout:h.timeout})}let E=Jn(o).pipe(xd(L=>this.handler.handle(L)));if(i instanceof F0||h.observe==="events")return E;let A=E.pipe(To(L=>L instanceof Mb));switch(h.observe||"body"){case"body":switch(o.responseType){case"arraybuffer":return A.pipe(di(L=>{if(L.body!==null&&!(L.body instanceof ArrayBuffer))throw new bn(2806,!1);return L.body}));case"blob":return A.pipe(di(L=>{if(L.body!==null&&!(L.body instanceof Blob))throw new bn(2807,!1);return L.body}));case"text":return A.pipe(di(L=>{if(L.body!==null&&typeof L.body!="string")throw new bn(2808,!1);return L.body}));case"json":default:return A.pipe(di(L=>L.body))}case"response":return A;default:throw new bn(2809,!1)}}delete(i,l={}){return this.request("DELETE",i,l)}get(i,l={}){return this.request("GET",i,l)}head(i,l={}){return this.request("HEAD",i,l)}jsonp(i,l){return this.request("JSONP",i,{params:new Ms().append(l,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(i,l={}){return this.request("OPTIONS",i,l)}patch(i,l,h={}){return this.request("PATCH",i,oO(h,l))}post(i,l,h={}){return this.request("POST",i,oO(h,l))}put(i,l,h={}){return this.request("PUT",i,oO(h,l))}static \u0275fac=function(l){return new(l||t)(gn(L0))};static \u0275prov=Qt({token:t,factory:t.\u0275fac})}return t})();var RQ=new Sn("");function kQ(t,n){return n(t)}function FQ(t,n,i){return(l,h)=>ta(i,()=>n(l,o=>t(o,h)))}var aO=new Sn(""),P5=new Sn(""),O5=new Sn("",{providedIn:"root",factory:()=>!0});var RT=(()=>{class t extends L0{backend;injector;chain=null;pendingTasks=ft(_E);contributeToStability=ft(O5);constructor(i,l){super(),this.backend=i,this.injector=l}handle(i){if(this.chain===null){let l=Array.from(new Set([...this.injector.get(aO),...this.injector.get(P5,[])]));this.chain=l.reduceRight((h,o)=>FQ(h,o,this.injector),kQ)}if(this.contributeToStability){let l=this.pendingTasks.add();return this.chain(i,h=>this.backend.handle(h)).pipe(Si(l))}else return this.chain(i,l=>this.backend.handle(l))}static \u0275fac=function(l){return new(l||t)(gn(Ib),gn(ds))};static \u0275prov=Qt({token:t,factory:t.\u0275fac})}return t})();var LQ=/^\)\]\}',?\n/,NQ=RegExp(`^${I5}:`,"m");function zQ(t){return"responseURL"in t&&t.responseURL?t.responseURL:NQ.test(t.getAllResponseHeaders())?t.getResponseHeader(I5):null}var sO=(()=>{class t{xhrFactory;constructor(i){this.xhrFactory=i}handle(i){if(i.method==="JSONP")throw new bn(-2800,!1);let l=this.xhrFactory;return Jn(null).pipe(us(()=>new xi(o=>{let E=l.build();if(E.open(i.method,i.urlWithParams),i.withCredentials&&(E.withCredentials=!0),i.headers.forEach((ot,kt)=>E.setRequestHeader(ot,kt.join(","))),i.headers.has(D5)||E.setRequestHeader(D5,AQ),!i.headers.has(S5)){let ot=i.detectContentTypeHeader();ot!==null&&E.setRequestHeader(S5,ot)}if(i.timeout&&(E.timeout=i.timeout),i.responseType){let ot=i.responseType.toLowerCase();E.responseType=ot!=="json"?ot:"text"}let A=i.serializeBody(),L=null,Y=()=>{if(L!==null)return L;let ot=E.statusText||"OK",kt=new bp(E.getAllResponseHeaders()),Cn=zQ(E)||i.url;return L=new OT({headers:kt,status:E.status,statusText:ot,url:Cn}),L},le=()=>{let{headers:ot,status:kt,statusText:Cn,url:Xn}=Y(),On=null;kt!==OQ&&(On=typeof E.response>"u"?E.responseText:E.response),kt===0&&(kt=On?PQ:0);let Vn=kt>=200&&kt<300;if(i.responseType==="json"&&typeof On=="string"){let rr=On;On=On.replace(LQ,"");try{On=On!==""?JSON.parse(On):null}catch(Vi){On=rr,Vn&&(Vn=!1,On={error:Vi,text:On})}}Vn?(o.next(new Mb({body:On,headers:ot,status:kt,statusText:Cn,url:Xn||void 0})),o.complete()):o.error(new xp({error:On,headers:ot,status:kt,statusText:Cn,url:Xn||void 0}))},te=ot=>{let{url:kt}=Y(),Cn=new xp({error:ot,status:E.status||0,statusText:E.statusText||"Unknown Error",url:kt||void 0});o.error(Cn)},ze=te;i.timeout&&(ze=ot=>{let{url:kt}=Y(),Cn=new xp({error:new DOMException("Request timed out","TimeoutError"),status:E.status||0,statusText:E.statusText||"Request timeout",url:kt||void 0});o.error(Cn)});let Ae=!1,Be=ot=>{Ae||(o.next(Y()),Ae=!0);let kt={type:og.DownloadProgress,loaded:ot.loaded};ot.lengthComputable&&(kt.total=ot.total),i.responseType==="text"&&E.responseText&&(kt.partialText=E.responseText),o.next(kt)},Tt=ot=>{let kt={type:og.UploadProgress,loaded:ot.loaded};ot.lengthComputable&&(kt.total=ot.total),o.next(kt)};return E.addEventListener("load",le),E.addEventListener("error",te),E.addEventListener("timeout",ze),E.addEventListener("abort",te),i.reportProgress&&(E.addEventListener("progress",Be),A!==null&&E.upload&&E.upload.addEventListener("progress",Tt)),E.send(A),o.next({type:og.Sent}),()=>{E.removeEventListener("error",te),E.removeEventListener("abort",te),E.removeEventListener("load",le),E.removeEventListener("timeout",ze),i.reportProgress&&(E.removeEventListener("progress",Be),A!==null&&E.upload&&E.upload.removeEventListener("progress",Tt)),E.readyState!==E.DONE&&E.abort()}})))}static \u0275fac=function(l){return new(l||t)(gn(rg))};static \u0275prov=Qt({token:t,factory:t.\u0275fac})}return t})(),R5=new Sn(""),BQ="XSRF-TOKEN",jQ=new Sn("",{providedIn:"root",factory:()=>BQ}),VQ="X-XSRF-TOKEN",UQ=new Sn("",{providedIn:"root",factory:()=>VQ}),Ab=class{},HQ=(()=>{class t{doc;cookieName;lastCookieString="";lastToken=null;parseCount=0;constructor(i,l){this.doc=i,this.cookieName=l}getToken(){let i=this.doc.cookie||"";return i!==this.lastCookieString&&(this.parseCount++,this.lastToken=wb(i,this.cookieName),this.lastCookieString=i),this.lastToken}static \u0275fac=function(l){return new(l||t)(gn(_o),gn(jQ))};static \u0275prov=Qt({token:t,factory:t.\u0275fac})}return t})();function $Q(t,n){let i=t.url.toLowerCase();if(!ft(R5)||t.method==="GET"||t.method==="HEAD"||i.startsWith("http://")||i.startsWith("https://"))return n(t);let l=ft(Ab).getToken(),h=ft(UQ);return l!=null&&!t.headers.has(h)&&(t=t.clone({headers:t.headers.set(h,l)})),n(t)}var lO=(function(t){return t[t.Interceptors=0]="Interceptors",t[t.LegacyInterceptors=1]="LegacyInterceptors",t[t.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",t[t.NoXsrfProtection=3]="NoXsrfProtection",t[t.JsonpSupport=4]="JsonpSupport",t[t.RequestsMadeViaParent=5]="RequestsMadeViaParent",t[t.Fetch=6]="Fetch",t})(lO||{});function GQ(t,n){return{\u0275kind:t,\u0275providers:n}}function cO(...t){let n=[aa,sO,RT,{provide:L0,useExisting:RT},{provide:Ib,useFactory:()=>ft(RQ,{optional:!0})??ft(sO)},{provide:aO,useValue:$Q,multi:!0},{provide:R5,useValue:!0},{provide:Ab,useClass:HQ}];for(let i of t)n.push(...i.\u0275providers);return bd(n)}function uO(t){return GQ(lO.Interceptors,t.map(n=>({provide:aO,useValue:n,multi:!0})))}var k5=(()=>{class t{_doc;constructor(i){this._doc=i}getTitle(){return this._doc.title}setTitle(i){this._doc.title=i||""}static \u0275fac=function(l){return new(l||t)(gn(_o))};static \u0275prov=Qt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var Ji="primary",Hb=Symbol("RouteTitle"),mO=class{params;constructor(n){this.params=n||{}}has(n){return Object.prototype.hasOwnProperty.call(this.params,n)}get(n){if(this.has(n)){let i=this.params[n];return Array.isArray(i)?i[0]:i}return null}getAll(n){if(this.has(n)){let i=this.params[n];return Array.isArray(i)?i:[i]}return[]}get keys(){return Object.keys(this.params)}};function lg(t){return new mO(t)}function U5(t,n,i){let l=i.path.split("/");if(l.length>t.length||i.pathMatch==="full"&&(n.hasChildren()||l.length<t.length))return null;let h={};for(let o=0;o<l.length;o++){let E=l[o],A=t[o];if(E[0]===":")h[E.substring(1)]=A;else if(E!==A.path)return null}return{consumed:t.slice(0,l.length),posParams:h}}function WQ(t,n){if(t.length!==n.length)return!1;for(let i=0;i<t.length;++i)if(!Ad(t[i],n[i]))return!1;return!0}function Ad(t,n){let i=t?gO(t):void 0,l=n?gO(n):void 0;if(!i||!l||i.length!=l.length)return!1;let h;for(let o=0;o<i.length;o++)if(h=i[o],!H5(t[h],n[h]))return!1;return!0}function gO(t){return[...Object.keys(t),...Object.getOwnPropertySymbols(t)]}function H5(t,n){if(Array.isArray(t)&&Array.isArray(n)){if(t.length!==n.length)return!1;let i=[...t].sort(),l=[...n].sort();return i.every((h,o)=>l[o]===h)}else return t===n}function $5(t){return t.length>0?t[t.length-1]:null}function Hh(t){return B2(t)?t:pp(t)?Co(Promise.resolve(t)):Jn(t)}var ZQ={exact:q5,subset:W5},G5={exact:XQ,subset:YQ,ignored:()=>!0};function F5(t,n,i){return ZQ[i.paths](t.root,n.root,i.matrixParams)&&G5[i.queryParams](t.queryParams,n.queryParams)&&!(i.fragment==="exact"&&t.fragment!==n.fragment)}function XQ(t,n){return Ad(t,n)}function q5(t,n,i){if(!sg(t.segments,n.segments)||!LT(t.segments,n.segments,i)||t.numberOfChildren!==n.numberOfChildren)return!1;for(let l in n.children)if(!t.children[l]||!q5(t.children[l],n.children[l],i))return!1;return!0}function YQ(t,n){return Object.keys(n).length<=Object.keys(t).length&&Object.keys(n).every(i=>H5(t[i],n[i]))}function W5(t,n,i){return Z5(t,n,n.segments,i)}function Z5(t,n,i,l){if(t.segments.length>i.length){let h=t.segments.slice(0,i.length);return!(!sg(h,i)||n.hasChildren()||!LT(h,i,l))}else if(t.segments.length===i.length){if(!sg(t.segments,i)||!LT(t.segments,i,l))return!1;for(let h in n.children)if(!t.children[h]||!W5(t.children[h],n.children[h],l))return!1;return!0}else{let h=i.slice(0,t.segments.length),o=i.slice(t.segments.length);return!sg(t.segments,h)||!LT(t.segments,h,l)||!t.children[Ji]?!1:Z5(t.children[Ji],n,o,l)}}function LT(t,n,i){return n.every((l,h)=>G5[i](t[h].parameters,l.parameters))}var Od=class{root;queryParams;fragment;_queryParamMap;constructor(n=new Wr([],{}),i={},l=null){this.root=n,this.queryParams=i,this.fragment=l}get queryParamMap(){return this._queryParamMap??=lg(this.queryParams),this._queryParamMap}toString(){return QQ.serialize(this)}},Wr=class{segments;children;parent=null;constructor(n,i){this.segments=n,this.children=i,Object.values(i).forEach(l=>l.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return NT(this)}},Cp=class{path;parameters;_parameterMap;constructor(n,i){this.path=n,this.parameters=i}get parameterMap(){return this._parameterMap??=lg(this.parameters),this._parameterMap}toString(){return Y5(this)}};function KQ(t,n){return sg(t,n)&&t.every((i,l)=>Ad(i.parameters,n[l].parameters))}function sg(t,n){return t.length!==n.length?!1:t.every((i,l)=>i.path===n[l].path)}function JQ(t,n){let i=[];return Object.entries(t.children).forEach(([l,h])=>{l===Ji&&(i=i.concat(n(h,l)))}),Object.entries(t.children).forEach(([l,h])=>{l!==Ji&&(i=i.concat(n(h,l)))}),i}var cg=(()=>{class t{static \u0275fac=function(l){return new(l||t)};static \u0275prov=Qt({token:t,factory:()=>new Ep,providedIn:"root"})}return t})(),Ep=class{parse(n){let i=new vO(n);return new Od(i.parseRootSegment(),i.parseQueryParams(),i.parseFragment())}serialize(n){let i=`/${Pb(n.root,!0)}`,l=nee(n.queryParams),h=typeof n.fragment=="string"?`#${eee(n.fragment)}`:"";return`${i}${l}${h}`}},QQ=new Ep;function NT(t){return t.segments.map(n=>Y5(n)).join("/")}function Pb(t,n){if(!t.hasChildren())return NT(t);if(n){let i=t.children[Ji]?Pb(t.children[Ji],!1):"",l=[];return Object.entries(t.children).forEach(([h,o])=>{h!==Ji&&l.push(`${h}:${Pb(o,!1)}`)}),l.length>0?`${i}(${l.join("//")})`:i}else{let i=JQ(t,(l,h)=>h===Ji?[Pb(t.children[Ji],!1)]:[`${h}:${Pb(l,!1)}`]);return Object.keys(t.children).length===1&&t.children[Ji]!=null?`${NT(t)}/${i[0]}`:`${NT(t)}/(${i.join("//")})`}}function X5(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function kT(t){return X5(t).replace(/%3B/gi,";")}function eee(t){return encodeURI(t)}function _O(t){return X5(t).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function zT(t){return decodeURIComponent(t)}function L5(t){return zT(t.replace(/\+/g,"%20"))}function Y5(t){return`${_O(t.path)}${tee(t.parameters)}`}function tee(t){return Object.entries(t).map(([n,i])=>`;${_O(n)}=${_O(i)}`).join("")}function nee(t){let n=Object.entries(t).map(([i,l])=>Array.isArray(l)?l.map(h=>`${kT(i)}=${kT(h)}`).join("&"):`${kT(i)}=${kT(l)}`).filter(i=>i);return n.length?`?${n.join("&")}`:""}var iee=/^[^\/()?;#]+/;function dO(t){let n=t.match(iee);return n?n[0]:""}var ree=/^[^\/()?;=#]+/;function oee(t){let n=t.match(ree);return n?n[0]:""}var see=/^[^=?&#]+/;function aee(t){let n=t.match(see);return n?n[0]:""}var lee=/^[^&#]+/;function cee(t){let n=t.match(lee);return n?n[0]:""}var vO=class{url;remaining;constructor(n){this.url=n,this.remaining=n}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new Wr([],{}):new Wr([],this.parseChildren())}parseQueryParams(){let n={};if(this.consumeOptional("?"))do this.parseQueryParam(n);while(this.consumeOptional("&"));return n}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let n=[];for(this.peekStartsWith("(")||n.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),n.push(this.parseSegment());let i={};this.peekStartsWith("/(")&&(this.capture("/"),i=this.parseParens(!0));let l={};return this.peekStartsWith("(")&&(l=this.parseParens(!1)),(n.length>0||Object.keys(i).length>0)&&(l[Ji]=new Wr(n,i)),l}parseSegment(){let n=dO(this.remaining);if(n===""&&this.peekStartsWith(";"))throw new bn(4009,!1);return this.capture(n),new Cp(zT(n),this.parseMatrixParams())}parseMatrixParams(){let n={};for(;this.consumeOptional(";");)this.parseParam(n);return n}parseParam(n){let i=oee(this.remaining);if(!i)return;this.capture(i);let l="";if(this.consumeOptional("=")){let h=dO(this.remaining);h&&(l=h,this.capture(l))}n[zT(i)]=zT(l)}parseQueryParam(n){let i=aee(this.remaining);if(!i)return;this.capture(i);let l="";if(this.consumeOptional("=")){let E=cee(this.remaining);E&&(l=E,this.capture(l))}let h=L5(i),o=L5(l);if(n.hasOwnProperty(h)){let E=n[h];Array.isArray(E)||(E=[E],n[h]=E),E.push(o)}else n[h]=o}parseParens(n){let i={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let l=dO(this.remaining),h=this.remaining[l.length];if(h!=="/"&&h!==")"&&h!==";")throw new bn(4010,!1);let o;l.indexOf(":")>-1?(o=l.slice(0,l.indexOf(":")),this.capture(o),this.capture(":")):n&&(o=Ji);let E=this.parseChildren();i[o]=Object.keys(E).length===1?E[Ji]:new Wr([],E),this.consumeOptional("//")}return i}peekStartsWith(n){return this.remaining.startsWith(n)}consumeOptional(n){return this.peekStartsWith(n)?(this.remaining=this.remaining.substring(n.length),!0):!1}capture(n){if(!this.consumeOptional(n))throw new bn(4011,!1)}};function K5(t){return t.segments.length>0?new Wr([],{[Ji]:t}):t}function J5(t){let n={};for(let[l,h]of Object.entries(t.children)){let o=J5(h);if(l===Ji&&o.segments.length===0&&o.hasChildren())for(let[E,A]of Object.entries(o.children))n[E]=A;else(o.segments.length>0||o.hasChildren())&&(n[l]=o)}let i=new Wr(t.segments,n);return uee(i)}function uee(t){if(t.numberOfChildren===1&&t.children[Ji]){let n=t.children[Ji];return new Wr(t.segments.concat(n.segments),n.children)}return t}function Tp(t){return t instanceof Od}function Q5(t,n,i=null,l=null){let h=e4(t);return t4(h,n,i,l)}function e4(t){let n;function i(o){let E={};for(let L of o.children){let Y=i(L);E[L.outlet]=Y}let A=new Wr(o.url,E);return o===t&&(n=A),A}let l=i(t.root),h=K5(l);return n??h}function t4(t,n,i,l){let h=t;for(;h.parent;)h=h.parent;if(n.length===0)return hO(h,h,h,i,l);let o=dee(n);if(o.toRoot())return hO(h,h,new Wr([],{}),i,l);let E=hee(o,h,t),A=E.processChildren?Rb(E.segmentGroup,E.index,o.commands):i4(E.segmentGroup,E.index,o.commands);return hO(h,E.segmentGroup,A,i,l)}function BT(t){return typeof t=="object"&&t!=null&&!t.outlets&&!t.segmentPath}function Fb(t){return typeof t=="object"&&t!=null&&t.outlets}function hO(t,n,i,l,h){let o={};l&&Object.entries(l).forEach(([L,Y])=>{o[L]=Array.isArray(Y)?Y.map(le=>`${le}`):`${Y}`});let E;t===n?E=i:E=n4(t,n,i);let A=K5(J5(E));return new Od(A,o,h)}function n4(t,n,i){let l={};return Object.entries(t.children).forEach(([h,o])=>{o===n?l[h]=i:l[h]=n4(o,n,i)}),new Wr(t.segments,l)}var jT=class{isAbsolute;numberOfDoubleDots;commands;constructor(n,i,l){if(this.isAbsolute=n,this.numberOfDoubleDots=i,this.commands=l,n&&l.length>0&&BT(l[0]))throw new bn(4003,!1);let h=l.find(Fb);if(h&&h!==$5(l))throw new bn(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function dee(t){if(typeof t[0]=="string"&&t.length===1&&t[0]==="/")return new jT(!0,0,t);let n=0,i=!1,l=t.reduce((h,o,E)=>{if(typeof o=="object"&&o!=null){if(o.outlets){let A={};return Object.entries(o.outlets).forEach(([L,Y])=>{A[L]=typeof Y=="string"?Y.split("/"):Y}),[...h,{outlets:A}]}if(o.segmentPath)return[...h,o.segmentPath]}return typeof o!="string"?[...h,o]:E===0?(o.split("/").forEach((A,L)=>{L==0&&A==="."||(L==0&&A===""?i=!0:A===".."?n++:A!=""&&h.push(A))}),h):[...h,o]},[]);return new jT(i,n,l)}var j0=class{segmentGroup;processChildren;index;constructor(n,i,l){this.segmentGroup=n,this.processChildren=i,this.index=l}};function hee(t,n,i){if(t.isAbsolute)return new j0(n,!0,0);if(!i)return new j0(n,!1,NaN);if(i.parent===null)return new j0(i,!0,0);let l=BT(t.commands[0])?0:1,h=i.segments.length-1+l;return fee(i,h,t.numberOfDoubleDots)}function fee(t,n,i){let l=t,h=n,o=i;for(;o>h;){if(o-=h,l=l.parent,!l)throw new bn(4005,!1);h=l.segments.length}return new j0(l,!1,h-o)}function pee(t){return Fb(t[0])?t[0].outlets:{[Ji]:t}}function i4(t,n,i){if(t??=new Wr([],{}),t.segments.length===0&&t.hasChildren())return Rb(t,n,i);let l=mee(t,n,i),h=i.slice(l.commandIndex);if(l.match&&l.pathIndex<t.segments.length){let o=new Wr(t.segments.slice(0,l.pathIndex),{});return o.children[Ji]=new Wr(t.segments.slice(l.pathIndex),t.children),Rb(o,0,h)}else return l.match&&h.length===0?new Wr(t.segments,{}):l.match&&!t.hasChildren()?yO(t,n,i):l.match?Rb(t,0,h):yO(t,n,i)}function Rb(t,n,i){if(i.length===0)return new Wr(t.segments,{});{let l=pee(i),h={};if(Object.keys(l).some(o=>o!==Ji)&&t.children[Ji]&&t.numberOfChildren===1&&t.children[Ji].segments.length===0){let o=Rb(t.children[Ji],n,i);return new Wr(t.segments,o.children)}return Object.entries(l).forEach(([o,E])=>{typeof E=="string"&&(E=[E]),E!==null&&(h[o]=i4(t.children[o],n,E))}),Object.entries(t.children).forEach(([o,E])=>{l[o]===void 0&&(h[o]=E)}),new Wr(t.segments,h)}}function mee(t,n,i){let l=0,h=n,o={match:!1,pathIndex:0,commandIndex:0};for(;h<t.segments.length;){if(l>=i.length)return o;let E=t.segments[h],A=i[l];if(Fb(A))break;let L=`${A}`,Y=l<i.length-1?i[l+1]:null;if(h>0&&L===void 0)break;if(L&&Y&&typeof Y=="object"&&Y.outlets===void 0){if(!z5(L,Y,E))return o;l+=2}else{if(!z5(L,{},E))return o;l++}h++}return{match:!0,pathIndex:h,commandIndex:l}}function yO(t,n,i){let l=t.segments.slice(0,n),h=0;for(;h<i.length;){let o=i[h];if(Fb(o)){let L=gee(o.outlets);return new Wr(l,L)}if(h===0&&BT(i[0])){let L=t.segments[n];l.push(new Cp(L.path,N5(i[0]))),h++;continue}let E=Fb(o)?o.outlets[Ji]:`${o}`,A=h<i.length-1?i[h+1]:null;E&&A&&BT(A)?(l.push(new Cp(E,N5(A))),h+=2):(l.push(new Cp(E,{})),h++)}return new Wr(l,{})}function gee(t){let n={};return Object.entries(t).forEach(([i,l])=>{typeof l=="string"&&(l=[l]),l!==null&&(n[i]=yO(new Wr([],{}),0,l))}),n}function N5(t){let n={};return Object.entries(t).forEach(([i,l])=>n[i]=`${l}`),n}function z5(t,n,i){return t==i.path&&Ad(n,i.parameters)}var V0="imperative",$s=(function(t){return t[t.NavigationStart=0]="NavigationStart",t[t.NavigationEnd=1]="NavigationEnd",t[t.NavigationCancel=2]="NavigationCancel",t[t.NavigationError=3]="NavigationError",t[t.RoutesRecognized=4]="RoutesRecognized",t[t.ResolveStart=5]="ResolveStart",t[t.ResolveEnd=6]="ResolveEnd",t[t.GuardsCheckStart=7]="GuardsCheckStart",t[t.GuardsCheckEnd=8]="GuardsCheckEnd",t[t.RouteConfigLoadStart=9]="RouteConfigLoadStart",t[t.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",t[t.ChildActivationStart=11]="ChildActivationStart",t[t.ChildActivationEnd=12]="ChildActivationEnd",t[t.ActivationStart=13]="ActivationStart",t[t.ActivationEnd=14]="ActivationEnd",t[t.Scroll=15]="Scroll",t[t.NavigationSkipped=16]="NavigationSkipped",t})($s||{}),ac=class{id;url;constructor(n,i){this.id=n,this.url=i}},Sp=class extends ac{type=$s.NavigationStart;navigationTrigger;restoredState;constructor(n,i,l="imperative",h=null){super(n,i),this.navigationTrigger=l,this.restoredState=h}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},Fc=class extends ac{urlAfterRedirects;type=$s.NavigationEnd;constructor(n,i,l){super(n,i),this.urlAfterRedirects=l}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},ml=(function(t){return t[t.Redirect=0]="Redirect",t[t.SupersededByNewNavigation=1]="SupersededByNewNavigation",t[t.NoDataFromResolver=2]="NoDataFromResolver",t[t.GuardRejected=3]="GuardRejected",t[t.Aborted=4]="Aborted",t})(ml||{}),H0=(function(t){return t[t.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",t[t.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",t})(H0||{}),Pd=class extends ac{reason;code;type=$s.NavigationCancel;constructor(n,i,l,h){super(n,i),this.reason=l,this.code=h}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Rd=class extends ac{reason;code;type=$s.NavigationSkipped;constructor(n,i,l,h){super(n,i),this.reason=l,this.code=h}},$0=class extends ac{error;target;type=$s.NavigationError;constructor(n,i,l,h){super(n,i),this.error=l,this.target=h}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},Lb=class extends ac{urlAfterRedirects;state;type=$s.RoutesRecognized;constructor(n,i,l,h){super(n,i),this.urlAfterRedirects=l,this.state=h}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},VT=class extends ac{urlAfterRedirects;state;type=$s.GuardsCheckStart;constructor(n,i,l,h){super(n,i),this.urlAfterRedirects=l,this.state=h}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},UT=class extends ac{urlAfterRedirects;state;shouldActivate;type=$s.GuardsCheckEnd;constructor(n,i,l,h,o){super(n,i),this.urlAfterRedirects=l,this.state=h,this.shouldActivate=o}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},HT=class extends ac{urlAfterRedirects;state;type=$s.ResolveStart;constructor(n,i,l,h){super(n,i),this.urlAfterRedirects=l,this.state=h}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},$T=class extends ac{urlAfterRedirects;state;type=$s.ResolveEnd;constructor(n,i,l,h){super(n,i),this.urlAfterRedirects=l,this.state=h}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},GT=class{route;type=$s.RouteConfigLoadStart;constructor(n){this.route=n}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},qT=class{route;type=$s.RouteConfigLoadEnd;constructor(n){this.route=n}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},WT=class{snapshot;type=$s.ChildActivationStart;constructor(n){this.snapshot=n}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},ZT=class{snapshot;type=$s.ChildActivationEnd;constructor(n){this.snapshot=n}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},XT=class{snapshot;type=$s.ActivationStart;constructor(n){this.snapshot=n}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},YT=class{snapshot;type=$s.ActivationEnd;constructor(n){this.snapshot=n}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},G0=class{routerEvent;position;anchor;type=$s.Scroll;constructor(n,i,l){this.routerEvent=n,this.position=i,this.anchor=l}toString(){let n=this.position?`${this.position[0]}, ${this.position[1]}`:null;return`Scroll(anchor: '${this.anchor}', position: '${n}')`}},Nb=class{},q0=class{url;navigationBehaviorOptions;constructor(n,i){this.url=n,this.navigationBehaviorOptions=i}};function _ee(t){return!(t instanceof Nb)&&!(t instanceof q0)}function vee(t,n){return t.providers&&!t._injector&&(t._injector=P0(t.providers,n,`Route: ${t.path}`)),t._injector??n}function Pu(t){return t.outlet||Ji}function yee(t,n){let i=t.filter(l=>Pu(l)===n);return i.push(...t.filter(l=>Pu(l)!==n)),i}function X0(t){if(!t)return null;if(t.routeConfig?._injector)return t.routeConfig._injector;for(let n=t.parent;n;n=n.parent){let i=n.routeConfig;if(i?._loadedInjector)return i._loadedInjector;if(i?._injector)return i._injector}return null}var KT=class{rootInjector;outlet=null;route=null;children;attachRef=null;get injector(){return X0(this.route?.snapshot)??this.rootInjector}constructor(n){this.rootInjector=n,this.children=new ug(this.rootInjector)}},ug=(()=>{class t{rootInjector;contexts=new Map;constructor(i){this.rootInjector=i}onChildOutletCreated(i,l){let h=this.getOrCreateContext(i);h.outlet=l,this.contexts.set(i,h)}onChildOutletDestroyed(i){let l=this.getContext(i);l&&(l.outlet=null,l.attachRef=null)}onOutletDeactivated(){let i=this.contexts;return this.contexts=new Map,i}onOutletReAttached(i){this.contexts=i}getOrCreateContext(i){let l=this.getContext(i);return l||(l=new KT(this.rootInjector),this.contexts.set(i,l)),l}getContext(i){return this.contexts.get(i)||null}static \u0275fac=function(l){return new(l||t)(gn(ds))};static \u0275prov=Qt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),JT=class{_root;constructor(n){this._root=n}get root(){return this._root.value}parent(n){let i=this.pathFromRoot(n);return i.length>1?i[i.length-2]:null}children(n){let i=xO(n,this._root);return i?i.children.map(l=>l.value):[]}firstChild(n){let i=xO(n,this._root);return i&&i.children.length>0?i.children[0].value:null}siblings(n){let i=bO(n,this._root);return i.length<2?[]:i[i.length-2].children.map(h=>h.value).filter(h=>h!==n)}pathFromRoot(n){return bO(n,this._root).map(i=>i.value)}};function xO(t,n){if(t===n.value)return n;for(let i of n.children){let l=xO(t,i);if(l)return l}return null}function bO(t,n){if(t===n.value)return[n];for(let i of n.children){let l=bO(t,i);if(l.length)return l.unshift(n),l}return[]}var sc=class{value;children;constructor(n,i){this.value=n,this.children=i}toString(){return`TreeNode(${this.value})`}};function B0(t){let n={};return t&&t.children.forEach(i=>n[i.value.outlet]=i),n}var zb=class extends JT{snapshot;constructor(n,i){super(n),this.snapshot=i,MO(this,n)}toString(){return this.snapshot.toString()}};function r4(t){let n=xee(t),i=new Ho([new Cp("",{})]),l=new Ho({}),h=new Ho({}),o=new Ho({}),E=new Ho(""),A=new la(i,l,o,E,h,Ji,t,n.root);return A.snapshot=n.root,new zb(new sc(A,[]),n)}function xee(t){let n={},i={},l={},o=new ag([],n,l,"",i,Ji,t,null,{});return new Bb("",new sc(o,[]))}var la=class{urlSubject;paramsSubject;queryParamsSubject;fragmentSubject;dataSubject;outlet;component;snapshot;_futureSnapshot;_routerState;_paramMap;_queryParamMap;title;url;params;queryParams;fragment;data;constructor(n,i,l,h,o,E,A,L){this.urlSubject=n,this.paramsSubject=i,this.queryParamsSubject=l,this.fragmentSubject=h,this.dataSubject=o,this.outlet=E,this.component=A,this._futureSnapshot=L,this.title=this.dataSubject?.pipe(di(Y=>Y[Hb]))??Jn(void 0),this.url=n,this.params=i,this.queryParams=l,this.fragment=h,this.data=o}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(di(n=>lg(n))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(di(n=>lg(n))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function QT(t,n,i="emptyOnly"){let l,{routeConfig:h}=t;return n!==null&&(i==="always"||h?.path===""||!n.component&&!n.routeConfig?.loadComponent)?l={params:Jt(Jt({},n.params),t.params),data:Jt(Jt({},n.data),t.data),resolve:Jt(Jt(Jt(Jt({},t.data),n.data),h?.data),t._resolvedData)}:l={params:Jt({},t.params),data:Jt({},t.data),resolve:Jt(Jt({},t.data),t._resolvedData??{})},h&&s4(h)&&(l.resolve[Hb]=h.title),l}var ag=class{url;params;queryParams;fragment;data;outlet;component;routeConfig;_resolve;_resolvedData;_routerState;_paramMap;_queryParamMap;get title(){return this.data?.[Hb]}constructor(n,i,l,h,o,E,A,L,Y){this.url=n,this.params=i,this.queryParams=l,this.fragment=h,this.data=o,this.outlet=E,this.component=A,this.routeConfig=L,this._resolve=Y}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=lg(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=lg(this.queryParams),this._queryParamMap}toString(){let n=this.url.map(l=>l.toString()).join("/"),i=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${n}', path:'${i}')`}},Bb=class extends JT{url;constructor(n,i){super(i),this.url=n,MO(this,i)}toString(){return o4(this._root)}};function MO(t,n){n.value._routerState=t,n.children.forEach(i=>MO(t,i))}function o4(t){let n=t.children.length>0?` { ${t.children.map(o4).join(", ")} } `:"";return`${t.value}${n}`}function fO(t){if(t.snapshot){let n=t.snapshot,i=t._futureSnapshot;t.snapshot=i,Ad(n.queryParams,i.queryParams)||t.queryParamsSubject.next(i.queryParams),n.fragment!==i.fragment&&t.fragmentSubject.next(i.fragment),Ad(n.params,i.params)||t.paramsSubject.next(i.params),WQ(n.url,i.url)||t.urlSubject.next(i.url),Ad(n.data,i.data)||t.dataSubject.next(i.data)}else t.snapshot=t._futureSnapshot,t.dataSubject.next(t._futureSnapshot.data)}function wO(t,n){let i=Ad(t.params,n.params)&&KQ(t.url,n.url),l=!t.parent!=!n.parent;return i&&!l&&(!t.parent||wO(t.parent,n.parent))}function s4(t){return typeof t.title=="string"||t.title===null}var a4=new Sn(""),$b=(()=>{class t{activated=null;get activatedComponentRef(){return this.activated}_activatedRoute=null;name=Ji;activateEvents=new qi;deactivateEvents=new qi;attachEvents=new qi;detachEvents=new qi;routerOutletData=$V(void 0);parentContexts=ft(ug);location=ft(Oc);changeDetector=ft(Md);inputBinder=ft(Gb,{optional:!0});supportsBindingToComponentInputs=!0;ngOnChanges(i){if(i.name){let{firstChange:l,previousValue:h}=i.name;if(l)return;this.isTrackedInParentContexts(h)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(h)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(i){return this.parentContexts.getContext(i)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let i=this.parentContexts.getContext(this.name);i?.route&&(i.attachRef?this.attach(i.attachRef,i.route):this.activateWith(i.route,i.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new bn(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new bn(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new bn(4012,!1);this.location.detach();let i=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(i.instance),i}attach(i,l){this.activated=i,this._activatedRoute=l,this.location.insert(i.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(i.instance)}deactivate(){if(this.activated){let i=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(i)}}activateWith(i,l){if(this.isActivated)throw new bn(4013,!1);this._activatedRoute=i;let h=this.location,E=i.snapshot.component,A=this.parentContexts.getOrCreateContext(this.name).children,L=new CO(i,A,h.injector,this.routerOutletData);this.activated=h.createComponent(E,{index:h.length,injector:L,environmentInjector:l}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static \u0275fac=function(l){return new(l||t)};static \u0275dir=Ki({type:t,selectors:[["router-outlet"]],inputs:{name:"name",routerOutletData:[1,"routerOutletData"]},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],features:[wa]})}return t})(),CO=class{route;childContexts;parent;outletData;constructor(n,i,l,h){this.route=n,this.childContexts=i,this.parent=l,this.outletData=h}get(n,i){return n===la?this.route:n===ug?this.childContexts:n===a4?this.outletData:this.parent.get(n,i)}},Gb=new Sn(""),AO=(()=>{class t{outletDataSubscriptions=new Map;bindActivatedRouteToOutletComponent(i){this.unsubscribeFromRouteData(i),this.subscribeToRouteData(i)}unsubscribeFromRouteData(i){this.outletDataSubscriptions.get(i)?.unsubscribe(),this.outletDataSubscriptions.delete(i)}subscribeToRouteData(i){let{activatedRoute:l}=i,h=Rm([l.queryParams,l.params,l.data]).pipe(us(([o,E,A],L)=>(A=Jt(Jt(Jt({},o),E),A),L===0?Jn(A):Promise.resolve(A)))).subscribe(o=>{if(!i.isActivated||!i.activatedComponentRef||i.activatedRoute!==l||l.component===null){this.unsubscribeFromRouteData(i);return}let E=qV(l.component);if(!E){this.unsubscribeFromRouteData(i);return}for(let{templateName:A}of E.inputs)i.activatedComponentRef.setInput(A,o[A])});this.outletDataSubscriptions.set(i,h)}static \u0275fac=function(l){return new(l||t)};static \u0275prov=Qt({token:t,factory:t.\u0275fac})}return t})(),PO=(()=>{class t{static \u0275fac=function(l){return new(l||t)};static \u0275cmp=Ai({type:t,selectors:[["ng-component"]],exportAs:["emptyRouterOutlet"],decls:1,vars:0,template:function(l,h){l&1&&be(0,"router-outlet")},dependencies:[$b],encapsulation:2})}return t})();function OO(t){let n=t.children&&t.children.map(OO),i=n?Mi(Jt({},t),{children:n}):Jt({},t);return!i.component&&!i.loadComponent&&(n||i.loadChildren)&&i.outlet&&i.outlet!==Ji&&(i.component=PO),i}function bee(t,n,i){let l=jb(t,n._root,i?i._root:void 0);return new zb(l,n)}function jb(t,n,i){if(i&&t.shouldReuseRoute(n.value,i.value.snapshot)){let l=i.value;l._futureSnapshot=n.value;let h=wee(t,n,i);return new sc(l,h)}else{if(t.shouldAttach(n.value)){let o=t.retrieve(n.value);if(o!==null){let E=o.route;return E.value._futureSnapshot=n.value,E.children=n.children.map(A=>jb(t,A)),E}}let l=Cee(n.value),h=n.children.map(o=>jb(t,o));return new sc(l,h)}}function wee(t,n,i){return n.children.map(l=>{for(let h of i.children)if(t.shouldReuseRoute(l.value,h.value.snapshot))return jb(t,l,h);return jb(t,l)})}function Cee(t){return new la(new Ho(t.url),new Ho(t.params),new Ho(t.queryParams),new Ho(t.fragment),new Ho(t.data),t.outlet,t.component,t)}var W0=class{redirectTo;navigationBehaviorOptions;constructor(n,i){this.redirectTo=n,this.navigationBehaviorOptions=i}},l4="ngNavigationCancelingError";function eS(t,n){let{redirectTo:i,navigationBehaviorOptions:l}=Tp(n)?{redirectTo:n,navigationBehaviorOptions:void 0}:n,h=c4(!1,ml.Redirect);return h.url=i,h.navigationBehaviorOptions=l,h}function c4(t,n){let i=new Error(`NavigationCancelingError: ${t||""}`);return i[l4]=!0,i.cancellationCode=n,i}function Eee(t){return u4(t)&&Tp(t.url)}function u4(t){return!!t&&t[l4]}var Tee=(t,n,i,l)=>di(h=>(new EO(n,h.targetRouterState,h.currentRouterState,i,l).activate(t),h)),EO=class{routeReuseStrategy;futureState;currState;forwardEvent;inputBindingEnabled;constructor(n,i,l,h,o){this.routeReuseStrategy=n,this.futureState=i,this.currState=l,this.forwardEvent=h,this.inputBindingEnabled=o}activate(n){let i=this.futureState._root,l=this.currState?this.currState._root:null;this.deactivateChildRoutes(i,l,n),fO(this.futureState.root),this.activateChildRoutes(i,l,n)}deactivateChildRoutes(n,i,l){let h=B0(i);n.children.forEach(o=>{let E=o.value.outlet;this.deactivateRoutes(o,h[E],l),delete h[E]}),Object.values(h).forEach(o=>{this.deactivateRouteAndItsChildren(o,l)})}deactivateRoutes(n,i,l){let h=n.value,o=i?i.value:null;if(h===o)if(h.component){let E=l.getContext(h.outlet);E&&this.deactivateChildRoutes(n,i,E.children)}else this.deactivateChildRoutes(n,i,l);else o&&this.deactivateRouteAndItsChildren(i,l)}deactivateRouteAndItsChildren(n,i){n.value.component&&this.routeReuseStrategy.shouldDetach(n.value.snapshot)?this.detachAndStoreRouteSubtree(n,i):this.deactivateRouteAndOutlet(n,i)}detachAndStoreRouteSubtree(n,i){let l=i.getContext(n.value.outlet),h=l&&n.value.component?l.children:i,o=B0(n);for(let E of Object.values(o))this.deactivateRouteAndItsChildren(E,h);if(l&&l.outlet){let E=l.outlet.detach(),A=l.children.onOutletDeactivated();this.routeReuseStrategy.store(n.value.snapshot,{componentRef:E,route:n,contexts:A})}}deactivateRouteAndOutlet(n,i){let l=i.getContext(n.value.outlet),h=l&&n.value.component?l.children:i,o=B0(n);for(let E of Object.values(o))this.deactivateRouteAndItsChildren(E,h);l&&(l.outlet&&(l.outlet.deactivate(),l.children.onOutletDeactivated()),l.attachRef=null,l.route=null)}activateChildRoutes(n,i,l){let h=B0(i);n.children.forEach(o=>{this.activateRoutes(o,h[o.value.outlet],l),this.forwardEvent(new YT(o.value.snapshot))}),n.children.length&&this.forwardEvent(new ZT(n.value.snapshot))}activateRoutes(n,i,l){let h=n.value,o=i?i.value:null;if(fO(h),h===o)if(h.component){let E=l.getOrCreateContext(h.outlet);this.activateChildRoutes(n,i,E.children)}else this.activateChildRoutes(n,i,l);else if(h.component){let E=l.getOrCreateContext(h.outlet);if(this.routeReuseStrategy.shouldAttach(h.snapshot)){let A=this.routeReuseStrategy.retrieve(h.snapshot);this.routeReuseStrategy.store(h.snapshot,null),E.children.onOutletReAttached(A.contexts),E.attachRef=A.componentRef,E.route=A.route.value,E.outlet&&E.outlet.attach(A.componentRef,A.route.value),fO(A.route.value),this.activateChildRoutes(n,null,E.children)}else E.attachRef=null,E.route=h,E.outlet&&E.outlet.activateWith(h,E.injector),this.activateChildRoutes(n,null,E.children)}else this.activateChildRoutes(n,null,l)}},tS=class{path;route;constructor(n){this.path=n,this.route=this.path[this.path.length-1]}},U0=class{component;route;constructor(n,i){this.component=n,this.route=i}};function See(t,n,i){let l=t._root,h=n?n._root:null;return Ob(l,h,i,[l.value])}function Dee(t){let n=t.routeConfig?t.routeConfig.canActivateChild:null;return!n||n.length===0?null:{node:t,guards:n}}function Y0(t,n){let i=Symbol(),l=n.get(t,i);return l===i?typeof t=="function"&&!rM(t)?t:n.get(t):l}function Ob(t,n,i,l,h={canDeactivateChecks:[],canActivateChecks:[]}){let o=B0(n);return t.children.forEach(E=>{Iee(E,o[E.value.outlet],i,l.concat([E.value]),h),delete o[E.value.outlet]}),Object.entries(o).forEach(([E,A])=>kb(A,i.getContext(E),h)),h}function Iee(t,n,i,l,h={canDeactivateChecks:[],canActivateChecks:[]}){let o=t.value,E=n?n.value:null,A=i?i.getContext(t.value.outlet):null;if(E&&o.routeConfig===E.routeConfig){let L=Mee(E,o,o.routeConfig.runGuardsAndResolvers);L?h.canActivateChecks.push(new tS(l)):(o.data=E.data,o._resolvedData=E._resolvedData),o.component?Ob(t,n,A?A.children:null,l,h):Ob(t,n,i,l,h),L&&A&&A.outlet&&A.outlet.isActivated&&h.canDeactivateChecks.push(new U0(A.outlet.component,E))}else E&&kb(n,A,h),h.canActivateChecks.push(new tS(l)),o.component?Ob(t,null,A?A.children:null,l,h):Ob(t,null,i,l,h);return h}function Mee(t,n,i){if(typeof i=="function")return i(t,n);switch(i){case"pathParamsChange":return!sg(t.url,n.url);case"pathParamsOrQueryParamsChange":return!sg(t.url,n.url)||!Ad(t.queryParams,n.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!wO(t,n)||!Ad(t.queryParams,n.queryParams);case"paramsChange":default:return!wO(t,n)}}function kb(t,n,i){let l=B0(t),h=t.value;Object.entries(l).forEach(([o,E])=>{h.component?n?kb(E,n.children.getContext(o),i):kb(E,null,i):kb(E,n,i)}),h.component?n&&n.outlet&&n.outlet.isActivated?i.canDeactivateChecks.push(new U0(n.outlet.component,h)):i.canDeactivateChecks.push(new U0(null,h)):i.canDeactivateChecks.push(new U0(null,h))}function qb(t){return typeof t=="function"}function Aee(t){return typeof t=="boolean"}function Pee(t){return t&&qb(t.canLoad)}function Oee(t){return t&&qb(t.canActivate)}function Ree(t){return t&&qb(t.canActivateChild)}function kee(t){return t&&qb(t.canDeactivate)}function Fee(t){return t&&qb(t.canMatch)}function d4(t){return t instanceof Mh||t?.name==="EmptyError"}var FT=Symbol("INITIAL_VALUE");function Z0(){return us(t=>Rm(t.map(n=>n.pipe(Al(1),d0(FT)))).pipe(di(n=>{for(let i of n)if(i!==!0){if(i===FT)return FT;if(i===!1||Lee(i))return i}return!0}),To(n=>n!==FT),Al(1)))}function Lee(t){return Tp(t)||t instanceof W0}function Nee(t,n){return Eo(i=>{let{targetSnapshot:l,currentSnapshot:h,guards:{canActivateChecks:o,canDeactivateChecks:E}}=i;return E.length===0&&o.length===0?Jn(Mi(Jt({},i),{guardsResult:!0})):zee(E,l,h,t).pipe(Eo(A=>A&&Aee(A)?Bee(l,o,t,n):Jn(A)),di(A=>Mi(Jt({},i),{guardsResult:A})))})}function zee(t,n,i,l){return Co(t).pipe(Eo(h=>$ee(h.component,h.route,i,n,l)),Ah(h=>h!==!0,!0))}function Bee(t,n,i,l){return Co(n).pipe(xd(h=>c0(Vee(h.route.parent,l),jee(h.route,l),Hee(t,h.path,i),Uee(t,h.route,i))),Ah(h=>h!==!0,!0))}function jee(t,n){return t!==null&&n&&n(new XT(t)),Jn(!0)}function Vee(t,n){return t!==null&&n&&n(new WT(t)),Jn(!0)}function Uee(t,n,i){let l=n.routeConfig?n.routeConfig.canActivate:null;if(!l||l.length===0)return Jn(!0);let h=l.map(o=>Cx(()=>{let E=X0(n)??i,A=Y0(o,E),L=Oee(A)?A.canActivate(n,t):ta(E,()=>A(n,t));return Hh(L).pipe(Ah())}));return Jn(h).pipe(Z0())}function Hee(t,n,i){let l=n[n.length-1],o=n.slice(0,n.length-1).reverse().map(E=>Dee(E)).filter(E=>E!==null).map(E=>Cx(()=>{let A=E.guards.map(L=>{let Y=X0(E.node)??i,le=Y0(L,Y),te=Ree(le)?le.canActivateChild(l,t):ta(Y,()=>le(l,t));return Hh(te).pipe(Ah())});return Jn(A).pipe(Z0())}));return Jn(o).pipe(Z0())}function $ee(t,n,i,l,h){let o=n&&n.routeConfig?n.routeConfig.canDeactivate:null;if(!o||o.length===0)return Jn(!0);let E=o.map(A=>{let L=X0(n)??h,Y=Y0(A,L),le=kee(Y)?Y.canDeactivate(t,n,i,l):ta(L,()=>Y(t,n,i,l));return Hh(le).pipe(Ah())});return Jn(E).pipe(Z0())}function Gee(t,n,i,l){let h=n.canLoad;if(h===void 0||h.length===0)return Jn(!0);let o=h.map(E=>{let A=Y0(E,t),L=Pee(A)?A.canLoad(n,i):ta(t,()=>A(n,i));return Hh(L)});return Jn(o).pipe(Z0(),h4(l))}function h4(t){return k2(ea(n=>{if(typeof n!="boolean")throw eS(t,n)}),di(n=>n===!0))}function qee(t,n,i,l){let h=n.canMatch;if(!h||h.length===0)return Jn(!0);let o=h.map(E=>{let A=Y0(E,t),L=Fee(A)?A.canMatch(n,i):ta(t,()=>A(n,i));return Hh(L)});return Jn(o).pipe(Z0(),h4(l))}var Vb=class{segmentGroup;constructor(n){this.segmentGroup=n||null}},Ub=class extends Error{urlTree;constructor(n){super(),this.urlTree=n}};function z0(t){return vd(new Vb(t))}function Wee(t){return vd(new bn(4e3,!1))}function Zee(t){return vd(c4(!1,ml.GuardRejected))}var TO=class{urlSerializer;urlTree;constructor(n,i){this.urlSerializer=n,this.urlTree=i}lineralizeSegments(n,i){let l=[],h=i.root;for(;;){if(l=l.concat(h.segments),h.numberOfChildren===0)return Jn(l);if(h.numberOfChildren>1||!h.children[Ji])return Wee(`${n.redirectTo}`);h=h.children[Ji]}}applyRedirectCommands(n,i,l,h,o){return Xee(i,h,o).pipe(di(E=>{if(E instanceof Od)throw new Ub(E);let A=this.applyRedirectCreateUrlTree(E,this.urlSerializer.parse(E),n,l);if(E[0]==="/")throw new Ub(A);return A}))}applyRedirectCreateUrlTree(n,i,l,h){let o=this.createSegmentGroup(n,i.root,l,h);return new Od(o,this.createQueryParams(i.queryParams,this.urlTree.queryParams),i.fragment)}createQueryParams(n,i){let l={};return Object.entries(n).forEach(([h,o])=>{if(typeof o=="string"&&o[0]===":"){let A=o.substring(1);l[h]=i[A]}else l[h]=o}),l}createSegmentGroup(n,i,l,h){let o=this.createSegments(n,i.segments,l,h),E={};return Object.entries(i.children).forEach(([A,L])=>{E[A]=this.createSegmentGroup(n,L,l,h)}),new Wr(o,E)}createSegments(n,i,l,h){return i.map(o=>o.path[0]===":"?this.findPosParam(n,o,h):this.findOrReturn(o,l))}findPosParam(n,i,l){let h=l[i.path.substring(1)];if(!h)throw new bn(4001,!1);return h}findOrReturn(n,i){let l=0;for(let h of i){if(h.path===n.path)return i.splice(l),h;l++}return n}};function Xee(t,n,i){if(typeof t=="string")return Jn(t);let l=t,{queryParams:h,fragment:o,routeConfig:E,url:A,outlet:L,params:Y,data:le,title:te}=n;return Hh(ta(i,()=>l({params:Y,data:le,queryParams:h,fragment:o,routeConfig:E,url:A,outlet:L,title:te})))}var SO={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function Yee(t,n,i,l,h){let o=f4(t,n,i);return o.matched?(l=vee(n,l),qee(l,n,i,h).pipe(di(E=>E===!0?o:Jt({},SO)))):Jn(o)}function f4(t,n,i){if(n.path==="**")return Kee(i);if(n.path==="")return n.pathMatch==="full"&&(t.hasChildren()||i.length>0)?Jt({},SO):{matched:!0,consumedSegments:[],remainingSegments:i,parameters:{},positionalParamSegments:{}};let h=(n.matcher||U5)(i,t,n);if(!h)return Jt({},SO);let o={};Object.entries(h.posParams??{}).forEach(([A,L])=>{o[A]=L.path});let E=h.consumed.length>0?Jt(Jt({},o),h.consumed[h.consumed.length-1].parameters):o;return{matched:!0,consumedSegments:h.consumed,remainingSegments:i.slice(h.consumed.length),parameters:E,positionalParamSegments:h.posParams??{}}}function Kee(t){return{matched:!0,parameters:t.length>0?$5(t).parameters:{},consumedSegments:t,remainingSegments:[],positionalParamSegments:{}}}function B5(t,n,i,l){return i.length>0&&ete(t,i,l)?{segmentGroup:new Wr(n,Qee(l,new Wr(i,t.children))),slicedSegments:[]}:i.length===0&&tte(t,i,l)?{segmentGroup:new Wr(t.segments,Jee(t,i,l,t.children)),slicedSegments:i}:{segmentGroup:new Wr(t.segments,t.children),slicedSegments:i}}function Jee(t,n,i,l){let h={};for(let o of i)if(iS(t,n,o)&&!l[Pu(o)]){let E=new Wr([],{});h[Pu(o)]=E}return Jt(Jt({},l),h)}function Qee(t,n){let i={};i[Ji]=n;for(let l of t)if(l.path===""&&Pu(l)!==Ji){let h=new Wr([],{});i[Pu(l)]=h}return i}function ete(t,n,i){return i.some(l=>iS(t,n,l)&&Pu(l)!==Ji)}function tte(t,n,i){return i.some(l=>iS(t,n,l))}function iS(t,n,i){return(t.hasChildren()||n.length>0)&&i.pathMatch==="full"?!1:i.path===""}function nte(t,n,i){return n.length===0&&!t.children[i]}var DO=class{};function ite(t,n,i,l,h,o,E="emptyOnly"){return new IO(t,n,i,l,h,E,o).recognize()}var rte=31,IO=class{injector;configLoader;rootComponentType;config;urlTree;paramsInheritanceStrategy;urlSerializer;applyRedirects;absoluteRedirectCount=0;allowRedirects=!0;constructor(n,i,l,h,o,E,A){this.injector=n,this.configLoader=i,this.rootComponentType=l,this.config=h,this.urlTree=o,this.paramsInheritanceStrategy=E,this.urlSerializer=A,this.applyRedirects=new TO(this.urlSerializer,this.urlTree)}noMatchError(n){return new bn(4002,`'${n.segmentGroup}'`)}recognize(){let n=B5(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(n).pipe(di(({children:i,rootSnapshot:l})=>{let h=new sc(l,i),o=new Bb("",h),E=Q5(l,[],this.urlTree.queryParams,this.urlTree.fragment);return E.queryParams=this.urlTree.queryParams,o.url=this.urlSerializer.serialize(E),{state:o,tree:E}}))}match(n){let i=new ag([],Object.freeze({}),Object.freeze(Jt({},this.urlTree.queryParams)),this.urlTree.fragment,Object.freeze({}),Ji,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,n,Ji,i).pipe(di(l=>({children:l,rootSnapshot:i})),dl(l=>{if(l instanceof Ub)return this.urlTree=l.urlTree,this.match(l.urlTree.root);throw l instanceof Vb?this.noMatchError(l):l}))}processSegmentGroup(n,i,l,h,o){return l.segments.length===0&&l.hasChildren()?this.processChildren(n,i,l,o):this.processSegment(n,i,l,l.segments,h,!0,o).pipe(di(E=>E instanceof sc?[E]:[]))}processChildren(n,i,l,h){let o=[];for(let E of Object.keys(l.children))E==="primary"?o.unshift(E):o.push(E);return Co(o).pipe(xd(E=>{let A=l.children[E],L=yee(i,E);return this.processSegmentGroup(n,L,A,E,h)}),$2((E,A)=>(E.push(...A),E)),ip(null),H2(),Eo(E=>{if(E===null)return z0(l);let A=p4(E);return ote(A),Jn(A)}))}processSegment(n,i,l,h,o,E,A){return Co(i).pipe(xd(L=>this.processSegmentAgainstRoute(L._injector??n,i,L,l,h,o,E,A).pipe(dl(Y=>{if(Y instanceof Vb)return Jn(null);throw Y}))),Ah(L=>!!L),dl(L=>{if(d4(L))return nte(l,h,o)?Jn(new DO):z0(l);throw L}))}processSegmentAgainstRoute(n,i,l,h,o,E,A,L){return Pu(l)!==E&&(E===Ji||!iS(h,o,l))?z0(h):l.redirectTo===void 0?this.matchSegmentAgainstRoute(n,h,l,o,E,L):this.allowRedirects&&A?this.expandSegmentAgainstRouteUsingRedirect(n,h,i,l,o,E,L):z0(h)}expandSegmentAgainstRouteUsingRedirect(n,i,l,h,o,E,A){let{matched:L,parameters:Y,consumedSegments:le,positionalParamSegments:te,remainingSegments:ze}=f4(i,h,o);if(!L)return z0(i);typeof h.redirectTo=="string"&&h.redirectTo[0]==="/"&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>rte&&(this.allowRedirects=!1));let Ae=new ag(o,Y,Object.freeze(Jt({},this.urlTree.queryParams)),this.urlTree.fragment,j5(h),Pu(h),h.component??h._loadedComponent??null,h,V5(h)),Be=QT(Ae,A,this.paramsInheritanceStrategy);return Ae.params=Object.freeze(Be.params),Ae.data=Object.freeze(Be.data),this.applyRedirects.applyRedirectCommands(le,h.redirectTo,te,Ae,n).pipe(us(ot=>this.applyRedirects.lineralizeSegments(h,ot)),Eo(ot=>this.processSegment(n,l,i,ot.concat(ze),E,!1,A)))}matchSegmentAgainstRoute(n,i,l,h,o,E){let A=Yee(i,l,h,n,this.urlSerializer);return l.path==="**"&&(i.children={}),A.pipe(us(L=>L.matched?(n=l._injector??n,this.getChildConfig(n,l,h).pipe(us(({routes:Y})=>{let le=l._loadedInjector??n,{parameters:te,consumedSegments:ze,remainingSegments:Ae}=L,Be=new ag(ze,te,Object.freeze(Jt({},this.urlTree.queryParams)),this.urlTree.fragment,j5(l),Pu(l),l.component??l._loadedComponent??null,l,V5(l)),Tt=QT(Be,E,this.paramsInheritanceStrategy);Be.params=Object.freeze(Tt.params),Be.data=Object.freeze(Tt.data);let{segmentGroup:ot,slicedSegments:kt}=B5(i,ze,Ae,Y);if(kt.length===0&&ot.hasChildren())return this.processChildren(le,Y,ot,Be).pipe(di(Xn=>new sc(Be,Xn)));if(Y.length===0&&kt.length===0)return Jn(new sc(Be,[]));let Cn=Pu(l)===o;return this.processSegment(le,Y,ot,kt,Cn?Ji:o,!0,Be).pipe(di(Xn=>new sc(Be,Xn instanceof sc?[Xn]:[])))}))):z0(i)))}getChildConfig(n,i,l){return i.children?Jn({routes:i.children,injector:n}):i.loadChildren?i._loadedRoutes!==void 0?Jn({routes:i._loadedRoutes,injector:i._loadedInjector}):Gee(n,i,l,this.urlSerializer).pipe(Eo(h=>h?this.configLoader.loadChildren(n,i).pipe(ea(o=>{i._loadedRoutes=o.routes,i._loadedInjector=o.injector})):Zee(i))):Jn({routes:[],injector:n})}};function ote(t){t.sort((n,i)=>n.value.outlet===Ji?-1:i.value.outlet===Ji?1:n.value.outlet.localeCompare(i.value.outlet))}function ste(t){let n=t.value.routeConfig;return n&&n.path===""}function p4(t){let n=[],i=new Set;for(let l of t){if(!ste(l)){n.push(l);continue}let h=n.find(o=>l.value.routeConfig===o.value.routeConfig);h!==void 0?(h.children.push(...l.children),i.add(h)):n.push(l)}for(let l of i){let h=p4(l.children);n.push(new sc(l.value,h))}return n.filter(l=>!i.has(l))}function j5(t){return t.data||{}}function V5(t){return t.resolve||{}}function ate(t,n,i,l,h,o){return Eo(E=>ite(t,n,i,l,E.extractedUrl,h,o).pipe(di(({state:A,tree:L})=>Mi(Jt({},E),{targetSnapshot:A,urlAfterRedirects:L}))))}function lte(t,n){return Eo(i=>{let{targetSnapshot:l,guards:{canActivateChecks:h}}=i;if(!h.length)return Jn(i);let o=new Set(h.map(L=>L.route)),E=new Set;for(let L of o)if(!E.has(L))for(let Y of m4(L))E.add(Y);let A=0;return Co(E).pipe(xd(L=>o.has(L)?cte(L,l,t,n):(L.data=QT(L,L.parent,t).resolve,Jn(void 0))),ea(()=>A++),rp(1),Eo(L=>A===E.size?Jn(i):ja))})}function m4(t){let n=t.children.map(i=>m4(i)).flat();return[t,...n]}function cte(t,n,i,l){let h=t.routeConfig,o=t._resolve;return h?.title!==void 0&&!s4(h)&&(o[Hb]=h.title),Cx(()=>(t.data=QT(t,t.parent,i).resolve,ute(o,t,n,l).pipe(di(E=>(t._resolvedData=E,t.data=Jt(Jt({},t.data),E),null)))))}function ute(t,n,i,l){let h=gO(t);if(h.length===0)return Jn({});let o={};return Co(h).pipe(Eo(E=>dte(t[E],n,i,l).pipe(Ah(),ea(A=>{if(A instanceof W0)throw eS(new Ep,A);o[E]=A}))),rp(1),di(()=>o),dl(E=>d4(E)?ja:vd(E)))}function dte(t,n,i,l){let h=X0(n)??l,o=Y0(t,h),E=o.resolve?o.resolve(n,i):ta(h,()=>o(n,i));return Hh(E)}function pO(t){return us(n=>{let i=t(n);return i?Co(i).pipe(di(()=>n)):Jn(n)})}var RO=(()=>{class t{buildTitle(i){let l,h=i.root;for(;h!==void 0;)l=this.getResolvedTitleForRoute(h)??l,h=h.children.find(o=>o.outlet===Ji);return l}getResolvedTitleForRoute(i){return i.data[Hb]}static \u0275fac=function(l){return new(l||t)};static \u0275prov=Qt({token:t,factory:()=>ft(g4),providedIn:"root"})}return t})(),g4=(()=>{class t extends RO{title;constructor(i){super(),this.title=i}updateTitle(i){let l=this.buildTitle(i);l!==void 0&&this.title.setTitle(l)}static \u0275fac=function(l){return new(l||t)(gn(k5))};static \u0275prov=Qt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),Dp=new Sn("",{providedIn:"root",factory:()=>({})}),dg=new Sn(""),rS=(()=>{class t{componentLoaders=new WeakMap;childrenLoaders=new WeakMap;onLoadStartListener;onLoadEndListener;compiler=ft(PP);loadComponent(i,l){if(this.componentLoaders.get(l))return this.componentLoaders.get(l);if(l._loadedComponent)return Jn(l._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(l);let h=Hh(ta(i,()=>l.loadComponent())).pipe(di(v4),us(y4),ea(E=>{this.onLoadEndListener&&this.onLoadEndListener(l),l._loadedComponent=E}),Si(()=>{this.componentLoaders.delete(l)})),o=new o0(h,()=>new Fn).pipe(r0());return this.componentLoaders.set(l,o),o}loadChildren(i,l){if(this.childrenLoaders.get(l))return this.childrenLoaders.get(l);if(l._loadedRoutes)return Jn({routes:l._loadedRoutes,injector:l._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(l);let o=_4(l,this.compiler,i,this.onLoadEndListener).pipe(Si(()=>{this.childrenLoaders.delete(l)})),E=new o0(o,()=>new Fn).pipe(r0());return this.childrenLoaders.set(l,E),E}static \u0275fac=function(l){return new(l||t)};static \u0275prov=Qt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function _4(t,n,i,l){return Hh(ta(i,()=>t.loadChildren())).pipe(di(v4),us(y4),Eo(h=>h instanceof cT||Array.isArray(h)?Jn(h):Co(n.compileModuleAsync(h))),di(h=>{l&&l(t);let o,E,A=!1;return Array.isArray(h)?(E=h,A=!0):(o=h.create(i).injector,E=o.get(dg,[],{optional:!0,self:!0}).flat()),{routes:E.map(OO),injector:o}}))}function hte(t){return t&&typeof t=="object"&&"default"in t}function v4(t){return hte(t)?t.default:t}function y4(t){return Jn(t)}var oS=(()=>{class t{static \u0275fac=function(l){return new(l||t)};static \u0275prov=Qt({token:t,factory:()=>ft(fte),providedIn:"root"})}return t})(),fte=(()=>{class t{shouldProcessUrl(i){return!0}extract(i){return i}merge(i,l){return i}static \u0275fac=function(l){return new(l||t)};static \u0275prov=Qt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),kO=new Sn(""),FO=new Sn("");function x4(t,n,i){let l=t.get(FO),h=t.get(_o);if(!h.startViewTransition||l.skipNextTransition)return l.skipNextTransition=!1,new Promise(Y=>setTimeout(Y));let o,E=new Promise(Y=>{o=Y}),A=h.startViewTransition(()=>(o(),pte(t)));A.ready.catch(Y=>{});let{onViewTransitionCreated:L}=l;return L&&ta(t,()=>L({transition:A,from:n,to:i})),E}function pte(t){return new Promise(n=>{ab({read:()=>setTimeout(n)},{injector:t})})}var LO=new Sn(""),sS=(()=>{class t{currentNavigation=tc(null,{equal:()=>!1});currentTransition=null;lastSuccessfulNavigation=null;events=new Fn;transitionAbortWithErrorSubject=new Fn;configLoader=ft(rS);environmentInjector=ft(ds);destroyRef=ft(bu);urlSerializer=ft(cg);rootContexts=ft(ug);location=ft(Fl);inputBindingEnabled=ft(Gb,{optional:!0})!==null;titleStrategy=ft(RO);options=ft(Dp,{optional:!0})||{};paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly";urlHandlingStrategy=ft(oS);createViewTransition=ft(kO,{optional:!0});navigationErrorHandler=ft(LO,{optional:!0});navigationId=0;get hasRequestedNavigation(){return this.navigationId!==0}transitions;afterPreactivation=()=>Jn(void 0);rootComponentType=null;destroyed=!1;constructor(){let i=h=>this.events.next(new GT(h)),l=h=>this.events.next(new qT(h));this.configLoader.onLoadEndListener=l,this.configLoader.onLoadStartListener=i,this.destroyRef.onDestroy(()=>{this.destroyed=!0})}complete(){this.transitions?.complete()}handleNavigationRequest(i){let l=++this.navigationId;oa(()=>{this.transitions?.next(Mi(Jt({},i),{extractedUrl:this.urlHandlingStrategy.extract(i.rawUrl),targetSnapshot:null,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null,abortController:new AbortController,id:l}))})}setupNavigations(i){return this.transitions=new Ho(null),this.transitions.pipe(To(l=>l!==null),us(l=>{let h=!1;return Jn(l).pipe(us(o=>{if(this.navigationId>l.id)return this.cancelNavigationTransition(l,"",ml.SupersededByNewNavigation),ja;this.currentTransition=l,this.currentNavigation.set({id:o.id,initialUrl:o.rawUrl,extractedUrl:o.extractedUrl,targetBrowserUrl:typeof o.extras.browserUrl=="string"?this.urlSerializer.parse(o.extras.browserUrl):o.extras.browserUrl,trigger:o.source,extras:o.extras,previousNavigation:this.lastSuccessfulNavigation?Mi(Jt({},this.lastSuccessfulNavigation),{previousNavigation:null}):null,abort:()=>o.abortController.abort()});let E=!i.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),A=o.extras.onSameUrlNavigation??i.onSameUrlNavigation;if(!E&&A!=="reload")return this.events.next(new Rd(o.id,this.urlSerializer.serialize(o.rawUrl),"",H0.IgnoredSameUrlNavigation)),o.resolve(!1),ja;if(this.urlHandlingStrategy.shouldProcessUrl(o.rawUrl))return Jn(o).pipe(us(L=>(this.events.next(new Sp(L.id,this.urlSerializer.serialize(L.extractedUrl),L.source,L.restoredState)),L.id!==this.navigationId?ja:Promise.resolve(L))),ate(this.environmentInjector,this.configLoader,this.rootComponentType,i.config,this.urlSerializer,this.paramsInheritanceStrategy),ea(L=>{l.targetSnapshot=L.targetSnapshot,l.urlAfterRedirects=L.urlAfterRedirects,this.currentNavigation.update(le=>(le.finalUrl=L.urlAfterRedirects,le));let Y=new Lb(L.id,this.urlSerializer.serialize(L.extractedUrl),this.urlSerializer.serialize(L.urlAfterRedirects),L.targetSnapshot);this.events.next(Y)}));if(E&&this.urlHandlingStrategy.shouldProcessUrl(o.currentRawUrl)){let{id:L,extractedUrl:Y,source:le,restoredState:te,extras:ze}=o,Ae=new Sp(L,this.urlSerializer.serialize(Y),le,te);this.events.next(Ae);let Be=r4(this.rootComponentType).snapshot;return this.currentTransition=l=Mi(Jt({},o),{targetSnapshot:Be,urlAfterRedirects:Y,extras:Mi(Jt({},ze),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.update(Tt=>(Tt.finalUrl=Y,Tt)),Jn(l)}else return this.events.next(new Rd(o.id,this.urlSerializer.serialize(o.extractedUrl),"",H0.IgnoredByUrlHandlingStrategy)),o.resolve(!1),ja}),ea(o=>{let E=new VT(o.id,this.urlSerializer.serialize(o.extractedUrl),this.urlSerializer.serialize(o.urlAfterRedirects),o.targetSnapshot);this.events.next(E)}),di(o=>(this.currentTransition=l=Mi(Jt({},o),{guards:See(o.targetSnapshot,o.currentSnapshot,this.rootContexts)}),l)),Nee(this.environmentInjector,o=>this.events.next(o)),ea(o=>{if(l.guardsResult=o.guardsResult,o.guardsResult&&typeof o.guardsResult!="boolean")throw eS(this.urlSerializer,o.guardsResult);let E=new UT(o.id,this.urlSerializer.serialize(o.extractedUrl),this.urlSerializer.serialize(o.urlAfterRedirects),o.targetSnapshot,!!o.guardsResult);this.events.next(E)}),To(o=>o.guardsResult?!0:(this.cancelNavigationTransition(o,"",ml.GuardRejected),!1)),pO(o=>{if(o.guards.canActivateChecks.length!==0)return Jn(o).pipe(ea(E=>{let A=new HT(E.id,this.urlSerializer.serialize(E.extractedUrl),this.urlSerializer.serialize(E.urlAfterRedirects),E.targetSnapshot);this.events.next(A)}),us(E=>{let A=!1;return Jn(E).pipe(lte(this.paramsInheritanceStrategy,this.environmentInjector),ea({next:()=>A=!0,complete:()=>{A||this.cancelNavigationTransition(E,"",ml.NoDataFromResolver)}}))}),ea(E=>{let A=new $T(E.id,this.urlSerializer.serialize(E.extractedUrl),this.urlSerializer.serialize(E.urlAfterRedirects),E.targetSnapshot);this.events.next(A)}))}),pO(o=>{let E=A=>{let L=[];if(A.routeConfig?.loadComponent){let Y=X0(A)??this.environmentInjector;L.push(this.configLoader.loadComponent(Y,A.routeConfig).pipe(ea(le=>{A.component=le}),di(()=>{})))}for(let Y of A.children)L.push(...E(Y));return L};return Rm(E(o.targetSnapshot.root)).pipe(ip(null),Al(1))}),pO(()=>this.afterPreactivation()),us(()=>{let{currentSnapshot:o,targetSnapshot:E}=l,A=this.createViewTransition?.(this.environmentInjector,o.root,E.root);return A?Co(A).pipe(di(()=>l)):Jn(l)}),di(o=>{let E=bee(i.routeReuseStrategy,o.targetSnapshot,o.currentRouterState);return this.currentTransition=l=Mi(Jt({},o),{targetRouterState:E}),this.currentNavigation.update(A=>(A.targetRouterState=E,A)),l}),ea(()=>{this.events.next(new Nb)}),Tee(this.rootContexts,i.routeReuseStrategy,o=>this.events.next(o),this.inputBindingEnabled),Al(1),tn(new xi(o=>{let E=l.abortController.signal,A=()=>o.next();return E.addEventListener("abort",A),()=>E.removeEventListener("abort",A)}).pipe(To(()=>!h&&!l.targetRouterState),ea(()=>{this.cancelNavigationTransition(l,l.abortController.signal.reason+"",ml.Aborted)}))),ea({next:o=>{h=!0,this.lastSuccessfulNavigation=oa(this.currentNavigation),this.events.next(new Fc(o.id,this.urlSerializer.serialize(o.extractedUrl),this.urlSerializer.serialize(o.urlAfterRedirects))),this.titleStrategy?.updateTitle(o.targetRouterState.snapshot),o.resolve(!0)},complete:()=>{h=!0}}),tn(this.transitionAbortWithErrorSubject.pipe(ea(o=>{throw o}))),Si(()=>{h||this.cancelNavigationTransition(l,"",ml.SupersededByNewNavigation),this.currentTransition?.id===l.id&&(this.currentNavigation.set(null),this.currentTransition=null)}),dl(o=>{if(this.destroyed)return l.resolve(!1),ja;if(h=!0,u4(o))this.events.next(new Pd(l.id,this.urlSerializer.serialize(l.extractedUrl),o.message,o.cancellationCode)),Eee(o)?this.events.next(new q0(o.url,o.navigationBehaviorOptions)):l.resolve(!1);else{let E=new $0(l.id,this.urlSerializer.serialize(l.extractedUrl),o,l.targetSnapshot??void 0);try{let A=ta(this.environmentInjector,()=>this.navigationErrorHandler?.(E));if(A instanceof W0){let{message:L,cancellationCode:Y}=eS(this.urlSerializer,A);this.events.next(new Pd(l.id,this.urlSerializer.serialize(l.extractedUrl),L,Y)),this.events.next(new q0(A.redirectTo,A.navigationBehaviorOptions))}else throw this.events.next(E),o}catch(A){this.options.resolveNavigationPromiseOnError?l.resolve(!1):l.reject(A)}}return ja}))}))}cancelNavigationTransition(i,l,h){let o=new Pd(i.id,this.urlSerializer.serialize(i.extractedUrl),l,h);this.events.next(o),i.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){let i=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),l=oa(this.currentNavigation),h=l?.targetBrowserUrl??l?.extractedUrl;return i.toString()!==h?.toString()&&!l?.extras.skipLocationChange}static \u0275fac=function(l){return new(l||t)};static \u0275prov=Qt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function mte(t){return t!==V0}var b4=(()=>{class t{static \u0275fac=function(l){return new(l||t)};static \u0275prov=Qt({token:t,factory:()=>ft(gte),providedIn:"root"})}return t})(),nS=class{shouldDetach(n){return!1}store(n,i){}shouldAttach(n){return!1}retrieve(n){return null}shouldReuseRoute(n,i){return n.routeConfig===i.routeConfig}},gte=(()=>{class t extends nS{static \u0275fac=(()=>{let i;return function(h){return(i||(i=Ca(t)))(h||t)}})();static \u0275prov=Qt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),w4=(()=>{class t{urlSerializer=ft(cg);options=ft(Dp,{optional:!0})||{};canceledNavigationResolution=this.options.canceledNavigationResolution||"replace";location=ft(Fl);urlHandlingStrategy=ft(oS);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";currentUrlTree=new Od;getCurrentUrlTree(){return this.currentUrlTree}rawUrlTree=this.currentUrlTree;getRawUrlTree(){return this.rawUrlTree}createBrowserPath({finalUrl:i,initialUrl:l,targetBrowserUrl:h}){let o=i!==void 0?this.urlHandlingStrategy.merge(i,l):l,E=h??o;return E instanceof Od?this.urlSerializer.serialize(E):E}commitTransition({targetRouterState:i,finalUrl:l,initialUrl:h}){l&&i?(this.currentUrlTree=l,this.rawUrlTree=this.urlHandlingStrategy.merge(l,h),this.routerState=i):this.rawUrlTree=h}routerState=r4(null);getRouterState(){return this.routerState}stateMemento=this.createStateMemento();updateStateMemento(){this.stateMemento=this.createStateMemento()}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}resetInternalState({finalUrl:i}){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,i??this.rawUrlTree)}static \u0275fac=function(l){return new(l||t)};static \u0275prov=Qt({token:t,factory:()=>ft(_te),providedIn:"root"})}return t})(),_te=(()=>{class t extends w4{currentPageId=0;lastSuccessfulId=-1;restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}registerNonRouterCurrentEntryChangeListener(i){return this.location.subscribe(l=>{l.type==="popstate"&&setTimeout(()=>{i(l.url,l.state,"popstate")})})}handleRouterEvent(i,l){i instanceof Sp?this.updateStateMemento():i instanceof Rd?this.commitTransition(l):i instanceof Lb?this.urlUpdateStrategy==="eager"&&(l.extras.skipLocationChange||this.setBrowserUrl(this.createBrowserPath(l),l)):i instanceof Nb?(this.commitTransition(l),this.urlUpdateStrategy==="deferred"&&!l.extras.skipLocationChange&&this.setBrowserUrl(this.createBrowserPath(l),l)):i instanceof Pd&&i.code!==ml.SupersededByNewNavigation&&i.code!==ml.Redirect?this.restoreHistory(l):i instanceof $0?this.restoreHistory(l,!0):i instanceof Fc&&(this.lastSuccessfulId=i.id,this.currentPageId=this.browserPageId)}setBrowserUrl(i,{extras:l,id:h}){let{replaceUrl:o,state:E}=l;if(this.location.isCurrentPathEqualTo(i)||o){let A=this.browserPageId,L=Jt(Jt({},E),this.generateNgRouterState(h,A));this.location.replaceState(i,"",L)}else{let A=Jt(Jt({},E),this.generateNgRouterState(h,this.browserPageId+1));this.location.go(i,"",A)}}restoreHistory(i,l=!1){if(this.canceledNavigationResolution==="computed"){let h=this.browserPageId,o=this.currentPageId-h;o!==0?this.location.historyGo(o):this.getCurrentUrlTree()===i.finalUrl&&o===0&&(this.resetInternalState(i),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(l&&this.resetInternalState(i),this.resetUrlToCurrentUrlTree())}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.getRawUrlTree()),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(i,l){return this.canceledNavigationResolution==="computed"?{navigationId:i,\u0275routerPageId:l}:{navigationId:i}}static \u0275fac=(()=>{let i;return function(h){return(i||(i=Ca(t)))(h||t)}})();static \u0275prov=Qt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function aS(t,n){t.events.pipe(To(i=>i instanceof Fc||i instanceof Pd||i instanceof $0||i instanceof Rd),di(i=>i instanceof Fc||i instanceof Rd?0:(i instanceof Pd?i.code===ml.Redirect||i.code===ml.SupersededByNewNavigation:!1)?2:1),To(i=>i!==2),Al(1)).subscribe(()=>{n()})}var vte={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},yte={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},br=(()=>{class t{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}disposed=!1;nonRouterCurrentEntryChangeSubscription;console=ft(_P);stateManager=ft(w4);options=ft(Dp,{optional:!0})||{};pendingTasks=ft(Dd);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";navigationTransitions=ft(sS);urlSerializer=ft(cg);location=ft(Fl);urlHandlingStrategy=ft(oS);injector=ft(ds);_events=new Fn;get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}navigated=!1;routeReuseStrategy=ft(b4);onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore";config=ft(dg,{optional:!0})?.flat()??[];componentInputBindingEnabled=!!ft(Gb,{optional:!0});currentNavigation=this.navigationTransitions.currentNavigation.asReadonly();constructor(){this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this).subscribe({error:i=>{this.console.warn(i)}}),this.subscribeToNavigationEvents()}eventsSubscription=new Jo;subscribeToNavigationEvents(){let i=this.navigationTransitions.events.subscribe(l=>{try{let h=this.navigationTransitions.currentTransition,o=oa(this.navigationTransitions.currentNavigation);if(h!==null&&o!==null){if(this.stateManager.handleRouterEvent(l,o),l instanceof Pd&&l.code!==ml.Redirect&&l.code!==ml.SupersededByNewNavigation)this.navigated=!0;else if(l instanceof Fc)this.navigated=!0;else if(l instanceof q0){let E=l.navigationBehaviorOptions,A=this.urlHandlingStrategy.merge(l.url,h.currentRawUrl),L=Jt({browserUrl:h.extras.browserUrl,info:h.extras.info,skipLocationChange:h.extras.skipLocationChange,replaceUrl:h.extras.replaceUrl||this.urlUpdateStrategy==="eager"||mte(h.source)},E);this.scheduleNavigation(A,V0,null,L,{resolve:h.resolve,reject:h.reject,promise:h.promise})}}_ee(l)&&this._events.next(l)}catch(h){this.navigationTransitions.transitionAbortWithErrorSubject.next(h)}});this.eventsSubscription.add(i)}resetRootComponentType(i){this.routerState.root.component=i,this.navigationTransitions.rootComponentType=i}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),V0,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((i,l,h)=>{this.navigateToSyncWithBrowser(i,h,l)})}navigateToSyncWithBrowser(i,l,h){let o={replaceUrl:!0},E=h?.navigationId?h:null;if(h){let L=Jt({},h);delete L.navigationId,delete L.\u0275routerPageId,Object.keys(L).length!==0&&(o.state=L)}let A=this.parseUrl(i);this.scheduleNavigation(A,l,E,o).catch(L=>{this.disposed||this.injector.get(pl)(L)})}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return oa(this.navigationTransitions.currentNavigation)}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(i){this.config=i.map(OO),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this._events.unsubscribe(),this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(i,l={}){let{relativeTo:h,queryParams:o,fragment:E,queryParamsHandling:A,preserveFragment:L}=l,Y=L?this.currentUrlTree.fragment:E,le=null;switch(A??this.options.defaultQueryParamsHandling){case"merge":le=Jt(Jt({},this.currentUrlTree.queryParams),o);break;case"preserve":le=this.currentUrlTree.queryParams;break;default:le=o||null}le!==null&&(le=this.removeEmptyProps(le));let te;try{let ze=h?h.snapshot:this.routerState.snapshot.root;te=e4(ze)}catch{(typeof i[0]!="string"||i[0][0]!=="/")&&(i=[]),te=this.currentUrlTree.root}return t4(te,i,le,Y??null)}navigateByUrl(i,l={skipLocationChange:!1}){let h=Tp(i)?i:this.parseUrl(i),o=this.urlHandlingStrategy.merge(h,this.rawUrlTree);return this.scheduleNavigation(o,V0,null,l)}navigate(i,l={skipLocationChange:!1}){return xte(i),this.navigateByUrl(this.createUrlTree(i,l),l)}serializeUrl(i){return this.urlSerializer.serialize(i)}parseUrl(i){try{return this.urlSerializer.parse(i)}catch{return this.urlSerializer.parse("/")}}isActive(i,l){let h;if(l===!0?h=Jt({},vte):l===!1?h=Jt({},yte):h=l,Tp(i))return F5(this.currentUrlTree,i,h);let o=this.parseUrl(i);return F5(this.currentUrlTree,o,h)}removeEmptyProps(i){return Object.entries(i).reduce((l,[h,o])=>(o!=null&&(l[h]=o),l),{})}scheduleNavigation(i,l,h,o,E){if(this.disposed)return Promise.resolve(!1);let A,L,Y;E?(A=E.resolve,L=E.reject,Y=E.promise):Y=new Promise((te,ze)=>{A=te,L=ze});let le=this.pendingTasks.add();return aS(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(le))}),this.navigationTransitions.handleNavigationRequest({source:l,restoredState:h,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:i,extras:o,resolve:A,reject:L,promise:Y,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),Y.catch(te=>Promise.reject(te))}static \u0275fac=function(l){return new(l||t)};static \u0275prov=Qt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function xte(t){for(let n=0;n<t.length;n++)if(t[n]==null)throw new bn(4008,!1)}var ns=(()=>{class t{router;route;tabIndexAttribute;renderer;el;locationStrategy;reactiveHref=tc(null);get href(){return oa(this.reactiveHref)}set href(i){this.reactiveHref.set(i)}target;queryParams;fragment;queryParamsHandling;state;info;relativeTo;isAnchorElement;subscription;onChanges=new Fn;applicationErrorHandler=ft(pl);options=ft(Dp,{optional:!0});constructor(i,l,h,o,E,A){this.router=i,this.route=l,this.tabIndexAttribute=h,this.renderer=o,this.el=E,this.locationStrategy=A,this.reactiveHref.set(ft(new gT("href"),{optional:!0}));let L=E.nativeElement.tagName?.toLowerCase();this.isAnchorElement=L==="a"||L==="area"||!!(typeof customElements=="object"&&customElements.get(L)?.observedAttributes?.includes?.("href")),this.isAnchorElement?this.setTabIndexIfNotOnNativeEl("0"):this.subscribeToNavigationEventsIfNecessary()}subscribeToNavigationEventsIfNecessary(){if(this.subscription!==void 0||!this.isAnchorElement)return;let i=this.preserveFragment,l=h=>h==="merge"||h==="preserve";i||=l(this.queryParamsHandling),i||=!this.queryParamsHandling&&!l(this.options?.defaultQueryParamsHandling),i&&(this.subscription=this.router.events.subscribe(h=>{h instanceof Fc&&this.updateHref()}))}preserveFragment=!1;skipLocationChange=!1;replaceUrl=!1;setTabIndexIfNotOnNativeEl(i){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",i)}ngOnChanges(i){this.isAnchorElement&&(this.updateHref(),this.subscribeToNavigationEventsIfNecessary()),this.onChanges.next(this)}routerLinkInput=null;set routerLink(i){i==null?(this.routerLinkInput=null,this.setTabIndexIfNotOnNativeEl(null)):(Tp(i)?this.routerLinkInput=i:this.routerLinkInput=Array.isArray(i)?i:[i],this.setTabIndexIfNotOnNativeEl("0"))}onClick(i,l,h,o,E){let A=this.urlTree;if(A===null||this.isAnchorElement&&(i!==0||l||h||o||E||typeof this.target=="string"&&this.target!="_self"))return!0;let L={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(A,L)?.catch(Y=>{this.applicationErrorHandler(Y)}),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let i=this.urlTree;this.reactiveHref.set(i!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(i))??"":null)}applyAttributeValue(i,l){let h=this.renderer,o=this.el.nativeElement;l!==null?h.setAttribute(o,i,l):h.removeAttribute(o,i)}get urlTree(){return this.routerLinkInput===null?null:Tp(this.routerLinkInput)?this.routerLinkInput:this.router.createUrlTree(this.routerLinkInput,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static \u0275fac=function(l){return new(l||t)(wt(br),wt(la),tb("tabindex"),wt(ia),wt(Fo),wt(Mu))};static \u0275dir=Ki({type:t,selectors:[["","routerLink",""]],hostVars:2,hostBindings:function(l,h){l&1&&Ot("click",function(E){return h.onClick(E.button,E.ctrlKey,E.shiftKey,E.altKey,E.metaKey)}),l&2&&Lo("href",h.reactiveHref(),YA)("target",h.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[2,"preserveFragment","preserveFragment",_p],skipLocationChange:[2,"skipLocationChange","skipLocationChange",_p],replaceUrl:[2,"replaceUrl","replaceUrl",_p],routerLink:"routerLink"},features:[wa]})}return t})();var Wb=class{};var C4=(()=>{class t{router;injector;preloadingStrategy;loader;subscription;constructor(i,l,h,o){this.router=i,this.injector=l,this.preloadingStrategy=h,this.loader=o}setUpPreloading(){this.subscription=this.router.events.pipe(To(i=>i instanceof Fc),xd(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(i,l){let h=[];for(let o of l){o.providers&&!o._injector&&(o._injector=P0(o.providers,i,`Route: ${o.path}`));let E=o._injector??i,A=o._loadedInjector??E;(o.loadChildren&&!o._loadedRoutes&&o.canLoad===void 0||o.loadComponent&&!o._loadedComponent)&&h.push(this.preloadConfig(E,o)),(o.children||o._loadedRoutes)&&h.push(this.processRoutes(A,o.children??o._loadedRoutes))}return Co(h).pipe(np())}preloadConfig(i,l){return this.preloadingStrategy.preload(l,()=>{let h;l.loadChildren&&l.canLoad===void 0?h=this.loader.loadChildren(i,l):h=Jn(null);let o=h.pipe(Eo(E=>E===null?Jn(void 0):(l._loadedRoutes=E.routes,l._loadedInjector=E.injector,this.processRoutes(E.injector??i,E.routes))));if(l.loadComponent&&!l._loadedComponent){let E=this.loader.loadComponent(i,l);return Co([o,E]).pipe(np())}else return o})}static \u0275fac=function(l){return new(l||t)(gn(br),gn(ds),gn(Wb),gn(rS))};static \u0275prov=Qt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),E4=new Sn(""),bte=(()=>{class t{urlSerializer;transitions;viewportScroller;zone;options;routerEventsSubscription;scrollEventsSubscription;lastId=0;lastSource=V0;restoredId=0;store={};constructor(i,l,h,o,E={}){this.urlSerializer=i,this.transitions=l,this.viewportScroller=h,this.zone=o,this.options=E,E.scrollPositionRestoration||="disabled",E.anchorScrolling||="disabled"}init(){this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(i=>{i instanceof Sp?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=i.navigationTrigger,this.restoredId=i.restoredState?i.restoredState.navigationId:0):i instanceof Fc?(this.lastId=i.id,this.scheduleScrollEvent(i,this.urlSerializer.parse(i.urlAfterRedirects).fragment)):i instanceof Rd&&i.code===H0.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(i,this.urlSerializer.parse(i.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(i=>{if(!(i instanceof G0))return;let l={behavior:"instant"};i.position?this.options.scrollPositionRestoration==="top"?this.viewportScroller.scrollToPosition([0,0],l):this.options.scrollPositionRestoration==="enabled"&&this.viewportScroller.scrollToPosition(i.position,l):i.anchor&&this.options.anchorScrolling==="enabled"?this.viewportScroller.scrollToAnchor(i.anchor):this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.scrollToPosition([0,0])})}scheduleScrollEvent(i,l){this.zone.runOutsideAngular(()=>Tc(this,null,function*(){yield new Promise(h=>{setTimeout(h),typeof requestAnimationFrame<"u"&&requestAnimationFrame(h)}),this.zone.run(()=>{this.transitions.events.next(new G0(i,this.lastSource==="popstate"?this.store[this.restoredId]:null,l))})}))}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static \u0275fac=function(l){dP()};static \u0275prov=Qt({token:t,factory:t.\u0275fac})}return t})();function zO(t,...n){return bd([{provide:dg,multi:!0,useValue:t},[],{provide:la,useFactory:T4,deps:[br]},{provide:lb,multi:!0,useFactory:S4},n.map(i=>i.\u0275providers)])}function T4(t){return t.routerState.root}function Zb(t,n){return{\u0275kind:t,\u0275providers:n}}function S4(){let t=ft(ba);return n=>{let i=t.get(jh);if(n!==i.components[0])return;let l=t.get(br),h=t.get(D4);t.get(BO)===1&&l.initialNavigation(),t.get(A4,null,{optional:!0})?.setUpPreloading(),t.get(E4,null,{optional:!0})?.init(),l.resetRootComponentType(i.componentTypes[0]),h.closed||(h.next(),h.complete(),h.unsubscribe())}}var D4=new Sn("",{factory:()=>new Fn}),BO=new Sn("",{providedIn:"root",factory:()=>1});function I4(){let t=[{provide:WA,useValue:!0},{provide:BO,useValue:0},dT(()=>{let n=ft(ba);return n.get(VP,Promise.resolve()).then(()=>new Promise(l=>{let h=n.get(br),o=n.get(D4);aS(h,()=>{l(!0)}),n.get(sS).afterPreactivation=()=>(l(!0),o.closed?Jn(void 0):o),h.initialNavigation()}))})];return Zb(2,t)}function M4(){let t=[dT(()=>{ft(br).setUpLocationChangeListener()}),{provide:BO,useValue:2}];return Zb(3,t)}var A4=new Sn("");function P4(t){return Zb(0,[{provide:A4,useExisting:C4},{provide:Wb,useExisting:t}])}function O4(){return Zb(8,[AO,{provide:Gb,useExisting:AO}])}function R4(t){ic("NgRouterViewTransitions");let n=[{provide:kO,useValue:x4},{provide:FO,useValue:Jt({skipNextTransition:!!t?.skipInitialTransition},t)}];return Zb(9,n)}var k4=[Fl,{provide:cg,useClass:Ep},br,ug,{provide:la,useFactory:T4,deps:[br]},rS,[]],jO=(()=>{class t{constructor(){}static forRoot(i,l){return{ngModule:t,providers:[k4,[],{provide:dg,multi:!0,useValue:i},[],l?.errorHandler?{provide:LO,useValue:l.errorHandler}:[],{provide:Dp,useValue:l||{}},l?.useHash?Cte():Ete(),wte(),l?.preloadingStrategy?P4(l.preloadingStrategy).\u0275providers:[],l?.initialNavigation?Tte(l):[],l?.bindToComponentInputs?O4().\u0275providers:[],l?.enableViewTransitions?R4().\u0275providers:[],Ste()]}}static forChild(i){return{ngModule:t,providers:[{provide:dg,multi:!0,useValue:i}]}}static \u0275fac=function(l){return new(l||t)};static \u0275mod=Qo({type:t});static \u0275inj=$o({})}return t})();function wte(){return{provide:E4,useFactory:()=>{let t=ft(f5),n=ft(so),i=ft(Dp),l=ft(sS),h=ft(cg);return i.scrollOffset&&t.setOffset(i.scrollOffset),new bte(h,l,t,n,i)}}}function Cte(){return{provide:Mu,useClass:qP}}function Ete(){return{provide:Mu,useClass:yT}}function Tte(t){return[t.initialNavigation==="disabled"?M4().\u0275providers:[],t.initialNavigation==="enabledBlocking"?I4().\u0275providers:[]]}var NO=new Sn("");function Ste(){return[{provide:NO,useFactory:S4},{provide:lb,multi:!0,useExisting:NO}]}var VO=class{getAllStyles(n){return window.getComputedStyle(n)}getStyle(n,i){return this.getAllStyles(n)[i]}isStaticPositioned(n){return(this.getStyle(n,"position")||"static")==="static"}offsetParent(n){let i=n.offsetParent||document.documentElement;for(;i&&i!==document.documentElement&&this.isStaticPositioned(i);)i=i.offsetParent;return i||document.documentElement}position(n,i=!0){let l,h={width:0,height:0,top:0,bottom:0,left:0,right:0};if(this.getStyle(n,"position")==="fixed")l=n.getBoundingClientRect(),l={top:l.top,bottom:l.bottom,left:l.left,right:l.right,height:l.height,width:l.width};else{let o=this.offsetParent(n);l=this.offset(n,!1),o!==document.documentElement&&(h=this.offset(o,!1)),h.top+=o.clientTop,h.left+=o.clientLeft}return l.top-=h.top,l.bottom-=h.top,l.left-=h.left,l.right-=h.left,i&&(l.top=Math.round(l.top),l.bottom=Math.round(l.bottom),l.left=Math.round(l.left),l.right=Math.round(l.right)),l}offset(n,i=!0){let l=n.getBoundingClientRect(),h={top:window.pageYOffset-document.documentElement.clientTop,left:window.pageXOffset-document.documentElement.clientLeft},o={height:l.height||n.offsetHeight,width:l.width||n.offsetWidth,top:l.top+h.top,bottom:l.bottom+h.top,left:l.left+h.left,right:l.right+h.left};return i&&(o.height=Math.round(o.height),o.width=Math.round(o.width),o.top=Math.round(o.top),o.bottom=Math.round(o.bottom),o.left=Math.round(o.left),o.right=Math.round(o.right)),o}positionElements(n,i,l,h){let[o="top",E="center"]=l.split("-"),A=h?this.offset(n,!1):this.position(n,!1),L=this.getAllStyles(i),Y=parseFloat(L.marginTop),le=parseFloat(L.marginBottom),te=parseFloat(L.marginLeft),ze=parseFloat(L.marginRight),Ae=0,Be=0;switch(o){case"top":Ae=A.top-(i.offsetHeight+Y+le);break;case"bottom":Ae=A.top+A.height;break;case"left":Be=A.left-(i.offsetWidth+te+ze);break;case"right":Be=A.left+A.width;break}switch(E){case"top":Ae=A.top;break;case"bottom":Ae=A.top+A.height-i.offsetHeight;break;case"left":Be=A.left;break;case"right":Be=A.left+A.width-i.offsetWidth;break;case"center":o==="top"||o==="bottom"?Be=A.left+A.width/2-i.offsetWidth/2:Ae=A.top+A.height/2-i.offsetHeight/2;break}i.style.transform=`translate(${Math.round(Be)}px, ${Math.round(Ae)}px)`;let Tt=i.getBoundingClientRect(),ot=document.documentElement,kt=window.innerHeight||ot.clientHeight,Cn=window.innerWidth||ot.clientWidth;return Tt.left>=0&&Tt.top>=0&&Tt.right<=Cn&&Tt.bottom<=kt}},Dte=/\s+/,F4=new VO;function UO(t,n,i,l,h){let o=Array.isArray(i)?i:i.split(Dte),E=["top","bottom","left","right","top-left","top-right","bottom-left","bottom-right","left-top","left-bottom","right-top","right-bottom"],A=n.classList,L=Ae=>{let[Be,Tt]=Ae.split("-"),ot=[];return h&&(ot.push(`${h}-${Be}`),Tt&&ot.push(`${h}-${Be}-${Tt}`),ot.forEach(kt=>{A.add(kt)})),ot};h&&E.forEach(Ae=>{A.remove(`${h}-${Ae}`)});let Y=o.findIndex(Ae=>Ae==="auto");Y>=0&&E.forEach(function(Ae){o.find(Be=>Be.search("^"+Ae)!==-1)==null&&o.splice(Y++,1,Ae)});let le=n.style;le.position="absolute",le.top="0",le.left="0",le["will-change"]="transform";let te,ze=!1;for(te of o){let Ae=L(te);if(F4.positionElements(t,n,te,l)){ze=!0;break}h&&Ae.forEach(Be=>{A.remove(Be)})}return ze||(te=o[0],L(te),F4.positionElements(t,n,te,l)),te}var uS=(function(t){return t[t.SUNDAY=0]="SUNDAY",t[t.MONDAY=1]="MONDAY",t[t.TUESDAY=2]="TUESDAY",t[t.WEDNESDAY=3]="WEDNESDAY",t[t.THURSDAY=4]="THURSDAY",t[t.FRIDAY=5]="FRIDAY",t[t.SATURDAY=6]="SATURDAY",t})(uS||{}),Ite=[uS.SUNDAY,uS.SATURDAY],HO=7,$O=24,lS=60,Ip=3600*24;function L4(t,{startDate:n,seconds:i,excluded:l,precision:h}){if(l.length<1)return 0;let{addSeconds:o,getDay:E,addDays:A}=t,L=o(n,i-1),Y=E(n),le=E(L),te=0,ze=n;for(;ze<L;){let Ae=E(ze);l.some(Be=>Be===Ae)&&(te+=Mte(t,{dayStart:Y,dayEnd:le,day:Ae,precision:h,startDate:n,endDate:L})),ze=A(ze,1)}return te}function Mte(t,{precision:n,day:i,dayStart:l,dayEnd:h,startDate:o,endDate:E}){let{differenceInSeconds:A,endOfDay:L,startOfDay:Y}=t;if(n==="minutes"){if(i===l)return A(L(o),o)+1;if(i===h)return A(E,Y(E))+1}return Ip}function Ate(t,{event:n,offset:i,startOfWeekDate:l,excluded:h,precision:o,totalDaysInView:E}){let{max:A,differenceInSeconds:L,addDays:Y,endOfDay:le,differenceInDays:te}=t,ze=Ip,Ae=A([n.start,l]);if(n.end)switch(o){case"minutes":ze=L(n.end,Ae);break;default:ze=te(Y(le(n.end),1),Ae)*Ip;break}let Be=i*Ip,Tt=Be+ze,ot=E*Ip;return Tt>ot&&(ze=ot-Be),ze-=L4(t,{startDate:Ae,seconds:ze,excluded:h,precision:o}),ze/Ip}function Pte(t,{event:n,startOfWeek:i,excluded:l,precision:h}){let{differenceInDays:o,startOfDay:E,differenceInSeconds:A}=t;if(n.start<i)return 0;let L=0;switch(h){case"days":L=o(E(n.start),i)*Ip;break;case"minutes":L=A(n.start,i);break}return L-=L4(t,{startDate:i,seconds:L,excluded:l,precision:h}),Math.abs(L/Ip)}function Ote(t,{event:n,periodStart:i,periodEnd:l}){let{isSameSecond:h}=t,o=n.start,E=n.end||n.start;return!!(o>i&&o<l||E>i&&E<l||o<i&&E>l||h(o,i)||h(o,l)||h(E,i)||h(E,l))}function Xb(t,{events:n,periodStart:i,periodEnd:l}){return n.filter(h=>Ote(t,{event:h,periodStart:i,periodEnd:l}))}function N4(t,{date:n,weekendDays:i=Ite}){let{startOfDay:l,isSameDay:h,getDay:o}=t,E=l(new Date),A=o(n);return{date:n,day:A,isPast:n<E,isToday:h(n,E),isFuture:n>E,isWeekend:i.indexOf(A)>-1}}function fS(t,{viewDate:n,weekStartsOn:i,excluded:l=[],weekendDays:h,viewStart:o=t.startOfWeek(n,{weekStartsOn:i}),viewEnd:E=t.addDays(o,HO)}){let{addDays:A,getDay:L}=t,Y=[],le=o;for(;le<E;)l.some(te=>L(le)===te)||Y.push(N4(t,{date:le,weekendDays:h})),le=A(le,1);return Y}function Rte(t,{date1:n,date2:i,excluded:l}){let h=n,o=0;for(;h<i;)l.indexOf(t.getDay(h))===-1&&o++,h=t.addDays(h,1);return o}function kte(t,{events:n=[],excluded:i=[],precision:l="days",absolutePositionedEvents:h=!1,viewStart:o,viewEnd:E}){o=t.startOfDay(o),E=t.endOfDay(E);let{differenceInSeconds:A,differenceInDays:L}=t,Y=Rte(t,{date1:o,date2:E,excluded:i}),le=L(E,o)+1,te=n.filter(Be=>Be.allDay).map(Be=>{let Tt=Pte(t,{event:Be,startOfWeek:o,excluded:i,precision:l}),ot=Ate(t,{event:Be,offset:Tt,startOfWeekDate:o,excluded:i,precision:l,totalDaysInView:le});return{event:Be,offset:Tt,span:ot}}).filter(Be=>Be.offset<Y).filter(Be=>Be.span>0).map(Be=>({event:Be.event,offset:Be.offset,span:Be.span,startsBeforeWeek:Be.event.start<o,endsAfterWeek:(Be.event.end||Be.event.start)>E})).sort((Be,Tt)=>{let ot=A(Be.event.start,Tt.event.start);return ot===0?A(Tt.event.end||Tt.event.start,Be.event.end||Be.event.start):ot}),ze=[],Ae=[];return te.forEach((Be,Tt)=>{if(Ae.indexOf(Be)===-1){Ae.push(Be);let ot=Be.span+Be.offset,kt=te.slice(Tt+1).filter(On=>{if(On.offset>=ot&&ot+On.span<=le&&Ae.indexOf(On)===-1){let Vn=On.offset-ot;return h||(On.offset=Vn),ot+=On.span+Vn,Ae.push(On),!0}}),Cn=[Be,...kt],Xn=Cn.filter(On=>On.event.id).map(On=>On.event.id).join("-");ze.push(Object.assign({row:Cn},Xn?{id:Xn}:{}))}}),ze}function Fte(t,{events:n,viewDate:i,hourSegments:l,hourDuration:h,dayStart:o,dayEnd:E,weekStartsOn:A,excluded:L,weekendDays:Y,segmentHeight:le,viewStart:te,viewEnd:ze,minimumEventHeight:Ae}){let Be=Nte(t,{viewDate:i,hourSegments:l,hourDuration:h,dayStart:o,dayEnd:E}),Tt=fS(t,{viewDate:i,weekStartsOn:A,excluded:L,weekendDays:Y,viewStart:te,viewEnd:ze}),{setHours:ot,setMinutes:kt,getHours:Cn,getMinutes:Xn}=t;return Tt.map(On=>{let Vn=Lte(t,{events:n,viewDate:On.date,hourSegments:l,dayStart:o,dayEnd:E,segmentHeight:le,eventWidth:1,hourDuration:h,minimumEventHeight:Ae}),rr=Be.map($n=>{let Qi=$n.segments.map(Rt=>{let en=kt(ot(On.date,Cn(Rt.date)),Xn(Rt.date));return Object.assign(Object.assign({},Rt),{date:en})});return Object.assign(Object.assign({},$n),{segments:Qi})});function Vi($n,Qi){let Rt=Math.max(...Qi.map(ai=>ai.left+1)),en=$n.filter(ai=>ai.left>=Rt).filter(ai=>cS(Qi,ai.top,ai.top+ai.height).length>0);return en.length>0?Vi($n,en):Rt}let Er=Vn.events.map($n=>{let Rt=100/Vi(Vn.events,cS(Vn.events,$n.top,$n.top+$n.height));return Object.assign(Object.assign({},$n),{left:$n.left*Rt,width:Rt})});return{hours:rr,date:On.date,events:Er.map($n=>{let Qi=cS(Er.filter(Rt=>Rt.left>$n.left),$n.top,$n.top+$n.height);return Qi.length>0?Object.assign(Object.assign({},$n),{width:Math.min(...Qi.map(Rt=>Rt.left))-$n.left}):$n})}})}function z4(t,{events:n=[],viewDate:i,weekStartsOn:l,excluded:h=[],precision:o="days",absolutePositionedEvents:E=!1,hourSegments:A,hourDuration:L,dayStart:Y,dayEnd:le,weekendDays:te,segmentHeight:ze,minimumEventHeight:Ae,viewStart:Be=t.startOfWeek(i,{weekStartsOn:l}),viewEnd:Tt=t.endOfWeek(i,{weekStartsOn:l})}){n||(n=[]);let{startOfDay:ot,endOfDay:kt}=t;Be=ot(Be),Tt=kt(Tt);let Cn=Xb(t,{events:n,periodStart:Be,periodEnd:Tt}),Xn=fS(t,{viewDate:i,weekStartsOn:l,excluded:h,weekendDays:te,viewStart:Be,viewEnd:Tt});return{allDayEventRows:kte(t,{events:Cn,excluded:h,precision:o,absolutePositionedEvents:E,viewStart:Be,viewEnd:Tt}),period:{events:Cn,start:Xn[0].date,end:kt(Xn[Xn.length-1].date)},hourColumns:Fte(t,{events:n,viewDate:i,hourSegments:A,hourDuration:L,dayStart:Y,dayEnd:le,weekStartsOn:l,excluded:h,weekendDays:te,segmentHeight:ze,viewStart:Be,viewEnd:Tt,minimumEventHeight:Ae})}}function B4(t,{events:n=[],viewDate:i,weekStartsOn:l,excluded:h=[],viewStart:o=t.startOfMonth(i),viewEnd:E=t.endOfMonth(i),weekendDays:A}){n||(n=[]);let{startOfWeek:L,endOfWeek:Y,differenceInDays:le,startOfDay:te,addHours:ze,endOfDay:Ae,isSameMonth:Be,getDay:Tt}=t,ot=L(o,{weekStartsOn:l}),kt=Y(E,{weekStartsOn:l}),Cn=Xb(t,{events:n,periodStart:ot,periodEnd:kt}),Xn=[],On;for(let $n=0;$n<le(kt,ot)+1;$n++){let Qi;if(On?(Qi=te(ze(On,$O)),On.getTime()===Qi.getTime()&&(Qi=te(ze(On,$O+1))),On=Qi):Qi=On=ot,!h.some(Rt=>Tt(Qi)===Rt)){let Rt=N4(t,{date:Qi,weekendDays:A}),en=Xb(t,{events:Cn,periodStart:te(Qi),periodEnd:Ae(Qi)});Rt.inMonth=Be(Qi,i),Rt.events=en,Rt.badgeTotal=en.length,Xn.push(Rt)}}let Vn=[],rr=HO-h.length;if(rr<HO)for(let $n=0;$n<Xn.length;$n+=rr){let Qi=Xn.slice($n,$n+rr);Qi.some(en=>o<=en.date&&en.date<E)&&(Vn=[...Vn,...Qi])}else Vn=Xn;let Vi=Math.floor(Vn.length/rr),Er=[];for(let $n=0;$n<Vi;$n++)Er.push($n*rr);return{rowOffsets:Er,totalDaysVisibleInWeek:rr,days:Vn,period:{start:Vn[0].date,end:Ae(Vn[Vn.length-1].date),events:Cn}}}function cS(t,n,i){return t.filter(l=>{let h=l.top,o=l.top+l.height;return n<o&&o<i||n<h&&h<i?!0:h<=n&&i<=o})}function Lte(t,{events:n,viewDate:i,hourSegments:l,dayStart:h,dayEnd:o,eventWidth:E,segmentHeight:A,hourDuration:L,minimumEventHeight:Y}){let{setMinutes:le,setHours:te,startOfDay:ze,startOfMinute:Ae,endOfDay:Be,differenceInMinutes:Tt}=t,ot=le(te(ze(i),dS(h.hour)),hS(h.minute)),kt=le(te(Ae(Be(i)),dS(o.hour)),hS(o.minute));kt.setSeconds(59,999);let Cn=[],Xn=Xb(t,{events:n.filter(Vi=>!Vi.allDay),periodStart:ot,periodEnd:kt}),On=Xn.sort((Vi,Er)=>Vi.start.valueOf()-Er.start.valueOf()).map(Vi=>{let Er=Vi.start,$n=Vi.end||Er,Qi=Er<ot,Rt=$n>kt,en=l*A/(L||lS),ai=0;if(Er>ot){let Do=t.getTimezoneOffset(Er),$a=t.getTimezoneOffset(ot)-Do;ai+=Tt(Er,ot)+$a}ai*=en,ai=Math.floor(ai);let Fi=Qi?ot:Er,Wi=Rt?kt:$n,Pr=t.getTimezoneOffset(Fi)-t.getTimezoneOffset(Wi),Oo=Tt(Wi,Fi)+Pr;Vi.end?Oo*=en:Oo=A,Y&&Oo<Y&&(Oo=Y),Oo=Math.floor(Oo);let ks=ai+Oo,Fs=cS(Cn,ai,ks),eo=0;for(;Fs.some(Do=>Do.left===eo);)eo+=E;let Ui={event:Vi,height:Oo,width:E,top:ai,left:eo,startsBeforeDay:Qi,endsAfterDay:Rt};return Cn.push(Ui),Ui}),Vn=Math.max(...On.map(Vi=>Vi.left+Vi.width)),rr=Xb(t,{events:n.filter(Vi=>Vi.allDay),periodStart:ze(ot),periodEnd:Be(kt)});return{events:On,width:Vn,allDayEvents:rr,period:{events:Xn,start:ot,end:kt}}}function dS(t){return Math.max(Math.min(23,t),0)}function hS(t){return Math.max(Math.min(59,t),0)}function Nte(t,{viewDate:n,hourSegments:i,hourDuration:l,dayStart:h,dayEnd:o}){let{setMinutes:E,setHours:A,startOfDay:L,startOfMinute:Y,endOfDay:le,addMinutes:te,addDays:ze}=t,Ae=[],Be=E(A(L(n),dS(h.hour)),hS(h.minute)),Tt=E(A(Y(le(n)),dS(o.hour)),hS(o.minute)),ot=(l||lS)/i,kt=L(n),Cn=le(n),Xn=Vn=>Vn;t.getTimezoneOffset(kt)!==t.getTimezoneOffset(Cn)&&(kt=ze(kt,1),Be=ze(Be,1),Tt=ze(Tt,1),Xn=Vn=>ze(Vn,-1));let On=l?$O*60/l:lS;for(let Vn=0;Vn<On;Vn++){let rr=[];for(let Vi=0;Vi<i;Vi++){let Er=te(te(Be,Vn*(l||lS)),Vi*ot);Er>=Be&&Er<Tt&&rr.push({date:Xn(Er),displayDate:Er,isStart:Vi===0})}rr.length>0&&Ae.push({segments:rr})}return Ae}var K0=(function(t){return t.NotArray="Events must be an array",t.StartPropertyMissing="Event is missing the `start` property",t.StartPropertyNotDate="Event `start` property should be a javascript date object. Do `new Date(event.start)` to fix it.",t.EndPropertyNotDate="Event `end` property should be a javascript date object. Do `new Date(event.end)` to fix it.",t.EndsBeforeStart="Event `start` property occurs after the `end`",t})(K0||{});function j4(t,n){let i=!0;function l(h,o){n(h,o),i=!1}return Array.isArray(t)?(t.forEach(h=>{h.start?h.start instanceof Date||l(K0.StartPropertyNotDate,h):l(K0.StartPropertyMissing,h),h.end&&(h.end instanceof Date||l(K0.EndPropertyNotDate,h),h.start>h.end&&l(K0.EndsBeforeStart,h))}),i):(n(K0.NotArray,t),!1)}function zte(t,n){return typeof t>"u"?typeof n>"u"?t:n:t}function ZO(t,n){return t=zte(t,n),typeof t=="function"?function(){for(var l=arguments,h=arguments.length,o=Array(h),E=0;E<h;E++)o[E]=l[E];return!!t.apply(this,o)}:t?function(){return!0}:function(){return!1}}var GO=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol?"symbol":typeof t},U4=function(t){return t!=null&&(typeof t>"u"?"undefined":GO(t))==="object"&&t.nodeType===1&&GO(t.style)==="object"&&GO(t.ownerDocument)==="object"};function H4(t,n){if(n=KO(n,!0),!U4(n))return-1;for(var i=0;i<t.length;i++)if(t[i]===n)return i;return-1}function XO(t,n){return H4(t,n)!==-1}function Bte(t,n){for(var i=0;i<n.length;i++)XO(t,n[i])||t.push(n[i]);return n}function jte(t){for(var n=arguments,i=[],l=arguments.length-1;l-- >0;)i[l]=n[l+1];return i=i.map(KO),Bte(t,i)}function Vte(t){for(var n=arguments,i=[],l=arguments.length-1;l-- >0;)i[l]=n[l+1];return i.map(KO).reduce(function(h,o){var E=H4(t,o);return E!==-1?h.concat(t.splice(E,1)):h},[])}function KO(t,n){if(typeof t=="string")try{return document.querySelector(t)}catch(i){throw i}if(!U4(t)&&!n)throw new TypeError(t+" is not a DOM element.");return t}function Ute(t,n){n=n||{};var i=ZO(n.allowUpdate,!0);return function(h){if(h=h||window.event,t.target=h.target||h.srcElement||h.originalTarget,t.element=this,t.type=h.type,!!i(h)){if(h.targetTouches)t.x=h.targetTouches[0].clientX,t.y=h.targetTouches[0].clientY,t.pageX=h.targetTouches[0].pageX,t.pageY=h.targetTouches[0].pageY,t.screenX=h.targetTouches[0].screenX,t.screenY=h.targetTouches[0].screenY;else{if(h.pageX===null&&h.clientX!==null){var o=h.target&&h.target.ownerDocument||document,E=o.documentElement,A=o.body;t.pageX=h.clientX+(E&&E.scrollLeft||A&&A.scrollLeft||0)-(E&&E.clientLeft||A&&A.clientLeft||0),t.pageY=h.clientY+(E&&E.scrollTop||A&&A.scrollTop||0)-(E&&E.clientTop||A&&A.clientTop||0)}else t.pageX=h.pageX,t.pageY=h.pageY;t.x=h.clientX,t.y=h.clientY,t.screenX=h.screenX,t.screenY=h.screenY}t.clientX=t.x,t.clientY=t.y}}}function Hte(){var t={top:{value:0,enumerable:!0},left:{value:0,enumerable:!0},right:{value:window.innerWidth,enumerable:!0},bottom:{value:window.innerHeight,enumerable:!0},width:{value:window.innerWidth,enumerable:!0},height:{value:window.innerHeight,enumerable:!0},x:{value:0,enumerable:!0},y:{value:0,enumerable:!0}};if(Object.create)return Object.create({},t);var n={};return Object.defineProperties(n,t),n}function $4(t){if(t===window)return Hte();try{var n=t.getBoundingClientRect();return n.x===void 0&&(n.x=n.left,n.y=n.top),n}catch{throw new TypeError("Can't call getBoundingClientRect on "+t)}}function $te(t,n){var i=$4(n);return t.y>i.top&&t.y<i.bottom&&t.x>i.left&&t.x<i.right}var YO=void 0;typeof Object.create!="function"?YO=(function(t){var n=function(){};return function(i,l){if(i!==Object(i)&&i!==null)throw TypeError("Argument must be an object, or null");n.prototype=i||{};var h=new n;return n.prototype=null,l!==t&&Object.defineProperties(h,l),i===null&&(h.__proto__=null),h}})():YO=Object.create;var Gte=YO,hg=["altKey","button","buttons","clientX","clientY","ctrlKey","metaKey","movementX","movementY","offsetX","offsetY","pageX","pageY","region","relatedTarget","screenX","screenY","shiftKey","which","x","y"];function qte(t){var n={screenX:0,screenY:0,clientX:0,clientY:0,ctrlKey:!1,shiftKey:!1,altKey:!1,metaKey:!1,button:0,buttons:1,relatedTarget:null,region:null};t!==void 0&&t.addEventListener("mousemove",i);function i(o){for(var E=0;E<hg.length;E++)n[hg[E]]=o[hg[E]]}var l=(function(){if(MouseEvent)return function(E,A,L){var Y=new MouseEvent("mousemove",qO(n,A));return WO(Y,L),E.dispatchEvent(Y)};if(typeof document.createEvent=="function")return function(E,A,L){var Y=qO(n,A),le=document.createEvent("MouseEvents");return le.initMouseEvent("mousemove",!0,!0,window,0,Y.screenX,Y.screenY,Y.clientX,Y.clientY,Y.ctrlKey,Y.altKey,Y.shiftKey,Y.metaKey,Y.button,Y.relatedTarget),WO(le,L),E.dispatchEvent(le)};if(typeof document.createEventObject=="function")return function(E,A,L){var Y=document.createEventObject(),le=qO(n,A);for(var te in le)Y[te]=le[te];return WO(Y,L),E.dispatchEvent(Y)}})();function h(){t&&t.removeEventListener("mousemove",i,!1),n=null}return{destroy:h,dispatch:l}}function qO(t,n){n=n||{};for(var i=Gte(t),l=0;l<hg.length;l++)n[hg[l]]!==void 0&&(i[hg[l]]=n[hg[l]]);return i}function WO(t,n){console.log("data ",n),t.data=n||{},t.dispatched="mousemove"}var Kb=["webkit","moz","ms","o"],Yb=(function(){if(typeof window>"u")return function(){};for(var t=0,n=Kb.length;t<n&&!window.requestAnimationFrame;++t)window.requestAnimationFrame=window[Kb[t]+"RequestAnimationFrame"];if(!window.requestAnimationFrame){var i=0;window.requestAnimationFrame=function(l){var h=new Date().getTime(),o=Math.max(0,16-h-i),E=window.setTimeout(function(){return l(h+o)},o);return i=h+o,E}}return window.requestAnimationFrame.bind(window)})(),J0=(function(){if(typeof window>"u")return function(){};for(var t=0,n=Kb.length;t<n&&!window.cancelAnimationFrame;++t)window.cancelAnimationFrame=window[Kb[t]+"CancelAnimationFrame"]||window[Kb[t]+"CancelRequestAnimationFrame"];return window.cancelAnimationFrame||(window.cancelAnimationFrame=function(i){window.clearTimeout(i)}),window.cancelAnimationFrame.bind(window)})();function Wte(t,n){n===void 0&&(n={});var i=this,l=4,h=!1;if(typeof n.margin!="object"){var o=n.margin||-1;this.margin={left:o,right:o,top:o,bottom:o}}else this.margin=n.margin;this.scrollWhenOutside=n.scrollWhenOutside||!1;var E={},A=Ute(E),L=qte(),Y=!1;window.addEventListener("mousemove",A,!1),window.addEventListener("touchmove",A,!1),isNaN(n.maxSpeed)||(l=n.maxSpeed),typeof l!="object"&&(l={left:l,right:l,top:l,bottom:l}),this.autoScroll=ZO(n.autoScroll),this.syncMove=ZO(n.syncMove,!1),this.destroy=function(Rt){window.removeEventListener("mousemove",A,!1),window.removeEventListener("touchmove",A,!1),window.removeEventListener("mousedown",Tt,!1),window.removeEventListener("touchstart",Tt,!1),window.removeEventListener("mouseup",ot,!1),window.removeEventListener("touchend",ot,!1),window.removeEventListener("pointerup",ot,!1),window.removeEventListener("mouseleave",Cn,!1),window.removeEventListener("mousemove",Vn,!1),window.removeEventListener("touchmove",Vn,!1),window.removeEventListener("scroll",Be,!0),t=[],Rt&&kt()},this.add=function(){for(var Rt=[],en=arguments.length;en--;)Rt[en]=arguments[en];return jte.apply(void 0,[t].concat(Rt)),this},this.remove=function(){for(var Rt=[],en=arguments.length;en--;)Rt[en]=arguments[en];return Vte.apply(void 0,[t].concat(Rt))};var le=null,te;Object.prototype.toString.call(t)!=="[object Array]"&&(t=[t]),(function(Rt){t=[],Rt.forEach(function(en){en===window?le=window:i.add(en)})})(t),Object.defineProperties(this,{down:{get:function(){return Y}},maxSpeed:{get:function(){return l}},point:{get:function(){return E}},scrolling:{get:function(){return h}}});var ze=null,Ae;window.addEventListener("mousedown",Tt,!1),window.addEventListener("touchstart",Tt,!1),window.addEventListener("mouseup",ot,!1),window.addEventListener("touchend",ot,!1),window.addEventListener("pointerup",ot,!1),window.addEventListener("mousemove",Vn,!1),window.addEventListener("touchmove",Vn,!1),window.addEventListener("mouseleave",Cn,!1),window.addEventListener("scroll",Be,!0);function Be(Rt){for(var en=0;en<t.length;en++)if(t[en]===Rt.target){h=!0;break}h&&Yb(function(){return h=!1})}function Tt(){Y=!0}function ot(){Y=!1,kt()}function kt(){J0(Ae),J0(te)}function Cn(){Y=!1}function Xn(Rt){if(!Rt)return null;if(ze===Rt||XO(t,Rt))return Rt;for(;Rt=Rt.parentNode;)if(XO(t,Rt))return Rt;return null}function On(){for(var Rt=null,en=0;en<t.length;en++)V4(E,t[en])&&(Rt=t[en]);return Rt}function Vn(Rt){if(i.autoScroll()&&!Rt.dispatched){var en=Rt.target,ai=document.body;ze&&!V4(E,ze)&&(i.scrollWhenOutside||(ze=null)),en&&en.parentNode===ai?en=On():(en=Xn(en),en||(en=On())),en&&en!==ze&&(ze=en),le&&(J0(te),te=Yb(rr)),ze&&(J0(Ae),Ae=Yb(Vi))}}function rr(){Er(le),J0(te),te=Yb(rr)}function Vi(){ze&&(Er(ze),J0(Ae),Ae=Yb(Vi))}function Er(Rt){var en=$4(Rt),ai,Fi;E.x<en.left+i.margin.left?ai=Math.floor(Math.max(-1,(E.x-en.left)/i.margin.left-1)*i.maxSpeed.left):E.x>en.right-i.margin.right?ai=Math.ceil(Math.min(1,(E.x-en.right)/i.margin.right+1)*i.maxSpeed.right):ai=0,E.y<en.top+i.margin.top?Fi=Math.floor(Math.max(-1,(E.y-en.top)/i.margin.top-1)*i.maxSpeed.top):E.y>en.bottom-i.margin.bottom?Fi=Math.ceil(Math.min(1,(E.y-en.bottom)/i.margin.bottom+1)*i.maxSpeed.bottom):Fi=0,i.syncMove()&&L.dispatch(Rt,{pageX:E.pageX+ai,pageY:E.pageY+Fi,clientX:E.x+ai,clientY:E.y+Fi}),setTimeout(function(){Fi&&$n(Rt,Fi),ai&&Qi(Rt,ai)})}function $n(Rt,en){Rt===window?window.scrollTo(Rt.pageXOffset,Rt.pageYOffset+en):Rt.scrollTop+=en}function Qi(Rt,en){Rt===window?window.scrollTo(Rt.pageXOffset+en,Rt.pageYOffset):Rt.scrollLeft+=en}}function Zte(t,n){return new Wte(t,n)}function V4(t,n,i){return i?t.y>i.top&&t.y<i.bottom&&t.x>i.left&&t.x<i.right:$te(t,n)}var G4=Zte;var W4=(()=>{let n=class n{constructor(){this.currentDrag=new Fn}};n.\u0275fac=function(h){return new(h||n)},n.\u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"root"});let t=n;return t})(),Z4=(()=>{let n=class n{constructor(){this.elementRef=ft(Fo)}};n.\u0275fac=function(h){return new(h||n)},n.\u0275dir=Ki({type:n,selectors:[["","mwlDraggableScrollContainer",""]]});let t=n;return t})();function JO(t,n,i){i&&i.split(" ").forEach(l=>t.addClass(n.nativeElement,l))}function pS(t,n,i){i&&i.split(" ").forEach(l=>t.removeClass(n.nativeElement,l))}var QO=(()=>{let n=class n{constructor(){this.dragAxis={x:!0,y:!0},this.dragSnapGrid={},this.ghostDragEnabled=!0,this.showOriginalElementWhileDragging=!1,this.dragCursor="",this.autoScroll={margin:20},this.dragPointerDown=new qi,this.dragStart=new qi,this.ghostElementCreated=new qi,this.dragging=new qi,this.dragEnd=new qi,this.pointerDown$=new Fn,this.pointerMove$=new Fn,this.pointerUp$=new Fn,this.eventListenerSubscriptions={},this.destroy$=new Fn,this.timeLongPress={timerBegin:0,timerEnd:0},this.element=ft(Fo),this.renderer=ft(ia),this.draggableHelper=ft(W4),this.zone=ft(so),this.vcr=ft(Oc),this.scrollContainer=ft(Z4,{optional:!0}),this.document=ft(_o)}ngOnInit(){this.checkEventListeners();let l=this.pointerDown$.pipe(To(()=>this.canDrag()),Eo(h=>{h.event.stopPropagation&&!this.scrollContainer&&h.event.stopPropagation();let o=this.renderer.createElement("style");this.renderer.setAttribute(o,"type","text/css"),this.renderer.appendChild(o,this.renderer.createText(`
          body * {
           -moz-user-select: none;
           -ms-user-select: none;
           -webkit-user-select: none;
           user-select: none;
          }
        `)),requestAnimationFrame(()=>{this.document.head.appendChild(o)});let E=this.getScrollPosition(),A=new xi(Be=>{let Tt=this.scrollContainer?this.scrollContainer.elementRef.nativeElement:"window";return this.renderer.listen(Tt,"scroll",ot=>Be.next(ot))}).pipe(d0(E),di(()=>this.getScrollPosition())),L=new Fn,Y=new tp;this.dragPointerDown.observers.length>0&&this.zone.run(()=>{this.dragPointerDown.next({x:0,y:0})});let le=Ex(this.pointerUp$,this.pointerDown$,Y,this.destroy$).pipe(km()),te=Rm([this.pointerMove$,A]).pipe(di(([Be,Tt])=>({currentDrag$:L,transformX:Be.clientX-h.clientX,transformY:Be.clientY-h.clientY,clientX:Be.clientX,clientY:Be.clientY,scrollLeft:Tt.left,scrollTop:Tt.top,target:Be.event.target})),di(Be=>(this.dragSnapGrid.x&&(Be.transformX=Math.round(Be.transformX/this.dragSnapGrid.x)*this.dragSnapGrid.x),this.dragSnapGrid.y&&(Be.transformY=Math.round(Be.transformY/this.dragSnapGrid.y)*this.dragSnapGrid.y),Be)),di(Be=>(this.dragAxis.x||(Be.transformX=0),this.dragAxis.y||(Be.transformY=0),Be)),di(Be=>{let Tt=Be.scrollLeft-E.left,ot=Be.scrollTop-E.top;return Mi(Jt({},Be),{x:Be.transformX+Tt,y:Be.transformY+ot})}),To(({x:Be,y:Tt,transformX:ot,transformY:kt})=>!this.validateDrag||this.validateDrag({x:Be,y:Tt,transform:{x:ot,y:kt}})),tn(le),km()),ze=te.pipe(Al(1),km()),Ae=te.pipe(rp(1),km());return ze.subscribe(({clientX:Be,clientY:Tt,x:ot,y:kt})=>{if(this.dragStart.observers.length>0&&this.zone.run(()=>{this.dragStart.next({cancelDrag$:Y})}),this.scroller=G4([this.scrollContainer?this.scrollContainer.elementRef.nativeElement:this.document.defaultView],Mi(Jt({},this.autoScroll),{autoScroll(){return!0}})),JO(this.renderer,this.element,this.dragActiveClass),this.ghostDragEnabled){let Cn=this.element.nativeElement.getBoundingClientRect(),Xn=this.element.nativeElement.cloneNode(!0);if(this.showOriginalElementWhileDragging||this.renderer.setStyle(this.element.nativeElement,"visibility","hidden"),this.ghostElementAppendTo?this.ghostElementAppendTo.appendChild(Xn):this.element.nativeElement.parentNode.insertBefore(Xn,this.element.nativeElement.nextSibling),this.ghostElement=Xn,this.document.body.style.cursor=this.dragCursor,this.setElementStyles(Xn,{position:"fixed",top:`${Cn.top}px`,left:`${Cn.left}px`,width:`${Cn.width}px`,height:`${Cn.height}px`,cursor:this.dragCursor,margin:"0",willChange:"transform",pointerEvents:"none"}),this.ghostElementTemplate){let On=this.vcr.createEmbeddedView(this.ghostElementTemplate);Xn.innerHTML="",On.rootNodes.filter(Vn=>Vn instanceof Node).forEach(Vn=>{Xn.appendChild(Vn)}),Ae.subscribe(()=>{this.vcr.remove(this.vcr.indexOf(On))})}this.ghostElementCreated.observers.length>0&&this.zone.run(()=>{this.ghostElementCreated.emit({clientX:Be-ot,clientY:Tt-kt,element:Xn})}),Ae.subscribe(()=>{Xn.parentElement.removeChild(Xn),this.ghostElement=null,this.renderer.setStyle(this.element.nativeElement,"visibility","")})}this.draggableHelper.currentDrag.next(L)}),Ae.pipe(Eo(Be=>{let Tt=Y.pipe(V2(),Al(1),di(ot=>Mi(Jt({},Be),{dragCancelled:ot>0})));return Y.complete(),Tt})).subscribe(({x:Be,y:Tt,dragCancelled:ot})=>{this.scroller.destroy(),this.dragEnd.observers.length>0&&this.zone.run(()=>{this.dragEnd.next({x:Be,y:Tt,dragCancelled:ot})}),pS(this.renderer,this.element,this.dragActiveClass),L.complete()}),Ex(le,Ae).pipe(Al(1)).subscribe(()=>{requestAnimationFrame(()=>{this.document.head.removeChild(o)})}),te}),km());Ex(l.pipe(Al(1),di(h=>[,h])),l.pipe(ZC())).pipe(To(([h,o])=>h?h.x!==o.x||h.y!==o.y:!0),di(([h,o])=>o)).subscribe(({x:h,y:o,currentDrag$:E,clientX:A,clientY:L,transformX:Y,transformY:le,target:te})=>{this.dragging.observers.length>0&&this.zone.run(()=>{this.dragging.next({x:h,y:o})}),requestAnimationFrame(()=>{if(this.ghostElement){let ze=`translate3d(${Y}px, ${le}px, 0px)`;this.setElementStyles(this.ghostElement,{transform:ze,"-webkit-transform":ze,"-ms-transform":ze,"-moz-transform":ze,"-o-transform":ze})}}),E.next({clientX:A,clientY:L,dropData:this.dropData,target:te})})}ngOnChanges(l){l.dragAxis&&this.checkEventListeners()}ngOnDestroy(){this.unsubscribeEventListeners(),this.pointerDown$.complete(),this.pointerMove$.complete(),this.pointerUp$.complete(),this.destroy$.next()}checkEventListeners(){let l=this.canDrag(),h=Object.keys(this.eventListenerSubscriptions).length>0;l&&!h?this.zone.runOutsideAngular(()=>{this.eventListenerSubscriptions.mousedown=this.renderer.listen(this.element.nativeElement,"mousedown",o=>{this.onMouseDown(o)}),this.eventListenerSubscriptions.mouseup=this.renderer.listen("document","mouseup",o=>{this.onMouseUp(o)}),this.eventListenerSubscriptions.touchstart=this.renderer.listen(this.element.nativeElement,"touchstart",o=>{this.onTouchStart(o)}),this.eventListenerSubscriptions.touchend=this.renderer.listen("document","touchend",o=>{this.onTouchEnd(o)}),this.eventListenerSubscriptions.touchcancel=this.renderer.listen("document","touchcancel",o=>{this.onTouchEnd(o)}),this.eventListenerSubscriptions.mouseenter=this.renderer.listen(this.element.nativeElement,"mouseenter",()=>{this.onMouseEnter()}),this.eventListenerSubscriptions.mouseleave=this.renderer.listen(this.element.nativeElement,"mouseleave",()=>{this.onMouseLeave()})}):!l&&h&&this.unsubscribeEventListeners()}onMouseDown(l){l.button===0&&(this.eventListenerSubscriptions.mousemove||(this.eventListenerSubscriptions.mousemove=this.renderer.listen("document","mousemove",h=>{this.pointerMove$.next({event:h,clientX:h.clientX,clientY:h.clientY})})),this.pointerDown$.next({event:l,clientX:l.clientX,clientY:l.clientY}))}onMouseUp(l){l.button===0&&(this.eventListenerSubscriptions.mousemove&&(this.eventListenerSubscriptions.mousemove(),delete this.eventListenerSubscriptions.mousemove),this.pointerUp$.next({event:l,clientX:l.clientX,clientY:l.clientY}))}onTouchStart(l){let h,o,E;if(this.touchStartLongPress&&(this.timeLongPress.timerBegin=Date.now(),o=!1,E=this.hasScrollbar(),h=this.getScrollPosition()),!this.eventListenerSubscriptions.touchmove){let A=u0(this.document,"contextmenu").subscribe(Y=>{Y.preventDefault()}),L=u0(this.document,"touchmove",{passive:!1}).subscribe(Y=>{this.touchStartLongPress&&!o&&E&&(o=this.shouldBeginDrag(l,Y,h)),(!this.touchStartLongPress||!E||o)&&(Y.preventDefault(),this.pointerMove$.next({event:Y,clientX:Y.targetTouches[0].clientX,clientY:Y.targetTouches[0].clientY}))});this.eventListenerSubscriptions.touchmove=()=>{A.unsubscribe(),L.unsubscribe()}}this.pointerDown$.next({event:l,clientX:l.touches[0].clientX,clientY:l.touches[0].clientY})}onTouchEnd(l){this.eventListenerSubscriptions.touchmove&&(this.eventListenerSubscriptions.touchmove(),delete this.eventListenerSubscriptions.touchmove,this.touchStartLongPress&&this.enableScroll()),this.pointerUp$.next({event:l,clientX:l.changedTouches[0].clientX,clientY:l.changedTouches[0].clientY})}onMouseEnter(){this.setCursor(this.dragCursor)}onMouseLeave(){this.setCursor("")}canDrag(){return this.dragAxis.x||this.dragAxis.y}setCursor(l){this.eventListenerSubscriptions.mousemove||this.renderer.setStyle(this.element.nativeElement,"cursor",l)}unsubscribeEventListeners(){Object.keys(this.eventListenerSubscriptions).forEach(l=>{this.eventListenerSubscriptions[l](),delete this.eventListenerSubscriptions[l]})}setElementStyles(l,h){Object.keys(h).forEach(o=>{this.renderer.setStyle(l,o,h[o])})}getScrollElement(){return this.scrollContainer?this.scrollContainer.elementRef.nativeElement:this.document.body}getScrollPosition(){return this.scrollContainer?{top:this.scrollContainer.elementRef.nativeElement.scrollTop,left:this.scrollContainer.elementRef.nativeElement.scrollLeft}:{top:window.pageYOffset||this.document.documentElement.scrollTop,left:window.pageXOffset||this.document.documentElement.scrollLeft}}shouldBeginDrag(l,h,o){let E=this.getScrollPosition(),A={top:Math.abs(E.top-o.top),left:Math.abs(E.left-o.left)},L=Math.abs(h.targetTouches[0].clientX-l.touches[0].clientX)-A.left,Y=Math.abs(h.targetTouches[0].clientY-l.touches[0].clientY)-A.top,le=L+Y,te=this.touchStartLongPress;return(le>te.delta||A.top>0||A.left>0)&&(this.timeLongPress.timerBegin=Date.now()),this.timeLongPress.timerEnd=Date.now(),this.timeLongPress.timerEnd-this.timeLongPress.timerBegin>=te.delay?(this.disableScroll(),!0):!1}enableScroll(){this.scrollContainer&&this.renderer.setStyle(this.scrollContainer.elementRef.nativeElement,"overflow",""),this.renderer.setStyle(this.document.body,"overflow","")}disableScroll(){this.scrollContainer&&this.renderer.setStyle(this.scrollContainer.elementRef.nativeElement,"overflow","hidden"),this.renderer.setStyle(this.document.body,"overflow","hidden")}hasScrollbar(){let l=this.getScrollElement(),h=l.scrollWidth>l.clientWidth,o=l.scrollHeight>l.clientHeight;return h||o}};n.\u0275fac=function(h){return new(h||n)},n.\u0275dir=Ki({type:n,selectors:[["","mwlDraggable",""]],inputs:{dropData:"dropData",dragAxis:"dragAxis",dragSnapGrid:"dragSnapGrid",ghostDragEnabled:"ghostDragEnabled",showOriginalElementWhileDragging:"showOriginalElementWhileDragging",validateDrag:"validateDrag",dragCursor:"dragCursor",dragActiveClass:"dragActiveClass",ghostElementAppendTo:"ghostElementAppendTo",ghostElementTemplate:"ghostElementTemplate",touchStartLongPress:"touchStartLongPress",autoScroll:"autoScroll"},outputs:{dragPointerDown:"dragPointerDown",dragStart:"dragStart",ghostElementCreated:"ghostElementCreated",dragging:"dragging",dragEnd:"dragEnd"},features:[wa]});let t=n;return t})();function q4(t,n,i){return t>=i.left&&t<=i.right&&n>=i.top&&n<=i.bottom}var X4=(()=>{let n=class n{constructor(){this.dragEnter=new qi,this.dragLeave=new qi,this.dragOver=new qi,this.drop=new qi,this.element=ft(Fo),this.draggableHelper=ft(W4),this.zone=ft(so),this.renderer=ft(ia),this.scrollContainer=ft(Z4,{optional:!0})}ngOnInit(){this.currentDragSubscription=this.draggableHelper.currentDrag.subscribe(l=>{JO(this.renderer,this.element,this.dragActiveClass);let h={updateCache:!0},o=this.renderer.listen(this.scrollContainer?this.scrollContainer.elementRef.nativeElement:"window","scroll",()=>{h.updateCache=!0}),E,A=l.pipe(di(({clientX:le,clientY:te,dropData:ze,target:Ae})=>{E={clientX:le,clientY:te,dropData:ze,target:Ae},h.updateCache&&(h.rect=this.element.nativeElement.getBoundingClientRect(),this.scrollContainer&&(h.scrollContainerRect=this.scrollContainer.elementRef.nativeElement.getBoundingClientRect()),h.updateCache=!1);let Be=q4(le,te,h.rect),Tt=!this.validateDrop||this.validateDrop({clientX:le,clientY:te,target:Ae,dropData:ze});return h.scrollContainerRect?Be&&Tt&&q4(le,te,h.scrollContainerRect):Be&&Tt})),L=A.pipe(U2()),Y;L.pipe(To(le=>le)).subscribe(()=>{Y=!0,JO(this.renderer,this.element,this.dragOverClass),this.dragEnter.observers.length>0&&this.zone.run(()=>{this.dragEnter.next(E)})}),A.pipe(To(le=>le)).subscribe(()=>{this.dragOver.observers.length>0&&this.zone.run(()=>{this.dragOver.next(E)})}),L.pipe(ZC(),To(([le,te])=>le&&!te)).subscribe(()=>{Y=!1,pS(this.renderer,this.element,this.dragOverClass),this.dragLeave.observers.length>0&&this.zone.run(()=>{this.dragLeave.next(E)})}),l.subscribe({complete:()=>{o(),pS(this.renderer,this.element,this.dragActiveClass),Y&&(pS(this.renderer,this.element,this.dragOverClass),this.drop.observers.length>0&&this.zone.run(()=>{this.drop.next(E)}))}})})}ngOnDestroy(){this.currentDragSubscription&&this.currentDragSubscription.unsubscribe()}};n.\u0275fac=function(h){return new(h||n)},n.\u0275dir=Ki({type:n,selectors:[["","mwlDroppable",""]],inputs:{dragOverClass:"dragOverClass",dragActiveClass:"dragActiveClass",validateDrop:"validateDrop"},outputs:{dragEnter:"dragEnter",dragLeave:"dragLeave",dragOver:"dragOver",drop:"drop"}});let t=n;return t})(),Jb=(()=>{let n=class n{};n.\u0275fac=function(h){return new(h||n)},n.\u0275mod=Qo({type:n}),n.\u0275inj=$o({});let t=n;return t})();var _Se=typeof window>"u"?!1:"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0;var vSe=Object.freeze({topLeft:"nw-resize",topRight:"ne-resize",bottomLeft:"sw-resize",bottomRight:"se-resize",leftOrRight:"col-resize",topOrBottom:"row-resize"});var eR=(()=>{let n=class n{};n.\u0275fac=function(h){return new(h||n)},n.\u0275mod=Qo({type:n}),n.\u0275inj=$o({});let t=n;return t})();var eU=t=>({event:t}),Xte=t=>({action:t}),tR=(t,n)=>n.id??n;function Yte(t,n){if(t&1){let i=Hn();$(0,"a",4),gs(1,"calendarA11y"),Ot("mwlClick",function(h){let o=Wt(i).$implicit,E=Ne(2).event;return Zt(o.onClick({event:E,sourceEvent:h}))})("mwlKeydownEnter",function(h){let o=Wt(i).$implicit,E=Ne(2).event;return Zt(o.onClick({event:E,sourceEvent:h}))}),W()}if(t&2){let i=n.$implicit;zt("ngClass",i.cssClass)("innerHtml",i.label,rb),Lo("aria-label",kl(1,3,ao(6,Xte,i),"actionButtonLabel"))}}function Kte(t,n){if(t&1&&($(0,"span",2),Ri(1,Yte,2,8,"a",3,tR),W()),t&2){let i=Ne().event;ie(),ki(i.actions)}}function Jte(t,n){if(t&1&&tt(0,Kte,3,0,"span",2),t&2){let i=n.event;nt(i.actions?0:-1)}}function Qte(t,n){}var ene=(t,n)=>({event:t,view:n}),nR=()=>({});function tne(t,n){if(t&1&&(be(0,"span",2),gs(1,"calendarEventTitle"),gs(2,"calendarA11y")),t&2){let i=n.event,l=n.view;zt("innerHTML",ig(1,2,i.title,l,i),rb),Lo("aria-hidden",kl(2,6,ms(9,nR),"hideEventTitle"))}}function nne(t,n){}var ine=(t,n,i)=>({contents:t,placement:n,event:i});function rne(t,n){if(t&1&&($(0,"div",2),be(1,"div",3)(2,"div",4),W()),t&2){let i=n.contents,l=n.placement;zt("ngClass","cal-tooltip-"+l),ie(2),zt("innerHtml",i,rb)}}function one(t,n){}var sne=(t,n)=>({days:t,locale:n}),tU=(t,n)=>n.date.toISOString();function ane(t,n){if(t&1){let i=Hn();$(0,"div",4),Ot("click",function(h){let o=Wt(i).$implicit,E=Ne(2);return Zt(E.columnHeaderClicked.emit({isoDayNumber:o.day,sourceEvent:h}))}),ne(1),gs(2,"calendarDate"),W()}if(t&2){let i=n.$implicit,l=Ne().locale;Dn("cal-past",i.isPast)("cal-today",i.isToday)("cal-future",i.isFuture)("cal-weekend",i.isWeekend),zt("ngClass",i.cssClass),ie(),nn(" ",ig(2,10,i.date,"monthViewColumnHeader",l)," ")}}function lne(t,n){if(t&1&&($(0,"div",2),Ri(1,ane,3,14,"div",3,tU),W()),t&2){let i=n.days;ie(),ki(i)}}function cne(t,n){}var une=(t,n,i,l,h,o,E,A,L,Y,le)=>({day:t,openDay:n,locale:i,tooltipPlacement:l,highlightDay:h,unhighlightDay:o,eventClicked:E,tooltipTemplate:A,tooltipAppendToBody:L,tooltipDelay:Y,validateDrag:le}),dne=(t,n)=>({day:t,locale:n}),iR=t=>({backgroundColor:t}),hne=(t,n)=>({event:t,draggedFrom:n}),nU=(t,n)=>({x:t,y:n}),iU=()=>({delay:300,delta:30});function fne(t,n){if(t&1&&($(0,"span",4),ne(1),W()),t&2){let i=Ne().day;ie(),Ln(i.badgeTotal)}}function pne(t,n){if(t&1){let i=Hn();$(0,"div",8),gs(1,"calendarEventTitle"),gs(2,"calendarA11y"),Ot("mouseenter",function(){let h=Wt(i).$implicit,o=Ne(2).highlightDay;return Zt(o.emit({event:h}))})("mouseleave",function(){let h=Wt(i).$implicit,o=Ne(2).unhighlightDay;return Zt(o.emit({event:h}))})("mwlClick",function(h){let o=Wt(i).$implicit,E=Ne(2).eventClicked;return Zt(E.emit({event:o,sourceEvent:h}))}),W()}if(t&2){let i=n.$implicit,l=Ne(2),h=l.day,o=l.tooltipPlacement,E=l.tooltipTemplate,A=l.tooltipAppendToBody,L=l.tooltipDelay,Y=l.validateDrag;Dn("cal-draggable",i.draggable),zt("ngStyle",ao(22,iR,i.color==null?null:i.color.primary))("ngClass",i==null?null:i.cssClass)("mwlCalendarTooltip",ig(1,15,i.title,"monthTooltip",i))("tooltipPlacement",o)("tooltipEvent",i)("tooltipTemplate",E)("tooltipAppendToBody",A)("tooltipDelay",L)("dropData",Su(24,hne,i,h))("dragAxis",Su(27,nU,i.draggable,i.draggable))("validateDrag",Y)("touchStartLongPress",ms(30,iU)),Lo("aria-hidden",kl(2,19,ms(31,nR),"hideMonthCellEvents"))}}function mne(t,n){if(t&1&&($(0,"div",6),Ri(1,pne,3,32,"div",7,tR),W()),t&2){let i=Ne().day;ie(),ki(i.events)}}function gne(t,n){if(t&1&&($(0,"div",2),gs(1,"calendarA11y"),$(2,"span",3),tt(3,fne,2,1,"span",4),$(4,"span",5),ne(5),gs(6,"calendarDate"),W()()(),tt(7,mne,3,0,"div",6)),t&2){let i=n.day,l=n.locale;Lo("aria-label",kl(1,4,Su(11,dne,i,l),"monthCell")),ie(3),nt(i.badgeTotal>0?3:-1),ie(2),Ln(ig(6,7,i.date,"monthViewDayNumber",l)),ie(2),nt(i.events.length>0?7:-1)}}function _ne(t,n){}var vne=(t,n,i,l)=>({events:t,eventClicked:n,isOpen:i,validateDrag:l}),Y4=(t,n)=>({date:t,locale:n}),yne=(t,n)=>({event:t,locale:n});function xne(t,n){if(t&1){let i=Hn();$(0,"div",6),be(1,"span",7),ne(2," "),$(3,"mwl-calendar-event-title",8),gs(4,"calendarA11y"),Ot("mwlClick",function(h){let o=Wt(i).$implicit,E=Ne(2).eventClicked;return Zt(E.emit({event:o,sourceEvent:h}))})("mwlKeydownEnter",function(h){let o=Wt(i).$implicit,E=Ne(2).eventClicked;return Zt(E.emit({event:o,sourceEvent:h}))}),W(),ne(5," "),be(6,"mwl-calendar-event-actions",9),W()}if(t&2){let i=n.$implicit,l=Ne(2).validateDrag,h=Ne();Dn("cal-draggable",i.draggable),zt("ngClass",i==null?null:i.cssClass)("dropData",ao(16,eU,i))("dragAxis",Su(18,nU,i.draggable,i.draggable))("validateDrag",l)("touchStartLongPress",ms(21,iU)),ie(),zt("ngStyle",ao(22,iR,i.color==null?null:i.color.primary)),ie(2),zt("event",i)("customTemplate",h.eventTitleTemplate),Lo("aria-label",kl(4,13,Su(24,yne,i,h.locale),"eventDescription")),ie(3),zt("event",i)("customTemplate",h.eventActionsTemplate)}}function bne(t,n){if(t&1&&($(0,"div",2),C0("cal-open-day-events-closing"),be(1,"span",3),gs(2,"calendarA11y"),be(3,"span",4),gs(4,"calendarA11y"),Ri(5,xne,7,27,"div",5,tR),W()),t&2){let i=Ne().events,l=Ne();ie(),Lo("aria-label",kl(2,2,Su(8,Y4,l.date,l.locale),"openDayEventsAlert")),ie(2),Lo("aria-label",kl(4,5,Su(11,Y4,l.date,l.locale),"openDayEventsLandmark")),ie(2),ki(i)}}function wne(t,n){if(t&1&&tt(0,bne,7,14,"div",2),t&2){let i=n.isOpen;nt(i?0:-1)}}function Cne(t,n){}function Ene(t,n){if(t&1){let i=Hn();$(0,"mwl-calendar-month-cell",6),gs(1,"calendarA11y"),Ot("mwlClick",function(h){let o=Wt(i).$implicit,E=Ne(2);return Zt(E.dayClicked.emit({day:o,sourceEvent:h}))})("mwlKeydownEnter",function(h){let o=Wt(i).$implicit,E=Ne(2);return Zt(E.dayClicked.emit({day:o,sourceEvent:h}))})("highlightDay",function(h){Wt(i);let o=Ne(2);return Zt(o.toggleDayHighlight(h.event,!0))})("unhighlightDay",function(h){Wt(i);let o=Ne(2);return Zt(o.toggleDayHighlight(h.event,!1))})("drop",function(h){let o=Wt(i).$implicit,E=Ne(2);return Zt(E.eventDropped(o,h.dropData.event,h.dropData.draggedFrom))})("eventClicked",function(h){Wt(i);let o=Ne(2);return Zt(o.eventClicked.emit({event:h.event,sourceEvent:h.sourceEvent}))}),W()}if(t&2){let i=n.$implicit,l=Ne(2);zt("ngClass",i==null?null:i.cssClass)("day",i)("openDay",l.openDay)("locale",l.locale)("tooltipPlacement",l.tooltipPlacement)("tooltipAppendToBody",l.tooltipAppendToBody)("tooltipTemplate",l.tooltipTemplate)("tooltipDelay",l.tooltipDelay)("customTemplate",l.cellTemplate)("ngStyle",ao(15,iR,i.backgroundColor))("clickListenerDisabled",!l.dayClicked.observed),Lo("tabindex",kl(1,12,ms(17,nR),"monthCellTabIndex"))}}function Tne(t,n){if(t&1){let i=Hn();$(0,"div")(1,"div",3),Ri(2,Ene,2,18,"mwl-calendar-month-cell",4,tU),gs(4,"slice"),W(),$(5,"mwl-calendar-open-day-events",5),Ot("eventClicked",function(h){Wt(i);let o=Ne();return Zt(o.eventClicked.emit({event:h.event,sourceEvent:h.sourceEvent}))})("drop",function(h){Wt(i);let o=Ne();return Zt(o.eventDropped(o.openDay,h.dropData.event,h.dropData.draggedFrom))}),W()()}if(t&2){let i=n.$implicit,l=Ne();ie(2),ki(ig(4,7,l.view.days,i,i+l.view.totalDaysVisibleInWeek)),ie(3),zt("locale",l.locale)("isOpen",l.openRowIndex===i)("events",l.openDay==null?null:l.openDay.events)("date",l.openDay==null?null:l.openDay.date)("customTemplate",l.openDayEventsTemplate)("eventTitleTemplate",l.eventTitleTemplate)("eventActionsTemplate",l.eventActionsTemplate)}}var vS=(()=>{let n=class n{constructor(){this.clickListenerDisabled=!1,this.click=new qi,this.destroy$=new Fn,this.renderer=ft(ia),this.elm=ft(Fo)}ngOnInit(){this.clickListenerDisabled||this.listen().pipe(tn(this.destroy$)).subscribe(l=>{l.stopPropagation(),this.click.emit(l)})}ngOnDestroy(){this.destroy$.next()}listen(){return new xi(l=>this.renderer.listen(this.elm.nativeElement,"click",h=>{l.next(h)}))}};n.\u0275fac=function(h){return new(h||n)},n.\u0275dir=Ki({type:n,selectors:[["","mwlClick",""]],inputs:{clickListenerDisabled:"clickListenerDisabled"},outputs:{click:"mwlClick"}});let t=n;return t})(),rR=(()=>{let n=class n{constructor(){this.keydown=new qi,this.keydownListener=null,this.host=ft(Fo),this.ngZone=ft(so),this.renderer=ft(ia)}ngOnInit(){this.ngZone.runOutsideAngular(()=>{this.keydownListener=this.renderer.listen(this.host.nativeElement,"keydown",l=>{(l.keyCode===13||l.which===13||l.key==="Enter")&&(l.preventDefault(),l.stopPropagation(),this.ngZone.run(()=>{this.keydown.emit(l)}))})})}ngOnDestroy(){this.keydownListener!==null&&(this.keydownListener(),this.keydownListener=null)}};n.\u0275fac=function(h){return new(h||n)},n.\u0275dir=Ki({type:n,selectors:[["","mwlKeydownEnter",""]],outputs:{keydown:"mwlKeydownEnter"}});let t=n;return t})(),mS=(()=>{let n=class n{monthCell({day:l,locale:h}){return l.badgeTotal>0?`
        ${_s(l.date,"EEEE MMMM d",h)},
        ${this.pluralizeEvents(l.badgeTotal,h)},
         click to expand
      `:`${_s(l.date,"EEEE MMMM d",h)}`}pluralizeEvents(l,h){let E=new Intl.PluralRules(h).select(l),A={zero:"no events",one:"1 event",other:`${l} events`};return A[E]??A.other}openDayEventsLandmark({date:l,locale:h}){return`
      Beginning of expanded view for ${_s(l,"EEEE MMMM dd",h)}
    `}openDayEventsAlert({date:l,locale:h}){return`${_s(l,"EEEE MMMM dd",h)} expanded`}eventDescription({event:l,locale:h}){if(l.allDay===!0)return this.allDayEventDescription({event:l,locale:h});let o=`
      ${_s(l.start,"EEEE MMMM dd",h)},
      ${l.title}, from ${_s(l.start,"hh:mm a",h)}
    `;return l.end?o+` to ${_s(l.end,"hh:mm a",h)}`:o}allDayEventDescription({event:l,locale:h}){let o=`
      ${l.title}, event spans multiple days:
      start time ${_s(l.start,"MMMM dd hh:mm a",h)}
    `;return l.end?o+`, stop time ${_s(l.end,"MMMM d hh:mm a",h)}`:o+", no stop time"}actionButtonLabel({action:l}){return l.a11yLabel}monthCellTabIndex(){return 0}hideMonthCellEvents(){return!0}hideEventTitle(){return!0}hideWeekHourSegment(){return!0}hideDayHourSegment(){return!0}};n.\u0275fac=function(h){return new(h||n)},n.\u0275prov=Qt({token:n,factory:n.\u0275fac});let t=n;return t})(),e1=(()=>{let n=class n{constructor(){this.calendarA11y=ft(mS),this.locale=ft(Du)}transform(l,h){if(l.locale=l.locale||this.locale,typeof this.calendarA11y[h]>"u"){let o=Object.getOwnPropertyNames(Object.getPrototypeOf(mS.prototype)).filter(E=>E!=="constructor");throw new Error(`${h} is not a valid a11y method. Can only be one of ${o.join(", ")}`)}return this.calendarA11y[h](l)}};n.\u0275fac=function(h){return new(h||n)},n.\u0275pipe=zh({name:"calendarA11y",type:n,pure:!0});let t=n;return t})(),Sne=(()=>{let n=class n{};n.\u0275fac=function(h){return new(h||n)},n.\u0275cmp=Ai({type:n,selectors:[["mwl-calendar-event-actions"]],inputs:{event:"event",customTemplate:"customTemplate"},decls:3,vars:4,consts:[["defaultTemplate",""],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"cal-event-actions"],["href","javascript:;","tabindex","0","role","button",1,"cal-event-action",3,"ngClass","innerHtml"],["href","javascript:;","tabindex","0","role","button",1,"cal-event-action",3,"mwlClick","mwlKeydownEnter","ngClass","innerHtml"]],template:function(h,o){if(h&1&&Bh(0,Jte,1,1,"ng-template",null,0,gp)(2,Qte,0,0,"ng-template",1),h&2){let E=Pl(1);ie(2),zt("ngTemplateOutlet",o.customTemplate||E)("ngTemplateOutletContext",ao(2,eU,o.event))}},dependencies:[vp,vS,rR,yp,e1],encapsulation:2});let t=n;return t})(),Qb=class{month(n,i){return n.title}monthTooltip(n,i){return n.title}week(n,i){return n.title}weekTooltip(n,i){return n.title}day(n,i){return n.title}dayTooltip(n,i){return n.title}},rU=(()=>{let n=class n{constructor(){this.calendarEventTitle=ft(Qb)}transform(l,h,o){return this.calendarEventTitle[h](o,l)}};n.\u0275fac=function(h){return new(h||n)},n.\u0275pipe=zh({name:"calendarEventTitle",type:n,pure:!0});let t=n;return t})(),Dne=(()=>{let n=class n{};n.\u0275fac=function(h){return new(h||n)},n.\u0275cmp=Ai({type:n,selectors:[["mwl-calendar-event-title"]],inputs:{event:"event",customTemplate:"customTemplate",view:"view"},decls:3,vars:5,consts:[["defaultTemplate",""],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"cal-event-title",3,"innerHTML"]],template:function(h,o){if(h&1&&Bh(0,tne,3,10,"ng-template",null,0,gp)(2,nne,0,0,"ng-template",1),h&2){let E=Pl(1);ie(2),zt("ngTemplateOutlet",o.customTemplate||E)("ngTemplateOutletContext",Su(2,ene,o.event,o.view))}},dependencies:[yp,rU,e1],encapsulation:2});let t=n;return t})(),Ine=(()=>{let n=class n{};n.\u0275fac=function(h){return new(h||n)},n.\u0275cmp=Ai({type:n,selectors:[["mwl-calendar-tooltip-window"]],inputs:{contents:"contents",placement:"placement",event:"event",customTemplate:"customTemplate"},decls:3,vars:6,consts:[["defaultTemplate",""],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"cal-tooltip",3,"ngClass"],[1,"cal-tooltip-arrow"],[1,"cal-tooltip-inner",3,"innerHtml"]],template:function(h,o){if(h&1&&Bh(0,rne,3,2,"ng-template",null,0,gp)(2,one,0,0,"ng-template",1),h&2){let E=Pl(1);ie(2),zt("ngTemplateOutlet",o.customTemplate||E)("ngTemplateOutletContext",DP(2,ine,o.contents,o.placement,o.event))}},dependencies:[vp,yp],encapsulation:2});let t=n;return t})(),Mne=(()=>{let n=class n{constructor(){this.placement="auto",this.delay=null,this.elementRef=ft(Fo),this.injector=ft(ba),this.viewContainerRef=ft(Oc),this.document=ft(_o),this.cancelTooltipDelay$=new Fn}ngOnChanges(l){this.tooltipRef&&(l.contents||l.customTemplate||l.event)&&(this.tooltipRef.instance.contents=this.contents,this.tooltipRef.instance.customTemplate=this.customTemplate,this.tooltipRef.instance.event=this.event,this.tooltipRef.changeDetectorRef.markForCheck(),this.contents||this.hide())}ngOnDestroy(){this.hide()}onMouseOver(){(this.delay===null?Jn("now"):j2(this.delay)).pipe(tn(this.cancelTooltipDelay$)).subscribe(()=>{this.show()})}onMouseOut(){this.hide()}show(){!this.tooltipRef&&this.contents&&(this.tooltipRef=this.viewContainerRef.createComponent(Ine,{index:0,injector:this.injector,projectableNodes:[]}),this.tooltipRef.instance.contents=this.contents,this.tooltipRef.instance.customTemplate=this.customTemplate,this.tooltipRef.instance.event=this.event,this.appendToBody&&this.document.body.appendChild(this.tooltipRef.location.nativeElement),requestAnimationFrame(()=>{this.positionTooltip()}))}hide(){this.tooltipRef&&(this.viewContainerRef.remove(this.viewContainerRef.indexOf(this.tooltipRef.hostView)),this.tooltipRef=null),this.cancelTooltipDelay$.next()}positionTooltip(l=[]){this.tooltipRef&&(this.tooltipRef.changeDetectorRef.detectChanges(),this.tooltipRef.instance.placement=UO(this.elementRef.nativeElement,this.tooltipRef.location.nativeElement.children[0],this.placement,this.appendToBody),l.indexOf(this.tooltipRef.instance.placement)===-1&&this.positionTooltip([...l,this.tooltipRef.instance.placement]))}};n.\u0275fac=function(h){return new(h||n)},n.\u0275dir=Ki({type:n,selectors:[["","mwlCalendarTooltip",""]],hostBindings:function(h,o){h&1&&Ot("mouseenter",function(){return o.onMouseOver()})("mouseleave",function(){return o.onMouseOut()})},inputs:{contents:[0,"mwlCalendarTooltip","contents"],placement:[0,"tooltipPlacement","placement"],customTemplate:[0,"tooltipTemplate","customTemplate"],event:[0,"tooltipEvent","event"],appendToBody:[0,"tooltipAppendToBody","appendToBody"],delay:[0,"tooltipDelay","delay"]},features:[wa]});let t=n;return t})(),fg=class{};var Ane=t=>j4(t,(...i)=>console.warn("angular-calendar",...i));function Pne(t,n,i,l){let h=0,o=0,E=i<0?t.subDays:t.addDays,A=n;for(;o<=Math.abs(i);){A=E(n,h);let L=t.getDay(A);l.indexOf(L)===-1&&o++,h++}return A}function One(t,n,i,l=[],h){let o=h?t.startOfDay(n):t.startOfWeek(n,{weekStartsOn:i}),E=t.endOfWeek(n,{weekStartsOn:i});for(;l.indexOf(t.getDay(o))>-1&&o<E;)o=t.addDays(o,1);if(h){let A=t.endOfDay(Pne(t,o,h-1,l));return{viewStart:o,viewEnd:A}}else{let A=E;for(;l.indexOf(t.getDay(A))>-1&&A>o;)A=t.subDays(A,1);return{viewStart:o,viewEnd:A}}}function oU({x:t,y:n}){return Math.abs(t)>1||Math.abs(n)>1}var Rne=(()=>{let n=class n{constructor(){this.dateAdapter=ft(fg)}monthViewColumnHeader({date:l,locale:h}){return _s(l,"EEEE",h)}monthViewDayNumber({date:l,locale:h}){return _s(l,"d",h)}monthViewTitle({date:l,locale:h}){return _s(l,"LLLL y",h)}weekViewColumnHeader({date:l,locale:h}){return _s(l,"EEEE",h)}weekViewColumnSubHeader({date:l,locale:h}){return _s(l,"MMM d",h)}weekViewTitle({date:l,locale:h,weekStartsOn:o,excludeDays:E,daysInWeek:A}){let{viewStart:L,viewEnd:Y}=One(this.dateAdapter,l,o,E,A),le=(te,ze)=>_s(te,"MMM d"+(ze?", yyyy":""),h);return`${le(L,L.getUTCFullYear()!==Y.getUTCFullYear())} - ${le(Y,!0)}`}weekViewHour({date:l,locale:h}){return _s(l,"h a",h)}dayViewHour({date:l,locale:h}){return _s(l,"h a",h)}dayViewTitle({date:l,locale:h}){return _s(l,"EEEE, MMMM d, y",h)}};n.\u0275fac=function(h){return new(h||n)},n.\u0275prov=Qt({token:n,factory:n.\u0275fac});let t=n;return t})(),gS=(()=>{let n=class n extends Rne{};n.\u0275fac=(()=>{let l;return function(o){return(l||(l=Ca(n)))(o||n)}})(),n.\u0275prov=Qt({token:n,factory:n.\u0275fac});let t=n;return t})(),sU=(()=>{let n=class n{constructor(){this.dateFormatter=ft(gS),this.locale=ft(Du)}transform(l,h,o=this.locale,E=0,A=[],L){if(typeof this.dateFormatter[h]>"u"){let Y=Object.getOwnPropertyNames(Object.getPrototypeOf(gS.prototype)).filter(le=>le!=="constructor");throw new Error(`${h} is not a valid date formatter. Can only be one of ${Y.join(", ")}`)}return this.dateFormatter[h]({date:l,locale:o,weekStartsOn:E,excludeDays:A,daysInWeek:L})}};n.\u0275fac=function(h){return new(h||n)},n.\u0275pipe=zh({name:"calendarDate",type:n,pure:!0});let t=n;return t})(),oR=(()=>{let n=class n{constructor(){this.dateAdapter=ft(fg)}getMonthView(l){return B4(this.dateAdapter,l)}getWeekViewHeader(l){return fS(this.dateAdapter,l)}getWeekView(l){return z4(this.dateAdapter,l)}};n.\u0275fac=function(h){return new(h||n)},n.\u0275prov=Qt({token:n,factory:n.\u0275fac});let t=n;return t})();var aU=(function(t){return t.Drag="drag",t.Drop="drop",t.Resize="resize",t})(aU||{});var _S=(()=>{let n=class n{static forRoot(l,h={}){return{ngModule:n,providers:[l,h.eventTitleFormatter||Qb,h.dateFormatter||gS,h.utils||oR,h.a11y||mS]}}};n.\u0275fac=function(h){return new(h||n)},n.\u0275mod=Qo({type:n}),n.\u0275inj=$o({});let t=n;return t})(),kne=(()=>{let n=class n{constructor(){this.columnHeaderClicked=new qi}};n.\u0275fac=function(h){return new(h||n)},n.\u0275cmp=Ai({type:n,selectors:[["mwl-calendar-month-view-header"]],inputs:{days:"days",locale:"locale",customTemplate:"customTemplate"},outputs:{columnHeaderClicked:"columnHeaderClicked"},decls:3,vars:5,consts:[["defaultTemplate",""],[3,"ngTemplateOutlet","ngTemplateOutletContext"],["role","row",1,"cal-cell-row","cal-header"],["tabindex","0","role","columnheader",1,"cal-cell",3,"cal-past","cal-today","cal-future","cal-weekend","ngClass"],["tabindex","0","role","columnheader",1,"cal-cell",3,"click","ngClass"]],template:function(h,o){if(h&1&&Bh(0,lne,3,0,"ng-template",null,0,gp)(2,cne,0,0,"ng-template",1),h&2){let E=Pl(1);ie(2),zt("ngTemplateOutlet",o.customTemplate||E)("ngTemplateOutletContext",Su(2,sne,o.days,o.locale))}},dependencies:[vp,yp,sU],encapsulation:2});let t=n;return t})(),Fne=(()=>{let n=class n{constructor(){this.highlightDay=new qi,this.unhighlightDay=new qi,this.eventClicked=new qi,this.validateDrag=oU}};n.\u0275fac=function(h){return new(h||n)},n.\u0275cmp=Ai({type:n,selectors:[["mwl-calendar-month-cell"]],hostAttrs:[1,"cal-cell","cal-day-cell"],hostVars:18,hostBindings:function(h,o){h&2&&Dn("cal-past",o.day.isPast)("cal-today",o.day.isToday)("cal-future",o.day.isFuture)("cal-weekend",o.day.isWeekend)("cal-in-month",o.day.inMonth)("cal-out-month",!o.day.inMonth)("cal-has-events",o.day.events.length>0)("cal-open",o.day===o.openDay)("cal-event-highlight",!!o.day.backgroundColor)},inputs:{day:"day",openDay:"openDay",locale:"locale",tooltipPlacement:"tooltipPlacement",tooltipAppendToBody:"tooltipAppendToBody",customTemplate:"customTemplate",tooltipTemplate:"tooltipTemplate",tooltipDelay:"tooltipDelay"},outputs:{highlightDay:"highlightDay",unhighlightDay:"unhighlightDay",eventClicked:"eventClicked"},decls:3,vars:14,consts:[["defaultTemplate",""],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"cal-cell-top"],["aria-hidden","true"],[1,"cal-day-badge"],[1,"cal-day-number"],[1,"cal-events"],["mwlDraggable","","dragActiveClass","cal-drag-active",1,"cal-event",3,"ngStyle","ngClass","mwlCalendarTooltip","tooltipPlacement","tooltipEvent","tooltipTemplate","tooltipAppendToBody","tooltipDelay","cal-draggable","dropData","dragAxis","validateDrag","touchStartLongPress"],["mwlDraggable","","dragActiveClass","cal-drag-active",1,"cal-event",3,"mouseenter","mouseleave","mwlClick","ngStyle","ngClass","mwlCalendarTooltip","tooltipPlacement","tooltipEvent","tooltipTemplate","tooltipAppendToBody","tooltipDelay","dropData","dragAxis","validateDrag","touchStartLongPress"]],template:function(h,o){if(h&1&&Bh(0,gne,8,14,"ng-template",null,0,gp)(2,_ne,0,0,"ng-template",1),h&2){let E=Pl(1);ie(2),zt("ngTemplateOutlet",o.customTemplate||E)("ngTemplateOutletContext",MP(2,une,[o.day,o.openDay,o.locale,o.tooltipPlacement,o.highlightDay,o.unhighlightDay,o.eventClicked,o.tooltipTemplate,o.tooltipAppendToBody,o.tooltipDelay,o.validateDrag]))}},dependencies:[QO,yb,vp,Mne,vS,yp,sU,rU,e1],encapsulation:2});let t=n;return t})(),Lne=(()=>{let n=class n{constructor(){this.isOpen=!1,this.eventClicked=new qi,this.validateDrag=oU}};n.\u0275fac=function(h){return new(h||n)},n.\u0275cmp=Ai({type:n,selectors:[["mwl-calendar-open-day-events"]],inputs:{locale:"locale",isOpen:"isOpen",events:"events",customTemplate:"customTemplate",eventTitleTemplate:"eventTitleTemplate",eventActionsTemplate:"eventActionsTemplate",date:"date"},outputs:{eventClicked:"eventClicked"},decls:3,vars:7,consts:[["defaultTemplate",""],[3,"ngTemplateOutlet","ngTemplateOutletContext"],["role","application",1,"cal-open-day-events"],["tabindex","-1","role","alert"],["tabindex","0","role","landmark"],["mwlDraggable","","dragActiveClass","cal-drag-active",3,"ngClass","cal-draggable","dropData","dragAxis","validateDrag","touchStartLongPress"],["mwlDraggable","","dragActiveClass","cal-drag-active",3,"ngClass","dropData","dragAxis","validateDrag","touchStartLongPress"],[1,"cal-event",3,"ngStyle"],["view","month","tabindex","0",3,"mwlClick","mwlKeydownEnter","event","customTemplate"],[3,"event","customTemplate"]],template:function(h,o){if(h&1&&Bh(0,wne,1,1,"ng-template",null,0,gp)(2,Cne,0,0,"ng-template",1),h&2){let E=Pl(1);ie(2),zt("ngTemplateOutlet",o.customTemplate||E)("ngTemplateOutletContext",IP(2,vne,o.events,o.eventClicked,o.isOpen,o.validateDrag))}},dependencies:[QO,vp,yb,Dne,vS,rR,Sne,yp,e1],encapsulation:2});let t=n;return t})(),yS=(()=>{let n=class n{constructor(){this.events=[],this.excludeDays=[],this.activeDayIsOpen=!1,this.locale=ft(Du),this.tooltipPlacement="auto",this.tooltipAppendToBody=!0,this.tooltipDelay=null,this.beforeViewRender=new qi,this.dayClicked=new qi,this.eventClicked=new qi,this.columnHeaderClicked=new qi,this.eventTimesChanged=new qi,this.cdr=ft(Md),this.utils=ft(oR),this.dateAdapter=ft(fg)}ngOnInit(){this.refresh&&(this.refreshSubscription=this.refresh.subscribe(()=>{this.refreshAll(),this.cdr.markForCheck()}))}ngOnChanges(l){let h=l.viewDate||l.excludeDays||l.weekendDays,o=l.viewDate||l.events||l.excludeDays||l.weekendDays;h&&this.refreshHeader(),l.events&&Ane(this.events),o&&this.refreshBody(),(h||o)&&this.emitBeforeViewRender(),(l.activeDayIsOpen||l.viewDate||l.events||l.excludeDays||l.activeDay)&&this.checkActiveDayIsOpen()}ngOnDestroy(){this.refreshSubscription&&this.refreshSubscription.unsubscribe()}toggleDayHighlight(l,h){this.view.days.forEach(o=>{h&&o.events.indexOf(l)>-1?o.backgroundColor=l.color&&l.color.secondary||"#D1E8FF":delete o.backgroundColor})}eventDropped(l,h,o){if(l!==o){let E=this.dateAdapter.getYear(l.date),A=this.dateAdapter.getMonth(l.date),L=this.dateAdapter.getDate(l.date),Y=this.dateAdapter.setDate(this.dateAdapter.setMonth(this.dateAdapter.setYear(h.start,E),A),L),le;if(h.end){let te=this.dateAdapter.differenceInSeconds(Y,h.start);le=this.dateAdapter.addSeconds(h.end,te)}this.eventTimesChanged.emit({event:h,newStart:Y,newEnd:le,day:l,type:aU.Drop})}}refreshHeader(){this.columnHeaders=this.utils.getWeekViewHeader({viewDate:this.viewDate,weekStartsOn:this.weekStartsOn,excluded:this.excludeDays,weekendDays:this.weekendDays})}refreshBody(){this.view=this.utils.getMonthView({events:this.events,viewDate:this.viewDate,weekStartsOn:this.weekStartsOn,excluded:this.excludeDays,weekendDays:this.weekendDays})}checkActiveDayIsOpen(){if(this.activeDayIsOpen===!0){let l=this.activeDay||this.viewDate;this.openDay=this.view.days.find(o=>this.dateAdapter.isSameDay(o.date,l));let h=this.view.days.indexOf(this.openDay);this.openRowIndex=Math.floor(h/this.view.totalDaysVisibleInWeek)*this.view.totalDaysVisibleInWeek}else this.openRowIndex=null,this.openDay=null}refreshAll(){this.refreshHeader(),this.refreshBody(),this.emitBeforeViewRender(),this.checkActiveDayIsOpen()}emitBeforeViewRender(){this.columnHeaders&&this.view&&this.beforeViewRender.emit({header:this.columnHeaders,body:this.view.days,period:this.view.period})}};n.\u0275fac=function(h){return new(h||n)},n.\u0275cmp=Ai({type:n,selectors:[["mwl-calendar-month-view"]],inputs:{viewDate:"viewDate",events:"events",excludeDays:"excludeDays",activeDayIsOpen:"activeDayIsOpen",activeDay:"activeDay",refresh:"refresh",locale:"locale",tooltipPlacement:"tooltipPlacement",tooltipTemplate:"tooltipTemplate",tooltipAppendToBody:"tooltipAppendToBody",tooltipDelay:"tooltipDelay",weekStartsOn:"weekStartsOn",headerTemplate:"headerTemplate",cellTemplate:"cellTemplate",openDayEventsTemplate:"openDayEventsTemplate",eventTitleTemplate:"eventTitleTemplate",eventActionsTemplate:"eventActionsTemplate",weekendDays:"weekendDays"},outputs:{beforeViewRender:"beforeViewRender",dayClicked:"dayClicked",eventClicked:"eventClicked",columnHeaderClicked:"columnHeaderClicked",eventTimesChanged:"eventTimesChanged"},features:[wa],decls:5,vars:3,consts:[["role","grid",1,"cal-month-view"],[3,"columnHeaderClicked","days","locale","customTemplate"],[1,"cal-days"],["role","row",1,"cal-cell-row"],["role","gridcell","mwlDroppable","","dragOverClass","cal-drag-over",3,"ngClass","day","openDay","locale","tooltipPlacement","tooltipAppendToBody","tooltipTemplate","tooltipDelay","customTemplate","ngStyle","clickListenerDisabled"],["mwlDroppable","","dragOverClass","cal-drag-over",3,"eventClicked","drop","locale","isOpen","events","date","customTemplate","eventTitleTemplate","eventActionsTemplate"],["role","gridcell","mwlDroppable","","dragOverClass","cal-drag-over",3,"mwlClick","mwlKeydownEnter","highlightDay","unhighlightDay","drop","eventClicked","ngClass","day","openDay","locale","tooltipPlacement","tooltipAppendToBody","tooltipTemplate","tooltipDelay","customTemplate","ngStyle","clickListenerDisabled"]],template:function(h,o){h&1&&($(0,"div",0)(1,"mwl-calendar-month-view-header",1),Ot("columnHeaderClicked",function(A){return o.columnHeaderClicked.emit(A)}),W(),$(2,"div",2),Ri(3,Tne,6,11,"div",null,ra),W()()),h&2&&(ie(),zt("days",o.columnHeaders)("locale",o.locale)("customTemplate",o.headerTemplate),ie(2),ki(o.view.rowOffsets))},dependencies:[kne,Fne,X4,vp,yb,vS,rR,Lne,ZP,e1],encapsulation:2});let t=n;return t})(),K4=(()=>{let n=class n{};n.\u0275fac=function(h){return new(h||n)},n.\u0275mod=Qo({type:n}),n.\u0275inj=$o({imports:[Jb,_S,Jb]});let t=n;return t})();var J4=(()=>{let n=class n{};n.\u0275fac=function(h){return new(h||n)},n.\u0275mod=Qo({type:n}),n.\u0275inj=$o({imports:[eR,Jb,_S,eR,Jb]});let t=n;return t})();var Q4=(()=>{let n=class n{};n.\u0275fac=function(h){return new(h||n)},n.\u0275mod=Qo({type:n}),n.\u0275inj=$o({});let t=n;return t})(),Q0=(()=>{let n=class n{static forRoot(l,h={}){return{ngModule:n,providers:[l,h.eventTitleFormatter||Qb,h.dateFormatter||gS,h.utils||oR,h.a11y||mS]}}};n.\u0275fac=function(h){return new(h||n)},n.\u0275mod=Qo({type:n}),n.\u0275inj=$o({imports:[_S,K4,J4,Q4,_S,K4,J4,Q4]});let t=n;return t})();var is={production:!0,apiUrl:"https://proyectofinalavanzadabackend-production.up.railway.app/api",wsUrl:"https://proyectofinalavanzadabackend-production.up.railway.app/ws",mapboxToken:"pk.eyJ1IjoicGVkcmF6YTgzMCIsImEiOiJjbWg5OTQ0MjMxY2F6MmpxNmVibG5pc2V2In0.VrZ9nEk-zYTfqaUrE2rWwg",wsReconnectDelay:5e3,wsMaxReconnectAttempts:3,defaultPageSize:10,maxImageSize:5242880,maxImages:10,httpTimeout:3e4};var As=class t{constructor(n){this.http=n}API_URL=`${is.apiUrl}/alojamientos`;crear(n){return this.http.post(this.API_URL,n)}obtenerPorId(n){return this.http.get(`${this.API_URL}/${n}`)}editar(n,i){return this.http.put(`${this.API_URL}/${n}`,i)}eliminar(n){return this.http.delete(`${this.API_URL}/${n}`)}obtenerAlojamientos(n,i=0){let l=new Ms().set("pagina",i.toString());return n.ciudad&&(l=l.set("ciudad",n.ciudad)),n.fechaEntrada&&(l=l.set("fechaEntrada",n.fechaEntrada)),n.fechaSalida&&(l=l.set("fechaSalida",n.fechaSalida)),n.huespedes&&(l=l.set("huespedes",n.huespedes.toString())),n.precioMin&&(l=l.set("precioMin",n.precioMin.toString())),n.precioMax&&(l=l.set("precioMax",n.precioMax.toString())),n.servicios&&n.servicios.length>0&&n.servicios.forEach(h=>{l=l.append("servicios",h)}),this.http.get(this.API_URL,{params:l})}sugerirAlojamientos(n){return this.http.get(`${this.API_URL}/sugerencias`,{params:{ciudad:n}})}obtenerMetricas(n){return this.http.get(`${this.API_URL}/${n}/metricas`)}obtenerReservasAlojamiento(n,i,l,h,o=0){let E=new Ms().set("pagina",o.toString());return i&&(E=E.set("estado",i)),l&&(E=E.set("fechaEntrada",l.toISOString())),h&&(E=E.set("fechaSalida",h.toISOString())),this.http.get(`${this.API_URL}/${n}/reservas`,{params:E})}obtenerResenasAlojamiento(n,i=0){let l=new Ms().set("pagina",i.toString());return this.http.get(`${this.API_URL}/${n}/resenas`,{params:l})}crearResena(n,i){return this.http.post(`${this.API_URL}/${n}/resenas`,i)}responderResena(n,i,l){return this.http.post(`${this.API_URL}/${n}/resenas/${i}/respuesta`,l)}formatearPrecio(n){return n.toLocaleString("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0})}generarEstrellas(n){return Array(Math.floor(n)).fill(0)}static \u0275fac=function(i){return new(i||t)(gn(aa))};static \u0275prov=Qt({token:t,factory:t.\u0275fac,providedIn:"root"})};var Nne=t=>["/alojamiento",t];function zne(t,n){t&1&&be(0,"i",9)}var ev=class t{constructor(n){this.alojamientoService=n}alojamiento;generarEstrellas(){return this.alojamientoService.generarEstrellas(this.alojamiento.promedioCalificaciones)}static \u0275fac=function(i){return new(i||t)(wt(As))};static \u0275cmp=Ai({type:t,selectors:[["app-alojamiento-item"]],inputs:{alojamiento:"alojamiento"},decls:21,vars:9,consts:[[1,"accommodation-card",3,"routerLink"],[1,"card-image"],["loading","lazy",3,"src","alt"],[1,"card-info"],[1,"card-header"],[1,"location"],[1,"fa-solid","fa-location-dot"],[1,"card-footer"],[1,"rating"],[1,"fa-solid","fa-star"],[1,"rating-number"],[1,"price"],[1,"price-period"]],template:function(i,l){i&1&&($(0,"a",0)(1,"div",1),be(2,"img",2),W(),$(3,"div",3)(4,"div",4)(5,"h3"),ne(6),W(),$(7,"p",5),be(8,"i",6),ne(9),W()(),$(10,"div",7)(11,"div",8),Ri(12,zne,1,0,"i",9,ng),$(14,"span",10),ne(15),W()(),$(16,"p",11)(17,"strong"),ne(18),W(),$(19,"span",12),ne(20,"/ noche"),W()()()()()),i&2&&(zt("routerLink",ao(7,Nne,l.alojamiento.id)),ie(2),zt("src",l.alojamiento.imagenPrincipal,zr)("alt",l.alojamiento.titulo),ie(4),Ln(l.alojamiento.titulo),ie(3),nn(" ",l.alojamiento.direccion.ciudad," "),ie(3),ki(l.generarEstrellas()),ie(3),nn(" ",l.alojamiento.promedioCalificaciones," "),ie(3),Ln(l.alojamientoService.formatearPrecio(l.alojamiento.precioPorNoche)))},dependencies:[Mr,ns],styles:[".accommodation-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;transition:transform .3s ease,box-shadow .3s ease}.card-image[_ngcontent-%COMP%]{position:relative;width:100%;height:220px;overflow:hidden;border-radius:20px 20px 0 0}.card-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;transition:transform .4s ease}.accommodation-card[_ngcontent-%COMP%]:hover   .card-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{transform:scale(1.08)}.card-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;padding:1.5rem;gap:1rem}.card-header[_ngcontent-%COMP%]{flex:1}.card-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.15rem;font-weight:600;margin-bottom:.5rem;color:var(--dark-green);line-height:1.4;min-height:2.8rem;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}.card-header[_ngcontent-%COMP%]   .location[_ngcontent-%COMP%]{font-size:.9rem;color:#7f8c8d;display:flex;align-items:center;gap:6px;margin:0}.card-header[_ngcontent-%COMP%]   .location[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--primary-color)}.card-footer[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding-top:1rem;border-top:2px solid var(--light-green)}.rating[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px}.rating[_ngcontent-%COMP%]   .fa-star[_ngcontent-%COMP%]{font-size:.85rem;color:#f39c12}.rating-number[_ngcontent-%COMP%]{margin-left:6px;font-weight:600;color:var(--text-color);font-size:.95rem}.price[_ngcontent-%COMP%]{text-align:right;margin:0}.price[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:1.1rem;color:var(--primary-color);font-weight:700;display:block}.price-period[_ngcontent-%COMP%]{font-size:.85rem;color:#7f8c8d;font-weight:400}@media (max-width: 768px){.card-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.05rem;min-height:2.5rem}.card-footer[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:.8rem}.price[_ngcontent-%COMP%]{text-align:left;width:100%}}"]})};var vU=(()=>{class t{_renderer;_elementRef;onChange=i=>{};onTouched=()=>{};constructor(i,l){this._renderer=i,this._elementRef=l}setProperty(i,l){this._renderer.setProperty(this._elementRef.nativeElement,i,l)}registerOnTouched(i){this.onTouched=i}registerOnChange(i){this.onChange=i}setDisabledState(i){this.setProperty("disabled",i)}static \u0275fac=function(l){return new(l||t)(wt(ia),wt(Fo))};static \u0275dir=Ki({type:t})}return t})(),a1=(()=>{class t extends vU{static \u0275fac=(()=>{let i;return function(h){return(i||(i=Ca(t)))(h||t)}})();static \u0275dir=Ki({type:t,features:[fs]})}return t})(),mg=new Sn(""),Bne={provide:mg,useExisting:Hs(()=>l1),multi:!0},l1=(()=>{class t extends a1{writeValue(i){this.setProperty("checked",i)}static \u0275fac=(()=>{let i;return function(h){return(i||(i=Ca(t)))(h||t)}})();static \u0275dir=Ki({type:t,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(l,h){l&1&&Ot("change",function(E){return h.onChange(E.target.checked)})("blur",function(){return h.onTouched()})},standalone:!1,features:[Va([Bne]),fs]})}return t})(),jne={provide:mg,useExisting:Hs(()=>Ps),multi:!0};function Vne(){let t=Rc()?Rc().getUserAgent():"";return/android (\d+)/.test(t.toLowerCase())}var Une=new Sn(""),Ps=(()=>{class t extends vU{_compositionMode;_composing=!1;constructor(i,l,h){super(i,l),this._compositionMode=h,this._compositionMode==null&&(this._compositionMode=!Vne())}writeValue(i){let l=i??"";this.setProperty("value",l)}_handleInput(i){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(i)}_compositionStart(){this._composing=!0}_compositionEnd(i){this._composing=!1,this._compositionMode&&this.onChange(i)}static \u0275fac=function(l){return new(l||t)(wt(ia),wt(Fo),wt(Une,8))};static \u0275dir=Ki({type:t,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(l,h){l&1&&Ot("input",function(E){return h._handleInput(E.target.value)})("blur",function(){return h.onTouched()})("compositionstart",function(){return h._compositionStart()})("compositionend",function(E){return h._compositionEnd(E.target.value)})},standalone:!1,features:[Va([jne]),fs]})}return t})();function dR(t){return t==null||hR(t)===0}function hR(t){return t==null?null:Array.isArray(t)||typeof t=="string"?t.length:t instanceof Set?t.size:null}var Gh=new Sn(""),c1=new Sn(""),Hne=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,Pn=class{static min(n){return yU(n)}static max(n){return xU(n)}static required(n){return bU(n)}static requiredTrue(n){return $ne(n)}static email(n){return Gne(n)}static minLength(n){return qne(n)}static maxLength(n){return wU(n)}static pattern(n){return Wne(n)}static nullValidator(n){return bS()}static compose(n){return IU(n)}static composeAsync(n){return AU(n)}};function yU(t){return n=>{if(n.value==null||t==null)return null;let i=parseFloat(n.value);return!isNaN(i)&&i<t?{min:{min:t,actual:n.value}}:null}}function xU(t){return n=>{if(n.value==null||t==null)return null;let i=parseFloat(n.value);return!isNaN(i)&&i>t?{max:{max:t,actual:n.value}}:null}}function bU(t){return dR(t.value)?{required:!0}:null}function $ne(t){return t.value===!0?null:{required:!0}}function Gne(t){return dR(t.value)||Hne.test(t.value)?null:{email:!0}}function qne(t){return n=>{let i=n.value?.length??hR(n.value);return i===null||i===0?null:i<t?{minlength:{requiredLength:t,actualLength:i}}:null}}function wU(t){return n=>{let i=n.value?.length??hR(n.value);return i!==null&&i>t?{maxlength:{requiredLength:t,actualLength:i}}:null}}function Wne(t){if(!t)return bS;let n,i;return typeof t=="string"?(i="",t.charAt(0)!=="^"&&(i+="^"),i+=t,t.charAt(t.length-1)!=="$"&&(i+="$"),n=new RegExp(i)):(i=t.toString(),n=t),l=>{if(dR(l.value))return null;let h=l.value;return n.test(h)?null:{pattern:{requiredPattern:i,actualValue:h}}}}function bS(t){return null}function CU(t){return t!=null}function EU(t){return pp(t)?Co(t):t}function TU(t){let n={};return t.forEach(i=>{n=i!=null?Jt(Jt({},n),i):n}),Object.keys(n).length===0?null:n}function SU(t,n){return n.map(i=>i(t))}function Zne(t){return!t.validate}function DU(t){return t.map(n=>Zne(n)?n:i=>n.validate(i))}function IU(t){if(!t)return null;let n=t.filter(CU);return n.length==0?null:function(i){return TU(SU(i,n))}}function MU(t){return t!=null?IU(DU(t)):null}function AU(t){if(!t)return null;let n=t.filter(CU);return n.length==0?null:function(i){let l=SU(i,n).map(EU);return yd(l).pipe(di(TU))}}function PU(t){return t!=null?AU(DU(t)):null}function cU(t,n){return t===null?[n]:Array.isArray(t)?[...t,n]:[t,n]}function OU(t){return t._rawValidators}function RU(t){return t._rawAsyncValidators}function sR(t){return t?Array.isArray(t)?t:[t]:[]}function wS(t,n){return Array.isArray(t)?t.includes(n):t===n}function uU(t,n){let i=sR(n);return sR(t).forEach(h=>{wS(i,h)||i.push(h)}),i}function dU(t,n){return sR(n).filter(i=>!wS(t,i))}var CS=class{get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators=[];_rawAsyncValidators=[];_setValidators(n){this._rawValidators=n||[],this._composedValidatorFn=MU(this._rawValidators)}_setAsyncValidators(n){this._rawAsyncValidators=n||[],this._composedAsyncValidatorFn=PU(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_onDestroyCallbacks=[];_registerOnDestroy(n){this._onDestroyCallbacks.push(n)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(n=>n()),this._onDestroyCallbacks=[]}reset(n=void 0){this.control&&this.control.reset(n)}hasError(n,i){return this.control?this.control.hasError(n,i):!1}getError(n,i){return this.control?this.control.getError(n,i):null}},cc=class extends CS{name;get formDirective(){return null}get path(){return null}},pg=class extends CS{_parent=null;name=null;valueAccessor=null},ES=class{_cd;constructor(n){this._cd=n}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}},Xne={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},uDe=Mi(Jt({},Xne),{"[class.ng-submitted]":"isSubmitted"}),ca=(()=>{class t extends ES{constructor(i){super(i)}static \u0275fac=function(l){return new(l||t)(wt(pg,2))};static \u0275dir=Ki({type:t,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(l,h){l&2&&Dn("ng-untouched",h.isUntouched)("ng-touched",h.isTouched)("ng-pristine",h.isPristine)("ng-dirty",h.isDirty)("ng-valid",h.isValid)("ng-invalid",h.isInvalid)("ng-pending",h.isPending)},standalone:!1,features:[fs]})}return t})(),kd=(()=>{class t extends ES{constructor(i){super(i)}static \u0275fac=function(l){return new(l||t)(wt(cc,10))};static \u0275dir=Ki({type:t,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(l,h){l&2&&Dn("ng-untouched",h.isUntouched)("ng-touched",h.isTouched)("ng-pristine",h.isPristine)("ng-dirty",h.isDirty)("ng-valid",h.isValid)("ng-invalid",h.isInvalid)("ng-pending",h.isPending)("ng-submitted",h.isSubmitted)},standalone:!1,features:[fs]})}return t})();var t1="VALID",xS="INVALID",tv="PENDING",n1="DISABLED",Mp=class{},TS=class extends Mp{value;source;constructor(n,i){super(),this.value=n,this.source=i}},i1=class extends Mp{pristine;source;constructor(n,i){super(),this.pristine=n,this.source=i}},r1=class extends Mp{touched;source;constructor(n,i){super(),this.touched=n,this.source=i}},nv=class extends Mp{status;source;constructor(n,i){super(),this.status=n,this.source=i}},aR=class extends Mp{source;constructor(n){super(),this.source=n}},s1=class extends Mp{source;constructor(n){super(),this.source=n}};function fR(t){return(IS(t)?t.validators:t)||null}function Yne(t){return Array.isArray(t)?MU(t):t||null}function pR(t,n){return(IS(n)?n.asyncValidators:t)||null}function Kne(t){return Array.isArray(t)?PU(t):t||null}function IS(t){return t!=null&&!Array.isArray(t)&&typeof t=="object"}function kU(t,n,i){let l=t.controls;if(!(n?Object.keys(l):l).length)throw new bn(1e3,"");if(!l[i])throw new bn(1001,"")}function FU(t,n,i){t._forEachChild((l,h)=>{if(i[h]===void 0)throw new bn(1002,"")})}var iv=class{_pendingDirty=!1;_hasOwnPendingAsyncValidator=null;_pendingTouched=!1;_onCollectionChange=()=>{};_updateOn;_parent=null;_asyncValidationSubscription;_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators;_rawAsyncValidators;value;constructor(n,i){this._assignValidators(n),this._assignAsyncValidators(i)}get validator(){return this._composedValidatorFn}set validator(n){this._rawValidators=this._composedValidatorFn=n}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(n){this._rawAsyncValidators=this._composedAsyncValidatorFn=n}get parent(){return this._parent}get status(){return oa(this.statusReactive)}set status(n){oa(()=>this.statusReactive.set(n))}_status=k0(()=>this.statusReactive());statusReactive=tc(void 0);get valid(){return this.status===t1}get invalid(){return this.status===xS}get pending(){return this.status==tv}get disabled(){return this.status===n1}get enabled(){return this.status!==n1}errors;get pristine(){return oa(this.pristineReactive)}set pristine(n){oa(()=>this.pristineReactive.set(n))}_pristine=k0(()=>this.pristineReactive());pristineReactive=tc(!0);get dirty(){return!this.pristine}get touched(){return oa(this.touchedReactive)}set touched(n){oa(()=>this.touchedReactive.set(n))}_touched=k0(()=>this.touchedReactive());touchedReactive=tc(!1);get untouched(){return!this.touched}_events=new Fn;events=this._events.asObservable();valueChanges;statusChanges;get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(n){this._assignValidators(n)}setAsyncValidators(n){this._assignAsyncValidators(n)}addValidators(n){this.setValidators(uU(n,this._rawValidators))}addAsyncValidators(n){this.setAsyncValidators(uU(n,this._rawAsyncValidators))}removeValidators(n){this.setValidators(dU(n,this._rawValidators))}removeAsyncValidators(n){this.setAsyncValidators(dU(n,this._rawAsyncValidators))}hasValidator(n){return wS(this._rawValidators,n)}hasAsyncValidator(n){return wS(this._rawAsyncValidators,n)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(n={}){let i=this.touched===!1;this.touched=!0;let l=n.sourceControl??this;this._parent&&!n.onlySelf&&this._parent.markAsTouched(Mi(Jt({},n),{sourceControl:l})),i&&n.emitEvent!==!1&&this._events.next(new r1(!0,l))}markAllAsDirty(n={}){this.markAsDirty({onlySelf:!0,emitEvent:n.emitEvent,sourceControl:this}),this._forEachChild(i=>i.markAllAsDirty(n))}markAllAsTouched(n={}){this.markAsTouched({onlySelf:!0,emitEvent:n.emitEvent,sourceControl:this}),this._forEachChild(i=>i.markAllAsTouched(n))}markAsUntouched(n={}){let i=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let l=n.sourceControl??this;this._forEachChild(h=>{h.markAsUntouched({onlySelf:!0,emitEvent:n.emitEvent,sourceControl:l})}),this._parent&&!n.onlySelf&&this._parent._updateTouched(n,l),i&&n.emitEvent!==!1&&this._events.next(new r1(!1,l))}markAsDirty(n={}){let i=this.pristine===!0;this.pristine=!1;let l=n.sourceControl??this;this._parent&&!n.onlySelf&&this._parent.markAsDirty(Mi(Jt({},n),{sourceControl:l})),i&&n.emitEvent!==!1&&this._events.next(new i1(!1,l))}markAsPristine(n={}){let i=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let l=n.sourceControl??this;this._forEachChild(h=>{h.markAsPristine({onlySelf:!0,emitEvent:n.emitEvent})}),this._parent&&!n.onlySelf&&this._parent._updatePristine(n,l),i&&n.emitEvent!==!1&&this._events.next(new i1(!0,l))}markAsPending(n={}){this.status=tv;let i=n.sourceControl??this;n.emitEvent!==!1&&(this._events.next(new nv(this.status,i)),this.statusChanges.emit(this.status)),this._parent&&!n.onlySelf&&this._parent.markAsPending(Mi(Jt({},n),{sourceControl:i}))}disable(n={}){let i=this._parentMarkedDirty(n.onlySelf);this.status=n1,this.errors=null,this._forEachChild(h=>{h.disable(Mi(Jt({},n),{onlySelf:!0}))}),this._updateValue();let l=n.sourceControl??this;n.emitEvent!==!1&&(this._events.next(new TS(this.value,l)),this._events.next(new nv(this.status,l)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Mi(Jt({},n),{skipPristineCheck:i}),this),this._onDisabledChange.forEach(h=>h(!0))}enable(n={}){let i=this._parentMarkedDirty(n.onlySelf);this.status=t1,this._forEachChild(l=>{l.enable(Mi(Jt({},n),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent}),this._updateAncestors(Mi(Jt({},n),{skipPristineCheck:i}),this),this._onDisabledChange.forEach(l=>l(!1))}_updateAncestors(n,i){this._parent&&!n.onlySelf&&(this._parent.updateValueAndValidity(n),n.skipPristineCheck||this._parent._updatePristine({},i),this._parent._updateTouched({},i))}setParent(n){this._parent=n}getRawValue(){return this.value}updateValueAndValidity(n={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let l=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===t1||this.status===tv)&&this._runAsyncValidator(l,n.emitEvent)}let i=n.sourceControl??this;n.emitEvent!==!1&&(this._events.next(new TS(this.value,i)),this._events.next(new nv(this.status,i)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!n.onlySelf&&this._parent.updateValueAndValidity(Mi(Jt({},n),{sourceControl:i}))}_updateTreeValidity(n={emitEvent:!0}){this._forEachChild(i=>i._updateTreeValidity(n)),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?n1:t1}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(n,i){if(this.asyncValidator){this.status=tv,this._hasOwnPendingAsyncValidator={emitEvent:i!==!1,shouldHaveEmitted:n!==!1};let l=EU(this.asyncValidator(this));this._asyncValidationSubscription=l.subscribe(h=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(h,{emitEvent:i,shouldHaveEmitted:n})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let n=(this._hasOwnPendingAsyncValidator?.emitEvent||this._hasOwnPendingAsyncValidator?.shouldHaveEmitted)??!1;return this._hasOwnPendingAsyncValidator=null,n}return!1}setErrors(n,i={}){this.errors=n,this._updateControlsErrors(i.emitEvent!==!1,this,i.shouldHaveEmitted)}get(n){let i=n;return i==null||(Array.isArray(i)||(i=i.split(".")),i.length===0)?null:i.reduce((l,h)=>l&&l._find(h),this)}getError(n,i){let l=i?this.get(i):this;return l&&l.errors?l.errors[n]:null}hasError(n,i){return!!this.getError(n,i)}get root(){let n=this;for(;n._parent;)n=n._parent;return n}_updateControlsErrors(n,i,l){this.status=this._calculateStatus(),n&&this.statusChanges.emit(this.status),(n||l)&&this._events.next(new nv(this.status,i)),this._parent&&this._parent._updateControlsErrors(n,i,l)}_initObservables(){this.valueChanges=new qi,this.statusChanges=new qi}_calculateStatus(){return this._allControlsDisabled()?n1:this.errors?xS:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(tv)?tv:this._anyControlsHaveStatus(xS)?xS:t1}_anyControlsHaveStatus(n){return this._anyControls(i=>i.status===n)}_anyControlsDirty(){return this._anyControls(n=>n.dirty)}_anyControlsTouched(){return this._anyControls(n=>n.touched)}_updatePristine(n,i){let l=!this._anyControlsDirty(),h=this.pristine!==l;this.pristine=l,this._parent&&!n.onlySelf&&this._parent._updatePristine(n,i),h&&this._events.next(new i1(this.pristine,i))}_updateTouched(n={},i){this.touched=this._anyControlsTouched(),this._events.next(new r1(this.touched,i)),this._parent&&!n.onlySelf&&this._parent._updateTouched(n,i)}_onDisabledChange=[];_registerOnCollectionChange(n){this._onCollectionChange=n}_setUpdateStrategy(n){IS(n)&&n.updateOn!=null&&(this._updateOn=n.updateOn)}_parentMarkedDirty(n){let i=this._parent&&this._parent.dirty;return!n&&!!i&&!this._parent._anyControlsDirty()}_find(n){return null}_assignValidators(n){this._rawValidators=Array.isArray(n)?n.slice():n,this._composedValidatorFn=Yne(this._rawValidators)}_assignAsyncValidators(n){this._rawAsyncValidators=Array.isArray(n)?n.slice():n,this._composedAsyncValidatorFn=Kne(this._rawAsyncValidators)}},rv=class extends iv{constructor(n,i,l){super(fR(i),pR(l,i)),this.controls=n,this._initObservables(),this._setUpdateStrategy(i),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}controls;registerControl(n,i){return this.controls[n]?this.controls[n]:(this.controls[n]=i,i.setParent(this),i._registerOnCollectionChange(this._onCollectionChange),i)}addControl(n,i,l={}){this.registerControl(n,i),this.updateValueAndValidity({emitEvent:l.emitEvent}),this._onCollectionChange()}removeControl(n,i={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}setControl(n,i,l={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],i&&this.registerControl(n,i),this.updateValueAndValidity({emitEvent:l.emitEvent}),this._onCollectionChange()}contains(n){return this.controls.hasOwnProperty(n)&&this.controls[n].enabled}setValue(n,i={}){FU(this,!0,n),Object.keys(n).forEach(l=>{kU(this,!0,l),this.controls[l].setValue(n[l],{onlySelf:!0,emitEvent:i.emitEvent})}),this.updateValueAndValidity(i)}patchValue(n,i={}){n!=null&&(Object.keys(n).forEach(l=>{let h=this.controls[l];h&&h.patchValue(n[l],{onlySelf:!0,emitEvent:i.emitEvent})}),this.updateValueAndValidity(i))}reset(n={},i={}){this._forEachChild((l,h)=>{l.reset(n?n[h]:null,{onlySelf:!0,emitEvent:i.emitEvent})}),this._updatePristine(i,this),this._updateTouched(i,this),this.updateValueAndValidity(i),i?.emitEvent!==!1&&this._events.next(new s1(this))}getRawValue(){return this._reduceChildren({},(n,i,l)=>(n[l]=i.getRawValue(),n))}_syncPendingControls(){let n=this._reduceChildren(!1,(i,l)=>l._syncPendingControls()?!0:i);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){Object.keys(this.controls).forEach(i=>{let l=this.controls[i];l&&n(l,i)})}_setUpControls(){this._forEachChild(n=>{n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(n){for(let[i,l]of Object.entries(this.controls))if(this.contains(i)&&n(l))return!0;return!1}_reduceValue(){let n={};return this._reduceChildren(n,(i,l,h)=>((l.enabled||this.disabled)&&(i[h]=l.value),i))}_reduceChildren(n,i){let l=n;return this._forEachChild((h,o)=>{l=i(l,h,o)}),l}_allControlsDisabled(){for(let n of Object.keys(this.controls))if(this.controls[n].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(n){return this.controls.hasOwnProperty(n)?this.controls[n]:null}};var lR=class extends rv{};var MS=new Sn("",{providedIn:"root",factory:()=>AS}),AS="always";function PS(t,n){return[...n.path,t]}function cR(t,n,i=AS){mR(t,n),n.valueAccessor.writeValue(t.value),(t.disabled||i==="always")&&n.valueAccessor.setDisabledState?.(t.disabled),Qne(t,n),tie(t,n),eie(t,n),Jne(t,n)}function hU(t,n,i=!0){let l=()=>{};n.valueAccessor&&(n.valueAccessor.registerOnChange(l),n.valueAccessor.registerOnTouched(l)),DS(t,n),t&&(n._invokeOnDestroyCallbacks(),t._registerOnCollectionChange(()=>{}))}function SS(t,n){t.forEach(i=>{i.registerOnValidatorChange&&i.registerOnValidatorChange(n)})}function Jne(t,n){if(n.valueAccessor.setDisabledState){let i=l=>{n.valueAccessor.setDisabledState(l)};t.registerOnDisabledChange(i),n._registerOnDestroy(()=>{t._unregisterOnDisabledChange(i)})}}function mR(t,n){let i=OU(t);n.validator!==null?t.setValidators(cU(i,n.validator)):typeof i=="function"&&t.setValidators([i]);let l=RU(t);n.asyncValidator!==null?t.setAsyncValidators(cU(l,n.asyncValidator)):typeof l=="function"&&t.setAsyncValidators([l]);let h=()=>t.updateValueAndValidity();SS(n._rawValidators,h),SS(n._rawAsyncValidators,h)}function DS(t,n){let i=!1;if(t!==null){if(n.validator!==null){let h=OU(t);if(Array.isArray(h)&&h.length>0){let o=h.filter(E=>E!==n.validator);o.length!==h.length&&(i=!0,t.setValidators(o))}}if(n.asyncValidator!==null){let h=RU(t);if(Array.isArray(h)&&h.length>0){let o=h.filter(E=>E!==n.asyncValidator);o.length!==h.length&&(i=!0,t.setAsyncValidators(o))}}}let l=()=>{};return SS(n._rawValidators,l),SS(n._rawAsyncValidators,l),i}function Qne(t,n){n.valueAccessor.registerOnChange(i=>{t._pendingValue=i,t._pendingChange=!0,t._pendingDirty=!0,t.updateOn==="change"&&LU(t,n)})}function eie(t,n){n.valueAccessor.registerOnTouched(()=>{t._pendingTouched=!0,t.updateOn==="blur"&&t._pendingChange&&LU(t,n),t.updateOn!=="submit"&&t.markAsTouched()})}function LU(t,n){t._pendingDirty&&t.markAsDirty(),t.setValue(t._pendingValue,{emitModelToViewChange:!1}),n.viewToModelUpdate(t._pendingValue),t._pendingChange=!1}function tie(t,n){let i=(l,h)=>{n.valueAccessor.writeValue(l),h&&n.viewToModelUpdate(l)};t.registerOnChange(i),n._registerOnDestroy(()=>{t._unregisterOnChange(i)})}function nie(t,n){t==null,mR(t,n)}function iie(t,n){return DS(t,n)}function NU(t,n){if(!t.hasOwnProperty("model"))return!1;let i=t.model;return i.isFirstChange()?!0:!Object.is(n,i.currentValue)}function rie(t){return Object.getPrototypeOf(t.constructor)===a1}function oie(t,n){t._syncPendingControls(),n.forEach(i=>{let l=i.control;l.updateOn==="submit"&&l._pendingChange&&(i.viewToModelUpdate(l._pendingValue),l._pendingChange=!1)})}function zU(t,n){if(!n)return null;Array.isArray(n);let i,l,h;return n.forEach(o=>{o.constructor===Ps?i=o:rie(o)?l=o:h=o}),h||l||i||null}function sie(t,n){let i=t.indexOf(n);i>-1&&t.splice(i,1)}function fU(t,n){let i=t.indexOf(n);i>-1&&t.splice(i,1)}function pU(t){return typeof t=="object"&&t!==null&&Object.keys(t).length===2&&"value"in t&&"disabled"in t}var o1=class extends iv{defaultValue=null;_onChange=[];_pendingValue;_pendingChange=!1;constructor(n=null,i,l){super(fR(i),pR(l,i)),this._applyFormState(n),this._setUpdateStrategy(i),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),IS(i)&&(i.nonNullable||i.initialValueIsDefault)&&(pU(n)?this.defaultValue=n.value:this.defaultValue=n)}setValue(n,i={}){this.value=this._pendingValue=n,this._onChange.length&&i.emitModelToViewChange!==!1&&this._onChange.forEach(l=>l(this.value,i.emitViewToModelChange!==!1)),this.updateValueAndValidity(i)}patchValue(n,i={}){this.setValue(n,i)}reset(n=this.defaultValue,i={}){this._applyFormState(n),this.markAsPristine(i),this.markAsUntouched(i),this.setValue(this.value,i),this._pendingChange=!1,i?.emitEvent!==!1&&this._events.next(new s1(this))}_updateValue(){}_anyControls(n){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(n){this._onChange.push(n)}_unregisterOnChange(n){fU(this._onChange,n)}registerOnDisabledChange(n){this._onDisabledChange.push(n)}_unregisterOnDisabledChange(n){fU(this._onDisabledChange,n)}_forEachChild(n){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(n){pU(n)?(this.value=this._pendingValue=n.value,n.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=n}};var aie=t=>t instanceof o1,lie=(()=>{class t extends cc{_parent;ngOnInit(){this._checkParentType(),this.formDirective.addFormGroup(this)}ngOnDestroy(){this.formDirective&&this.formDirective.removeFormGroup(this)}get control(){return this.formDirective.getFormGroup(this)}get path(){return PS(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}static \u0275fac=(()=>{let i;return function(h){return(i||(i=Ca(t)))(h||t)}})();static \u0275dir=Ki({type:t,standalone:!1,features:[fs]})}return t})();var cie={provide:pg,useExisting:Hs(()=>qh)},mU=Promise.resolve(),qh=(()=>{class t extends pg{_changeDetectorRef;callSetDisabledState;control=new o1;static ngAcceptInputType_isDisabled;_registered=!1;viewModel;name="";isDisabled;model;options;update=new qi;constructor(i,l,h,o,E,A){super(),this._changeDetectorRef=E,this.callSetDisabledState=A,this._parent=i,this._setValidators(l),this._setAsyncValidators(h),this.valueAccessor=zU(this,o)}ngOnChanges(i){if(this._checkForErrors(),!this._registered||"name"in i){if(this._registered&&(this._checkName(),this.formDirective)){let l=i.name.previousValue;this.formDirective.removeControl({name:l,path:this._getPath(l)})}this._setUpControl()}"isDisabled"in i&&this._updateDisabled(i),NU(i,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(i){this.viewModel=i,this.update.emit(i)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){cR(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._checkName()}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(i){mU.then(()=>{this.control.setValue(i,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(i){let l=i.isDisabled.currentValue,h=l!==0&&_p(l);mU.then(()=>{h&&!this.control.disabled?this.control.disable():!h&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(i){return this._parent?PS(i,this._parent):[i]}static \u0275fac=function(l){return new(l||t)(wt(cc,9),wt(Gh,10),wt(c1,10),wt(mg,10),wt(Md,8),wt(MS,8))};static \u0275dir=Ki({type:t,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],standalone:!1,features:[Va([cie]),fs,wa]})}return t})();var Fd=(()=>{class t{static \u0275fac=function(l){return new(l||t)};static \u0275dir=Ki({type:t,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""],standalone:!1})}return t})(),uie={provide:mg,useExisting:Hs(()=>Wh),multi:!0},Wh=(()=>{class t extends a1{writeValue(i){let l=i??"";this.setProperty("value",l)}registerOnChange(i){this.onChange=l=>{i(l==""?null:parseFloat(l))}}static \u0275fac=(()=>{let i;return function(h){return(i||(i=Ca(t)))(h||t)}})();static \u0275dir=Ki({type:t,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(l,h){l&1&&Ot("input",function(E){return h.onChange(E.target.value)})("blur",function(){return h.onTouched()})},standalone:!1,features:[Va([uie]),fs]})}return t})();var BU=new Sn("");var die={provide:cc,useExisting:Hs(()=>Lc)},Lc=(()=>{class t extends cc{callSetDisabledState;get submitted(){return oa(this._submittedReactive)}set submitted(i){this._submittedReactive.set(i)}_submitted=k0(()=>this._submittedReactive());_submittedReactive=tc(!1);_oldForm;_onCollectionChange=()=>this._updateDomValue();directives=[];form=null;ngSubmit=new qi;constructor(i,l,h){super(),this.callSetDisabledState=h,this._setValidators(i),this._setAsyncValidators(l)}ngOnChanges(i){i.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(DS(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(i){let l=this.form.get(i.path);return cR(l,i,this.callSetDisabledState),l.updateValueAndValidity({emitEvent:!1}),this.directives.push(i),l}getControl(i){return this.form.get(i.path)}removeControl(i){hU(i.control||null,i,!1),sie(this.directives,i)}addFormGroup(i){this._setUpFormContainer(i)}removeFormGroup(i){this._cleanUpFormContainer(i)}getFormGroup(i){return this.form.get(i.path)}addFormArray(i){this._setUpFormContainer(i)}removeFormArray(i){this._cleanUpFormContainer(i)}getFormArray(i){return this.form.get(i.path)}updateModel(i,l){this.form.get(i.path).setValue(l)}onSubmit(i){return this._submittedReactive.set(!0),oie(this.form,this.directives),this.ngSubmit.emit(i),this.form._events.next(new aR(this.control)),i?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(i=void 0,l={}){this.form.reset(i,l),this._submittedReactive.set(!1)}_updateDomValue(){this.directives.forEach(i=>{let l=i.control,h=this.form.get(i.path);l!==h&&(hU(l||null,i),aie(h)&&(cR(h,i,this.callSetDisabledState),i.control=h))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(i){let l=this.form.get(i.path);nie(l,i),l.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(i){if(this.form){let l=this.form.get(i.path);l&&iie(l,i)&&l.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){mR(this.form,this),this._oldForm&&DS(this._oldForm,this)}static \u0275fac=function(l){return new(l||t)(wt(Gh,10),wt(c1,10),wt(MS,8))};static \u0275dir=Ki({type:t,selectors:[["","formGroup",""]],hostBindings:function(l,h){l&1&&Ot("submit",function(E){return h.onSubmit(E)})("reset",function(){return h.onReset()})},inputs:{form:[0,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],standalone:!1,features:[Va([die]),fs,wa]})}return t})(),hie={provide:cc,useExisting:Hs(()=>jU)},jU=(()=>{class t extends lie{name=null;constructor(i,l,h){super(),this._parent=i,this._setValidators(l),this._setAsyncValidators(h)}_checkParentType(){VU(this._parent)}static \u0275fac=function(l){return new(l||t)(wt(cc,13),wt(Gh,10),wt(c1,10))};static \u0275dir=Ki({type:t,selectors:[["","formGroupName",""]],inputs:{name:[0,"formGroupName","name"]},standalone:!1,features:[Va([hie]),fs]})}return t})(),fie={provide:cc,useExisting:Hs(()=>OS)},OS=(()=>{class t extends cc{_parent;name=null;constructor(i,l,h){super(),this._parent=i,this._setValidators(l),this._setAsyncValidators(h)}ngOnInit(){VU(this._parent),this.formDirective.addFormArray(this)}ngOnDestroy(){this.formDirective?.removeFormArray(this)}get control(){return this.formDirective.getFormArray(this)}get formDirective(){return this._parent?this._parent.formDirective:null}get path(){return PS(this.name==null?this.name:this.name.toString(),this._parent)}static \u0275fac=function(l){return new(l||t)(wt(cc,13),wt(Gh,10),wt(c1,10))};static \u0275dir=Ki({type:t,selectors:[["","formArrayName",""]],inputs:{name:[0,"formArrayName","name"]},standalone:!1,features:[Va([fie]),fs]})}return t})();function VU(t){return!(t instanceof jU)&&!(t instanceof Lc)&&!(t instanceof OS)}var pie={provide:pg,useExisting:Hs(()=>Ou)},Ou=(()=>{class t extends pg{_ngModelWarningConfig;_added=!1;viewModel;control;name=null;set isDisabled(i){}model;update=new qi;static _ngModelWarningSentOnce=!1;_ngModelWarningSent=!1;constructor(i,l,h,o,E){super(),this._ngModelWarningConfig=E,this._parent=i,this._setValidators(l),this._setAsyncValidators(h),this.valueAccessor=zU(this,o)}ngOnChanges(i){this._added||this._setUpControl(),NU(i,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(i){this.viewModel=i,this.update.emit(i)}get path(){return PS(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_setUpControl(){this.control=this.formDirective.addControl(this),this._added=!0}static \u0275fac=function(l){return new(l||t)(wt(cc,13),wt(Gh,10),wt(c1,10),wt(mg,10),wt(BU,8))};static \u0275dir=Ki({type:t,selectors:[["","formControlName",""]],inputs:{name:[0,"formControlName","name"],isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"]},outputs:{update:"ngModelChange"},standalone:!1,features:[Va([pie]),fs,wa]})}return t})();var mie={provide:mg,useExisting:Hs(()=>ov),multi:!0};function UU(t,n){return t==null?`${n}`:(n&&typeof n=="object"&&(n="Object"),`${t}: ${n}`.slice(0,50))}function gie(t){return t.split(":")[0]}var ov=(()=>{class t extends a1{value;_optionMap=new Map;_idCounter=0;set compareWith(i){this._compareWith=i}_compareWith=Object.is;appRefInjector=ft(jh).injector;destroyRef=ft(bu);cdr=ft(Md);_queuedWrite=!1;_writeValueAfterRender(){this._queuedWrite||this.appRefInjector.destroyed||(this._queuedWrite=!0,ab({write:()=>{this.destroyRef.destroyed||(this._queuedWrite=!1,this.writeValue(this.value))}},{injector:this.appRefInjector}))}writeValue(i){this.cdr.markForCheck(),this.value=i;let l=this._getOptionId(i),h=UU(l,i);this.setProperty("value",h)}registerOnChange(i){this.onChange=l=>{this.value=this._getOptionValue(l),i(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(i){for(let l of this._optionMap.keys())if(this._compareWith(this._optionMap.get(l),i))return l;return null}_getOptionValue(i){let l=gie(i);return this._optionMap.has(l)?this._optionMap.get(l):i}static \u0275fac=(()=>{let i;return function(h){return(i||(i=Ca(t)))(h||t)}})();static \u0275dir=Ki({type:t,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(l,h){l&1&&Ot("change",function(E){return h.onChange(E.target.value)})("blur",function(){return h.onTouched()})},inputs:{compareWith:"compareWith"},standalone:!1,features:[Va([mie]),fs]})}return t})(),RS=(()=>{class t{_element;_renderer;_select;id;constructor(i,l,h){this._element=i,this._renderer=l,this._select=h,this._select&&(this.id=this._select._registerOption())}set ngValue(i){this._select!=null&&(this._select._optionMap.set(this.id,i),this._setElementValue(UU(this.id,i)),this._select._writeValueAfterRender())}set value(i){this._setElementValue(i),this._select&&this._select._writeValueAfterRender()}_setElementValue(i){this._renderer.setProperty(this._element.nativeElement,"value",i)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select._writeValueAfterRender())}static \u0275fac=function(l){return new(l||t)(wt(Fo),wt(ia),wt(ov,9))};static \u0275dir=Ki({type:t,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"},standalone:!1})}return t})(),_ie={provide:mg,useExisting:Hs(()=>HU),multi:!0};function gU(t,n){return t==null?`${n}`:(typeof n=="string"&&(n=`'${n}'`),n&&typeof n=="object"&&(n="Object"),`${t}: ${n}`.slice(0,50))}function vie(t){return t.split(":")[0]}var HU=(()=>{class t extends a1{value;_optionMap=new Map;_idCounter=0;set compareWith(i){this._compareWith=i}_compareWith=Object.is;writeValue(i){this.value=i;let l;if(Array.isArray(i)){let h=i.map(o=>this._getOptionId(o));l=(o,E)=>{o._setSelected(h.indexOf(E.toString())>-1)}}else l=(h,o)=>{h._setSelected(!1)};this._optionMap.forEach(l)}registerOnChange(i){this.onChange=l=>{let h=[],o=l.selectedOptions;if(o!==void 0){let E=o;for(let A=0;A<E.length;A++){let L=E[A],Y=this._getOptionValue(L.value);h.push(Y)}}else{let E=l.options;for(let A=0;A<E.length;A++){let L=E[A];if(L.selected){let Y=this._getOptionValue(L.value);h.push(Y)}}}this.value=h,i(h)}}_registerOption(i){let l=(this._idCounter++).toString();return this._optionMap.set(l,i),l}_getOptionId(i){for(let l of this._optionMap.keys())if(this._compareWith(this._optionMap.get(l)._value,i))return l;return null}_getOptionValue(i){let l=vie(i);return this._optionMap.has(l)?this._optionMap.get(l)._value:i}static \u0275fac=(()=>{let i;return function(h){return(i||(i=Ca(t)))(h||t)}})();static \u0275dir=Ki({type:t,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(l,h){l&1&&Ot("change",function(E){return h.onChange(E.target)})("blur",function(){return h.onTouched()})},inputs:{compareWith:"compareWith"},standalone:!1,features:[Va([_ie]),fs]})}return t})(),kS=(()=>{class t{_element;_renderer;_select;id;_value;constructor(i,l,h){this._element=i,this._renderer=l,this._select=h,this._select&&(this.id=this._select._registerOption(this))}set ngValue(i){this._select!=null&&(this._value=i,this._setElementValue(gU(this.id,i)),this._select.writeValue(this._select.value))}set value(i){this._select?(this._value=i,this._setElementValue(gU(this.id,i)),this._select.writeValue(this._select.value)):this._setElementValue(i)}_setElementValue(i){this._renderer.setProperty(this._element.nativeElement,"value",i)}_setSelected(i){this._renderer.setProperty(this._element.nativeElement,"selected",i)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static \u0275fac=function(l){return new(l||t)(wt(Fo),wt(ia),wt(HU,9))};static \u0275dir=Ki({type:t,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"},standalone:!1})}return t})();function yie(t){return typeof t=="number"?t:parseInt(t,10)}function $U(t){return typeof t=="number"?t:parseFloat(t)}var FS=(()=>{class t{_validator=bS;_onChange;_enabled;ngOnChanges(i){if(this.inputName in i){let l=this.normalizeInput(i[this.inputName].currentValue);this._enabled=this.enabled(l),this._validator=this._enabled?this.createValidator(l):bS,this._onChange&&this._onChange()}}validate(i){return this._validator(i)}registerOnValidatorChange(i){this._onChange=i}enabled(i){return i!=null}static \u0275fac=function(l){return new(l||t)};static \u0275dir=Ki({type:t,features:[wa]})}return t})(),xie={provide:Gh,useExisting:Hs(()=>gg),multi:!0},gg=(()=>{class t extends FS{max;inputName="max";normalizeInput=i=>$U(i);createValidator=i=>xU(i);static \u0275fac=(()=>{let i;return function(h){return(i||(i=Ca(t)))(h||t)}})();static \u0275dir=Ki({type:t,selectors:[["input","type","number","max","","formControlName",""],["input","type","number","max","","formControl",""],["input","type","number","max","","ngModel",""]],hostVars:1,hostBindings:function(l,h){l&2&&Lo("max",h._enabled?h.max:null)},inputs:{max:"max"},standalone:!1,features:[Va([xie]),fs]})}return t})(),bie={provide:Gh,useExisting:Hs(()=>Zh),multi:!0},Zh=(()=>{class t extends FS{min;inputName="min";normalizeInput=i=>$U(i);createValidator=i=>yU(i);static \u0275fac=(()=>{let i;return function(h){return(i||(i=Ca(t)))(h||t)}})();static \u0275dir=Ki({type:t,selectors:[["input","type","number","min","","formControlName",""],["input","type","number","min","","formControl",""],["input","type","number","min","","ngModel",""]],hostVars:1,hostBindings:function(l,h){l&2&&Lo("min",h._enabled?h.min:null)},inputs:{min:"min"},standalone:!1,features:[Va([bie]),fs]})}return t})(),wie={provide:Gh,useExisting:Hs(()=>gR),multi:!0};var gR=(()=>{class t extends FS{required;inputName="required";normalizeInput=_p;createValidator=i=>bU;enabled(i){return i}static \u0275fac=(()=>{let i;return function(h){return(i||(i=Ca(t)))(h||t)}})();static \u0275dir=Ki({type:t,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(l,h){l&2&&Lo("required",h._enabled?"":null)},inputs:{required:"required"},standalone:!1,features:[Va([wie]),fs]})}return t})();var Cie={provide:Gh,useExisting:Hs(()=>_R),multi:!0},_R=(()=>{class t extends FS{maxlength;inputName="maxlength";normalizeInput=i=>yie(i);createValidator=i=>wU(i);static \u0275fac=(()=>{let i;return function(h){return(i||(i=Ca(t)))(h||t)}})();static \u0275dir=Ki({type:t,selectors:[["","maxlength","","formControlName",""],["","maxlength","","formControl",""],["","maxlength","","ngModel",""]],hostVars:1,hostBindings:function(l,h){l&2&&Lo("maxlength",h._enabled?h.maxlength:null)},inputs:{maxlength:"maxlength"},standalone:!1,features:[Va([Cie]),fs]})}return t})();var GU=(()=>{class t{static \u0275fac=function(l){return new(l||t)};static \u0275mod=Qo({type:t});static \u0275inj=$o({})}return t})(),uR=class extends iv{constructor(n,i,l){super(fR(i),pR(l,i)),this.controls=n,this._initObservables(),this._setUpdateStrategy(i),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}controls;at(n){return this.controls[this._adjustIndex(n)]}push(n,i={}){Array.isArray(n)?n.forEach(l=>{this.controls.push(l),this._registerControl(l)}):(this.controls.push(n),this._registerControl(n)),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}insert(n,i,l={}){this.controls.splice(n,0,i),this._registerControl(i),this.updateValueAndValidity({emitEvent:l.emitEvent})}removeAt(n,i={}){let l=this._adjustIndex(n);l<0&&(l=0),this.controls[l]&&this.controls[l]._registerOnCollectionChange(()=>{}),this.controls.splice(l,1),this.updateValueAndValidity({emitEvent:i.emitEvent})}setControl(n,i,l={}){let h=this._adjustIndex(n);h<0&&(h=0),this.controls[h]&&this.controls[h]._registerOnCollectionChange(()=>{}),this.controls.splice(h,1),i&&(this.controls.splice(h,0,i),this._registerControl(i)),this.updateValueAndValidity({emitEvent:l.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(n,i={}){FU(this,!1,n),n.forEach((l,h)=>{kU(this,!1,h),this.at(h).setValue(l,{onlySelf:!0,emitEvent:i.emitEvent})}),this.updateValueAndValidity(i)}patchValue(n,i={}){n!=null&&(n.forEach((l,h)=>{this.at(h)&&this.at(h).patchValue(l,{onlySelf:!0,emitEvent:i.emitEvent})}),this.updateValueAndValidity(i))}reset(n=[],i={}){this._forEachChild((l,h)=>{l.reset(n[h],{onlySelf:!0,emitEvent:i.emitEvent})}),this._updatePristine(i,this),this._updateTouched(i,this),this.updateValueAndValidity(i),i?.emitEvent!==!1&&this._events.next(new s1(this))}getRawValue(){return this.controls.map(n=>n.getRawValue())}clear(n={}){this.controls.length<1||(this._forEachChild(i=>i._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:n.emitEvent}))}_adjustIndex(n){return n<0?n+this.length:n}_syncPendingControls(){let n=this.controls.reduce((i,l)=>l._syncPendingControls()?!0:i,!1);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){this.controls.forEach((i,l)=>{n(i,l)})}_updateValue(){this.value=this.controls.filter(n=>n.enabled||this.disabled).map(n=>n.value)}_anyControls(n){return this.controls.some(i=>i.enabled&&n(i))}_setUpControls(){this._forEachChild(n=>this._registerControl(n))}_allControlsDisabled(){for(let n of this.controls)if(n.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(n){n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)}_find(n){return this.at(n)??null}};function _U(t){return!!t&&(t.asyncValidators!==void 0||t.validators!==void 0||t.updateOn!==void 0)}var Ld=(()=>{class t{useNonNullable=!1;get nonNullable(){let i=new t;return i.useNonNullable=!0,i}group(i,l=null){let h=this._reduceControls(i),o={};return _U(l)?o=l:l!==null&&(o.validators=l.validator,o.asyncValidators=l.asyncValidator),new rv(h,o)}record(i,l=null){let h=this._reduceControls(i);return new lR(h,l)}control(i,l,h){let o={};return this.useNonNullable?(_U(l)?o=l:(o.validators=l,o.asyncValidators=h),new o1(i,Mi(Jt({},o),{nonNullable:!0}))):new o1(i,l,h)}array(i,l,h){let o=i.map(E=>this._createControl(E));return new uR(o,l,h)}_reduceControls(i){let l={};return Object.keys(i).forEach(h=>{l[h]=this._createControl(i[h])}),l}_createControl(i){if(i instanceof o1)return i;if(i instanceof iv)return i;if(Array.isArray(i)){let l=i[0],h=i.length>1?i[1]:null,o=i.length>2?i[2]:null;return this.control(l,h,o)}else return this.control(i)}static \u0275fac=function(l){return new(l||t)};static \u0275prov=Qt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var Ap=(()=>{class t{static withConfig(i){return{ngModule:t,providers:[{provide:MS,useValue:i.callSetDisabledState??AS}]}}static \u0275fac=function(l){return new(l||t)};static \u0275mod=Qo({type:t});static \u0275inj=$o({imports:[GU]})}return t})(),Nd=(()=>{class t{static withConfig(i){return{ngModule:t,providers:[{provide:BU,useValue:i.warnOnNgModelWithFormControl??"always"},{provide:MS,useValue:i.callSetDisabledState??AS}]}}static \u0275fac=function(l){return new(l||t)};static \u0275mod=Qo({type:t});static \u0275inj=$o({imports:[GU]})}return t})();var Pp=class t{constructor(n){this.http=n}apiUrl=`${is.apiUrl}/ciudades`;obtenerCiudades(){return this.http.get(this.apiUrl)}static \u0275fac=function(i){return new(i||t)(gn(aa))};static \u0275prov=Qt({token:t,factory:t.\u0275fac,providedIn:"root"})};var sv=class t{constructor(n){this.http=n}apiUrl=`${is.apiUrl}/servicios`;obtenerServicios(){return this.http.get(this.apiUrl)}static \u0275fac=function(i){return new(i||t)(gn(aa))};static \u0275prov=Qt({token:t,factory:t.\u0275fac,providedIn:"root"})};var Nl=class t{campoInvalido(n,i){let l=n.get(i);return!!(l&&l.invalid&&l.touched)}formularioTieneError(n,i){return n.hasError(i)}marcarCamposComoTocados(n){Object.keys(n.controls).forEach(i=>{let l=n.get(i);l?.markAsTouched(),l instanceof rv&&this.marcarCamposComoTocados(l)})}obtenerErrorCampo(n,i){let l=n.get(i);if(!l||!l.errors)return"";let h=l.errors;return h.required?"Este campo es obligatorio":h.email?"Por favor ingresa un email v\xE1lido":h.minlength?`Debe tener al menos ${h.minlength.requiredLength} caracteres`:h.maxlength?`No puede exceder ${h.maxlength.requiredLength} caracteres`:h.min?`El valor m\xEDnimo es ${h.min.min}`:h.max?`El valor m\xE1ximo es ${h.max.max}`:h.pattern?i.includes("telefono")?"Por favor ingresa un tel\xE9fono v\xE1lido de 10 d\xEDgitos":"Formato inv\xE1lido":h.edadMinima?`Debes ser mayor de ${h.edadMinima.edadRequerida} a\xF1os`:h.contrasenaDebil?"La contrase\xF1a debe contener al menos una may\xFAscula y un n\xFAmero":h.contrasenasNoCoinciden?"Las contrase\xF1as no coinciden":"Campo inv\xE1lido"}edadMinimaValidador(n){return i=>{if(!i.value)return null;let l=new Date(i.value),h=new Date,o=h.getFullYear()-l.getFullYear(),E=h.getMonth()-l.getMonth(),A=l.getTimezoneOffset();return l.setMinutes(l.getMinutes()+A),(E<0||E===0&&h.getDate()<l.getDate())&&o--,o>=n?null:{edadMinima:{edadRequerida:n,edadActual:o}}}}contrasenaFuerteValidador(){return n=>{let i=n.value;if(!i)return null;let l=/[A-Z]/.test(i),h=/\d/.test(i),o=/[!@#$%^&*(),.?":{}|<>]/.test(i);return l&&h?null:{contrasenaDebil:{tieneMayuscula:l,tieneNumero:h,tieneCaracterEspecial:o}}}}contrasenasMatchValidador(n="contrasena",i="confirmarContrasena"){return l=>{let h=l.get(n)?.value,o=l.get(i)?.value;return h===o?null:{contrasenasNoCoinciden:!0}}}obtenerFechaMaxima(n=18){let i=new Date;return i.setFullYear(i.getFullYear()-n),i.setMinutes(i.getMinutes()-i.getTimezoneOffset()),i.toISOString().split("T")[0]}obtenerFechaMinima(n=120){let i=new Date;return i.setFullYear(i.getFullYear()-n),i.setMinutes(i.getMinutes()-i.getTimezoneOffset()),i.toISOString().split("T")[0]}obtenerFechaHoy(){return new Date().toISOString().split("T")[0]}obtenerFechaManana(){let n=new Date;return n.setDate(n.getDate()+1),n.toISOString().split("T")[0]}scrollAlPrimerError(){setTimeout(()=>{let n=document.querySelector(".error, input.error, textarea.error, select.error");n&&n.scrollIntoView({behavior:"smooth",block:"center"})},100)}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Qt({token:t,factory:t.\u0275fac,providedIn:"root"})};function Eie(t,n){if(t&1&&($(0,"option",5),ne(1),W()),t&2){let i=n.$implicit;zt("value",i),ie(),Ln(i)}}function Tie(t,n){if(t&1&&ne(0),t&2){let i=Ne();ps(" ",i.serviciosSeleccionados.length," seleccionado",i.serviciosSeleccionados.length>1?"s":""," ")}}function Sie(t,n){t&1&&ne(0," Opcional ")}function Die(t,n){if(t&1){let i=Hn();$(0,"label",20)(1,"input",21),Ot("change",function(){let h=Wt(i).$implicit,o=Ne(2);return Zt(o.toggleServicio(h))}),W(),$(2,"span"),ne(3),W()()}if(t&2){let i=n.$implicit,l=Ne(2);ie(),zt("checked",l.estaSeleccionado(i)),ie(2),Ln(l.formatearServicio(i))}}function Iie(t,n){if(t&1&&($(0,"div",17),Ri(1,Die,4,2,"label",20,ra),W()),t&2){let i=Ne();ie(),ki(i.serviciosDisponibles)}}var lv=class t{constructor(n,i,l,h){this.ciudadService=n;this.serviciosService=i;this.formUtilsService=l;this.router=h}ciudad="";fechaEntrada="";fechaSalida="";huespedes=1;serviciosSeleccionados=[];ciudades=[];serviciosDisponibles=[];mostrarServicios=!1;cargando=!1;destroy$=new Fn;ngOnInit(){this.cargarDatosIniciales(),this.establecerFechasMinimas()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}cargarDatosIniciales(){this.ciudadService.obtenerCiudades().pipe(tn(this.destroy$)).subscribe({next:n=>{n.error||(this.ciudades=n.data)},error:n=>console.error("Error al cargar ciudades:",n)}),this.serviciosService.obtenerServicios().pipe(tn(this.destroy$)).subscribe({next:n=>{n.error||(this.serviciosDisponibles=n.data)},error:n=>console.error("Error al cargar servicios:",n)})}establecerFechasMinimas(){let n=new Date;this.fechaEntrada=n.toISOString().split("T")[0];let i=new Date(n);i.setDate(n.getDate()+1),this.fechaSalida=i.toISOString().split("T")[0]}toggleServicio(n){let i=this.serviciosSeleccionados.indexOf(n);i>-1?this.serviciosSeleccionados.splice(i,1):this.serviciosSeleccionados.push(n)}estaSeleccionado(n){return this.serviciosSeleccionados.includes(n)}buscar(){if(!this.ciudad)return;let n={ciudad:this.ciudad,huespedes:this.huespedes,servicios:this.serviciosSeleccionados};this.fechaEntrada&&(n.fechaEntrada=this.fechaEntrada),this.fechaSalida&&(n.fechaSalida=this.fechaSalida),this.router.navigate(["/busqueda"],{queryParams:{ciudad:this.ciudad,fechaEntrada:this.fechaEntrada,fechaSalida:this.fechaSalida,huespedes:this.huespedes,servicios:this.serviciosSeleccionados.join(",")}})}formatearServicio(n){return{WIFI:"Wi-Fi",PISCINA:"Piscina",DESAYUNO:"Desayuno",AIRE_ACONDICIONADO:"Aire Acondicionado",ESTACIONAMIENTO:"Estacionamiento",COCINA:"Cocina",LAVADORA:"Lavadora",TV:"Televisi\xF3n",GYM:"Gimnasio",MASCOTAS:"Pet Friendly"}[n]||n}obtenerFechaMinimaSalida(){this.fechaEntrada||this.formUtilsService.obtenerFechaManana();let n=new Date(this.fechaEntrada);return n.setDate(n.getDate()+1),n.toISOString().split("T")[0]}static \u0275fac=function(i){return new(i||t)(wt(Pp),wt(sv),wt(Nl),wt(br))};static \u0275cmp=Ai({type:t,selectors:[["app-barra-busqueda"]],decls:32,vars:11,consts:[[1,"search-bar"],[1,"search-field","search-field-ciudad"],["for","ciudad"],["id","ciudad","required","",3,"ngModelChange","ngModel"],["value",""],[3,"value"],[1,"search-field","search-field-date"],["for","checkin"],["type","date","id","checkin",3,"ngModelChange","ngModel","min"],["for","checkout"],["type","date","id","checkout",3,"ngModelChange","ngModel","min"],[1,"search-field","search-field-guests"],["for","guests"],["type","number","id","guests","min","1","max","20","placeholder","1",3,"ngModelChange","ngModel"],[1,"search-field","search-field-services"],["type","button",1,"services-toggle",3,"click"],[1,"services-text"],[1,"services-dropdown"],["type","button","title","Buscar",1,"btn-search",3,"click","disabled"],[1,"fa-solid","fa-magnifying-glass"],[1,"service-item"],["type","checkbox",3,"change","checked"]],template:function(i,l){i&1&&($(0,"div",0)(1,"div",1)(2,"label",2),ne(3,"Ciudad"),W(),$(4,"select",3),Rl("ngModelChange",function(o){return oc(l.ciudad,o)||(l.ciudad=o),o}),$(5,"option",4),ne(6,"\xBFA d\xF3nde viajas?"),W(),Ri(7,Eie,2,2,"option",5,ra),W()(),$(9,"div",6)(10,"label",7),ne(11,"Check-in"),W(),$(12,"input",8),Rl("ngModelChange",function(o){return oc(l.fechaEntrada,o)||(l.fechaEntrada=o),o}),W()(),$(13,"div",6)(14,"label",9),ne(15,"Check-out"),W(),$(16,"input",10),Rl("ngModelChange",function(o){return oc(l.fechaSalida,o)||(l.fechaSalida=o),o}),W()(),$(17,"div",11)(18,"label",12),ne(19,"Hu\xE9spedes"),W(),$(20,"input",13),Rl("ngModelChange",function(o){return oc(l.huespedes,o)||(l.huespedes=o),o}),W()(),$(21,"div",14)(22,"label"),ne(23,"Servicios"),W(),$(24,"button",15),Ot("click",function(){return l.mostrarServicios=!l.mostrarServicios}),$(25,"span",16),tt(26,Tie,1,2)(27,Sie,1,0),W(),be(28,"i"),W(),tt(29,Iie,3,0,"div",17),W(),$(30,"button",18),Ot("click",function(){return l.buscar()}),be(31,"i",19),W()()),i&2&&(ie(4),Ol("ngModel",l.ciudad),ie(3),ki(l.ciudades),ie(5),Ol("ngModel",l.fechaEntrada),zt("min",l.formUtilsService.obtenerFechaHoy()),ie(4),Ol("ngModel",l.fechaSalida),zt("min",l.obtenerFechaMinimaSalida()),ie(4),Ol("ngModel",l.huespedes),ie(6),nt(l.serviciosSeleccionados.length>0?26:27),ie(2),Ta(l.mostrarServicios?"fa-solid fa-chevron-up":"fa-solid fa-chevron-down"),ie(),nt(l.mostrarServicios?29:-1),ie(),zt("disabled",!l.ciudad))},dependencies:[Mr,Ap,RS,kS,Ps,Wh,ov,ca,gR,Zh,gg,qh],styles:[".search-field-ciudad[_ngcontent-%COMP%]{flex:1.8;min-width:180px}.search-field-date[_ngcontent-%COMP%]{flex:1.2;min-width:140px}.search-field-guests[_ngcontent-%COMP%]{flex:.8;min-width:100px}.search-field-services[_ngcontent-%COMP%]{flex:1.2;min-width:140px;position:relative}.search-field[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{border:none;outline:none;width:100%;font-size:1rem;background:transparent;color:var(--text-color);cursor:pointer;padding:4px 0;font-weight:500}.search-field[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]   option[_ngcontent-%COMP%]{background-color:var(--white-color);color:var(--text-color);padding:8px}.search-field-guests[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{text-align:center;font-weight:600}.services-toggle[_ngcontent-%COMP%]{border:none;outline:none;background:transparent;width:100%;display:flex;justify-content:space-between;align-items:center;padding:4px 0;font-size:.95rem;color:var(--text-color);cursor:pointer;transition:color .3s ease;gap:8px}.services-toggle[_ngcontent-%COMP%]:hover{color:var(--primary-color)}.services-text[_ngcontent-%COMP%]{flex:1;text-align:left;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.services-toggle[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:.8rem;color:var(--primary-color);flex-shrink:0}.services-dropdown[_ngcontent-%COMP%]{position:absolute;top:calc(100% + 12px);left:0;background-color:var(--white-color);border-radius:16px;box-shadow:0 8px 32px #2e8b5733;padding:1rem;z-index:100;min-width:250px;max-height:300px;overflow-y:auto;border:2px solid rgba(46,139,87,.1);animation:_ngcontent-%COMP%_dropdownFadeIn .3s ease}@keyframes _ngcontent-%COMP%_dropdownFadeIn{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.service-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;padding:.8rem;border-radius:8px;cursor:pointer;transition:all .3s ease;margin-bottom:4px}.service-item[_ngcontent-%COMP%]:hover{background-color:var(--light-green)}.service-item[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:18px;height:18px;cursor:pointer;accent-color:var(--primary-color)}.service-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.95rem;color:var(--text-color);font-weight:500}.services-dropdown[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.services-dropdown[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:var(--light-green);border-radius:10px}.services-dropdown[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:var(--primary-color);border-radius:10px}@media (max-width: 1024px){.search-bar[_ngcontent-%COMP%]{flex-wrap:wrap;padding:12px}.search-field-ciudad[_ngcontent-%COMP%], .search-field-date[_ngcontent-%COMP%], .search-field-guests[_ngcontent-%COMP%], .search-field-services[_ngcontent-%COMP%]{flex:1 1 calc(50% - 8px);min-width:140px}.btn-search[_ngcontent-%COMP%]{flex:0 0 100%;width:100%;border-radius:12px;margin-top:8px}}@media (max-width: 768px){.search-field-ciudad[_ngcontent-%COMP%], .search-field-date[_ngcontent-%COMP%], .search-field-guests[_ngcontent-%COMP%], .search-field-services[_ngcontent-%COMP%]{flex:1 1 100%;border-right:none;border-bottom:1px solid var(--border-color);padding:12px 16px}.search-field[_ngcontent-%COMP%]:last-of-type{border-bottom:none}.services-dropdown[_ngcontent-%COMP%]{left:auto;right:0;min-width:100%}}"]})};var WU=(t,n)=>n.id;function Mie(t,n){t&1&&($(0,"div",11),be(1,"div",15),$(2,"p",16),ne(3,"Cargando alojamientos..."),W()())}function Aie(t,n){if(t&1&&be(0,"app-alojamiento-item",17),t&2){let i=n.$implicit;zt("alojamiento",i)}}function Pie(t,n){if(t&1&&($(0,"div",12),Ri(1,Aie,1,1,"app-alojamiento-item",17,WU),W()),t&2){let i=Ne();ie(),ki(i.alojamientosPopulares)}}function Oie(t,n){t&1&&($(0,"div",13),be(1,"i",18),$(2,"h3"),ne(3,"No hay alojamientos disponibles"),W(),$(4,"p"),ne(5,"En este momento no hay alojamientos para mostrar"),W()())}function Rie(t,n){t&1&&($(0,"div",11),be(1,"div",15),$(2,"p",16),ne(3,"Cargando sugerencias..."),W()())}function kie(t,n){if(t&1&&be(0,"app-alojamiento-item",17),t&2){let i=n.$implicit;zt("alojamiento",i)}}function Fie(t,n){if(t&1&&($(0,"div",12),Ri(1,kie,1,1,"app-alojamiento-item",17,WU),W()),t&2){let i=Ne(2);ie(),ki(i.alojamientosSugeridos)}}function Lie(t,n){if(t&1&&($(0,"section",14)(1,"div",8)(2,"div",19)(3,"h2"),be(4,"i",20),ne(5),W(),$(6,"p"),ne(7),W()(),tt(8,Rie,4,0,"div",11),tt(9,Fie,3,0,"div",12),W()()),t&2){let i=Ne();ie(5),nn(" Descubre ",i.ciudadSugerida," "),ie(2),nn("Alojamientos destacados en ",i.ciudadSugerida),ie(),nt(i.cargandoSugeridos?8:-1),ie(),nt(i.cargandoSugeridos?-1:9)}}var LS=class t{constructor(n,i){this.alojamientoService=n;this.ciudadService=i}alojamientosPopulares=[];alojamientosSugeridos=[];ciudadSugerida="";ciudades=[];cargandoPopulares=!1;cargandoSugeridos=!1;cargandoReservas=!1;destroy$=new Fn;ngOnInit(){this.cargarAlojamientosPopulares(),this.cargarAlojamientosSugeridos(),this.inicializarSlideshow()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}cargarAlojamientosPopulares(){this.cargandoPopulares=!0,this.alojamientoService.obtenerAlojamientos({},0).pipe(tn(this.destroy$),Si(()=>this.cargandoPopulares=!1)).subscribe({next:n=>{n.error||(this.alojamientosPopulares=n.data.sort((i,l)=>{let h=Number(i.promedioCalificaciones)||0,o=Number(l.promedioCalificaciones)||0;return o===h&&(this.cargandoReservas=!0,this.alojamientoService.obtenerReservasAlojamiento(i.id).pipe(tn(this.destroy$),Si(()=>this.cargandoReservas=!1)).subscribe({next:E=>{let A=E.data.length;this.alojamientoService.obtenerReservasAlojamiento(l.id).pipe(tn(this.destroy$),Si(()=>this.cargandoReservas=!1)).subscribe({next:L=>L.data.length-A})}})),o-h}).slice(0,8))},error:n=>{console.error("Error al cargar alojamientos populares:",n)}})}cargarAlojamientosSugeridos(){this.ciudadService.obtenerCiudades().pipe(tn(this.destroy$)).subscribe({next:i=>{i.error||(this.ciudades=i.data)},error:i=>console.error("Error al cargar ciudades:",i)});let n=this.ciudades[Math.floor(Math.random()*this.ciudades.length)];this.ciudadSugerida=n,this.cargandoSugeridos=!0,this.alojamientoService.sugerirAlojamientos(n).pipe(tn(this.destroy$),Si(()=>this.cargandoSugeridos=!1)).subscribe({next:i=>{i.error||(this.alojamientosSugeridos=i.data.slice(0,4))},error:i=>{console.error("Error al cargar alojamientos sugeridos:",i)}})}inicializarSlideshow(){let n=0,i=5,l=o=>{for(let A=1;A<=i;A++){let L=document.querySelector(`.slide-${A}`);L&&L.classList.remove("active")}let E=document.querySelector(`.slide-${o+1}`);E&&E.classList.add("active")},h=()=>{n=(n+1)%i,l(n)};setTimeout(()=>l(0),100),setInterval(h,4e3)}static \u0275fac=function(i){return new(i||t)(wt(As),wt(Pp))};static \u0275cmp=Ai({type:t,selectors:[["app-inicio"]],decls:23,vars:4,consts:[[1,"hero"],[1,"hero-slideshow"],[1,"slide-bg","slide-1","active"],[1,"slide-bg","slide-2"],[1,"slide-bg","slide-3"],[1,"slide-bg","slide-4"],[1,"slide-bg","slide-5"],[1,"hero-background"],[1,"container"],[1,"hero-content"],[1,"popular-accommodations"],[2,"text-align","center","padding","3rem"],[1,"accommodations-grid"],[1,"empty-state",2,"margin-top","2rem"],[1,"suggested-accommodations"],[1,"loading-spinner-large"],[2,"color","var(--text-color)","margin-top","1rem"],[3,"alojamiento"],[1,"fa-solid","fa-house-circle-exclamation"],[1,"section-header"],[1,"fa-solid","fa-location-dot"]],template:function(i,l){i&1&&($(0,"section",0)(1,"div",1),be(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6),W(),be(7,"div",7),$(8,"div",8)(9,"div",9)(10,"h1"),ne(11,"Tu pr\xF3ximo destino te espera"),W(),$(12,"p"),ne(13,"Encuentra alojamientos \xFAnicos para tu pr\xF3xima aventura."),W(),be(14,"app-barra-busqueda"),W()()(),$(15,"section",10)(16,"div",8)(17,"h2"),ne(18,"Alojamientos Populares"),W(),tt(19,Mie,4,0,"div",11),tt(20,Pie,3,0,"div",12),tt(21,Oie,6,0,"div",13),W()(),tt(22,Lie,10,4,"section",14)),i&2&&(ie(19),nt(l.cargandoPopulares?19:-1),ie(),nt(!l.cargandoPopulares&&l.alojamientosPopulares.length>0?20:-1),ie(),nt(!l.cargandoPopulares&&l.alojamientosPopulares.length===0?21:-1),ie(),nt(l.alojamientosSugeridos.length>0?22:-1))},dependencies:[Mr,ev,lv],styles:['.loading-spinner-large[_ngcontent-%COMP%]{display:inline-block;width:48px;height:48px;border:4px solid var(--light-green);border-radius:50%;border-top-color:var(--primary-color);animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.suggested-accommodations[_ngcontent-%COMP%]{padding:5rem 0;background:linear-gradient(135deg,#2e8b5708,#2e8b5714);border-radius:50px;margin:2rem 0}.section-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:3rem}.section-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:2.5rem;color:var(--dark-green);font-weight:700;margin-bottom:.5rem;display:flex;align-items:center;justify-content:center;gap:12px}.section-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--primary-color);font-size:2.2rem}.section-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.2rem;color:#7f8c8d;font-weight:500}.cta-section[_ngcontent-%COMP%]{background:linear-gradient(135deg,var(--primary-color) 0%,var(--accent-color) 100%);padding:5rem 0;margin:4rem 0 0;border-radius:50px 50px 0 0;position:relative;overflow:hidden}.cta-section[_ngcontent-%COMP%]:before{content:"";position:absolute;top:-50%;right:-20%;width:500px;height:500px;background:#ffffff1a;border-radius:50%;z-index:0}.cta-section[_ngcontent-%COMP%]:after{content:"";position:absolute;bottom:-30%;left:-10%;width:400px;height:400px;background:#ffffff14;border-radius:50%;z-index:0}.cta-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:3rem;position:relative;z-index:1}.cta-text[_ngcontent-%COMP%]{flex:1}.cta-text[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:2.5rem;color:var(--white-color);margin-bottom:1rem;font-weight:700}.cta-text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.2rem;color:#ffffffe6;line-height:1.6}.btn-large[_ngcontent-%COMP%]{padding:18px 32px;font-size:1.1rem;white-space:nowrap;background-color:var(--white-color);color:var(--primary-color);box-shadow:0 8px 24px #0003}.btn-large[_ngcontent-%COMP%]:hover{background-color:var(--secondary-color);transform:translateY(-3px);box-shadow:0 12px 32px #0000004d}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:4rem 2rem;background-color:var(--light-green);border-radius:20px}.empty-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:4rem;color:var(--primary-color);margin-bottom:1.5rem;opacity:.6}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.8rem;color:var(--dark-green);margin-bottom:1rem}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.1rem;color:#7f8c8d}.popular-accommodations[_ngcontent-%COMP%], .suggested-accommodations[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .6s ease-in-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}@media (max-width: 768px){.section-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:2rem;flex-direction:column}.section-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.8rem}.cta-content[_ngcontent-%COMP%]{flex-direction:column;text-align:center}.cta-text[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:2rem}.cta-text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1rem}.btn-large[_ngcontent-%COMP%]{width:100%}.suggested-accommodations[_ngcontent-%COMP%]{border-radius:30px;margin:1rem}.cta-section[_ngcontent-%COMP%]{border-radius:30px 30px 0 0}}']})};var Op=class t{constructor(n){this.http=n}API_URL=`${is.apiUrl}/auth`;registro(n){return this.http.post(`${this.API_URL}/registro`,n)}login(n){return this.http.post(`${this.API_URL}/login`,n)}solicitarRecuperacion(n){return this.http.post(`${this.API_URL}/forgot-password`,n)}reiniciarContrasena(n){return this.http.patch(`${this.API_URL}/reset-password`,n)}refrescarToken(n){return this.http.post(`${this.API_URL}/refresh`,n)}static \u0275fac=function(i){return new(i||t)(gn(aa))};static \u0275prov=Qt({token:t,factory:t.\u0275fac,providedIn:"root"})};var XU="AuthToken",YU="RefreshToken",Ar=class t{setToken(n){window.sessionStorage.setItem(XU,n)}getToken(){return sessionStorage.getItem(XU)}setRefreshToken(n){window.sessionStorage.setItem(YU,n)}getRefreshToken(){return sessionStorage.getItem(YU)}login(n,i){this.setToken(n),this.setRefreshToken(i)}logout(){window.sessionStorage.clear()}isLogged(){return!!this.getToken()}decodePayload(n){let l=n.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),h=atob(l);return JSON.parse(h)}getUserId(){let n=this.getToken();return n?this.decodePayload(n).sub:""}getRole(){let n=this.getToken();return n?this.decodePayload(n).rol:""}getEmail(){let n=this.getToken();return n?this.decodePayload(n).email:""}isTokenExpired(){let n=this.getToken();if(!n)return!0;try{let l=this.decodePayload(n).exp*1e3;return Date.now()>=l}catch{return!0}}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Qt({token:t,factory:t.\u0275fac,providedIn:"root"})};var Ru=ep(_g());var rs=class t{constructor(n,i){this.router=n;this.tokenService=i}handleHttpError(n){if(console.error("HTTP Error:",n),!(n instanceof xp))return"Error de conexi\xF3n. Verifica tu conexi\xF3n a internet.";switch(n.status){case 0:return"No se puede conectar al servidor. Verifica tu conexi\xF3n.";case 400:return this.extractBackendMessage(n)||"Solicitud inv\xE1lida. Verifica los datos enviados.";case 403:return this.extractBackendMessage(n)||"No tienes permisos para realizar esta acci\xF3n.";case 404:return this.extractBackendMessage(n)||"Recurso no encontrado.";case 409:return this.extractBackendMessage(n)||"Conflicto con los datos existentes.";case 500:return this.extractBackendMessage(n)||"Error interno del servidor. Intenta m\xE1s tarde.";case 502:return"Servidor no disponible temporalmente. Intenta en unos momentos.";case 503:return"Servicio temporalmente no disponible. Intenta m\xE1s tarde.";case 504:return"La solicitud tard\xF3 demasiado. Intenta de nuevo.";default:return this.extractBackendMessage(n)||`Error inesperado (${n.status}). Intenta nuevamente.`}}extractBackendMessage(n){try{let i=n.error;if(i&&typeof i=="object"){if(i.data&&Array.isArray(i.data))return i.data.map(l=>`${l.field}: ${l.message}`).join(`
`);if(i.data&&typeof i.data=="string")return i.data;if(i.message&&typeof i.message=="string")return i.message;if(i.errors&&Array.isArray(i.errors))return i.errors.map(l=>l.message||l).join(", ")}return typeof n.error=="string"?n.error:n.statusText&&n.statusText!=="Unknown Error"?n.statusText:null}catch(i){return console.error("Error al parsear mensaje del backend:",i),null}}showError(n,i="Error"){Ru.default.fire({title:i,text:n,icon:"error",confirmButtonColor:"#2e8b57",confirmButtonText:"Entendido"})}showErrorWithCallback(n,i){Ru.default.fire({title:"Error",text:n,icon:"error",confirmButtonColor:"#2e8b57",confirmButtonText:"Entendido"}).then(()=>{i()})}showWarning(n){Ru.default.fire({title:"Advertencia",text:n,icon:"warning",confirmButtonColor:"#2e8b57",confirmButtonText:"Entendido"})}showSuccess(n,i="\xA1\xC9xito!"){Ru.default.fire({title:i,text:n,icon:"success",confirmButtonColor:"#2e8b57",confirmButtonText:"Aceptar",timer:2e3,timerProgressBar:!0})}showSuccessWithCallback(n,i="\xA1\xC9xito!",l){Ru.default.fire({title:i,text:n,icon:"success",confirmButtonColor:"#2e8b57",timer:2e3,timerProgressBar:!0}).then(()=>{l()})}confirm(n,i="S\xED, continuar",l="\xBFEst\xE1s seguro?"){return Tc(this,null,function*(){return(yield Ru.default.fire({title:l,text:n,icon:"question",showCancelButton:!0,confirmButtonText:i,cancelButtonText:"Cancelar",confirmButtonColor:"#2e8b57",cancelButtonColor:"#95a5a6"})).isConfirmed})}confirmDanger(n,i="S\xED, eliminar",l="\xBFEst\xE1s seguro?"){return Tc(this,null,function*(){return(yield Ru.default.fire({title:l,text:n,icon:"warning",showCancelButton:!0,confirmButtonText:i,cancelButtonText:"Cancelar",confirmButtonColor:"#2e8b57",cancelButtonColor:"#95a5a6"})).isConfirmed})}showLoading(n="Procesando..."){Ru.default.fire({title:n,allowOutsideClick:!1,didOpen:()=>{Ru.default.showLoading()}})}closeModal(){Ru.default.close()}static \u0275fac=function(i){return new(i||t)(gn(br),gn(Ar))};static \u0275prov=Qt({token:t,factory:t.\u0275fac,providedIn:"root"})};function Nie(t,n){if(t&1&&($(0,"div",12),ne(1),W()),t&2){let i=Ne(2);ie(),nn(" ",i.formUtilsService.obtenerErrorCampo(i.loginForm,"email")," ")}}function zie(t,n){if(t&1&&($(0,"div",12),ne(1),W()),t&2){let i=Ne(2);ie(),nn(" ",i.formUtilsService.obtenerErrorCampo(i.loginForm,"contrasena")," ")}}function Bie(t,n){t&1&&(be(0,"span",24),ne(1," Iniciando... "))}function jie(t,n){t&1&&(be(0,"i",25),ne(1," Iniciar Sesi\xF3n "))}function Vie(t,n){if(t&1){let i=Hn();$(0,"section",2)(1,"div",3)(2,"h1",4),ne(3,"Bienvenido de vuelta"),W(),$(4,"p",5),ne(5,"Inicia sesi\xF3n para continuar tu aventura"),W()(),$(6,"div",6)(7,"form",7),Ot("ngSubmit",function(){Wt(i);let h=Ne();return Zt(h.login())}),$(8,"div",8)(9,"div",9)(10,"label",10),ne(11,"Correo Electr\xF3nico *"),W(),be(12,"input",11),tt(13,Nie,2,1,"div",12),W(),$(14,"div",9)(15,"label",13),ne(16,"Contrase\xF1a *"),W(),$(17,"div",14),be(18,"input",15),$(19,"button",16),Ot("click",function(){Wt(i);let h=Ne();return Zt(h.toggleContrasena())}),be(20,"i"),W()(),tt(21,zie,2,1,"div",12),W(),$(22,"div",9)(23,"div",17)(24,"a",18),Ot("click",function(){Wt(i);let h=Ne();return Zt(h.cambiarVista(h.VistaLogin.RECUPERAR))}),ne(25," \xBFOlvidaste tu contrase\xF1a? "),W()()(),$(26,"div",9)(27,"div",19)(28,"button",20),tt(29,Bie,2,0)(30,jie,2,0),W()()()()(),$(31,"div",21)(32,"p",22),ne(33," \xBFNo tienes una cuenta? "),$(34,"a",23),ne(35,"Reg\xEDstrate gratis"),W()()()()()}if(t&2){let i=Ne();ie(7),zt("formGroup",i.loginForm),ie(5),Dn("error",i.formUtilsService.campoInvalido(i.loginForm,"email")),ie(),nt(i.formUtilsService.campoInvalido(i.loginForm,"email")?13:-1),ie(5),Dn("error",i.formUtilsService.campoInvalido(i.loginForm,"contrasena")),zt("type",i.mostrarContrasena?"text":"password"),ie(),Lo("aria-label",i.mostrarContrasena?"Ocultar contrase\xF1a":"Mostrar contrase\xF1a"),ie(),Ta(i.mostrarContrasena?"fa-solid fa-eye-slash":"fa-solid fa-eye"),ie(),nt(i.formUtilsService.campoInvalido(i.loginForm,"contrasena")?21:-1),ie(7),zt("disabled",i.cargando||i.loginForm.invalid),ie(),nt(i.cargando?29:30)}}function Uie(t,n){if(t&1&&($(0,"div",12),ne(1),W()),t&2){let i=Ne(2);ie(),nn(" ",i.formUtilsService.obtenerErrorCampo(i.recuperarForm,"email")," ")}}function Hie(t,n){t&1&&(be(0,"span",24),ne(1," Enviando... "))}function $ie(t,n){t&1&&(be(0,"i",31),ne(1," Enviar enlace de recuperaci\xF3n "))}function Gie(t,n){if(t&1){let i=Hn();$(0,"section",2)(1,"div",3)(2,"h1",4),ne(3,"\xBFOlvidaste tu contrase\xF1a?"),W(),$(4,"p",5),ne(5,"No te preocupes, te enviaremos un enlace para restablecerla"),W()(),$(6,"div",6)(7,"form",26),Ot("ngSubmit",function(){Wt(i);let h=Ne();return Zt(h.recuperarContrasena())}),$(8,"div",8)(9,"div",9)(10,"label",27),ne(11,"Correo Electr\xF3nico *"),W(),be(12,"input",28),tt(13,Uie,2,1,"div",12),W(),$(14,"div",9)(15,"div",19)(16,"button",20),tt(17,Hie,2,0)(18,$ie,2,0),W()()()()(),$(19,"div",21)(20,"a",29),Ot("click",function(){Wt(i);let h=Ne();return Zt(h.cambiarVista(h.VistaLogin.LOGIN))}),be(21,"i",30),ne(22," Volver al inicio de sesi\xF3n "),W()()()()}if(t&2){let i=Ne();ie(7),zt("formGroup",i.recuperarForm),ie(5),Dn("error",i.formUtilsService.campoInvalido(i.recuperarForm,"email")),ie(),nt(i.formUtilsService.campoInvalido(i.recuperarForm,"email")?13:-1),ie(3),zt("disabled",i.cargando||i.recuperarForm.invalid),ie(),nt(i.cargando?17:18)}}function qie(t,n){t&1&&(be(0,"span",24),ne(1," Reenviando... "))}function Wie(t,n){t&1&&(be(0,"i",44),ne(1," Reenviar correo "))}function Zie(t,n){if(t&1){let i=Hn();$(0,"section",2)(1,"div",3)(2,"div",32),be(3,"i",33),W(),$(4,"h1",4),ne(5,"\xA1Enlace enviado!"),W(),$(6,"p",5),ne(7," Hemos enviado un enlace de recuperaci\xF3n a "),$(8,"strong",34),ne(9),W()()(),$(10,"div",35)(11,"div",36)(12,"p",37),be(13,"i",38),ne(14," Revisa tu bandeja de entrada y sigue las instrucciones para restablecer tu contrase\xF1a. "),W(),$(15,"p",39),ne(16," Si no ves el correo, revisa tu carpeta de spam o correo no deseado. "),W()(),$(17,"button",40),Ot("click",function(){Wt(i);let h=Ne();return Zt(h.reenviarEmail())}),tt(18,qie,2,0)(19,Wie,2,0),W(),$(20,"button",41),Ot("click",function(){Wt(i);let h=Ne();return Zt(h.cambiarVista(h.VistaLogin.RESTABLECER))}),be(21,"i",42),ne(22," Ya tengo el c\xF3digo "),W(),$(23,"div",43)(24,"a",29),Ot("click",function(){Wt(i);let h=Ne();return Zt(h.cambiarVista(h.VistaLogin.LOGIN))}),be(25,"i",30),ne(26," Volver al inicio de sesi\xF3n "),W()()()()}if(t&2){let i=Ne();ie(9),Ln(i.emailRecuperacion),ie(8),zt("disabled",i.cargando),ie(),nt(i.cargando?18:19)}}function Xie(t,n){if(t&1&&($(0,"div",12),ne(1),W()),t&2){let i=Ne(2);ie(),nn(" ",i.formUtilsService.obtenerErrorCampo(i.restablecerForm,"codigoVerificacion")," ")}}function Yie(t,n){if(t&1&&($(0,"div",12),ne(1),W()),t&2){let i=Ne(2);ie(),nn(" ",i.formUtilsService.obtenerErrorCampo(i.restablecerForm,"nuevaContrasena")," ")}}function Kie(t,n){t&1&&(be(0,"span",24),ne(1," Restableciendo... "))}function Jie(t,n){t&1&&(be(0,"i",42),ne(1," Restablecer Contrase\xF1a "))}function Qie(t,n){if(t&1){let i=Hn();$(0,"section",2)(1,"div",3)(2,"h1",4),ne(3,"Restablecer Contrase\xF1a"),W(),$(4,"p",5),ne(5," Ingresa el c\xF3digo que recibiste y tu nueva contrase\xF1a. "),W(),$(6,"p",45),ne(7," Est\xE1s restableciendo la contrase\xF1a para: "),$(8,"strong",34),ne(9),W()()(),$(10,"div",6)(11,"form",7),Ot("ngSubmit",function(){Wt(i);let h=Ne();return Zt(h.restablecerContrasena())}),$(12,"div",8)(13,"div",9)(14,"label",46),ne(15,"C\xF3digo de Verificaci\xF3n *"),W(),be(16,"input",47),tt(17,Xie,2,1,"div",12),W(),$(18,"div",9)(19,"label",48),ne(20,"Nueva Contrase\xF1a *"),W(),$(21,"div",14),be(22,"input",49),$(23,"button",16),Ot("click",function(){Wt(i);let h=Ne();return Zt(h.toggleNuevaContrasena())}),be(24,"i"),W()(),tt(25,Yie,2,1,"div",12),W(),$(26,"div",9)(27,"div",19)(28,"button",20),tt(29,Kie,2,0)(30,Jie,2,0),W()()()()(),$(31,"div",21)(32,"a",29),Ot("click",function(){Wt(i);let h=Ne();return Zt(h.cambiarVista(h.VistaLogin.LOGIN))}),be(33,"i",30),ne(34," Volver al inicio de sesi\xF3n "),W()()()()}if(t&2){let i=Ne();ie(9),Ln(i.emailRecuperacion),ie(2),zt("formGroup",i.restablecerForm),ie(5),Dn("error",i.formUtilsService.campoInvalido(i.restablecerForm,"codigoVerificacion")),ie(),nt(i.formUtilsService.campoInvalido(i.restablecerForm,"codigoVerificacion")?17:-1),ie(5),Dn("error",i.formUtilsService.campoInvalido(i.restablecerForm,"nuevaContrasena")),zt("type",i.mostrarNuevaContrasena?"text":"password"),ie(),Lo("aria-label",i.mostrarNuevaContrasena?"Ocultar contrase\xF1a":"Mostrar contrase\xF1a"),ie(),Ta(i.mostrarNuevaContrasena?"fa-solid fa-eye-slash":"fa-solid fa-eye"),ie(),nt(i.formUtilsService.campoInvalido(i.restablecerForm,"nuevaContrasena")?25:-1),ie(3),zt("disabled",i.cargando||i.restablecerForm.invalid),ie(),nt(i.cargando?29:30)}}var KU=(h=>(h.LOGIN="login",h.RECUPERAR="recuperar",h.EXITO="exito",h.RESTABLECER="restablecer",h))(KU||{}),NS=class t{constructor(n,i,l,h,o,E){this.formBuilder=n;this.authService=i;this.tokenService=l;this.formUtilsService=h;this.mensajeHandlerService=o;this.router=E}loginForm;recuperarForm;restablecerForm;vistaActual="login";VistaLogin=KU;mostrarContrasena=!1;mostrarNuevaContrasena=!1;cargando=!1;emailRecuperacion="";destroy$=new Fn;ngOnInit(){this.crearFormularios()}crearFormularios(){this.loginForm=this.formBuilder.group({email:["",[Pn.required,Pn.email]],contrasena:["",[Pn.required,Pn.minLength(8)]]}),this.recuperarForm=this.formBuilder.group({email:["",[Pn.required,Pn.email]]}),this.restablecerForm=this.formBuilder.group({codigoVerificacion:["",[Pn.required,Pn.minLength(6)]],nuevaContrasena:["",[Pn.required,Pn.minLength(8),this.formUtilsService.contrasenaFuerteValidador()]]},{validators:this.formUtilsService.contrasenasMatchValidador()})}toggleContrasena(){this.mostrarContrasena=!this.mostrarContrasena}toggleNuevaContrasena(){this.mostrarNuevaContrasena=!this.mostrarNuevaContrasena}cambiarVista(n){this.vistaActual=n,n==="login"?(this.loginForm.reset(),this.cargando=!1):n==="recuperar"?(this.recuperarForm.reset(),this.cargando=!1):n==="restablecer"&&(this.restablecerForm.reset(),this.cargando=!1)}login(){if(this.loginForm.invalid){Object.keys(this.loginForm.controls).forEach(i=>{this.loginForm.get(i)?.markAsTouched()}),this.formUtilsService.scrollAlPrimerError();return}this.cargando=!0;let n=this.loginForm.value;this.authService.login(n).pipe(tn(this.destroy$),Si(()=>this.cargando=!1)).subscribe({next:i=>{this.tokenService.login(i.data.token,i.data.refreshToken),this.router.navigate(["/"]).then(()=>window.location.reload())},error:i=>{let l=this.mensajeHandlerService.handleHttpError(i);this.mensajeHandlerService.showError(l)}})}recuperarContrasena(){if(this.recuperarForm.invalid){Object.keys(this.recuperarForm.controls).forEach(i=>{this.recuperarForm.get(i)?.markAsTouched()});return}this.cargando=!0;let n=this.recuperarForm.value;this.emailRecuperacion=n.email,this.authService.solicitarRecuperacion(n).pipe(tn(this.destroy$),Si(()=>this.cargando=!1)).subscribe({next:i=>{this.mensajeHandlerService.showSuccessWithCallback(i.data,"",()=>{this.cambiarVista("exito")})},error:i=>{let l=this.mensajeHandlerService.handleHttpError(i);this.mensajeHandlerService.showError(l)}})}reenviarEmail(){if(!this.emailRecuperacion)return;this.cargando=!0;let n={email:this.emailRecuperacion};this.authService.solicitarRecuperacion(n).pipe(tn(this.destroy$),Si(()=>this.cargando=!1)).subscribe({next:i=>{this.mensajeHandlerService.showSuccess(i.data)},error:i=>{let l=this.mensajeHandlerService.handleHttpError(i);this.mensajeHandlerService.showError(l)}})}restablecerContrasena(){if(this.restablecerForm.invalid){Object.keys(this.restablecerForm.controls).forEach(i=>{this.restablecerForm.get(i)?.markAsTouched()});return}this.cargando=!0;let n={email:this.emailRecuperacion,codigoVerificacion:this.restablecerForm.value.codigoVerificacion,nuevaContrasena:this.restablecerForm.value.nuevaContrasena};this.authService.reiniciarContrasena(n).pipe(tn(this.destroy$),Si(()=>this.cargando=!1)).subscribe({next:i=>{this.mensajeHandlerService.showSuccessWithCallback(i.data,"",()=>{this.cambiarVista("login")})},error:i=>{let l=this.mensajeHandlerService.handleHttpError(i);this.mensajeHandlerService.showError(l)}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(i){return new(i||t)(wt(Ld),wt(Op),wt(Ar),wt(Nl),wt(rs),wt(br))};static \u0275cmp=Ai({type:t,selectors:[["app-login"]],decls:6,vars:4,consts:[[1,"container","dashboard-container"],[1,"login-container",2,"display","flex","justify-content","center","align-items","flex-start","min-height","calc(100vh - 200px)","padding","2rem 0"],[1,"dashboard-content",2,"width","100%","max-width","800px","margin","0"],[1,"content-header",2,"text-align","center","margin-bottom","3rem"],[2,"font-size","2.5rem","margin-bottom","1rem"],[2,"font-size","1.2rem","color","#7F8C8D"],[1,"form-container"],["novalidate","",3,"ngSubmit","formGroup"],[1,"form-grid",2,"max-width","700px","margin","0 auto"],[1,"form-group","full-width"],["for","email"],["type","email","id","email","formControlName","email","placeholder","tu@email.com","autocomplete","email"],[1,"error-message","show"],["for","contrasena"],[1,"password-input-container",2,"position","relative"],["id","contrasena","formControlName","contrasena","placeholder","Tu contrase\xF1a","autocomplete","current-password",3,"type"],["type","button",1,"password-toggle",2,"position","absolute","right","12px","top","50%","transform","translateY(-50%)","background","none","border","none","color","#7F8C8D","cursor","pointer",3,"click"],[2,"display","flex","justify-content","flex-end","align-items","center"],[2,"color","var(--primary-color)","font-weight","500","text-decoration","none","font-size","0.9rem","cursor","pointer",3,"click"],[2,"display","flex","justify-content","center"],["type","submit",1,"btn","btn-primary",2,"width","300px","padding","16px 24px","font-size","1.1rem",3,"disabled"],[2,"text-align","center","margin-top","2rem","padding-top","2rem","border-top","2px solid var(--light-green)","max-width","700px","margin-left","auto","margin-right","auto"],[2,"font-size","1.1rem"],["routerLink","/registro",2,"color","var(--primary-color)","font-weight","600"],[1,"loading-spinner"],[1,"fa-solid","fa-right-to-bracket"],[3,"ngSubmit","formGroup"],["for","resetEmail"],["type","email","id","resetEmail","formControlName","email","placeholder","tu@email.com"],[2,"color","var(--primary-color)","font-weight","600","font-size","1.1rem","cursor","pointer",3,"click"],[1,"fa-solid","fa-arrow-left"],[1,"fa-solid","fa-paper-plane"],[2,"color","var(--success-color)","font-size","4rem","margin-bottom","1rem"],[1,"fa-solid","fa-check-circle"],[2,"color","var(--primary-color)"],[1,"form-container",2,"text-align","center","max-width","700px","margin","0 auto"],[2,"background-color","var(--light-green)","border-radius","12px","padding","1.5rem","margin-bottom","2rem"],[2,"margin-bottom","1rem","color","var(--text-color)"],[1,"fa-solid","fa-info-circle"],[2,"color","#7F8C8D","font-size","0.9rem"],["type","button",1,"btn","btn-secondary",3,"click","disabled"],["type","button",1,"btn","btn-primary",2,"margin-top","1rem",3,"click"],[1,"fa-solid","fa-key"],[2,"margin-top","2rem","padding-top","2rem","border-top","2px solid var(--light-green)"],[1,"fa-solid","fa-refresh"],[2,"font-size","1rem","color","#7F8C8D","margin-top","1rem"],["for","codigoVerificacion"],["type","text","id","codigoVerificacion","formControlName","codigoVerificacion","placeholder","Ingresa el c\xF3digo de 6 d\xEDgitos","autocomplete","one-time-code"],["for","nuevaContrasena"],["id","nuevaContrasena","formControlName","nuevaContrasena","placeholder","Tu nueva contrase\xF1a","autocomplete","new-password",3,"type"]],template:function(i,l){i&1&&($(0,"main",0)(1,"div",1),tt(2,Vie,36,13,"section",2),tt(3,Gie,23,6,"section",2),tt(4,Zie,27,3,"section",2),tt(5,Qie,35,14,"section",2),W()()),i&2&&(ie(2),nt(l.vistaActual===l.VistaLogin.LOGIN?2:-1),ie(),nt(l.vistaActual===l.VistaLogin.RECUPERAR?3:-1),ie(),nt(l.vistaActual===l.VistaLogin.EXITO?4:-1),ie(),nt(l.vistaActual===l.VistaLogin.RESTABLECER?5:-1))},dependencies:[Nd,Fd,Ps,ca,kd,Lc,Ou,Mr,ns],styles:[".error-message[_ngcontent-%COMP%]{color:var(--danger-color);font-size:.85rem;margin-top:.5rem;display:none;animation:fadeInError .3s ease-in-out}.error-message.show[_ngcontent-%COMP%]{display:block}.form-group[_ngcontent-%COMP%]   input.error[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   select.error[_ngcontent-%COMP%]{border-color:var(--danger-color);box-shadow:0 0 0 3px #e74c3c1a;animation:_ngcontent-%COMP%_shake .5s ease-in-out}@keyframes _ngcontent-%COMP%_shake{0%,to{transform:translate(0)}10%,30%,50%,70%,90%{transform:translate(-5px)}20%,40%,60%,80%{transform:translate(5px)}}.password-toggle[_ngcontent-%COMP%]:hover{color:var(--primary-color)}.login-container[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .5s ease-in-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.loading-spinner[_ngcontent-%COMP%]{display:inline-block;width:16px;height:16px;border:2px solid #ffffff;border-radius:50%;border-top-color:transparent;animation:_ngcontent-%COMP%_spin 1s ease-in-out infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}input[_ngcontent-%COMP%]:focus-visible, button[_ngcontent-%COMP%]:focus-visible, a[_ngcontent-%COMP%]:focus-visible{outline:3px solid var(--primary-color);outline-offset:2px}"]})};function ere(t,n){if(t&1&&($(0,"div",12),ne(1),W()),t&2){let i=Ne();ie(),nn(" ",i.formUtilsService.obtenerErrorCampo(i.registroForm,"nombre")," ")}}function tre(t,n){if(t&1&&($(0,"div",12),ne(1),W()),t&2){let i=Ne();ie(),nn(" ",i.formUtilsService.obtenerErrorCampo(i.registroForm,"apellido")," ")}}function nre(t,n){if(t&1&&($(0,"div",12),ne(1),W()),t&2){let i=Ne();ie(),nn(" ",i.formUtilsService.obtenerErrorCampo(i.registroForm,"email")," ")}}function ire(t,n){t&1&&be(0,"i",24)}function rre(t,n){t&1&&be(0,"i",24)}function ore(t,n){t&1&&be(0,"i",24)}function sre(t,n){if(t&1&&($(0,"div",12),ne(1),W()),t&2){let i=Ne();ie(),nn(" ",i.formUtilsService.obtenerErrorCampo(i.registroForm,"contrasena")," ")}}function are(t,n){t&1&&($(0,"div",12),ne(1," Las contrase\xF1as no coinciden "),W())}function lre(t,n){if(t&1&&($(0,"div",12),ne(1),W()),t&2){let i=Ne();ie(),nn(" ",i.formUtilsService.obtenerErrorCampo(i.registroForm,"telefono")," ")}}function cre(t,n){if(t&1&&($(0,"div",12),ne(1),W()),t&2){let i=Ne();ie(),nn(" ",i.formUtilsService.obtenerErrorCampo(i.registroForm,"fechaNacimiento")," ")}}function ure(t,n){t&1&&($(0,"div",12),ne(1," Debes aceptar los t\xE9rminos y condiciones "),W())}function dre(t,n){t&1&&(be(0,"span",43),ne(1," Creando cuenta... "))}function hre(t,n){t&1&&(be(0,"i",44),ne(1," Crear mi cuenta "))}var zS=class t{constructor(n,i,l,h,o){this.formBuilder=n;this.authService=i;this.mensajeHandlerService=l;this.formUtilsService=h;this.router=o}registroForm;cargando=!1;mostrarContrasena=!1;mostrarConfirmarContrasena=!1;validacionContrasena={tieneLongitud:!1,tieneMayuscula:!1,tieneNumero:!1};destroy$=new Fn;ngOnInit(){this.crearForm(),this.configurarValidacionContrasena()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}crearForm(){this.registroForm=this.formBuilder.group({nombre:["",[Pn.required,Pn.minLength(2)]],apellido:["",[Pn.required,Pn.minLength(2)]],telefono:["",[Pn.required,Pn.minLength(10),Pn.maxLength(10),Pn.pattern(/^[0-9]{10}$/)]],fechaNacimiento:["",[Pn.required,this.formUtilsService.edadMinimaValidador(18)]],email:["",[Pn.required,Pn.email]],contrasena:["",[Pn.required,Pn.minLength(8),this.formUtilsService.contrasenaFuerteValidador()]],confirmarContrasena:["",[Pn.required]],terminos:[!1,[Pn.requiredTrue]]},{validators:this.formUtilsService.contrasenasMatchValidador()})}configurarValidacionContrasena(){this.registroForm.get("contrasena")?.valueChanges.pipe(tn(this.destroy$)).subscribe(n=>{this.validacionContrasena.tieneLongitud=n?.length>=8,this.validacionContrasena.tieneMayuscula=/[A-Z]/.test(n),this.validacionContrasena.tieneNumero=/\d/.test(n)})}toggleContrasena(){this.mostrarContrasena=!this.mostrarContrasena}toggleConfirmarContrasena(){this.mostrarConfirmarContrasena=!this.mostrarConfirmarContrasena}crearUsuario(){if(this.registroForm.invalid){this.formUtilsService.marcarCamposComoTocados(this.registroForm),this.formUtilsService.scrollAlPrimerError();return}this.cargando=!0;let n={nombre:this.registroForm.value.nombre+" "+this.registroForm.value.apellido,email:this.registroForm.value.email,contrasena:this.registroForm.value.contrasena,telefono:this.registroForm.value.telefono,fechaNacimiento:this.registroForm.value.fechaNacimiento};this.authService.registro(n).pipe(tn(this.destroy$),Si(()=>this.cargando=!1)).subscribe({next:i=>{this.mensajeHandlerService.showSuccessWithCallback(i.data,"",()=>{this.router.navigate(["/login"])})},error:i=>{let l=this.mensajeHandlerService.handleHttpError(i);this.mensajeHandlerService.showError(l)}})}static \u0275fac=function(i){return new(i||t)(wt(Ld),wt(Op),wt(rs),wt(Nl),wt(br))};static \u0275cmp=Ai({type:t,selectors:[["app-registro"]],decls:89,vars:44,consts:[[1,"container","dashboard-container"],[1,"register-layout",2,"display","flex","justify-content","center","align-items","flex-start","min-height","calc(100vh - 200px)","padding","2rem 0"],[1,"dashboard-content",2,"width","100%","max-width","800px","margin","0"],[1,"content-header",2,"text-align","center","margin-bottom","3rem"],[2,"font-size","2.5rem","margin-bottom","1rem"],[2,"font-size","1.2rem","color","#7F8C8D"],[1,"form-container"],["novalidate","",3,"ngSubmit","formGroup"],[1,"form-grid",2,"grid-template-columns","1fr 1fr","gap","2rem","max-width","700px","margin","0 auto"],[1,"form-group"],["for","nombre"],["type","text","id","nombre","formControlName","nombre","placeholder","Tu nombre","autocomplete","given-name"],[1,"error-message","show"],["for","apellido"],["type","text","id","apellido","formControlName","apellido","placeholder","Tu apellido","autocomplete","family-name"],[1,"form-group","full-width"],["for","email"],["type","email","id","email","formControlName","email","placeholder","tu@email.com","autocomplete","email"],["for","contrasena"],[1,"password-input-container",2,"position","relative"],["id","contrasena","formControlName","contrasena","placeholder","M\xEDnimo 8 caracteres","autocomplete","new-password",3,"type"],["type","button",1,"password-toggle",2,"position","absolute","right","12px","top","50%","transform","translateY(-50%)","background","none","border","none","color","#7F8C8D","cursor","pointer",3,"click"],[1,"password-requirements"],[1,"fa-solid","fa-info-circle"],[1,"fa-solid","fa-check"],["for","confirmarContrasena"],["id","confirmarContrasena","formControlName","confirmarContrasena","placeholder","Repite tu contrase\xF1a","autocomplete","new-password",3,"type"],["for","telefono"],["type","tel","id","telefono","formControlName","telefono","placeholder","300 123 4567","autocomplete","tel"],["for","fechaNacimiento"],["type","date","id","fechaNacimiento","formControlName","fechaNacimiento","autocomplete","bday",3,"max","min"],[1,"form-group","full-width",2,"display","block !important","flex-direction","initial !important"],[2,"display","table","width","100%"],[2,"display","table-cell","width","20px","vertical-align","top","padding-top","3px"],["type","checkbox","id","terminos","formControlName","terminos",2,"margin","0","padding","0","cursor","pointer"],[2,"display","table-cell","vertical-align","top","padding-left","8px"],["for","terminos",2,"font-weight","400","line-height","1.5","cursor","pointer","margin","0","display","block"],["href","#",2,"color","var(--primary-color)","font-weight","600",3,"click"],[1,"form-navigation",2,"justify-content","center","border-top","none","padding-top","2rem","max-width","700px","margin","0 auto"],["type","submit",1,"btn","btn-primary",2,"width","300px","padding","16px 24px","font-size","1.1rem",3,"disabled"],[2,"text-align","center","margin-top","2rem","padding-top","2rem","border-top","2px solid var(--light-green)","max-width","700px","margin-left","auto","margin-right","auto"],[2,"font-size","1.1rem"],["routerLink","/login",2,"color","var(--primary-color)","font-weight","600"],[1,"loading-spinner"],[1,"fa-solid","fa-user-plus"]],template:function(i,l){if(i&1&&($(0,"main",0)(1,"div",1)(2,"section",2)(3,"div",3)(4,"h1",4),ne(5,"\xDAnete a CloudHouse"),W(),$(6,"p",5),ne(7,"Crea tu cuenta y comienza tu aventura"),W()(),$(8,"div",6)(9,"form",7),Ot("ngSubmit",function(){return l.crearUsuario()}),$(10,"div",8)(11,"div",9)(12,"label",10),ne(13,"Nombre *"),W(),be(14,"input",11),tt(15,ere,2,1,"div",12),W(),$(16,"div",9)(17,"label",13),ne(18,"Apellido *"),W(),be(19,"input",14),tt(20,tre,2,1,"div",12),W(),$(21,"div",15)(22,"label",16),ne(23,"Correo Electr\xF3nico *"),W(),be(24,"input",17),tt(25,nre,2,1,"div",12),W(),$(26,"div",15)(27,"label",18),ne(28,"Contrase\xF1a *"),W(),$(29,"div",19),be(30,"input",20),$(31,"button",21),Ot("click",function(){return l.toggleContrasena()}),be(32,"i"),W()(),$(33,"div",22)(34,"p"),be(35,"i",23),ne(36," Debe contener al menos:"),W(),$(37,"ul")(38,"li"),tt(39,ire,1,0,"i",24),ne(40," 8 caracteres "),W(),$(41,"li"),tt(42,rre,1,0,"i",24),ne(43," 1 letra may\xFAscula "),W(),$(44,"li"),tt(45,ore,1,0,"i",24),ne(46," 1 n\xFAmero "),W()()(),tt(47,sre,2,1,"div",12),W(),$(48,"div",15)(49,"label",25),ne(50,"Confirmar Contrase\xF1a *"),W(),$(51,"div",19),be(52,"input",26),$(53,"button",21),Ot("click",function(){return l.toggleConfirmarContrasena()}),be(54,"i"),W()(),tt(55,are,2,0,"div",12),W(),$(56,"div",9)(57,"label",27),ne(58,"Tel\xE9fono *"),W(),be(59,"input",28),tt(60,lre,2,1,"div",12),W(),$(61,"div",9)(62,"label",29),ne(63,"Fecha de Nacimiento *"),W(),be(64,"input",30),tt(65,cre,2,1,"div",12),W(),$(66,"div",31)(67,"div",32)(68,"div",33),be(69,"input",34),W(),$(70,"div",35)(71,"label",36),ne(72," Acepto los "),$(73,"a",37),Ot("click",function(o){return o.preventDefault()}),ne(74,"T\xE9rminos y Condiciones"),W(),ne(75," y la "),$(76,"a",37),Ot("click",function(o){return o.preventDefault()}),ne(77,"Pol\xEDtica de Privacidad"),W(),ne(78," de CloudHouse * "),W()()(),tt(79,ure,2,0,"div",12),W()(),$(80,"div",38)(81,"button",39),tt(82,dre,2,0)(83,hre,2,0),W()()(),$(84,"div",40)(85,"p",41),ne(86," \xBFYa tienes una cuenta? "),$(87,"a",42),ne(88,"Inicia Sesi\xF3n"),W()()()()()()()),i&2){let h,o;ie(9),zt("formGroup",l.registroForm),ie(5),Dn("error",l.formUtilsService.campoInvalido(l.registroForm,"nombre")),ie(),nt(l.formUtilsService.campoInvalido(l.registroForm,"nombre")?15:-1),ie(4),Dn("error",l.formUtilsService.campoInvalido(l.registroForm,"apellido")),ie(),nt(l.formUtilsService.campoInvalido(l.registroForm,"apellido")?20:-1),ie(4),Dn("error",l.formUtilsService.campoInvalido(l.registroForm,"email")),ie(),nt(l.formUtilsService.campoInvalido(l.registroForm,"email")?25:-1),ie(5),Dn("error",l.formUtilsService.campoInvalido(l.registroForm,"contrasena")),zt("type",l.mostrarContrasena?"text":"password"),ie(),Lo("aria-label",l.mostrarContrasena?"Ocultar contrase\xF1a":"Mostrar contrase\xF1a"),ie(),Ta(l.mostrarContrasena?"fa-solid fa-eye-slash":"fa-solid fa-eye"),ie(6),Dn("valid",l.validacionContrasena.tieneLongitud),ie(),nt(l.validacionContrasena.tieneLongitud?39:-1),ie(2),Dn("valid",l.validacionContrasena.tieneMayuscula),ie(),nt(l.validacionContrasena.tieneMayuscula?42:-1),ie(2),Dn("valid",l.validacionContrasena.tieneNumero),ie(),nt(l.validacionContrasena.tieneNumero?45:-1),ie(2),nt(l.formUtilsService.campoInvalido(l.registroForm,"contrasena")?47:-1),ie(5),Dn("error",l.formUtilsService.formularioTieneError(l.registroForm,"contrasenasNoCoinciden")&&((h=l.registroForm.get("confirmarContrasena"))==null?null:h.touched)),zt("type",l.mostrarConfirmarContrasena?"text":"password"),ie(),Lo("aria-label",l.mostrarConfirmarContrasena?"Ocultar contrase\xF1a":"Mostrar contrase\xF1a"),ie(),Ta(l.mostrarConfirmarContrasena?"fa-solid fa-eye-slash":"fa-solid fa-eye"),ie(),nt(l.formUtilsService.formularioTieneError(l.registroForm,"contrasenasNoCoinciden")&&((o=l.registroForm.get("confirmarContrasena"))!=null&&o.touched)?55:-1),ie(4),Dn("error",l.formUtilsService.campoInvalido(l.registroForm,"telefono")),ie(),nt(l.formUtilsService.campoInvalido(l.registroForm,"telefono")?60:-1),ie(4),Dn("error",l.formUtilsService.campoInvalido(l.registroForm,"fechaNacimiento")),zt("max",l.formUtilsService.obtenerFechaMaxima())("min",l.formUtilsService.obtenerFechaMinima()),ie(),nt(l.formUtilsService.campoInvalido(l.registroForm,"fechaNacimiento")?65:-1),ie(14),nt(l.formUtilsService.campoInvalido(l.registroForm,"terminos")?79:-1),ie(2),zt("disabled",l.cargando||l.registroForm.invalid),ie(),nt(l.cargando?82:83)}},dependencies:[Nd,Fd,Ps,l1,ca,kd,Lc,Ou,Mr,ns],styles:[".error-message[_ngcontent-%COMP%]{color:var(--danger-color);font-size:.85rem;margin-top:.5rem;display:none;animation:_ngcontent-%COMP%_fadeInError .3s ease-in-out}.error-message.show[_ngcontent-%COMP%]{display:block}@keyframes _ngcontent-%COMP%_fadeInError{0%{opacity:0;transform:translateY(-5px)}to{opacity:1;transform:translateY(0)}}.form-group[_ngcontent-%COMP%]   input.error[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   select.error[_ngcontent-%COMP%]{border-color:var(--danger-color);box-shadow:0 0 0 3px #e74c3c1a;animation:_ngcontent-%COMP%_shake .5s ease-in-out}@keyframes _ngcontent-%COMP%_shake{0%,to{transform:translate(0)}10%,30%,50%,70%,90%{transform:translate(-5px)}20%,40%,60%,80%{transform:translate(5px)}}.password-requirements[_ngcontent-%COMP%]{background-color:var(--light-green);border-radius:12px;padding:1rem;margin-top:.5rem;font-size:.9rem;border:1px solid rgba(46,139,87,.1);transition:all .3s ease}.password-requirements[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:.5rem;color:var(--primary-color);font-weight:600;display:flex;align-items:center;gap:8px}.password-requirements[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin:0;padding-left:0;list-style:none}.password-requirements[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:.5rem;color:var(--text-color);display:flex;align-items:center;gap:8px;padding:6px 10px;border-radius:8px;transition:all .3s ease;background-color:#ffffff80}.password-requirements[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:last-child{margin-bottom:0}.password-requirements[_ngcontent-%COMP%]   li.valid[_ngcontent-%COMP%]{color:var(--success-color);background-color:#2e8b571a;font-weight:600}.password-requirements[_ngcontent-%COMP%]   li.valid[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--success-color);animation:_ngcontent-%COMP%_checkmark .3s ease-in-out}@keyframes _ngcontent-%COMP%_checkmark{0%{transform:scale(0);opacity:0}50%{transform:scale(1.2)}to{transform:scale(1);opacity:1}}.password-input-container[_ngcontent-%COMP%]{position:relative}.password-toggle[_ngcontent-%COMP%]{position:absolute;right:12px;top:50%;transform:translateY(-50%);background:none;border:none;color:#7f8c8d;cursor:pointer;padding:8px;border-radius:6px;transition:all .3s ease}.password-toggle[_ngcontent-%COMP%]:hover{color:var(--primary-color);background-color:var(--light-green)}.password-toggle[_ngcontent-%COMP%]:active{transform:translateY(-50%) scale(.95)}.register-layout[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .5s ease-in-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed;transform:none!important}.btn[_ngcontent-%COMP%]:disabled:hover{transform:none!important}.loading-spinner[_ngcontent-%COMP%]{display:inline-block;width:16px;height:16px;border:2px solid #ffffff;border-radius:50%;border-top-color:transparent;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-right:8px}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}input[type=checkbox][_ngcontent-%COMP%]{width:18px;height:18px;cursor:pointer;accent-color:var(--primary-color)}input[type=checkbox][_ngcontent-%COMP%]:focus{outline:2px solid var(--primary-color);outline-offset:2px}input[type=date][_ngcontent-%COMP%]{cursor:pointer}input[type=date][_ngcontent-%COMP%]::-webkit-calendar-picker-indicator{cursor:pointer;color:var(--primary-color);opacity:.6;transition:opacity .3s ease}input[type=date][_ngcontent-%COMP%]:hover::-webkit-calendar-picker-indicator{opacity:1}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{cursor:pointer}input[_ngcontent-%COMP%]:focus-visible, button[_ngcontent-%COMP%]:focus-visible, a[_ngcontent-%COMP%]:focus-visible{outline:3px solid var(--primary-color);outline-offset:2px}@media (max-width: 768px){.form-grid[_ngcontent-%COMP%]{grid-template-columns:1fr!important}.form-navigation[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%!important}}"]})};var fre=(t,n)=>n.id;function pre(t,n){if(t&1&&ne(0),t&2){let i=Ne(3);nn(" $",i.precioMin," ")}}function mre(t,n){t&1&&ne(0," $0 ")}function gre(t,n){if(t&1&&ne(0),t&2){let i=Ne(3);nn(" $",i.precioMax," ")}}function _re(t,n){t&1&&ne(0," \u221E ")}function vre(t,n){if(t&1&&($(0,"p",25),ne(1," \u{1F4B0} Precio: "),tt(2,pre,1,1)(3,mre,1,0),ne(4," - "),tt(5,gre,1,1)(6,_re,1,0),W()),t&2){let i=Ne(2);ie(2),nt(i.precioMin>0?2:3),ie(3),nt(i.precioMax>0?5:6)}}function yre(t,n){if(t&1&&($(0,"div",18)(1,"p",23),be(2,"i",24),ne(3," Filtros Activos: "),W(),tt(4,vre,7,2,"p",25),W()),t&2){let i=Ne();ie(4),nt(i.precioMin>0||i.precioMax>0?4:-1)}}function xre(t,n){if(t&1&&(be(0,"i",26),ne(1)),t&2){let i=Ne();ie(),nn(" Resultados en ",i.filtrosBase.ciudad," ")}}function bre(t,n){t&1&&(be(0,"i",27),ne(1," Todos los alojamientos "))}function wre(t,n){t&1&&(be(0,"i",28),ne(1," Buscando alojamientos... "))}function Cre(t,n){if(t&1&&(be(0,"i",29),ne(1)),t&2){let i=Ne();ie(),mp(" ",i.totalResultados," alojamiento",i.totalResultados!==1?"s":""," encontrado",i.totalResultados!==1?"s":""," ")}}function Ere(t,n){t&1&&($(0,"div",21),be(1,"div",30),$(2,"p",31),ne(3," Buscando los mejores alojamientos para ti... "),W()())}function Tre(t,n){if(t&1){let i=Hn();$(0,"div",22),be(1,"i",32),$(2,"h3"),ne(3,"Error al cargar resultados"),W(),$(4,"p"),ne(5,"Hubo un problema al buscar alojamientos. Por favor, intenta de nuevo."),W(),$(6,"p"),ne(7),W(),$(8,"button",33),Ot("click",function(){Wt(i);let h=Ne();return Zt(h.aplicarFiltros())}),be(9,"i",34),ne(10," Reintentar B\xFAsqueda "),W()()}if(t&2){let i=Ne();ie(7),Ln(i.error)}}function Sre(t,n){if(t&1&&be(0,"app-alojamiento-item",36),t&2){let i=n.$implicit;zt("alojamiento",i)}}function Dre(t,n){if(t&1){let i=Hn();$(0,"li")(1,"a",38),Ot("click",function(){Wt(i);let h=Ne(3);return Zt(h.irAPagina(h.paginaActual-1))}),be(2,"i",39),W()()}}function Ire(t,n){t&1&&($(0,"li")(1,"span"),ne(2,"..."),W()())}function Mre(t,n){if(t&1){let i=Hn();tt(0,Ire,3,0,"li"),$(1,"li")(2,"a",40),Ot("click",function(){let h=Wt(i).$implicit,o=Ne(3);return Zt(o.irAPagina(h))}),ne(3),W()()}if(t&2){let i=n.$implicit,l=n.$index,h=Ne(3);nt(h.mostrarEllipsis(l,h.generarPaginas())?0:-1),ie(2),Dn("active",i===h.paginaActual),zt("title","Ir a p\xE1gina "+(i+1)),ie(),nn(" ",i+1," ")}}function Are(t,n){if(t&1){let i=Hn();$(0,"li")(1,"a",41),Ot("click",function(){Wt(i);let h=Ne(3);return Zt(h.irAPagina(h.paginaActual+1))}),be(2,"i",42),W()()}}function Pre(t,n){if(t&1&&($(0,"nav",37)(1,"ul"),tt(2,Dre,3,0,"li"),Ri(3,Mre,4,5,null,null,ra),tt(5,Are,3,0,"li"),W()()),t&2){let i=Ne(2);ie(2),nt(i.paginaActual>0?2:-1),ie(),ki(i.generarPaginas()),ie(2),nt(i.paginaActual<i.totalPaginas-1?5:-1)}}function Ore(t,n){if(t&1&&($(0,"div",35),Ri(1,Sre,1,1,"app-alojamiento-item",36,fre),W(),tt(3,Pre,6,2,"nav",37)),t&2){let i=Ne();ie(),ki(i.alojamientos),ie(2),nt(i.totalPaginas>1?3:-1)}}function Rre(t,n){if(t&1){let i=Hn();$(0,"div",22),be(1,"i",43),$(2,"h3"),ne(3,"No se encontraron resultados"),W(),$(4,"p"),ne(5," No hay alojamientos que coincidan con tu b\xFAsqueda. Intenta ajustar los filtros o cambiar los criterios. "),W(),$(6,"div",44)(7,"button",33),Ot("click",function(){Wt(i);let h=Ne();return Zt(h.limpiarFiltros())}),be(8,"i",17),ne(9," Limpiar Filtros "),W()()()}}var BS=class t{constructor(n,i){this.route=n;this.alojamientoService=i}alojamientos=[];totalResultados=0;filtrosBase={};precioMin=0;precioMax=0;paginaActual=0;totalPaginas=0;ITEMS_POR_PAGINA=10;cargando=!1;errorCarga=!1;error="";destroy$=new Fn;ngOnInit(){this.suscribirAQueryParams()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}suscribirAQueryParams(){this.route.queryParams.pipe(tn(this.destroy$)).subscribe(n=>{this.filtrosBase={},n.ciudad&&(this.filtrosBase.ciudad=n.ciudad),n.fechaEntrada&&(this.filtrosBase.fechaEntrada=n.fechaEntrada),n.fechaSalida&&(this.filtrosBase.fechaSalida=n.fechaSalida),n.huespedes&&(this.filtrosBase.huespedes=+n.huespedes),n.servicios&&(this.filtrosBase.servicios=n.servicios.split(",").filter(i=>i)),this.paginaActual=0,this.buscarAlojamientos()})}buscarAlojamientos(){this.cargando=!0,this.errorCarga=!1;let n=Jt({},this.filtrosBase);this.precioMin>0&&(n.precioMin=this.precioMin),this.precioMax>0&&(n.precioMax=this.precioMax),this.alojamientoService.obtenerAlojamientos(n,this.paginaActual).pipe(tn(this.destroy$),Si(()=>this.cargando=!1)).subscribe({next:i=>{this.alojamientos=i.data||[],this.totalResultados=this.alojamientos.length,this.calcularPaginas()},error:i=>{console.error("Error al buscar alojamientos:",i),this.error=i.error.data,this.errorCarga=!0}})}aplicarFiltros(){this.paginaActual=0,this.buscarAlojamientos()}limpiarFiltros(){this.precioMin=0,this.precioMax=0,this.aplicarFiltros()}calcularPaginas(){this.totalPaginas=Math.ceil(this.totalResultados/this.ITEMS_POR_PAGINA)}irAPagina(n){n>=0&&n<this.totalPaginas&&(this.paginaActual=n,this.buscarAlojamientos(),window.scrollTo({top:0,behavior:"smooth"}))}generarPaginas(){let n=[];for(let l=0;l<this.totalPaginas;l++)(l===0||l===this.totalPaginas-1||l>=this.paginaActual-2&&l<=this.paginaActual+2)&&n.push(l);return n}mostrarEllipsis(n,i){return n===0?!1:i[n]-i[n-1]>1}static \u0275fac=function(i){return new(i||t)(wt(la),wt(As))};static \u0275cmp=Ai({type:t,selectors:[["app-busqueda"]],decls:42,vars:9,consts:[[1,"container"],[1,"search-bar-section"],[2,"text-align","center","color","var(--dark-green)","margin-bottom","2rem","font-size","2rem"],[1,"search-page-container"],[1,"filters-sidebar"],[1,"fa-solid","fa-sliders"],[1,"filter-group"],[1,"fa-solid","fa-dollar-sign"],[1,"price-range"],["type","number","placeholder","M\xEDnimo","min","0","step","10000",3,"ngModelChange","ngModel"],["type","number","placeholder","M\xE1ximo","min","0","step","10000",3,"ngModelChange","ngModel"],[2,"font-size","0.85rem","color","#7F8C8D","margin-top","0.5rem"],[1,"fa-solid","fa-info-circle"],[2,"display","flex","flex-direction","column","gap","8px","margin-top","1.5rem"],["type","button",1,"btn","btn-primary","filter-btn",3,"click"],[1,"fa-solid","fa-check"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"fa-solid","fa-rotate-left"],[2,"margin-top","1rem","padding","1rem","background-color","var(--light-green)","border-radius","12px"],[1,"results-section"],[1,"results-header"],[1,"loading-container",2,"text-align","center","padding","4rem 2rem"],[1,"empty-state"],[2,"font-size","0.9rem","color","var(--primary-color)","font-weight","600","margin-bottom","0.5rem"],[1,"fa-solid","fa-filter"],[2,"font-size","0.85rem","color","var(--text-color)","margin","0"],[1,"fa-solid","fa-location-dot"],[1,"fa-solid","fa-house"],[1,"fa-solid","fa-spinner","fa-spin"],[1,"fa-solid","fa-check-circle"],[1,"loading-spinner-large"],[2,"color","var(--text-color)","font-size","1.1rem","margin-top","1rem"],[1,"fa-solid","fa-exclamation-triangle",2,"color","var(--danger-color)"],["type","button",1,"btn","btn-primary",3,"click"],[1,"fa-solid","fa-rotate-right"],[1,"accommodations-grid"],[3,"alojamiento"],[1,"pagination"],["title","P\xE1gina anterior",2,"cursor","pointer",3,"click"],[1,"fa-solid","fa-chevron-left"],[2,"cursor","pointer",3,"click","title"],["title","P\xE1gina siguiente",2,"cursor","pointer",3,"click"],[1,"fa-solid","fa-chevron-right"],[1,"fa-solid","fa-magnifying-glass"],[2,"display","flex","gap","1rem","justify-content","center","flex-wrap","wrap"]],template:function(i,l){i&1&&($(0,"main",0)(1,"section",1)(2,"h2",2),ne(3," Encuentra el lugar perfecto "),W(),be(4,"app-barra-busqueda"),W(),$(5,"div",3)(6,"aside",4)(7,"h3"),be(8,"i",5),ne(9," Filtros Adicionales "),W(),$(10,"div",6)(11,"h4"),be(12,"i",7),ne(13," Rango de Precios "),W(),$(14,"div",8)(15,"input",9),Rl("ngModelChange",function(o){return oc(l.precioMin,o)||(l.precioMin=o),o}),W(),$(16,"span"),ne(17,"-"),W(),$(18,"input",10),Rl("ngModelChange",function(o){return oc(l.precioMax,o)||(l.precioMax=o),o}),W()(),$(19,"p",11),be(20,"i",12),ne(21," Precio por noche en COP "),W()(),$(22,"div",13)(23,"button",14),Ot("click",function(){return l.aplicarFiltros()}),be(24,"i",15),ne(25," Aplicar Filtros "),W(),$(26,"button",16),Ot("click",function(){return l.limpiarFiltros()}),be(27,"i",17),ne(28," Limpiar Filtros "),W()(),tt(29,yre,5,1,"div",18),W(),$(30,"section",19)(31,"div",20)(32,"h2"),tt(33,xre,2,1)(34,bre,2,0),W(),$(35,"p"),tt(36,wre,2,0)(37,Cre,2,3),W()(),tt(38,Ere,4,0,"div",21),tt(39,Tre,11,1,"div",22),tt(40,Ore,4,1),tt(41,Rre,10,0,"div",22),W()()()),i&2&&(ie(15),Ol("ngModel",l.precioMin),ie(3),Ol("ngModel",l.precioMax),ie(11),nt(l.precioMin>0||l.precioMax>0?29:-1),ie(4),nt(l.filtrosBase.ciudad?33:34),ie(3),nt(l.cargando?36:37),ie(2),nt(l.cargando?38:-1),ie(),nt(l.errorCarga&&!l.cargando?39:-1),ie(),nt(!l.cargando&&!l.errorCarga&&l.alojamientos.length>0?40:-1),ie(),nt(!l.cargando&&!l.errorCarga&&l.alojamientos.length===0?41:-1))},dependencies:[Mr,Ap,Ps,Wh,ca,Zh,qh,ev,lv],styles:[".search-bar-section[_ngcontent-%COMP%]{background:linear-gradient(135deg,#2e8b570d,#2e8b571a);padding:3rem 0;margin:2rem 0 3rem;border-radius:30px}.loading-spinner-large[_ngcontent-%COMP%]{display:inline-block;width:48px;height:48px;border:4px solid var(--light-green);border-radius:50%;border-top-color:var(--primary-color);animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:4rem 2rem;background-color:var(--light-green);border-radius:20px;animation:_ngcontent-%COMP%_fadeIn .5s ease-in-out;border:2px dashed rgba(46,139,87,.3)}.empty-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:4rem;color:var(--primary-color);margin-bottom:1.5rem;opacity:.6}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.8rem;color:var(--dark-green);margin-bottom:1rem;font-weight:600}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.1rem;color:#7f8c8d;margin-bottom:2rem;line-height:1.6}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.results-section[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .5s ease-in-out}.filters-sidebar[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideInLeft .5s ease-in-out}@keyframes _ngcontent-%COMP%_slideInLeft{0%{opacity:0;transform:translate(-20px)}to{opacity:1;transform:translate(0)}}.filter-group[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;color:var(--primary-color)}.filter-group[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1rem}.service-item[_ngcontent-%COMP%]{padding:.8rem;border-radius:8px;cursor:pointer;transition:all .3s ease;background-color:#ffffff80;border:1px solid transparent;margin-bottom:.5rem}.service-item[_ngcontent-%COMP%]:hover{background-color:var(--light-green);border-color:var(--primary-color);transform:translate(4px)}.service-item[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:18px;height:18px;cursor:pointer;accent-color:var(--primary-color)}.service-item[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{cursor:pointer;margin:0;display:flex;align-items:center;gap:8px;font-size:.95rem;color:var(--text-color);font-weight:500;width:100%}.service-item[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--primary-color);width:18px;flex-shrink:0}.filter-btn[_ngcontent-%COMP%]{transition:all .3s cubic-bezier(.4,0,.2,1)}.filter-btn[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 6px 20px #2e8b5766}.filter-btn[_ngcontent-%COMP%]:active{transform:translateY(0)}.pagination[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .5s ease-in-out .3s both}.pagination[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;flex-wrap:wrap;justify-content:center}.pagination[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:block;padding:12px 16px;color:#7f8c8d;font-weight:600}.pagination[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;min-width:44px;height:44px;transition:all .3s ease}.pagination[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{transform:translateY(-2px)}.pagination[_ngcontent-%COMP%]   a.active[_ngcontent-%COMP%]{transform:translateY(0) scale(1.1);box-shadow:0 4px 12px #2e8b574d}.results-header[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .5s ease-in-out .1s both}.results-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.results-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--primary-color)}.results-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:6px}.accommodations-grid[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .5s ease-in-out .2s both}.accommodations-grid[_ngcontent-%COMP%]   app-alojamiento-item[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeInUp .5s ease-in-out backwards}.accommodations-grid[_ngcontent-%COMP%]   app-alojamiento-item[_ngcontent-%COMP%]:nth-child(1){animation-delay:.05s}.accommodations-grid[_ngcontent-%COMP%]   app-alojamiento-item[_ngcontent-%COMP%]:nth-child(2){animation-delay:.1s}.accommodations-grid[_ngcontent-%COMP%]   app-alojamiento-item[_ngcontent-%COMP%]:nth-child(3){animation-delay:.15s}.accommodations-grid[_ngcontent-%COMP%]   app-alojamiento-item[_ngcontent-%COMP%]:nth-child(4){animation-delay:.2s}.accommodations-grid[_ngcontent-%COMP%]   app-alojamiento-item[_ngcontent-%COMP%]:nth-child(5){animation-delay:.25s}.accommodations-grid[_ngcontent-%COMP%]   app-alojamiento-item[_ngcontent-%COMP%]:nth-child(6){animation-delay:.3s}.accommodations-grid[_ngcontent-%COMP%]   app-alojamiento-item[_ngcontent-%COMP%]:nth-child(7){animation-delay:.35s}.accommodations-grid[_ngcontent-%COMP%]   app-alojamiento-item[_ngcontent-%COMP%]:nth-child(8){animation-delay:.4s}@keyframes _ngcontent-%COMP%_fadeInUp{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}@media (max-width: 1024px){.search-page-container[_ngcontent-%COMP%]{grid-template-columns:1fr}.filters-sidebar[_ngcontent-%COMP%]{position:relative;top:0;margin-bottom:2rem}}@media (max-width: 768px){.search-bar-section[_ngcontent-%COMP%]{padding:2rem 1rem;margin:1rem 0 2rem}.search-bar-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.5rem;margin-bottom:1.5rem}.results-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.6rem;flex-direction:column;align-items:flex-start;gap:8px}.price-range[_ngcontent-%COMP%]{flex-direction:column}.price-range[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:none}.filter-btn[_ngcontent-%COMP%]{font-size:.9rem;padding:10px 16px}.pagination[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{min-width:38px;height:38px;font-size:.9rem}.empty-state[_ngcontent-%COMP%]{padding:3rem 1.5rem}.empty-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:3rem}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.5rem}}*[_ngcontent-%COMP%]{transition-timing-function:cubic-bezier(.4,0,.2,1)}button[_ngcontent-%COMP%]:focus-visible, a[_ngcontent-%COMP%]:focus-visible, input[_ngcontent-%COMP%]:focus-visible, label[_ngcontent-%COMP%]:focus-visible{outline:3px solid var(--primary-color);outline-offset:2px}.loading-container[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulse 1.5s ease-in-out infinite}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1}50%{opacity:.7}}html[_ngcontent-%COMP%]{scroll-behavior:smooth}"]})};var u1=ep(_g());var kre=Math.pow(10,8)*24*60*60*1e3,rIe=-kre,JU=6048e5,QU=864e5,jS=6e4,e6=36e5;var Fre=3600;var t6=Fre*24,oIe=t6*7,Lre=t6*365.2425,Nre=Lre/12,sIe=Nre*3,xR=Symbol.for("constructDateFrom");function Po(t,n){return typeof t=="function"?t(n):t&&typeof t=="object"&&xR in t?t[xR](n):t instanceof Date?new t.constructor(n):new Date(n)}function qn(t,n){return Po(n||t,t)}function cv(t,n,i){let l=qn(t,i?.in);return isNaN(n)?Po(i?.in||t,NaN):(n&&l.setDate(l.getDate()+n),l)}function Rp(t,n,i){let l=qn(t,i?.in);if(isNaN(n))return Po(i?.in||t,NaN);if(!n)return l;let h=l.getDate(),o=Po(i?.in||t,l.getTime());o.setMonth(l.getMonth()+n+1,0);let E=o.getDate();return h>=E?o:(l.setFullYear(o.getFullYear(),o.getMonth(),h),l)}function VS(t,n,i){return Po(i?.in||t,+qn(t)+n)}function n6(t,n,i){return VS(t,n*e6,i)}var zre={};function US(){return zre}function HS(t,n){let i=US(),l=n?.weekStartsOn??n?.locale?.options?.weekStartsOn??i.weekStartsOn??i.locale?.options?.weekStartsOn??0,h=qn(t,n?.in),o=h.getDay(),E=(o<l?7:0)+o-l;return h.setDate(h.getDate()-E),h.setHours(0,0,0,0),h}function vg(t,n){return HS(t,Mi(Jt({},n),{weekStartsOn:1}))}function i6(t,n){let i=qn(t,n?.in),l=i.getFullYear(),h=Po(i,0);h.setFullYear(l+1,0,4),h.setHours(0,0,0,0);let o=vg(h),E=Po(i,0);E.setFullYear(l,0,4),E.setHours(0,0,0,0);let A=vg(E);return i.getTime()>=o.getTime()?l+1:i.getTime()>=A.getTime()?l:l-1}function bR(t){let n=qn(t),i=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()));return i.setUTCFullYear(n.getFullYear()),+t-+i}function kp(t,...n){let i=Po.bind(null,t||n.find(l=>typeof l=="object"));return n.map(i)}function Nc(t,n){let i=qn(t,n?.in);return i.setHours(0,0,0,0),i}function r6(t,n,i){let[l,h]=kp(i?.in,t,n),o=Nc(l),E=Nc(h),A=+o-bR(o),L=+E-bR(E);return Math.round((A-L)/QU)}function o6(t,n){let i=i6(t,n),l=Po(n?.in||t,0);return l.setFullYear(i,0,4),l.setHours(0,0,0,0),vg(l)}function s6(t,n,i){let l=qn(t,i?.in);return l.setTime(l.getTime()+n*jS),l}function a6(t,n,i){return VS(t,n*1e3,i)}function $S(t,n,i){return cv(t,n*7,i)}function l6(t,n){let i,l=n?.in;return t.forEach(h=>{!l&&typeof h=="object"&&(l=Po.bind(null,h));let o=qn(h,l);(!i||i<o||isNaN(+o))&&(i=o)}),Po(l,i||NaN)}function c6(t,n,i){let[l,h]=kp(i?.in,t,n);return+Nc(l)==+Nc(h)}function d6(t,n,i){let[l,h]=kp(i?.in,t,n),o=u6(l,h),E=Math.abs(r6(l,h));l.setDate(l.getDate()-o*E);let A=+(u6(l,h)===-o),L=o*(E-A);return L===0?0:L}function u6(t,n){let i=t.getFullYear()-n.getFullYear()||t.getMonth()-n.getMonth()||t.getDate()-n.getDate()||t.getHours()-n.getHours()||t.getMinutes()-n.getMinutes()||t.getSeconds()-n.getSeconds()||t.getMilliseconds()-n.getMilliseconds();return i<0?-1:i>0?1:i}function GS(t){return n=>{let l=(t?Math[t]:Math.trunc)(n);return l===0?0:l}}function qS(t,n){return+qn(t)-+qn(n)}function h6(t,n,i){let l=qS(t,n)/jS;return GS(i?.roundingMethod)(l)}function uv(t,n){let i=qn(t,n?.in);return i.setHours(23,59,59,999),i}function f6(t,n){let i=qn(t,n?.in),l=i.getMonth();return i.setFullYear(i.getFullYear(),l+1,0),i.setHours(23,59,59,999),i}function p6(t,n,i){let l=qS(t,n)/1e3;return GS(i?.roundingMethod)(l)}function m6(t,n){let i=qn(t,n?.in);return i.setDate(1),i.setHours(0,0,0,0),i}function g6(t,n){let i=US(),l=n?.weekStartsOn??n?.locale?.options?.weekStartsOn??i.weekStartsOn??i.locale?.options?.weekStartsOn??0,h=qn(t,n?.in),o=h.getDay(),E=(o<l?-7:0)+6-(o-l);return h.setDate(h.getDate()+E),h.setHours(23,59,59,999),h}function _6(t,n){let i=qn(t,n?.in),l=+vg(i)-+o6(i);return Math.round(l/JU)+1}function v6(t,n){return qn(t,n?.in).getDate()}function y6(t,n){return qn(t,n?.in).getDay()}function x6(t,n){let i=qn(t,n?.in),l=i.getFullYear(),h=i.getMonth(),o=Po(i,0);return o.setFullYear(l,h+1,0),o.setHours(0,0,0,0),o.getDate()}function b6(t,n){return qn(t,n?.in).getHours()}function w6(t,n){return qn(t,n?.in).getMinutes()}function C6(t,n){return qn(t,n?.in).getMonth()}function E6(t,n){return qn(t,n?.in).getFullYear()}function T6(t,n){let i=qn(t,n?.in);return i.setSeconds(0,0),i}function S6(t,n,i){let[l,h]=kp(i?.in,t,n);return l.getFullYear()===h.getFullYear()&&l.getMonth()===h.getMonth()}function wR(t,n){let i=qn(t,n?.in);return i.setMilliseconds(0),i}function D6(t,n){return+wR(t)==+wR(n)}function I6(t,n,i){return cv(t,-n,i)}function M6(t,n,i){let l=qn(t,i?.in),h=l.getFullYear(),o=l.getDate(),E=Po(i?.in||t,0);E.setFullYear(h,n,15),E.setHours(0,0,0,0);let A=x6(E);return l.setMonth(n,Math.min(o,A)),l}function A6(t,n,i){let l=qn(t,i?.in);return l.setDate(n),l}function P6(t,n,i){let l=qn(t,i?.in);return l.setHours(n),l}function O6(t,n,i){let l=qn(t,i?.in);return l.setMinutes(n),l}function R6(t,n,i){let l=qn(t,i?.in);return isNaN(+l)?Po(i?.in||t,NaN):(l.setFullYear(n),l)}function dv(t,n,i){return Rp(t,-n,i)}function k6(t,n,i){return $S(t,-n,i)}var Fp=class t{constructor(n){this.http=n}API_URL=`${is.apiUrl}/reservas`;crear(n){return this.http.post(this.API_URL,n)}cancelar(n){return this.http.patch(`${this.API_URL}/${n}/cancelar`,null)}aceptar(n){return this.http.patch(`${this.API_URL}/${n}/aceptar`,null)}rechazar(n){return this.http.patch(`${this.API_URL}/${n}/rechazar`,null)}static \u0275fac=function(i){return new(i||t)(gn(aa))};static \u0275prov=Qt({token:t,factory:t.\u0275fac,providedIn:"root"})};var Lp=ep(L6());var hv=class t{map;markers=[];currentLocation=[-75.6727,4.53252];MAPBOX_TOKEN=is.mapboxToken;destroy$=new Fn;marcadorElemento=document.createElement("div");constructor(){Lp.default.accessToken=this.MAPBOX_TOKEN,this.marcadorElemento.innerHTML=`      <div class="logo-icon">
        <i class="fa-solid fa-house-chimney logo-house"></i>
      </div>`}create(n="map"){return new xi(i=>{this.map&&this.map.remove();let l=h=>{this.map=new Lp.default.Map({container:n,style:"mapbox://styles/mapbox/standard",center:h,zoom:17,pitch:45}),this.map.addControl(new Lp.default.NavigationControl),this.map.addControl(new Lp.default.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0})),this.map.on("load",()=>{console.log("Mapa completamente cargado y listo."),i.next()}),this.map.on("error",o=>{i.error(o)})};return navigator.geolocation?navigator.geolocation.getCurrentPosition(h=>{let{longitude:o,latitude:E}=h.coords;l([o,E])},h=>{console.warn("Error de geolocalizaci\xF3n, usando default:",h.message),l(this.currentLocation)}):(console.warn("Geolocalizaci\xF3n no soportada."),l(this.currentLocation)),()=>{this.map&&(this.map.remove(),this.map=void 0)}})}drawMarkers(n){this.map&&(this.clearMarkers(),n.forEach(({id:i,titulo:l,fotoUrl:h,localizacion:o})=>{let E=`
        <strong>${l}</strong>
        <div>
          <img src="${h}" alt="Imagen" style="width: 100px; height: 100px;">
        </div>
        <a href="/alojamiento/${i}">Ver m\xE1s</a>
      `;new Lp.default.Marker({element:this.marcadorElemento}).setLngLat([o.longitud,o.latitud]).setPopup(new Lp.default.Popup().setHTML(E)).addTo(this.map)}))}get mapInstance(){return this.map}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.map&&(this.map.remove(),this.map=void 0)}addMarker(){return new xi(n=>{if(!this.map){n.error("Mapa no inicializado");return}let i=l=>{this.clearMarkers();let h=new Lp.default.Marker({element:this.marcadorElemento}).setLngLat(l.lngLat).addTo(this.map);this.markers.push(h),n.next(h.getLngLat())};return this.map.on("click",i),()=>{this.map?.off("click",i)}})}clearMarkers(){this.markers.length>0&&(this.markers.forEach(n=>n.remove()),this.markers=[])}static \u0275fac=function(i){return new(i||t)};static \u0275prov=Qt({token:t,factory:t.\u0275fac,providedIn:"root"})};var Os=class t{constructor(n){this.http=n}API_URL=`${is.apiUrl}/usuarios`;crearAnfitrion(n){return this.http.post(`${this.API_URL}/anfitrion`,n)}editar(n,i){return this.http.put(`${this.API_URL}/${n}`,i)}obtener(n){return this.http.get(`${this.API_URL}/${n}`)}obtenerAnfitrion(n){return this.http.get(`${this.API_URL}/${n}/anfitrion`)}eliminar(n){return this.http.delete(`${this.API_URL}/${n}`)}cambiarContrasena(n,i){return this.http.patch(`${this.API_URL}/${n}/contrasena`,i)}obtenerAlojamientosUsuario(n,i=0){return this.http.get(`${this.API_URL}/${n}/alojamientos`,{params:{pagina:i}})}obtenerReservasUsuario(n,i,l,h,o=0){let E=new Ms().set("pagina",o.toString());return i&&(E=E.set("estado",i)),l&&(E=E.set("fechaEntrada",l.toISOString())),h&&(E=E.set("fechaSalida",h.toISOString())),this.http.get(`${this.API_URL}/${n}/reservas`,{params:E})}static \u0275fac=function(i){return new(i||t)(gn(aa))};static \u0275prov=Qt({token:t,factory:t.\u0275fac,providedIn:"root"})};var Bre=()=>["/chat"],jre=t=>({destinatarioId:t}),Vre=(t,n)=>n.id;function Ure(t,n){t&1&&($(0,"main",0)(1,"div",1),be(2,"div",2),$(3,"p",3),ne(4," Cargando informaci\xF3n del alojamiento... "),W()()())}function Hre(t,n){if(t&1){let i=Hn();$(0,"main",0)(1,"div",4),be(2,"i",5),$(3,"h3"),ne(4,"No se pudo cargar el alojamiento"),W(),$(5,"p"),ne(6,"Por favor, verifica tu conexi\xF3n e intenta de nuevo."),W(),$(7,"button",6),Ot("click",function(){Wt(i);let h=Ne();return Zt(h.volver())}),be(8,"i",7),ne(9," Volver "),W()()()}}function $re(t,n){if(t&1&&($(0,"span",11),be(1,"i",44),ne(2),W()),t&2){let i=Ne(2);ie(2),ps(" ",i.metricas.promedioCalificaciones.toFixed(2)," (",i.metricas.totalResenas," rese\xF1as) ")}}function Gre(t,n){if(t&1){let i=Hn();$(0,"img",63),Ot("click",function(){let h=Wt(i).$implicit,o=Ne(2);return Zt(o.cambiarImagenPrincipal(h))}),W()}if(t&2){let i=n.$implicit,l=n.$index,h=Ne(2);zt("src",i,zr)("alt","Vista "+(l+1)+" de "+h.alojamiento.titulo)}}function qre(t,n){t&1&&(be(0,"i",64),ne(1," Wi-Fi "))}function Wre(t,n){t&1&&(be(0,"i",65),ne(1," Piscina "))}function Zre(t,n){t&1&&(be(0,"i",66),ne(1," Desayuno incluido "))}function Xre(t,n){t&1&&(be(0,"i",67),ne(1," Aire acondicionado "))}function Yre(t,n){t&1&&(be(0,"i",68),ne(1," Estacionamiento "))}function Kre(t,n){if(t&1&&(be(0,"i",69),ne(1)),t&2){let i=Ne().$implicit;ie(),nn(" ",i," ")}}function Jre(t,n){if(t&1&&($(0,"li"),tt(1,qre,2,0)(2,Wre,2,0)(3,Zre,2,0)(4,Xre,2,0)(5,Yre,2,0)(6,Kre,2,1),W()),t&2){let i,l=n.$implicit;ie(),nt((i=l)==="WIFI"?1:i==="PISCINA"?2:i==="DESAYUNO"?3:i==="AIRE_ACONDICIONADO"?4:i==="ESTACIONAMIENTO"?5:6)}}function Qre(t,n){if(t&1&&ne(0),t&2){let i=Ne(2);ps(" ",i.metricas.promedioCalificaciones.toFixed(2)," (",i.metricas.totalResenas," rese\xF1as) ")}}function eoe(t,n){t&1&&be(0,"i",75)}function toe(t,n){if(t&1&&($(0,"div",76)(1,"div",78),be(2,"i",79),$(3,"strong"),ne(4,"Respuesta del anfitri\xF3n"),W()(),$(5,"p",80),ne(6),W(),$(7,"p",81),ne(8),W()()),t&2){let i=Ne().$implicit,l=Ne(3);ie(6),Ln(i.respuesta.mensaje),ie(2),nn(" ",l.formatearFechaCorta(i.respuesta.respondidoEn)," ")}}function noe(t,n){if(t&1){let i=Hn();$(0,"div",77)(1,"button",82),Ot("click",function(){Wt(i);let h=Ne().$implicit,o=Ne(3);return Zt(o.responderResena(h))}),be(2,"i",79),ne(3," Responder "),W()()}}function ioe(t,n){if(t&1&&($(0,"div",71)(1,"div",73),be(2,"img",17),$(3,"div")(4,"strong"),ne(5),W(),$(6,"span"),ne(7),W()()(),$(8,"div",74),Ri(9,eoe,1,0,"i",75,ng),W(),$(11,"p"),ne(12),W(),tt(13,toe,9,2,"div",76),tt(14,noe,4,0,"div",77),W()),t&2){let i=n.$implicit,l=Ne(3);ie(2),zt("src",i.usuario.foto||"https://placehold.co/40x40/3f51b5/fff?text="+i.usuario.nombre.charAt(0),zr)("alt","Avatar de "+i.usuario.nombre),ie(3),Ln(i.usuario.nombre),ie(2),Ln(l.formatearFechaCorta(i.creadoEn)),ie(2),ki(l.alojamientoService.generarEstrellas(i.calificacion)),ie(3),Ln(i.comentario),ie(),nt(i.respuesta?13:-1),ie(),nt(l.esAnfitrionPropietario&&!i.respuesta&&l.tokenService.isLogged()?14:-1)}}function roe(t,n){t&1&&(be(0,"span",83),ne(1," Cargando... "))}function ooe(t,n){t&1&&(be(0,"i",84),ne(1," Ver m\xE1s rese\xF1as "))}function soe(t,n){if(t&1){let i=Hn();$(0,"div",72)(1,"button",37),Ot("click",function(){Wt(i);let h=Ne(3);return Zt(h.cargarMasResenas())}),tt(2,roe,2,0)(3,ooe,2,0),W()()}if(t&2){let i=Ne(3);ie(),zt("disabled",i.cargandoResenas),ie(),nt(i.cargandoResenas?2:3)}}function aoe(t,n){if(t&1&&($(0,"div",70),Ri(1,ioe,15,7,"div",71,Vre),W(),tt(3,soe,4,2,"div",72)),t&2){let i=Ne(2);ie(),ki(i.resenas),ie(2),nt(i.hayMasResenas?3:-1)}}function loe(t,n){t&1&&($(0,"p",45),ne(1," A\xFAn no hay rese\xF1as para este alojamiento. \xA1S\xE9 el primero en dejar una! "),W())}function coe(t,n){if(t&1&&($(0,"div",52),ne(1),W()),t&2){let i=Ne(2);ie(),nn(" ",i.formUtilsService.obtenerErrorCampo(i.reservaForm,"fechaEntrada")," ")}}function uoe(t,n){if(t&1&&($(0,"div",52),ne(1),W()),t&2){let i=Ne(2);ie(),nn(" ",i.formUtilsService.obtenerErrorCampo(i.reservaForm,"fechaSalida")," ")}}function doe(t,n){if(t&1&&($(0,"div",52),ne(1),W()),t&2){let i=Ne(2);ie(),nn(" ",i.formUtilsService.obtenerErrorCampo(i.reservaForm,"cantidadHuespedes")," ")}}function hoe(t,n){if(t&1&&($(0,"ul")(1,"li")(2,"span"),ne(3),W(),$(4,"span"),ne(5),W()(),$(6,"li")(7,"span"),ne(8,"Tarifa de servicio"),W(),$(9,"span"),ne(10),W()()(),be(11,"hr"),$(12,"p",85)(13,"span")(14,"strong"),ne(15,"Total"),W()(),$(16,"span")(17,"strong"),ne(18),W()()()),t&2){let i=Ne(2);ie(3),mp("",i.alojamientoService.formatearPrecio(i.alojamiento.precioPorNoche)," x ",i.numeroNoches," noche",i.numeroNoches>1?"s":""),ie(2),Ln(i.alojamientoService.formatearPrecio(i.alojamiento.precioPorNoche*i.numeroNoches)),ie(5),Ln(i.alojamientoService.formatearPrecio(i.tarifaServicio)),ie(8),Ln(i.alojamientoService.formatearPrecio(i.precioTotal))}}function foe(t,n){if(t&1){let i=Hn();$(0,"main",0)(1,"section",8)(2,"div",9)(3,"div")(4,"h1"),ne(5),W(),$(6,"div",10),tt(7,$re,3,2,"span",11),$(8,"span",12),be(9,"i",13),ne(10),W()()(),$(11,"button",14),Ot("click",function(){Wt(i);let h=Ne();return Zt(h.volver())}),be(12,"i",7),ne(13," Volver "),W()()(),$(14,"section",15)(15,"div",16),be(16,"img",17),W(),$(17,"div",18),Ri(18,Gre,1,2,"img",19,ra),W()(),$(20,"div",20)(21,"section",21)(22,"div",22)(23,"div")(24,"h2"),ne(25),W(),$(26,"p",23),be(27,"i",24),ne(28),W()(),$(29,"div",25),be(30,"img",26),$(31,"p",27),be(32,"i",28),$(33,"strong")(34,"a",29),ne(35),be(36,"i",30),W()()()()(),be(37,"hr"),$(38,"div",31)(39,"h3"),ne(40,"Acerca de este lugar"),W(),$(41,"p"),ne(42),W()(),be(43,"hr"),$(44,"div",32)(45,"h3"),ne(46,"Servicios destacados"),W(),$(47,"ul",33),Ri(48,Jre,7,1,"li",null,ra),W()(),be(50,"hr"),$(51,"div",32)(52,"h3"),ne(53,"Localizaci\xF3n"),W(),be(54,"div",34),W(),be(55,"hr"),$(56,"div",32)(57,"h3"),ne(58,"Calendario"),W(),$(59,"div",35)(60,"div",36)(61,"button",37),Ot("click",function(){Wt(i);let h=Ne();return Zt(h.mesAnterior())}),be(62,"i",38),W(),$(63,"button",14),Ot("click",function(){Wt(i);let h=Ne();return Zt(h.hoy())}),ne(64," Hoy "),W(),$(65,"button",14),Ot("click",function(){Wt(i);let h=Ne();return Zt(h.mesSiguiente())}),be(66,"i",39),W()(),$(67,"div",40)(68,"h2"),ne(69),gs(70,"date"),gs(71,"titlecase"),W()()(),$(72,"div",41)(73,"mwl-calendar-month-view",42),Ot("dayClicked",function(h){Wt(i);let o=Ne();return Zt(o.seleccionarDiaCalendario(h.day))}),W()()(),be(74,"hr"),$(75,"div",43)(76,"h3"),be(77,"i",44),tt(78,Qre,1,2),W(),tt(79,aoe,4,1)(80,loe,2,0,"p",45),W()(),$(81,"aside",46)(82,"div",47)(83,"strong"),ne(84),W(),ne(85," / noche "),W(),$(86,"form",48),Ot("ngSubmit",function(){Wt(i);let h=Ne();return Zt(h.realizarReserva())}),$(87,"div",49)(88,"label",50),ne(89,"Check-in *"),W(),be(90,"input",51),tt(91,coe,2,1,"div",52),W(),$(92,"div",49)(93,"label",53),ne(94,"Check-out *"),W(),be(95,"input",54),tt(96,uoe,2,1,"div",52),W(),$(97,"div",49)(98,"label",55),ne(99,"N\xFAmero de hu\xE9spedes *"),W(),be(100,"input",56),$(101,"p",57),ne(102),W(),tt(103,doe,2,1,"div",52),W(),$(104,"button",58),be(105,"i",59),ne(106," Reservar ahora "),W()(),$(107,"div",60)(108,"p",61),be(109,"i",62),ne(110," No se te cobrar\xE1 nada a\xFAn "),W(),tt(111,hoe,19,6),W()()()()}if(t&2){let i=Ne();ie(5),Ln(i.alojamiento.titulo),ie(2),nt(i.metricas?7:-1),ie(3),ps(" ",i.alojamiento.direccion.ciudad,", ",i.alojamiento.direccion.direccion," "),ie(6),zt("src",i.imagenPrincipal,zr)("alt",i.alojamiento.titulo),ie(2),ki(i.imagenesGaleria),ie(7),Ln(i.alojamiento.titulo),ie(3),nn(" Hasta ",i.alojamiento.maxHuespedes," hu\xE9spedes "),ie(2),zt("src",(i.anfitiron==null?null:i.anfitiron.foto)||"https://placehold.co/150x150/2e8b57/fff?text="+i.obtenerIniciales(),zr)("alt","Avatar de "+i.alojamiento.nombreAnfitrion),ie(4),zt("title",Tu("Enviar mensaje a ",i.alojamiento.nombreAnfitrion))("routerLink",ms(46,Bre))("queryParams",ao(47,jre,i.alojamiento.anfitrionId)),ie(),nn(" ",i.alojamiento.nombreAnfitrion," "),ie(7),Ln(i.alojamiento.descripcion),ie(6),ki(i.alojamiento.servicios),ie(13),zt("disabled",i.mesActual),ie(8),Ln(R0(71,44,kl(70,41,i.viewDate,"MMMM yyyy"))),ie(4),zt("viewDate",i.viewDate)("events",i.events)("locale",i.locale)("weekStartsOn",1),ie(5),nt(i.metricas?78:-1),ie(),nt(i.resenas.length>0?79:80),ie(5),Ln(i.alojamientoService.formatearPrecio(i.alojamiento.precioPorNoche)),ie(2),zt("formGroup",i.reservaForm),ie(4),Dn("error",i.formUtilsService.campoInvalido(i.reservaForm,"fechaEntrada")),zt("min",i.formUtilsService.obtenerFechaHoy()),ie(),nt(i.formUtilsService.campoInvalido(i.reservaForm,"fechaEntrada")?91:-1),ie(4),Dn("error",i.formUtilsService.campoInvalido(i.reservaForm,"fechaSalida")),zt("min",i.obtenerFechaMinimaSalida()),ie(),nt(i.formUtilsService.campoInvalido(i.reservaForm,"fechaSalida")?96:-1),ie(4),Dn("error",i.formUtilsService.campoInvalido(i.reservaForm,"cantidadHuespedes")),zt("max",i.alojamiento.maxHuespedes),ie(2),nn(" M\xE1ximo ",i.alojamiento.maxHuespedes," hu\xE9spedes "),ie(),nt(i.formUtilsService.campoInvalido(i.reservaForm,"cantidadHuespedes")?103:-1),ie(),zt("disabled",i.reservaForm.invalid),ie(7),nt(i.numeroNoches>0?111:-1)}}var poe={confirmada:{primary:"#2e8b57",secondary:"#d9f0e3"}},WS=class t{constructor(n,i,l,h,o,E,A,L,Y,le,te){this.route=n;this.router=i;this.location=l;this.formBuilder=h;this.alojamientoService=o;this.reservaService=E;this.tokenService=A;this.mapaService=L;this.mensajeHandlerService=Y;this.formUtilsService=le;this.usuarioService=te;this.route.params.subscribe(ze=>{this.idAlojamiento=ze.id})}anfitiron;alojamiento;metricas;resenas=[];cargando=!1;cargandoResenas=!1;errorCarga=!1;reservaForm;paginaResenas=0;hayMasResenas=!0;idAlojamiento=0;imagenPrincipal="";imagenesGaleria=[];precioTotal=0;tarifaServicio=0;numeroNoches=0;viewDate=new Date;seleccionandoEntrada=!0;mesActual=!0;events=[];locale="es";reservasConfirmadas=[];esAnfitrionPropietario=!1;destroy$=new Fn;ngOnInit(){this.route.params.pipe(tn(this.destroy$)).subscribe(n=>{this.idAlojamiento=+n.id,this.idAlojamiento&&!isNaN(this.idAlojamiento)?(this.crearFormularios(),this.cargarDatosAlojamiento(),this.confirmarMesActual()):this.mensajeHandlerService.showErrorWithCallback("ID de alojamiento no v\xE1lido",()=>{this.router.navigate(["/"]).then(i=>window.location.reload())})})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}crearFormularios(){let n=new Date,i=new Date(n);i.setDate(n.getDate()+1),this.reservaForm=this.formBuilder.group({fechaEntrada:[n.toISOString().split("T")[0],[Pn.required]],fechaSalida:[i.toISOString().split("T")[0],[Pn.required]],cantidadHuespedes:[1,[Pn.required,Pn.min(1)]]}),this.reservaForm.valueChanges.pipe(tn(this.destroy$)).subscribe(()=>{this.calcularPrecioTotal()})}cargarDatosAlojamiento(){this.cargando=!0,this.errorCarga=!1,yd({alojamiento:this.alojamientoService.obtenerPorId(this.idAlojamiento),metricas:this.alojamientoService.obtenerMetricas(this.idAlojamiento),resenas:this.alojamientoService.obtenerResenasAlojamiento(this.idAlojamiento,0),reservasConfirmadas:this.alojamientoService.obtenerReservasAlojamiento(this.idAlojamiento,"CONFIRMADA")}).pipe(tn(this.destroy$),Si(()=>this.cargando=!1)).subscribe({next:n=>{this.alojamiento=n.alojamiento.data,this.metricas=n.metricas.data,this.resenas=n.resenas.data,this.hayMasResenas=n.resenas.data.length>0,this.reservasConfirmadas=n.reservasConfirmadas.data,this.usuarioService.obtener(n.alojamiento.data.anfitrionId).pipe(tn(this.destroy$),Si(()=>this.cargando=!1)).subscribe({next:i=>{this.anfitiron=i.data},error:i=>{let l=this.mensajeHandlerService.handleHttpError(i);this.mensajeHandlerService.showError(l)}}),this.verificarPropietario(),this.reservaForm.get("cantidadHuespedes")?.setValidators([Pn.required,Pn.min(1),Pn.max(this.alojamiento.maxHuespedes)]),this.reservaForm.get("cantidadHuespedes")?.updateValueAndValidity(),this.configurarImagenes(),this.calcularPrecioTotal(),this.inicializarLogicaMapa(),this.actualizarEventosCalendario()},error:n=>{this.errorCarga=!0;let i=this.mensajeHandlerService.handleHttpError(n);this.mensajeHandlerService.showErrorWithCallback(i,()=>{this.router.navigate(["/"]).then(l=>window.location.reload())})}})}verificarPropietario(){if(!this.tokenService.isLogged()||!this.alojamiento){this.esAnfitrionPropietario=!1;return}if(this.anfitiron?.id===this.tokenService.getUserId()){this.esAnfitrionPropietario=!0;return}else{this.esAnfitrionPropietario=!1;return}}inicializarLogicaMapa(){this.mapaService.create("map").pipe(tn(this.destroy$)).subscribe({next:()=>{let n={id:this.idAlojamiento,titulo:this.alojamiento.titulo,fotoUrl:this.alojamiento.imagenes[0],localizacion:{latitud:this.alojamiento.direccion.localizacion.latitud,longitud:this.alojamiento.direccion.localizacion.longitud}};this.mapaService.drawMarkers([n]),this.mapaService.mapInstance?.setCenter([this.alojamiento.direccion.localizacion.longitud,this.alojamiento.direccion.localizacion.latitud])},error:n=>{console.error("No se pudo cargar el mapa",n)}})}configurarImagenes(){this.alojamiento&&this.alojamiento.imagenes.length>0&&(this.imagenPrincipal=this.alojamiento.imagenes[0],this.imagenesGaleria=this.alojamiento.imagenes.slice(1,5))}cargarMasResenas(){this.cargandoResenas||!this.hayMasResenas||(this.cargandoResenas=!0,this.paginaResenas++,this.alojamientoService.obtenerResenasAlojamiento(this.idAlojamiento,this.paginaResenas).pipe(tn(this.destroy$),Si(()=>this.cargandoResenas=!1)).subscribe({next:n=>{let i=n.data;i.length>0?this.resenas=[...this.resenas,...i]:this.hayMasResenas=!1},error:n=>{this.hayMasResenas=!1;let i=this.mensajeHandlerService.handleHttpError(n);this.mensajeHandlerService.showError(i),this.paginaResenas--}}))}responderResena(n){u1.default.fire({title:"Responder Rese\xF1a",html:`
        <div style="text-align: left; margin-bottom: 1rem;">
          <p style="color: var(--text-color); margin-bottom: 0.5rem;">
            <strong>Hu\xE9sped:</strong> ${n.usuario.nombre}
          </p>
          <div style="margin: 0.5rem 0;">
            ${'<i class="fa-solid fa-star" style="color: #F39C12;"></i>'.repeat(n.calificacion)}
          </div>
          <p style="color: var(--text-color); padding: 1rem; background-color: var(--light-green); border-radius: 8px; font-style: italic;">
            "${n.comentario}"
          </p>
        </div>

        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--dark-green); text-align: left;">
          Tu Respuesta *
        </label>
        <textarea
          id="respuesta-mensaje"
          placeholder="Escribe tu respuesta al hu\xE9sped..."
          style="width: 100%; min-height: 120px; padding: 12px; border: 2px solid var(--border-color); border-radius: 12px;); resize: vertical;"
          maxlength="500"></textarea>
        <p style="text-align: right; font-size: 0.85rem; color: #7F8C8D; margin-top: 0.5rem;">
          <span id="char-count">0</span>/500
        </p>
      `,showCancelButton:!0,confirmButtonText:"Publicar Respuesta",cancelButtonText:"Cancelar",confirmButtonColor:"#2e8b57",cancelButtonColor:"#95a5a6",width:"600px",didOpen:()=>{let i=document.getElementById("respuesta-mensaje"),l=document.getElementById("char-count");i?.addEventListener("input",()=>{l&&(l.textContent=i.value.length.toString())})},preConfirm:()=>{let i=document.getElementById("respuesta-mensaje").value;return!i||i.trim().length<10?(u1.default.showValidationMessage("La respuesta debe tener al menos 10 caracteres"),!1):i.length>500?(u1.default.showValidationMessage("La respuesta no puede exceder 500 caracteres"),!1):{mensaje:i.trim()}}}).then(i=>{i.isConfirmed&&i.value&&this.procesarRespuesta(n.id,i.value.mensaje)})}procesarRespuesta(n,i){this.mensajeHandlerService.showLoading("Publicando respuesta...");let l={mensaje:i};this.alojamientoService.responderResena(this.idAlojamiento,n,l).pipe(tn(this.destroy$)).subscribe({next:()=>{this.mensajeHandlerService.showSuccess("Tu respuesta ha sido publicada exitosamente","\xA1Respuesta publicada!"),this.recargarResenas()},error:h=>{this.mensajeHandlerService.closeModal();let o=this.mensajeHandlerService.handleHttpError(h);this.mensajeHandlerService.showError(o)}})}recargarResenas(){this.alojamientoService.obtenerResenasAlojamiento(this.idAlojamiento,0).pipe(tn(this.destroy$)).subscribe({next:n=>{this.resenas=n.data},error:n=>{console.error("Error al recargar rese\xF1as:",n)}})}realizarReserva(){if(this.reservaForm.invalid){this.formUtilsService.marcarCamposComoTocados(this.reservaForm);return}if(!this.tokenService.isLogged()){this.mensajeHandlerService.showErrorWithCallback("Debes iniciar sesi\xF3n para poder reservar.",()=>{this.router.navigate(["/login"]).then(l=>window.location.reload())});return}let n=new Date(this.reservaForm.value.fechaEntrada),i=new Date(this.reservaForm.value.fechaSalida);if(n>=i){this.mensajeHandlerService.showError("La fecha de salida debe ser posterior a la fecha de entrada.");return}u1.default.fire({title:"\xBFConfirmar reserva?",html:`
        <div style="text-align: left;">
          <p><strong>Alojamiento:</strong> ${this.alojamiento.titulo}</p>
          <p><strong>Check-in:</strong> ${this.formatearFecha(n)}</p>
          <p><strong>Check-out:</strong> ${this.formatearFecha(i)}</p>
          <p><strong>Hu\xE9spedes:</strong> ${this.reservaForm.value.cantidadHuespedes}</p>
          <hr>
          <p><strong>Total:</strong> ${this.alojamientoService.formatearPrecio(this.precioTotal)}</p>
        </div>
      `,icon:"question",showCancelButton:!0,confirmButtonText:"Confirmar y pagar",cancelButtonText:"Cancelar",confirmButtonColor:"#2e8b57",cancelButtonColor:"#95a5a6"}).then(l=>{l.isConfirmed&&this.procesarReserva()})}procesarReserva(){if(!this.alojamiento)return;if(!this.tokenService.getUserId()){this.mensajeHandlerService.showError("No se pudo identificar al usuario. Inicia sesi\xF3n de nuevo.");return}this.mensajeHandlerService.showLoading("Estamos procesando tu reserva");let i={alojamientoId:this.idAlojamiento,usuarioId:this.tokenService.getUserId(),fechaEntrada:new Date(this.reservaForm.value.fechaEntrada+"T00:00:00"),fechaSalida:new Date(this.reservaForm.value.fechaSalida+"T00:00:00"),cantidadHuespedes:this.reservaForm.value.cantidadHuespedes};this.reservaService.crear(i).pipe(tn(this.destroy$)).subscribe({next:l=>{this.mensajeHandlerService.closeModal(),this.mensajeHandlerService.showSuccessWithCallback(l.data,"\xA1Reserva exitosa!",()=>{this.router.navigate(["/mis-reservas"]).then(h=>window.location.reload())})},error:l=>{this.mensajeHandlerService.closeModal();let h=this.mensajeHandlerService.handleHttpError(l);this.mensajeHandlerService.showError(h)}})}calcularPrecioTotal(){if(!this.alojamiento)return;let n=new Date(this.reservaForm.value.fechaEntrada),i=new Date(this.reservaForm.value.fechaSalida);n<i?(this.numeroNoches=Math.ceil((i.getTime()-n.getTime())/(1e3*60*60*24)),this.precioTotal=this.alojamiento.precioPorNoche*this.numeroNoches):(this.numeroNoches=0,this.precioTotal=0)}volver(){this.location.back()}mesAnterior(){this.viewDate=dv(this.viewDate,1),this.confirmarMesActual()}mesSiguiente(){this.viewDate=Rp(this.viewDate,1),this.confirmarMesActual()}hoy(){this.viewDate=new Date,this.confirmarMesActual()}seleccionarDiaCalendario(n){let i=n.date,l=new Date(i.getFullYear(),i.getMonth(),i.getDate()),h=this.reservaForm.get("fechaEntrada")?.value,o=this.reservaForm.get("fechaSalida")?.value;if(this.seleccionandoEntrada||!h){let E=this.formatDateForInput(l);if(o){let A=new Date(o+"T00:00:00");l>=new Date(A.getFullYear(),A.getMonth(),A.getDate())?this.reservaForm.patchValue({fechaEntrada:E,fechaSalida:null}):this.reservaForm.patchValue({fechaEntrada:E})}else this.reservaForm.patchValue({fechaEntrada:E,fechaSalida:null});this.seleccionandoEntrada=!1}else{let E=this.formatDateForInput(l),A=new Date((this.reservaForm.get("fechaEntrada")?.value||"")+"T00:00:00"),L=new Date(A.getFullYear(),A.getMonth(),A.getDate());h?l<=L?(this.reservaForm.patchValue({fechaEntrada:E,fechaSalida:null}),this.seleccionandoEntrada=!1):(this.reservaForm.patchValue({fechaSalida:E}),this.seleccionandoEntrada=!0):(this.reservaForm.patchValue({fechaEntrada:E,fechaSalida:null}),this.seleccionandoEntrada=!1)}this.reservaForm.get("fechaEntrada")?.markAsTouched(),this.reservaForm.get("fechaSalida")?.markAsTouched(),this.reservaForm.updateValueAndValidity(),this.calcularPrecioTotal()}confirmarMesActual(){let n=new Date,i=this.viewDate.getMonth()===n.getMonth(),l=this.viewDate.getFullYear()===n.getFullYear();this.mesActual=i&&l}actualizarEventosCalendario(){this.events=this.reservasConfirmadas.map(n=>{let i=poe.confirmada;return{title:n.alojamiento.titulo,start:Nc(this.toLocalDate(n.fechaEntrada)),end:uv(this.toLocalDate(n.fechaSalida)),color:Jt({},i),cssClass:"cal-event-confirmed",meta:{id:n.id}}})}toLocalDate(n){return typeof n=="string"?new Date(n+"T00:00:00"):n}obtenerIniciales(){return this.anfitiron?this.anfitiron.nombre.charAt(0).toUpperCase():"U"}cambiarImagenPrincipal(n){let i=this.imagenPrincipal;this.imagenPrincipal=n;let l=this.imagenesGaleria.indexOf(n);l!==-1&&(this.imagenesGaleria[l]=i)}formatDateForInput(n){let i=n.getFullYear(),l=String(n.getMonth()+1).padStart(2,"0"),h=String(n.getDate()).padStart(2,"0");return`${i}-${l}-${h}`}formatearFecha(n){return new Date(n.getTime()+n.getTimezoneOffset()*6e4).toLocaleDateString("es-CO",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}formatearFechaCorta(n){let i=typeof n=="string"?new Date(n):n;return new Date(i.getTime()+i.getTimezoneOffset()*6e4).toLocaleDateString("es-CO",{year:"numeric",month:"short"})}obtenerFechaMinimaSalida(){this.reservaForm.value.fechaEntrada||this.formUtilsService.obtenerFechaManana();let n=new Date(this.reservaForm.value.fechaEntrada+"T00:00:00");return n.setDate(n.getDate()+1),n.toISOString().split("T")[0]}static \u0275fac=function(i){return new(i||t)(wt(la),wt(br),wt(Fl),wt(Ld),wt(As),wt(Fp),wt(Ar),wt(hv),wt(rs),wt(Nl),wt(Os))};static \u0275cmp=Ai({type:t,selectors:[["app-detalle-alojamiento"]],decls:3,vars:3,consts:[[1,"container","details-page-container"],[1,"loading-container",2,"text-align","center","padding","4rem 2rem"],[1,"loading-spinner-large"],[2,"color","var(--text-color)","font-size","1.1rem","margin-top","1rem"],[1,"empty-state"],[1,"fa-solid","fa-exclamation-triangle",2,"color","var(--danger-color)"],["type","button",1,"btn","btn-primary",3,"click"],[1,"fa-solid","fa-arrow-left"],[1,"title-section"],[2,"display","flex","justify-content","space-between","align-items","start","margin-bottom","1rem"],[1,"title-meta"],[1,"rating"],[1,"location"],[1,"fa-solid","fa-location-dot"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"image-gallery"],[1,"main-image"],[3,"src","alt"],[1,"thumbnail-images"],[2,"cursor","pointer",3,"src","alt"],[1,"details-layout"],[1,"main-details"],[1,"details-header"],[2,"color","#7F8C8D","margin-top","0.5rem"],[1,"fa-solid","fa-users"],[1,"host-info",2,"text-align","center"],[1,"host-avatar",3,"src","alt"],[2,"margin-top","0.5rem","font-size","0.9rem","color","var(--text-color)"],[1,"fa-solid","fa-user"],[1,"enlace-mensaje-huesped",3,"routerLink","queryParams","title"],[1,"fa-solid","fa-comment"],[1,"description-section"],[1,"amenities-section"],[1,"amenities-list"],["id","map",2,"width","100%","height","400px","border-radius","16px","overflow","hidden","border","2px solid var(--border-color)"],[1,"calendar-header-new"],[1,"header-left"],["type","button",1,"btn","btn-secondary",3,"click","disabled"],[1,"fa-solid","fa-chevron-left"],[1,"fa-solid","fa-chevron-right"],[1,"header-title"],[1,"calendar-container-lib"],[3,"dayClicked","viewDate","events","locale","weekStartsOn"],[1,"reviews-section"],[1,"fa-solid","fa-star"],[2,"text-align","center","color","#7F8C8D","padding","2rem"],[1,"booking-widget"],[1,"booking-price"],[1,"booking-form",3,"ngSubmit","formGroup"],[1,"form-group"],["for","fechaEntrada"],["type","date","id","fechaEntrada","formControlName","fechaEntrada",3,"min"],[1,"error-message","show"],["for","fechaSalida"],["type","date","id","fechaSalida","formControlName","fechaSalida",3,"min"],["for","huespedes"],["type","number","id","huespedes","formControlName","cantidadHuespedes","min","1","placeholder","Cantidad de hu\xE9spedes",3,"max"],[2,"font-size","0.85rem","color","#7F8C8D","margin-top","0.5rem"],["type","submit",1,"btn","btn-primary","btn-block",3,"disabled"],[1,"fa-solid","fa-calendar-check"],[1,"price-breakdown"],[2,"text-align","center","color","#7F8C8D","margin-bottom","1.5rem","font-size","0.9rem"],[1,"fa-solid","fa-info-circle"],[2,"cursor","pointer",3,"click","src","alt"],[1,"fa-solid","fa-wifi"],[1,"fa-solid","fa-person-swimming"],[1,"fa-solid","fa-mug-hot"],[1,"fa-solid","fa-snowflake"],[1,"fa-solid","fa-car"],[1,"fa-solid","fa-check"],[1,"reviews-grid"],[1,"review-card"],[2,"text-align","center","margin-top","2rem"],[1,"review-author"],[2,"margin","0.5rem 0"],[1,"fa-solid","fa-star",2,"color","#F39C12","font-size","0.9rem"],[1,"host-response"],[2,"margin-top","1rem"],[1,"host-response-header"],[1,"fa-solid","fa-reply"],[1,"host-response-message"],[1,"host-response-date"],["type","button",1,"btn","btn-secondary","btn-small",3,"click"],[1,"loading-spinner"],[1,"fa-solid","fa-arrow-down"],[1,"total-price"]],template:function(i,l){i&1&&(tt(0,Ure,5,0,"main",0),tt(1,Hre,10,0,"main",0),tt(2,foe,112,49,"main",0)),i&2&&(nt(l.cargando?0:-1),ie(),nt(l.errorCarga&&!l.cargando?1:-1),ie(),nt(l.alojamiento&&!l.cargando?2:-1))},dependencies:[Mr,Nd,Fd,Ps,Wh,ca,kd,Zh,gg,Lc,Ou,Q0,yS,ns,xb,bb],styles:[".loading-spinner-large[_ngcontent-%COMP%]{display:inline-block;width:48px;height:48px;border:4px solid var(--light-green);border-radius:50%;border-top-color:var(--primary-color);animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:1.5rem}.error-message[_ngcontent-%COMP%]{color:var(--danger-color);font-size:.85rem;margin-top:.5rem;display:none;animation:_ngcontent-%COMP%_fadeInError .3s ease-in-out}.error-message.show[_ngcontent-%COMP%]{display:block}@keyframes _ngcontent-%COMP%_fadeInError{0%{opacity:0;transform:translateY(-5px)}to{opacity:1;transform:translateY(0)}}.form-group[_ngcontent-%COMP%]   input.error[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   textarea.error[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   select.error[_ngcontent-%COMP%]{border-color:var(--danger-color);box-shadow:0 0 0 3px #e74c3c1a}.details-page-container[_ngcontent-%COMP%]{padding:2.5rem 0;animation:_ngcontent-%COMP%_fadeIn .5s ease-in-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.title-section[_ngcontent-%COMP%]{margin-bottom:2rem}.title-section[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2.8rem;margin-bottom:1rem;color:var(--dark-green);font-weight:700;line-height:1.2}.title-meta[_ngcontent-%COMP%]{display:flex;gap:2rem;font-size:1rem;font-weight:500;flex-wrap:wrap;align-items:center}.title-meta[_ngcontent-%COMP%]   .rating[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;color:var(--text-color)}.title-meta[_ngcontent-%COMP%]   .rating[_ngcontent-%COMP%]   .fa-star[_ngcontent-%COMP%]{color:#f39c12}.title-meta[_ngcontent-%COMP%]   .location[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;color:#7f8c8d}.image-gallery[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr 1fr;grid-template-rows:repeat(2,1fr);gap:12px;height:500px;border-radius:20px;overflow:hidden;margin-bottom:4rem;box-shadow:var(--card-shadow)}.main-image[_ngcontent-%COMP%]{grid-row:1 / -1;overflow:hidden}.main-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;transition:transform .3s ease}.main-image[_ngcontent-%COMP%]:hover   img[_ngcontent-%COMP%]{transform:scale(1.02)}.thumbnail-images[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;grid-template-rows:1fr 1fr;gap:12px}.thumbnail-images[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;transition:all .3s ease;cursor:pointer;border-radius:4px}.thumbnail-images[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]:hover{transform:scale(1.05);box-shadow:0 4px 12px #2e8b574d}.details-layout[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr 1fr;gap:5rem;align-items:start}.main-details[_ngcontent-%COMP%]{background-color:var(--white-color);border-radius:20px;padding:2.5rem;box-shadow:var(--card-shadow);border:1px solid rgba(46,139,87,.05)}.details-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:2rem;gap:2rem}.details-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.9rem;color:var(--dark-green);font-weight:600;margin-bottom:.5rem}.host-avatar[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:50%;border:3px solid var(--primary-color);box-shadow:0 4px 12px #2e8b5733;transition:transform .3s ease}.host-avatar[_ngcontent-%COMP%]:hover{transform:scale(1.05)}hr[_ngcontent-%COMP%]{border:0;border-top:2px solid var(--light-green);margin:2.5rem 0}.amenities-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], .description-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], .reviews-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:var(--dark-green);font-size:1.6rem;margin-bottom:1.5rem;font-weight:600}.amenities-list[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:1.5rem;font-size:1.1rem}.amenities-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex;align-items:center;padding:12px 16px;background-color:var(--light-green);border-radius:12px;transition:all .3s ease;border:1px solid rgba(46,139,87,.1)}.amenities-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{background-color:var(--primary-color);color:var(--white-color);transform:translate(4px);box-shadow:0 4px 12px #2e8b5733}.amenities-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{width:28px;margin-right:12px;color:var(--primary-color);font-size:1.2rem;transition:color .3s ease}.amenities-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover   i[_ngcontent-%COMP%]{color:var(--white-color)}.description-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.1rem;line-height:1.8;color:var(--text-color)}.reviews-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.reviews-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]   .fa-star[_ngcontent-%COMP%]{color:#f39c12}.reviews-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:2rem;margin-top:2rem}.review-card[_ngcontent-%COMP%]{background-color:var(--light-green);padding:1.5rem;border-radius:16px;border:1px solid rgba(46,139,87,.1);transition:all .3s ease}.review-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 8px 24px #2e8b571a}.review-author[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:1rem;gap:12px}.review-author[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:44px;height:44px;border-radius:50%;border:2px solid var(--primary-color)}.review-author[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block;color:var(--dark-green);font-weight:600;font-size:1rem}.review-author[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.9rem;color:#7f8c8d}.review-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-color);line-height:1.6;font-size:.95rem}.booking-widget[_ngcontent-%COMP%]{background-color:var(--white-color);border:1px solid rgba(46,139,87,.1);border-radius:20px;padding:2rem;box-shadow:var(--card-shadow);position:sticky;top:120px;height:fit-content}.booking-price[_ngcontent-%COMP%]{font-size:1.8rem;font-weight:700;margin-bottom:1.5rem;color:var(--primary-color);padding-bottom:1rem;border-bottom:2px solid var(--light-green)}.booking-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{margin-bottom:1.2rem}.booking-form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-weight:600;margin-bottom:.5rem;color:var(--dark-green);font-size:.95rem}.booking-form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .booking-form[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .booking-form[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{width:100%;padding:14px;border:2px solid var(--border-color);border-radius:12px;transition:all .3s ease;font-family:var(--font-family);font-size:1rem}.booking-form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .booking-form[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus, .booking-form[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{border-color:var(--primary-color);outline:none;box-shadow:0 0 0 3px #2e8b571a}.booking-form[_ngcontent-%COMP%]   .date-fields[_ngcontent-%COMP%]{display:flex;gap:12px}.price-breakdown[_ngcontent-%COMP%]{margin-top:1.5rem;padding-top:1.5rem;border-top:2px solid var(--light-green)}.price-breakdown[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin-bottom:1.2rem}.price-breakdown[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:.8rem;color:var(--text-color);font-size:.95rem}.price-breakdown[_ngcontent-%COMP%]   .total-price[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:700;display:flex;justify-content:space-between;color:var(--primary-color);border-top:2px solid var(--light-green);padding-top:1rem;margin-top:1rem}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:4rem 2rem;background-color:var(--light-green);border-radius:20px;animation:_ngcontent-%COMP%_fadeIn .5s ease-in-out}.empty-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:4rem;color:var(--primary-color);margin-bottom:1.5rem;opacity:.6}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.8rem;color:var(--dark-green);margin-bottom:1rem}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.1rem;color:#7f8c8d;margin-bottom:2rem}@media (max-width: 1024px){.details-layout[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:3rem}.booking-widget[_ngcontent-%COMP%]{position:relative;top:0}.reviews-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}@media (max-width: 768px){.title-section[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2rem}.image-gallery[_ngcontent-%COMP%]{grid-template-columns:1fr;grid-template-rows:300px repeat(2,150px);height:auto}.main-image[_ngcontent-%COMP%]{grid-row:1}.thumbnail-images[_ngcontent-%COMP%]{grid-column:1;grid-row:2 / 4}.amenities-list[_ngcontent-%COMP%]{grid-template-columns:1fr}.details-header[_ngcontent-%COMP%]{flex-direction:column}.title-meta[_ngcontent-%COMP%]{flex-direction:column;gap:1rem;align-items:flex-start}}input[_ngcontent-%COMP%]:focus-visible, button[_ngcontent-%COMP%]:focus-visible, textarea[_ngcontent-%COMP%]:focus-visible, select[_ngcontent-%COMP%]:focus-visible{outline:3px solid var(--primary-color);outline-offset:2px}.host-response[_ngcontent-%COMP%]{margin-top:1.5rem;padding:1.2rem;background:linear-gradient(135deg,#2e8b5714,#2e8b5708);border-left:4px solid var(--primary-color);border-radius:12px;animation:_ngcontent-%COMP%_fadeIn .3s ease-in-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.host-response-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-bottom:.8rem;color:var(--primary-color);font-weight:600;font-size:.95rem}.host-response-header[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1rem}.host-response-message[_ngcontent-%COMP%]{color:var(--text-color);line-height:1.6;font-size:.95rem;margin:0 0 .5rem}.host-response-date[_ngcontent-%COMP%]{color:#7f8c8d;font-size:.85rem;margin:0;text-align:right;font-style:italic}.review-card[_ngcontent-%COMP%]   .btn-small[_ngcontent-%COMP%]{padding:8px 16px;font-size:.9rem;width:auto}.loading-spinner[_ngcontent-%COMP%]{display:inline-block;width:16px;height:16px;border:2px solid #ffffff;border-radius:50%;border-top-color:transparent;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-right:8px}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}@media (max-width: 768px){.host-response[_ngcontent-%COMP%]{padding:1rem}.host-response-header[_ngcontent-%COMP%], .host-response-message[_ngcontent-%COMP%]{font-size:.9rem}}"]})};var B6=ep(_g());function moe(t,n){t&1&&($(0,"div",1),be(1,"div",2),$(2,"p",3),ne(3,"Cargando..."),W()())}function goe(t,n){t&1&&($(0,"div",6),be(1,"i",15),ne(2," Anfitri\xF3n "),W())}function _oe(t,n){t&1&&($(0,"li")(1,"a",16),be(2,"i",17),ne(3," Mis Alojamientos"),W()(),$(4,"li")(5,"a",18),be(6,"i",19),ne(7," Gesti\xF3n de Reservas"),W()(),$(8,"li")(9,"a",20),be(10,"i",21),ne(11," Crear Alojamiento"),W()(),$(12,"li")(13,"a",22),be(14,"i",23),ne(15," Dashboard"),W()())}function voe(t,n){t&1&&($(0,"li")(1,"a",24),be(2,"i",15),ne(3," Convi\xE9rtete en Anfitri\xF3n "),W()())}function yoe(t,n){if(t&1){let i=Hn();$(0,"div",4),be(1,"img",5),$(2,"h3"),ne(3),W(),$(4,"p"),ne(5),W(),tt(6,goe,3,0,"div",6),W(),$(7,"ul")(8,"li")(9,"a",7),be(10,"i",8),ne(11," Mis Reservas"),W()(),$(12,"li")(13,"a",9),be(14,"i",10),ne(15," Mi Perfil"),W()(),$(16,"li")(17,"a",11),be(18,"i",12),ne(19," Chats"),W()(),tt(20,_oe,16,0)(21,voe,4,0,"li"),$(22,"li")(23,"a",13),Ot("click",function(){Wt(i);let h=Ne();return Zt(h.cerrarSesion())}),be(24,"i",14),ne(25," Cerrar Sesi\xF3n"),W()()()}if(t&2){let i=Ne();ie(),zt("src",i.usuario.foto||"https://placehold.co/80x80/2e8b57/fff?text="+i.obtenerIniciales(),zr)("alt","Avatar de "+i.usuario.nombre),ie(2),Ln(i.usuario.nombre),ie(2),nn("Miembro desde ",i.obtenerAnioRegistro()),ie(),nt(i.usuario.esAnfitrion?6:-1),ie(14),nt(i.usuario.esAnfitrion?20:21)}}function xoe(t,n){t&1&&($(0,"div",1)(1,"p",25),ne(2,"Debes iniciar sesi\xF3n"),W(),$(3,"a",26),be(4,"i",27),ne(5," Iniciar Sesi\xF3n "),W()())}var zc=class t{constructor(n,i,l){this.usuarioService=n;this.tokenService=i;this.router=l;this.cargarUsuario()}usuario=null;cargando=!1;destroy$=new Fn;cargarUsuario(){let n=this.tokenService.getUserId();if(!n){this.router.navigate(["/login"]);return}this.cargando=!0,this.usuarioService.obtener(n).pipe(tn(this.destroy$)).subscribe({next:i=>{i.error||(this.usuario=i.data),this.cargando=!1},error:i=>{console.error("Error al cargar usuario:",i),this.cargando=!1}})}cerrarSesion(){B6.default.fire({title:"\xBFCerrar sesi\xF3n?",text:"\xBFEst\xE1s seguro de que deseas cerrar sesi\xF3n?",icon:"question",showCancelButton:!0,confirmButtonText:"S\xED, cerrar sesi\xF3n",cancelButtonText:"Cancelar",confirmButtonColor:"#2e8b57",cancelButtonColor:"#95a5a6"}).then(n=>{n.isConfirmed&&(this.tokenService.logout(),this.usuario=null,this.router.navigate(["/"]).then(i=>window.location.reload()))})}obtenerIniciales(){return this.usuario?this.usuario.nombre.charAt(0).toUpperCase():"U"}obtenerAnioRegistro(){return this.usuario?new Date().getFullYear():new Date().getFullYear()}static \u0275fac=function(i){return new(i||t)(wt(Os),wt(Ar),wt(br))};static \u0275cmp=Ai({type:t,selectors:[["app-panel-usuario"]],decls:4,vars:3,consts:[[1,"dashboard-nav"],[2,"text-align","center","padding","2rem"],[1,"loading-spinner-large"],[2,"color","#7F8C8D","margin-top","1rem"],[1,"user-profile-summary"],[3,"src","alt"],[2,"margin-top","0.5rem","padding","4px 12px","background-color","var(--primary-color)","color","white","border-radius","12px","font-size","0.85rem","display","inline-block"],["routerLink","/mis-reservas"],[1,"fa-solid","fa-briefcase"],["routerLink","/editar-perfil"],[1,"fa-solid","fa-user"],["routerLink","/chat"],[1,"fa-solid","fa-message"],[2,"cursor","pointer",3,"click"],[1,"fa-solid","fa-right-from-bracket"],[1,"fa-solid","fa-star"],["routerLink","/mis-alojamientos"],[1,"fa-solid","fa-house-user"],["routerLink","/gestionar-reservas"],[1,"fa-solid","fa-clipboard-check"],["routerLink","/crear-alojamiento"],[1,"fa-solid","fa-plus"],["routerLink","/dashboard-anfitrion"],[1,"fa-solid","fa-dashboard"],["routerLink","/login",2,"color","var(--primary-color)"],[2,"color","#7F8C8D","margin-bottom","1rem"],["routerLink","/login",1,"btn","btn-primary"],[1,"fa-solid","fa-right-to-bracket"]],template:function(i,l){i&1&&($(0,"aside",0),tt(1,moe,4,0,"div",1),tt(2,yoe,26,6),tt(3,xoe,6,0,"div",1),W()),i&2&&(ie(),nt(l.cargando?1:-1),ie(),nt(!l.cargando&&l.usuario?2:-1),ie(),nt(!l.cargando&&!l.usuario?3:-1))},dependencies:[ns,Mr],styles:['.dashboard-layout[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .5s ease-in-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.tabs[_ngcontent-%COMP%]{margin-bottom:2.5rem}.tab-link[_ngcontent-%COMP%]{position:relative;padding:1.2rem 2rem;font-size:1.05rem}.tab-link[_ngcontent-%COMP%]:hover{color:var(--primary-color);background-color:var(--light-green)}.reservation-card[_ngcontent-%COMP%]{transition:all .3s cubic-bezier(.4,0,.2,1)}.reservation-card[_ngcontent-%COMP%]:hover{box-shadow:0 12px 40px #2e8b5726}.reservation-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{transition:transform .3s ease}.reservation-card[_ngcontent-%COMP%]:hover   img[_ngcontent-%COMP%]{transform:scale(1.05)}.status[_ngcontent-%COMP%]{transition:all .3s ease;box-shadow:0 2px 8px #0000001a}.status.confirmed[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulseGreen 2s infinite}@keyframes _ngcontent-%COMP%_pulseGreen{0%,to{box-shadow:0 2px 8px #2e8b574d}50%{box-shadow:0 2px 16px #2e8b5780}}.reservation-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{transition:all .3s ease;min-width:120px}.reservation-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 12px #00000026}.reservation-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:active{transform:translateY(0)}.dashboard-nav[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{position:relative;overflow:hidden}.dashboard-nav[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:before{content:"";position:absolute;left:0;top:0;height:100%;width:4px;background-color:var(--primary-color);transform:translate(-100%);transition:transform .3s ease}.dashboard-nav[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li.active[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:before, .dashboard-nav[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover:before{transform:translate(0)}.user-profile-summary[_ngcontent-%COMP%]{position:relative;overflow:hidden}.user-profile-summary[_ngcontent-%COMP%]:before{content:"";position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:radial-gradient(circle,rgba(46,139,87,.1) 0%,transparent 70%);animation:_ngcontent-%COMP%_rotate 20s linear infinite}@keyframes _ngcontent-%COMP%_rotate{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.user-profile-summary[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{position:relative;z-index:1;transition:transform .3s ease}.user-profile-summary[_ngcontent-%COMP%]:hover   img[_ngcontent-%COMP%]{transform:scale(1.1)}.tab-content[_ngcontent-%COMP%] > div[style*="text-align: center"][_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .5s ease-in-out}@media (max-width: 768px){.dashboard-layout[_ngcontent-%COMP%]{grid-template-columns:1fr}.dashboard-nav[_ngcontent-%COMP%]{position:relative;top:0}.reservation-card[_ngcontent-%COMP%]{flex-direction:column}.reservation-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:200px}.reservation-actions[_ngcontent-%COMP%]{width:100%;flex-direction:row;flex-wrap:wrap;gap:8px}.reservation-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{flex:1;min-width:auto}}.tab-link[_ngcontent-%COMP%]:focus-visible, .btn[_ngcontent-%COMP%]:focus-visible{outline:3px solid var(--primary-color);outline-offset:2px}.loading-skeleton[_ngcontent-%COMP%]{background:linear-gradient(90deg,#f0f0f0 25%,#e0e0e0,#f0f0f0 75%);background-size:200% 100%;animation:_ngcontent-%COMP%_loading 1.5s infinite;border-radius:12px;height:200px;margin-bottom:2rem}@keyframes _ngcontent-%COMP%_loading{0%{background-position:200% 0}to{background-position:-200% 0}}*[_ngcontent-%COMP%]{transition-timing-function:cubic-bezier(.4,0,.2,1)}']})};var boe=t=>["/alojamiento",t],woe=t=>["/editar-alojamiento",t],Coe=(t,n)=>n.id;function Eoe(t,n){if(t&1){let i=Hn();$(0,"button",16),Ot("click",function(){Wt(i);let h=Ne();return Zt(h.limpiarBusqueda())}),be(1,"i",17),W()}}function Toe(t,n){t&1&&($(0,"div",13),be(1,"div",18),$(2,"p"),ne(3,"Cargando alojamientos..."),W()())}function Soe(t,n){t&1&&be(0,"i",29)}function Doe(t,n){if(t&1&&($(0,"div",31)(1,"div",41),be(2,"i",42),$(3,"span"),ne(4),W()(),$(5,"div",41),be(6,"i",43),$(7,"span"),ne(8),W()()()),t&2){let i=n;ie(4),nn("",i.totalReservas," reservas"),ie(4),nn("",i.totalResenas," rese\xF1as")}}function Ioe(t,n){if(t&1){let i=Hn();$(0,"div",19)(1,"div",20),be(2,"img",21),$(3,"div",22),be(4,"i",23),ne(5," Publicado "),W()(),$(6,"div",24)(7,"div",25)(8,"h3"),ne(9),W(),$(10,"p",26),be(11,"i",27),ne(12),W()(),$(13,"div",28),Ri(14,Soe,1,0,"i",29,ng),$(16,"span",30),ne(17),W()(),tt(18,Doe,9,2,"div",31),$(19,"div",32)(20,"span",33),ne(21,"Precio por noche"),W(),$(22,"span",34),ne(23),W()(),$(24,"div",35)(25,"a",36),be(26,"i",37),ne(27," Ver "),W(),$(28,"a",36),be(29,"i",38),ne(30," Editar "),W(),$(31,"button",39),Ot("click",function(){let h=Wt(i).$implicit,o=Ne(2);return Zt(o.confirmarEliminar(h.id,h.titulo))}),be(32,"i",40),ne(33," Eliminar "),W()()()()}if(t&2){let i,l=n.$implicit,h=Ne(2);ie(2),zt("src",l.imagenPrincipal,zr)("alt",l.titulo),ie(7),Ln(l.titulo),ie(3),nn(" ",l.direccion.ciudad," "),ie(2),ki(h.alojamientoService.generarEstrellas(l.promedioCalificaciones)),ie(3),nn(" ",l.promedioCalificaciones," "),ie(),nt((i=h.metricasPorAlojamiento.get(l.id))?18:-1,i),ie(5),nn(" ",h.alojamientoService.formatearPrecio(l.precioPorNoche)," "),ie(2),zt("routerLink",ao(9,boe,l.id)),ie(3),zt("routerLink",ao(11,woe,l.id))}}function Moe(t,n){if(t&1&&($(0,"div",14),Ri(1,Ioe,34,13,"div",19,Coe),W()),t&2){let i=Ne();ie(),ki(i.alojamientosFiltrados)}}function Aoe(t,n){t&1&&($(0,"div",15),be(1,"i",44),$(2,"h3"),ne(3,"A\xFAn no tienes alojamientos"),W(),$(4,"p"),ne(5,"Crea tu primer alojamiento para comenzar a recibir hu\xE9spedes"),W(),$(6,"a",4),be(7,"i",5),ne(8," Crear Alojamiento "),W()())}function Poe(t,n){if(t&1){let i=Hn();$(0,"div",15),be(1,"i",45),$(2,"h3"),ne(3,"No se encontraron resultados"),W(),$(4,"p"),ne(5),W(),$(6,"button",46),Ot("click",function(){Wt(i);let h=Ne();return Zt(h.limpiarBusqueda())}),be(7,"i",47),ne(8," Limpiar B\xFAsqueda "),W()()}if(t&2){let i=Ne();ie(5),nn('No hay alojamientos que coincidan con "',i.terminoBusqueda,'"')}}var ZS=class t{constructor(n,i,l,h){this.alojamientoService=n;this.usuarioService=i;this.mensajeHandlerService=l;this.tokenService=h}alojamientos=[];alojamientosFiltrados=[];terminoBusqueda="";cargando=!1;metricasPorAlojamiento=new Map;paginaActual=0;destroy$=new Fn;ngOnInit(){this.cargarAlojamientosIniciales()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}filtrarAlojamientos(){if(!this.terminoBusqueda.trim()){this.alojamientosFiltrados=[...this.alojamientos];return}let n=this.terminoBusqueda.toLowerCase().trim();this.alojamientosFiltrados=this.alojamientos.filter(i=>i.titulo.toLowerCase().includes(n)||i.direccion.ciudad.toLowerCase().includes(n))}limpiarBusqueda(){this.terminoBusqueda="",this.alojamientosFiltrados=[...this.alojamientos]}confirmarEliminar(n,i){this.mensajeHandlerService.confirmDanger(`Se eliminar\xE1 el alojamiento "${i}"`,"S\xED, eliminar","\xBFEst\xE1s seguro?").then(l=>{l&&this.eliminarAlojamiento(n)})}cargarMasAlojamientos(){let n=this.tokenService.getUserId();this.paginaActual++,this.cargando=!0,this.usuarioService.obtenerAlojamientosUsuario(n,this.paginaActual).pipe(tn(this.destroy$),Si(()=>this.cargando=!1)).subscribe({next:i=>{let l=i.data;this.alojamientos=[...this.alojamientos,...l],this.filtrarAlojamientos(),l.forEach(h=>{this.cargarMetricas(h.id)})},error:i=>{let l=this.mensajeHandlerService.handleHttpError(i);this.mensajeHandlerService.showError(l)}})}cargarAlojamientosIniciales(){let n=this.tokenService.getUserId();this.paginaActual=0,this.cargando=!0,this.usuarioService.obtenerAlojamientosUsuario(n,this.paginaActual).pipe(tn(this.destroy$),Si(()=>this.cargando=!1)).subscribe({next:i=>{this.alojamientos=i.data,this.alojamientosFiltrados=[...this.alojamientos],this.alojamientos.forEach(l=>{this.cargarMetricas(l.id)})},error:i=>{let l=this.mensajeHandlerService.handleHttpError(i);this.mensajeHandlerService.showError(l)}})}cargarMetricas(n){this.alojamientoService.obtenerMetricas(n).pipe(tn(this.destroy$)).subscribe({next:i=>{this.metricasPorAlojamiento.set(n,i.data)},error:i=>{console.error(`Error al cargar m\xE9tricas para alojamiento ${n}:`,i)}})}eliminarAlojamiento(n){this.alojamientoService.eliminar(n).pipe(tn(this.destroy$)).subscribe({next:i=>{this.mensajeHandlerService.showSuccess(i.data,"\xA1Eliminado!"),this.alojamientos=this.alojamientos.filter(l=>l.id!==n),this.filtrarAlojamientos(),this.metricasPorAlojamiento.delete(n)},error:i=>{let l=this.mensajeHandlerService.handleHttpError(i);this.mensajeHandlerService.showError(l)}})}static \u0275fac=function(i){return new(i||t)(wt(As),wt(Os),wt(rs),wt(Ar))};static \u0275cmp=Ai({type:t,selectors:[["app-mis-alojamientos"]],decls:29,vars:8,consts:[[1,"container","dashboard-container"],[1,"dashboard-layout"],[1,"dashboard-content"],[1,"content-header"],["routerLink","/crear-alojamiento",1,"btn","btn-primary"],[1,"fa-solid","fa-plus"],[1,"search-container"],[1,"search-input-wrapper"],[1,"fa-solid","fa-magnifying-glass","search-icon"],["type","text","placeholder","Buscar por t\xEDtulo o ciudad...",1,"search-input",3,"ngModelChange","input","ngModel"],["type","button","title","Limpiar b\xFAsqueda",1,"clear-search"],[1,"search-info"],[1,"fa-solid","fa-info-circle"],[1,"loading-container"],[1,"alojamientos-grid"],[1,"empty-state"],["type","button","title","Limpiar b\xFAsqueda",1,"clear-search",3,"click"],[1,"fa-solid","fa-xmark"],[1,"loading-spinner-large"],[1,"alojamiento-card"],[1,"alojamiento-image"],[3,"src","alt"],[1,"alojamiento-badge"],[1,"fa-solid","fa-circle-check"],[1,"alojamiento-info"],[1,"alojamiento-header"],[1,"location"],[1,"fa-solid","fa-location-dot"],[1,"alojamiento-rating"],[1,"fa-solid","fa-star"],[1,"rating-number"],[1,"alojamiento-stats"],[1,"alojamiento-price"],[1,"price-label"],[1,"price-amount"],[1,"alojamiento-actions"],[1,"btn","btn-secondary","btn-small",3,"routerLink"],[1,"fa-solid","fa-eye"],[1,"fa-solid","fa-pen"],["type","button",1,"btn","btn-danger","btn-small",3,"click"],[1,"fa-solid","fa-trash"],[1,"stat-item"],[1,"fa-solid","fa-calendar-check"],[1,"fa-solid","fa-comment"],[1,"fa-solid","fa-house-circle-exclamation"],[1,"fa-solid","fa-magnifying-glass"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"fa-solid","fa-rotate-left"]],template:function(i,l){i&1&&($(0,"main",0)(1,"div",1),be(2,"app-panel-usuario"),$(3,"section",2)(4,"div",3)(5,"h1"),ne(6,"Mis Alojamientos"),W(),$(7,"a",4),be(8,"i",5),ne(9," A\xF1adir Alojamiento "),W()(),$(10,"div",6)(11,"div",7),be(12,"i",8),$(13,"input",9),Rl("ngModelChange",function(o){return oc(l.terminoBusqueda,o)||(l.terminoBusqueda=o),o}),Ot("input",function(){return l.filtrarAlojamientos()}),W(),tt(14,Eoe,2,0,"button",10),W(),$(15,"div",11)(16,"p"),be(17,"i",12),ne(18," Mostrando "),$(19,"strong"),ne(20),W(),ne(21," de "),$(22,"strong"),ne(23),W(),ne(24," alojamientos "),W()()(),tt(25,Toe,4,0,"div",13),tt(26,Moe,3,0,"div",14),tt(27,Aoe,9,0,"div",15),tt(28,Poe,9,1,"div",15),W()()()),i&2&&(ie(13),Ol("ngModel",l.terminoBusqueda),ie(),nt(l.terminoBusqueda?14:-1),ie(6),Ln(l.alojamientosFiltrados.length),ie(3),Ln(l.alojamientos.length),ie(2),nt(l.cargando?25:-1),ie(),nt(l.alojamientosFiltrados.length>0?26:-1),ie(),nt(!l.cargando&&l.alojamientos.length===0?27:-1),ie(),nt(!l.cargando&&l.alojamientosFiltrados.length===0&&l.terminoBusqueda?28:-1))},dependencies:[zc,Mr,Ap,Ps,ca,qh,ns],styles:[".search-container[_ngcontent-%COMP%]{background-color:var(--light-green);border-radius:16px;padding:1.5rem;margin-bottom:2.5rem;border:2px solid rgba(46,139,87,.1)}.search-input-wrapper[_ngcontent-%COMP%]{position:relative;margin-bottom:1rem}.search-icon[_ngcontent-%COMP%]{position:absolute;left:16px;top:50%;transform:translateY(-50%);color:var(--primary-color);font-size:1.1rem}.search-input[_ngcontent-%COMP%]{width:100%;padding:14px 50px 14px 48px;border:2px solid var(--border-color);border-radius:12px;font-size:1rem;transition:all .3s ease;background-color:var(--white-color)}.search-input[_ngcontent-%COMP%]:focus{border-color:var(--primary-color);outline:none;box-shadow:0 0 0 3px #2e8b571a}.clear-search[_ngcontent-%COMP%]{position:absolute;right:12px;top:50%;transform:translateY(-50%);background:none;border:none;color:#7f8c8d;cursor:pointer;padding:8px;border-radius:6px;transition:all .3s ease;font-size:1.2rem}.clear-search[_ngcontent-%COMP%]:hover{color:var(--danger-color);background-color:#e74c3c1a}.search-info[_ngcontent-%COMP%]{text-align:center}.search-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-color);font-size:.95rem;margin:0}.search-info[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--primary-color);margin-right:6px}.alojamientos-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:2rem;animation:_ngcontent-%COMP%_fadeIn .5s ease-in-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.alojamiento-card[_ngcontent-%COMP%]{background-color:var(--white-color);border-radius:20px;overflow:hidden;box-shadow:var(--card-shadow);transition:all .3s cubic-bezier(.4,0,.2,1);border:1px solid rgba(46,139,87,.05)}.alojamiento-card[_ngcontent-%COMP%]:hover{transform:translateY(-8px);box-shadow:0 12px 40px #2e8b5726}.alojamiento-image[_ngcontent-%COMP%]{position:relative;height:200px;overflow:hidden}.alojamiento-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;transition:transform .3s ease}.alojamiento-card[_ngcontent-%COMP%]:hover   .alojamiento-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{transform:scale(1.05)}.alojamiento-badge[_ngcontent-%COMP%]{position:absolute;top:12px;right:12px;background-color:var(--success-color);color:var(--white-color);padding:6px 12px;border-radius:20px;font-size:.85rem;font-weight:600;display:flex;align-items:center;gap:6px;box-shadow:0 2px 8px #2e8b574d}.alojamiento-info[_ngcontent-%COMP%]{padding:1.5rem}.alojamiento-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:600;margin-bottom:.5rem;color:var(--dark-green);line-height:1.4;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}.alojamiento-header[_ngcontent-%COMP%]   .location[_ngcontent-%COMP%]{font-size:.9rem;color:#7f8c8d;margin-bottom:1rem;display:flex;align-items:center;gap:6px}.alojamiento-rating[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;margin-bottom:1rem}.alojamiento-rating[_ngcontent-%COMP%]   .fa-star[_ngcontent-%COMP%]{color:#f39c12;font-size:.9rem}.alojamiento-rating[_ngcontent-%COMP%]   .rating-number[_ngcontent-%COMP%]{margin-left:6px;font-weight:600;color:var(--text-color)}.alojamiento-stats[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-bottom:1rem;padding:1rem;background-color:var(--light-green);border-radius:12px}.stat-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;font-size:.9rem;color:var(--text-color)}.stat-item[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--primary-color)}.alojamiento-price[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem;padding-top:1rem;border-top:2px solid var(--light-green)}.price-label[_ngcontent-%COMP%]{font-size:.85rem;color:#7f8c8d}.price-amount[_ngcontent-%COMP%]{font-size:1.3rem;font-weight:700;color:var(--primary-color)}.alojamiento-actions[_ngcontent-%COMP%]{display:flex;gap:8px;flex-wrap:wrap}.btn-small[_ngcontent-%COMP%]{padding:10px 16px;font-size:.9rem;flex:1;min-width:80px;justify-content:center}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:4rem 2rem;background-color:var(--light-green);border-radius:20px;animation:_ngcontent-%COMP%_fadeIn .5s ease-in-out}.empty-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:4rem;color:var(--primary-color);margin-bottom:1.5rem;opacity:.6}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.8rem;color:var(--dark-green);margin-bottom:1rem}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.1rem;color:#7f8c8d;margin-bottom:2rem}.loading-container[_ngcontent-%COMP%]{text-align:center;padding:4rem 2rem}.loading-spinner-large[_ngcontent-%COMP%]{display:inline-block;width:48px;height:48px;border:4px solid var(--light-green);border-radius:50%;border-top-color:var(--primary-color);animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:1.5rem}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-color);font-size:1.1rem}@media (max-width: 768px){.alojamientos-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.alojamiento-actions[_ngcontent-%COMP%]{flex-direction:column}.btn-small[_ngcontent-%COMP%]{width:100%}.search-container[_ngcontent-%COMP%]{padding:1rem}}"]})};var fv=class t{constructor(n){this.http=n}API_URL=`${is.apiUrl}/imagenes`;subirImagen(n){let i=new FormData;return i.append("file",n),this.http.post(this.API_URL,i)}eliminarImagen(n){let i=new Ms().set("url",n);return this.http.delete(this.API_URL,{params:i})}static \u0275fac=function(i){return new(i||t)(gn(aa))};static \u0275prov=Qt({token:t,factory:t.\u0275fac,providedIn:"root"})};var Ooe=()=>[1,2,3,4];function Roe(t,n){t&1&&be(0,"i",19)}function koe(t,n){if(t&1&&ne(0),t&2){let i=Ne().$implicit;nn(" ",i," ")}}function Foe(t,n){t&1&&ne(0," Informaci\xF3n B\xE1sica ")}function Loe(t,n){t&1&&ne(0," Ubicaci\xF3n ")}function Noe(t,n){t&1&&ne(0," Servicios ")}function zoe(t,n){t&1&&ne(0," Im\xE1genes ")}function Boe(t,n){if(t&1){let i=Hn();$(0,"div",17),Ot("click",function(){let h=Wt(i).$implicit,o=Ne();return Zt(o.irAPaso(h))}),$(1,"span",18),tt(2,Roe,1,0,"i",19)(3,koe,1,1),W(),tt(4,Foe,1,0)(5,Loe,1,0)(6,Noe,1,0)(7,zoe,1,0),W()}if(t&2){let i,l=n.$implicit,h=Ne();Dn("active",h.pasoActual===l)("completed",h.pasoActual>l),ie(2),nt(h.pasoActual>l?2:3),ie(2),nt((i=l)===1?4:i===2?5:i===3?6:i===4?7:-1)}}function joe(t,n){if(t&1&&($(0,"div",26),ne(1),W()),t&2){let i=Ne(2);ie(),nn(" ",i.formUtilsService.obtenerErrorCampo(i.alojamientoForm,"titulo")," ")}}function Voe(t,n){if(t&1&&($(0,"div",26),ne(1),W()),t&2){let i=Ne(2);ie(),nn(" ",i.formUtilsService.obtenerErrorCampo(i.alojamientoForm,"descripcion")," ")}}function Uoe(t,n){if(t&1&&($(0,"div",26),ne(1),W()),t&2){let i=Ne(2);ie(),nn(" ",i.formUtilsService.obtenerErrorCampo(i.alojamientoForm,"maxHuespedes")," ")}}function Hoe(t,n){if(t&1&&($(0,"div",26),ne(1),W()),t&2){let i=Ne(2);ie(),nn(" ",i.formUtilsService.obtenerErrorCampo(i.alojamientoForm,"precioPorNoche")," ")}}function $oe(t,n){if(t&1&&($(0,"div",11)(1,"h3",20),be(2,"i",21),ne(3," Informaci\xF3n B\xE1sica "),W(),$(4,"div",22)(5,"div",23)(6,"label",24),ne(7,"T\xEDtulo del Alojamiento *"),W(),be(8,"input",25),tt(9,joe,2,1,"div",26),$(10,"p",27),ne(11),W()(),$(12,"div",23)(13,"label",28),ne(14,"Descripci\xF3n *"),W(),be(15,"textarea",29),tt(16,Voe,2,1,"div",26),$(17,"p",27),ne(18),W()(),$(19,"div",30)(20,"label",31),ne(21,"M\xE1ximo de Hu\xE9spedes *"),W(),be(22,"input",32),tt(23,Uoe,2,1,"div",26),W(),$(24,"div",30)(25,"label",33),ne(26,"Precio por Noche (COP) *"),W(),be(27,"input",34),tt(28,Hoe,2,1,"div",26),W()()()),t&2){let i=Ne();ie(8),Dn("error",i.formUtilsService.campoInvalido(i.alojamientoForm,"titulo")),ie(),nt(i.formUtilsService.campoInvalido(i.alojamientoForm,"titulo")?9:-1),ie(2),nn(" ",(i.alojamientoForm.value.titulo==null?null:i.alojamientoForm.value.titulo.length)||0,"/100 "),ie(4),Dn("error",i.formUtilsService.campoInvalido(i.alojamientoForm,"descripcion")),ie(),nt(i.formUtilsService.campoInvalido(i.alojamientoForm,"descripcion")?16:-1),ie(2),nn(" ",(i.alojamientoForm.value.descripcion==null?null:i.alojamientoForm.value.descripcion.length)||0,"/1000 "),ie(4),Dn("error",i.formUtilsService.campoInvalido(i.alojamientoForm,"maxHuespedes")),ie(),nt(i.formUtilsService.campoInvalido(i.alojamientoForm,"maxHuespedes")?23:-1),ie(4),Dn("error",i.formUtilsService.campoInvalido(i.alojamientoForm,"precioPorNoche")),ie(),nt(i.formUtilsService.campoInvalido(i.alojamientoForm,"precioPorNoche")?28:-1)}}function Goe(t,n){if(t&1&&($(0,"option",39),ne(1),W()),t&2){let i=n.$implicit;zt("value",i),ie(),Ln(i)}}function qoe(t,n){if(t&1&&($(0,"div",26),ne(1),W()),t&2){let i=Ne(2);ie(),nn(" ",i.formUtilsService.obtenerErrorCampo(i.alojamientoForm,"ciudad")," ")}}function Woe(t,n){if(t&1&&($(0,"div",26),ne(1),W()),t&2){let i=Ne(2);ie(),nn(" ",i.formUtilsService.obtenerErrorCampo(i.alojamientoForm,"direccion")," ")}}function Zoe(t,n){if(t&1&&($(0,"div",11)(1,"h3",20),be(2,"i",35),ne(3," Ubicaci\xF3n "),W(),$(4,"div",22)(5,"div",30)(6,"label",36),ne(7,"Ciudad *"),W(),$(8,"select",37)(9,"option",38),ne(10,"Selecciona una ciudad"),W(),Ri(11,Goe,2,2,"option",39,ra),W(),tt(13,qoe,2,1,"div",26),W(),$(14,"div",30)(15,"label",40),ne(16,"Direcci\xF3n *"),W(),be(17,"input",41),tt(18,Woe,2,1,"div",26),W(),$(19,"div",23)(20,"label"),ne(21,"Ubicaci\xF3n en el Mapa *"),W(),$(22,"p",42),be(23,"i",43),ne(24," Haz clic en el mapa para seleccionar la ubicaci\xF3n exacta "),W(),be(25,"div",44),$(26,"div",45)(27,"p",46)(28,"strong"),ne(29,"Coordenadas seleccionadas:"),W(),be(30,"br"),ne(31),be(32,"br"),ne(33),W()()()()()),t&2){let i=Ne();ie(8),Dn("error",i.formUtilsService.campoInvalido(i.alojamientoForm,"ciudad")),ie(3),ki(i.ciudades),ie(2),nt(i.formUtilsService.campoInvalido(i.alojamientoForm,"ciudad")?13:-1),ie(4),Dn("error",i.formUtilsService.campoInvalido(i.alojamientoForm,"direccion")),ie(),nt(i.formUtilsService.campoInvalido(i.alojamientoForm,"direccion")?18:-1),ie(13),nn(" Latitud: ",i.alojamientoForm.value.localizacion==null?null:i.alojamientoForm.value.localizacion.latitud.toFixed(6)),ie(2),nn(" Longitud: ",i.alojamientoForm.value.localizacion==null?null:i.alojamientoForm.value.localizacion.longitud.toFixed(6)," ")}}function Xoe(t,n){if(t&1&&($(0,"div",50)(1,"div",52),be(2,"input",53),$(3,"label",54),be(4,"i",55),ne(5),W()()()),t&2){let i=n.$implicit,l=n.$index,h=Ne(2);ie(2),zt("id","servicio_"+l)("formControlName",l),ie(),zt("for","servicio_"+l),ie(),Ta("fa-solid "+h.obtenerIconoServicio(i)),ie(),nn(" ",h.formatearServicio(i)," ")}}function Yoe(t,n){t&1&&($(0,"div",51)(1,"p",56),be(2,"i",57),ne(3," Debes seleccionar al menos un servicio "),W()())}function Koe(t,n){if(t&1&&($(0,"div",12)(1,"h3",20),be(2,"i",47),ne(3," Servicios y Comodidades "),W(),$(4,"p",48),ne(5," Selecciona todos los servicios que ofrece tu alojamiento "),W(),$(6,"div",49),Ri(7,Xoe,6,6,"div",50,ra),W(),tt(9,Yoe,4,0,"div",51),W()),t&2){let i=Ne();ie(7),ki(i.serviciosDisponibles),ie(2),nt(i.obtenerServiciosSeleccionados().length===0?9:-1)}}function Joe(t,n){t&1&&(be(0,"div",61),$(1,"p"),ne(2,"Subiendo im\xE1genes..."),W())}function Qoe(t,n){t&1&&(be(0,"i",62),$(1,"p"),ne(2,"Haz clic para seleccionar im\xE1genes"),W(),$(3,"p",63),ne(4," Formatos: JPG, PNG (m\xE1x. 5MB por imagen) "),W())}function ese(t,n){t&1&&($(0,"div",70),ne(1," Principal "),W())}function tse(t,n){if(t&1){let i=Hn();$(0,"div",65),be(1,"img",67),$(2,"button",68),Ot("click",function(){let h=Wt(i).$index,o=Ne(3);return Zt(o.eliminarImagen(h))}),be(3,"i",69),W(),tt(4,ese,2,0,"div",70),W()}if(t&2){let i=n.$implicit,l=n.$index;ie(),zt("src",i,zr)("alt","Imagen "+(l+1)),ie(3),nt(l===0?4:-1)}}function nse(t,n){if(t&1&&($(0,"div",64),Ri(1,tse,5,3,"div",65,ra),W(),$(3,"p",66),be(4,"i",19),ne(5),W()),t&2){let i=Ne(2);ie(),ki(i.imagenesSubidas),ie(4),mp(" ",i.imagenesSubidas.length," imagen",i.imagenesSubidas.length>1?"es":""," subida",i.imagenesSubidas.length>1?"s":""," ")}}function ise(t,n){if(t&1&&($(0,"div",51)(1,"p",56),be(2,"i",57),ne(3),W()()),t&2){let i=Ne(2);ie(3),ps(" Necesitas subir al menos ",3-i.imagenesSubidas.length," imagen",3-i.imagenesSubidas.length>1?"es":""," m\xE1s ")}}function rse(t,n){if(t&1){let i=Hn();$(0,"div",11)(1,"h3",20),be(2,"i",58),ne(3," Im\xE1genes del Alojamiento "),W(),$(4,"p",48),ne(5," Sube al menos 3 im\xE1genes de tu alojamiento (m\xE1ximo 10) "),W(),$(6,"div",59),Ot("click",function(){Wt(i);let h=Pl(10);return Zt(h.click())}),tt(7,Joe,3,0)(8,Qoe,5,0),$(9,"input",60,0),Ot("change",function(h){Wt(i);let o=Ne();return Zt(o.seleccionarImagenes(h))}),W()(),tt(11,nse,6,3),tt(12,ise,4,2,"div",51),W()}if(t&2){let i=Ne();ie(7),nt(i.subiendoImagen?7:8),ie(4),nt(i.imagenesSubidas.length>0?11:-1),ie(),nt(i.imagenesSubidas.length<3?12:-1)}}function ose(t,n){if(t&1){let i=Hn();$(0,"button",71),Ot("click",function(){Wt(i);let h=Ne();return Zt(h.siguientePaso())}),ne(1," Siguiente "),be(2,"i",72),W()}}function sse(t,n){if(t&1&&(be(0,"span",73),ne(1)),t&2){let i=Ne(2);ie(),nn(" ",i.modoEdicion?"Actualizando...":"Publicando..."," ")}}function ase(t,n){if(t&1&&(be(0,"i",74),ne(1)),t&2){let i=Ne(2);ie(),nn(" ",i.modoEdicion?"Guardar Cambios":"Publicar Alojamiento"," ")}}function lse(t,n){if(t&1&&($(0,"button",16),tt(1,sse,2,1)(2,ase,2,1),W()),t&2){let i=Ne();zt("disabled",i.cargando||!i.validarFormularioCompleto()),ie(),nt(i.cargando?1:2)}}var d1=class t{constructor(n,i,l,h,o,E,A,L,Y,le,te,ze){this.formBuilder=n;this.route=i;this.router=l;this.location=h;this.alojamientoService=o;this.imagenService=E;this.ciudadService=A;this.serviciosService=L;this.tokenService=Y;this.mensajeHandlerService=le;this.formUtilsService=te;this.mapaService=ze}alojamientoForm;cargando=!1;pasoActual=1;totalPasos=4;modoEdicion=!1;idAlojamiento;ciudades=[];serviciosDisponibles=[];imagenesSubidas=[];subiendoImagen=!1;destroy$=new Fn;ngOnInit(){this.verificarModoEdicion(),this.crearFormulario(),this.cargarDatosIniciales()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.mapaService&&this.mapaService.ngOnDestroy()}verificarModoEdicion(){this.route.params.pipe(tn(this.destroy$)).subscribe(n=>{n.id&&(this.modoEdicion=!0,this.idAlojamiento=+n.id,this.cargarAlojamiento())})}crearFormulario(){this.alojamientoForm=this.formBuilder.group({titulo:["",[Pn.required,Pn.minLength(10),Pn.maxLength(100)]],descripcion:["",[Pn.required,Pn.minLength(50),Pn.maxLength(1e3)]],maxHuespedes:[1,[Pn.required,Pn.min(1),Pn.max(20)]],precioPorNoche:[0,[Pn.required,Pn.min(1e4)]],ciudad:["",Pn.required],direccion:["",[Pn.required,Pn.minLength(5)]],localizacion:[{latitud:0,longitud:0},Pn.required],servicios:this.formBuilder.array([])})}cargarDatosIniciales(){this.ciudadService.obtenerCiudades().pipe(tn(this.destroy$)).subscribe({next:n=>{n.error||(this.ciudades=n.data)},error:n=>console.error("Error al cargar ciudades:",n)}),this.serviciosService.obtenerServicios().pipe(tn(this.destroy$)).subscribe({next:n=>{n.error||(this.serviciosDisponibles=n.data,this.inicializarServiciosCheckboxes())},error:n=>console.error("Error al cargar servicios:",n)})}cargarAlojamiento(){this.idAlojamiento&&(this.cargando=!0,this.alojamientoService.obtenerPorId(this.idAlojamiento).pipe(tn(this.destroy$),Si(()=>this.cargando=!1)).subscribe({next:n=>{if(!n.error){let i=n.data;this.alojamientoForm.patchValue({titulo:i.titulo,descripcion:i.descripcion,maxHuespedes:i.maxHuespedes,precioPorNoche:i.precioPorNoche,ciudad:i.direccion.ciudad,direccion:i.direccion.direccion,localizacion:{latitud:i.direccion.localizacion.latitud,longitud:i.direccion.localizacion.longitud}}),this.imagenesSubidas=i.imagenes,this.marcarServiciosSeleccionados(i.servicios)}},error:n=>{let i=this.mensajeHandlerService.handleHttpError(n);this.mensajeHandlerService.showError(i),this.volver()}}))}get serviciosArray(){return this.alojamientoForm.get("servicios")}inicializarServiciosCheckboxes(){this.serviciosDisponibles.forEach(()=>{this.serviciosArray.push(this.formBuilder.control(!1))})}marcarServiciosSeleccionados(n){this.serviciosDisponibles.forEach((i,l)=>{n.includes(i)&&this.serviciosArray.at(l).setValue(!0)})}obtenerServiciosSeleccionados(){return this.serviciosDisponibles.filter((n,i)=>this.serviciosArray.at(i).value)}inicializarLogicaMapa(){setTimeout(()=>{this.mapaService.create("map").pipe(tn(this.destroy$)).subscribe({next:()=>{if(this.modoEdicion&&this.idAlojamiento){let i={id:this.idAlojamiento,titulo:this.alojamientoForm.value.titulo,fotoUrl:this.imagenesSubidas[0],localizacion:{latitud:this.alojamientoForm.value.localizacion.latitud,longitud:this.alojamientoForm.value.localizacion.longitud}};this.mapaService.drawMarkers([i]),this.mapaService.mapInstance?.setCenter([this.alojamientoForm.value.localizacion.longitud,this.alojamientoForm.value.localizacion.latitud])}this.mapaService.addMarker().pipe(tn(this.destroy$)).subscribe(i=>{this.alojamientoForm.get("localizacion")?.setValue({latitud:i.lat,longitud:i.lng})}),this.alojamientoForm.value.localizacion},error:n=>{console.error("No se pudo cargar el mapa",n)}})},100)}seleccionarImagenes(n){let i=n.target.files;if(!(!i||i.length===0)){if(this.imagenesSubidas.length+i.length>10){this.mensajeHandlerService.showError("Puedes subir m\xE1ximo 10 im\xE1genes");return}this.subiendoImagen=!0,Array.from(i).forEach((l,h)=>{this.imagenService.subirImagen(l).pipe(tn(this.destroy$),Si(()=>{h===i.length-1&&(this.subiendoImagen=!1)})).subscribe({next:o=>{this.imagenesSubidas.push(o.data.url)},error:o=>{let E=this.mensajeHandlerService.handleHttpError(o);this.mensajeHandlerService.showError(E)}})})}}eliminarImagen(n){this.mensajeHandlerService.confirmDanger("Esta acci\xF3n no se puede deshacer","S\xED, eliminar","\xBFEliminar imagen?").then(i=>{if(i){let l=this.imagenesSubidas[n];if(!l)return;let h=l;if(!h){this.imagenesSubidas.splice(n,1);return}this.cargando=!0,this.imagenService.eliminarImagen(h).pipe(tn(this.destroy$),Si(()=>this.cargando=!1)).subscribe({next:()=>{this.imagenesSubidas.splice(n,1)},error:o=>{let E=this.mensajeHandlerService.handleHttpError(o);this.mensajeHandlerService.showError(E)}})}})}siguientePaso(){if(!this.validarPasoActual()){this.formUtilsService.marcarCamposComoTocados(this.alojamientoForm),this.mensajeHandlerService.showError("Por favor completa todos los campos requeridos");return}this.pasoActual<this.totalPasos&&(this.pasoActual++,this.pasoActual===2&&this.inicializarLogicaMapa())}pasoAnterior(){this.pasoActual>1&&(this.pasoActual--,this.pasoActual===2&&this.inicializarLogicaMapa())}irAPaso(n){(n<=this.pasoActual||this.validarPasosAnteriores(n))&&(this.pasoActual=n,n===2&&this.inicializarLogicaMapa())}validarPasoActual(){switch(this.pasoActual){case 1:return this.alojamientoForm.get("titulo").valid&&this.alojamientoForm.get("descripcion").valid&&this.alojamientoForm.get("maxHuespedes").valid&&this.alojamientoForm.get("precioPorNoche").valid;case 2:return this.alojamientoForm.get("ciudad").valid&&this.alojamientoForm.get("direccion").valid&&this.alojamientoForm.get("localizacion").valid;case 3:return this.obtenerServiciosSeleccionados().length>0;case 4:return this.imagenesSubidas.length>=3;default:return!0}}validarPasosAnteriores(n){for(let i=1;i<n;i++){let l=this.pasoActual;if(this.pasoActual=i,!this.validarPasoActual())return this.pasoActual=l,!1;this.pasoActual=l}return!0}guardarAlojamiento(){if(!this.validarFormularioCompleto()){this.mensajeHandlerService.showError("Por favor completa todos los pasos correctamente");return}this.modoEdicion&&this.idAlojamiento?this.editarAlojamiento():this.crearAlojamiento()}crearAlojamiento(){if(this.cargando=!0,!this.tokenService.getUserId()){this.mensajeHandlerService.showError("Tu sesi\xF3n ha expirado. Por favor, inicia sesi\xF3n de nuevo."),this.cargando=!1,this.router.navigate(["/login"]);return}let i={ciudad:this.alojamientoForm.value.ciudad,direccion:this.alojamientoForm.value.direccion,localizacion:this.alojamientoForm.value.localizacion},l={titulo:this.alojamientoForm.value.titulo,descripcion:this.alojamientoForm.value.descripcion,maxHuespedes:this.alojamientoForm.value.maxHuespedes,direccion:i,precioPorNoche:this.alojamientoForm.value.precioPorNoche,servicios:this.obtenerServiciosSeleccionados(),imagenes:this.imagenesSubidas};this.alojamientoService.crear(l).pipe(tn(this.destroy$),Si(()=>this.cargando=!1)).subscribe({next:h=>{this.mensajeHandlerService.showSuccessWithCallback(h.data,"\xA1Alojamiento creado!",()=>{this.router.navigate(["/mis-alojamientos"])})},error:h=>{let o=this.mensajeHandlerService.handleHttpError(h);this.mensajeHandlerService.showError(o)}})}editarAlojamiento(){this.cargando=!0;let n={ciudad:this.alojamientoForm.value.ciudad,direccion:this.alojamientoForm.value.direccion,localizacion:this.alojamientoForm.value.localizacion},i={titulo:this.alojamientoForm.value.titulo,descripcion:this.alojamientoForm.value.descripcion,maxHuespedes:this.alojamientoForm.value.maxHuespedes,precioPorNoche:this.alojamientoForm.value.precioPorNoche,servicios:this.obtenerServiciosSeleccionados(),imagenes:this.imagenesSubidas,direccion:n};this.alojamientoService.editar(this.idAlojamiento,i).pipe(tn(this.destroy$),Si(()=>this.cargando=!1)).subscribe({next:l=>{this.mensajeHandlerService.showSuccessWithCallback("Los cambios han sido guardados exitosamente","\xA1Alojamiento actualizado!",()=>{this.router.navigate(["/mis-alojamientos"])})},error:l=>{let h=this.mensajeHandlerService.handleHttpError(l);this.mensajeHandlerService.showError(h)}})}validarFormularioCompleto(){return this.alojamientoForm.valid&&this.obtenerServiciosSeleccionados().length>0&&this.imagenesSubidas.length>=3}formatearServicio(n){return{WIFI:"Wi-Fi",PISCINA:"Piscina",DESAYUNO:"Desayuno",AIRE_ACONDICIONADO:"Aire Acondicionado",ESTACIONAMIENTO:"Estacionamiento",COCINA:"Cocina",LAVADORA:"Lavadora",TV:"Televisi\xF3n",GYM:"Gimnasio",MASCOTAS:"Mascotas permitidas"}[n]||n}obtenerIconoServicio(n){return{WIFI:"fa-wifi",PISCINA:"fa-person-swimming",DESAYUNO:"fa-mug-hot",AIRE_ACONDICIONADO:"fa-snowflake",ESTACIONAMIENTO:"fa-car",COCINA:"fa-kitchen-set",LAVADORA:"fa-shirt",TV:"fa-tv",GYM:"fa-dumbbell",MASCOTAS:"fa-paw"}[n]||"fa-check"}volver(){this.location.back()}static \u0275fac=function(i){return new(i||t)(wt(Ld),wt(la),wt(br),wt(Fl),wt(As),wt(fv),wt(Pp),wt(sv),wt(Ar),wt(rs),wt(Nl),wt(hv))};static \u0275cmp=Ai({type:t,selectors:[["app-crear-alojamiento"]],decls:26,vars:11,consts:[["fileInput",""],[1,"container","dashboard-container"],[1,"dashboard-layout",2,"grid-template-columns","1fr","max-width","1000px","margin","0 auto"],[1,"dashboard-content"],[1,"content-header",2,"margin-bottom","3rem"],[2,"color","#7F8C8D","margin-top","0.5rem"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"fa-solid","fa-arrow-left"],[1,"form-progress-bar"],[1,"step",2,"cursor","pointer",3,"active","completed"],[3,"ngSubmit","formGroup"],[1,"form-step-content","active"],["formArrayName","servicios",1,"form-step-content","active"],[1,"form-navigation"],["type","button",1,"btn","btn-secondary",3,"click","disabled"],["type","button",1,"btn","btn-primary"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"step",2,"cursor","pointer",3,"click"],[2,"font-size","1.2rem","margin-right","8px"],[1,"fa-solid","fa-check-circle",2,"color","var(--success-color)"],[2,"margin-bottom","2rem","color","var(--dark-green)"],[1,"fa-solid","fa-info-circle"],[1,"form-grid"],[1,"form-group","full-width"],["for","titulo"],["type","text","id","titulo","formControlName","titulo","placeholder","Ej: Hermoso apartamento en el centro"],[1,"error-message","show"],[2,"font-size","0.85rem","color","#7F8C8D","margin-top","0.5rem","text-align","right"],["for","descripcion"],["id","descripcion","formControlName","descripcion","rows","6","placeholder","Describe tu alojamiento: caracter\xEDsticas, espacios, comodidades..."],[1,"form-group"],["for","maxHuespedes"],["type","number","id","maxHuespedes","formControlName","maxHuespedes","min","1","max","20"],["for","precioPorNoche"],["type","number","id","precioPorNoche","formControlName","precioPorNoche","min","10000","placeholder","50000"],[1,"fa-solid","fa-location-dot"],["for","ciudad"],["id","ciudad","formControlName","ciudad"],["value",""],[3,"value"],["for","direccion"],["type","text","id","direccion","formControlName","direccion","placeholder","Calle 123 #45-67"],[2,"font-size","0.9rem","color","#7F8C8D","margin-bottom","1rem"],[1,"fa-solid","fa-hand-pointer"],["id","map",2,"width","100%","height","400px","border-radius","16px","overflow","hidden","border","2px solid var(--border-color)"],[2,"margin-top","1rem","padding","1rem","background-color","var(--light-green)","border-radius","12px"],[2,"font-size","0.9rem","color","var(--text-color)","margin","0"],[1,"fa-solid","fa-list-check"],[2,"color","#7F8C8D","margin-bottom","2rem"],[1,"checkbox-grid"],[1,"checkbox-group"],[2,"margin-top","2rem","padding","1rem","background-color","rgba(231, 76, 60, 0.1)","border-radius","12px","border","1px solid var(--danger-color)"],[2,"display","flex","align-items","center","gap","12px"],["type","checkbox",2,"width","20px","height","20px","cursor","pointer",3,"id","formControlName"],[2,"cursor","pointer","margin","0","display","flex","align-items","center","gap","8px","flex","1",3,"for"],[2,"color","var(--primary-color)"],[2,"color","var(--danger-color)","margin","0"],[1,"fa-solid","fa-exclamation-triangle"],[1,"fa-solid","fa-images"],[1,"image-uploader",3,"click"],["type","file","multiple","","accept","image/*",2,"display","none",3,"change"],[1,"loading-spinner-large"],[1,"fa-solid","fa-cloud-arrow-up"],[2,"font-size","0.85rem","color","#7F8C8D","margin-top","0.5rem"],[1,"image-preview-grid"],[2,"position","relative"],[2,"text-align","center","margin-top","1.5rem","color","var(--text-color)"],[3,"src","alt"],["type","button",1,"btn-icon","btn-icon-danger",2,"position","absolute","top","8px","right","8px","background-color","rgba(255, 255, 255, 0.9)","border-radius","50%","width","32px","height","32px","display","flex","align-items","center","justify-content","center",3,"click"],[1,"fa-solid","fa-trash"],[2,"position","absolute","bottom","8px","left","8px","background-color","var(--primary-color)","color","white","padding","4px 8px","border-radius","8px","font-size","0.75rem","font-weight","600"],["type","button",1,"btn","btn-primary",3,"click"],[1,"fa-solid","fa-arrow-right"],[1,"loading-spinner"],[1,"fa-solid","fa-check"]],template:function(i,l){i&1&&($(0,"main",1)(1,"div",2)(2,"section",3)(3,"div",4)(4,"div")(5,"h1"),ne(6),W(),$(7,"p",5),ne(8),W()(),$(9,"button",6),Ot("click",function(){return l.volver()}),be(10,"i",7),ne(11," Volver "),W()(),$(12,"div",8),Ri(13,Boe,8,6,"div",9,ra),W(),$(15,"form",10),Ot("ngSubmit",function(){return l.guardarAlojamiento()}),tt(16,$oe,29,14,"div",11),tt(17,Zoe,34,8,"div",11),tt(18,Koe,10,1,"div",12),tt(19,rse,13,3,"div",11),$(20,"div",13)(21,"button",14),Ot("click",function(){return l.pasoAnterior()}),be(22,"i",7),ne(23," Anterior "),W(),tt(24,ose,3,0,"button",15),tt(25,lse,3,2,"button",16),W()()()()()),i&2&&(ie(6),Ln(l.modoEdicion?"Editar Alojamiento":"Crear Nuevo Alojamiento"),ie(2),nn(" ",l.modoEdicion?"Actualiza la informaci\xF3n de tu alojamiento":"Completa la informaci\xF3n para publicar tu alojamiento"," "),ie(5),ki(ms(10,Ooe)),ie(2),zt("formGroup",l.alojamientoForm),ie(),nt(l.pasoActual===1?16:-1),ie(),nt(l.pasoActual===2?17:-1),ie(),nt(l.pasoActual===3?18:-1),ie(),nt(l.pasoActual===4?19:-1),ie(2),zt("disabled",l.pasoActual===1),ie(3),nt(l.pasoActual<l.totalPasos?24:-1),ie(),nt(l.pasoActual===l.totalPasos?25:-1))},dependencies:[Mr,Nd,Fd,RS,kS,Ps,Wh,l1,ov,ca,kd,Zh,gg,Lc,Ou,OS],styles:['.error-message[_ngcontent-%COMP%]{color:var(--danger-color);font-size:.85rem;margin-top:.5rem;display:none;animation:_ngcontent-%COMP%_fadeInError .3s ease-in-out}.error-message.show[_ngcontent-%COMP%]{display:block}@keyframes _ngcontent-%COMP%_fadeInError{0%{opacity:0;transform:translateY(-5px)}to{opacity:1;transform:translateY(0)}}.form-group[_ngcontent-%COMP%]   input.error[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   textarea.error[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   select.error[_ngcontent-%COMP%]{border-color:var(--danger-color);box-shadow:0 0 0 3px #e74c3c1a;animation:_ngcontent-%COMP%_shake .5s ease-in-out}@keyframes _ngcontent-%COMP%_shake{0%,to{transform:translate(0)}10%,30%,50%,70%,90%{transform:translate(-5px)}20%,40%,60%,80%{transform:translate(5px)}}.form-progress-bar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:3rem;border-bottom:2px solid var(--light-green);position:relative}.form-progress-bar[_ngcontent-%COMP%]   .step[_ngcontent-%COMP%]{flex:1;text-align:center;padding-bottom:1.2rem;color:#95a5a6;font-weight:600;position:relative;transition:all .3s ease;font-size:.95rem}.form-progress-bar[_ngcontent-%COMP%]   .step[_ngcontent-%COMP%]:hover, .form-progress-bar[_ngcontent-%COMP%]   .step.active[_ngcontent-%COMP%]{color:var(--primary-color)}.form-progress-bar[_ngcontent-%COMP%]   .step.active[_ngcontent-%COMP%]:after{content:"";position:absolute;bottom:-2px;left:0;width:100%;height:3px;background-color:var(--primary-color);border-radius:2px;animation:_ngcontent-%COMP%_slideIn .3s ease-in-out}.form-progress-bar[_ngcontent-%COMP%]   .step.completed[_ngcontent-%COMP%]{color:var(--success-color)}@keyframes _ngcontent-%COMP%_slideIn{0%{width:0}to{width:100%}}.form-step-content[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .5s ease-in-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.form-step-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;font-size:1.6rem}#map[_ngcontent-%COMP%]{transition:all .3s ease}#map[_ngcontent-%COMP%]:hover{box-shadow:0 4px 12px #2e8b5733}.checkbox-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:1.2rem}.checkbox-grid[_ngcontent-%COMP%]   .checkbox-group[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{background-color:var(--light-green);padding:1rem;border-radius:12px;transition:all .3s ease;border:2px solid transparent}.checkbox-grid[_ngcontent-%COMP%]   .checkbox-group[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:hover{background-color:#2e8b5726;border-color:var(--primary-color)}.checkbox-grid[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]{font-weight:600;color:var(--primary-color)}.checkbox-grid[_ngcontent-%COMP%]   .checkbox-group[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:has(input:checked){background-color:var(--primary-color);color:var(--white-color);border-color:var(--primary-color)}.checkbox-grid[_ngcontent-%COMP%]   .checkbox-group[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:has(input:checked)   label[_ngcontent-%COMP%]{color:var(--white-color)}.checkbox-grid[_ngcontent-%COMP%]   .checkbox-group[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:has(input:checked)   i[_ngcontent-%COMP%]{color:var(--white-color)!important}.image-uploader[_ngcontent-%COMP%]{border:3px dashed var(--primary-color);border-radius:20px;padding:3rem;text-align:center;cursor:pointer;transition:all .3s ease;background-color:#2e8b5705;margin-bottom:2rem}.image-uploader[_ngcontent-%COMP%]:hover{background-color:var(--light-green);border-color:var(--accent-color);transform:scale(1.01)}.image-uploader[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:3.5rem;color:var(--primary-color);margin-bottom:1.5rem;display:block}.image-uploader[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--primary-color);font-weight:500;margin:0}.image-preview-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:1.5rem;margin-top:2rem}.image-preview-grid[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{position:relative;border-radius:16px;overflow:hidden;transition:all .3s ease}.image-preview-grid[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:hover{transform:scale(1.03);box-shadow:0 8px 24px #2e8b5733}.image-preview-grid[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:140px;object-fit:cover;display:block;border-radius:16px;border:2px solid var(--primary-color)}.loading-spinner[_ngcontent-%COMP%]{display:inline-block;width:16px;height:16px;border:2px solid #ffffff;border-radius:50%;border-top-color:transparent;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-right:8px}.loading-spinner-large[_ngcontent-%COMP%]{display:inline-block;width:48px;height:48px;border:4px solid var(--light-green);border-radius:50%;border-top-color:var(--primary-color);animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:1.5rem}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.form-navigation[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-top:3rem;border-top:2px solid var(--light-green);padding-top:2rem;gap:1rem}.form-navigation[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{min-width:140px}@media (max-width: 768px){.form-grid[_ngcontent-%COMP%]{grid-template-columns:1fr!important}.checkbox-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.form-progress-bar[_ngcontent-%COMP%]   .step[_ngcontent-%COMP%]{font-size:.75rem;padding:1rem .5rem}.form-progress-bar[_ngcontent-%COMP%]   .step[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:block;margin-bottom:.5rem}.image-preview-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}.form-navigation[_ngcontent-%COMP%]{flex-direction:column-reverse}.form-navigation[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{width:100%}#map[_ngcontent-%COMP%]{height:300px!important}}input[_ngcontent-%COMP%]:focus-visible, button[_ngcontent-%COMP%]:focus-visible, textarea[_ngcontent-%COMP%]:focus-visible, select[_ngcontent-%COMP%]:focus-visible{outline:3px solid var(--primary-color);outline-offset:2px}.dashboard-content[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideUp .5s ease-in-out}@keyframes _ngcontent-%COMP%_slideUp{0%{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}.form-step-content[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px}.form-step-content[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:var(--light-green);border-radius:10px}.form-step-content[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:var(--primary-color);border-radius:10px}.form-step-content[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:var(--accent-color)}']})};var V6=ep(_g());function cse(t,n){t&1&&($(0,"div",7),be(1,"div",8),$(2,"p",9),ne(3," Cargando informaci\xF3n... "),W()())}function use(t,n){t&1&&(be(0,"i",15),ne(1," Informaci\xF3n Anfitri\xF3n "))}function dse(t,n){t&1&&(be(0,"i",16),ne(1," Convertirse en Anfitri\xF3n "))}function hse(t,n){t&1&&(be(0,"div",8),$(1,"p",42),ne(2,"Subiendo imagen..."),W())}function fse(t,n){if(t&1){let i=Hn();be(0,"img",43),$(1,"button",44),Ot("click",function(){Wt(i),Ne();let h=Pl(11);return Zt(h.click())}),be(2,"i",45),W()}if(t&2){let i=Ne(3);zt("src",i.fotoPreview||"https://placehold.co/150x150/2e8b57/fff?text="+i.obtenerIniciales(),zr)("alt","Foto de "+i.usuario.nombre),ie(),zt("disabled",i.subiendoImagen)}}function pse(t,n){if(t&1&&($(0,"div",28),ne(1),W()),t&2){let i=Ne(3);ie(),nn(" ",i.formUtilsService.obtenerErrorCampo(i.perfilForm,"nombre")," ")}}function mse(t,n){if(t&1&&($(0,"div",28),ne(1),W()),t&2){let i=Ne(3);ie(),nn(" ",i.formUtilsService.obtenerErrorCampo(i.perfilForm,"telefono")," ")}}function gse(t,n){if(t&1&&($(0,"div",28),ne(1),W()),t&2){let i=Ne(3);ie(),nn(" ",i.formUtilsService.obtenerErrorCampo(i.perfilForm,"fechaNacimiento")," ")}}function _se(t,n){t&1&&(be(0,"i",46),$(1,"strong"),ne(2,"Anfitri\xF3n"),W(),ne(3," - Puedes publicar alojamientos "))}function vse(t,n){t&1&&(be(0,"i",47),$(1,"strong"),ne(2,"Hu\xE9sped"),W(),ne(3," - Puedes reservar alojamientos "))}function yse(t,n){t&1&&(be(0,"span",48),ne(1," Guardando... "))}function xse(t,n){t&1&&(be(0,"i",49),ne(1," Guardar Cambios "))}function bse(t,n){if(t&1){let i=Hn();$(0,"div",14)(1,"form",17),Ot("ngSubmit",function(){Wt(i);let h=Ne(2);return Zt(h.guardarPerfil())}),$(2,"div",18)(3,"div",19)(4,"label"),ne(5,"Foto de Perfil"),W(),$(6,"div",20)(7,"div",21),tt(8,hse,3,0)(9,fse,3,3),W(),$(10,"input",22,0),Ot("change",function(h){Wt(i);let o=Ne(2);return Zt(o.seleccionarImagen(h))}),W(),$(12,"button",23),Ot("click",function(){Wt(i);let h=Pl(11);return Zt(h.click())}),be(13,"i",24),ne(14," Cambiar Foto "),W()()(),$(15,"div",25)(16,"label",26),ne(17,"Nombre Completo *"),W(),be(18,"input",27),tt(19,pse,2,1,"div",28),W(),$(20,"div",25)(21,"label",29),ne(22,"Correo Electr\xF3nico"),W(),be(23,"input",30),$(24,"small",31),be(25,"i",32),ne(26," El email no se puede cambiar. Contacta soporte si necesitas modificarlo. "),W()(),$(27,"div",33)(28,"label",34),ne(29,"Tel\xE9fono *"),W(),be(30,"input",35),tt(31,mse,2,1,"div",28),W(),$(32,"div",33)(33,"label",36),ne(34,"Fecha de Nacimiento *"),W(),be(35,"input",37),tt(36,gse,2,1,"div",28),W(),$(37,"div",25)(38,"label"),ne(39,"Tipo de Cuenta"),W(),$(40,"div",38)(41,"p",39),tt(42,_se,4,0)(43,vse,4,0),W()()()(),$(44,"div",40)(45,"button",41),tt(46,yse,2,0)(47,xse,2,0),W()()()()}if(t&2){let i=Ne(2);ie(),zt("formGroup",i.perfilForm),ie(7),nt(i.subiendoImagen?8:9),ie(4),zt("disabled",i.subiendoImagen),ie(6),Dn("error",i.formUtilsService.campoInvalido(i.perfilForm,"nombre")),ie(),nt(i.formUtilsService.campoInvalido(i.perfilForm,"nombre")?19:-1),ie(4),zt("value",i.usuario.email),ie(7),Dn("error",i.formUtilsService.campoInvalido(i.perfilForm,"telefono")),ie(),nt(i.formUtilsService.campoInvalido(i.perfilForm,"telefono")?31:-1),ie(4),Dn("error",i.formUtilsService.campoInvalido(i.perfilForm,"fechaNacimiento")),zt("max",i.formUtilsService.obtenerFechaMaxima())("min",i.formUtilsService.obtenerFechaMinima()),ie(),nt(i.formUtilsService.campoInvalido(i.perfilForm,"fechaNacimiento")?36:-1),ie(6),nt(i.usuario.esAnfitrion?42:43),ie(3),zt("disabled",i.cargando||i.perfilForm.invalid),ie(),nt(i.cargando?46:47)}}function wse(t,n){if(t&1&&($(0,"div",28),ne(1),W()),t&2){let i=Ne(3);ie(),nn(" ",i.formUtilsService.obtenerErrorCampo(i.seguridadForm,"contrasenaActual")," ")}}function Cse(t,n){t&1&&be(0,"i",59)}function Ese(t,n){t&1&&be(0,"i",59)}function Tse(t,n){t&1&&be(0,"i",59)}function Sse(t,n){if(t&1&&($(0,"div",28),ne(1),W()),t&2){let i=Ne(3);ie(),nn(" ",i.formUtilsService.obtenerErrorCampo(i.seguridadForm,"contrasenaNueva")," ")}}function Dse(t,n){t&1&&($(0,"div",28),ne(1," Las contrase\xF1as no coinciden "),W())}function Ise(t,n){t&1&&(be(0,"span",48),ne(1," Actualizando... "))}function Mse(t,n){t&1&&(be(0,"i",49),ne(1," Actualizar Seguridad "))}function Ase(t,n){if(t&1){let i=Hn();$(0,"div",14)(1,"form",17),Ot("ngSubmit",function(){Wt(i);let h=Ne(2);return Zt(h.cambiarContrasena())}),$(2,"div",18)(3,"div",25)(4,"h3",50),be(5,"i",51),ne(6," Cambiar Contrase\xF1a "),W()(),$(7,"div",25)(8,"label",52),ne(9,"Contrase\xF1a Actual *"),W(),$(10,"div",53),be(11,"input",54),$(12,"button",55),Ot("click",function(){Wt(i);let h=Ne(2);return Zt(h.toggleContrasena("actual"))}),be(13,"i"),W()(),tt(14,wse,2,1,"div",28),W(),$(15,"div",33)(16,"label",56),ne(17,"Nueva Contrase\xF1a *"),W(),$(18,"div",53),be(19,"input",57),$(20,"button",55),Ot("click",function(){Wt(i);let h=Ne(2);return Zt(h.toggleContrasena("nueva"))}),be(21,"i"),W()(),$(22,"div",58)(23,"p"),be(24,"i",32),ne(25," Debe contener al menos:"),W(),$(26,"ul")(27,"li"),tt(28,Cse,1,0,"i",59),ne(29," 8 caracteres "),W(),$(30,"li"),tt(31,Ese,1,0,"i",59),ne(32," 1 letra may\xFAscula "),W(),$(33,"li"),tt(34,Tse,1,0,"i",59),ne(35," 1 n\xFAmero "),W()()(),tt(36,Sse,2,1,"div",28),W(),$(37,"div",33)(38,"label",60),ne(39,"Confirmar Nueva Contrase\xF1a *"),W(),$(40,"div",53),be(41,"input",61),$(42,"button",55),Ot("click",function(){Wt(i);let h=Ne(2);return Zt(h.toggleContrasena("confirmar"))}),be(43,"i"),W()(),tt(44,Dse,2,0,"div",28),W(),$(45,"div",25)(46,"div",62)(47,"h3"),be(48,"i",63),ne(49," Zona de Peligro "),W(),$(50,"p"),ne(51," Una vez que elimines tu cuenta, no hay vuelta atr\xE1s. Por favor aseg\xFArate. "),W(),$(52,"button",64),Ot("click",function(){Wt(i);let h=Ne(2);return Zt(h.confirmarEliminarCuenta())}),be(53,"i",65),ne(54," Eliminar mi cuenta "),W()()()(),$(55,"div",40)(56,"button",41),tt(57,Ise,2,0)(58,Mse,2,0),W()()()()}if(t&2){let i,l,h=Ne(2);ie(),zt("formGroup",h.seguridadForm),ie(10),Dn("error",h.formUtilsService.campoInvalido(h.seguridadForm,"contrasenaActual")),zt("type",h.mostrarContrasenaActual?"text":"password"),ie(2),Ta(h.mostrarContrasenaActual?"fa-solid fa-eye-slash":"fa-solid fa-eye"),ie(),nt(h.formUtilsService.campoInvalido(h.seguridadForm,"contrasenaActual")?14:-1),ie(5),Dn("error",h.formUtilsService.campoInvalido(h.seguridadForm,"contrasenaNueva")),zt("type",h.mostrarNuevaContrasena?"text":"password"),ie(2),Ta(h.mostrarNuevaContrasena?"fa-solid fa-eye-slash":"fa-solid fa-eye"),ie(6),Dn("valid",h.validacionContrasena.tieneLongitud),ie(),nt(h.validacionContrasena.tieneLongitud?28:-1),ie(2),Dn("valid",h.validacionContrasena.tieneMayuscula),ie(),nt(h.validacionContrasena.tieneMayuscula?31:-1),ie(2),Dn("valid",h.validacionContrasena.tieneNumero),ie(),nt(h.validacionContrasena.tieneNumero?34:-1),ie(2),nt(h.formUtilsService.campoInvalido(h.seguridadForm,"contrasenaNueva")?36:-1),ie(5),Dn("error",h.formUtilsService.formularioTieneError(h.seguridadForm,"contrasenasNoCoinciden")&&((i=h.seguridadForm.get("confirmarContrasena"))==null?null:i.touched)),zt("type",h.mostrarConfirmarContrasena?"text":"password"),ie(2),Ta(h.mostrarConfirmarContrasena?"fa-solid fa-eye-slash":"fa-solid fa-eye"),ie(),nt(h.formUtilsService.formularioTieneError(h.seguridadForm,"contrasenasNoCoinciden")&&((l=h.seguridadForm.get("confirmarContrasena"))!=null&&l.touched)?44:-1),ie(12),zt("disabled",h.cargando||h.seguridadForm.invalid),ie(),nt(h.cargando?57:58)}}function Pse(t,n){t&1&&($(0,"div",7),be(1,"div",8),$(2,"p",9),ne(3," Cargando informaci\xF3n de anfitri\xF3n... "),W()())}function Ose(t,n){t&1&&($(0,"div",68),be(1,"i",70),$(2,"strong"),ne(3,"Documento Verificado"),W()())}function Rse(t,n){t&1&&($(0,"p",69),ne(1," No se encontr\xF3 ning\xFAn documento verificado. "),W())}function kse(t,n){if(t&1&&($(0,"div",18)(1,"div",25)(2,"h3",50),be(3,"i",46),ne(4," Perfil de Anfitri\xF3n "),W(),$(5,"p"),ne(6,"Esta es la informaci\xF3n que ven los hu\xE9spedes sobre ti."),W()(),$(7,"div",25)(8,"label"),ne(9,"Sobre M\xED"),W(),be(10,"textarea",67),W(),$(11,"div",25)(12,"label"),ne(13,"Documento Legal Registrado"),W(),tt(14,Ose,4,0,"div",68)(15,Rse,2,0,"p",69),W()()),t&2){let i=Ne(4);ie(10),zt("value",i.anfitrionInfo.sobreMi),ie(4),nt(i.anfitrionInfo.documentoLegal?14:15)}}function Fse(t,n){t&1&&($(0,"p"),ne(1,"No se pudo cargar la informaci\xF3n de anfitri\xF3n."),W())}function Lse(t,n){if(t&1&&(tt(0,Pse,4,0,"div",7),tt(1,kse,16,2,"div",18)(2,Fse,2,0,"p")),t&2){let i=Ne(3);nt(i.cargandoAnfitrion?0:-1),ie(),nt(!i.cargandoAnfitrion&&i.anfitrionInfo?1:!i.cargandoAnfitrion&&!i.anfitrionInfo?2:-1)}}function Nse(t,n){if(t&1&&($(0,"div",28),ne(1),W()),t&2){let i=Ne(4);ie(),nn(" ",i.formUtilsService.obtenerErrorCampo(i.anfitrionForm,"sobreMi")," ")}}function zse(t,n){t&1&&(be(0,"span",48),ne(1," Subiendo... "))}function Bse(t,n){t&1&&(be(0,"i",24),ne(1," Seleccionar Documento (PDF) "))}function jse(t,n){if(t&1&&($(0,"div",77),be(1,"i",79),ne(2),W()),t&2){let i=Ne(4);ie(2),nn(" ",i.nombreDocumentoSubido," cargado exitosamente. ")}}function Vse(t,n){if(t&1&&($(0,"div",28),ne(1),W()),t&2){let i=Ne(4);ie(),nn(" ",i.formUtilsService.obtenerErrorCampo(i.anfitrionForm,"documentoLegal")," ")}}function Use(t,n){t&1&&(be(0,"span",48),ne(1," Enviando Solicitud... "))}function Hse(t,n){t&1&&(be(0,"i",80),ne(1," Enviar Solicitud "))}function $se(t,n){if(t&1){let i=Hn();$(0,"form",17),Ot("ngSubmit",function(){Wt(i);let h=Ne(3);return Zt(h.convertirseEnAnfitrion())}),$(1,"div",18)(2,"div",25)(3,"h3",50),be(4,"i",16),ne(5," Convi\xE9rtete en Anfitri\xF3n "),W(),$(6,"p"),ne(7,"Completa tu perfil para empezar a publicar tus alojamientos. Deber\xE1s proporcionar una breve descripci\xF3n sobre ti y un documento legal (PDF) para verificaci\xF3n."),W()(),$(8,"div",25)(9,"label",71),ne(10,"Sobre M\xED *"),W(),$(11,"textarea",72),ne(12,"                    "),W(),tt(13,Nse,2,1,"div",28),W(),$(14,"div",25)(15,"label",73),ne(16,"Documento Legal (PDF) *"),W(),$(17,"p",74),ne(18," Necesitamos un documento (Ej: RUT, C\xE9dula) para verificar tu identidad. M\xE1x 5MB. "),W(),$(19,"button",75),Ot("click",function(){Wt(i);let h=Pl(23);return Zt(h.click())}),tt(20,zse,2,0)(21,Bse,2,0),W(),$(22,"input",76,1),Ot("change",function(h){Wt(i);let o=Ne(3);return Zt(o.seleccionarDocumento(h))}),W(),tt(24,jse,3,1,"div",77),be(25,"input",78),tt(26,Vse,2,1,"div",28),W()(),$(27,"div",40)(28,"button",41),tt(29,Use,2,0)(30,Hse,2,0),W()()()}if(t&2){let i=Ne(3);zt("formGroup",i.anfitrionForm),ie(11),Dn("error",i.formUtilsService.campoInvalido(i.anfitrionForm,"sobreMi")),ie(2),nt(i.formUtilsService.campoInvalido(i.anfitrionForm,"sobreMi")?13:-1),ie(6),zt("disabled",i.subiendoDocumento),ie(),nt(i.subiendoDocumento?20:21),ie(4),nt(i.nombreDocumentoSubido&&!i.subiendoDocumento&&!i.formUtilsService.campoInvalido(i.anfitrionForm,"documentoLegal")?24:-1),ie(2),nt(i.formUtilsService.campoInvalido(i.anfitrionForm,"documentoLegal")?26:-1),ie(2),zt("disabled",i.cargando||i.anfitrionForm.invalid||i.subiendoDocumento),ie(),nt(i.cargando?29:30)}}function Gse(t,n){if(t&1&&($(0,"div",14),tt(1,Lse,3,2)(2,$se,31,10,"form",66),W()),t&2){let i=Ne(2);ie(),nt(i.usuario.esAnfitrion?1:2)}}function qse(t,n){if(t&1){let i=Hn();$(0,"div",10)(1,"button",11),Ot("click",function(){Wt(i);let h=Ne();return Zt(h.cambiarTab("personal"))}),be(2,"i",12),ne(3," Informaci\xF3n Personal "),W(),$(4,"button",11),Ot("click",function(){Wt(i);let h=Ne();return Zt(h.cambiarTab("seguridad"))}),be(5,"i",13),ne(6," Seguridad "),W(),$(7,"button",11),Ot("click",function(){Wt(i);let h=Ne();return Zt(h.cambiarTab("anfitrion"))}),tt(8,use,2,0)(9,dse,2,0),W()(),tt(10,bse,48,18,"div",14),tt(11,Ase,59,30,"div",14),tt(12,Gse,3,1,"div",14)}if(t&2){let i=Ne();ie(),Dn("active",i.tabActiva==="personal"),ie(3),Dn("active",i.tabActiva==="seguridad"),ie(3),Dn("active",i.tabActiva==="anfitrion"),ie(),nt(i.usuario.esAnfitrion?8:9),ie(2),nt(i.tabActiva==="personal"?10:-1),ie(),nt(i.tabActiva==="seguridad"?11:-1),ie(),nt(i.tabActiva==="anfitrion"?12:-1)}}var XS=class t{constructor(n,i,l,h,o,E,A){this.formBuilder=n;this.usuarioService=i;this.tokenService=l;this.imagenService=h;this.mensajeHandlerService=o;this.formUtilsService=E;this.router=A}perfilForm;seguridadForm;anfitrionForm;usuario=null;anfitrionInfo=null;tabActiva="personal";cargando=!1;cargandoUsuario=!1;cargandoAnfitrion=!1;subiendoImagen=!1;subiendoDocumento=!1;mostrarContrasenaActual=!1;mostrarNuevaContrasena=!1;mostrarConfirmarContrasena=!1;fotoPreview="";fotoSubida="";documentoSubido="";nombreDocumentoSubido="";validacionContrasena={tieneLongitud:!1,tieneMayuscula:!1,tieneNumero:!1};destroy$=new Fn;ngOnInit(){this.crearFormularios(),this.cargarDatosUsuario(),this.configurarValidacionContrasena()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}crearFormularios(){this.perfilForm=this.formBuilder.group({nombre:["",[Pn.required,Pn.minLength(2)]],telefono:["",[Pn.required,Pn.minLength(10),Pn.maxLength(10),Pn.pattern(/^[0-9]{10}$/)]],fechaNacimiento:["",[Pn.required,this.formUtilsService.edadMinimaValidador(18)]],foto:[""]}),this.seguridadForm=this.formBuilder.group({contrasenaActual:["",[Pn.required,Pn.minLength(8)]],contrasenaNueva:["",[Pn.required,Pn.minLength(8),this.formUtilsService.contrasenaFuerteValidador()]],confirmarContrasena:["",[Pn.required]]},{validators:this.formUtilsService.contrasenasMatchValidador()}),this.anfitrionForm=this.formBuilder.group({sobreMi:["",[Pn.required,Pn.minLength(50),Pn.maxLength(1e3)]],documentoLegal:[null,[Pn.required]]})}cargarDatosUsuario(){let n=this.tokenService.getUserId();if(!n){this.router.navigate(["/login"]);return}this.cargandoUsuario=!0,this.usuarioService.obtener(n).pipe(tn(this.destroy$),Si(()=>this.cargandoUsuario=!1)).subscribe({next:i=>{this.usuario=i.data,this.fotoPreview=this.usuario.foto||"",this.fotoSubida=this.usuario.foto||"",this.perfilForm.patchValue({nombre:this.usuario.nombre,telefono:this.usuario.telefono,foto:this.usuario.foto,fechaNacimiento:this.usuario.fechaNacimiento}),this.usuario.esAnfitrion&&this.cargarDatosAnfitrion(n)},error:i=>{let l=this.mensajeHandlerService.handleHttpError(i);this.mensajeHandlerService.showError(l)}})}cargarDatosAnfitrion(n){this.cargandoAnfitrion=!0,this.usuarioService.obtenerAnfitrion(n).pipe(tn(this.destroy$),Si(()=>this.cargandoAnfitrion=!1)).subscribe({next:i=>{this.anfitrionInfo=i.data},error:i=>{let l=this.mensajeHandlerService.handleHttpError(i);this.mensajeHandlerService.showError(l)}})}configurarValidacionContrasena(){this.seguridadForm.get("contrasenaNueva")?.valueChanges.pipe(tn(this.destroy$)).subscribe(n=>{this.validacionContrasena.tieneLongitud=n?.length>=8,this.validacionContrasena.tieneMayuscula=/[A-Z]/.test(n),this.validacionContrasena.tieneNumero=/\d/.test(n)})}cambiarTab(n){this.tabActiva=n,n==="personal"&&this.seguridadForm.reset()}seleccionarImagen(n){let i=n.target.files[0];if(!i)return;if(i.size>5*1024*1024){this.mensajeHandlerService.showError("La imagen no puede pesar m\xE1s de 5MB");return}if(!i.type.startsWith("image/")){this.mensajeHandlerService.showError("Solo se permiten archivos de imagen");return}let l=new FileReader;l.onload=h=>{this.fotoPreview=h.target.result},l.readAsDataURL(i),this.subirImagen(i)}subirImagen(n){this.subiendoImagen=!0,this.imagenService.subirImagen(n).pipe(tn(this.destroy$),Si(()=>this.subiendoImagen=!1)).subscribe({next:i=>{i.error||(this.fotoSubida=i.data.url,this.perfilForm.patchValue({foto:i.data.url}))},error:i=>{let l=this.mensajeHandlerService.handleHttpError(i);this.mensajeHandlerService.showError(l),this.fotoPreview=this.fotoSubida}})}guardarPerfil(){if(this.perfilForm.invalid){this.formUtilsService.marcarCamposComoTocados(this.perfilForm);return}let n=this.tokenService.getUserId();if(!n){this.mensajeHandlerService.showError("Sesi\xF3n expirada. Por favor, inicia sesi\xF3n de nuevo."),this.router.navigate(["/login"]);return}this.cargando=!0;let i=this.perfilForm.value;this.usuarioService.editar(n,i).pipe(tn(this.destroy$),Si(()=>this.cargando=!1)).subscribe({next:l=>{this.mensajeHandlerService.showSuccessWithCallback(l.data,"\xA1Perfil actualizado!",()=>{this.cargarDatosUsuario()})},error:l=>{let h=this.mensajeHandlerService.handleHttpError(l);this.mensajeHandlerService.showError(h)}})}cambiarContrasena(){if(this.seguridadForm.invalid){this.formUtilsService.marcarCamposComoTocados(this.seguridadForm);return}let n=this.tokenService.getUserId();if(!n){this.mensajeHandlerService.showError("Sesi\xF3n expirada. Por favor, inicia sesi\xF3n de nuevo."),this.router.navigate(["/login"]);return}this.cargando=!0;let i={contrasenaActual:this.seguridadForm.value.contrasenaActual,contrasenaNueva:this.seguridadForm.value.contrasenaNueva};this.usuarioService.cambiarContrasena(n,i).pipe(tn(this.destroy$),Si(()=>this.cargando=!1)).subscribe({next:l=>{this.mensajeHandlerService.showSuccess(l.data,"\xA1Contrase\xF1a actualizada!"),this.tokenService.logout(),this.usuario=null,this.seguridadForm.reset(),this.router.navigate(["/login"]).then(h=>window.location.reload())},error:l=>{let h=this.mensajeHandlerService.handleHttpError(l);this.mensajeHandlerService.showError(h)}})}convertirseEnAnfitrion(){if(this.anfitrionForm.invalid){this.formUtilsService.marcarCamposComoTocados(this.anfitrionForm);return}let n=this.tokenService.getUserId();if(!n){this.mensajeHandlerService.showError("Sesi\xF3n expirada.");return}this.cargando=!0;let i={usuarioId:n,sobreMi:this.anfitrionForm.value.sobreMi,documentoLegal:this.anfitrionForm.value.documentoLegal};this.usuarioService.crearAnfitrion(i).pipe(tn(this.destroy$),Si(()=>this.cargando=!1)).subscribe({next:l=>{this.mensajeHandlerService.showSuccessWithCallback(l.data,"\xA1Solicitud Enviada!",()=>{this.tokenService.logout(),this.usuario=null,this.seguridadForm.reset(),this.router.navigate(["/login"]).then(h=>window.location.reload())})},error:l=>{let h=this.mensajeHandlerService.handleHttpError(l);this.mensajeHandlerService.showError(h)}})}seleccionarDocumento(n){let i=n.target.files[0];if(i){if(i.size>5*1024*1024){this.mensajeHandlerService.showError("El documento no puede pesar m\xE1s de 5MB");return}if(i.type!=="application/pdf"){this.mensajeHandlerService.showError("Solo se permiten archivos PDF");return}this.nombreDocumentoSubido=i.name,this.subirDocumento(i)}}subirDocumento(n){this.subiendoDocumento=!0,this.imagenService.subirImagen(n).pipe(tn(this.destroy$),Si(()=>this.subiendoDocumento=!1)).subscribe({next:i=>{this.documentoSubido=i.data.url,this.anfitrionForm.patchValue({documentoLegal:i.data.url})},error:i=>{let l=this.mensajeHandlerService.handleHttpError(i);this.mensajeHandlerService.showError(l),this.nombreDocumentoSubido=""}})}confirmarEliminarCuenta(){V6.default.fire({title:"\xBFEliminar cuenta?",html:`
        <div style="text-align: left;">
          <p style="color: var(--danger-color); font-weight: 600; margin-bottom: 1rem;">
            \u26A0\uFE0F Esta acci\xF3n es irreversible
          </p>
          <p style="color: var(--text-color); margin-bottom: 0.5rem;">
            Al eliminar tu cuenta:
          </p>
          <ul style="text-align: left; color: var(--text-color); padding-left: 1.5rem;">
            <li>Perder\xE1s acceso a todos tus datos</li>
            <li>Se cancelar\xE1n todas tus reservas activas</li>
            <li>Se eliminar\xE1n tus alojamientos (si eres anfitri\xF3n)</li>
            <li>No podr\xE1s recuperar tu cuenta</li>
          </ul>
        </div>
      `,icon:"warning",showCancelButton:!0,confirmButtonText:"S\xED, eliminar mi cuenta",cancelButtonText:"Cancelar",confirmButtonColor:"#e74c3c",cancelButtonColor:"#95a5a6",input:"text",inputPlaceholder:'Escribe "ELIMINAR" para confirmar',inputValidator:n=>n!=="ELIMINAR"?'Debes escribir "ELIMINAR" para confirmar':null}).then(n=>{n.isConfirmed&&this.eliminarCuenta()})}eliminarCuenta(){let n=this.tokenService.getUserId();n&&(this.mensajeHandlerService.showLoading("'Eliminando cuenta...'"),this.usuarioService.eliminar(n).pipe(tn(this.destroy$)).subscribe({next:()=>{this.mensajeHandlerService.showSuccessWithCallback("Tu cuenta ha sido eliminada correctamente","Cuenta eliminada",()=>{this.tokenService.logout(),this.router.navigate(["/"])})},error:i=>{this.mensajeHandlerService.closeModal();let l=this.mensajeHandlerService.handleHttpError(i);this.mensajeHandlerService.showError(l)}}))}toggleContrasena(n){switch(n){case"actual":this.mostrarContrasenaActual=!this.mostrarContrasenaActual;break;case"nueva":this.mostrarNuevaContrasena=!this.mostrarNuevaContrasena;break;case"confirmar":this.mostrarConfirmarContrasena=!this.mostrarConfirmarContrasena;break}}obtenerIniciales(){return this.usuario?this.usuario.nombre.charAt(0).toUpperCase():"U"}static \u0275fac=function(i){return new(i||t)(wt(Ld),wt(Os),wt(Ar),wt(fv),wt(rs),wt(Nl),wt(br))};static \u0275cmp=Ai({type:t,selectors:[["app-editar-perfil"]],decls:12,vars:2,consts:[["fileInput",""],["docInput",""],[1,"container","dashboard-container"],[1,"dashboard-layout"],[1,"dashboard-content"],[1,"content-header"],[2,"color","#7F8C8D","margin-top","0.5rem"],[1,"loading-container",2,"text-align","center","padding","4rem 2rem"],[1,"loading-spinner-large"],[2,"color","var(--text-color)","font-size","1.1rem","margin-top","1rem"],[1,"tabs"],[1,"tab-link",3,"click"],[1,"fa-solid","fa-user"],[1,"fa-solid","fa-shield-halved"],[1,"tab-content","active"],[1,"fa-solid","fa-star"],[1,"fa-solid","fa-house-user"],[3,"ngSubmit","formGroup"],[1,"form-grid"],[1,"form-group","full-width",2,"text-align","center","margin-bottom","2rem"],[1,"profile-image-container"],[1,"current-image"],["type","file","accept","image/*",2,"display","none",3,"change"],["type","button",1,"btn","btn-secondary",2,"margin-top","1rem",3,"click","disabled"],[1,"fa-solid","fa-upload"],[1,"form-group","full-width"],["for","nombre"],["type","text","id","nombre","formControlName","nombre","placeholder","Tu nombre completo"],[1,"error-message","show"],["for","email"],["type","email","id","email","disabled","",2,"background-color","var(--light-green)","cursor","not-allowed",3,"value"],[2,"color","#7F8C8D","font-size","0.85rem","margin-top","0.5rem","display","block"],[1,"fa-solid","fa-info-circle"],[1,"form-group"],["for","telefono"],["type","tel","id","telefono","formControlName","telefono","placeholder","300 123 4567","maxlength","10"],["for","fechaNacimiento"],["type","date","id","fechaNacimiento","formControlName","fechaNacimiento","autocomplete","bday",3,"max","min"],[2,"padding","1rem","background-color","var(--light-green)","border-radius","12px"],[2,"margin","0","display","flex","align-items","center","gap","8px"],[1,"form-navigation",2,"justify-content","flex-end","border-top","2px solid var(--light-green)","padding-top","2rem","margin-top","2rem"],["type","submit",1,"btn","btn-primary",3,"disabled"],[2,"margin-top","1rem","color","var(--text-color)"],[1,"profile-preview",3,"src","alt"],["type","button",1,"btn-icon-camera",3,"click","disabled"],[1,"fa-solid","fa-camera"],[1,"fa-solid","fa-star",2,"color","var(--primary-color)"],[1,"fa-solid","fa-user",2,"color","var(--primary-color)"],[1,"loading-spinner"],[1,"fa-solid","fa-floppy-disk"],[2,"color","var(--dark-green)","margin-bottom","1.5rem"],[1,"fa-solid","fa-key"],["for","contrasenaActual"],[1,"password-input-container"],["id","contrasenaActual","formControlName","contrasenaActual","placeholder","Tu contrase\xF1a actual",3,"type"],["type","button",1,"password-toggle",3,"click"],["for","contrasenaNueva"],["id","contrasenaNueva","formControlName","contrasenaNueva","placeholder","Tu nueva contrase\xF1a",3,"type"],[1,"password-requirements"],[1,"fa-solid","fa-check"],["for","confirmarContrasena"],["id","confirmarContrasena","formControlName","confirmarContrasena","placeholder","Repite tu nueva contrase\xF1a",3,"type"],[1,"danger-zone"],[1,"fa-solid","fa-triangle-exclamation"],["type","button",1,"btn","btn-danger",3,"click"],[1,"fa-solid","fa-trash"],[3,"formGroup"],["rows","6","disabled","",2,"background-color","var(--light-green)","cursor","not-allowed",3,"value"],[2,"padding","1rem","background","var(--light-green)","border-radius","12px","display","flex","align-items","center","gap","10px"],[2,"color","var(--text-color)","margin-top","0.5rem"],[1,"fa-solid","fa-file-pdf",2,"color","var(--primary-color)"],["for","sobreMi"],["id","sobreMi","formControlName","sobreMi","rows","6","placeholder","Cu\xE9ntales a los hu\xE9spedes un poco sobre ti, tus hobbies, por qu\xE9 te gusta ser anfitri\xF3n, etc. (M\xEDnimo 50 caracteres)"],["for","documentoLegal"],[2,"color","#7F8C8D","font-size","0.85rem","margin-top","0","margin-bottom","1rem"],["type","button",1,"btn","btn-secondary",3,"click","disabled"],["type","file","accept","application/pdf",2,"display","none",3,"change"],[2,"margin-top","1rem","color","var(--success-color)","font-weight","600","display","flex","align-items","center","gap","8px"],["type","hidden","formControlName","documentoLegal"],[1,"fa-solid","fa-check-circle"],[1,"fa-solid","fa-paper-plane"]],template:function(i,l){i&1&&($(0,"main",2)(1,"div",3),be(2,"app-panel-usuario"),$(3,"section",4)(4,"div",5)(5,"div")(6,"h1"),ne(7,"Editar Mi Perfil"),W(),$(8,"p",6),ne(9,"Actualiza tu informaci\xF3n personal y preferencias"),W()()(),tt(10,cse,4,0,"div",7),tt(11,qse,13,10),W()()()),i&2&&(ie(10),nt(l.cargandoUsuario?10:-1),ie(),nt(!l.cargandoUsuario&&l.usuario?11:-1))},dependencies:[Mr,Nd,Fd,Ps,ca,kd,_R,Lc,Ou,zc],styles:[".profile-image-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:1rem;padding:2rem;background:linear-gradient(135deg,var(--light-green) 0%,rgba(46,139,87,.05) 100%);border-radius:20px}.current-image[_ngcontent-%COMP%]{position:relative;display:flex;flex-direction:column;align-items:center;gap:1rem}.profile-preview[_ngcontent-%COMP%]{width:150px;height:150px;border-radius:50%;border:4px solid var(--primary-color);object-fit:cover;box-shadow:0 8px 24px #2e8b5733;transition:all .3s ease}.profile-preview[_ngcontent-%COMP%]:hover{transform:scale(1.05);box-shadow:0 12px 32px #2e8b574d}.btn-icon-camera[_ngcontent-%COMP%]{position:absolute;bottom:0;right:0;background:var(--primary-color);color:#fff;border:none;border-radius:50%;width:40px;height:40px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .3s ease;box-shadow:0 4px 12px #2e8b574d}.btn-icon-camera[_ngcontent-%COMP%]:hover{background-color:var(--accent-color);transform:scale(1.1)}.btn-icon-camera[_ngcontent-%COMP%]:disabled{background-color:#95a5a6;cursor:not-allowed;transform:none}.error-message[_ngcontent-%COMP%]{color:var(--danger-color);font-size:.85rem;margin-top:.5rem;display:none;animation:_ngcontent-%COMP%_fadeInError .3s ease-in-out}.error-message.show[_ngcontent-%COMP%]{display:block}@keyframes _ngcontent-%COMP%_fadeInError{0%{opacity:0;transform:translateY(-5px)}to{opacity:1;transform:translateY(0)}}.form-group[_ngcontent-%COMP%]   input.error[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   textarea.error[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   select.error[_ngcontent-%COMP%]{border-color:var(--danger-color);box-shadow:0 0 0 3px #e74c3c1a;animation:_ngcontent-%COMP%_shake .5s ease-in-out}@keyframes _ngcontent-%COMP%_shake{0%,to{transform:translate(0)}10%,30%,50%,70%,90%{transform:translate(-5px)}20%,40%,60%,80%{transform:translate(5px)}}.password-requirements[_ngcontent-%COMP%]{background-color:var(--light-green);border-radius:12px;padding:1rem;margin-top:.5rem;font-size:.9rem;border:1px solid rgba(46,139,87,.1);transition:all .3s ease}.password-requirements[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:.5rem;color:var(--primary-color);font-weight:600;display:flex;align-items:center;gap:8px}.password-requirements[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin:0;padding-left:0;list-style:none}.password-requirements[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:.5rem;color:var(--text-color);display:flex;align-items:center;gap:8px;padding:6px 10px;border-radius:8px;transition:all .3s ease;background-color:#ffffff80}.password-requirements[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:last-child{margin-bottom:0}.password-requirements[_ngcontent-%COMP%]   li.valid[_ngcontent-%COMP%]{color:var(--success-color);background-color:#2e8b571a;font-weight:600}.password-requirements[_ngcontent-%COMP%]   li.valid[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--success-color);animation:_ngcontent-%COMP%_checkmark .3s ease-in-out}@keyframes _ngcontent-%COMP%_checkmark{0%{transform:scale(0);opacity:0}50%{transform:scale(1.2)}to{transform:scale(1);opacity:1}}.password-input-container[_ngcontent-%COMP%]{position:relative}.password-toggle[_ngcontent-%COMP%]{position:absolute;right:12px;top:50%;transform:translateY(-50%);background:none;border:none;color:#7f8c8d;cursor:pointer;padding:8px;border-radius:6px;transition:all .3s ease}.password-toggle[_ngcontent-%COMP%]:hover{color:var(--primary-color);background-color:var(--light-green)}.password-toggle[_ngcontent-%COMP%]:active{transform:translateY(-50%) scale(.95)}.danger-zone[_ngcontent-%COMP%]{border:2px solid var(--danger-color);border-radius:12px;padding:1.5rem;margin-top:2rem;background-color:#e74c3c05;transition:all .3s ease}.danger-zone[_ngcontent-%COMP%]:hover{background-color:#e74c3c0d;box-shadow:0 4px 12px #e74c3c1a}.danger-zone[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:var(--danger-color);margin-bottom:1rem;font-size:1.3rem;display:flex;align-items:center;gap:10px}.danger-zone[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:1rem;color:var(--text-color);line-height:1.6}.danger-zone[_ngcontent-%COMP%]   .btn-danger[_ngcontent-%COMP%]{transition:all .3s ease}.danger-zone[_ngcontent-%COMP%]   .btn-danger[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 6px 16px #e74c3c4d}.dashboard-content[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .5s ease-in-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.tabs[_ngcontent-%COMP%]{margin-bottom:2.5rem}.tab-link[_ngcontent-%COMP%]{position:relative;padding:1.2rem 2rem;font-size:1.05rem;display:flex;align-items:center;gap:8px}.tab-link[_ngcontent-%COMP%]:hover{color:var(--primary-color);background-color:var(--light-green)}.loading-spinner[_ngcontent-%COMP%]{display:inline-block;width:16px;height:16px;border:2px solid #ffffff;border-radius:50%;border-top-color:transparent;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-right:8px}.loading-spinner-large[_ngcontent-%COMP%]{display:inline-block;width:48px;height:48px;border:4px solid var(--light-green);border-radius:50%;border-top-color:var(--primary-color);animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed;transform:none!important}.btn[_ngcontent-%COMP%]:disabled:hover{transform:none!important}@media (max-width: 768px){.form-grid[_ngcontent-%COMP%]{grid-template-columns:1fr!important}.profile-preview[_ngcontent-%COMP%]{width:120px;height:120px}.btn-icon-camera[_ngcontent-%COMP%]{width:36px;height:36px}.tabs[_ngcontent-%COMP%]{flex-direction:column}.tab-link[_ngcontent-%COMP%]{width:100%;justify-content:center}.danger-zone[_ngcontent-%COMP%]{padding:1rem}}input[_ngcontent-%COMP%]:focus-visible, button[_ngcontent-%COMP%]:focus-visible, a[_ngcontent-%COMP%]:focus-visible{outline:3px solid var(--primary-color);outline-offset:2px}*[_ngcontent-%COMP%]{transition-timing-function:cubic-bezier(.4,0,.2,1)}.loading-container[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulse 1.5s ease-in-out infinite}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1}50%{opacity:.7}}"]})};var yg=ep(_g());var SR=()=>["/chat"],DR=t=>({destinatarioId:t}),IR=t=>["/alojamiento",t],MR=(t,n)=>n.id;function Wse(t,n){t&1&&($(0,"div",4),be(1,"div",5),$(2,"p",6),ne(3," Cargando reservas... "),W()())}function Zse(t,n){if(t&1&&($(0,"span",9),ne(1),W()),t&2){let i=Ne(2);ie(),nn(" ",i.reservasActivas.length," ")}}function Xse(t,n){t&1&&($(0,"span",22),be(1,"i",28),ne(2," Pendiente "),W())}function Yse(t,n){t&1&&($(0,"span",23),be(1,"i",29),ne(2," Confirmada "),W())}function Kse(t,n){if(t&1){let i=Hn();$(0,"div",12),be(1,"img",13),$(2,"div",14)(3,"h4"),ne(4),W(),$(5,"p"),be(6,"i",15),$(7,"strong"),ne(8,"Anfitri\xF3n:"),W(),$(9,"a",16),ne(10),be(11,"i",17),W()(),$(12,"p"),be(13,"i",18),ne(14),W(),$(15,"p"),be(16,"i",19),ne(17),W(),$(18,"p"),be(19,"i",20),ne(20),W()(),$(21,"div",21),tt(22,Xse,3,0,"span",22),tt(23,Yse,3,0,"span",23),$(24,"a",24),be(25,"i",25),ne(26," Ver Alojamiento "),W(),$(27,"button",26),Ot("click",function(){let h=Wt(i).$implicit,o=Ne(4);return Zt(o.cancelarReserva(h.id,h.alojamiento.titulo))}),be(28,"i",27),ne(29," Cancelar Reserva "),W()()()}if(t&2){let i=n.$implicit,l=Ne(4);ie(),zt("src",i.alojamiento.imagenes[0],zr)("alt",i.alojamiento.titulo),ie(3),Ln(i.alojamiento.titulo),ie(5),zt("title",Tu("Enviar mensaje a ",i.alojamiento.nombreAnfitrion))("routerLink",ms(16,SR))("queryParams",ao(17,DR,i.alojamiento.anfitrionId)),ie(),nn(" ",i.alojamiento.nombreAnfitrion," "),ie(4),ps(" ",l.formatearFecha(i.fechaEntrada)," - ",l.formatearFecha(i.fechaSalida)," "),ie(3),ps(" ",l.calcularNoches(i.fechaEntrada,i.fechaSalida)," noche",l.calcularNoches(i.fechaEntrada,i.fechaSalida)>1?"s":""," "),ie(3),nn(" ",l.alojamientoService.formatearPrecio(i.precio)," "),ie(2),nt(i.estado==="PENDIENTE"?22:-1),ie(),nt(i.estado==="CONFIRMADA"?23:-1),ie(),zt("routerLink",ao(19,IR,i.alojamiento.id))}}function Jse(t,n){if(t&1&&Ri(0,Kse,30,21,"div",12,MR),t&2){let i=Ne(3);ki(i.reservasActivas)}}function Qse(t,n){t&1&&($(0,"div",11),be(1,"i",30),$(2,"h3"),ne(3,"No tienes reservas activas"),W(),$(4,"p"),ne(5,"Cuando realices una reserva, aparecer\xE1 aqu\xED"),W(),$(6,"a",31),be(7,"i",32),ne(8," Buscar Alojamientos "),W()())}function eae(t,n){if(t&1&&($(0,"div",10),tt(1,Jse,2,0)(2,Qse,9,0,"div",11),W()),t&2){let i=Ne(2);ie(),nt(i.reservasActivas.length>0?1:2)}}function tae(t,n){if(t&1){let i=Hn();$(0,"div",12),be(1,"img",13),$(2,"div",14)(3,"h4"),ne(4),W(),$(5,"p"),be(6,"i",15),$(7,"strong"),ne(8,"Anfitri\xF3n:"),W(),$(9,"a",16),ne(10),be(11,"i",17),W()(),$(12,"p"),be(13,"i",18),ne(14),W(),$(15,"p"),be(16,"i",19),ne(17),W(),$(18,"p"),be(19,"i",20),ne(20),W()(),$(21,"div",21)(22,"span",33),be(23,"i",34),ne(24," Completada "),W(),$(25,"a",24),be(26,"i",25),ne(27," Ver Alojamiento "),W(),$(28,"button",35),Ot("click",function(){let h=Wt(i).$implicit,o=Ne(4);return Zt(o.dejarResena(h.alojamiento.id,h.alojamiento.titulo))}),be(29,"i",36),ne(30," Dejar Rese\xF1a "),W()()()}if(t&2){let i=n.$implicit,l=Ne(4);ie(),zt("src",i.alojamiento.imagenes[0],zr)("alt",i.alojamiento.titulo),ie(3),Ln(i.alojamiento.titulo),ie(5),zt("title",Tu("Enviar mensaje a ",i.alojamiento.nombreAnfitrion))("routerLink",ms(14,SR))("queryParams",ao(15,DR,i.alojamiento.anfitrionId)),ie(),nn(" ",i.alojamiento.nombreAnfitrion," "),ie(4),ps(" ",l.formatearFecha(i.fechaEntrada)," - ",l.formatearFecha(i.fechaSalida)," "),ie(3),ps(" ",l.calcularNoches(i.fechaEntrada,i.fechaSalida)," noche",l.calcularNoches(i.fechaEntrada,i.fechaSalida)>1?"s":""," "),ie(3),nn(" ",l.alojamientoService.formatearPrecio(i.precio)," "),ie(5),zt("routerLink",ao(17,IR,i.alojamiento.id))}}function nae(t,n){if(t&1&&Ri(0,tae,31,19,"div",12,MR),t&2){let i=Ne(3);ki(i.reservasPasadas)}}function iae(t,n){t&1&&($(0,"div",11),be(1,"i",37),$(2,"h3"),ne(3,"No tienes reservas pasadas"),W(),$(4,"p"),ne(5,"Tus reservas completadas aparecer\xE1n aqu\xED"),W()())}function rae(t,n){if(t&1&&($(0,"div",10),tt(1,nae,2,0)(2,iae,6,0,"div",11),W()),t&2){let i=Ne(2);ie(),nt(i.reservasPasadas.length>0?1:2)}}function oae(t,n){if(t&1&&($(0,"div",38),be(1,"img",13),$(2,"div",14)(3,"h4"),ne(4),W(),$(5,"p"),be(6,"i",15),$(7,"strong"),ne(8,"Anfitri\xF3n:"),W(),$(9,"a",16),ne(10),be(11,"i",17),W()(),$(12,"p"),be(13,"i",18),ne(14),W(),$(15,"p"),be(16,"i",19),ne(17),W(),$(18,"p"),be(19,"i",20),ne(20),W()(),$(21,"div",21)(22,"span",39),be(23,"i",40),ne(24," Cancelada "),W(),$(25,"a",24),be(26,"i",25),ne(27," Ver Alojamiento "),W()()()),t&2){let i=n.$implicit,l=Ne(4);ie(),zt("src",i.alojamiento.imagenes[0],zr)("alt",i.alojamiento.titulo),ie(3),Ln(i.alojamiento.titulo),ie(5),zt("title",Tu("Enviar mensaje a ",i.alojamiento.nombreAnfitrion))("routerLink",ms(14,SR))("queryParams",ao(15,DR,i.alojamiento.anfitrionId)),ie(),nn(" ",i.alojamiento.nombreAnfitrion," "),ie(4),ps(" ",l.formatearFecha(i.fechaEntrada)," - ",l.formatearFecha(i.fechaSalida)," "),ie(3),ps(" ",l.calcularNoches(i.fechaEntrada,i.fechaSalida)," noche",l.calcularNoches(i.fechaEntrada,i.fechaSalida)>1?"s":""," "),ie(3),nn(" ",l.alojamientoService.formatearPrecio(i.precio)," "),ie(5),zt("routerLink",ao(17,IR,i.alojamiento.id))}}function sae(t,n){if(t&1&&Ri(0,oae,28,19,"div",38,MR),t&2){let i=Ne(3);ki(i.reservasCanceladas)}}function aae(t,n){t&1&&($(0,"div",11),be(1,"i",41),$(2,"h3"),ne(3,"No tienes reservas canceladas"),W(),$(4,"p"),ne(5,"Aqu\xED aparecer\xE1n las reservas que canceles"),W()())}function lae(t,n){if(t&1&&($(0,"div",10),tt(1,sae,2,0)(2,aae,6,0,"div",11),W()),t&2){let i=Ne(2);ie(),nt(i.reservasCanceladas.length>0?1:2)}}function cae(t,n){if(t&1){let i=Hn();$(0,"div",7)(1,"button",8),Ot("click",function(){Wt(i);let h=Ne();return Zt(h.cambiarTab("activas"))}),ne(2," Activas "),tt(3,Zse,2,1,"span",9),W(),$(4,"button",8),Ot("click",function(){Wt(i);let h=Ne();return Zt(h.cambiarTab("pasadas"))}),ne(5," Pasadas "),W(),$(6,"button",8),Ot("click",function(){Wt(i);let h=Ne();return Zt(h.cambiarTab("canceladas"))}),ne(7," Canceladas "),W()(),tt(8,eae,3,1,"div",10),tt(9,rae,3,1,"div",10),tt(10,lae,3,1,"div",10)}if(t&2){let i=Ne();ie(),Dn("active",i.tabActiva==="activas"),ie(2),nt(i.reservasActivas.length>0?3:-1),ie(),Dn("active",i.tabActiva==="pasadas"),ie(2),Dn("active",i.tabActiva==="canceladas"),ie(2),nt(i.tabActiva==="activas"?8:-1),ie(),nt(i.tabActiva==="pasadas"?9:-1),ie(),nt(i.tabActiva==="canceladas"?10:-1)}}var YS=class t{constructor(n,i,l,h,o){this.usuarioService=n;this.reservaService=i;this.tokenService=l;this.alojamientoService=h;this.mensajeHandlerService=o}tabActiva="activas";reservasActivas=[];reservasPasadas=[];reservasCanceladas=[];cargando=!1;destroy$=new Fn;ngOnInit(){this.cargarReservas()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}cargarReservas(){let n=this.tokenService.getUserId();if(!n){this.mensajeHandlerService.showError("No se pudo identificar al usuario");return}this.cargando=!0,this.usuarioService.obtenerReservasUsuario(n).pipe(tn(this.destroy$),Si(()=>this.cargando=!1)).subscribe({next:i=>{let l=i.data;this.clasificarReservas(l)},error:i=>{let l=this.mensajeHandlerService.handleHttpError(i);this.mensajeHandlerService.showError(l)}})}clasificarReservas(n){let i=new Date;i.setHours(0,0,0,0),this.reservasActivas=n.filter(l=>(l.estado==="PENDIENTE"||l.estado==="CONFIRMADA")&&new Date(l.fechaSalida)>=i).sort((l,h)=>new Date(l.fechaEntrada).getTime()-new Date(h.fechaEntrada).getTime()),this.reservasPasadas=n.filter(l=>l.estado==="COMPLETADA"||l.estado==="CONFIRMADA"&&new Date(l.fechaSalida)<i).sort((l,h)=>new Date(h.fechaEntrada).getTime()-new Date(l.fechaEntrada).getTime()),this.reservasCanceladas=n.filter(l=>l.estado==="CANCELADA").sort((l,h)=>new Date(h.fechaEntrada).getTime()-new Date(l.fechaEntrada).getTime())}cancelarReserva(n,i){this.mensajeHandlerService.confirmDanger(`\xBFEst\xE1s seguro de cancelar tu reserva en "${i}"?`,"S\xED, cancelar","\xBFCancelar reserva?").then(l=>{l&&this.procesarCancelacion(n)})}procesarCancelacion(n){this.mensajeHandlerService.showLoading("Procesando..."),this.reservaService.cancelar(n).pipe(tn(this.destroy$)).subscribe({next:()=>{this.mensajeHandlerService.showSuccess("Tu reserva ha sido cancelada exitosamente","Reserva cancelada"),this.cargarReservas()},error:i=>{this.mensajeHandlerService.closeModal();let l=this.mensajeHandlerService.handleHttpError(i);this.mensajeHandlerService.showError(l)}})}dejarResena(n,i){yg.default.fire({title:"Deja tu rese\xF1a",html:`
        <div style="text-align: left;">
          <p style="color: var(--text-color); margin-bottom: 1rem;">
            <strong>${i}</strong>
          </p>

          <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--dark-green);">
            Calificaci\xF3n *
          </label>
          <div id="rating-stars" style="display: flex; gap: 8px; margin-bottom: 1rem; justify-content: center;">
            <i class="fa-solid fa-star" data-rating="1" style="font-size: 2rem; color: #ddd; cursor: pointer;"></i>
            <i class="fa-solid fa-star" data-rating="2" style="font-size: 2rem; color: #ddd; cursor: pointer;"></i>
            <i class="fa-solid fa-star" data-rating="3" style="font-size: 2rem; color: #ddd; cursor: pointer;"></i>
            <i class="fa-solid fa-star" data-rating="4" style="font-size: 2rem; color: #ddd; cursor: pointer;"></i>
            <i class="fa-solid fa-star" data-rating="5" style="font-size: 2rem; color: #ddd; cursor: pointer;"></i>
          </div>

          <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--dark-green);">
            Comentario *
          </label>
          <textarea
            id="review-comment"
            placeholder="Cu\xE9ntanos sobre tu experiencia..."
            style="width: 100%; min-height: 120px; padding: 12px; border: 2px solid var(--border-color); border-radius: 12px;); resize: vertical;"
            maxlength="500"></textarea>
          <p style="text-align: right; font-size: 0.85rem; color: #7F8C8D; margin-top: 0.5rem;">
            <span id="char-count">0</span>/500
          </p>
        </div>
      `,showCancelButton:!0,confirmButtonText:"Publicar Rese\xF1a",cancelButtonText:"Cancelar",confirmButtonColor:"#2e8b57",cancelButtonColor:"#95a5a6",width:"600px",didOpen:()=>{let l=0,h=document.querySelectorAll("#rating-stars i");h.forEach(A=>{A.addEventListener("click",L=>{let Y=L.target;l=parseInt(Y.getAttribute("data-rating")||"0"),h.forEach((le,te)=>{te<l?le.style.color="#F39C12":le.style.color="#ddd"})}),A.addEventListener("mouseenter",L=>{let Y=L.target,le=parseInt(Y.getAttribute("data-rating")||"0");h.forEach((te,ze)=>{ze<le?te.style.color="#F39C12":te.style.color="#ddd"})})}),document.getElementById("rating-stars")?.addEventListener("mouseleave",()=>{h.forEach((A,L)=>{L<l?A.style.color="#F39C12":A.style.color="#ddd"})});let o=document.getElementById("review-comment"),E=document.getElementById("char-count");o?.addEventListener("input",()=>{E&&(E.textContent=o.value.length.toString())}),yg.default.getPopup().selectedRating=()=>l},preConfirm:()=>{let l=document.getElementById("review-comment").value,h=yg.default.getPopup().selectedRating();return!h||h===0?(yg.default.showValidationMessage("Por favor selecciona una calificaci\xF3n"),!1):!l||l.trim().length<10?(yg.default.showValidationMessage("El comentario debe tener al menos 10 caracteres"),!1):l.length>500?(yg.default.showValidationMessage("El comentario no puede exceder 500 caracteres"),!1):{rating:h,comment:l.trim()}}}).then(l=>{l.isConfirmed&&l.value&&this.procesarResena(n,l.value.rating,l.value.comment)})}procesarResena(n,i,l){this.mensajeHandlerService.showLoading("Procesando...");let h={calificacion:i,comentario:l};this.alojamientoService.crearResena(n,h).pipe(tn(this.destroy$)).subscribe({next:()=>{this.mensajeHandlerService.showSuccess("Tu rese\xF1a ha sido publicada exitosamente","\xA1Rese\xF1a publicada!")},error:o=>{this.mensajeHandlerService.closeModal();let E=this.mensajeHandlerService.handleHttpError(o);this.mensajeHandlerService.showError(E)}})}cambiarTab(n){this.tabActiva=n}formatearFecha(n){let i=typeof n=="string"?new Date(n):n;return new Date(i.getTime()+i.getTimezoneOffset()*6e4).toLocaleDateString("es-CO",{day:"2-digit",month:"short",year:"numeric"})}calcularNoches(n,i){let l=typeof n=="string"?new Date(n):n,o=(typeof i=="string"?new Date(i):i).getTime()-l.getTime();return Math.ceil(o/(1e3*60*60*24))}static \u0275fac=function(i){return new(i||t)(wt(Os),wt(Fp),wt(Ar),wt(As),wt(rs))};static \u0275cmp=Ai({type:t,selectors:[["app-mis-reservas"]],decls:9,vars:2,consts:[[1,"container","dashboard-container"],[1,"dashboard-layout"],[1,"dashboard-content"],[1,"content-header"],[1,"loading-container",2,"text-align","center","padding","4rem 2rem"],[1,"loading-spinner-large"],[2,"color","var(--text-color)","font-size","1.1rem","margin-top","1rem"],[1,"tabs"],[1,"tab-link",3,"click"],[1,"tab-badge",2,"background-color","var(--success-color)"],[1,"tab-content","active"],[1,"empty-state"],[1,"reservation-card"],[3,"src","alt"],[1,"reservation-details"],[1,"fa-solid","fa-user"],[1,"enlace-mensaje-huesped",3,"routerLink","queryParams","title"],[1,"fa-solid","fa-comment"],[1,"fa-solid","fa-calendar"],[1,"fa-solid","fa-moon"],[1,"fa-solid","fa-dollar-sign"],[1,"reservation-actions"],[1,"status",2,"background-color","#F39C12","color","white"],[1,"status","confirmed"],[1,"btn","btn-secondary","btn-small",3,"routerLink"],[1,"fa-solid","fa-eye"],["type","button",1,"btn","btn-danger","btn-small",3,"click"],[1,"fa-solid","fa-times"],[1,"fa-solid","fa-clock"],[1,"fa-solid","fa-check-circle"],[1,"fa-solid","fa-calendar-xmark"],["routerLink","/",1,"btn","btn-primary"],[1,"fa-solid","fa-search"],[1,"status","completed"],[1,"fa-solid","fa-flag-checkered"],["type","button",1,"btn","btn-primary","btn-small",3,"click"],[1,"fa-solid","fa-star"],[1,"fa-solid","fa-clock-rotate-left"],[1,"reservation-card",2,"opacity","0.8"],[1,"status","cancelled"],[1,"fa-solid","fa-ban"],[1,"fa-solid","fa-circle-check"]],template:function(i,l){i&1&&($(0,"main",0)(1,"div",1),be(2,"app-panel-usuario"),$(3,"section",2)(4,"div",3)(5,"h1"),ne(6,"Mis Reservas"),W()(),tt(7,Wse,4,0,"div",4),tt(8,cae,11,10),W()()()),i&2&&(ie(7),nt(l.cargando?7:-1),ie(),nt(l.cargando?-1:8))},dependencies:[Mr,zc,ns],styles:[".tabs[_ngcontent-%COMP%]{margin-bottom:2rem;display:flex;gap:1rem;border-bottom:2px solid var(--light-green)}.tab-link[_ngcontent-%COMP%]{padding:12px 20px;font-size:1rem;font-weight:600;color:var(--text-color);background-color:transparent;border:none;border-bottom:3px solid transparent;cursor:pointer;transition:all .3s ease;margin-right:10px;display:flex;align-items:center;gap:8px}.tab-link[_ngcontent-%COMP%]:hover{color:var(--primary-color);background-color:var(--light-green);border-radius:8px 8px 0 0}.tab-link.active[_ngcontent-%COMP%]{color:var(--primary-color);border-bottom-color:var(--primary-color)}.tab-badge[_ngcontent-%COMP%]{background-color:var(--primary-color);color:#fff;padding:2px 8px;border-radius:10px;font-size:.8rem;font-weight:700}.reservation-card[_ngcontent-%COMP%]{display:flex;gap:2rem;background-color:var(--white-color);border:1px solid rgba(46,139,87,.1);border-radius:20px;padding:2rem;margin-bottom:2rem;align-items:center;box-shadow:var(--card-shadow);transition:all .3s ease}.reservation-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 8px 32px #2e8b5726}.reservation-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:200px;height:140px;object-fit:cover;border-radius:16px;flex-shrink:0}.reservation-details[_ngcontent-%COMP%]{flex:1}.reservation-details[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:1.3rem;margin-bottom:.8rem;color:var(--dark-green);font-weight:600;line-height:1.4}.reservation-details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-color);margin-bottom:.5rem;display:flex;align-items:center;font-size:.95rem}.reservation-details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:10px;color:var(--primary-color);width:18px;font-size:1rem}.reservation-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-end;justify-content:space-between;gap:12px;min-width:180px}.btn-small[_ngcontent-%COMP%]{padding:10px 16px;font-size:.9rem;white-space:nowrap;width:100%;justify-content:center}.status[_ngcontent-%COMP%]{font-weight:600;padding:8px 16px;border-radius:20px;font-size:.85rem;text-align:center;letter-spacing:.5px;display:inline-flex;align-items:center;gap:6px;width:100%;justify-content:center}.status.confirmed[_ngcontent-%COMP%]{background-color:var(--success-color);color:#fff}.status.completed[_ngcontent-%COMP%]{background-color:var(--light-gray-color);color:#5d6d7e}.status.cancelled[_ngcontent-%COMP%]{background-color:var(--danger-color);color:#fff}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:4rem 2rem;background-color:var(--light-green);border-radius:20px;animation:_ngcontent-%COMP%_fadeIn .5s ease-in-out}.empty-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:4rem;color:var(--primary-color);margin-bottom:1.5rem;opacity:.6}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.8rem;color:var(--dark-green);margin-bottom:1rem;font-weight:600}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.1rem;color:#7f8c8d;margin-bottom:2rem}.loading-container[_ngcontent-%COMP%]{text-align:center;padding:4rem 2rem}.loading-spinner-large[_ngcontent-%COMP%]{display:inline-block;width:48px;height:48px;border:4px solid var(--light-green);border-radius:50%;border-top-color:var(--primary-color);animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:1.5rem}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-color);font-size:1.1rem}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.tab-content[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .4s ease-in-out}@media (max-width: 1024px){.reservation-card[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.reservation-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:200px}.reservation-actions[_ngcontent-%COMP%]{width:100%;flex-direction:row;justify-content:space-between;flex-wrap:wrap}.btn-small[_ngcontent-%COMP%]{flex:1;min-width:140px}.status[_ngcontent-%COMP%]{width:auto}}@media (max-width: 768px){.tabs[_ngcontent-%COMP%]{flex-direction:column;border-bottom:none}.tab-link[_ngcontent-%COMP%]{width:100%;border-bottom:2px solid var(--light-green);border-radius:8px;justify-content:center}.tab-link.active[_ngcontent-%COMP%]{background-color:var(--primary-color);color:#fff;border-bottom-color:var(--primary-color)}.reservation-actions[_ngcontent-%COMP%]{flex-direction:column}.btn-small[_ngcontent-%COMP%]{width:100%}}.btn[_ngcontent-%COMP%]:focus-visible, .tab-link[_ngcontent-%COMP%]:focus-visible{outline:3px solid var(--primary-color);outline-offset:2px}"]})};var PR=()=>["/chat"],OR=t=>({destinatarioId:t}),RR=(t,n)=>n.id;function uae(t,n){t&1&&($(0,"div",4),be(1,"div",5),$(2,"p",6),ne(3," Cargando reservas... "),W()())}function dae(t,n){if(t&1&&($(0,"span",17),ne(1),W()),t&2){let i=Ne(2);ie(),Ln(i.reservasPendientes.length)}}function hae(t,n){if(t&1){let i=Hn();$(0,"div",20),be(1,"img",21),$(2,"div",22)(3,"h4"),ne(4),W(),$(5,"p"),be(6,"i",23),$(7,"strong"),ne(8,"Hu\xE9sped:"),W(),$(9,"a",24),ne(10),be(11,"i",25),W()(),$(12,"p"),be(13,"i",26),$(14,"strong"),ne(15),W()(),$(16,"p"),be(17,"i",27),$(18,"strong"),ne(19,"Hu\xE9spedes:"),W(),ne(20),W(),$(21,"p"),be(22,"i",28),$(23,"strong"),ne(24,"Precio:"),W(),ne(25),W()(),$(26,"div",29)(27,"button",30),Ot("click",function(){let h=Wt(i).$implicit,o=Ne(4);return Zt(o.aprobarReserva(h.id,h.alojamiento.titulo))}),be(28,"i",31),ne(29," Aprobar "),W(),$(30,"button",32),Ot("click",function(){let h=Wt(i).$implicit,o=Ne(4);return Zt(o.rechazarReserva(h.id,h.alojamiento.titulo))}),be(31,"i",33),ne(32," Rechazar "),W()()()}if(t&2){let i=n.$implicit,l=Ne(4);ie(),zt("src",i.alojamiento.imagenes[0],zr)("alt",i.alojamiento.titulo),ie(3),Ln(i.alojamiento.titulo),ie(5),zt("title",Tu("Enviar mensaje a ",i.huesped.nombre))("routerLink",ms(12,PR))("queryParams",ao(13,OR,i.huesped.id)),ie(),nn(" ",i.huesped.nombre," "),ie(5),ps("",l.formatearFechaCorta(i.fechaEntrada)," - ",l.formatearFechaCorta(i.fechaSalida)),ie(5),nn(" ",i.cantidadHuespedes," "),ie(5),nn(" ",l.alojamientoService.formatearPrecio(i.precio)," ")}}function fae(t,n){if(t&1&&Ri(0,hae,33,15,"div",20,RR),t&2){let i=Ne(3);ki(i.reservasPendientes)}}function pae(t,n){t&1&&($(0,"div",19),be(1,"i",34),$(2,"p"),ne(3,"No hay reservas pendientes"),W()())}function mae(t,n){if(t&1&&($(0,"h3"),ne(1,"Reservas Pendientes"),W(),tt(2,fae,2,0)(3,pae,4,0,"div",19)),t&2){let i=Ne(2);ie(2),nt(i.reservasPendientes.length>0?2:3)}}function gae(t,n){if(t&1&&($(0,"div",20),be(1,"img",21),$(2,"div",22)(3,"h4"),ne(4),W(),$(5,"p"),be(6,"i",23),$(7,"strong"),ne(8,"Hu\xE9sped:"),W(),$(9,"a",24),ne(10),be(11,"i",25),W()(),$(12,"p"),be(13,"i",26),$(14,"strong"),ne(15),W()(),$(16,"p"),be(17,"i",27),$(18,"strong"),ne(19,"Hu\xE9spedes:"),W(),ne(20),W(),$(21,"p"),be(22,"i",28),$(23,"strong"),ne(24,"Precio:"),W(),ne(25),W()(),$(26,"div",29)(27,"span",35),be(28,"i",36),ne(29," Confirmada "),W()()()),t&2){let i=n.$implicit,l=Ne(4);ie(),zt("src",i.alojamiento.imagenes[0],zr)("alt",i.alojamiento.titulo),ie(3),Ln(i.alojamiento.titulo),ie(5),zt("title",Tu("Enviar mensaje a ",i.huesped.nombre))("routerLink",ms(12,PR))("queryParams",ao(13,OR,i.huesped.id)),ie(),nn(" ",i.huesped.nombre," "),ie(5),ps(" ",l.formatearFechaCorta(i.fechaEntrada)," - ",l.formatearFechaCorta(i.fechaSalida)),ie(5),nn(" ",i.cantidadHuespedes," "),ie(5),nn(" ",l.alojamientoService.formatearPrecio(i.precio)," ")}}function _ae(t,n){if(t&1&&Ri(0,gae,30,15,"div",20,RR),t&2){let i=Ne(3);ki(i.reservasConfirmadas)}}function vae(t,n){t&1&&($(0,"div",19),be(1,"i",37),$(2,"p"),ne(3,"No hay reservas confirmadas"),W()())}function yae(t,n){if(t&1&&($(0,"h3"),ne(1,"Reservas Confirmadas"),W(),tt(2,_ae,2,0)(3,vae,4,0,"div",19)),t&2){let i=Ne(2);ie(2),nt(i.reservasConfirmadas.length>0?2:3)}}function xae(t,n){t&1&&($(0,"span",38),be(1,"i",40),ne(2," Completada "),W())}function bae(t,n){t&1&&($(0,"span",39),be(1,"i",41),ne(2," Cancelada "),W())}function wae(t,n){t&1&&($(0,"span",38),be(1,"i",40),ne(2," Completada "),W())}function Cae(t,n){if(t&1&&($(0,"div",20),be(1,"img",21),$(2,"div",22)(3,"h4"),ne(4),W(),$(5,"p"),be(6,"i",23),$(7,"strong"),ne(8,"Hu\xE9sped:"),W(),$(9,"a",24),ne(10),be(11,"i",25),W()(),$(12,"p"),be(13,"i",26),$(14,"strong"),ne(15),W()(),$(16,"p"),be(17,"i",27),$(18,"strong"),ne(19,"Hu\xE9spedes:"),W(),ne(20),W(),$(21,"p"),be(22,"i",28),$(23,"strong"),ne(24,"Precio:"),W(),ne(25),W()(),$(26,"div",29),tt(27,xae,3,0,"span",38),tt(28,bae,3,0,"span",39),tt(29,wae,3,0,"span",38),W()()),t&2){let i=n.$implicit,l=Ne(4);ie(),zt("src",i.alojamiento.imagenes[0],zr)("alt",i.alojamiento.titulo),ie(3),Ln(i.alojamiento.titulo),ie(5),zt("title",Tu("Enviar mensaje a ",i.huesped.nombre))("routerLink",ms(15,PR))("queryParams",ao(16,OR,i.huesped.id)),ie(),nn(" ",i.huesped.nombre," "),ie(5),ps(" ",l.formatearFechaCorta(i.fechaEntrada)," - ",l.formatearFechaCorta(i.fechaSalida)),ie(5),nn(" ",i.cantidadHuespedes," "),ie(5),nn(" ",l.alojamientoService.formatearPrecio(i.precio)," "),ie(2),nt(i.estado==="COMPLETADA"?27:-1),ie(),nt(i.estado==="CANCELADA"?28:-1),ie(),nt(i.estado==="CONFIRMADA"?29:-1)}}function Eae(t,n){if(t&1&&Ri(0,Cae,30,18,"div",20,RR),t&2){let i=Ne(3);ki(i.reservasHistorial)}}function Tae(t,n){t&1&&($(0,"div",19),be(1,"i",42),$(2,"p"),ne(3,"No hay historial de reservas"),W()())}function Sae(t,n){if(t&1&&($(0,"h3"),ne(1,"Historial de Reservas"),W(),tt(2,Eae,2,0)(3,Tae,4,0,"div",19)),t&2){let i=Ne(2);ie(2),nt(i.reservasHistorial.length>0?2:3)}}function Dae(t,n){if(t&1){let i=Hn();$(0,"div",7)(1,"div",8)(2,"button",9),Ot("click",function(){Wt(i);let h=Ne();return Zt(h.mesAnterior())}),be(3,"i",10),W(),$(4,"button",9),Ot("click",function(){Wt(i);let h=Ne();return Zt(h.hoy())}),ne(5," Hoy "),W(),$(6,"button",9),Ot("click",function(){Wt(i);let h=Ne();return Zt(h.mesSiguiente())}),be(7,"i",11),W()(),$(8,"div",12)(9,"h2"),ne(10),gs(11,"date"),gs(12,"titlecase"),W()()(),$(13,"div",13),be(14,"mwl-calendar-month-view",14),W(),$(15,"div",15)(16,"button",16),Ot("click",function(){Wt(i);let h=Ne();return Zt(h.cambiarTab("pendientes"))}),ne(17," Pendientes "),tt(18,dae,2,1,"span",17),W(),$(19,"button",16),Ot("click",function(){Wt(i);let h=Ne();return Zt(h.cambiarTab("confirmadas"))}),ne(20," Confirmadas "),W(),$(21,"button",16),Ot("click",function(){Wt(i);let h=Ne();return Zt(h.cambiarTab("historial"))}),ne(22," Historial "),W()(),$(23,"div",18),tt(24,mae,4,1),tt(25,yae,4,1),tt(26,Sae,4,1),W()}if(t&2){let i=Ne();ie(10),Ln(R0(12,18,kl(11,15,i.viewDate,"MMMM yyyy"))),ie(4),zt("viewDate",i.viewDate)("events",i.events)("locale",i.locale)("weekStartsOn",1),ie(2),Dn("active",i.tabActiva==="pendientes"),ie(2),nt(i.reservasPendientes.length>0?18:-1),ie(),Dn("active",i.tabActiva==="confirmadas"),ie(2),Dn("active",i.tabActiva==="historial"),ie(3),nt(i.tabActiva==="pendientes"?24:-1),ie(),nt(i.tabActiva==="confirmadas"?25:-1),ie(),nt(i.tabActiva==="historial"?26:-1)}}var AR={confirmada:{primary:"#2e8b57",secondary:"#d9f0e3"},pendiente:{primary:"#f39c12",secondary:"#fdf3e1"},completada:{primary:"#888880",secondary:"#d5c9b3"}},KS=class t{constructor(n,i,l,h,o){this.alojamientoService=n;this.reservaService=i;this.tokenService=l;this.mensajeHandlerService=h;this.usuarioService=o}tabActiva="pendientes";reservasPendientes=[];reservasConfirmadas=[];reservasHistorial=[];viewDate=new Date;events=[];locale="es";todasLasReservas=[];cargando=!1;destroy$=new Fn;ngOnInit(){this.cargarDatos()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}cargarDatos(){let n=this.tokenService.getUserId();if(!n){this.mensajeHandlerService.showError("No se pudo identificar al usuario");return}this.cargando=!0,this.usuarioService.obtenerAlojamientosUsuario(n,0).pipe(tn(this.destroy$)).subscribe({next:i=>{if(i.error||!i.data||i.data.length===0){this.cargando=!1;return}let h=i.data.map(o=>this.alojamientoService.obtenerReservasAlojamiento(o.id).pipe(dl(E=>(console.error(`Error cargando reservas para ${o.id}:`,E),Jn({error:!0,data:null})))));yd(h).pipe(tn(this.destroy$)).subscribe({next:o=>{let E=[];o.forEach(A=>{A&&!A.error&&A.data&&E.push(...A.data)}),this.todasLasReservas=E,this.clasificarReservas(this.todasLasReservas),this.actualizarEventosCalendario(),this.cargando=!1},error:o=>{let E=this.mensajeHandlerService.handleHttpError(o);this.mensajeHandlerService.showError(E),this.cargando=!1}})},error:i=>{let l=this.mensajeHandlerService.handleHttpError(i);this.mensajeHandlerService.showError(l),this.cargando=!1}})}actualizarEventosCalendario(){let n=this.todasLasReservas.filter(i=>i.estado==="PENDIENTE"||i.estado==="CONFIRMADA"||i.estado==="COMPLETADA");this.events=n.map(i=>{let l=AR.confirmada,h="cal-event-confirmed";return i.estado==="PENDIENTE"?(l=AR.pendiente,h="cal-event-pending"):i.estado==="COMPLETADA"&&(l=AR.completada,h="cal-event-completed"),{title:i.alojamiento.titulo,start:Nc(this.toLocalDate(i.fechaEntrada)),end:uv(this.toLocalDate(i.fechaSalida)),color:Jt({},l),cssClass:h,meta:{id:i.id}}})}toLocalDate(n){let i=typeof n=="string"?new Date(n):n;return new Date(i.getTime()+i.getTimezoneOffset()*6e4)}clasificarReservas(n){let i=new Date;i.setHours(0,0,0,0),this.reservasPendientes=n.filter(l=>l.estado==="PENDIENTE").sort((l,h)=>new Date(l.fechaEntrada).getTime()-new Date(h.fechaEntrada).getTime()),this.reservasConfirmadas=n.filter(l=>l.estado==="CONFIRMADA"&&new Date(l.fechaSalida)>=i).sort((l,h)=>new Date(l.fechaEntrada).getTime()-new Date(h.fechaEntrada).getTime()),this.reservasHistorial=n.filter(l=>l.estado==="COMPLETADA"||l.estado==="CANCELADA"||l.estado==="CONFIRMADA"&&new Date(l.fechaSalida)<i).sort((l,h)=>new Date(h.fechaEntrada).getTime()-new Date(l.fechaEntrada).getTime())}aprobarReserva(n,i){this.mensajeHandlerService.confirm(`Confirmar\xE1s la reserva para "${i}"`,"S\xED, aprobar","\xBFAprobar reserva?").then(l=>{l&&this.procesarAprobacion(n)})}procesarAprobacion(n){this.mensajeHandlerService.showLoading("Procesando..."),this.reservaService.aceptar(n).pipe(tn(this.destroy$)).subscribe({next:()=>{this.mensajeHandlerService.showSuccess("","\xA1Reserva aprobada!"),this.cargarDatos()},error:i=>{this.mensajeHandlerService.closeModal();let l=this.mensajeHandlerService.handleHttpError(i);this.mensajeHandlerService.showError(l)}})}rechazarReserva(n,i){this.mensajeHandlerService.confirmDanger(`Esta acci\xF3n no se puede deshacer para "${i}"`,"S\xED, rechazar","\xBFRechazar reserva?").then(l=>{l&&this.procesarRechazo(n)})}procesarRechazo(n){this.mensajeHandlerService.showLoading("Procesando..."),this.reservaService.rechazar(n).pipe(tn(this.destroy$)).subscribe({next:()=>{this.mensajeHandlerService.showError("","Reserva rechazada"),this.cargarDatos()},error:i=>{this.mensajeHandlerService.closeModal();let l=this.mensajeHandlerService.handleHttpError(i);this.mensajeHandlerService.showError(l)}})}mesAnterior(){this.viewDate=dv(this.viewDate,1)}mesSiguiente(){this.viewDate=Rp(this.viewDate,1)}hoy(){this.viewDate=new Date}cambiarTab(n){this.tabActiva=n}formatearFechaCorta(n){let i=typeof n=="string"?new Date(n):n;return new Date(i.getTime()+i.getTimezoneOffset()*6e4).toLocaleDateString("es-CO",{day:"2-digit",month:"short"})}static \u0275fac=function(i){return new(i||t)(wt(As),wt(Fp),wt(Ar),wt(rs),wt(Os))};static \u0275cmp=Ai({type:t,selectors:[["app-gestionar-reservas"]],decls:9,vars:2,consts:[[1,"container","dashboard-container"],[1,"dashboard-layout"],[1,"dashboard-content"],[1,"content-header"],[1,"loading-container",2,"text-align","center","padding","4rem 2rem"],[1,"loading-spinner-large"],[2,"color","var(--text-color)","font-size","1.1rem","margin-top","1rem"],[1,"calendar-header-new"],[1,"header-left"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"fa-solid","fa-chevron-left"],[1,"fa-solid","fa-chevron-right"],[1,"header-title"],[1,"calendar-container-lib"],[3,"viewDate","events","locale","weekStartsOn"],[1,"tabs"],[1,"tab-link",3,"click"],[1,"tab-badge","pending"],[1,"reservations-list"],[1,"empty-state-small"],[1,"reservation-card-compact"],[1,"reservation-image",3,"src","alt"],[1,"reservation-info"],[1,"fa-solid","fa-user"],[1,"enlace-mensaje-huesped",3,"routerLink","queryParams","title"],[1,"fa-solid","fa-comment"],[1,"fa-solid","fa-calendar"],[1,"fa-solid","fa-users"],[1,"fa-solid","fa-dollar-sign"],[1,"reservation-actions-compact"],["type","button",1,"btn","btn-primary","btn-small",3,"click"],[1,"fa-solid","fa-check"],["type","button",1,"btn","btn-danger","btn-small",3,"click"],[1,"fa-solid","fa-times"],[1,"fa-solid","fa-clipboard-check"],[1,"status","confirmed"],[1,"fa-solid","fa-check-circle"],[1,"fa-solid","fa-calendar-check"],[1,"status","completed"],[1,"status","cancelled"],[1,"fa-solid","fa-flag-checkered"],[1,"fa-solid","fa-ban"],[1,"fa-solid","fa-history"]],template:function(i,l){i&1&&($(0,"main",0)(1,"div",1),be(2,"app-panel-usuario"),$(3,"section",2)(4,"div",3)(5,"h1"),ne(6,"Gesti\xF3n de Reservas"),W()(),tt(7,uae,4,0,"div",4),tt(8,Dae,27,20),W()()()),i&2&&(ie(7),nt(l.cargando?7:-1),ie(),nt(l.cargando?-1:8))},dependencies:[Mr,zc,Q0,yS,ns,xb,bb],styles:[".tabs[_ngcontent-%COMP%]{margin-bottom:2rem}.tab-link[_ngcontent-%COMP%]{padding:12px 20px;font-size:1rem;font-weight:600;color:var(--text-color);background-color:transparent;border:none;border-bottom:3px solid transparent;cursor:pointer;transition:all .3s ease;margin-right:10px}.tab-link[_ngcontent-%COMP%]:hover{color:var(--primary-color)}.tab-link.active[_ngcontent-%COMP%]{color:var(--primary-color);border-bottom-color:var(--primary-color)}.tab-badge[_ngcontent-%COMP%]{color:#fff;padding:2px 8px;border-radius:10px;font-size:.8rem;margin-left:6px;font-weight:700}.tab-badge.pending[_ngcontent-%COMP%]{background:#f39c12}.reservations-list[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.6rem;color:var(--dark-green);margin-bottom:1.5rem;font-weight:600;padding-bottom:1rem;border-bottom:2px solid var(--light-green)}.reservation-card-compact[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1.5rem;background-color:#fff;border:1px solid rgba(46,139,87,.1);border-radius:16px;padding:1.2rem;margin-bottom:1rem;box-shadow:var(--card-shadow);transition:all .3s ease}.reservation-card-compact[_ngcontent-%COMP%]:hover{transform:translate(4px);box-shadow:0 8px 24px #2e8b5726}.reservation-image[_ngcontent-%COMP%]{width:120px;height:90px;object-fit:cover;border-radius:12px;flex-shrink:0}.reservation-info[_ngcontent-%COMP%]{flex:1}.reservation-info[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:1.1rem;color:var(--dark-green);margin-bottom:.5rem;font-weight:600}.reservation-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.9rem;color:var(--text-color);margin:.3rem 0;display:flex;align-items:center;gap:8px}.reservation-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--primary-color);width:16px}.reservation-actions-compact[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;align-items:flex-end}.btn-small[_ngcontent-%COMP%]{padding:8px 16px;font-size:.9rem;min-width:120px}.status[_ngcontent-%COMP%]{font-weight:600;padding:8px 16px;border-radius:20px;font-size:.85rem;text-align:center;letter-spacing:.5px;display:inline-flex;align-items:center;gap:6px}.status.confirmed[_ngcontent-%COMP%]{background-color:var(--success-color);color:#fff}.status.completed[_ngcontent-%COMP%]{background-color:var(--light-gray-color);color:#5d6d7e}.status.cancelled[_ngcontent-%COMP%]{background-color:var(--danger-color);color:#fff}.empty-state-small[_ngcontent-%COMP%]{text-align:center;padding:2rem;background-color:var(--light-green);border-radius:16px;color:#7f8c8d}.empty-state-small[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:2.5rem;color:var(--primary-color);margin-bottom:1rem;opacity:.6}.empty-state-small[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1rem;margin:0}.loading-spinner-large[_ngcontent-%COMP%]{display:inline-block;width:48px;height:48px;border:4px solid var(--light-green);border-radius:50%;border-top-color:var(--primary-color);animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}@media (max-width: 768px){.reservation-card-compact[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.reservation-image[_ngcontent-%COMP%]{width:100%;height:150px}.reservation-actions-compact[_ngcontent-%COMP%]{width:100%;flex-direction:row;justify-content:space-between}.btn-small[_ngcontent-%COMP%]{flex:1}}"]})};var JS=ep(_g());var Iae=t=>["/alojamiento",t],Mae=()=>[1,2,3,4,5],Aae=(t,n)=>n.id;function Pae(t,n){t&1&&($(0,"div",4),be(1,"div",5),$(2,"p",6),ne(3," Cargando datos... "),W()())}function Oae(t,n){if(t&1&&($(0,"span",11),ne(1),W()),t&2){let i=Ne(2);ie(),nn(" ",i.resenasRecientes.length," ")}}function Rae(t,n){if(t&1&&($(0,"div",12)(1,"div",13)(2,"h2"),ne(3,"Resumen General"),W(),$(4,"div",14)(5,"div",15)(6,"div",16),be(7,"i",17),W(),$(8,"div",18)(9,"h4"),ne(10,"Alojamientos"),W(),$(11,"p"),ne(12),W()()(),$(13,"div",15)(14,"div",19),be(15,"i",20),W(),$(16,"div",18)(17,"h4"),ne(18,"Reservas Totales"),W(),$(19,"p"),ne(20),W()()(),$(21,"div",15)(22,"div",21),be(23,"i",22),W(),$(24,"div",18)(25,"h4"),ne(26,"Rese\xF1as Totales"),W(),$(27,"p"),ne(28),W()()(),$(29,"div",15)(30,"div",23),be(31,"i",24),W(),$(32,"div",18)(33,"h4"),ne(34,"Calificaci\xF3n Promedio"),W(),$(35,"p"),ne(36),W()()()()()()),t&2){let i=Ne(2);ie(12),Ln(i.metricasGlobales.totalAlojamientos),ie(8),Ln(i.metricasGlobales.totalReservas),ie(8),Ln(i.metricasGlobales.totalResenas),ie(8),Ln(i.metricasGlobales.promedioGeneral.toFixed(2))}}function kae(t,n){t&1&&($(0,"div",25),be(1,"div",5),$(2,"p",28),ne(3,"Cargando rese\xF1as..."),W()())}function Fae(t,n){if(t&1&&be(0,"i",41),t&2){let i=n.$implicit,l=Ne().$implicit;ub("color",i<=l.calificacion?"#F39C12":"#ddd")}}function Lae(t,n){if(t&1){let i=Hn();$(0,"div",29)(1,"div",30)(2,"h4"),ne(3),W(),$(4,"a",31),be(5,"i",32),ne(6," Ver alojamiento "),W()(),$(7,"div",33),be(8,"img",34),$(9,"div")(10,"strong"),ne(11),W(),$(12,"span"),ne(13),W()()(),$(14,"div",35),Ri(15,Fae,1,2,"i",36,ra),W(),$(17,"p",37),ne(18),W(),$(19,"div",38)(20,"button",39),Ot("click",function(){let h=Wt(i).$implicit,o=Ne(4);return Zt(o.responderResena(h))}),be(21,"i",40),ne(22," Responder "),W()()()}if(t&2){let i=n.$implicit,l=Ne(4);ie(3),Ln(i.alojamientoTitulo),ie(),zt("routerLink",ao(7,Iae,i.alojamientoId)),ie(4),zt("src",i.usuario.foto||"https://placehold.co/40x40/3f51b5/fff?text="+i.usuario.nombre.charAt(0),zr)("alt","Avatar de "+i.usuario.nombre),ie(3),Ln(i.usuario.nombre),ie(2),Ln(l.formatearFecha(i.creadoEn)),ie(2),ki(ms(9,Mae)),ie(3),Ln(i.comentario)}}function Nae(t,n){if(t&1&&($(0,"div",26),Ri(1,Lae,23,10,"div",29,Aae),W()),t&2){let i=Ne(3);ie(),ki(i.resenasRecientes)}}function zae(t,n){t&1&&($(0,"div",27),be(1,"i",42),$(2,"p"),ne(3,"\xA1Genial! No tienes rese\xF1as pendientes de responder"),W()())}function Bae(t,n){if(t&1&&($(0,"div",12)(1,"div",13)(2,"h2"),ne(3,"Rese\xF1as Sin Responder"),W(),tt(4,kae,4,0,"div",25),tt(5,Nae,3,0,"div",26),tt(6,zae,4,0,"div",27),W()()),t&2){let i=Ne(2);ie(4),nt(i.cargandoResenas?4:-1),ie(),nt(!i.cargandoResenas&&i.resenasRecientes.length>0?5:-1),ie(),nt(!i.cargandoResenas&&i.resenasRecientes.length===0?6:-1)}}function jae(t,n){if(t&1){let i=Hn();$(0,"div",7)(1,"button",8),Ot("click",function(){Wt(i);let h=Ne();return Zt(h.cambiarTab("metricas"))}),be(2,"i",9),ne(3," M\xE9tricas "),W(),$(4,"button",8),Ot("click",function(){Wt(i);let h=Ne();return Zt(h.cambiarTab("resenas"))}),be(5,"i",10),ne(6," Rese\xF1as Pendientes "),tt(7,Oae,2,1,"span",11),W()(),tt(8,Rae,37,4,"div",12),tt(9,Bae,7,3,"div",12)}if(t&2){let i=Ne();ie(),Dn("active",i.tabActiva==="metricas"),ie(3),Dn("active",i.tabActiva==="resenas"),ie(3),nt(i.resenasRecientes.length>0?7:-1),ie(),nt(i.tabActiva==="metricas"?8:-1),ie(),nt(i.tabActiva==="resenas"?9:-1)}}var QS=class t{constructor(n,i,l,h){this.alojamientoService=n;this.usuarioService=i;this.mensajeHandlerService=l;this.tokenService=h}tabActiva="metricas";alojamientos=[];metricasPorAlojamiento=new Map;metricasGlobales={totalAlojamientos:0,totalReservas:0,totalResenas:0,promedioGeneral:0};resenasRecientes=[];cargando=!1;cargandoResenas=!1;destroy$=new Fn;ngOnInit(){this.cargarDatosIniciales()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}cargarDatosIniciales(){let n=this.tokenService.getUserId();if(!n){this.mensajeHandlerService.showError("No se pudo identificar al usuario");return}this.cargando=!0,this.usuarioService.obtenerAlojamientosUsuario(n,0).pipe(tn(this.destroy$),Si(()=>this.cargando=!1)).subscribe({next:i=>{!i.error&&i.data&&(this.alojamientos=i.data,this.metricasGlobales.totalAlojamientos=this.alojamientos.length,this.cargarTodasLasMetricas(),this.cargarResenasRecientes())},error:i=>{let l=this.mensajeHandlerService.handleHttpError(i);this.mensajeHandlerService.showError(l)}})}cargarTodasLasMetricas(){let n=this.alojamientos.map(i=>this.alojamientoService.obtenerMetricas(i.id));yd(n).pipe(tn(this.destroy$)).subscribe({next:i=>{i.forEach((l,h)=>{if(!l.error){let o=l.data;this.metricasPorAlojamiento.set(this.alojamientos[h].id,o)}}),this.calcularMetricasGlobales()},error:i=>{console.error("Error al cargar m\xE9tricas:",i)}})}calcularMetricasGlobales(){let n=0,i=0,l=0;this.metricasPorAlojamiento.forEach(h=>{n+=h.totalReservas,i+=h.totalResenas,l+=h.promedioCalificaciones*h.totalResenas}),this.metricasGlobales.totalReservas=n,this.metricasGlobales.totalResenas=i,this.metricasGlobales.promedioGeneral=i>0?l/i:0}cargarResenasRecientes(){this.cargandoResenas=!0;let n=this.alojamientos.map(i=>this.alojamientoService.obtenerResenasAlojamiento(i.id,0));yd(n).pipe(tn(this.destroy$),Si(()=>this.cargandoResenas=!1)).subscribe({next:i=>{let l=[];i.forEach((h,o)=>{if(!h.error&&h.data){let E=h.data,A=this.alojamientos[o],L=E.filter(Y=>!Y.respuesta).map(Y=>Mi(Jt({},Y),{alojamientoId:A.id,alojamientoTitulo:A.titulo}));l.push(...L)}}),this.resenasRecientes=l.sort((h,o)=>new Date(o.creadoEn).getTime()-new Date(h.creadoEn).getTime()).slice(0,10)},error:i=>{console.error("Error al cargar rese\xF1as:",i)}})}responderResena(n){JS.default.fire({title:"Responder Rese\xF1a",html:`
        <div style="text-align: left; margin-bottom: 1rem;">
          <p style="color: var(--text-color); margin-bottom: 0.5rem;">
            <strong>Alojamiento:</strong> ${n.alojamientoTitulo}
          </p>
          <p style="color: var(--text-color); margin-bottom: 0.5rem;">
            <strong>Hu\xE9sped:</strong> ${n.usuario.nombre}
          </p>
          <div style="margin: 0.5rem 0;">
            ${'<i class="fa-solid fa-star" style="color: #F39C12;"></i>'.repeat(n.calificacion)}
          </div>
          <p style="color: var(--text-color); padding: 1rem; background-color: var(--light-green); border-radius: 8px; font-style: italic;">
            "${n.comentario}"
          </p>
        </div>

        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--dark-green); text-align: left;">
          Tu Respuesta *
        </label>
        <textarea
          id="respuesta-mensaje"
          placeholder="Escribe tu respuesta al hu\xE9sped..."
          style="width: 100%; min-height: 120px; padding: 12px; border: 2px solid var(--border-color); border-radius: 12px; resize: vertical;"
          maxlength="500"></textarea>
        <p style="text-align: right; font-size: 0.85rem; color: #7F8C8D; margin-top: 0.5rem;">
          <span id="char-count">0</span>/500
        </p>
      `,showCancelButton:!0,confirmButtonText:"Publicar Respuesta",cancelButtonText:"Cancelar",confirmButtonColor:"#2e8b57",cancelButtonColor:"#95a5a6",width:"600px",didOpen:()=>{let i=document.getElementById("respuesta-mensaje"),l=document.getElementById("char-count");i?.addEventListener("input",()=>{l&&(l.textContent=i.value.length.toString())})},preConfirm:()=>{let i=document.getElementById("respuesta-mensaje").value;return!i||i.trim().length<10?(JS.default.showValidationMessage("La respuesta debe tener al menos 10 caracteres"),!1):i.length>500?(JS.default.showValidationMessage("La respuesta no puede exceder 500 caracteres"),!1):{mensaje:i.trim()}}}).then(i=>{i.isConfirmed&&i.value&&this.procesarRespuesta(n.alojamientoId,n.id,i.value.mensaje)})}procesarRespuesta(n,i,l){this.mensajeHandlerService.showLoading("Publicando respuesta...");let h={mensaje:l};this.alojamientoService.responderResena(n,i,h).pipe(tn(this.destroy$)).subscribe({next:()=>{this.mensajeHandlerService.showSuccess("Tu respuesta ha sido publicada exitosamente","\xA1Respuesta publicada!"),this.cargarResenasRecientes()},error:o=>{this.mensajeHandlerService.closeModal();let E=this.mensajeHandlerService.handleHttpError(o);this.mensajeHandlerService.showError(E)}})}cambiarTab(n){this.tabActiva=n}formatearFecha(n){let i=typeof n=="string"?new Date(n):n;return new Date(i.getTime()+i.getTimezoneOffset()*6e4).toLocaleDateString("es-CO",{day:"2-digit",month:"short",year:"numeric"})}static \u0275fac=function(i){return new(i||t)(wt(As),wt(Os),wt(rs),wt(Ar))};static \u0275cmp=Ai({type:t,selectors:[["app-dashboard-anfitrion"]],decls:9,vars:2,consts:[[1,"container","dashboard-container"],[1,"dashboard-layout"],[1,"dashboard-content"],[1,"content-header"],[1,"loading-container",2,"text-align","center","padding","4rem 2rem"],[1,"loading-spinner-large"],[2,"color","var(--text-color)","font-size","1.1rem","margin-top","1rem"],[1,"tabs"],[1,"tab-link",3,"click"],[1,"fa-solid","fa-chart-line"],[1,"fa-solid","fa-comment"],[1,"tab-badge",2,"background-color","#F39C12"],[1,"tab-content","active"],[1,"dashboard-section"],[1,"stats-grid"],[1,"stat-card"],[1,"stat-icon",2,"background-color","rgba(46, 139, 87, 0.1)"],[1,"fa-solid","fa-house",2,"color","var(--primary-color)"],[1,"stat-info"],[1,"stat-icon",2,"background-color","rgba(52, 152, 219, 0.1)"],[1,"fa-solid","fa-calendar-check",2,"color","#3498db"],[1,"stat-icon",2,"background-color","rgba(243, 156, 18, 0.1)"],[1,"fa-solid","fa-star",2,"color","#F39C12"],[1,"stat-icon",2,"background-color","rgba(46, 204, 113, 0.1)"],[1,"fa-solid","fa-chart-line",2,"color","#2ecc71"],[2,"text-align","center","padding","2rem"],[1,"resenas-pendientes-grid"],[1,"empty-state-small"],[2,"color","var(--text-color)","margin-top","1rem"],[1,"resena-pendiente-card"],[1,"resena-alojamiento-info"],[1,"btn-link",3,"routerLink"],[1,"fa-solid","fa-external-link-alt"],[1,"review-author"],[3,"src","alt"],[2,"margin","0.5rem 0"],[1,"fa-solid","fa-star",3,"color"],[1,"resena-comentario"],[2,"margin-top","1rem"],["type","button",1,"btn","btn-primary","btn-small",3,"click"],[1,"fa-solid","fa-reply"],[1,"fa-solid","fa-star"],[1,"fa-solid","fa-check-circle"]],template:function(i,l){i&1&&($(0,"main",0)(1,"div",1),be(2,"app-panel-usuario"),$(3,"section",2)(4,"div",3)(5,"h1"),ne(6,"Dashboard Anfitri\xF3n"),W()(),tt(7,Pae,4,0,"div",4),tt(8,jae,10,7),W()()()),i&2&&(ie(7),nt(l.cargando?7:-1),ie(),nt(l.cargando?-1:8))},dependencies:[Mr,zc,ns],styles:[".loading-spinner-large[_ngcontent-%COMP%]{display:inline-block;width:48px;height:48px;border:4px solid var(--light-green);border-radius:50%;border-top-color:var(--primary-color);animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.tabs[_ngcontent-%COMP%]{margin-bottom:2.5rem}.tab-link[_ngcontent-%COMP%]{padding:1.2rem 2rem;font-size:1.05rem;display:inline-flex;align-items:center;gap:8px}.tab-link[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.1rem}.tab-badge[_ngcontent-%COMP%]{background-color:var(--primary-color);color:#fff;padding:2px 8px;border-radius:10px;font-size:.8rem;font-weight:700}.dashboard-section[_ngcontent-%COMP%]{margin-bottom:3rem}.dashboard-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.8rem;color:var(--dark-green);margin-bottom:1.5rem;font-weight:600;padding-bottom:1rem;border-bottom:2px solid var(--light-green)}.stats-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:1.5rem;margin-bottom:2rem}.stat-card[_ngcontent-%COMP%]{background-color:var(--white-color);border:1px solid rgba(46,139,87,.1);border-radius:16px;padding:1.5rem;display:flex;align-items:center;gap:1.2rem;box-shadow:var(--card-shadow);transition:all .3s ease}.stat-card[_ngcontent-%COMP%]:hover{transform:translateY(-4px);box-shadow:0 8px 24px #2e8b5726}.stat-icon[_ngcontent-%COMP%]{font-size:2rem;width:56px;height:56px;border-radius:12px;display:flex;align-items:center;justify-content:center;flex-shrink:0}.stat-info[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:.85rem;color:#7f8c8d;margin-bottom:.3rem;font-weight:500;text-transform:uppercase;letter-spacing:.5px}.stat-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.8rem;font-weight:700;color:var(--dark-green);margin:0}.alojamientos-metricas-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:1.5rem}.alojamiento-metrica-card[_ngcontent-%COMP%]{background-color:var(--white-color);border:1px solid rgba(46,139,87,.1);border-radius:16px;padding:1.5rem;box-shadow:var(--card-shadow);transition:all .3s ease}.alojamiento-metrica-card[_ngcontent-%COMP%]:hover{transform:translateY(-4px);box-shadow:0 8px 24px #2e8b5726}.alojamiento-metrica-header[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-bottom:1.5rem;padding-bottom:1rem;border-bottom:2px solid var(--light-green)}.alojamiento-metrica-header[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:80px;height:80px;object-fit:cover;border-radius:12px;flex-shrink:0}.alojamiento-metrica-info[_ngcontent-%COMP%]{flex:1}.alojamiento-metrica-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.1rem;color:var(--dark-green);margin-bottom:.5rem;font-weight:600;line-height:1.3;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}.alojamiento-metrica-info[_ngcontent-%COMP%]   .location[_ngcontent-%COMP%]{font-size:.85rem;color:#7f8c8d;display:flex;align-items:center;gap:6px}.alojamiento-metrica-info[_ngcontent-%COMP%]   .location[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--primary-color)}.metricas-stats[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;margin-bottom:1.5rem}.metrica-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.8rem;padding:.8rem;background-color:var(--light-green);border-radius:10px;transition:all .3s ease}.metrica-item[_ngcontent-%COMP%]:hover{background-color:#2e8b5726}.metrica-item[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.3rem;color:var(--primary-color)}.metrica-item[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;flex-direction:column}.metrica-label[_ngcontent-%COMP%]{font-size:.75rem;color:#7f8c8d;font-weight:500;text-transform:uppercase;letter-spacing:.5px}.metrica-value[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:700;color:var(--dark-green)}.alojamiento-metrica-actions[_ngcontent-%COMP%]{display:flex;gap:.8rem}.btn-small[_ngcontent-%COMP%]{padding:8px 14px;font-size:.85rem;flex:1}.resenas-pendientes-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(340px,1fr));gap:1.5rem}.resena-pendiente-card[_ngcontent-%COMP%]{background-color:var(--white-color);border:1px solid rgba(46,139,87,.1);border-radius:16px;padding:1.5rem;box-shadow:var(--card-shadow);transition:all .3s ease}.resena-pendiente-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 8px 24px #2e8b5726}.resena-alojamiento-info[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;padding-bottom:1rem;border-bottom:2px solid var(--light-green)}.resena-alojamiento-info[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:1.05rem;color:var(--dark-green);font-weight:600;margin:0;flex:1}.btn-link[_ngcontent-%COMP%]{color:var(--primary-color);font-size:.85rem;text-decoration:none;display:flex;align-items:center;gap:4px;transition:all .3s ease}.btn-link[_ngcontent-%COMP%]:hover{color:var(--accent-color)}.review-author[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:1rem;gap:12px}.review-author[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:44px;height:44px;border-radius:50%;border:2px solid var(--primary-color)}.review-author[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block;color:var(--dark-green);font-weight:600;font-size:.95rem}.review-author[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.85rem;color:#7f8c8d}.resena-comentario[_ngcontent-%COMP%]{color:var(--text-color);line-height:1.6;font-size:.95rem;padding:1rem;background-color:var(--light-green);border-radius:10px;font-style:italic}.empty-state-small[_ngcontent-%COMP%]{text-align:center;padding:3rem 2rem;background-color:var(--light-green);border-radius:16px;color:#7f8c8d}.empty-state-small[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:3rem;color:var(--primary-color);margin-bottom:1rem;opacity:.6}.empty-state-small[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1rem;margin:0}@media (max-width: 1024px){.metricas-stats[_ngcontent-%COMP%], .alojamientos-metricas-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}@media (max-width: 768px){.stats-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.alojamiento-metrica-header[_ngcontent-%COMP%]{flex-direction:column}.alojamiento-metrica-header[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:150px}.alojamiento-metrica-actions[_ngcontent-%COMP%]{flex-direction:column}.resenas-pendientes-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.resena-alojamiento-info[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:.5rem}}.tab-content[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .4s ease-in-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}"]})};var eD=class t{constructor(n){this.http=n}API_URL=`${is.apiUrl}/chat`;mensajesEnMemoriaSubject=new Ho([]);mensajesEnMemoria$=this.mensajesEnMemoriaSubject.asObservable();chatActualIdSubject=new Ho(null);chatActualId$=this.chatActualIdSubject.asObservable();obtenerChat(n,i=0,l=20){let h=new Ms().set("pagina",i.toString()).set("tamano",l.toString());return this.http.get(`${this.API_URL}/${n}`,{params:h})}listarConversaciones(n){return this.http.get(`${this.API_URL}/usuario/${n}/conversaciones`)}obtenerMensajesNoLeidos(n){return this.http.get(`${this.API_URL}/usuario/${n}/mensajes-no-leidos`)}marcarChatComoLeido(n,i){let l=new Ms().set("usuarioId",i);return this.http.put(`${this.API_URL}/${n}/marcar-leido`,null,{params:l})}setChatActual(n){this.chatActualIdSubject.next(n),n===null&&this.limpiarMensajes()}getChatActual(){return this.chatActualIdSubject.value}agregarMensaje(n){let i=this.mensajesEnMemoriaSubject.value;if(!i.some(h=>h.id===n.id)){let h=[...i,n];this.mensajesEnMemoriaSubject.next(h)}}setMensajes(n){this.mensajesEnMemoriaSubject.next(n)}getMensajes(){return this.mensajesEnMemoriaSubject.value}limpiarMensajes(){this.mensajesEnMemoriaSubject.next([])}perteneceAlChatActual(n){return this.getChatActual()===n}resetearEstado(){this.limpiarMensajes(),this.setChatActual(null)}static \u0275fac=function(i){return new(i||t)(gn(aa))};static \u0275prov=Qt({token:t,factory:t.\u0275fac,providedIn:"root"})};function U6(t,n){t.terminate=function(){let i=()=>{};this.onerror=i,this.onmessage=i,this.onopen=i;let l=new Date,h=Math.random().toString().substring(2,8),o=this.onclose;this.onclose=E=>{let A=new Date().getTime()-l.getTime();n(`Discarded socket (#${h})  closed after ${A}ms, with code/reason: ${E.code}/${E.reason}`)},this.close(),o?.call(t,{code:4001,reason:`Quick discarding socket (#${h}) without waiting for the shutdown sequence.`,wasClean:!1})}}var xg={LF:`
`,NULL:"\0"};var h1=class t{get body(){return!this._body&&this.isBinaryBody&&(this._body=new TextDecoder().decode(this._binaryBody)),this._body||""}get binaryBody(){return!this._binaryBody&&!this.isBinaryBody&&(this._binaryBody=new TextEncoder().encode(this._body)),this._binaryBody}constructor(n){let{command:i,headers:l,body:h,binaryBody:o,escapeHeaderValues:E,skipContentLengthHeader:A}=n;this.command=i,this.headers=Object.assign({},l||{}),o?(this._binaryBody=o,this.isBinaryBody=!0):(this._body=h||"",this.isBinaryBody=!1),this.escapeHeaderValues=E||!1,this.skipContentLengthHeader=A||!1}static fromRawFrame(n,i){let l={},h=o=>o.replace(/^\s+|\s+$/g,"");for(let o of n.headers.reverse()){let E=o.indexOf(":"),A=h(o[0]),L=h(o[1]);i&&n.command!=="CONNECT"&&n.command!=="CONNECTED"&&(L=t.hdrValueUnEscape(L)),l[A]=L}return new t({command:n.command,headers:l,binaryBody:n.binaryBody,escapeHeaderValues:i})}toString(){return this.serializeCmdAndHeaders()}serialize(){let n=this.serializeCmdAndHeaders();return this.isBinaryBody?t.toUnit8Array(n,this._binaryBody).buffer:n+this._body+xg.NULL}serializeCmdAndHeaders(){let n=[this.command];this.skipContentLengthHeader&&delete this.headers["content-length"];for(let i of Object.keys(this.headers||{})){let l=this.headers[i];this.escapeHeaderValues&&this.command!=="CONNECT"&&this.command!=="CONNECTED"?n.push(`${i}:${t.hdrValueEscape(`${l}`)}`):n.push(`${i}:${l}`)}return(this.isBinaryBody||!this.isBodyEmpty()&&!this.skipContentLengthHeader)&&n.push(`content-length:${this.bodyLength()}`),n.join(xg.LF)+xg.LF+xg.LF}isBodyEmpty(){return this.bodyLength()===0}bodyLength(){let n=this.binaryBody;return n?n.length:0}static sizeOfUTF8(n){return n?new TextEncoder().encode(n).length:0}static toUnit8Array(n,i){let l=new TextEncoder().encode(n),h=new Uint8Array([0]),o=new Uint8Array(l.length+i.length+h.length);return o.set(l),o.set(i,l.length),o.set(h,l.length+i.length),o}static marshall(n){return new t(n).serialize()}static hdrValueEscape(n){return n.replace(/\\/g,"\\\\").replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/:/g,"\\c")}static hdrValueUnEscape(n){return n.replace(/\\r/g,"\r").replace(/\\n/g,`
`).replace(/\\c/g,":").replace(/\\\\/g,"\\")}};var tD=class{constructor(n,i){this.onFrame=n,this.onIncomingPing=i,this._encoder=new TextEncoder,this._decoder=new TextDecoder,this._token=[],this._initState()}parseChunk(n,i=!1){let l;if(typeof n=="string"?l=this._encoder.encode(n):l=new Uint8Array(n),i&&l[l.length-1]!==0){let h=new Uint8Array(l.length+1);h.set(l,0),h[l.length]=0,l=h}for(let h=0;h<l.length;h++){let o=l[h];this._onByte(o)}}_collectFrame(n){if(n!==0&&n!==13){if(n===10){this.onIncomingPing();return}this._onByte=this._collectCommand,this._reinjectByte(n)}}_collectCommand(n){if(n!==13){if(n===10){this._results.command=this._consumeTokenAsUTF8(),this._onByte=this._collectHeaders;return}this._consumeByte(n)}}_collectHeaders(n){if(n!==13){if(n===10){this._setupCollectBody();return}this._onByte=this._collectHeaderKey,this._reinjectByte(n)}}_reinjectByte(n){this._onByte(n)}_collectHeaderKey(n){if(n===58){this._headerKey=this._consumeTokenAsUTF8(),this._onByte=this._collectHeaderValue;return}this._consumeByte(n)}_collectHeaderValue(n){if(n!==13){if(n===10){this._results.headers.push([this._headerKey,this._consumeTokenAsUTF8()]),this._headerKey=void 0,this._onByte=this._collectHeaders;return}this._consumeByte(n)}}_setupCollectBody(){let n=this._results.headers.filter(i=>i[0]==="content-length")[0];n?(this._bodyBytesRemaining=parseInt(n[1],10),this._onByte=this._collectBodyFixedSize):this._onByte=this._collectBodyNullTerminated}_collectBodyNullTerminated(n){if(n===0){this._retrievedBody();return}this._consumeByte(n)}_collectBodyFixedSize(n){if(this._bodyBytesRemaining--===0){this._retrievedBody();return}this._consumeByte(n)}_retrievedBody(){this._results.binaryBody=this._consumeTokenAsRaw();try{this.onFrame(this._results)}catch(n){console.log("Ignoring an exception thrown by a frame handler. Original exception: ",n)}this._initState()}_consumeByte(n){this._token.push(n)}_consumeTokenAsUTF8(){return this._decoder.decode(this._consumeTokenAsRaw())}_consumeTokenAsRaw(){let n=new Uint8Array(this._token);return this._token=[],n}_initState(){this._results={command:void 0,headers:[],binaryBody:void 0},this._token=[],this._headerKey=void 0,this._onByte=this._collectFrame}};var Kh=(function(t){return t[t.CONNECTING=0]="CONNECTING",t[t.OPEN=1]="OPEN",t[t.CLOSING=2]="CLOSING",t[t.CLOSED=3]="CLOSED",t})(Kh||{}),ku=(function(t){return t[t.ACTIVE=0]="ACTIVE",t[t.DEACTIVATING=1]="DEACTIVATING",t[t.INACTIVE=2]="INACTIVE",t})(ku||{}),nD=(function(t){return t[t.LINEAR=0]="LINEAR",t[t.EXPONENTIAL=1]="EXPONENTIAL",t})(nD||{}),pv=(function(t){return t.Interval="interval",t.Worker="worker",t})(pv||{});var iD=class{constructor(n,i=pv.Interval,l){this._interval=n,this._strategy=i,this._debug=l,this._workerScript=`
    var startTime = Date.now();
    setInterval(function() {
        self.postMessage(Date.now() - startTime);
    }, ${this._interval});
  `}start(n){this.stop(),this.shouldUseWorker()?this.runWorker(n):this.runInterval(n)}stop(){this.disposeWorker(),this.disposeInterval()}shouldUseWorker(){return typeof Worker<"u"&&this._strategy===pv.Worker}runWorker(n){this._debug("Using runWorker for outgoing pings"),this._worker||(this._worker=new Worker(URL.createObjectURL(new Blob([this._workerScript],{type:"text/javascript"}))),this._worker.onmessage=i=>n(i.data))}runInterval(n){if(this._debug("Using runInterval for outgoing pings"),!this._timer){let i=Date.now();this._timer=setInterval(()=>{n(Date.now()-i)},this._interval)}}disposeWorker(){this._worker&&(this._worker.terminate(),delete this._worker,this._debug("Outgoing ping disposeWorker"))}disposeInterval(){this._timer&&(clearInterval(this._timer),delete this._timer,this._debug("Outgoing ping disposeInterval"))}};var Gs=class{constructor(n){this.versions=n}supportedVersions(){return this.versions.join(",")}protocolVersions(){return this.versions.map(n=>`v${n.replace(".","")}.stomp`)}};Gs.V1_0="1.0";Gs.V1_1="1.1";Gs.V1_2="1.2";Gs.default=new Gs([Gs.V1_2,Gs.V1_1,Gs.V1_0]);var rD=class{get connectedVersion(){return this._connectedVersion}get connected(){return this._connected}constructor(n,i,l){this._client=n,this._webSocket=i,this._connected=!1,this._serverFrameHandlers={CONNECTED:h=>{this.debug(`connected to server ${h.headers.server}`),this._connected=!0,this._connectedVersion=h.headers.version,this._connectedVersion===Gs.V1_2&&(this._escapeHeaderValues=!0),this._setupHeartbeat(h.headers),this.onConnect(h)},MESSAGE:h=>{let o=h.headers.subscription,E=this._subscriptions[o]||this.onUnhandledMessage,A=h,L=this,Y=this._connectedVersion===Gs.V1_2?A.headers.ack:A.headers["message-id"];A.ack=(le={})=>L.ack(Y,o,le),A.nack=(le={})=>L.nack(Y,o,le),E(A)},RECEIPT:h=>{let o=this._receiptWatchers[h.headers["receipt-id"]];o?(o(h),delete this._receiptWatchers[h.headers["receipt-id"]]):this.onUnhandledReceipt(h)},ERROR:h=>{this.onStompError(h)}},this._counter=0,this._subscriptions={},this._receiptWatchers={},this._partialData="",this._escapeHeaderValues=!1,this._lastServerActivityTS=Date.now(),this.debug=l.debug,this.stompVersions=l.stompVersions,this.connectHeaders=l.connectHeaders,this.disconnectHeaders=l.disconnectHeaders,this.heartbeatIncoming=l.heartbeatIncoming,this.heartbeatToleranceMultiplier=l.heartbeatGracePeriods,this.heartbeatOutgoing=l.heartbeatOutgoing,this.splitLargeFrames=l.splitLargeFrames,this.maxWebSocketChunkSize=l.maxWebSocketChunkSize,this.forceBinaryWSFrames=l.forceBinaryWSFrames,this.logRawCommunication=l.logRawCommunication,this.appendMissingNULLonIncoming=l.appendMissingNULLonIncoming,this.discardWebsocketOnCommFailure=l.discardWebsocketOnCommFailure,this.onConnect=l.onConnect,this.onDisconnect=l.onDisconnect,this.onStompError=l.onStompError,this.onWebSocketClose=l.onWebSocketClose,this.onWebSocketError=l.onWebSocketError,this.onUnhandledMessage=l.onUnhandledMessage,this.onUnhandledReceipt=l.onUnhandledReceipt,this.onUnhandledFrame=l.onUnhandledFrame,this.onHeartbeatReceived=l.onHeartbeatReceived,this.onHeartbeatLost=l.onHeartbeatLost}start(){let n=new tD(i=>{let l=h1.fromRawFrame(i,this._escapeHeaderValues);this.logRawCommunication||this.debug(`<<< ${l}`),(this._serverFrameHandlers[l.command]||this.onUnhandledFrame)(l)},()=>{this.debug("<<< PONG"),this.onHeartbeatReceived()});this._webSocket.onmessage=i=>{if(this.debug("Received data"),this._lastServerActivityTS=Date.now(),this.logRawCommunication){let l=i.data instanceof ArrayBuffer?new TextDecoder().decode(i.data):i.data;this.debug(`<<< ${l}`)}n.parseChunk(i.data,this.appendMissingNULLonIncoming)},this._webSocket.onclose=i=>{this.debug(`Connection closed to ${this._webSocket.url}`),this._cleanUp(),this.onWebSocketClose(i)},this._webSocket.onerror=i=>{this.onWebSocketError(i)},this._webSocket.onopen=()=>{let i=Object.assign({},this.connectHeaders);this.debug("Web Socket Opened..."),i["accept-version"]=this.stompVersions.supportedVersions(),i["heart-beat"]=[this.heartbeatOutgoing,this.heartbeatIncoming].join(","),this._transmit({command:"CONNECT",headers:i})}}_setupHeartbeat(n){if(n.version!==Gs.V1_1&&n.version!==Gs.V1_2||!n["heart-beat"])return;let[i,l]=n["heart-beat"].split(",").map(h=>parseInt(h,10));if(this.heartbeatOutgoing!==0&&l!==0){let h=Math.max(this.heartbeatOutgoing,l);this.debug(`send PING every ${h}ms`),this._pinger=new iD(h,this._client.heartbeatStrategy,this.debug),this._pinger.start(()=>{this._webSocket.readyState===Kh.OPEN&&(this._webSocket.send(xg.LF),this.debug(">>> PING"))})}if(this.heartbeatIncoming!==0&&i!==0){let h=Math.max(this.heartbeatIncoming,i);this.debug(`check PONG every ${h}ms`),this._ponger=setInterval(()=>{let o=Date.now()-this._lastServerActivityTS;o>h*this.heartbeatToleranceMultiplier&&(this.debug(`did not receive server activity for the last ${o}ms`),this.onHeartbeatLost(),this._closeOrDiscardWebsocket())},h)}}_closeOrDiscardWebsocket(){this.discardWebsocketOnCommFailure?(this.debug("Discarding websocket, the underlying socket may linger for a while"),this.discardWebsocket()):(this.debug("Issuing close on the websocket"),this._closeWebsocket())}forceDisconnect(){this._webSocket&&(this._webSocket.readyState===Kh.CONNECTING||this._webSocket.readyState===Kh.OPEN)&&this._closeOrDiscardWebsocket()}_closeWebsocket(){this._webSocket.onmessage=()=>{},this._webSocket.close()}discardWebsocket(){typeof this._webSocket.terminate!="function"&&U6(this._webSocket,n=>this.debug(n)),this._webSocket.terminate()}_transmit(n){let{command:i,headers:l,body:h,binaryBody:o,skipContentLengthHeader:E}=n,A=new h1({command:i,headers:l,body:h,binaryBody:o,escapeHeaderValues:this._escapeHeaderValues,skipContentLengthHeader:E}),L=A.serialize();if(this.logRawCommunication?this.debug(`>>> ${L}`):this.debug(`>>> ${A}`),this.forceBinaryWSFrames&&typeof L=="string"&&(L=new TextEncoder().encode(L)),typeof L!="string"||!this.splitLargeFrames)this._webSocket.send(L);else{let Y=L;for(;Y.length>0;){let le=Y.substring(0,this.maxWebSocketChunkSize);Y=Y.substring(this.maxWebSocketChunkSize),this._webSocket.send(le),this.debug(`chunk sent = ${le.length}, remaining = ${Y.length}`)}}}dispose(){if(this.connected)try{let n=Object.assign({},this.disconnectHeaders);n.receipt||(n.receipt=`close-${this._counter++}`),this.watchForReceipt(n.receipt,i=>{this._closeWebsocket(),this._cleanUp(),this.onDisconnect(i)}),this._transmit({command:"DISCONNECT",headers:n})}catch(n){this.debug(`Ignoring error during disconnect ${n}`)}else(this._webSocket.readyState===Kh.CONNECTING||this._webSocket.readyState===Kh.OPEN)&&this._closeWebsocket()}_cleanUp(){this._connected=!1,this._pinger&&(this._pinger.stop(),this._pinger=void 0),this._ponger&&(clearInterval(this._ponger),this._ponger=void 0)}publish(n){let{destination:i,headers:l,body:h,binaryBody:o,skipContentLengthHeader:E}=n,A=Object.assign({destination:i},l);this._transmit({command:"SEND",headers:A,body:h,binaryBody:o,skipContentLengthHeader:E})}watchForReceipt(n,i){this._receiptWatchers[n]=i}subscribe(n,i,l={}){l=Object.assign({},l),l.id||(l.id=`sub-${this._counter++}`),l.destination=n,this._subscriptions[l.id]=i,this._transmit({command:"SUBSCRIBE",headers:l});let h=this;return{id:l.id,unsubscribe(o){return h.unsubscribe(l.id,o)}}}unsubscribe(n,i={}){i=Object.assign({},i),delete this._subscriptions[n],i.id=n,this._transmit({command:"UNSUBSCRIBE",headers:i})}begin(n){let i=n||`tx-${this._counter++}`;this._transmit({command:"BEGIN",headers:{transaction:i}});let l=this;return{id:i,commit(){l.commit(i)},abort(){l.abort(i)}}}commit(n){this._transmit({command:"COMMIT",headers:{transaction:n}})}abort(n){this._transmit({command:"ABORT",headers:{transaction:n}})}ack(n,i,l={}){l=Object.assign({},l),this._connectedVersion===Gs.V1_2?l.id=n:l["message-id"]=n,l.subscription=i,this._transmit({command:"ACK",headers:l})}nack(n,i,l={}){return l=Object.assign({},l),this._connectedVersion===Gs.V1_2?l.id=n:l["message-id"]=n,l.subscription=i,this._transmit({command:"NACK",headers:l})}};var oD=class{get webSocket(){return this._stompHandler?._webSocket}get disconnectHeaders(){return this._disconnectHeaders}set disconnectHeaders(n){this._disconnectHeaders=n,this._stompHandler&&(this._stompHandler.disconnectHeaders=this._disconnectHeaders)}get connected(){return!!this._stompHandler&&this._stompHandler.connected}get connectedVersion(){return this._stompHandler?this._stompHandler.connectedVersion:void 0}get active(){return this.state===ku.ACTIVE}_changeState(n){this.state=n,this.onChangeState(n)}constructor(n={}){this.stompVersions=Gs.default,this.connectionTimeout=0,this.reconnectDelay=5e3,this._nextReconnectDelay=0,this.maxReconnectDelay=900*1e3,this.reconnectTimeMode=nD.LINEAR,this.heartbeatIncoming=1e4,this.heartbeatToleranceMultiplier=2,this.heartbeatOutgoing=1e4,this.heartbeatStrategy=pv.Interval,this.splitLargeFrames=!1,this.maxWebSocketChunkSize=8*1024,this.forceBinaryWSFrames=!1,this.appendMissingNULLonIncoming=!1,this.discardWebsocketOnCommFailure=!1,this.state=ku.INACTIVE;let i=()=>{};this.debug=i,this.beforeConnect=i,this.onConnect=i,this.onDisconnect=i,this.onUnhandledMessage=i,this.onUnhandledReceipt=i,this.onUnhandledFrame=i,this.onHeartbeatReceived=i,this.onHeartbeatLost=i,this.onStompError=i,this.onWebSocketClose=i,this.onWebSocketError=i,this.logRawCommunication=!1,this.onChangeState=i,this.connectHeaders={},this._disconnectHeaders={},this.configure(n)}configure(n){Object.assign(this,n),this.maxReconnectDelay>0&&this.maxReconnectDelay<this.reconnectDelay&&(this.debug(`Warning: maxReconnectDelay (${this.maxReconnectDelay}ms) is less than reconnectDelay (${this.reconnectDelay}ms). Using reconnectDelay as the maxReconnectDelay delay.`),this.maxReconnectDelay=this.reconnectDelay)}activate(){let n=()=>{if(this.active){this.debug("Already ACTIVE, ignoring request to activate");return}this._changeState(ku.ACTIVE),this._nextReconnectDelay=this.reconnectDelay,this._connect()};this.state===ku.DEACTIVATING?(this.debug("Waiting for deactivation to finish before activating"),this.deactivate().then(()=>{n()})):n()}_connect(){return Tc(this,null,function*(){if(yield this.beforeConnect(this),this._stompHandler){this.debug("There is already a stompHandler, skipping the call to connect");return}if(!this.active){this.debug("Client has been marked inactive, will not attempt to connect");return}this.connectionTimeout>0&&(this._connectionWatcher&&clearTimeout(this._connectionWatcher),this._connectionWatcher=setTimeout(()=>{this.connected||(this.debug(`Connection not established in ${this.connectionTimeout}ms, closing socket`),this.forceDisconnect())},this.connectionTimeout)),this.debug("Opening Web Socket...");let n=this._createWebSocket();this._stompHandler=new rD(this,n,{debug:this.debug,stompVersions:this.stompVersions,connectHeaders:this.connectHeaders,disconnectHeaders:this._disconnectHeaders,heartbeatIncoming:this.heartbeatIncoming,heartbeatGracePeriods:this.heartbeatToleranceMultiplier,heartbeatOutgoing:this.heartbeatOutgoing,heartbeatStrategy:this.heartbeatStrategy,splitLargeFrames:this.splitLargeFrames,maxWebSocketChunkSize:this.maxWebSocketChunkSize,forceBinaryWSFrames:this.forceBinaryWSFrames,logRawCommunication:this.logRawCommunication,appendMissingNULLonIncoming:this.appendMissingNULLonIncoming,discardWebsocketOnCommFailure:this.discardWebsocketOnCommFailure,onConnect:i=>{if(this._connectionWatcher&&(clearTimeout(this._connectionWatcher),this._connectionWatcher=void 0),this._nextReconnectDelay=this.reconnectDelay,!this.active){this.debug("STOMP got connected while deactivate was issued, will disconnect now"),this._disposeStompHandler();return}this.onConnect(i)},onDisconnect:i=>{this.onDisconnect(i)},onStompError:i=>{this.onStompError(i)},onWebSocketClose:i=>{this._stompHandler=void 0,this.state===ku.DEACTIVATING&&this._changeState(ku.INACTIVE),this.onWebSocketClose(i),this.active&&this._schedule_reconnect()},onWebSocketError:i=>{this.onWebSocketError(i)},onUnhandledMessage:i=>{this.onUnhandledMessage(i)},onUnhandledReceipt:i=>{this.onUnhandledReceipt(i)},onUnhandledFrame:i=>{this.onUnhandledFrame(i)},onHeartbeatReceived:()=>{this.onHeartbeatReceived()},onHeartbeatLost:()=>{this.onHeartbeatLost()}}),this._stompHandler.start()})}_createWebSocket(){let n;if(this.webSocketFactory)n=this.webSocketFactory();else if(this.brokerURL)n=new WebSocket(this.brokerURL,this.stompVersions.protocolVersions());else throw new Error("Either brokerURL or webSocketFactory must be provided");return n.binaryType="arraybuffer",n}_schedule_reconnect(){this._nextReconnectDelay>0&&(this.debug(`STOMP: scheduling reconnection in ${this._nextReconnectDelay}ms`),this._reconnector=setTimeout(()=>{this.reconnectTimeMode===nD.EXPONENTIAL&&(this._nextReconnectDelay=this._nextReconnectDelay*2,this.maxReconnectDelay!==0&&(this._nextReconnectDelay=Math.min(this._nextReconnectDelay,this.maxReconnectDelay))),this._connect()},this._nextReconnectDelay))}deactivate(){return Tc(this,arguments,function*(n={}){let i=n.force||!1,l=this.active,h;if(this.state===ku.INACTIVE)return this.debug("Already INACTIVE, nothing more to do"),Promise.resolve();if(this._changeState(ku.DEACTIVATING),this._nextReconnectDelay=0,this._reconnector&&(clearTimeout(this._reconnector),this._reconnector=void 0),this._stompHandler&&this.webSocket.readyState!==Kh.CLOSED){let o=this._stompHandler.onWebSocketClose;h=new Promise((E,A)=>{this._stompHandler.onWebSocketClose=L=>{o(L),E()}})}else return this._changeState(ku.INACTIVE),Promise.resolve();return i?this._stompHandler?.discardWebsocket():l&&this._disposeStompHandler(),h})}forceDisconnect(){this._stompHandler&&this._stompHandler.forceDisconnect()}_disposeStompHandler(){this._stompHandler&&this._stompHandler.dispose()}publish(n){this._checkConnection(),this._stompHandler.publish(n)}_checkConnection(){if(!this.connected)throw new TypeError("There is no underlying STOMP connection")}watchForReceipt(n,i){this._checkConnection(),this._stompHandler.watchForReceipt(n,i)}subscribe(n,i,l={}){return this._checkConnection(),this._stompHandler.subscribe(n,i,l)}unsubscribe(n,i={}){this._checkConnection(),this._stompHandler.unsubscribe(n,i)}begin(n){return this._checkConnection(),this._stompHandler.begin(n)}commit(n){this._checkConnection(),this._stompHandler.commit(n)}abort(n){this._checkConnection(),this._stompHandler.abort(n)}ack(n,i,l={}){this._checkConnection(),this._stompHandler.ack(n,i,l)}nack(n,i,l={}){this._checkConnection(),this._stompHandler.nack(n,i,l)}};var M$=ep(I$());var SD=class t{constructor(n){this.tokenService=n}stompClient;subscription;errorSubscription;estadoConexionSubject=new Ho(!1);estadoConexion$=this.estadoConexionSubject.asObservable();mensajesSubject=new tp(50);mensajesRecibidos$=this.mensajesSubject.asObservable();mensajesPendientes=[];reconectando=!1;intentosReconexion=0;timerReconexion;MAX_INTENTOS_RECONEXION=is.wsMaxReconnectAttempts;RECONNECT_DELAY=is.wsReconnectDelay;conectar(n=null){if(this.isConnected()){console.log("WebSocket ya conectado");return}let i=this.tokenService.getToken();if(!i){console.error("No hay token disponible para WebSocket");return}console.log("Iniciando conexi\xF3n WebSocket..."),this.stompClient=new oD({webSocketFactory:()=>new M$.default(`${is.wsUrl}?token=${i}`),connectHeaders:{Authorization:`Bearer ${i}`},debug:l=>{console.log("STOMP:",l)},reconnectDelay:this.RECONNECT_DELAY,heartbeatIncoming:4e3,heartbeatOutgoing:4e3}),this.stompClient.onConnect=()=>this.onConectado(n),this.stompClient.onStompError=l=>this.onError(l),this.stompClient.onWebSocketClose=()=>this.onDesconectado(),this.stompClient.activate()}onConectado(n){console.log("WebSocket conectado exitosamente"),this.estadoConexionSubject.next(!0),this.intentosReconexion=0,this.reconectando=!1,this.subscription=this.stompClient.subscribe("/user/queue/private",i=>this.procesarMensaje(i)),this.errorSubscription=this.stompClient.subscribe("/user/queue/errors",i=>{console.error("Error del servidor:",i.body)}),this.enviarNotificacionConexion(n),this.procesarMensajesPendientes()}procesarMensaje(n){try{let i=JSON.parse(n.body);console.log("Mensaje recibido:",i),this.mensajesSubject.next(i)}catch(i){console.error("Error al procesar mensaje:",i)}}onError(n){console.error("Error STOMP:",n),this.estadoConexionSubject.next(!1)}onDesconectado(){console.log("WebSocket desconectado"),this.estadoConexionSubject.next(!1),this.intentarReconexion()}intentarReconexion(n=null){if(this.reconectando||this.intentosReconexion>=this.MAX_INTENTOS_RECONEXION||!this.tokenService.isLogged()){this.intentosReconexion>=this.MAX_INTENTOS_RECONEXION&&console.error("M\xE1ximo de intentos de reconexi\xF3n alcanzado");return}this.reconectando=!0,this.intentosReconexion++;let i=Math.min(2e3*Math.pow(2,this.intentosReconexion-1),32e3);console.log(`Reintentando conexi\xF3n en ${i/1e3}s (intento ${this.intentosReconexion}/${this.MAX_INTENTOS_RECONEXION})...`),this.timerReconexion=setTimeout(()=>{this.conectar(n)},i)}enviarNotificacionConexion(n){if(this.stompClient?.connected)try{this.stompClient.publish({destination:"/app/chat.join",body:JSON.stringify({destinatarioId:n||""})}),console.log("Notificaci\xF3n de conexi\xF3n enviada")}catch(i){console.error("Error al enviar notificaci\xF3n de conexi\xF3n:",i)}}enviarMensaje(n){return new xi(i=>{if(!this.stompClient?.connected){console.warn("No conectado. Agregando mensaje a cola pendiente..."),this.mensajesPendientes.push(n),this.conectar(),i.next(!0),i.complete();return}try{this.stompClient.publish({destination:"/app/chat.sendMessage",body:JSON.stringify(n)}),console.log("Mensaje enviado:",n),i.next(!0),i.complete()}catch(l){console.error("Error al enviar mensaje:",l),this.mensajesPendientes.push(n),i.error(l),i.complete()}})}procesarMensajesPendientes(){if(this.mensajesPendientes.length!==0)for(console.log(`Enviando ${this.mensajesPendientes.length} mensajes pendientes...`);this.mensajesPendientes.length>0;){let n=this.mensajesPendientes.shift();this.enviarMensaje(n).subscribe({next:()=>console.log("Mensaje pendiente enviado"),error:i=>{console.error("Error enviando mensaje pendiente:",i),this.mensajesPendientes.unshift(n)}})}}isConnected(){return this.stompClient?.connected||!1}getMensajesPendientes(){return this.mensajesPendientes.length}limpiarMensajesPendientes(){this.mensajesPendientes=[]}desconectar(){if(this.stompClient){if(console.log("Desconectando WebSocket..."),this.timerReconexion&&(clearTimeout(this.timerReconexion),this.timerReconexion=void 0),this.subscription?.unsubscribe(),this.errorSubscription?.unsubscribe(),this.stompClient.connected)try{this.stompClient.publish({destination:"/app/chat.leave"})}catch(n){console.error("Error al notificar desconexi\xF3n:",n)}this.stompClient.deactivate(),this.estadoConexionSubject.next(!1),this.reconectando=!1,this.intentosReconexion=0}}resetear(){this.desconectar(),this.limpiarMensajesPendientes(),this.mensajesSubject=new tp(50)}ngOnDestroy(){this.desconectar()}static \u0275fac=function(i){return new(i||t)(gn(Ar))};static \u0275prov=Qt({token:t,factory:t.\u0275fac,providedIn:"root"})};var Wce=["messagesContainer"],A$=(t,n)=>n.id;function Zce(t,n){if(t&1&&($(0,"span",9),ne(1),W()),t&2){let i=Ne();ie(),Ln(i.mensajesNoLeidos)}}function Xce(t,n){t&1&&($(0,"div",11),be(1,"div",16),$(2,"p"),ne(3,"Cargando conversaciones..."),W()())}function Yce(t,n){if(t&1&&($(0,"span",22),ne(1),W()),t&2){let i=Ne().$implicit,l=Ne(2);ie(),nn(" ",l.formatearHora(i.ultimoMensaje.fechaEnvio)," ")}}function Kce(t,n){t&1&&be(0,"div",24)}function Jce(t,n){if(t&1){let i=Hn();$(0,"div",18),Ot("click",function(){let h=Wt(i).$implicit,o=Ne(2);return Zt(o.seleccionarChat(h))}),be(1,"img",19),$(2,"div",20)(3,"div",21)(4,"strong"),ne(5),W(),tt(6,Yce,2,1,"span",22),W(),$(7,"p",23),ne(8),W()(),tt(9,Kce,1,0,"div",24),W()}if(t&2){let i=n.$implicit,l=Ne(2);Dn("active",(l.chatActual==null?null:l.chatActual.id)===i.id),ie(),zt("src",l.obtenerOtroUsuario(i).foto||"https://placehold.co/50x50/2e8b57/fff?text="+l.obtenerIniciales(l.obtenerOtroUsuario(i).nombre),zr)("alt",l.obtenerOtroUsuario(i).nombre),ie(4),Ln(l.obtenerOtroUsuario(i).nombre),ie(),nt(i.ultimoMensaje?6:-1),ie(2),nn(" ",l.obtenerUltimoMensajePreview(i)," "),ie(),nt(i.ultimoMensaje&&!i.ultimoMensaje.leido&&i.ultimoMensaje.remitenteId!==l.usuarioActualId?9:-1)}}function Qce(t,n){if(t&1&&($(0,"div",12),Ri(1,Jce,10,8,"div",17,A$),W()),t&2){let i=Ne();ie(),ki(i.conversaciones)}}function eue(t,n){t&1&&($(0,"div",13),be(1,"i",25),$(2,"p"),ne(3,"No tienes conversaciones a\xFAn"),W()())}function tue(t,n){t&1&&($(0,"div",15),be(1,"i",26),$(2,"h3"),ne(3,"Selecciona una conversaci\xF3n"),W(),$(4,"p"),ne(5,"Elige un chat de la lista para comenzar a conversar"),W()())}function nue(t,n){t&1&&($(0,"div",11),be(1,"div",16),$(2,"p"),ne(3,"Cargando mensajes..."),W()())}function iue(t,n){t&1&&($(0,"div",32),be(1,"i",37),$(2,"p"),ne(3,"No hay mensajes a\xFAn"),W(),$(4,"p",38),ne(5,"Env\xEDa el primer mensaje para comenzar la conversaci\xF3n"),W()())}function rue(t,n){if(t&1&&($(0,"div",40)(1,"div",41)(2,"p",42),ne(3),W(),$(4,"span",43),ne(5),W()()()),t&2){let i=n.$implicit,l=Ne(3);Dn("own-message",l.esMensajePropio(i)),ie(3),Ln(i.contenido),ie(2),Ln(l.formatearHora(i.fechaEnvio))}}function oue(t,n){if(t&1&&Ri(0,rue,6,4,"div",39,A$),t&2){let i=Ne(2);ki(i.mensajes)}}function sue(t,n){if(t&1){let i=Hn();$(0,"div",27)(1,"button",28),Ot("click",function(){Wt(i);let h=Ne();return Zt(h.volverALista())}),be(2,"i",4),W(),be(3,"img",29),$(4,"div",30)(5,"strong"),ne(6),W(),$(7,"span"),ne(8),W()()(),$(9,"div",31,0),tt(11,nue,4,0,"div",11),tt(12,iue,6,0,"div",32),tt(13,oue,2,0),W(),$(14,"div",33)(15,"input",34),Rl("ngModelChange",function(h){Wt(i);let o=Ne();return oc(o.nuevoMensaje,h)||(o.nuevoMensaje=h),Zt(h)}),Ot("keydown.enter",function(){Wt(i);let h=Ne();return Zt(h.enviarMensaje())}),W(),$(16,"button",35),Ot("click",function(){Wt(i);let h=Ne();return Zt(h.enviarMensaje())}),be(17,"i",36),W()()}if(t&2){let i,l,h,o,E=Ne();ie(3),zt("src",((i=E.obtenerDestinatario())==null?null:i.foto)||"https://placehold.co/50x50/2e8b57/fff?text="+E.obtenerIniciales(((i=E.obtenerDestinatario())==null?null:i.nombre)||""),zr)("alt",(l=E.obtenerDestinatario())==null?null:l.nombre),ie(3),Ln((h=E.obtenerDestinatario())==null?null:h.nombre),ie(2),Ln((o=E.obtenerDestinatario())==null?null:o.email),ie(3),nt(E.cargandoMensajes?11:-1),ie(),nt(!E.cargandoMensajes&&E.mensajes.length===0?12:-1),ie(),nt(!E.cargandoMensajes&&E.mensajes.length>0?13:-1),ie(2),Ol("ngModel",E.nuevoMensaje),zt("disabled",!E.conectado),ie(),zt("disabled",!E.nuevoMensaje.trim()||!E.conectado)}}var DD=class t{constructor(n,i,l,h,o,E,A){this.chatService=n;this.tokenService=i;this.usuarioService=l;this.webSocketService=h;this.route=o;this.location=E;this.router=A}messagesContainer;usuarioActual;usuarioActualId="";conversaciones=[];chatActual;mensajes=[];mensajesNoLeidos=0;nuevoMensaje="";cargando=!1;cargandoMensajes=!1;conectado=!1;mostrarListaConversaciones=!0;shouldScrollToBottom=!1;destinatarioId;destroy$=new Fn;ngOnInit(){if(this.usuarioActualId=this.tokenService.getUserId(),!this.tokenService.isLogged()){this.router.navigate(["/login"]);return}this.route.queryParams.pipe(tn(this.destroy$)).subscribe(n=>{n.destinatarioId&&(this.destinatarioId=n.destinatarioId)}),this.suscribirseAWebSocket(),this.cargarUsuarioActual(),this.cargarConversaciones(),this.webSocketService.conectar(this.destinatarioId||null)}ngAfterViewChecked(){this.shouldScrollToBottom&&(this.scrollToBottom(),this.shouldScrollToBottom=!1)}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}suscribirseAWebSocket(){this.webSocketService.estadoConexion$.pipe(tn(this.destroy$)).subscribe(n=>{this.conectado=n,console.log("Estado WebSocket:",n?"Conectado":"Desconectado")}),this.webSocketService.mensajesRecibidos$.pipe(tn(this.destroy$),To(n=>n!==null)).subscribe(n=>{this.procesarMensajeEntrante(n)})}procesarMensajeEntrante(n){console.log("Procesando mensaje entrante:",n),this.chatActual&&(n.chatId===this.chatActual.id||this.chatActual.id===0)?(this.chatActual.id===0&&n.chatId>0&&(this.chatActual.id=n.chatId),this.mensajes.some(l=>l.id===n.id||l.contenido===n.contenido&&Math.abs(new Date(l.fechaEnvio).getTime()-new Date(n.fechaEnvio).getTime())<1e3)||(this.mensajes=[...this.mensajes,n],this.shouldScrollToBottom=!0),n.remitenteId!==this.usuarioActualId&&!n.leido&&this.marcarChatComoLeido(this.chatActual.id)):this.cargarConversaciones(),this.actualizarListaConversaciones()}cargarUsuarioActual(){this.usuarioService.obtener(this.usuarioActualId).pipe(tn(this.destroy$)).subscribe({next:n=>{n.error||(this.usuarioActual=n.data)},error:n=>console.error("Error al cargar usuario:",n)})}cargarConversaciones(){this.cargando=!0,this.chatService.listarConversaciones(this.usuarioActualId).pipe(tn(this.destroy$)).subscribe({next:n=>{n.error||(this.conversaciones=n.data,this.destinatarioId?(this.buscarOIniciarConversacion(this.destinatarioId),this.router.navigate([],{relativeTo:this.route,queryParams:{destinatarioId:null},queryParamsHandling:"merge"})):this.conversaciones.length>0&&!this.chatActual&&this.seleccionarChat(this.conversaciones[0])),this.cargando=!1},error:n=>{console.error("Error al cargar conversaciones:",n),this.cargando=!1}}),this.chatService.obtenerMensajesNoLeidos(this.usuarioActualId).pipe(tn(this.destroy$)).subscribe({next:n=>{n.error||(this.mensajesNoLeidos=n.data)},error:n=>console.error("Error al cargar mensajes no le\xEDdos:",n)})}actualizarListaConversaciones(){this.chatService.listarConversaciones(this.usuarioActualId).pipe(tn(this.destroy$)).subscribe({next:n=>{n.error||(this.conversaciones=n.data,this.actualizarContadorNoLeidos())},error:n=>{console.error("Error al actualizar conversaciones:",n)}})}actualizarContadorNoLeidos(){this.chatService.obtenerMensajesNoLeidos(this.usuarioActualId).pipe(tn(this.destroy$)).subscribe({next:n=>{n.error||(this.mensajesNoLeidos=n.data)},error:n=>console.error("Error al cargar mensajes no le\xEDdos:",n)})}buscarOIniciarConversacion(n){let i=this.conversaciones.find(l=>l.usuario1.id===n||l.usuario2.id===n);i?this.seleccionarChat(i):this.iniciarNuevoChat(n)}iniciarNuevoChat(n){this.usuarioService.obtener(n).pipe(tn(this.destroy$)).subscribe({next:i=>{if(!i.error){let l=i.data;this.chatActual={id:0,usuario1:this.usuarioActual,usuario2:l,mensajes:[],creadoEn:new Date,activo:!0},this.mensajes=[],this.mostrarListaConversaciones=!1,this.shouldScrollToBottom=!0}},error:i=>console.error("Error al cargar destinatario:",i)})}seleccionarChat(n){this.chatActual=n,this.mostrarListaConversaciones=!1,this.cargarMensajesChat(n.id),this.marcarChatComoLeido(n.id)}cargarMensajesChat(n){this.cargandoMensajes=!0,this.chatService.obtenerChat(n,0,50).pipe(tn(this.destroy$)).subscribe({next:i=>{if(!i.error){let l=i.data;this.mensajes=l.mensajes||[],this.shouldScrollToBottom=!0}this.cargandoMensajes=!1},error:i=>{console.error("Error al cargar mensajes:",i),this.cargandoMensajes=!1}})}marcarChatComoLeido(n){this.chatService.marcarChatComoLeido(n,this.usuarioActualId).pipe(tn(this.destroy$)).subscribe({next:()=>{this.chatService.obtenerMensajesNoLeidos(this.usuarioActualId).pipe(tn(this.destroy$)).subscribe({next:i=>{i.error||(this.mensajesNoLeidos=i.data)}})},error:i=>console.error("Error al marcar como le\xEDdo:",i)})}enviarMensaje(){if(!this.nuevoMensaje.trim()||!this.chatActual)return;if(!this.conectado){console.error("No conectado a WebSocket");return}let n=this.obtenerDestinatarioId(),i=this.nuevoMensaje.trim(),l={destinatarioId:n,contenido:i,chatId:this.chatActual.id||0},h={id:Date.now(),remitenteId:this.usuarioActualId,destinatarioId:n,chatId:this.chatActual.id,contenido:i,fechaEnvio:new Date,leido:!1};this.nuevoMensaje="",this.shouldScrollToBottom=!0,this.webSocketService.enviarMensaje(l).pipe(tn(this.destroy$)).subscribe({next:()=>{console.log("Mensaje enviado correctamente")},error:o=>{console.error("Error al enviar mensaje:",o),this.mensajes=this.mensajes.filter(E=>E.id!==h.id)}})}obtenerDestinatarioId(){return this.chatActual?this.chatActual.usuario1.id===this.usuarioActualId?this.chatActual.usuario2.id:this.chatActual.usuario1.id:""}obtenerDestinatario(){if(this.chatActual)return this.chatActual.usuario1.id===this.usuarioActualId?this.chatActual.usuario2:this.chatActual.usuario1}esMensajePropio(n){return n.remitenteId===this.usuarioActualId}formatearHora(n){return(typeof n=="string"?new Date(n):n).toLocaleTimeString("es-CO",{hour:"2-digit",minute:"2-digit"})}obtenerIniciales(n){return n?n.charAt(0).toUpperCase():"?"}scrollToBottom(){try{if(this.messagesContainer){let n=this.messagesContainer.nativeElement;n.scrollTop=n.scrollHeight}}catch(n){console.error("Error al hacer scroll:",n)}}volverALista(){this.mostrarListaConversaciones=!0,this.chatActual=void 0,this.mensajes=[]}obtenerUltimoMensajePreview(n){if(!n.ultimoMensaje)return"No hay mensajes";let i=n.ultimoMensaje.contenido;return i.length>50?i.substring(0,50)+"...":i}obtenerOtroUsuario(n){return n.usuario1.id===this.usuarioActualId?n.usuario2:n.usuario1}volver(){this.location.back()}static \u0275fac=function(i){return new(i||t)(wt(eD),wt(Ar),wt(Os),wt(SD),wt(la),wt(Fl),wt(br))};static \u0275cmp=Ai({type:t,selectors:[["app-chat"]],viewQuery:function(i,l){if(i&1&&TP(Wce,5),i&2){let h;fT(h=pT())&&(l.messagesContainer=h.first)}},decls:21,vars:15,consts:[["messagesContainer",""],[1,"container","chat-container"],[1,"chat-header-actions"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"fa-solid","fa-arrow-left"],[1,"chat-layout"],[1,"conversations-sidebar"],[1,"sidebar-header"],[1,"fa-solid","fa-message"],[1,"unread-badge"],[1,"connection-status"],[1,"loading-container"],[1,"conversations-list"],[1,"empty-state-small"],[1,"chat-window"],[1,"empty-chat"],[1,"loading-spinner-large"],[1,"conversation-item",3,"active"],[1,"conversation-item",3,"click"],[1,"conversation-avatar",3,"src","alt"],[1,"conversation-info"],[1,"conversation-header"],[1,"conversation-time"],[1,"conversation-preview"],[1,"unread-indicator"],[1,"fa-solid","fa-comment-slash"],[1,"fa-solid","fa-comments"],[1,"chat-header"],["type","button",1,"btn-back-mobile",3,"click"],[1,"chat-header-avatar",3,"src","alt"],[1,"chat-header-info"],[1,"chat-messages"],[1,"empty-chat-messages"],[1,"chat-input"],["type","text","placeholder","Escribe un mensaje...",3,"ngModelChange","keydown.enter","ngModel","disabled"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[1,"fa-solid","fa-paper-plane"],[1,"fa-solid","fa-comment-dots"],[1,"text-muted"],[1,"message-wrapper",3,"own-message"],[1,"message-wrapper"],[1,"message-bubble"],[1,"message-content"],[1,"message-time"]],template:function(i,l){i&1&&($(0,"main",1)(1,"div",2)(2,"button",3),Ot("click",function(){return l.volver()}),be(3,"i",4),ne(4," Volver "),W()(),$(5,"div",5)(6,"aside",6)(7,"div",7)(8,"h2"),be(9,"i",8),ne(10," Mensajes "),W(),tt(11,Zce,2,1,"span",9),W(),$(12,"div",10),be(13,"i"),ne(14),W(),tt(15,Xce,4,0,"div",11),tt(16,Qce,3,0,"div",12),tt(17,eue,4,0,"div",13),W(),$(18,"section",14),tt(19,tue,6,0,"div",15),tt(20,sue,18,10),W()()()),i&2&&(ie(6),Dn("hidden-mobile",!l.mostrarListaConversaciones),ie(5),nt(l.mensajesNoLeidos>0?11:-1),ie(),Dn("connected",l.conectado),ie(),Ta(l.conectado?"fa-solid fa-circle":"fa-solid fa-circle-exclamation"),ie(),nn(" ",l.conectado?"Conectado":"Desconectado"," "),ie(),nt(l.cargando?15:-1),ie(),nt(!l.cargando&&l.conversaciones.length>0?16:-1),ie(),nt(!l.cargando&&l.conversaciones.length===0?17:-1),ie(),Dn("hidden-mobile",l.mostrarListaConversaciones),ie(),nt(l.chatActual?-1:19),ie(),nt(l.chatActual?20:-1))},dependencies:[Mr,Ap,Ps,ca,qh],styles:[".chat-container[_ngcontent-%COMP%]{padding:2rem 0;max-width:1400px}.chat-header-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;margin-bottom:1rem}.chat-layout[_ngcontent-%COMP%]{display:grid;grid-template-columns:380px 1fr;gap:0;height:calc(100vh - 180px);background-color:var(--white-color);border-radius:20px;overflow:hidden;box-shadow:var(--card-shadow);border:1px solid rgba(46,139,87,.05)}.conversations-sidebar[_ngcontent-%COMP%]{background-color:var(--light-green);border-right:2px solid rgba(46,139,87,.1);display:flex;flex-direction:column;overflow:hidden}.sidebar-header[_ngcontent-%COMP%]{padding:2rem;border-bottom:2px solid rgba(46,139,87,.1);display:flex;justify-content:space-between;align-items:center;background-color:var(--white-color)}.sidebar-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.6rem;color:var(--dark-green);margin:0;display:flex;align-items:center;gap:10px;font-weight:700}.sidebar-header[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--primary-color)}.unread-badge[_ngcontent-%COMP%]{background-color:var(--danger-color);color:#fff;padding:4px 10px;border-radius:12px;font-size:.85rem;font-weight:700}.connection-status[_ngcontent-%COMP%]{padding:12px 20px;background-color:#e74c3c1a;color:var(--danger-color);font-size:.9rem;font-weight:600;display:flex;align-items:center;gap:8px;border-bottom:1px solid rgba(46,139,87,.1)}.connection-status.connected[_ngcontent-%COMP%]{background-color:#2e8b571a;color:var(--success-color)}.connection-status[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:.7rem}.conversations-list[_ngcontent-%COMP%]{overflow-y:auto;flex:1}.conversations-list[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.conversations-list[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#2e8b570d}.conversations-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:var(--primary-color);border-radius:10px}.conversation-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:1.2rem 1.5rem;cursor:pointer;transition:all .3s ease;border-bottom:1px solid rgba(46,139,87,.05);position:relative;background-color:var(--white-color)}.conversation-item[_ngcontent-%COMP%]:hover{background-color:var(--light-green)}.conversation-item.active[_ngcontent-%COMP%]{background-color:var(--primary-color);color:var(--white-color)}.conversation-item.active[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%], .conversation-item.active[_ngcontent-%COMP%]   .conversation-preview[_ngcontent-%COMP%]{color:var(--white-color)}.conversation-avatar[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:50%;border:2px solid var(--primary-color);flex-shrink:0;object-fit:cover}.conversation-info[_ngcontent-%COMP%]{flex:1;min-width:0}.conversation-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:4px}.conversation-header[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:1rem;color:var(--dark-green);font-weight:600}.conversation-time[_ngcontent-%COMP%]{font-size:.8rem;color:#7f8c8d;flex-shrink:0}.conversation-preview[_ngcontent-%COMP%]{font-size:.9rem;color:#7f8c8d;margin:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.unread-indicator[_ngcontent-%COMP%]{width:12px;height:12px;background-color:var(--primary-color);border-radius:50%;flex-shrink:0}.chat-window[_ngcontent-%COMP%]{display:flex;flex-direction:column;background-color:var(--white-color);height:100%;overflow:hidden}.empty-chat[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;text-align:center;color:#7f8c8d}.empty-chat[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:5rem;color:var(--primary-color);opacity:.3;margin-bottom:1.5rem}.empty-chat[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.8rem;color:var(--dark-green);margin-bottom:.5rem}.empty-chat[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.1rem}.chat-header[_ngcontent-%COMP%]{padding:1.5rem 2rem;border-bottom:2px solid var(--light-green);display:flex;align-items:center;gap:15px;background-color:var(--white-color);flex-shrink:0}.btn-back-mobile[_ngcontent-%COMP%]{display:none;background:none;border:none;color:var(--primary-color);font-size:1.3rem;cursor:pointer;padding:8px;border-radius:8px;transition:all .3s ease}.btn-back-mobile[_ngcontent-%COMP%]:hover{background-color:var(--light-green)}.chat-header-avatar[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:50%;border:2px solid var(--primary-color);object-fit:cover}.chat-header-info[_ngcontent-%COMP%]{flex:1}.chat-header-info[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block;font-size:1.1rem;color:var(--dark-green);font-weight:600}.chat-header-info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.9rem;color:#7f8c8d}.chat-messages[_ngcontent-%COMP%]{flex:1;padding:2rem;background-color:#f8f9fa;display:flex;flex-direction:column;gap:1rem;flex-grow:1;overflow-y:auto}.chat-messages[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px}.chat-messages[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#2e8b570d}.chat-messages[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:var(--primary-color);border-radius:10px}.empty-chat-messages[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;text-align:center;color:#7f8c8d}.empty-chat-messages[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:3rem;color:var(--primary-color);opacity:.3;margin-bottom:1rem}.empty-chat-messages[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.5rem 0}.text-muted[_ngcontent-%COMP%]{font-size:.9rem;color:#95a5a6}.message-wrapper[_ngcontent-%COMP%]{display:flex;margin-bottom:.5rem}.message-wrapper.own-message[_ngcontent-%COMP%]{justify-content:flex-end}.message-bubble[_ngcontent-%COMP%]{max-width:60%;padding:12px 16px;border-radius:16px;position:relative;word-wrap:break-word;animation:_ngcontent-%COMP%_messageSlideIn .3s ease}@keyframes _ngcontent-%COMP%_messageSlideIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.message-wrapper[_ngcontent-%COMP%]:not(.own-message)   .message-bubble[_ngcontent-%COMP%]{background-color:var(--white-color);color:var(--text-color);border:1px solid rgba(46,139,87,.1);border-bottom-left-radius:4px}.message-wrapper.own-message[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]{background-color:var(--primary-color);color:var(--white-color);border-bottom-right-radius:4px}.message-content[_ngcontent-%COMP%]{margin:0 0 4px;font-size:.95rem;line-height:1.5}.message-time[_ngcontent-%COMP%]{font-size:.75rem;opacity:.7;display:block;text-align:right}.chat-input[_ngcontent-%COMP%]{padding:1.5rem 2rem;border-top:2px solid var(--light-green);display:flex;gap:12px;align-items:center;background-color:var(--white-color)}.chat-input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;padding:14px 20px;border:2px solid var(--border-color);border-radius:25px;font-size:1rem;transition:all .3s ease}.chat-input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{border-color:var(--primary-color);outline:none;box-shadow:0 0 0 3px #2e8b571a}.chat-input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:disabled{background-color:var(--light-gray-color);cursor:not-allowed}.chat-input[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:14px 20px;border-radius:50%;width:50px;height:50px;display:flex;align-items:center;justify-content:center;flex-shrink:0}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:3rem;color:#7f8c8d}.loading-spinner-large[_ngcontent-%COMP%]{display:inline-block;width:48px;height:48px;border:4px solid var(--light-green);border-radius:50%;border-top-color:var(--primary-color);animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:1rem}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.empty-state-small[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:3rem 2rem;text-align:center;color:#7f8c8d}.empty-state-small[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:3rem;color:var(--primary-color);opacity:.3;margin-bottom:1rem}.empty-state-small[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:.95rem}@media (max-width: 768px){.chat-layout[_ngcontent-%COMP%]{grid-template-columns:1fr;height:calc(100vh - 120px)}.conversations-sidebar.hidden-mobile[_ngcontent-%COMP%], .chat-window.hidden-mobile[_ngcontent-%COMP%]{display:none}.btn-back-mobile[_ngcontent-%COMP%]{display:block}.message-bubble[_ngcontent-%COMP%]{max-width:80%}.chat-input[_ngcontent-%COMP%]{padding:1rem}.sidebar-header[_ngcontent-%COMP%]{padding:1.5rem}}@media (max-width: 480px){.message-bubble[_ngcontent-%COMP%]{max-width:85%}.chat-header[_ngcontent-%COMP%]{padding:1rem}.chat-header-info[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:1rem}.chat-header-info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.8rem}}.conversation-item[_ngcontent-%COMP%]:focus-visible, .chat-input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus-visible, .chat-input[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:focus-visible{outline:3px solid var(--primary-color);outline-offset:2px}"]})};var Ck=class t{constructor(n,i){this.tokenService=n;this.router=i}canActivate(n,i){return this.tokenService.isLogged()?(this.router.navigate([""]),!1):!0}static \u0275fac=function(i){return new(i||t)(gn(Ar),gn(br))};static \u0275prov=Qt({token:t,factory:t.\u0275fac,providedIn:"root"})},Ek=(t,n)=>ft(Ck).canActivate(t,n);var Tk=class t{constructor(n,i){this.tokenService=n;this.router=i}canActivate(n,i){let l=n.data.expectedRole,h=this.tokenService.getRole();return!this.tokenService.isLogged()||!l.includes(h)?(this.router.navigate([""]),!1):!0}static \u0275fac=function(i){return new(i||t)(gn(Ar),gn(br))};static \u0275prov=Qt({token:t,factory:t.\u0275fac,providedIn:"root"})},af=(t,n)=>ft(Tk).canActivate(t,n);var P$=[{path:"",component:LS},{path:"login",component:NS,canActivate:[Ek]},{path:"registro",component:zS,canActivate:[Ek]},{path:"busqueda",component:BS},{path:"alojamiento/:id",component:WS},{path:"mis-alojamientos",component:ZS,canActivate:[af],data:{expectedRole:["ROL_Anfitrion"]}},{path:"crear-alojamiento",component:d1,canActivate:[af],data:{expectedRole:["ROL_Anfitrion"]}},{path:"editar-alojamiento/:id",component:d1,canActivate:[af],data:{expectedRole:["ROL_Anfitrion"]}},{path:"editar-perfil",component:XS,canActivate:[af],data:{expectedRole:["ROL_Huesped","ROL_Anfitrion"]}},{path:"mis-reservas",component:YS,canActivate:[af],data:{expectedRole:["ROL_Huesped","ROL_Anfitrion"]}},{path:"gestionar-reservas",component:KS,canActivate:[af],data:{expectedRole:["ROL_Anfitrion"]}},{path:"dashboard-anfitrion",component:QS,canActivate:[af],data:{expectedRole:["ROL_Anfitrion"]}},{path:"chat",component:DD,canActivate:[af],data:{expectedRole:["ROL_Huesped","ROL_Anfitrion"]}},{path:"**",pathMatch:"full",redirectTo:""}];var ID=!1,O$=(t,n)=>{let i=ft(Ar),l=ft(Op),h=ft(br);if(!i.isLogged()||t.url.includes("/api/auth/refresh"))return n(t);let o=i.getToken(),E=t.clone({setHeaders:{Authorization:`Bearer ${o}`}});return n(E).pipe(dl(A=>{if(A.status===401&&!ID){ID=!0;let L=i.getRefreshToken();return L?l.refrescarToken({refreshToken:L}).pipe(us(Y=>{ID=!1,i.login(Y.data.token,Y.data.refreshToken);let le=t.clone({setHeaders:{Authorization:`Bearer ${Y.data.token}`}});return n(le)}),dl(Y=>(ID=!1,i.logout(),h.navigate(["/login"]),vd(()=>Y)))):(i.logout(),h.navigate(["/login"]),vd(()=>A))}return vd(()=>A)}))};function aue(t){return new Date(t).getTimezoneOffset()}function R$(){return{addDays:cv,addHours:n6,addMinutes:s6,addSeconds:a6,differenceInDays:d6,differenceInMinutes:h6,differenceInSeconds:p6,endOfDay:uv,endOfMonth:f6,endOfWeek:g6,getDay:y6,getMonth:C6,isSameDay:c6,isSameMonth:S6,isSameSecond:D6,max:l6,setHours:P6,setMinutes:O6,startOfDay:Nc,startOfMinute:T6,startOfMonth:m6,startOfWeek:HS,getHours:b6,getMinutes:w6,getTimezoneOffset:aue}}function k$(){return Object.assign(Object.assign({},R$()),{addWeeks:$S,addMonths:Rp,subDays:I6,subWeeks:k6,subMonths:dv,getISOWeek:_6,setDate:A6,setMonth:M6,setYear:R6,getDate:v6,getYear:E6})}function lue(t){let n=t,i=Math.floor(Math.abs(t)),l=t.toString().replace(/^[^.]*\.?/,"").length,h=parseInt(t.toString().replace(/^[^e]*(e([-+]?\d+))?/,"$2"))||0;return n===1?1:h===0&&i!==0&&i%1e6===0&&l===0||!(h>=0&&h<=5)?4:5}var F$=["es",[["a.\xA0m.","p.\xA0m."]],void 0,[["D","L","M","X","J","V","S"],["dom","lun","mar","mi\xE9","jue","vie","s\xE1b"],["domingo","lunes","martes","mi\xE9rcoles","jueves","viernes","s\xE1bado"],["DO","LU","MA","MI","JU","VI","SA"]],void 0,[["E","F","M","A","M","J","J","A","S","O","N","D"],["ene","feb","mar","abr","may","jun","jul","ago","sept","oct","nov","dic"],["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"]],void 0,[["a. C.","d. C."],void 0,["antes de Cristo","despu\xE9s de Cristo"]],1,[6,0],["d/M/yy","d MMM y","d 'de' MMMM 'de' y","EEEE, d 'de' MMMM 'de' y"],["H:mm","H:mm:ss","H:mm:ss z","H:mm:ss (zzzz)"],["{1}, {0}",void 0,void 0,void 0],[",",".",";","%","+","-","E","\xD7","\u2030","\u221E","NaN",":"],["#,##0.###","#,##0\xA0%","#,##0.00\xA0\xA4","#E0"],"EUR","\u20AC","euro",{AUD:[void 0,"$"],BRL:[void 0,"R$"],BYN:[void 0,"\u0440."],CAD:[void 0,"$"],CNY:[void 0,"\xA5"],EGP:[],ESP:["\u20A7"],GBP:[void 0,"\xA3"],HKD:[void 0,"$"],ILS:[void 0,"\u20AA"],INR:[void 0,"\u20B9"],JPY:[void 0,"\xA5"],KRW:[void 0,"\u20A9"],MXN:[void 0,"$"],NZD:[void 0,"$"],PHP:[void 0,"\u20B1"],RON:[void 0,"L"],THB:["\u0E3F"],TWD:[void 0,"NT$"],USD:["US$","$"],XAF:[],XCD:[void 0,"$"],XOF:[]},"ltr",lue];d5(F$);var L$={providers:[$M(),RP({eventCoalescing:!0}),zO(P$),cO(uO([O$])),oE(Q0.forRoot({provide:fg,useFactory:k$})),{provide:Du,useValue:"es"}]};function cue(t,n){t&1&&($(0,"li")(1,"a",7),ne(2,"Convi\xE9rtete en Anfitri\xF3n"),W()(),$(3,"li")(4,"a",8),ne(5,"Iniciar Sesi\xF3n"),W()(),$(6,"li")(7,"a",9),ne(8,"Reg\xEDstrate"),W()())}function uue(t,n){t&1&&($(0,"li")(1,"a",16),be(2,"i",17),ne(3," Convi\xE9rtete en Anfitri\xF3n "),W()())}function due(t,n){if(t&1&&be(0,"img",13),t&2){let i=Ne(2);zt("src",i.usuario.foto,zr)("alt","Avatar de "+i.usuario.nombre)}}function hue(t,n){if(t&1&&($(0,"div",14),ne(1),W()),t&2){let i=Ne(2);ie(),nn(" ",i.obtenerIniciales()," ")}}function fue(t,n){if(t&1){let i=Hn();$(0,"a",28),Ot("click",function(){Wt(i);let h=Ne(3);return Zt(h.cerrarMenuUsuario())}),be(1,"i",29),ne(2," Mis Alojamientos "),W(),$(3,"a",30),Ot("click",function(){Wt(i);let h=Ne(3);return Zt(h.cerrarMenuUsuario())}),be(4,"i",31),ne(5," Gestionar Reservas "),W(),$(6,"a",32),Ot("click",function(){Wt(i);let h=Ne(3);return Zt(h.cerrarMenuUsuario())}),be(7,"i",33),ne(8," Crear Alojamiento "),W(),$(9,"a",34),Ot("click",function(){Wt(i);let h=Ne(3);return Zt(h.cerrarMenuUsuario())}),be(10,"i",35),ne(11," Dashboard "),W()}}function pue(t,n){if(t&1){let i=Hn();$(0,"div",15)(1,"div",18)(2,"strong"),ne(3),W(),$(4,"span"),ne(5),W()(),be(6,"hr",19),$(7,"a",20),Ot("click",function(){Wt(i);let h=Ne(2);return Zt(h.cerrarMenuUsuario())}),be(8,"i",21),ne(9," Mis Reservas "),W(),$(10,"a",22),Ot("click",function(){Wt(i);let h=Ne(2);return Zt(h.cerrarMenuUsuario())}),be(11,"i",23),ne(12," Chats "),W(),tt(13,fue,12,0),$(14,"a",24),Ot("click",function(){Wt(i);let h=Ne(2);return Zt(h.cerrarMenuUsuario())}),be(15,"i",25),ne(16," Mi Perfil "),W(),be(17,"hr",19),$(18,"a",26),Ot("click",function(){Wt(i);let h=Ne(2);return Zt(h.cerrarSesion())}),be(19,"i",27),ne(20," Cerrar Sesi\xF3n "),W()()}if(t&2){let i=Ne(2);ie(3),Ln(i.usuario.nombre),ie(2),Ln(i.usuario.email),ie(8),nt(i.usuario.esAnfitrion?13:-1)}}function mue(t,n){if(t&1){let i=Hn();tt(0,uue,4,0,"li"),$(1,"li",10)(2,"button",11),Ot("click",function(){Wt(i);let h=Ne();return Zt(h.toggleMenuUsuario())}),be(3,"i",12),tt(4,due,1,2,"img",13)(5,hue,2,1,"div",14),W(),tt(6,pue,21,3,"div",15),W()}if(t&2){let i=Ne();nt(i.usuario.esAnfitrion?-1:0),ie(4),nt(i.usuario.foto?4:5),ie(2),nt(i.mostrarMenuUsuario?6:-1)}}function gue(t,n){t&1&&($(0,"li"),be(1,"div",36),W())}var MD=class t{constructor(n,i,l,h){this.tokenService=n;this.usuarioService=i;this.mensajeHandlerService=l;this.router=h;this.estaAutenticado=this.tokenService.isLogged(),this.estaAutenticado&&(this.email=this.tokenService.getEmail())}estaAutenticado=!1;usuario=null;cargandoUsuario=!1;mostrarMenuUsuario=!1;email="";destroy$=new Fn;ngOnInit(){this.verificarAutenticacion()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}onDocumentClick(n){!n.target.closest(".user-menu-container")&&this.mostrarMenuUsuario&&(this.mostrarMenuUsuario=!1)}verificarAutenticacion(){this.estaAutenticado=this.tokenService.isLogged(),this.estaAutenticado&&this.cargarDatosUsuario()}cargarDatosUsuario(){this.cargandoUsuario=!0,this.usuarioService.obtener(this.tokenService.getUserId()).pipe(tn(this.destroy$)).subscribe({next:n=>{n.error?console.error("Error al obtener usuario"):this.usuario=n.data,this.cargandoUsuario=!1},error:n=>{console.error("Error al cargar datos del usuario:",n),this.cargandoUsuario=!1}})}toggleMenuUsuario(){this.mostrarMenuUsuario=!this.mostrarMenuUsuario}cerrarMenuUsuario(){this.mostrarMenuUsuario=!1}cerrarSesion(){this.cerrarMenuUsuario(),this.mensajeHandlerService.confirm("\xBFEst\xE1s seguro de que deseas cerrar sesi\xF3n?","S\xED, cerrar sesi\xF3n","\xBFCerrar sesi\xF3n?").then(n=>{n&&(this.tokenService.logout(),this.estaAutenticado=!1,this.usuario=null,this.router.navigate(["/"]),this.mensajeHandlerService.showSuccess("Has cerrado sesi\xF3n correctamente","Sesi\xF3n cerrada"))})}irAPerfil(){this.cerrarMenuUsuario(),this.router.navigate(["/editar-perfil"])}obtenerIniciales(){return this.usuario?this.usuario.nombre.charAt(0).toUpperCase():"U"}static \u0275fac=function(i){return new(i||t)(wt(Ar),wt(Os),wt(rs),wt(br))};static \u0275cmp=Ai({type:t,selectors:[["app-encabezado"]],hostBindings:function(i,l){i&1&&Ot("click",function(o){return l.onDocumentClick(o)},JA)},decls:12,vars:3,consts:[[1,"main-header"],[1,"container","header-content"],["routerLink","/",1,"logo"],[1,"logo-icon"],[1,"fa-solid","fa-house-chimney","logo-house"],[1,"logo-text"],[1,"main-nav"],["routerLink","/login",1,"nav-link"],["routerLink","/login",1,"btn","btn-secondary"],["routerLink","/registro",1,"btn","btn-primary"],[1,"user-menu-container"],["type","button",1,"user-menu",2,"cursor","pointer","border","none",3,"click"],[1,"fa-solid","fa-bars"],[3,"src","alt"],[2,"width","36px","height","36px","border-radius","50%","background-color","var(--primary-color)","color","white","display","flex","align-items","center","justify-content","center","font-weight","600"],[1,"user-dropdown"],["routerLink","/editar-perfil",1,"nav-link"],[1,"fa-solid","fa-star"],[1,"user-dropdown-header"],[2,"margin","0.5rem 0","border-color","var(--light-green)"],["routerLink","/mis-reservas",1,"dropdown-item",3,"click"],[1,"fa-solid","fa-briefcase"],["routerLink","/chat",1,"dropdown-item",3,"click"],[1,"fa-solid","fa-message"],["routerLink","/editar-perfil",1,"dropdown-item",3,"click"],[1,"fa-solid","fa-user"],[1,"dropdown-item",2,"cursor","pointer","color","var(--danger-color)",3,"click"],[1,"fa-solid","fa-right-from-bracket"],["routerLink","/mis-alojamientos",1,"dropdown-item",3,"click"],[1,"fa-solid","fa-house-user"],["routerLink","/gestionar-reservas",1,"dropdown-item",3,"click"],[1,"fa-solid","fa-clipboard-check"],["routerLink","/crear-alojamiento",1,"dropdown-item",3,"click"],[1,"fa-solid","fa-plus"],["routerLink","/dashboard-anfitrion",1,"dropdown-item",3,"click"],[1,"fa-solid","fa-dashboard"],[1,"loading-spinner-small",2,"width","24px","height","24px","border-width","2px"]],template:function(i,l){i&1&&($(0,"header",0)(1,"div",1)(2,"a",2)(3,"div",3),be(4,"i",4),W(),$(5,"span",5),ne(6,"CloudHouse"),W()(),$(7,"nav",6)(8,"ul"),tt(9,cue,9,0),tt(10,mue,7,3),tt(11,gue,2,0,"li"),W()()()()),i&2&&(ie(9),nt(l.estaAutenticado?-1:9),ie(),nt(l.estaAutenticado&&l.usuario?10:-1),ie(),nt(l.estaAutenticado&&l.cargandoUsuario?11:-1))},dependencies:[ns,Mr],styles:[".user-menu-container[_ngcontent-%COMP%]{position:relative}.user-dropdown[_ngcontent-%COMP%]{position:absolute;top:calc(100% + 12px);right:0;background-color:var(--white-color);border-radius:16px;box-shadow:0 8px 32px #2e8b5733;min-width:240px;padding:1rem;z-index:1000;animation:_ngcontent-%COMP%_dropdownFadeIn .3s ease-in-out;border:1px solid rgba(46,139,87,.1)}@keyframes _ngcontent-%COMP%_dropdownFadeIn{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.user-dropdown-header[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px;margin-bottom:.5rem}.user-dropdown-header[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:var(--dark-green);font-weight:600;font-size:.95rem}.user-dropdown-header[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#7f8c8d;font-size:.85rem}.dropdown-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:.8rem;border-radius:8px;color:var(--text-color);text-decoration:none;transition:all .3s ease;font-size:.9rem;font-weight:500}.dropdown-item[_ngcontent-%COMP%]:hover{background-color:var(--light-green);color:var(--primary-color);transform:translate(4px)}.dropdown-item[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{width:18px;font-size:1rem}.loading-spinner-small[_ngcontent-%COMP%]{display:inline-block;width:24px;height:24px;border:2px solid var(--light-green);border-radius:50%;border-top-color:var(--primary-color);animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}@media (max-width: 768px){.user-dropdown[_ngcontent-%COMP%]{min-width:200px;right:-10px}.nav-link[_ngcontent-%COMP%]{display:none}}"]})};var AD=class t{static \u0275fac=function(i){return new(i||t)};static \u0275cmp=Ai({type:t,selectors:[["app-pie-pagina"]],decls:57,vars:0,consts:[[1,"main-footer"],[1,"container"],[1,"footer-content"],[1,"footer-section"],["href","#"],[1,"footer-section","social-media"],[1,"fa-brands","fa-facebook"],[1,"fa-brands","fa-twitter"],[1,"fa-brands","fa-instagram"],[1,"footer-bottom"]],template:function(i,l){i&1&&(es(0,"footer",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h4"),ne(5,"CloudHouse"),ts(),es(6,"ul")(7,"li")(8,"a",4),ne(9,"Sobre Nosotros"),ts()(),es(10,"li")(11,"a",4),ne(12,"Prensa"),ts()(),es(13,"li")(14,"a",4),ne(15,"Carreras"),ts()(),es(16,"li")(17,"a",4),ne(18,"Pol\xEDticas"),ts()()()(),es(19,"div",3)(20,"h4"),ne(21,"Descubre"),ts(),es(22,"ul")(23,"li")(24,"a",4),ne(25,"Confianza y Seguridad"),ts()(),es(26,"li")(27,"a",4),ne(28,"Cr\xE9ditos de Viaje"),ts()(),es(29,"li")(30,"a",4),ne(31,"Ideas para Viajes"),ts()()()(),es(32,"div",3)(33,"h4"),ne(34,"Anfitriones"),ts(),es(35,"ul")(36,"li")(37,"a",4),ne(38,"\xBFPor qu\xE9 ser anfitri\xF3n?"),ts()(),es(39,"li")(40,"a",4),ne(41,"Hospitalidad"),ts()(),es(42,"li")(43,"a",4),ne(44,"Centro de la Comunidad"),ts()()()(),es(45,"div",5)(46,"h4"),ne(47,"S\xEDguenos"),ts(),es(48,"a",4),O0(49,"i",6),ts(),es(50,"a",4),O0(51,"i",7),ts(),es(52,"a",4),O0(53,"i",8),ts()()(),es(54,"div",9)(55,"p"),ne(56,"\xA9 2025 CloudHouse. Todos los derechos reservados."),ts()()()())},encapsulation:2})};var PD=class t{title=tc("ViviGo");static \u0275fac=function(i){return new(i||t)};static \u0275cmp=Ai({type:t,selectors:[["app-root"]],decls:3,vars:0,template:function(i,l){i&1&&be(0,"app-encabezado")(1,"router-outlet")(2,"app-pie-pagina")},dependencies:[$b,jO,MD,AD],encapsulation:2})};rO(PD,L$).catch(t=>console.error(t));
