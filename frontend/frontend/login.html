<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iniciar Sesión - ViviGo</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="css/style.css">
    <script src="auth.js"></script>
</head>
<body>

    <header class="main-header">
        <div class="container">
            <a href="index.html" class="logo">
                <div class="logo-icon">
                    <i class="fa-solid fa-house-chimney logo-house"></i>
                </div>
                <span class="logo-text">CloudHouse</span>
            </a>
            <!--<nav class="main-nav">
                <ul>
                    <li><a href="register.html">¿No tienes cuenta? Regístrate</a></li>
                </ul>
            </nav>-->
        </div>
    </header>

    <main class="container dashboard-container">
        <div class="login-container" style="display: flex; justify-content: center; align-items: flex-start; min-height: calc(100vh - 200px); padding: 2rem 0;">
            
            <!-- Login Form -->
            <section class="dashboard-content" id="loginSection" style="width: 100%; max-width: 800px; margin: 0;">
                <div class="content-header" style="text-align: center; margin-bottom: 3rem;">
                    <h1 style="font-size: 2.5rem; margin-bottom: 1rem;">Bienvenido de vuelta</h1>
                    <p style="font-size: 1.2rem; color: #7F8C8D;">Inicia sesión para continuar tu aventura</p>
                </div>
                
                <div class="form-container">
                    <form id="loginForm">
                        <div class="form-grid" style="max-width: 700px; margin: 0 auto;">
                            <div class="form-group full-width">
                                <label for="email">Correo Electrónico *</label>
                                <input type="email" id="email" name="email" required placeholder="tu@email.com" autocomplete="email">
                                <div class="error-message" id="emailError"></div>
                            </div>
                            
                            <div class="form-group full-width">
                                <label for="password">Contraseña *</label>
                                <div class="password-input-container" style="position: relative;">
                                    <input type="password" id="password" name="password" required placeholder="Tu contraseña" autocomplete="current-password">
                                    <button type="button" class="password-toggle" style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); background: none; border: none; color: #7F8C8D; cursor: pointer;">
                                        <i class="fa-solid fa-eye" id="toggleIcon"></i>
                                    </button>
                                </div>
                                <div class="error-message" id="passwordError"></div>
                            </div>
                            
                            <div class="form-group full-width">
                                <div style="display: flex; justify-content: flex-end; align-items: center;">
                                    <a href="#" id="forgotPasswordLink" style="color: var(--primary-color); font-weight: 500; text-decoration: none; font-size: 0.9rem;">
                                        ¿Olvidaste tu contraseña?
                                    </a>
                                </div>
                            </div>
                            
                            <div class="form-group full-width">
                                <div style="display: flex; justify-content: center;">
                                    <button type="submit" class="btn btn-primary" id="loginButton" style="width: 300px; padding: 16px 24px; font-size: 1.1rem;">
                                        <i class="fa-solid fa-right-to-bracket"></i>
                                        Iniciar Sesión
                                    </button>
                                </div>
                            </div>
                            
                        </div>
                    </form>
                    
                    <div style="text-align: center; margin-top: 2rem; padding-top: 2rem; border-top: 2px solid var(--light-green); max-width: 700px; margin-left: auto; margin-right: auto;">
                        <p style="font-size: 1.1rem;">¿No tienes una cuenta? <a href="register.html" style="color: var(--primary-color); font-weight: 600;">Regístrate gratis</a></p>
                    </div>
                </div>
            </section>
            
            <!-- Forgot Password Form -->
            <section class="dashboard-content" id="forgotPasswordSection" style="display: none; width: 100%; max-width: 800px; margin: 0;">
                <div class="content-header" style="text-align: center; margin-bottom: 3rem;">
                    <h1 style="font-size: 2.5rem; margin-bottom: 1rem;">¿Olvidaste tu contraseña?</h1>
                    <p style="font-size: 1.2rem; color: #7F8C8D;">No te preocupes, te enviaremos un enlace para restablecerla</p>
                </div>
                
                <div class="form-container">
                    <form id="forgotPasswordForm">
                        <div class="form-grid" style="max-width: 700px; margin: 0 auto;">
                            <div class="form-group full-width">
                                <label for="resetEmail">Correo Electrónico *</label>
                                <input type="email" id="resetEmail" name="resetEmail" required placeholder="tu@email.com">
                                <div class="error-message" id="resetEmailError"></div>
                            </div>
                            
                            <div class="form-group full-width">
                                <div style="display: flex; justify-content: center;">
                                    <button type="submit" class="btn btn-primary" id="resetButton" style="width: 300px; padding: 16px 24px; font-size: 1.1rem;">
                                        <i class="fa-solid fa-paper-plane"></i>
                                        Enviar enlace de recuperación
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                    
                    <div style="text-align: center; margin-top: 2rem; padding-top: 2rem; border-top: 2px solid var(--light-green); max-width: 700px; margin-left: auto; margin-right: auto;">
                        <a href="#" id="backToLoginLink" style="color: var(--primary-color); font-weight: 600; font-size: 1.1rem;">
                            <i class="fa-solid fa-arrow-left"></i> Volver al inicio de sesión
                        </a>
                    </div>
                </div>
            </section>
            
            <!-- Success Message -->
            <section class="dashboard-content" id="successSection" style="display: none; width: 100%; max-width: 800px; margin: 0;">
                <div class="content-header" style="text-align: center; margin-bottom: 3rem;">
                    <div style="color: var(--success-color); font-size: 4rem; margin-bottom: 1rem;">
                        <i class="fa-solid fa-check-circle"></i>
                    </div>
                    <h1 style="font-size: 2.5rem; margin-bottom: 1rem;">¡Enlace enviado!</h1>
                    <p style="font-size: 1.2rem; color: #7F8C8D;">Hemos enviado un enlace de recuperación a tu correo electrónico</p>
                </div>
                
                <div class="form-container" style="text-align: center; max-width: 700px; margin: 0 auto;">
                    <div style="background-color: var(--light-green); border-radius: 12px; padding: 1.5rem; margin-bottom: 2rem;">
                        <p style="margin-bottom: 1rem; color: var(--text-color);">
                            <i class="fa-solid fa-info-circle"></i>
                            Revisa tu bandeja de entrada y sigue las instrucciones para restablecer tu contraseña.
                        </p>
                        <p style="color: #7F8C8D; font-size: 0.9rem;">
                            Si no ves el correo, revisa tu carpeta de spam o correo no deseado.
                        </p>
                    </div>
                    
                    <button type="button" class="btn btn-secondary" id="resendEmailButton">
                        <i class="fa-solid fa-refresh"></i>
                        Reenviar correo
                    </button>
                    
                    <div style="margin-top: 2rem; padding-top: 2rem; border-top: 2px solid var(--light-green);">
                        <a href="#" id="backToLoginFromSuccess" style="color: var(--primary-color); font-weight: 600; font-size: 1.1rem;">
                            <i class="fa-solid fa-arrow-left"></i> Volver al inicio de sesión
                        </a>
                    </div>
                </div>
            </section>
            
        </div>
    </main>

    <footer class="main-footer">
        <div class="container">
            <div class="footer-bottom"><p>&copy; 2025 ViviGo. Todos los derechos reservados.</p></div>
        </div>
    </footer>

    <style>
        .error-message {
            color: var(--danger-color);
            font-size: 0.85rem;
            margin-top: 0.5rem;
            display: none;
        }
        
        .error-message.show {
            display: block;
        }
        
        .form-group input.error,
        .form-group select.error {
            border-color: var(--danger-color);
            box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.1);
        }
        
        .password-toggle:hover {
            color: var(--primary-color);
        }
        
        .login-container {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const loginSection = document.getElementById('loginSection');
            const forgotPasswordSection = document.getElementById('forgotPasswordSection');
            const successSection = document.getElementById('successSection');
            
            const loginForm = document.getElementById('loginForm');
            const forgotPasswordForm = document.getElementById('forgotPasswordForm');
            
            const forgotPasswordLink = document.getElementById('forgotPasswordLink');
            const backToLoginLink = document.getElementById('backToLoginLink');
            const backToLoginFromSuccess = document.getElementById('backToLoginFromSuccess');
            const resendEmailButton = document.getElementById('resendEmailButton');
            
            const passwordToggle = document.querySelector('.password-toggle');
            const passwordInput = document.getElementById('password');
            const toggleIcon = document.getElementById('toggleIcon');
            
            // Password visibility toggle
            passwordToggle.addEventListener('click', function() {
                if (passwordInput.type === 'password') {
                    passwordInput.type = 'text';
                    toggleIcon.className = 'fa-solid fa-eye-slash';
                } else {
                    passwordInput.type = 'password';
                    toggleIcon.className = 'fa-solid fa-eye';
                }
            });
            
            // Navigation between forms
            forgotPasswordLink.addEventListener('click', function(e) {
                e.preventDefault();
                showSection('forgotPassword');
            });
            
            backToLoginLink.addEventListener('click', function(e) {
                e.preventDefault();
                showSection('login');
            });
            
            backToLoginFromSuccess.addEventListener('click', function(e) {
                e.preventDefault();
                showSection('login');
            });
            
            function showSection(section) {
                loginSection.style.display = 'none';
                forgotPasswordSection.style.display = 'none';
                successSection.style.display = 'none';
                
                switch(section) {
                    case 'login':
                        loginSection.style.display = 'block';
                        break;
                    case 'forgotPassword':
                        forgotPasswordSection.style.display = 'block';
                        document.getElementById('resetEmail').focus();
                        break;
                    case 'success':
                        successSection.style.display = 'block';
                        break;
                }
            }
            
            // Login form submission
            loginForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                let isValid = true;
                const loginButton = document.getElementById('loginButton');
                
                // Clear previous errors
                clearErrors();
                
                // Get form data
                const email = document.getElementById('email').value.trim();
                const password = document.getElementById('password').value;
                
                // Validate email
                if (!email) {
                    showError('email', 'El correo electrónico es obligatorio');
                    isValid = false;
                } else if (!isValidEmail(email)) {
                    showError('email', 'Por favor ingresa un correo electrónico válido');
                    isValid = false;
                }
                
                // Validate password
                if (!password) {
                    showError('password', 'La contraseña es obligatoria');
                    isValid = false;
                }
                
                if (isValid) {
                    // Show loading state
                    loginButton.disabled = true;
                    loginButton.innerHTML = '<span class="loading-spinner"></span> Iniciando sesión...';
                    
                    try {
                        // Call backend API using auth.js
                        const result = await auth.login(email, password);
                        
                        if (result.success) {
                            // Login successful - redirect to index.html
                            window.location.href = 'index.html';
                        } else {
                            // Login failed - show error message
                            showError('password', result.error);
                        }
                    } catch (error) {
                        console.error('Error en login:', error);
                        showError('password', 'Error de conexión. Intenta nuevamente.');
                    } finally {
                        // Reset button state
                        loginButton.disabled = false;
                        loginButton.innerHTML = '<i class="fa-solid fa-right-to-bracket"></i> Iniciar Sesión';
                    }
                }
            });
            
            // Forgot password form submission
            forgotPasswordForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const resetButton = document.getElementById('resetButton');
                const resetEmail = document.getElementById('resetEmail').value.trim();
                
                // Clear previous errors
                clearErrors();
                
                if (!resetEmail) {
                    showError('resetEmail', 'El correo electrónico es obligatorio');
                    return;
                }
                
                if (!isValidEmail(resetEmail)) {
                    showError('resetEmail', 'Por favor ingresa un correo electrónico válido');
                    return;
                }
                
                // Show loading state
                resetButton.disabled = true;
                resetButton.innerHTML = '<span class="loading-spinner"></span> Enviando...';
                
                // Simulate API call
                setTimeout(() => {
                    resetButton.disabled = false;
                    resetButton.innerHTML = '<i class="fa-solid fa-paper-plane"></i> Enviar enlace de recuperación';
                    
                    // Show success section
                    showSection('success');
                }, 2000);
            });
            
            // Resend email functionality
            resendEmailButton.addEventListener('click', function() {
                const button = this;
                button.disabled = true;
                button.innerHTML = '<span class="loading-spinner"></span> Reenviando...';
                
                setTimeout(() => {
                    button.disabled = false;
                    button.innerHTML = '<i class="fa-solid fa-refresh"></i> Reenviar correo';
                    alert('Correo reenviado correctamente');
                }, 1500);
            });
            
            // Utility functions
            function isValidEmail(email) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return emailRegex.test(email);
            }
            
            function showError(fieldName, message) {
                const field = document.getElementById(fieldName);
                const errorElement = document.getElementById(fieldName + 'Error');
                
                field.classList.add('error');
                errorElement.textContent = message;
                errorElement.classList.add('show');
            }
            
            function clearErrors() {
                document.querySelectorAll('.error-message').forEach(error => {
                    error.classList.remove('show');
                });
                document.querySelectorAll('.error').forEach(input => {
                    input.classList.remove('error');
                });
            }
            
            // Auto-focus on email field
            document.getElementById('email').focus();
        });
    </script>

</body>
</html>
