<main class="search-page-container">
    <!-- Header de resultados -->
    <div class="results-header">
        <div class="container">
            <h2 id="resultsTitle">Resultados de búsqueda</h2>
            <p id="resultsCount">Cargando...</p>
        </div>
    </div>

    <div class="container">
        <div class="search-layout">
            <!-- Sidebar de filtros -->
            <aside class="filters-sidebar">
                <h3>Filtros</h3>
                
                <div class="filter-group">
                    <h4>Rango de Precios</h4>
                    <div class="price-range">
                        <input type="text" placeholder="Mín" [(ngModel)]="searchParams.precioMin">
                        <span>-</span>
                        <input type="text" placeholder="Máx" [(ngModel)]="searchParams.precioMax">
                    </div>
                </div>

                <div class="filter-group">
                    <h4>Tipo de Alojamiento</h4>
                    <div class="checkbox-group">
                        <div><input type="checkbox" id="tipo1"><label for="tipo1">Apartamento</label></div>
                        <div><input type="checkbox" id="tipo2"><label for="tipo2">Casa</label></div>
                        <div><input type="checkbox" id="tipo3"><label for="tipo3">Cabaña</label></div>
                        <div><input type="checkbox" id="tipo4"><label for="tipo4">Finca</label></div>
                    </div>
                </div>

                <div class="filter-group">
                    <h4>Servicios</h4>
                    <div class="checkbox-group">
                        <div>
                            <input type="checkbox" id="serv1" (change)="onServiceToggle('WIFI')">
                            <label for="serv1">Wi-Fi</label>
                        </div>
                        <div>
                            <input type="checkbox" id="serv2" (change)="onServiceToggle('PISCINA')">
                            <label for="serv2">Piscina</label>
                        </div>
                        <div>
                            <input type="checkbox" id="serv3" (change)="onServiceToggle('COCINA')">
                            <label for="serv3">Cocina</label>
                        </div>
                        <div>
                            <input type="checkbox" id="serv4" (change)="onServiceToggle('PARKING')">
                            <label for="serv4">Parking</label>
                        </div>
                        <div>
                            <input type="checkbox" id="serv5" (change)="onServiceToggle('MASCOTAS')">
                            <label for="serv5">Admite Mascotas</label>
                        </div>
                    </div>
                </div>

                <button class="btn btn-primary filter-btn" (click)="applyFilters()">Aplicar Filtros</button>
            </aside>

            <!-- Sección de resultados -->
            <section class="results-section">
                <!-- Barra de búsqueda principal -->
                <div class="main-search-bar">
                    <div class="search-field">
                        <label for="ciudad">Ciudad</label>
                        <input type="text" id="ciudad" [(ngModel)]="searchParams.ciudad" placeholder="¿A dónde viajas?">
                    </div>
                    <div class="search-field">
                        <label for="checkin">Check-in</label>
                        <input type="date" id="checkin" [(ngModel)]="searchParams.checkin">
                    </div>
                    <div class="search-field">
                        <label for="checkout">Check-out</label>
                        <input type="date" id="checkout" [(ngModel)]="searchParams.checkout">
                    </div>
                    <div class="search-field">
                        <label for="huespedes">Huéspedes</label>
                        <input type="number" id="huespedes" [(ngModel)]="searchParams.huespedes" placeholder="¿Cuántos?">
                    </div>
                    <button class="btn-search" (click)="onSearch()">
                        <i class="fa-solid fa-magnifying-glass"></i>
                    </button>
                </div>

                <!-- Estados de carga y resultados -->
                <div class="results-container" id="resultsContainer">
                    <!-- Loading State -->
                    <div class="loading-state" *ngIf="isLoading">
                        <div class="spinner"></div>
                        <p>Buscando alojamientos...</p>
                    </div>

                    <!-- Empty State -->
                    <div class="empty-state" *ngIf="!isLoading && !error && accommodations.length === 0">
                        <i class="fa-solid fa-search"></i>
                        <h3>No se encontraron alojamientos</h3>
                        <p>No hay alojamientos que coincidan con tus criterios de búsqueda.</p>
                        <button class="btn btn-primary" (click)="clearFilters()">Limpiar filtros</button>
                    </div>

                    <!-- Error State -->
                    <div class="error-state" *ngIf="error && !isLoading">
                        <i class="fa-solid fa-exclamation-triangle"></i>
                        <h3>Error al cargar alojamientos</h3>
                        <p>{{ error }}</p>
                        <button class="btn btn-primary" (click)="retryLoad()">
                            <i class="fa-solid fa-refresh"></i> Reintentar
                        </button>
                    </div>

                    <!-- Accommodations Grid -->
                    <div class="accommodations-grid" *ngIf="!isLoading && !error && accommodations.length > 0">
                        <div class="accommodation-card" 
                             *ngFor="let accommodation of accommodations" 
                             (click)="viewAccommodation(accommodation.id)">
                            <div class="card-image">
                                <img [src]="accommodation.imagenPrincipal || 'https://placehold.co/400x200/cccccc/333333?text=Alojamiento'" 
                                     [alt]="accommodation.titulo">
                                <div class="favorite-icon" (click)="toggleFavorite(accommodation.id); $event.stopPropagation()">
                                    <i class="fa-regular fa-heart"></i>
                                </div>
                            </div>
                            <div class="card-info">
                                <h3>{{ accommodation.titulo }}</h3>
                                <p class="location">
                                    <i class="fa-solid fa-map-marker-alt"></i>
                                    <span>{{ accommodation.direccion ? `${accommodation.direccion.ciudad}, ${accommodation.direccion.departamento || ''}` : 'Ubicación no especificada' }}</span>
                                </p>
                                <div class="rating">
                                    <i class="fa-solid fa-star"></i>
                                    <span>{{ (accommodation.promedioCalificaciones || 0).toFixed(1) }} ({{ accommodation.numeroCalificaciones || 0 }})</span>
                                </div>
                                <p class="price"><strong>${{ (accommodation.precioPorNoche || 0).toFixed(0) }} COP</strong> / noche</p>
                            </div>
                        </div>
                    </div>

                    <!-- Paginación -->
                    <nav class="pagination" *ngIf="totalPages > 1 && !isLoading && !error">
                        <ul id="paginationList">
                            <li *ngIf="currentPage > 0">
                                <a href="#" (click)="goToPage(currentPage - 1); $event.preventDefault()">&laquo;</a>
                            </li>
                            
                            <li *ngFor="let page of getPageNumbers()">
                                <a href="#" 
                                   [class.active]="page === currentPage"
                                   (click)="goToPage(page); $event.preventDefault()">
                                    {{ page + 1 }}
                                </a>
                            </li>
                            
                            <li *ngIf="currentPage < totalPages - 1">
                                <a href="#" (click)="goToPage(currentPage + 1); $event.preventDefault()">&raquo;</a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </section>
        </div>
    </div>
</main>
